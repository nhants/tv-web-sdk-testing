/*! For license information please see main.d617b7eb8236db7020a1.bundle.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1016:function(module,exports,__webpack_require__){__webpack_require__(1017),__webpack_require__(1186),__webpack_require__(1187),__webpack_require__(1332),__webpack_require__(1543),__webpack_require__(1575),__webpack_require__(1580),__webpack_require__(1592),__webpack_require__(1594),__webpack_require__(1599),__webpack_require__(1601),module.exports=__webpack_require__(1603)},1091:function(module,exports){},1187:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(640)},1601:function(module,exports,__webpack_require__){"use strict";__webpack_require__(18),__webpack_require__(72),__webpack_require__(63),__webpack_require__(37),__webpack_require__(61),__webpack_require__(539),__webpack_require__(540),__webpack_require__(23),__webpack_require__(64);var _clientApi=__webpack_require__(113),_clientLogger=__webpack_require__(71),_configFilename=__webpack_require__(1602);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(_configFilename.args||_configFilename.argTypes)&&_clientLogger.logger.warn("Invalid args/argTypes in config, ignoring.",JSON.stringify({args:_configFilename.args,argTypes:_configFilename.argTypes})),_configFilename.decorators&&_configFilename.decorators.forEach((function(decorator){return(0,_clientApi.addDecorator)(decorator,!1)})),_configFilename.loaders&&_configFilename.loaders.forEach((function(loader){return(0,_clientApi.addLoader)(loader,!1)})),(_configFilename.parameters||_configFilename.globals||_configFilename.globalTypes)&&(0,_clientApi.addParameters)(_objectSpread(_objectSpread({},_configFilename.parameters),{},{globals:_configFilename.globals,globalTypes:_configFilename.globalTypes}),!1),_configFilename.argTypesEnhancers&&_configFilename.argTypesEnhancers.forEach((function(enhancer){return(0,_clientApi.addArgTypesEnhancer)(enhancer)}))},1602:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"parameters",(function(){return parameters}));var parameters={actions:{argTypesRegex:"^on[A-Z].*"}}},1603:function(module,exports,__webpack_require__){"use strict";(function(module){(0,__webpack_require__(640).configure)([__webpack_require__(1604),__webpack_require__(1605)],module,!1)}).call(this,__webpack_require__(106)(module))},1604:function(module,exports){function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,module.exports=webpackEmptyContext,webpackEmptyContext.id=1604},1605:function(module,exports,__webpack_require__){var map={"./tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js":1749,"./tvweb-sdk.msb/src/LivenessDetection/LivenessDetection.stories.js":1750,"./tvweb-ui/src/Camera/Camera.stories.js":1619,"./tvweb-ui/src/Icon/Icon.stories.js":1620,"./tvweb-ui/src/LivenessDetection/LivenessDetection.stories.js":1748,"./tvweb-ui/src/PlacementArea/PlacementArea.stories.js":1738,"./tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js":1739,"./tvweb-ui/src/ReadIDCard/ReadIDCard.stories.js":1746,"./tvweb-ui/src/RectangleMask/RectangleMask.stories.js":1741};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=1605},1619:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"DefaultUsage",(function(){return DefaultUsage}));__webpack_require__(15);var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5),_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(1),__webpack_require__(8)),___WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(82),DefaultUsage=function DefaultUsage(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)(_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_3__.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:"/tvweb-sdk/assets"},children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(___WEBPACK_IMPORTED_MODULE_4__.b,{}),";"]})};DefaultUsage.displayName="DefaultUsage",__webpack_exports__.default={title:"[Default] Camera"},DefaultUsage.parameters=Object.assign({storySource:{source:"function DefaultUsage() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: 'vi', assetRoot }}>\n      <Camera />;\n    </SettingsContext.SDKSettingsProvider>\n  );\n}"}},DefaultUsage.parameters),DefaultUsage.__docgenInfo={description:"",methods:[],displayName:"DefaultUsage"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/Camera/Camera.stories.js"]={name:"DefaultUsage",docgenInfo:DefaultUsage.__docgenInfo,path:"packages/tvweb-ui/src/Camera/Camera.stories.js"})},1620:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Camera",(function(){return Camera}));__webpack_require__(15);var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5),_Camera__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(1),__webpack_require__(431)),Camera=function Camera(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_Camera__WEBPACK_IMPORTED_MODULE_3__.a,{})};Camera.displayName="Camera",__webpack_exports__.default={title:"[Default] Icons"},Camera.parameters=Object.assign({storySource:{source:"function Camera() {\n  return <CameraIcon />;\n}"}},Camera.parameters),Camera.__docgenInfo={description:"",methods:[],displayName:"Camera"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/Icon/Icon.stories.js"]={name:"Camera",docgenInfo:Camera.__docgenInfo,path:"packages/tvweb-ui/src/Icon/Icon.stories.js"})},1623:function(module,exports){},1625:function(module,exports){},1635:function(module,exports){},1637:function(module,exports){},166:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Type}));__webpack_require__(35),__webpack_require__(61);var _styleMapping,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),prop_types__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__(1),__webpack_require__(4)),prop_types__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_4__);function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var Type={DEFAULT:"default",ERROR:"error"},styleMapping=(_defineProperty(_styleMapping={},Type.DEFAULT,{fill:"none",strokeWidth:2,stroke:"#f4f4f4",strokeDasharray:"7, 4",opacity:.6}),_defineProperty(_styleMapping,Type.ERROR,{fill:"rgba(234,50,35, 0.1)",strokeWidth:2,stroke:"#ea3223"}),_styleMapping),paddingStyle={fill:"rgba(0,0,0, 0.6)"};function RectangleMask(_ref){var className=_ref.className,width=_ref.width,height=_ref.height,type=_ref.type,rectStyle=styleMapping[type];return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("svg",{width:width,height:height,className:className,children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("rect",{x:2,y:2,rx:10,ry:10,width:width-4,height:height-4,style:rectStyle}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("path",{d:"M0,".concat(12," Q0,0 ").concat(12,",0 L0,0 Z"),style:paddingStyle}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("path",{d:"M0,".concat(height-12," Q0,").concat(height," ").concat(12,",").concat(height," L0,").concat(height," Z"),style:paddingStyle}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("path",{d:"M".concat(width-12,",").concat(height," Q").concat(width,",").concat(height," ").concat(width,",").concat(height-12," L").concat(width,",").concat(height," Z"),style:paddingStyle}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("path",{d:"M".concat(width-12,",0 Q").concat(width,",0 ").concat(width,",").concat(12," L").concat(width,",0 Z"),style:paddingStyle})]})}RectangleMask.displayName="RectangleMask",RectangleMask.propTypes={className:prop_types__WEBPACK_IMPORTED_MODULE_4___default.a.string,width:prop_types__WEBPACK_IMPORTED_MODULE_4___default.a.number,height:prop_types__WEBPACK_IMPORTED_MODULE_4___default.a.number,type:prop_types__WEBPACK_IMPORTED_MODULE_4___default.a.oneOf([Type.DEFAULT,Type.ERROR])},RectangleMask.defaultProps={className:"",width:300,height:200,type:Type.DEFAULT},RectangleMask.__docgenInfo={description:"",methods:[],displayName:"RectangleMask",props:{className:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""},width:{defaultValue:{value:"300",computed:!1},type:{name:"number"},required:!1,description:""},height:{defaultValue:{value:"200",computed:!1},type:{name:"number"},required:!1,description:""},type:{defaultValue:{value:"'default'",computed:!1},type:{name:"enum",value:[{value:"'default'",computed:!1},{value:"'error'",computed:!1}]},required:!1,description:""}}},__webpack_exports__.b=RectangleMask,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/RectangleMask/index.js"]={name:"RectangleMask",docgenInfo:RectangleMask.__docgenInfo,path:"packages/tvweb-ui/src/RectangleMask/index.js"})},1662:function(module,exports){},1663:function(module,exports){},1668:function(module,exports){},167:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__(35),__webpack_require__(21),__webpack_require__(37),__webpack_require__(39);var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5),prop_types__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__(1),__webpack_require__(4)),prop_types__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_6__);function _templateObject(){var data=function _taggedTemplateLiteral(strings,raw){raw||(raw=strings.slice(0));return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}(["\n  transition: stroke-dashoffset 0.4s;\n  transform: rotate(-90deg);\n  transform-origin: 50% 50%;\n"]);return _templateObject=function _templateObject(){return data},data}var AnimatedRing=__webpack_require__(10).c.circle(_templateObject());function ProgressCircle(_ref){var className=_ref.className,style=_ref.style,radius=_ref.radius,strokeWidth=_ref.strokeWidth,progress=_ref.progress,hasError=_ref.hasError,activeColor=_ref.activeColor,innerPadding=_ref.innerPadding,outsideRingColor=_ref.outsideRingColor,outsideRingOpacity=_ref.outsideRingOpacity,insideRingColor=_ref.insideRingColor,insideRingWidth=_ref.insideRingWidth,insideRingStrokeDash=_ref.insideRingStrokeDash,errorRingWidth=_ref.errorRingWidth,errorRingColor=_ref.errorRingColor,dashedRingColor=_ref.dashedRingColor,dashedRingOpacity=_ref.dashedRingOpacity,dashedRingWidth=_ref.dashedRingWidth,dashedRingLineThick=_ref.dashedRingLineThick,dashedRingLineSpacing=_ref.dashedRingLineSpacing,dashedInsideRingColor=_ref.dashedInsideRingColor,dashedInsideRingWidth=_ref.dashedInsideRingWidth,showOutsideRing=_ref.showOutsideRing,showInsideRing=_ref.showInsideRing,showDashedRing=_ref.showDashedRing,width=2*radius,height=2*radius,outsideRingRadius=radius-2*strokeWidth,outsideRingCircumference=2*Math.PI*outsideRingRadius,outsideRingStrokeDashoffset=outsideRingCircumference-progress/100*outsideRingCircumference,dashedRingRadius=outsideRingRadius-dashedRingWidth/2-strokeWidth/2-innerPadding,dashedRingCircumference=2*Math.PI*dashedRingRadius,dashedRingStrokeDashoffset=dashedRingCircumference-progress/100*dashedRingCircumference,dashedInsideRingRadius=dashedRingRadius-dashedInsideRingWidth/2-dashedRingWidth/2,dashedInsideRingCircumference=2*Math.PI*dashedInsideRingRadius,dashedInsideRingStrokeDashoffset=dashedInsideRingCircumference-progress/100*dashedInsideRingCircumference,insideRingRadius=dashedInsideRingRadius-insideRingWidth/2-dashedInsideRingWidth/2,errorRingRadius=dashedInsideRingRadius-errorRingWidth/2-dashedInsideRingWidth/2;return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("svg",{className:className,style:style,width:width,height:height,viewBox:"0 0 ".concat(width," ").concat(height),fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[showOutsideRing?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.Fragment,{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("circle",{opacity:outsideRingOpacity,cx:radius,cy:radius,r:outsideRingRadius,stroke:outsideRingColor}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(AnimatedRing,{cx:radius,cy:radius,r:outsideRingRadius,stroke:activeColor,strokeWidth:strokeWidth,strokeLinecap:"round",strokeDasharray:"".concat(outsideRingCircumference," ").concat(outsideRingCircumference),style:{strokeDashoffset:outsideRingStrokeDashoffset}})]}):null,showDashedRing?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.Fragment,{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("circle",{opacity:dashedRingOpacity,cx:radius,cy:radius,r:dashedRingRadius,stroke:dashedRingColor,strokeWidth:dashedRingWidth,strokeDasharray:"".concat(dashedRingLineThick," ").concat(dashedRingLineSpacing)}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("mask",{id:"mask0","mask-type":"alpha",maskUnits:"userSpaceOnUse",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("circle",{cx:radius,cy:radius,r:dashedRingRadius,stroke:activeColor,strokeWidth:dashedRingWidth,strokeDasharray:"".concat(dashedRingLineThick," ").concat(dashedRingLineSpacing)})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("g",{mask:"url(#mask0)",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(AnimatedRing,{cx:radius,cy:radius,r:dashedRingRadius,stroke:activeColor,strokeWidth:dashedRingWidth,strokeDasharray:"".concat(dashedRingCircumference," ").concat(dashedRingCircumference),style:{strokeDashoffset:dashedRingStrokeDashoffset}})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("circle",{opacity:dashedRingOpacity,cx:radius,cy:radius,r:dashedInsideRingRadius,stroke:dashedInsideRingColor,strokeWidth:dashedInsideRingWidth}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(AnimatedRing,{cx:radius,cy:radius,r:dashedInsideRingRadius,stroke:activeColor,strokeWidth:dashedInsideRingWidth,strokeLinecap:"round",strokeDasharray:"".concat(dashedInsideRingCircumference," ").concat(dashedInsideRingCircumference),style:{strokeDashoffset:dashedInsideRingStrokeDashoffset}})]}):null,showInsideRing?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("circle",{strokeDasharray:insideRingStrokeDash,cx:radius,cy:radius,r:insideRingRadius,stroke:insideRingColor,strokeWidth:insideRingWidth}):null,hasError?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("circle",{strokeDasharray:insideRingStrokeDash,cx:radius,cy:radius,r:errorRingRadius,stroke:errorRingColor,strokeWidth:errorRingWidth}):null]})}ProgressCircle.displayName="ProgressCircle",ProgressCircle.propTypes={className:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.string,style:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.shape({}),radius:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,strokeWidth:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,progress:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,hasError:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.bool,activeColor:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.string,innerPadding:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,outsideRingColor:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.string,outsideRingOpacity:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,insideRingColor:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.string,insideRingWidth:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,insideRingStrokeDash:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.string,errorRingColor:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.string,errorRingWidth:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,dashedRingColor:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.string,dashedRingOpacity:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,dashedRingWidth:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,dashedRingLineThick:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,dashedRingLineSpacing:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,dashedInsideRingColor:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.string,dashedInsideRingWidth:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.number,showOutsideRing:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.bool,showDashedRing:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.bool,showInsideRing:prop_types__WEBPACK_IMPORTED_MODULE_6___default.a.bool},ProgressCircle.defaultProps={className:"",style:null,radius:160,strokeWidth:3,progress:0,hasError:!1,activeColor:"#0092ff",innerPadding:5,outsideRingColor:"#f2f6f9",outsideRingOpacity:.1,insideRingColor:"#f2f6f9",insideRingWidth:3,insideRingStrokeDash:"0",errorRingColor:"#df0000",errorRingWidth:3,dashedRingColor:"#ffffff",dashedRingOpacity:.3,dashedRingWidth:10,dashedRingLineThick:1,dashedRingLineSpacing:6,dashedInsideRingColor:"#ffffff",dashedInsideRingWidth:0,showOutsideRing:!0,showDashedRing:!0,showInsideRing:!0},ProgressCircle.__docgenInfo={description:"",methods:[],displayName:"ProgressCircle",props:{className:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""},style:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},radius:{defaultValue:{value:"160",computed:!1},type:{name:"number"},required:!1,description:""},strokeWidth:{defaultValue:{value:"3",computed:!1},type:{name:"number"},required:!1,description:""},progress:{defaultValue:{value:"0",computed:!1},type:{name:"number"},required:!1,description:""},hasError:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},activeColor:{defaultValue:{value:"'#0092ff'",computed:!1},type:{name:"string"},required:!1,description:""},innerPadding:{defaultValue:{value:"5",computed:!1},type:{name:"number"},required:!1,description:""},outsideRingColor:{defaultValue:{value:"'#f2f6f9'",computed:!1},type:{name:"string"},required:!1,description:""},outsideRingOpacity:{defaultValue:{value:"0.1",computed:!1},type:{name:"number"},required:!1,description:""},insideRingColor:{defaultValue:{value:"'#f2f6f9'",computed:!1},type:{name:"string"},required:!1,description:""},insideRingWidth:{defaultValue:{value:"3",computed:!1},type:{name:"number"},required:!1,description:""},insideRingStrokeDash:{defaultValue:{value:"'0'",computed:!1},type:{name:"string"},required:!1,description:""},errorRingColor:{defaultValue:{value:"'#df0000'",computed:!1},type:{name:"string"},required:!1,description:""},errorRingWidth:{defaultValue:{value:"3",computed:!1},type:{name:"number"},required:!1,description:""},dashedRingColor:{defaultValue:{value:"'#ffffff'",computed:!1},type:{name:"string"},required:!1,description:""},dashedRingOpacity:{defaultValue:{value:"0.3",computed:!1},type:{name:"number"},required:!1,description:""},dashedRingWidth:{defaultValue:{value:"10",computed:!1},type:{name:"number"},required:!1,description:""},dashedRingLineThick:{defaultValue:{value:"1",computed:!1},type:{name:"number"},required:!1,description:""},dashedRingLineSpacing:{defaultValue:{value:"6",computed:!1},type:{name:"number"},required:!1,description:""},dashedInsideRingColor:{defaultValue:{value:"'#ffffff'",computed:!1},type:{name:"string"},required:!1,description:""},dashedInsideRingWidth:{defaultValue:{value:"0",computed:!1},type:{name:"number"},required:!1,description:""},showOutsideRing:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:""},showDashedRing:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:""},showInsideRing:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:""}}},__webpack_exports__.a=ProgressCircle,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ProgressCircle/index.js"]={name:"ProgressCircle",docgenInfo:ProgressCircle.__docgenInfo,path:"packages/tvweb-ui/src/ProgressCircle/index.js"})},1670:function(module,exports){},1677:function(module,exports){},1696:function(module,exports){},1714:function(module,exports){},1715:function(module,exports){},1723:function(module,exports){},1724:function(module,exports){},1725:function(module,exports){},1738:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"DefaultUsage",(function(){return DefaultUsage}));__webpack_require__(15);var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5),___WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(1),__webpack_require__(434)),DefaultUsage=function DefaultUsage(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(___WEBPACK_IMPORTED_MODULE_3__.a,{x:"200px",y:"20px",with:"400px",height:"250px",surroundStyle:{opacity:.6,background:"#000"}})};DefaultUsage.displayName="DefaultUsage",__webpack_exports__.default={title:"[Default] Placement Area"},DefaultUsage.parameters=Object.assign({storySource:{source:'function DefaultUsage() {\n  return (\n    <PlacementArea\n      x="200px"\n      y="20px"\n      with="400px"\n      height="250px"\n      surroundStyle={{ opacity: 0.6, background: \'#000\' }}\n    />\n  );\n}'}},DefaultUsage.parameters),DefaultUsage.__docgenInfo={description:"",methods:[],displayName:"DefaultUsage"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/PlacementArea/PlacementArea.stories.js"]={name:"DefaultUsage",docgenInfo:DefaultUsage.__docgenInfo,path:"packages/tvweb-ui/src/PlacementArea/PlacementArea.stories.js"})},1739:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"DefaultStyle",(function(){return DefaultStyle})),__webpack_require__.d(__webpack_exports__,"HideOutsideRing",(function(){return HideOutsideRing})),__webpack_require__.d(__webpack_exports__,"HideInsideRing",(function(){return HideInsideRing})),__webpack_require__.d(__webpack_exports__,"HideDashedRing",(function(){return HideDashedRing})),__webpack_require__.d(__webpack_exports__,"DashedStyle",(function(){return DashedStyle})),__webpack_require__.d(__webpack_exports__,"HasDashedInsideRing",(function(){return HasDashedInsideRing})),__webpack_require__.d(__webpack_exports__,"HasError",(function(){return HasError}));__webpack_require__(21),__webpack_require__(15),__webpack_require__(37),__webpack_require__(39);var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5),styled_components__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__(1),__webpack_require__(10)),___WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(167);function _templateObject(){var data=function _taggedTemplateLiteral(strings,raw){raw||(raw=strings.slice(0));return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}(["\n  padding: 50px;\n  background: #06243c;\n"]);return _templateObject=function _templateObject(){return data},data}var Wrapper=styled_components__WEBPACK_IMPORTED_MODULE_6__.c.div(_templateObject()),DefaultStyle=function DefaultStyle(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(Wrapper,{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(___WEBPACK_IMPORTED_MODULE_7__.a,{progress:25})})};DefaultStyle.displayName="DefaultStyle";var HideOutsideRing=function HideOutsideRing(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(Wrapper,{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(___WEBPACK_IMPORTED_MODULE_7__.a,{progress:25,showOutsideRing:!1})})};HideOutsideRing.displayName="HideOutsideRing";var HideInsideRing=function HideInsideRing(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(Wrapper,{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(___WEBPACK_IMPORTED_MODULE_7__.a,{progress:25,showInsideRing:!1})})};HideInsideRing.displayName="HideInsideRing";var HideDashedRing=function HideDashedRing(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(Wrapper,{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(___WEBPACK_IMPORTED_MODULE_7__.a,{progress:25,showDashedRing:!1})})};HideDashedRing.displayName="HideDashedRing";var DashedStyle=function DashedStyle(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(Wrapper,{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(___WEBPACK_IMPORTED_MODULE_7__.a,{progress:25,showOutsideRing:!1,showInsideRing:!1,dashedRingWidth:24,dashedRingLineThick:1.5,dashedRingLineSpacing:12})})};DashedStyle.displayName="DashedStyle";var HasDashedInsideRing=function HasDashedInsideRing(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(Wrapper,{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(___WEBPACK_IMPORTED_MODULE_7__.a,{progress:25,dashedInsideRingWidth:1})})};HasDashedInsideRing.displayName="HasDashedInsideRing";var HasError=function HasError(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(Wrapper,{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(___WEBPACK_IMPORTED_MODULE_7__.a,{progress:25,hasError:!0})})};HasError.displayName="HasError",__webpack_exports__.default={title:"[Default] Progress Circle"},DefaultStyle.parameters=Object.assign({storySource:{source:"function DefaultStyle() {\n  return (\n    <Wrapper>\n      <ProgressCircle progress={25} />\n    </Wrapper>\n  );\n}"}},DefaultStyle.parameters),HideOutsideRing.parameters=Object.assign({storySource:{source:"function HideOutsideRing() {\n  return (\n    <Wrapper>\n      <ProgressCircle progress={25} showOutsideRing={false} />\n    </Wrapper>\n  );\n}"}},HideOutsideRing.parameters),HideInsideRing.parameters=Object.assign({storySource:{source:"function HideInsideRing() {\n  return (\n    <Wrapper>\n      <ProgressCircle progress={25} showInsideRing={false} />\n    </Wrapper>\n  );\n}"}},HideInsideRing.parameters),HideDashedRing.parameters=Object.assign({storySource:{source:"function HideDashedRing() {\n  return (\n    <Wrapper>\n      <ProgressCircle progress={25} showDashedRing={false} />\n    </Wrapper>\n  );\n}"}},HideDashedRing.parameters),DashedStyle.parameters=Object.assign({storySource:{source:"function DashedStyle() {\n  return (\n    <Wrapper>\n      <ProgressCircle\n        progress={25}\n        showOutsideRing={false}\n        showInsideRing={false}\n        dashedRingWidth={24}\n        dashedRingLineThick={1.5}\n        dashedRingLineSpacing={12}\n      />\n    </Wrapper>\n  );\n}"}},DashedStyle.parameters),HasDashedInsideRing.parameters=Object.assign({storySource:{source:"function HasDashedInsideRing() {\n  return (\n    <Wrapper>\n      <ProgressCircle progress={25} dashedInsideRingWidth={1} />\n    </Wrapper>\n  );\n}"}},HasDashedInsideRing.parameters),HasError.parameters=Object.assign({storySource:{source:"function HasError() {\n  return (\n    <Wrapper>\n      <ProgressCircle progress={25} hasError />\n    </Wrapper>\n  );\n}"}},HasError.parameters),DefaultStyle.__docgenInfo={description:"",methods:[],displayName:"DefaultStyle"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"]={name:"DefaultStyle",docgenInfo:DefaultStyle.__docgenInfo,path:"packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"}),HideOutsideRing.__docgenInfo={description:"",methods:[],displayName:"HideOutsideRing"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"]={name:"HideOutsideRing",docgenInfo:HideOutsideRing.__docgenInfo,path:"packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"}),HideInsideRing.__docgenInfo={description:"",methods:[],displayName:"HideInsideRing"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"]={name:"HideInsideRing",docgenInfo:HideInsideRing.__docgenInfo,path:"packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"}),HideDashedRing.__docgenInfo={description:"",methods:[],displayName:"HideDashedRing"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"]={name:"HideDashedRing",docgenInfo:HideDashedRing.__docgenInfo,path:"packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"}),DashedStyle.__docgenInfo={description:"",methods:[],displayName:"DashedStyle"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"]={name:"DashedStyle",docgenInfo:DashedStyle.__docgenInfo,path:"packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"}),HasDashedInsideRing.__docgenInfo={description:"",methods:[],displayName:"HasDashedInsideRing"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"]={name:"HasDashedInsideRing",docgenInfo:HasDashedInsideRing.__docgenInfo,path:"packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"}),HasError.__docgenInfo={description:"",methods:[],displayName:"HasError"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"]={name:"HasError",docgenInfo:HasError.__docgenInfo,path:"packages/tvweb-ui/src/ProgressCircle/ProgressCircle.stories.js"})},1741:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"DefaultStyle",(function(){return DefaultStyle})),__webpack_require__.d(__webpack_exports__,"ErrorStyle",(function(){return ErrorStyle}));__webpack_require__(15);var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5),___WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__(1),__webpack_require__(166)),DefaultStyle=function DefaultStyle(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("div",{style:{background:"grey"},children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(___WEBPACK_IMPORTED_MODULE_3__.b,{type:___WEBPACK_IMPORTED_MODULE_3__.a.DEFAULT})})};DefaultStyle.displayName="DefaultStyle";var ErrorStyle=function ErrorStyle(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(___WEBPACK_IMPORTED_MODULE_3__.b,{type:___WEBPACK_IMPORTED_MODULE_3__.a.ERROR})};ErrorStyle.displayName="ErrorStyle",__webpack_exports__.default={title:"[Default] Rectangle Mask"},DefaultStyle.parameters=Object.assign({storySource:{source:"function DefaultStyle() {\n  return (\n    <div style={{ background: 'grey' }}>\n      <RectangleMask type={Type.DEFAULT} />\n    </div>\n  );\n}"}},DefaultStyle.parameters),ErrorStyle.parameters=Object.assign({storySource:{source:"function ErrorStyle() {\n  return <RectangleMask type={Type.ERROR} />;\n}"}},ErrorStyle.parameters),DefaultStyle.__docgenInfo={description:"",methods:[],displayName:"DefaultStyle"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/RectangleMask/RectangleMask.stories.js"]={name:"DefaultStyle",docgenInfo:DefaultStyle.__docgenInfo,path:"packages/tvweb-ui/src/RectangleMask/RectangleMask.stories.js"}),ErrorStyle.__docgenInfo={description:"",methods:[],displayName:"ErrorStyle"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/RectangleMask/RectangleMask.stories.js"]={name:"ErrorStyle",docgenInfo:ErrorStyle.__docgenInfo,path:"packages/tvweb-ui/src/RectangleMask/RectangleMask.stories.js"})},1746:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Front",(function(){return ReadIDCard_stories_Front})),__webpack_require__.d(__webpack_exports__,"Back",(function(){return ReadIDCard_stories_Back})),__webpack_require__.d(__webpack_exports__,"ContinuousPhotoCapture",(function(){return ReadIDCard_stories_ContinuousPhotoCapture}));var flipY_namespaceObject={};__webpack_require__.r(flipY_namespaceObject),__webpack_require__.d(flipY_namespaceObject,"animationDuration",(function(){return animationDuration})),__webpack_require__.d(flipY_namespaceObject,"default",(function(){return flipY}));var splash_namespaceObject={};__webpack_require__.r(splash_namespaceObject),__webpack_require__.d(splash_namespaceObject,"default",(function(){return Animations_splash}));var spin_namespaceObject={};__webpack_require__.r(spin_namespaceObject),__webpack_require__.d(spin_namespaceObject,"default",(function(){return Animations_spin}));__webpack_require__(15);var jsx_runtime=__webpack_require__(5),react=__webpack_require__(1),tvweb_core_esm=__webpack_require__(8),trustvision_sdk_umd=__webpack_require__(432),trustvision_sdk_umd_default=__webpack_require__.n(trustvision_sdk_umd),prop_types=(__webpack_require__(18),__webpack_require__(25),__webpack_require__(29),__webpack_require__(24),__webpack_require__(22),__webpack_require__(95),__webpack_require__(27),__webpack_require__(30),__webpack_require__(99),__webpack_require__(4)),prop_types_default=__webpack_require__.n(prop_types),SwitchTransition=__webpack_require__(1758),CSSTransition=__webpack_require__(1759),dist=__webpack_require__(93),template=__webpack_require__(206),template_default=__webpack_require__.n(template),Camera=__webpack_require__(82),CropArea=__webpack_require__(433);__webpack_require__(35),__webpack_require__(72),__webpack_require__(32);function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(iter))return Array.from(iter)}(arr)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var IDCardSide=tvweb_core_esm.e.IDCardSide,Errors=tvweb_core_esm.e.Errors;function uploadIdCard(_x){return _uploadIdCard.apply(this,arguments)}function _uploadIdCard(){return(_uploadIdCard=_asyncToGenerator(regeneratorRuntime.mark((function _callee(_ref){var image,cardType,cardSide,apiClient;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return image=_ref.image,cardType=_ref.cardType,cardSide=_ref.cardSide,apiClient=_ref.apiClient,_context.abrupt("return",apiClient.uploadImage({file:image,label:"id_card.".concat(cardType,".").concat(cardSide)}));case 2:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}function checkIdSanity(_x2){return _checkIdSanity.apply(this,arguments)}function _checkIdSanity(){return(_checkIdSanity=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(_ref2){var imageId,cardType,apiClient;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return imageId=_ref2.imageId,cardType=_ref2.cardType,apiClient=_ref2.apiClient,_context2.abrupt("return",apiClient.requestVerifyIDCard({card_type:cardType,image1:{id:imageId}}));case 2:case"end":return _context2.stop()}}),_callee2)})))).apply(this,arguments)}function detectIDTampering(_x3){return _detectIDTampering.apply(this,arguments)}function _detectIDTampering(){return(_detectIDTampering=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(_ref3){var apiClient,cardType,frontCardId,isCapturingFrontSide,backCardId,recordedVideos,uploadedVideos,pendingVideos,finalUploadResult;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return apiClient=_ref3.apiClient,cardType=_ref3.cardType,frontCardId=_ref3.frontCardId,isCapturingFrontSide=_ref3.isCapturingFrontSide,backCardId=_ref3.backCardId,recordedVideos=_ref3.recordedVideos,uploadedVideos=recordedVideos.filter((function(i){return null!==i.id})),pendingVideos=recordedVideos.filter((function(i){return null===i.id&&i.frames.length>0})),_context3.next=5,Promise.all(pendingVideos.map((function(i){return apiClient.fileService.request({frames:i.frames})})));case 5:return finalUploadResult=_context3.sent,_context3.abrupt("return",apiClient.detectIDTampering({card_type:cardType,image:{id:frontCardId},image2:isCapturingFrontSide?void 0:{id:backCardId},videos:[].concat(_toConsumableArray(uploadedVideos.map((function(i){return{id:i.id}}))),_toConsumableArray(finalUploadResult.map((function(i){return{id:i.data.file_id}}))))}));case 7:case"end":return _context3.stop()}}),_callee3)})))).apply(this,arguments)}function readIdCard(_x4){return _readIdCard.apply(this,arguments)}function _readIdCard(){return(_readIdCard=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(_ref4){var cardType,apiClient,frontCardId,backCardId,isCapturingFrontSide;return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return cardType=_ref4.cardType,apiClient=_ref4.apiClient,frontCardId=_ref4.frontCardId,backCardId=_ref4.backCardId,isCapturingFrontSide=_ref4.isCapturingFrontSide,_context4.abrupt("return",apiClient.readIDCard({card_type:cardType,image1:isCapturingFrontSide?{id:frontCardId}:{id:backCardId}}));case 2:case"end":return _context4.stop()}}),_callee4)})))).apply(this,arguments)}function handleApiCheck(_x5){return _handleApiCheck.apply(this,arguments)}function _handleApiCheck(){return(_handleApiCheck=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(_ref5){var image,frontCardIdFromInput,onError,recordedVideos,apiClient,cardType,cardSide,uploadIdCardResult,imageId,frontCardId,backCardId,isCapturingFrontSide,sanityResult,readIdCardResult,detectIDTamperingResult;return regeneratorRuntime.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(image=_ref5.image,frontCardIdFromInput=_ref5.frontCardId,onError=_ref5.onError,recordedVideos=_ref5.recordedVideos,apiClient=_ref5.apiClient,cardType=_ref5.cardType,(cardSide=_ref5.cardSide)!==IDCardSide.BACK||frontCardIdFromInput){_context5.next=4;break}return onError(Errors.missing_front_id_card),_context5.abrupt("return");case 4:return _context5.next=6,uploadIdCard({image:image,cardType:cardType,cardSide:cardSide,apiClient:apiClient});case 6:if(!(uploadIdCardResult=_context5.sent).errors){_context5.next=10;break}return onError(Object.assign({},Errors.upload_error,{details:uploadIdCardResult.errors})),_context5.abrupt("return");case 10:return imageId=uploadIdCardResult.data.image_id,(isCapturingFrontSide=cardSide===IDCardSide.FRONT)?frontCardId=imageId:(frontCardId=frontCardIdFromInput,backCardId=imageId),_context5.next=15,checkIdSanity({imageId:imageId,cardType:cardType,apiClient:apiClient});case 15:if(!(sanityResult=_context5.sent).errors){_context5.next=19;break}return onError(Object.assign({},Errors.sanity_check_error,{details:sanityResult.errors})),_context5.abrupt("return");case 19:return _context5.next=21,readIdCard({cardType:cardType,apiClient:apiClient,frontCardId:frontCardId,backCardId:backCardId,isCapturingFrontSide:isCapturingFrontSide});case 21:if(!(readIdCardResult=_context5.sent).errors){_context5.next=25;break}return onError(Object.assign({},Errors.read_id_card_error,{details:readIdCardResult.errors})),_context5.abrupt("return");case 25:return _context5.next=27,detectIDTampering({apiClient:apiClient,cardType:cardType,frontCardId:frontCardId,isCapturingFrontSide:isCapturingFrontSide,backCardId:backCardId,recordedVideos:recordedVideos});case 27:if(!(detectIDTamperingResult=_context5.sent).errors){_context5.next=31;break}return onError(Object.assign({},Errors.detect_id_tampering_error,{details:detectIDTamperingResult.errors})),_context5.abrupt("return");case 31:return _context5.abrupt("return",{sanityResult:sanityResult.data,tamperingInfo:detectIDTamperingResult.data,cardInfo:readIdCardResult.data});case 32:case"end":return _context5.stop()}}),_callee5)})))).apply(this,arguments)}__webpack_require__(36),__webpack_require__(196),__webpack_require__(63),__webpack_require__(543),__webpack_require__(243),__webpack_require__(544),__webpack_require__(545),__webpack_require__(517),__webpack_require__(546),__webpack_require__(547),__webpack_require__(548),__webpack_require__(549),__webpack_require__(550),__webpack_require__(551),__webpack_require__(552),__webpack_require__(553),__webpack_require__(554),__webpack_require__(555),__webpack_require__(556),__webpack_require__(557),__webpack_require__(558),__webpack_require__(559),__webpack_require__(560),__webpack_require__(561),__webpack_require__(562),__webpack_require__(563),__webpack_require__(564),__webpack_require__(565),__webpack_require__(566),__webpack_require__(567),__webpack_require__(568),__webpack_require__(569),__webpack_require__(64);function utils_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function utils_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){utils_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){utils_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function utils_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return utils_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return utils_arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function utils_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var utils_Errors=tvweb_core_esm.e.Errors;function euclideanDistances(point1,point2){return Math.pow(point1.x-point2.x,2)+Math.pow(point1.y-point2.y,2)}function getDistance(point1,point2){return Math.sqrt(euclideanDistances(point1,point2))}function padBorders(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},canvas=_ref.canvas,_ref$imgMargin=_ref.imgMargin,imgMargin=void 0===_ref$imgMargin?.15:_ref$imgMargin,w=canvas.width,h=canvas.height,margin=imgMargin;margin<1&&(margin=parseInt(.5*(h+w)*margin,10));var newW=w+2*margin,newH=h+2*margin,dx=margin,dy=margin,paddedCanvas=document.createElement("canvas");paddedCanvas.width=newW,paddedCanvas.height=newH;var paddedCanvasContext=paddedCanvas.getContext("2d");return paddedCanvasContext.fillStyle="#000000",paddedCanvasContext.fillRect(0,0,paddedCanvas.width,paddedCanvas.height),paddedCanvasContext.drawImage(canvas,0,0,canvas.width,canvas.height,dx,dy,canvas.width,canvas.height),{canvas:paddedCanvas,margin:margin}}function fourPointTransform(canvas,corners){var cv=window.cv,_corners$map2=_slicedToArray(corners.map((function(corner){return corner.location})),4),topLeft=_corners$map2[0],topRight=_corners$map2[1],bottomRight=_corners$map2[2],bottomLeft=_corners$map2[3],widthA=getDistance(bottomRight,bottomLeft),widthB=getDistance(topRight,topLeft),maxWidth=Math.max(widthA,widthB),heightA=getDistance(topRight,bottomRight),heightB=getDistance(topLeft,bottomLeft),maxHeight=Math.max(heightA,heightB),srcPts=[topLeft.x,topLeft.y,topRight.x,topRight.y,bottomRight.x,bottomRight.y,bottomLeft.x,bottomLeft.y],dstPts=[0,0,maxWidth-1,0,maxWidth-1,maxHeight-1,0,maxHeight-1],src=cv.imread(canvas),dst=new cv.Mat,dsize=new cv.Size(maxWidth,maxHeight),srcTri=cv.matFromArray(4,1,cv.CV_32FC2,srcPts),dstTri=cv.matFromArray(4,1,cv.CV_32FC2,dstPts),m=cv.getPerspectiveTransform(srcTri,dstTri);cv.warpPerspective(src,dst,m,dsize,cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar);var result=new ImageData(new Uint8ClampedArray(dst.data),dst.cols,dst.rows);return src.delete(),dst.delete(),srcTri.delete(),dstTri.delete(),result}function validatePadding(_ref2){var corners=_ref2.corners,width=_ref2.width,height=_ref2.height,minX=Number.MAX_SAFE_INTEGER,minY=Number.MAX_SAFE_INTEGER,maxX=Number.MIN_SAFE_INTEGER,maxY=Number.MIN_SAFE_INTEGER;corners.forEach((function(_ref3){var _ref3$location=_ref3.location,x=_ref3$location.x,y=_ref3$location.y;minX=Math.min(minX,x),minY=Math.min(minY,y),maxX=Math.max(maxX,x),maxY=Math.max(maxY,y)}));return!(minX/width<.06||minY/height<.06||(height-maxY)/height<.06||(width-maxX)/width<.06)}function validateGlare(){return _validateGlare.apply(this,arguments)}function _validateGlare(){return(_validateGlare=utils_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _ref4,canvas,_ref4$paddingPercent,paddingPercent,originalWidth,originalHeight,paddingWidth,paddingHeight,analyzedWidth,analyzedHeight,analyzedCanvas,context,_args=arguments;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _ref4=_args.length>0&&void 0!==_args[0]?_args[0]:{},canvas=_ref4.canvas,_ref4$paddingPercent=_ref4.paddingPercent,paddingPercent=void 0===_ref4$paddingPercent?.04:_ref4$paddingPercent,originalWidth=canvas.width,originalHeight=canvas.height,paddingWidth=Math.floor(originalWidth*paddingPercent),paddingHeight=Math.floor(originalHeight*paddingPercent),analyzedWidth=originalWidth-2*paddingWidth,analyzedHeight=originalHeight-2*paddingHeight,analyzedCanvas=document.createElement("canvas"),context=analyzedCanvas.getContext("2d"),analyzedCanvas.width=analyzedWidth,analyzedCanvas.height=analyzedHeight,context.drawImage(canvas,paddingWidth,paddingHeight,analyzedWidth,analyzedHeight,0,0,analyzedWidth,analyzedHeight),_context.abrupt("return",tvweb_core_esm.h.isCardGlare(analyzedCanvas));case 13:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}function validateAngles(points){for(var u,v,k,uv,uk,uvLength,ukLength,numCorners=points.length,i=0;i<numCorners;i++){var prevIdx=(i+numCorners-1)%numCorners,nextIdx=(i+1)%numCorners,angle=(u=points[i].location,v=points[prevIdx].location,k=points[nextIdx].location,uv=void 0,uk=void 0,uvLength=void 0,ukLength=void 0,uv={x:v.x-u.x,y:v.y-u.y},uk={x:k.x-u.x,y:k.y-u.y},uvLength=Math.sqrt(Math.pow(uv.x,2)+Math.pow(uv.y,2)),ukLength=Math.sqrt(Math.pow(uk.x,2)+Math.pow(uk.y,2)),180*Math.acos((uv.x*uk.x+uv.y*uk.y)/(uvLength*ukLength))/Math.PI);if(angle<70||angle>110)return!1}return!0}function validateFaces(_x){return _validateFaces.apply(this,arguments)}function _validateFaces(){return(_validateFaces=utils_asyncToGenerator(regeneratorRuntime.mark((function _callee2(_ref5){var blazefaceModel,predictedIdCardCanvas,frontSide,cardWidth,cardHeight,analyzedWidth,analyzedHeight,canvas,context,predictions,validFaces,numberOfFaces;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return blazefaceModel=_ref5.blazefaceModel,predictedIdCardCanvas=_ref5.predictedIdCardCanvas,frontSide=_ref5.frontSide,cardWidth=predictedIdCardCanvas.width,cardHeight=predictedIdCardCanvas.height,analyzedWidth=Math.floor(cardWidth/3),analyzedHeight=Math.floor(4*cardHeight/5),canvas=document.createElement("canvas"),context=canvas.getContext("2d"),canvas.width=analyzedWidth,canvas.height=analyzedHeight,context.drawImage(predictedIdCardCanvas,0,Math.floor(cardHeight/5),analyzedWidth,analyzedHeight,0,0,analyzedWidth,analyzedHeight),_context2.next=12,tvweb_core_esm.l.getModelPredictions({model:blazefaceModel,sCanvas:canvas});case 12:if(predictions=_context2.sent,validFaces=predictions.filter((function(_ref6){var topLeft=_ref6.topLeft,bottomRight=_ref6.bottomRight,probabilityScore=_slicedToArray(_ref6.probability,1)[0],landmarks=_ref6.landmarks;return!(probabilityScore<.9||landmarks.length<4)&&!(tvweb_core_esm.f.rectAreaRatio({small:{coords:[topLeft,bottomRight]},big:{coords:[[0,0],[tvweb_core_esm.l.SIZE,tvweb_core_esm.l.SIZE]]}})<.025)})),numberOfFaces=validFaces.length,!frontSide){_context2.next=22;break}if(0!==numberOfFaces){_context2.next=18;break}return _context2.abrupt("return",utils_Errors.id_detector_error_front_side_no_faces);case 18:if(!(numberOfFaces>1)){_context2.next=20;break}return _context2.abrupt("return",utils_Errors.id_detector_error_front_side_multiple_faces);case 20:_context2.next=24;break;case 22:if(!(numberOfFaces>0)){_context2.next=24;break}return _context2.abrupt("return",utils_Errors.id_detector_error_back_side_has_faces);case 24:return _context2.abrupt("return",null);case 25:case"end":return _context2.stop()}}),_callee2)})))).apply(this,arguments)}var blazeface_esm=__webpack_require__(436),clamp=(__webpack_require__(192),__webpack_require__(794),__webpack_require__(334),__webpack_require__(19),__webpack_require__(181)),clamp_default=__webpack_require__.n(clamp),tfjs_core_dist=__webpack_require__(0),tfjs_converter_dist=__webpack_require__(315);function idCardModel_slicedToArray(arr,i){return function idCardModel_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function idCardModel_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||idCardModel_unsupportedIterableToArray(arr,i)||function idCardModel_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function idCardModel_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function idCardModel_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){idCardModel_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){idCardModel_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function idCardModel_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return idCardModel_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?idCardModel_arrayLikeToArray(o,minLen):void 0}}function idCardModel_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var defaultModelUrl="https://unpkg.com/id-card-model@1.0.2/models/web_model/web_model_noquant/model.json",defaultOpencvUrl="https://unpkg.com/id-card-model-testing@1.0.5/libs/opencv.js",labelMap={0:"top-left",1:"top-right",2:"bottom-right",3:"bottom-left",4:"cccd.front",5:"passport",6:"cmnd_old.front",7:"cmnd_old.back",8:"cmnd_new.front",9:"cmnd_new.back",10:"cccd_new.front",11:"cccd_new.back"};function isQualified(_ref){var topLeft,topRight,bottomRight,bottomLeft,_step,card=_ref.card,corners=_ref.corners,box=card.box,center={x:(box[1]+box[3])/2,y:(box[0]+box[2])/2},cardHeight=box[2]-box[0],cardWidth=box[1]-box[3],_iterator=function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=idCardModel_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e3){didErr=!0,err=_e3},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(corners);try{for(_iterator.s();!(_step=_iterator.n()).done;){var corner=_step.value;switch(corner.label){case"top-left":topLeft||(topLeft=corner.location);break;case"top-right":topRight||(topRight=corner.location);break;case"bottom-right":bottomRight||(bottomRight=corner.location);break;case"bottom-left":bottomLeft||(bottomLeft=corner.location)}}}catch(err){_iterator.e(err)}finally{_iterator.f()}if(![topLeft,topRight,bottomRight,bottomLeft].every(Boolean))return console.debug("Not qualified, corners missing"),!1;var topLeftAndBottomRight={x:(topLeft.x+bottomRight.x)/2,y:(topLeft.y+bottomRight.y)/2},topRightAndBottomLeft={x:(topRight.x+bottomLeft.x)/2,y:(topRight.y+bottomLeft.y)/2},topLeftToBottomRightDistance=euclideanDistances(center,topLeftAndBottomRight),topRightToBottomLeftDistance=euclideanDistances(center,topRightAndBottomLeft);return Math.sqrt(topLeftToBottomRightDistance)>(cardHeight+cardWidth)/8||Math.sqrt(topRightToBottomLeftDistance)>(cardHeight+cardWidth)/8?(console.debug("Not qualified, not close enough"),!1):(console.debug("Qualified"),!0)}function initOpencvJs(_x){return _initOpencvJs.apply(this,arguments)}function _initOpencvJs(){return(_initOpencvJs=idCardModel_asyncToGenerator(regeneratorRuntime.mark((function _callee6(_ref2){var url;return regeneratorRuntime.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return url=_ref2.url,_context6.next=3,tvweb_core_esm.j.loadExternalScript({url:url});case 3:return _context6.abrupt("return",new Promise((function(resolve){window.cv.onRuntimeInitialized=resolve})));case 4:case"end":return _context6.stop()}}),_callee6)})))).apply(this,arguments)}var idCardModel_IDCardModel=function(){function IDCardModel(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,IDCardModel)}var _detect,_predict,_dispose,_loadModel,_load;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(IDCardModel,[{key:"load",value:(_load=idCardModel_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _ref3,_ref3$opencvUrl,opencvUrl,modelUrl,_args=arguments;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _ref3=_args.length>0&&void 0!==_args[0]?_args[0]:{},_ref3$opencvUrl=_ref3.opencvUrl,opencvUrl=void 0===_ref3$opencvUrl?defaultOpencvUrl:_ref3$opencvUrl,modelUrl=_ref3.modelUrl,_context.next=3,Promise.all([initOpencvJs({url:opencvUrl}),this.loadModel({modelUrl:modelUrl})]);case 3:case"end":return _context.stop()}}),_callee,this)}))),function load(){return _load.apply(this,arguments)})},{key:"loadModel",value:(_loadModel=idCardModel_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var _ref4,_ref4$modelUrl,modelUrl,inputDetails,outputDetails,_args2=arguments;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _ref4=_args2.length>0&&void 0!==_args2[0]?_args2[0]:{},_ref4$modelUrl=_ref4.modelUrl,modelUrl=void 0===_ref4$modelUrl?defaultModelUrl:_ref4$modelUrl,_context2.next=3,tvweb_core_esm.k.initTensorFlow();case 3:return _context2.next=5,Object(tfjs_converter_dist.a)(modelUrl);case 5:this.model=_context2.sent,inputDetails=this.model.inputs,outputDetails=this.model.outputs,this.boxesIndex=outputDetails.findIndex((function(o){return"Identity_3"===o.name})),this.classesIndex=outputDetails.findIndex((function(o){return"Identity_2"===o.name})),this.scoresIndex=outputDetails.findIndex((function(o){return"Identity_1"===o.name})),this.inputSize=[inputDetails[0].shape[1],inputDetails[0].shape[2]];case 12:case"end":return _context2.stop()}}),_callee2,this)}))),function loadModel(){return _loadModel.apply(this,arguments)})},{key:"dispose",value:(_dispose=idCardModel_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:this.model&&this.model.dispose();case 1:case"end":return _context3.stop()}}),_callee3,this)}))),function dispose(){return _dispose.apply(this,arguments)})},{key:"predict",value:(_predict=idCardModel_asyncToGenerator(regeneratorRuntime.mark((function _callee4(input){var _ref5,_ref5$imgMargin,imgMargin,_ref5$detectThreshold,detectThreshold,_ref5$maxNumReturns,maxNumReturns,imageInfo,imgOrigWidth,imgOrigHeight,_padBorders,paddedCanvas,margin,_this$inputSize,modelWidth,modelHeight,scaleW,scaleH,scaledCanvas,predictions,result,corners,cards,card,_args4=arguments;return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _ref5=_args4.length>1&&void 0!==_args4[1]?_args4[1]:{},_ref5$imgMargin=_ref5.imgMargin,imgMargin=void 0===_ref5$imgMargin?.5:_ref5$imgMargin,_ref5$detectThreshold=_ref5.detectThreshold,detectThreshold=void 0===_ref5$detectThreshold?.3:_ref5$detectThreshold,_ref5$maxNumReturns=_ref5.maxNumReturns,maxNumReturns=void 0===_ref5$maxNumReturns?100:_ref5$maxNumReturns,imageInfo={},imgOrigWidth=input.width,imgOrigHeight=input.height,imageInfo.originalWidth=imgOrigWidth,imageInfo.originalHeight=imgOrigHeight,_padBorders=padBorders({canvas:input,imgMargin:imgMargin}),paddedCanvas=_padBorders.canvas,margin=_padBorders.margin,_this$inputSize=idCardModel_slicedToArray(this.inputSize,2),modelWidth=_this$inputSize[0],modelHeight=_this$inputSize[1],scaleW=paddedCanvas.width/modelWidth,scaleH=paddedCanvas.height/modelHeight,(scaledCanvas=document.createElement("canvas")).width=modelWidth,scaledCanvas.height=modelHeight,scaledCanvas.getContext("2d").drawImage(paddedCanvas,0,0,paddedCanvas.width,paddedCanvas.height,0,0,scaledCanvas.width,scaledCanvas.height),imageInfo.canvas=scaledCanvas,imageInfo.margin=margin,_context4.next=19,this.detect(scaledCanvas,{detectThreshold:detectThreshold,maxNumReturns:maxNumReturns});case 19:if(predictions=_context4.sent,result={inputImage:imageInfo,card:null},corners=[],cards=[],predictions.forEach((function(prediction){var _prediction$box=idCardModel_slicedToArray(prediction.box,4),top=_prediction$box[0],right=_prediction$box[1],bottom=_prediction$box[2],left=_prediction$box[3];prediction.clazz<=3?corners.push({clazz:prediction.clazz,label:prediction.label,score:prediction.score,location:{x:clamp_default()(Math.floor((left+right)/2*scaleW-margin),0,imgOrigWidth),y:clamp_default()(Math.floor((top+bottom)/2*scaleH-margin),0,imgOrigHeight)},scaledLocation:{x:clamp_default()(Math.floor((left+right)/2),0,scaledCanvas.width),y:clamp_default()(Math.floor((top+bottom)/2),0,scaledCanvas.height)}}):cards.push({label:prediction.label,score:prediction.score,box:[clamp_default()(Math.floor(top*scaleH-margin),0,imgOrigHeight),clamp_default()(Math.floor(right*scaleW-margin),0,imgOrigWidth),clamp_default()(Math.floor(bottom*scaleH-margin),0,imgOrigHeight),clamp_default()(Math.floor(left*scaleW-margin),0,imgOrigWidth)]})})),corners.sort((function(c1,c2){return c2.score-c1.score})),cards.sort((function(c1,c2){return c2.score-c1.score})),!(cards.length>0)){_context4.next=35;break}if(isQualified({card:card=cards[0],corners:corners})){_context4.next=31;break}return console.debug("Not qualified.",card,corners),_context4.abrupt("return",result);case 31:return corners.sort((function(c1,c2){return c1.clazz-c2.clazz})),card.corners=corners,result.card=card,_context4.abrupt("return",result);case 35:return _context4.abrupt("return",result);case 36:case"end":return _context4.stop()}}),_callee4,this)}))),function predict(_x2){return _predict.apply(this,arguments)})},{key:"detect",value:(_detect=idCardModel_asyncToGenerator(regeneratorRuntime.mark((function _callee5(img){var _ref6,detectThreshold,maxNumReturns,imgWidth,imgHeight,imgExpanded,predictions,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,boxes,classes,scores,selectedPredictions,end,i,score,_labelMap$Math$round,clazz,label,bb,box,_args5=arguments;return regeneratorRuntime.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _ref6=_args5.length>1&&void 0!==_args5[1]?_args5[1]:{},detectThreshold=_ref6.detectThreshold,maxNumReturns=_ref6.maxNumReturns,imgWidth=img.width,imgHeight=img.height,imgExpanded=tfjs_core_dist.Od((function(){var input=img;return input instanceof tfjs_core_dist.Tc||(input=tfjs_core_dist.gd.fromPixels(input)),tfjs_core_dist.rd(tfjs_core_dist.id(input,"float32"),0)})),predictions=this.model.execute(imgExpanded),imgExpanded.dispose(),_context5.next=8,Promise.all([predictions[this.boxesIndex].array(),predictions[this.classesIndex].data(),predictions[this.scoresIndex].data()]);case 8:for(_yield$Promise$all=_context5.sent,_yield$Promise$all2=idCardModel_slicedToArray(_yield$Promise$all,3),_yield$Promise$all2$=idCardModel_slicedToArray(_yield$Promise$all2[0],1),boxes=_yield$Promise$all2$[0],classes=_yield$Promise$all2[1],scores=_yield$Promise$all2[2],console.log("boxxess",boxes,classes,scores),selectedPredictions=[],end=Math.min(scores.length,maxNumReturns),i=0;i<end;i++)(score=scores[i])>detectThreshold&&(clazz=classes[i],label=null!==(_labelMap$Math$round=labelMap[Math.round(clazz)])&&void 0!==_labelMap$Math$round?_labelMap$Math$round:"NA",bb=boxes[i],box=[bb[0]*imgHeight,bb[3]*imgWidth,bb[2]*imgHeight,bb[1]*imgWidth],selectedPredictions.push({score:score,clazz:clazz,box:box,label:label}));return _context5.abrupt("return",selectedPredictions);case 19:case"end":return _context5.stop()}}),_callee5,this)}))),function detect(_x3){return _detect.apply(this,arguments)})}]),IDCardModel}();function warmUp_slicedToArray(arr,i){return function warmUp_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function warmUp_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function warmUp_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return warmUp_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return warmUp_arrayLikeToArray(o,minLen)}(arr,i)||function warmUp_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function warmUp_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function warmUp_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function warmUp_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){warmUp_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){warmUp_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _warmUp(){return(_warmUp=warmUp_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _ref,opencvUrl,modelUrl,idCardModel,_yield$Promise$all,_yield$Promise$all2,blazefaceModel,_args=arguments;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _ref=_args.length>0&&void 0!==_args[0]?_args[0]:{},opencvUrl=_ref.opencvUrl,modelUrl=_ref.modelUrl,idCardModel=new idCardModel_IDCardModel,_context.next=4,Promise.all([blazeface_esm.a(),idCardModel.load({opencvUrl:opencvUrl,modelUrl:modelUrl})]);case 4:return _yield$Promise$all=_context.sent,_yield$Promise$all2=warmUp_slicedToArray(_yield$Promise$all,1),blazefaceModel=_yield$Promise$all2[0],_context.abrupt("return",{idCardModel:idCardModel,blazefaceModel:blazefaceModel});case 8:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}var ReadIDCard_warmUp=function warmUp(){return _warmUp.apply(this,arguments)};function useModelProcess_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function useModelProcess_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){useModelProcess_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){useModelProcess_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function useModelProcess_slicedToArray(arr,i){return function useModelProcess_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function useModelProcess_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function useModelProcess_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return useModelProcess_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return useModelProcess_arrayLikeToArray(o,minLen)}(arr,i)||function useModelProcess_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useModelProcess_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var useModelProcess_Errors=tvweb_core_esm.e.Errors;var ReadIDCard_useModelProcess=function useModelProcess(_ref){var resultWarmup=_ref.resultWarmup,refVideo=_ref.refVideo,videoPlayed=_ref.videoPlayed,cropArea=_ref.cropArea,apiSettings=_ref.apiSettings,onError=_ref.onError,frontSide=_ref.frontSide,onAutoCaptureSuccess=_ref.onAutoCaptureSuccess,refWorkingCanvas=Object(react.useRef)(null),refCheckFrameIsRunning=Object(react.useRef)(!1),refResultAnalyzeVideoAndWindowSizes=Object(react.useRef)(null),refIdCardModel=Object(react.useRef)(null),refBlazefaceModel=Object(react.useRef)(null),_useState2=useModelProcess_slicedToArray(Object(react.useState)(!1),2),warmupDone=_useState2[0],setWarmupDone=_useState2[1],refAutoCaptureResult=Object(react.useRef)({imageBlob:null,takenAt:null,blurScore:null}),refManualCaptureResult=Object(react.useRef)({imageBlob:null,blurScore:null,error:null}),refIsTakingPictureManually=Object(react.useRef)(!1);Object(react.useEffect)((function(){function _runWarmup(){return(_runWarmup=useModelProcess_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var newResultWarmup;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(warmupDone){_context.next=9;break}if(newResultWarmup=resultWarmup){_context.next=6;break}return _context.next=5,ReadIDCard_warmUp();case 5:newResultWarmup=_context.sent;case 6:refIdCardModel.current=newResultWarmup.idCardModel,refBlazefaceModel.current=newResultWarmup.blazefaceModel,setWarmupDone(!0);case 9:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}!function runWarmup(){return _runWarmup.apply(this,arguments)}()}),[resultWarmup,warmupDone]);var stopCheckFrame=Object(react.useCallback)((function(){!0===refCheckFrameIsRunning.current&&(refCheckFrameIsRunning.current=!1)}),[]),autoCapture=Object(react.useCallback)(function(){var _ref3=useModelProcess_asyncToGenerator(regeneratorRuntime.mark((function _callee2(_ref2){var blurScore,blurThreshold,autoCaptureResult;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(blurScore=_ref2.blurScore,blurThreshold=apiSettings.blurThreshold,autoCaptureResult=refAutoCaptureResult.current,!(blurScore>blurThreshold&&tvweb_core_esm.c.hasBetterBlurScore(blurScore,autoCaptureResult.blurScore))){_context2.next=9;break}return _context2.next=6,tvweb_core_esm.d.takePicture({canvas:refWorkingCanvas.current});case 6:autoCaptureResult.imageBlob=_context2.sent,autoCaptureResult.takenAt=(new Date).getTime(),autoCaptureResult.blurScore=blurScore;case 9:case"end":return _context2.stop()}}),_callee2)})));return function(_x){return _ref3.apply(this,arguments)}}(),[apiSettings]),manualCapture=Object(react.useCallback)(function(){var _ref5=useModelProcess_asyncToGenerator(regeneratorRuntime.mark((function _callee3(_ref4){var blurScore,manualCaptureResult;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(blurScore=_ref4.blurScore,manualCaptureResult=refManualCaptureResult.current,!tvweb_core_esm.c.hasBetterBlurScore(blurScore,manualCaptureResult.blurScore)){_context3.next=7;break}return _context3.next=5,tvweb_core_esm.d.takePicture({canvas:refWorkingCanvas.current});case 5:manualCaptureResult.imageBlob=_context3.sent,manualCaptureResult.blurScore=blurScore;case 7:case"end":return _context3.stop()}}),_callee3)})));return function(_x2){return _ref5.apply(this,arguments)}}(),[]),validateAutoCaptureResult=Object(react.useCallback)(useModelProcess_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){var waitForBestImageTimeMs,autoCaptureResult;return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(waitForBestImageTimeMs=apiSettings.waitForBestImageTimeMs,null===(autoCaptureResult=refAutoCaptureResult.current).imageBlob){_context4.next=8;break}if(!((new Date).getTime()-autoCaptureResult.takenAt>waitForBestImageTimeMs)){_context4.next=8;break}return _context4.next=7,onAutoCaptureSuccess(autoCaptureResult);case 7:stopCheckFrame();case 8:case"end":return _context4.stop()}}),_callee4)}))),[onAutoCaptureSuccess,apiSettings,stopCheckFrame]),takePictureManually=Object(react.useCallback)(useModelProcess_asyncToGenerator(regeneratorRuntime.mark((function _callee5(){return regeneratorRuntime.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.abrupt("return",new Promise((function(resolve){var enableBlurCheck=apiSettings.enableBlurCheck,blurThreshold=apiSettings.blurThreshold,manualCaptureResult=refManualCaptureResult.current;enableBlurCheck?(refIsTakingPictureManually.current=!0,setTimeout((function(){refIsTakingPictureManually.current=!1,tvweb_core_esm.c.hasBetterBlurScore(manualCaptureResult.blurScore,blurThreshold)||(manualCaptureResult.error=useModelProcess_Errors.id_detector_error_blur),resolve(manualCaptureResult)}),3e3)):tvweb_core_esm.d.takePicture({canvas:refWorkingCanvas.current}).then((function(blob){manualCaptureResult.imageBlob=blob,resolve(manualCaptureResult)}))})));case 1:case"end":return _context5.stop()}}),_callee5)}))),[apiSettings]),checkFrame=Object(react.useCallback)(useModelProcess_asyncToGenerator(regeneratorRuntime.mark((function _callee6(){var enableAutoCapture,enableBlurCheck,idCardModel,blazefaceModel,resultAnalyzeVideoAndWindowSizes,videoEl,workingCanvas,context,cropX,cropY,cropWidth,cropHeight,predictedIdCardCanvas,predictedIdCardCanvasContext,error,result,imageData,areaRatio,blurScore;return regeneratorRuntime.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(apiSettings&&warmupDone){_context6.next=2;break}return _context6.abrupt("return");case 2:refAutoCaptureResult.current={imageBlob:null,takenAt:null,blurScore:null},refManualCaptureResult.current={imageBlob:null,blurScore:null,error:null},enableAutoCapture=apiSettings.enableAutoCapture,enableBlurCheck=apiSettings.enableBlurCheck,idCardModel=refIdCardModel.current,blazefaceModel=refBlazefaceModel.current,resultAnalyzeVideoAndWindowSizes=refResultAnalyzeVideoAndWindowSizes.current,videoEl=refVideo.current,refCheckFrameIsRunning.current=!0,workingCanvas=refWorkingCanvas.current,context=workingCanvas.getContext("2d"),cropX=resultAnalyzeVideoAndWindowSizes.cropX,cropY=resultAnalyzeVideoAndWindowSizes.cropY,cropWidth=resultAnalyzeVideoAndWindowSizes.cropWidth,cropHeight=resultAnalyzeVideoAndWindowSizes.cropHeight,predictedIdCardCanvas=document.createElement("canvas"),predictedIdCardCanvasContext=predictedIdCardCanvas.getContext("2d");case 15:return context.drawImage(videoEl,cropX,cropY,cropWidth,cropHeight,0,0,cropWidth,cropHeight),error=null,_context6.next=20,idCardModel.predict(workingCanvas,{detectThreshold:.3});case 20:if(result=_context6.sent,console.log("result",result),!result.card){_context6.next=69;break}if(!validatePadding({corners:result.card.corners,width:cropWidth,height:cropHeight})){_context6.next=66;break}if(!validateAngles(result.card.corners)){_context6.next=63;break}if(imageData=fourPointTransform(workingCanvas,result.card.corners),!((areaRatio=tvweb_core_esm.f.rectAreaRatio({small:{area:imageData.width*imageData.height},big:{area:cropWidth*cropHeight}}))<.5)){_context6.next=33;break}error=useModelProcess_Errors.id_detector_card_too_small,_context6.next=61;break;case 33:if(!(areaRatio>.8)){_context6.next=37;break}error=useModelProcess_Errors.id_detector_error_incomplete,_context6.next=61;break;case 37:return predictedIdCardCanvas.width=imageData.width,predictedIdCardCanvas.height=imageData.height,predictedIdCardCanvasContext.putImageData(imageData,0,0),_context6.next=42,validateGlare({canvas:predictedIdCardCanvas});case 42:if(!_context6.sent){_context6.next=47;break}error=useModelProcess_Errors.glare_detected,_context6.next=61;break;case 47:return _context6.next=49,validateFaces({blazefaceModel:blazefaceModel,predictedIdCardCanvas:predictedIdCardCanvas,frontSide:frontSide});case 49:if(error=_context6.sent){_context6.next=61;break}if(!enableBlurCheck){_context6.next=61;break}return _context6.next=54,tvweb_core_esm.c.calculateBlurScore(predictedIdCardCanvas);case 54:if(blurScore=_context6.sent,!enableAutoCapture){_context6.next=58;break}return _context6.next=58,autoCapture({blurScore:blurScore});case 58:if(!refIsTakingPictureManually.current){_context6.next=61;break}return _context6.next=61,manualCapture({blurScore:blurScore});case 61:_context6.next=64;break;case 63:error=useModelProcess_Errors.id_detector_validate_angle_error;case 64:_context6.next=67;break;case 66:error=useModelProcess_Errors.id_detector_error_incomplete;case 67:_context6.next=70;break;case 69:error=useModelProcess_Errors.id_detector_no_cards;case 70:return onError(error),_context6.next=73,validateAutoCaptureResult();case 73:if(refCheckFrameIsRunning.current){_context6.next=75;break}return _context6.abrupt("break",79);case 75:return _context6.next=77,tvweb_core_esm.b.sleep(15);case 77:_context6.next=15;break;case 79:case"end":return _context6.stop()}}),_callee6)}))),[refVideo,apiSettings,warmupDone,frontSide,onError,autoCapture,manualCapture,validateAutoCaptureResult]);return Object(react.useEffect)((function(){var videoEl=refVideo.current;function _triggerCheckFrame(){return(_triggerCheckFrame=useModelProcess_asyncToGenerator(regeneratorRuntime.mark((function _callee7(){var resultAnalyzeVideoAndWindowSizes,cropWidth,cropHeight,workingCanvas;return regeneratorRuntime.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return resultAnalyzeVideoAndWindowSizes=tvweb_core_esm.d.analyzeVideoAndWindowSizes(videoEl,cropArea,.05),cropWidth=resultAnalyzeVideoAndWindowSizes.cropWidth,cropHeight=resultAnalyzeVideoAndWindowSizes.cropHeight,refResultAnalyzeVideoAndWindowSizes.current=resultAnalyzeVideoAndWindowSizes,(workingCanvas=document.createElement("canvas")).width=cropWidth,workingCanvas.height=cropHeight,refWorkingCanvas.current=workingCanvas,_context7.next=9,checkFrame();case 9:case"end":return _context7.stop()}}),_callee7)})))).apply(this,arguments)}return videoPlayed&&cropArea&&warmupDone&&function triggerCheckFrame(){return _triggerCheckFrame.apply(this,arguments)}(),function(){stopCheckFrame()}}),[videoPlayed,cropArea,refVideo,stopCheckFrame,checkFrame,warmupDone]),{refWorkingCanvas:refWorkingCanvas,stopCheckFrame:stopCheckFrame,checkFrame:checkFrame,warmupDone:warmupDone,takePictureManually:takePictureManually}};__webpack_require__(47),__webpack_require__(108);function useRecordingProcess_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function useRecordingProcess_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){useRecordingProcess_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){useRecordingProcess_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}var ReadIDCard_useRecordingProcess=function useRecordingProcess(_ref){var refVideo=_ref.refVideo,videoPlayed=_ref.videoPlayed,cropArea=_ref.cropArea,apiSettings=_ref.apiSettings,refWorkingCanvas=Object(react.useRef)(null),refCheckFrameIsRunning=Object(react.useRef)(!1),refRecordedVideos=Object(react.useRef)([{id:null,frames:[]}]),refResizer=Object(react.useRef)(tvweb_core_esm.i.createResizer({width:960,height:640})),refResultAnalyzeVideoAndWindowSizes=Object(react.useRef)(null),stopCheckFrame=Object(react.useCallback)((function(){!0===refCheckFrameIsRunning.current&&(refCheckFrameIsRunning.current=!1)}),[]),resetRecordedVideos=Object(react.useCallback)((function(){refRecordedVideos.current=[{id:null,frames:[]}]}),[]),splitVideos=Object(react.useCallback)((function(){var recordedVideos=refRecordedVideos.current;recordedVideos[recordedVideos.length-1].frames.length>0&&recordedVideos.push({id:null,frames:[]})}),[]),saveFrame=Object(react.useCallback)(function(){var _ref3=useRecordingProcess_asyncToGenerator(regeneratorRuntime.mark((function _callee(_ref2){var workingCanvas,resizer,recordedVideos,resizedCanvas,base64;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:workingCanvas=_ref2.workingCanvas,resizer=refResizer.current,recordedVideos=refRecordedVideos.current,resizedCanvas=resizer.resize({srcCanvas:workingCanvas}),base64=resizedCanvas.toDataURL("image/jpeg",apiSettings.saveFrameQuality/100).split(",")[1],recordedVideos[recordedVideos.length-1].frames.push({base64:base64});case 7:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref3.apply(this,arguments)}}(),[apiSettings]),checkFrame=Object(react.useCallback)(useRecordingProcess_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var frameCaptureIntervalMs,resultAnalyzeVideoAndWindowSizes,videoEl,workingCanvas,context,cropX,cropY,cropWidth,cropHeight,lastFrameSavedAt,curTime;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(apiSettings){_context2.next=2;break}return _context2.abrupt("return");case 2:if(frameCaptureIntervalMs=apiSettings.frameCaptureIntervalMs,apiSettings.enableRecording){_context2.next=5;break}return _context2.abrupt("return");case 5:resultAnalyzeVideoAndWindowSizes=refResultAnalyzeVideoAndWindowSizes.current,videoEl=refVideo.current,refCheckFrameIsRunning.current=!0,workingCanvas=refWorkingCanvas.current,context=workingCanvas.getContext("2d"),cropX=resultAnalyzeVideoAndWindowSizes.cropX,cropY=resultAnalyzeVideoAndWindowSizes.cropY,cropWidth=resultAnalyzeVideoAndWindowSizes.cropWidth,cropHeight=resultAnalyzeVideoAndWindowSizes.cropHeight,lastFrameSavedAt=null;case 12:if(context.drawImage(videoEl,cropX,cropY,cropWidth,cropHeight,0,0,cropWidth,cropHeight),!frameCaptureIntervalMs){_context2.next=23;break}if(curTime=(new Date).getTime(),!(curTime-lastFrameSavedAt>=frameCaptureIntervalMs)){_context2.next=21;break}return _context2.next=20,saveFrame({workingCanvas:workingCanvas});case 20:lastFrameSavedAt=curTime;case 21:_context2.next=25;break;case 23:return _context2.next=25,saveFrame({workingCanvas:workingCanvas});case 25:if(refCheckFrameIsRunning.current){_context2.next=27;break}return _context2.abrupt("break",31);case 27:return _context2.next=29,tvweb_core_esm.b.sleep(15);case 29:_context2.next=12;break;case 31:case"end":return _context2.stop()}}),_callee2)}))),[refVideo,saveFrame,apiSettings]);return Object(react.useEffect)((function(){var videoEl=refVideo.current;function _triggerCheckFrame(){return(_triggerCheckFrame=useRecordingProcess_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var resultAnalyzeVideoAndWindowSizes,cropWidth,cropHeight,workingCanvas;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return resultAnalyzeVideoAndWindowSizes=tvweb_core_esm.d.analyzeVideoAndWindowSizes(videoEl,cropArea),cropWidth=resultAnalyzeVideoAndWindowSizes.cropWidth,cropHeight=resultAnalyzeVideoAndWindowSizes.cropHeight,refResultAnalyzeVideoAndWindowSizes.current=resultAnalyzeVideoAndWindowSizes,(workingCanvas=document.createElement("canvas")).width=cropWidth,workingCanvas.height=cropHeight,refWorkingCanvas.current=workingCanvas,_context3.next=9,checkFrame();case 9:case"end":return _context3.stop()}}),_callee3)})))).apply(this,arguments)}return videoPlayed&&cropArea&&function triggerCheckFrame(){return _triggerCheckFrame.apply(this,arguments)}(),function(){stopCheckFrame()}}),[videoPlayed,cropArea,refVideo,stopCheckFrame,splitVideos,checkFrame]),{refWorkingCanvas:refWorkingCanvas,stopCheckFrame:stopCheckFrame,refRecordedVideos:refRecordedVideos,splitVideos:splitVideos,resetRecordedVideos:resetRecordedVideos,checkFrame:checkFrame}},Popup=__webpack_require__(316),RectangleMask=__webpack_require__(166),styled_components_browser_esm=(__webpack_require__(21),__webpack_require__(37),__webpack_require__(39),__webpack_require__(10));function _templateObject3(){var data=_taggedTemplateLiteral(["\n  .flipY-exit {\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ease-in;\n  }\n\n  .flipY-enter {\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ease-out;\n  }\n"]);return _templateObject3=function _templateObject3(){return data},data}function _templateObject2(){var data=_taggedTemplateLiteral(["\n  from {\n    transform: perspective(400px) rotateY(-90deg);\n  }\n  to {\n    transform: perspective(400px);\n  }\n"]);return _templateObject2=function _templateObject2(){return data},data}function _templateObject(){var data=_taggedTemplateLiteral(["\n  from {\n    transform: perspective(400px);\n  }\n  to {\n    transform: perspective(400px) rotateY(90deg);\n  }\n"]);return _templateObject=function _templateObject(){return data},data}function _taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var animationDuration=500,flipOutY=Object(styled_components_browser_esm.d)(_templateObject()),flipInY=Object(styled_components_browser_esm.d)(_templateObject2()),flipY=Object(styled_components_browser_esm.b)(_templateObject3(),flipOutY,animationDuration,flipInY,animationDuration);function slide_templateObject3(){var data=slide_taggedTemplateLiteral(["\n  .slide-horizontal {\n    animation-name: ",";\n    animation-iteration-count: infinite;\n    animation-duration: 2000ms;\n    animation-timing-function: linear;\n  }\n  .slide-vertical {\n    animation-name: ",";\n    animation-iteration-count: infinite;\n    animation-duration: 2000ms;\n    animation-timing-function: linear;\n  }\n"]);return slide_templateObject3=function _templateObject3(){return data},data}function slide_templateObject2(){var data=slide_taggedTemplateLiteral(["\n  from, to {\n    transform: translate3d(0, -","px, 0);\n  }\n  50% {\n    transform: translate3d(0, ","px, 0);\n  }\n"]);return slide_templateObject2=function _templateObject2(){return data},data}function slide_templateObject(){var data=slide_taggedTemplateLiteral(["\n  from, to {\n    transform: translate3d(-","px, 0, 0);\n  }\n  50% {\n    transform: translate3d(","px, 0, 0);\n  }\n"]);return slide_templateObject=function _templateObject(){return data},data}function slide_taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var slideHorizontal=Object(styled_components_browser_esm.d)(slide_templateObject(),20,20),slideVertical=Object(styled_components_browser_esm.d)(slide_templateObject2(),20,20);Object(styled_components_browser_esm.b)(slide_templateObject3(),slideHorizontal,slideVertical);function blink_templateObject2(){var data=blink_taggedTemplateLiteral(["\n  .blink {\n    animation-name: ",";\n    animation-iteration-count: infinite;\n    animation-duration: 2000ms;\n    animation-timing-function: linear;\n  }\n"]);return blink_templateObject2=function _templateObject2(){return data},data}function blink_templateObject(){var data=blink_taggedTemplateLiteral(["\n  from,\n  to {\n    opacity: 1;\n  }\n\n  50% {\n    opacity: 0;\n  }\n"]);return blink_templateObject=function _templateObject(){return data},data}function blink_taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var blink=Object(styled_components_browser_esm.d)(blink_templateObject());Object(styled_components_browser_esm.b)(blink_templateObject2(),blink);function _templateObject4(){var data=splash_taggedTemplateLiteral(["\n  ","\n"]);return _templateObject4=function _templateObject4(){return data},data}function splash_templateObject3(){var data=splash_taggedTemplateLiteral(["\n  .splash-enter {\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ease-in;\n  }\n"]);return splash_templateObject3=function _templateObject3(){return data},data}function splash_templateObject2(){var data=splash_taggedTemplateLiteral(["\n  from {\n    background: #000;\n  }\n  to {\n  }\n"]);return splash_templateObject2=function _templateObject2(){return data},data}function splash_templateObject(){var data=splash_taggedTemplateLiteral(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: ","; // must be higher than BASE_Z_INDEX and lower than other layers\n"]);return splash_templateObject=function _templateObject(){return data},data}function splash_taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var Overlay=styled_components_browser_esm.c.div(splash_templateObject(),Camera.a+1),splash=Object(styled_components_browser_esm.d)(splash_templateObject2()),splash_animation=Object(styled_components_browser_esm.b)(splash_templateObject3(),splash,300),Wrapper=styled_components_browser_esm.c.div(_templateObject4(),splash_animation),splash_SplashAnimation=function SplashAnimation(_ref){var _ref$keyForTransition=_ref.keyForTransition,keyForTransition=void 0===_ref$keyForTransition?0:_ref$keyForTransition;return Object(jsx_runtime.jsx)(Wrapper,{children:Object(jsx_runtime.jsx)(SwitchTransition.a,{children:Object(jsx_runtime.jsx)(CSSTransition.a,{timeout:{enter:300,exit:0},classNames:"splash",unmountOnExit:!1,children:Object(jsx_runtime.jsx)(Overlay,{})},keyForTransition)})})};splash_SplashAnimation.displayName="SplashAnimation",splash_SplashAnimation.__docgenInfo={description:"",methods:[],displayName:"SplashAnimation",props:{keyForTransition:{defaultValue:{value:"0",computed:!1},required:!1}}};var Animations_splash=splash_SplashAnimation;function spin_templateObject2(){var data=spin_taggedTemplateLiteral(["\n  .spin {\n    animation-name: ",";\n    animation-iteration-count: infinite;\n    animation-duration: 1000ms;\n    animation-timing-function: linear;\n  }\n"]);return spin_templateObject2=function _templateObject2(){return data},data}function spin_templateObject(){var data=spin_taggedTemplateLiteral(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]);return spin_templateObject=function _templateObject(){return data},data}function spin_taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/Animations/splash.js"]={name:"SplashAnimation",docgenInfo:splash_SplashAnimation.__docgenInfo,path:"packages/tvweb-ui/src/Animations/splash.js"});var spin=Object(styled_components_browser_esm.d)(spin_templateObject()),Animations_spin=Object(styled_components_browser_esm.b)(spin_templateObject2(),spin);function _templateObject13(){var data=components_taggedTemplateLiteral(["\n  position: absolute;\n  top: 0;\n  left: 0;\n"]);return _templateObject13=function _templateObject13(){return data},data}function _templateObject12(){var data=components_taggedTemplateLiteral(["\n  font-size: 18px;\n  text-align: center;\n  padding: 10px;\n"]);return _templateObject12=function _templateObject12(){return data},data}function _templateObject11(){var data=components_taggedTemplateLiteral(["\n  position: absolute;\n  font-size: 18px;\n  text-align: center;\n  border-radius: 3px;\n  padding: 5px 10px;\n  background: #ea3223;\n  color: #fff;\n  margin: 0 10px;\n  top: ",";\n  z-index: ",";\n"]);return _templateObject11=function _templateObject11(){return data},data}function _templateObject10(){var data=components_taggedTemplateLiteral(["\n  background: #ea3223;\n  padding: 5px 10px;\n  border-radius: 3px;\n"]);return _templateObject10=function _templateObject10(){return data},data}function _templateObject9(){var data=components_taggedTemplateLiteral(["\n  position: absolute;\n  font-size: 16px;\n  text-align: center;\n  color: #fff;\n  top: ",";\n  z-index: ",";\n"]);return _templateObject9=function _templateObject9(){return data},data}function _templateObject8(){var data=components_taggedTemplateLiteral(["\n  font-size: 20px;\n  margin-left: 10px;\n  color: green;\n  position: absolute;\n  left: 0;\n  top: 10px;\n  background: white;\n  z-index: ",";\n"]);return _templateObject8=function _templateObject8(){return data},data}function _templateObject7(){var data=components_taggedTemplateLiteral(["\n  font-size: 20px;\n  margin-left: 10px;\n  color: #fff;\n"]);return _templateObject7=function _templateObject7(){return data},data}function _templateObject6(){var data=components_taggedTemplateLiteral(["\n  display: flex;\n  align-items: center;\n"]);return _templateObject6=function _templateObject6(){return data},data}function _templateObject5(){var data=components_taggedTemplateLiteral(["\n  transform: translateZ(1000px); // to fix rotating bug on safari\n  transform-style: preserve-3d;\n  position: absolute;\n  top: ",";\n  z-index: ",";\n"]);return _templateObject5=function _templateObject5(){return data},data}function components_templateObject4(){var data=components_taggedTemplateLiteral(["\n  color: #fff;\n  text-align: center;\n"]);return components_templateObject4=function _templateObject4(){return data},data}function components_templateObject3(){var data=components_taggedTemplateLiteral(["\n  cursor: pointer;\n  text-align: center;\n  width: ","px;\n\n  img {\n    width: 100%;\n  }\n\n  z-index: ",";\n  position: fixed;\n  bottom: ","px;\n"]);return components_templateObject3=function _templateObject3(){return data},data}function components_templateObject2(){var data=components_taggedTemplateLiteral(["\n  border-radius: 5px;\n  opacity: 0.7;\n  height: 38px;\n"]);return components_templateObject2=function _templateObject2(){return data},data}function components_templateObject(){var data=components_taggedTemplateLiteral(["\n  ","\n  ","\n"]);return components_templateObject=function _templateObject(){return data},data}function components_taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var components_animationDuration=flipY_namespaceObject.animationDuration,components_SplashAnimation=splash_namespaceObject.default,components_Wrapper=styled_components_browser_esm.c.div(components_templateObject(),flipY_namespaceObject.default,spin_namespaceObject.default),IconImage=styled_components_browser_esm.c.img(components_templateObject2()),Button=styled_components_browser_esm.c.div(components_templateObject3(),60,Camera.a+20,10),Text=styled_components_browser_esm.c.div(components_templateObject4()),RotateAnimationWrapper=styled_components_browser_esm.c.div(_templateObject5(),(function(props){return props.y}),Camera.a+20),TitleWrapper=styled_components_browser_esm.c.div(_templateObject6()),Title=Object(styled_components_browser_esm.c)(Text)(_templateObject7()),DebugInfo=Object(styled_components_browser_esm.c)(Text)(_templateObject8(),Camera.a+30),Description=Object(styled_components_browser_esm.c)(Text)(_templateObject9(),(function(props){return props.y}),Camera.a+20),ErrorMessage=Object(styled_components_browser_esm.c)(Description)(_templateObject10()),Message=Object(styled_components_browser_esm.c)(Text)(_templateObject11(),(function(props){return props.y}),Camera.a+20),InfoMessage=styled_components_browser_esm.c.div(_templateObject12()),WorkingCanvasFrame=Object(styled_components_browser_esm.c)(RectangleMask.b)(_templateObject13()),Label={BTN_OK:{en:"OK",vi:"Tôi đã hiểu"},FRONT:{en:"front",vi:"trước"},BACK:{en:"back",vi:"sau"},BTN_USE_THIS_PICTURE:{en:"Use this picture",vi:"Dùng ảnh này"},BTN_TRY_AGAIN:{en:"Try again",vi:"Thử lại"}},constants_Message={WARMUP_INTRO:{en:"Warming up... Please wait a moment",vi:"Đang khởi động, vui lòng chờ trong giây lát..."}};function SessionTimeoutPopupContent_templateObject3(){var data=SessionTimeoutPopupContent_taggedTemplateLiteral(["\n  margin-top: 20px;\n  width: 100%;\n  max-width: 160px;\n  height: 50px;\n  background-color: #007bff;\n  border: 0;\n  outline: none;\n  border-radius: 0.25rem;\n  color: #fff;\n  font-weight: 400;\n  cursor: pointer;\n  font-size: 1rem;\n"]);return SessionTimeoutPopupContent_templateObject3=function _templateObject3(){return data},data}function SessionTimeoutPopupContent_templateObject2(){var data=SessionTimeoutPopupContent_taggedTemplateLiteral(["\n  text-align: center;\n  font-size: 1rem;\n"]);return SessionTimeoutPopupContent_templateObject2=function _templateObject2(){return data},data}function SessionTimeoutPopupContent_templateObject(){var data=SessionTimeoutPopupContent_taggedTemplateLiteral(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  padding: 10px;\n"]);return SessionTimeoutPopupContent_templateObject=function _templateObject(){return data},data}function SessionTimeoutPopupContent_taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var IDCardMessage=tvweb_core_esm.e.IDCardMessage,SessionTimeoutPopupContent_Wrapper=styled_components_browser_esm.c.div(SessionTimeoutPopupContent_templateObject()),MessageContent=styled_components_browser_esm.c.div(SessionTimeoutPopupContent_templateObject2()),SessionTimeoutPopupContent_Button=styled_components_browser_esm.c.button(SessionTimeoutPopupContent_templateObject3()),SessionTimeoutPopupContent_SessionTimeoutPopupContent=function SessionTimeoutPopupContent(_ref){var onOk=_ref.onOk,maxSessionTime=_ref.maxSessionTime,lang=tvweb_core_esm.m.useSDKSettings().lang;return Object(jsx_runtime.jsxs)(SessionTimeoutPopupContent_Wrapper,{children:[Object(jsx_runtime.jsx)(MessageContent,{className:"popup-message",children:template_default()(IDCardMessage.TIMEOUT_INSTRUCTION[lang])({x:maxSessionTime})}),Object(jsx_runtime.jsx)(SessionTimeoutPopupContent_Button,{className:"popup-button",onClick:onOk,children:Label.BTN_OK[lang]})]})};SessionTimeoutPopupContent_SessionTimeoutPopupContent.displayName="SessionTimeoutPopupContent",SessionTimeoutPopupContent_SessionTimeoutPopupContent.propTypes={onOk:prop_types_default.a.func,maxSessionTime:prop_types_default.a.number},SessionTimeoutPopupContent_SessionTimeoutPopupContent.defaultProps={onOk:function onOk(){},maxSessionTime:30},SessionTimeoutPopupContent_SessionTimeoutPopupContent.__docgenInfo={description:"",methods:[],displayName:"SessionTimeoutPopupContent",props:{onOk:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""},maxSessionTime:{defaultValue:{value:"30",computed:!1},type:{name:"number"},required:!1,description:""}}};var components_SessionTimeoutPopupContent=SessionTimeoutPopupContent_SessionTimeoutPopupContent;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ReadIDCard/components/SessionTimeoutPopupContent.js"]={name:"SessionTimeoutPopupContent",docgenInfo:SessionTimeoutPopupContent_SessionTimeoutPopupContent.__docgenInfo,path:"packages/tvweb-ui/src/ReadIDCard/components/SessionTimeoutPopupContent.js"});__webpack_require__(194);function ConfirmPopupContent_slicedToArray(arr,i){return function ConfirmPopupContent_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function ConfirmPopupContent_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function ConfirmPopupContent_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return ConfirmPopupContent_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ConfirmPopupContent_arrayLikeToArray(o,minLen)}(arr,i)||function ConfirmPopupContent_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ConfirmPopupContent_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ConfirmPopupContent_templateObject5(){var data=ConfirmPopupContent_taggedTemplateLiteral(["\n  margin: 20px 0;\n  width: 100%;\n  display: flex;\n  justify-content: space-evenly;\n"]);return ConfirmPopupContent_templateObject5=function _templateObject5(){return data},data}function ConfirmPopupContent_templateObject4(){var data=ConfirmPopupContent_taggedTemplateLiteral(["\n  width: 100%;\n  border-radius: 5px;\n"]);return ConfirmPopupContent_templateObject4=function _templateObject4(){return data},data}function ConfirmPopupContent_templateObject3(){var data=ConfirmPopupContent_taggedTemplateLiteral(["\n  margin-top: 20px;\n  width: 100%;\n  max-width: 160px;\n  height: 50px;\n  background-color: #007bff;\n  border: 0;\n  outline: none;\n  border-radius: 0.25rem;\n  color: #fff;\n  font-weight: 400;\n  cursor: pointer;\n  font-size: 1rem;\n"]);return ConfirmPopupContent_templateObject3=function _templateObject3(){return data},data}function ConfirmPopupContent_templateObject2(){var data=ConfirmPopupContent_taggedTemplateLiteral(["\n  text-align: center;\n  font-size: 1rem;\n  color: #ea3223;\n  margin-top: 10px;\n"]);return ConfirmPopupContent_templateObject2=function _templateObject2(){return data},data}function ConfirmPopupContent_templateObject(){var data=ConfirmPopupContent_taggedTemplateLiteral(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  padding: 10px;\n"]);return ConfirmPopupContent_templateObject=function _templateObject(){return data},data}function ConfirmPopupContent_taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var ConfirmPopupContent_Wrapper=styled_components_browser_esm.c.div(ConfirmPopupContent_templateObject()),ConfirmPopupContent_ErrorMessage=styled_components_browser_esm.c.div(ConfirmPopupContent_templateObject2()),ConfirmPopupContent_Button=styled_components_browser_esm.c.button(ConfirmPopupContent_templateObject3()),Image=styled_components_browser_esm.c.img(ConfirmPopupContent_templateObject4()),ButtonWrapper=styled_components_browser_esm.c.div(ConfirmPopupContent_templateObject5()),ConfirmPopupContent_ConfirmPopupContent=function ConfirmPopupContent(_ref){var imageBlobTaken=_ref.imageBlobTaken,onConfirm=_ref.onConfirm,onTryAgain=_ref.onTryAgain,error=_ref.error,_useState2=ConfirmPopupContent_slicedToArray(Object(react.useState)(null),2),imgObjUrl=_useState2[0],setImgObjUrl=_useState2[1],lang=tvweb_core_esm.m.useSDKSettings().lang;return Object(react.useEffect)((function(){var objUrl;return imageBlobTaken&&(objUrl=URL.createObjectURL(imageBlobTaken),setImgObjUrl(objUrl)),function(){URL.revokeObjectURL(objUrl)}}),[imageBlobTaken]),Object(jsx_runtime.jsxs)(ConfirmPopupContent_Wrapper,{children:[Object(jsx_runtime.jsx)(Image,{src:imgObjUrl}),error&&Object(jsx_runtime.jsx)(ConfirmPopupContent_ErrorMessage,{className:"confirm-popup-error-message",children:error.msg[lang]}),Object(jsx_runtime.jsxs)(ButtonWrapper,{children:[Object(jsx_runtime.jsx)(ConfirmPopupContent_Button,{onClick:onConfirm,children:Label.BTN_USE_THIS_PICTURE[lang]}),Object(jsx_runtime.jsx)(ConfirmPopupContent_Button,{onClick:onTryAgain,children:Label.BTN_TRY_AGAIN[lang]})]})]})};ConfirmPopupContent_ConfirmPopupContent.displayName="ConfirmPopupContent",ConfirmPopupContent_ConfirmPopupContent.propTypes={imageBlobTaken:prop_types_default.a.shape({}),error:prop_types_default.a.shape({msg:prop_types_default.a.shape({})}),onConfirm:prop_types_default.a.func,onTryAgain:prop_types_default.a.func},ConfirmPopupContent_ConfirmPopupContent.defaultProps={imageBlobTaken:{},error:null,onConfirm:function onConfirm(){},onTryAgain:function onTryAgain(){}},ConfirmPopupContent_ConfirmPopupContent.__docgenInfo={description:"",methods:[],displayName:"ConfirmPopupContent",props:{imageBlobTaken:{defaultValue:{value:"{}",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},error:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{msg:{name:"shape",value:{},required:!1}}},required:!1,description:""},onConfirm:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""},onTryAgain:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""}}};var components_ConfirmPopupContent=ConfirmPopupContent_ConfirmPopupContent;function useRecordingTime_slicedToArray(arr,i){return function useRecordingTime_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function useRecordingTime_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function useRecordingTime_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return useRecordingTime_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return useRecordingTime_arrayLikeToArray(o,minLen)}(arr,i)||function useRecordingTime_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useRecordingTime_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ReadIDCard/components/ConfirmPopupContent.js"]={name:"ConfirmPopupContent",docgenInfo:ConfirmPopupContent_ConfirmPopupContent.__docgenInfo,path:"packages/tvweb-ui/src/ReadIDCard/components/ConfirmPopupContent.js"});var ReadIDCard_useDebug=function useDebug(_ref){var debug=_ref.debug,refRecordedVideos=_ref.refRecordedVideos,refWorkingCanvas=_ref.refWorkingCanvas,refVideo=_ref.refVideo,onChange=_ref.onChange;Object(react.useEffect)((function(){var interval;return debug&&(interval=setInterval((function(){var video=refVideo.current,recordedVideos=refRecordedVideos.current,workingCanvas=refWorkingCanvas.current,lastRecordedVideo=recordedVideos[recordedVideos.length-1],data={videoWidth:video.videoWidth,videoHeight:video.videoHeight,framesCount:lastRecordedVideo.frames.length,"window.innerWidth":window.innerWidth,"window.innerHeight":window.innerHeight,"canvas.width":null==workingCanvas?void 0:workingCanvas.width,"canvas.height":null==workingCanvas?void 0:workingCanvas.height};onChange(JSON.stringify(data,null,2))}),1e3)),function(){return clearInterval(interval)}}),[onChange,debug,refRecordedVideos,refWorkingCanvas,refVideo])},get=__webpack_require__(88),get_default=__webpack_require__.n(get);function useApiSettings_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function useApiSettings_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){useApiSettings_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){useApiSettings_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function useApiSettings_slicedToArray(arr,i){return function useApiSettings_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function useApiSettings_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function useApiSettings_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return useApiSettings_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return useApiSettings_arrayLikeToArray(o,minLen)}(arr,i)||function useApiSettings_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useApiSettings_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var ReadIDCard_useApiSettings=function useApiSettings(_ref){var apiCheck=_ref.apiCheck,enableRecordingProp=_ref.enableRecordingProp,apiClient=tvweb_core_esm.m.useSDKSettings().apiClient,_useState2=useApiSettings_slicedToArray(Object(react.useState)(null),2),apiSettings=_useState2[0],setApiSettings=_useState2[1];return Object(react.useEffect)((function(){function _getSettings(){return(_getSettings=useApiSettings_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var clientSettings,enableRecording,frameCaptureIntervalMs,saveFrameQuality,enableTimers,sessionTime,maxRecordingTimePerVideo,enableAutoCapture,waitForBestImageTimeMs,enableBlurCheck,blurThreshold;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(clientSettings={},!apiCheck){_context.next=5;break}return _context.next=4,apiClient.clientSettings();case 4:clientSettings=_context.sent;case 5:enableRecording=get_default()(clientSettings,"data.settings.sdk_settings.id_detection_settings.save_frame_settings.enable",enableRecordingProp),frameCaptureIntervalMs=get_default()(clientSettings,"data.settings.sdk_settings.id_detection_settings.save_frame_settings.frames_interval_ms",190),saveFrameQuality=get_default()(clientSettings,"data.settings.sdk_settings.id_detection_settings.save_frame_settings.quality_web",80),enableTimers=get_default()(clientSettings,"data.settings.sdk_settings.id_detection_settings.limit_time_settings.enable",!0),sessionTime=get_default()(clientSettings,"data.settings.sdk_settings.id_detection_settings.limit_time_settings.limit_time_second",30),maxRecordingTimePerVideo=get_default()(clientSettings,"data.settings.sdk_settings.id_detection_settings.limit_time_settings.video_partial_length_seconds",15),enableAutoCapture=get_default()(clientSettings,"data.settings.sdk_settings.id_detection_settings.auto_capture.enable",!0),waitForBestImageTimeMs=get_default()(clientSettings,"data.settings.sdk_settings.id_detection_settings.auto_capture.wait_for_best_image_time_ms",3e3),enableBlurCheck=get_default()(clientSettings,"data.settings.sdk_settings.id_detection_settings.blur_check.enable",!0),blurThreshold=get_default()(clientSettings,"data.settings.sdk_settings.id_detection_settings.blur_check.threshold",.29),setApiSettings({enableRecording:enableRecording,frameCaptureIntervalMs:frameCaptureIntervalMs,sessionTime:sessionTime,maxRecordingTimePerVideo:maxRecordingTimePerVideo,saveFrameQuality:saveFrameQuality,enableTimers:enableTimers,enableAutoCapture:enableAutoCapture,waitForBestImageTimeMs:waitForBestImageTimeMs,enableBlurCheck:enableBlurCheck,blurThreshold:blurThreshold});case 16:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}!function getSettings(){return _getSettings.apply(this,arguments)}()}),[apiClient,apiCheck,enableRecordingProp]),{apiSettings:apiSettings}};function useShowPopup_slicedToArray(arr,i){return function useShowPopup_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function useShowPopup_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function useShowPopup_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return useShowPopup_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return useShowPopup_arrayLikeToArray(o,minLen)}(arr,i)||function useShowPopup_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useShowPopup_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var PopupType_SESSION_TIMEOUT="SESSION_TIMEOUT",PopupType_CONFIRM="CONFIRM",ReadIDCard_useShowPopup=function useShowPopup(){var _useState2=useShowPopup_slicedToArray(Object(react.useState)(!1),2),popupShown=_useState2[0],setPopupShown=_useState2[1],_useState4=useShowPopup_slicedToArray(Object(react.useState)(null),2),popupType=_useState4[0],setPopupType=_useState4[1];return{showPopup:Object(react.useCallback)((function(_ref){var newPopupType=_ref.popupType;setPopupType(newPopupType),setPopupShown(null!==newPopupType)}),[]),popupShown:popupShown,popupType:popupType}};function ReadIDCard_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function ReadIDCard_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){ReadIDCard_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){ReadIDCard_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function ReadIDCard_slicedToArray(arr,i){return function ReadIDCard_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function ReadIDCard_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function ReadIDCard_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return ReadIDCard_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ReadIDCard_arrayLikeToArray(o,minLen)}(arr,i)||function ReadIDCard_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ReadIDCard_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var ReadIDCard_IDCardMessage=tvweb_core_esm.e.IDCardMessage,ReadIDCard_IDCardSide=tvweb_core_esm.e.IDCardSide,IDCardType=tvweb_core_esm.e.IDCardType,ReadIDCard_Errors=tvweb_core_esm.e.Errors;function ReadIDCard(props){var frontCamera=props.frontCamera,title=props.title,description=props.description,onClose=props.onClose,usePortraitMask=props.usePortraitMask,onError=props.onError,cardType=props.cardType,cardSide=props.cardSide,apiCheck=props.apiCheck,onSuccess=props.onSuccess,frontCardId=props.frontCardId,enableRecordingProp=props.enableRecording,onApiCheck=props.onApiCheck,resultWarmup=props.resultWarmup,enableConfirmPopup=props.enableConfirmPopup,_useState2=ReadIDCard_slicedToArray(Object(react.useState)(0),2),numberOfCaptures=_useState2[0],setNumberOfCaptures=_useState2[1],frontSide=cardSide===ReadIDCard_IDCardSide.FRONT,titleIcon=props.titleIcon||(frontSide?"id_card_front.svg":"id_card_back.svg"),titleIconFullPath=tvweb_core_esm.a.useAsset(titleIcon),_useState4=ReadIDCard_slicedToArray(Object(react.useState)({}),2),uiSpacing=_useState4[0],setUISpacing=_useState4[1],yTitle=uiSpacing.yTitle,yDescription=uiSpacing.yDescription,yMessage=uiSpacing.yMessage,icCamera=tvweb_core_esm.a.useAsset("ic_camera.svg"),_useState6=ReadIDCard_slicedToArray(Object(react.useState)(""),2),debugInfo=_useState6[0],setDebugInfo=_useState6[1],_SettingsContext$useS=tvweb_core_esm.m.useSDKSettings(),apiClient=_SettingsContext$useS.apiClient,debug=_SettingsContext$useS.debug,lang=_SettingsContext$useS.lang,refVideo=Object(react.useRef)(null),_useState8=ReadIDCard_slicedToArray(Object(react.useState)(null),2),message=_useState8[0],setMessage=_useState8[1],_useState10=ReadIDCard_slicedToArray(Object(react.useState)(""),2),errorMessage=_useState10[0],setErrorMessage=_useState10[1],_useState12=ReadIDCard_slicedToArray(Object(react.useState)(!1),2),videoPlayed=_useState12[0],setVideoPlayed=_useState12[1],_useState14=ReadIDCard_slicedToArray(Object(react.useState)(null),2),cropArea=_useState14[0],setCropArea=_useState14[1],_useState16=ReadIDCard_slicedToArray(Object(react.useState)(!1),2),isProcessing=_useState16[0],setIsProcessing=_useState16[1],_useShowPopup=ReadIDCard_useShowPopup(),showPopup=_useShowPopup.showPopup,popupShown=_useShowPopup.popupShown,popupType=_useShowPopup.popupType,refImageBlobTaken=Object(react.useRef)(null),refHandleImageBlobTaken=Object(react.useRef)((function(){})),_useState18=ReadIDCard_slicedToArray(Object(react.useState)(null),2),confirmPopupError=_useState18[0],setConfirmPopupError=_useState18[1],refIsProcessingImageBlobTaken=Object(react.useRef)(!1),apiSettings=ReadIDCard_useApiSettings({apiCheck:apiCheck,enableRecordingProp:enableRecordingProp}).apiSettings,handleOnError=Object(react.useCallback)((function(error){setErrorMessage(null===error?"":template_default()(error.msg[lang])({side:frontSide?Label.FRONT[lang]:Label.BACK[lang]}))}),[lang,frontSide]),handleOnAutoCaptureSuccess=Object(react.useCallback)(function(){var _ref=ReadIDCard_asyncToGenerator(regeneratorRuntime.mark((function _callee(autoCaptureResult){return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,refHandleImageBlobTaken.current({imageBlobTaken:autoCaptureResult.imageBlob});case 2:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}(),[]),_useModelProcess=ReadIDCard_useModelProcess({resultWarmup:resultWarmup,refVideo:refVideo,videoPlayed:videoPlayed,cropArea:cropArea,apiSettings:apiSettings,onError:handleOnError,frontSide:frontSide,onAutoCaptureSuccess:handleOnAutoCaptureSuccess}),refWorkingCanvas=_useModelProcess.refWorkingCanvas,stopCheckFrameInModelProcess=_useModelProcess.stopCheckFrame,checkFrameInModelProcess=_useModelProcess.checkFrame,warmupDone=_useModelProcess.warmupDone,takePictureManually=_useModelProcess.takePictureManually,_useRecordingProcess=ReadIDCard_useRecordingProcess({refVideo:refVideo,videoPlayed:videoPlayed,cropArea:cropArea,apiSettings:apiSettings}),stopCheckFrameInRecordingProcess=_useRecordingProcess.stopCheckFrame,refRecordedVideos=_useRecordingProcess.refRecordedVideos,splitVideos=_useRecordingProcess.splitVideos,resetRecordedVideos=_useRecordingProcess.resetRecordedVideos,checkFrameInRecordingProcess=_useRecordingProcess.checkFrame;ReadIDCard_useDebug({debug:debug,refRecordedVideos:refRecordedVideos,refWorkingCanvas:refWorkingCanvas,refVideo:refVideo,onChange:setDebugInfo});var icLoading=tvweb_core_esm.a.useAsset("ic_loading.png"),onSessionTimeout=Object(react.useCallback)((function(){stopCheckFrameInRecordingProcess(),stopCheckFrameInModelProcess(),resetRecordedVideos(),setMessage(""),showPopup({popupType:PopupType_SESSION_TIMEOUT})}),[resetRecordedVideos,stopCheckFrameInRecordingProcess,stopCheckFrameInModelProcess,showPopup]),onVideoTimeLimitReached=Object(react.useCallback)((function(){splitVideos()}),[splitVideos]),onAboutToTimeout=Object(react.useCallback)((function(_ref2){var curTimeLeft=_ref2.curTimeLeft;setMessage(template_default()(ReadIDCard_IDCardMessage.REMAINING_TIME[lang])({x:curTimeLeft}))}),[lang]),_useRecordingTime=function useRecordingTime(_ref){var videoPlayed=_ref.videoPlayed,lang=_ref.lang,onAboutToTimeout=_ref.onAboutToTimeout,onSessionTimeout=_ref.onSessionTimeout,onVideoTimeLimitReached=_ref.onVideoTimeLimitReached,apiSettings=_ref.apiSettings,warmupDone=_ref.warmupDone,refIntervalRecordingTime=Object(react.useRef)(),_useState2=useRecordingTime_slicedToArray(Object(react.useState)(0),2),numberOfTimesStartTimers=_useState2[0],setNumberOfTimesStartTimers=_useState2[1],stopTimers=Object(react.useCallback)((function(){clearInterval(refIntervalRecordingTime.current)}),[]),startTimers=Object(react.useCallback)((function(){setNumberOfTimesStartTimers((function(n){return n+1}))}),[]);return Object(react.useEffect)((function(){if(warmupDone&&videoPlayed&&null!=apiSettings&&apiSettings.enableTimers){var sessionTime=apiSettings.sessionTime,maxRecordingTimePerVideo=apiSettings.maxRecordingTimePerVideo,curRecordingTimeInSeconds=0,thresholdToShowTimeLeft=sessionTime/3;refIntervalRecordingTime.current=setInterval((function(){var curTimeLeft=sessionTime-(curRecordingTimeInSeconds+=1);curTimeLeft<=thresholdToShowTimeLeft&&onAboutToTimeout({curTimeLeft:curTimeLeft}),curRecordingTimeInSeconds>0&&curRecordingTimeInSeconds%maxRecordingTimePerVideo==0&&onVideoTimeLimitReached(),0===curTimeLeft&&(stopTimers(),onSessionTimeout())}),1e3)}return function(){stopTimers()}}),[videoPlayed,lang,onAboutToTimeout,stopTimers,onSessionTimeout,onVideoTimeLimitReached,numberOfTimesStartTimers,apiSettings,warmupDone]),{stopTimers:stopTimers,startTimers:startTimers}}({videoPlayed:videoPlayed,lang:lang,onAboutToTimeout:onAboutToTimeout,apiClient:apiClient,apiCheck:apiCheck,onSessionTimeout:onSessionTimeout,onVideoTimeLimitReached:onVideoTimeLimitReached,apiSettings:apiSettings,warmupDone:warmupDone}),stopTimers=_useRecordingTime.stopTimers,startTimers=_useRecordingTime.startTimers,handleRestartSession=Object(react.useCallback)(ReadIDCard_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return showPopup({popupType:null}),setConfirmPopupError(null),refIsProcessingImageBlobTaken.current=!1,startTimers(),_context2.next=6,Promise.all([checkFrameInRecordingProcess(),checkFrameInModelProcess()]);case 6:case"end":return _context2.stop()}}),_callee2)}))),[checkFrameInRecordingProcess,checkFrameInModelProcess,startTimers,showPopup]),handleVideoPlayed=Object(react.useCallback)((function(_ref4){var yTitleNew,yDescriptionNew,yMessageNew,width,height,y,videoAreaWidth=_ref4.videoAreaWidth,videoAreaHeight=_ref4.videoAreaHeight,lostX=_ref4.lostX,lostY=_ref4.lostY,clientHeight=_ref4.clientHeight;usePortraitMask?(width=.7*(height=videoAreaHeight-165),yDescriptionNew=(y=(yTitleNew=lostY+10)+45)+height+10,yMessageNew=y+20):(width=dist.isMobile?videoAreaWidth-6:Math.floor(.7*videoAreaWidth),yDescriptionNew=(y=(yTitleNew=lostY+10)+50)+(height=Math.floor(Math.min(width/1.5,clientHeight-2*lostY-80-100)))+10,yMessageNew=y+20);var x=Math.floor((videoAreaWidth-width)/2)+lostX;setCropArea({x:x,y:y,width:width,height:height,surroundStyle:{opacity:.6,background:"#000"}}),setUISpacing({yTitle:yTitleNew,yDescription:yDescriptionNew,yMessage:yMessageNew}),setVideoPlayed(!0)}),[usePortraitMask]),outputResult=Object(react.useCallback)(ReadIDCard_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var image,defaultResult,apiResult;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(setIsProcessing(!0),showPopup({popupType:null}),image=refImageBlobTaken.current,defaultResult={image:image,recordedVideos:null!=apiSettings&&apiSettings.enableRecording?refRecordedVideos.current:[]},!apiCheck){_context3.next=19;break}return apiResult=null,_context3.prev=6,onApiCheck(),_context3.next=10,handleApiCheck({image:image,cardSide:cardSide,frontCardId:frontCardId,onError:onError,apiClient:apiClient,cardType:cardType,recordedVideos:refRecordedVideos.current});case 10:apiResult=_context3.sent,_context3.next=16;break;case 13:_context3.prev=13,_context3.t0=_context3.catch(6),onError(Object.assign({},ReadIDCard_Errors.api_call_error,{details:_context3.t0}));case 16:apiResult&&onSuccess(Object.assign({},defaultResult,{apiResult:apiResult})),_context3.next=20;break;case 19:onSuccess(defaultResult);case 20:setIsProcessing(!1);case 21:case"end":return _context3.stop()}}),_callee3,null,[[6,13]])}))),[apiCheck,apiClient,apiSettings,cardType,cardSide,frontCardId,onError,onSuccess,onApiCheck,refRecordedVideos,showPopup]),handleImageBlobTaken=Object(react.useCallback)(ReadIDCard_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){var _ref7,imageBlobTaken,_args4=arguments;return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(_ref7=_args4.length>0&&void 0!==_args4[0]?_args4[0]:{},imageBlobTaken=_ref7.imageBlobTaken,!refIsProcessingImageBlobTaken.current){_context4.next=3;break}return _context4.abrupt("return");case 3:refIsProcessingImageBlobTaken.current=!0,setIsProcessing(!0),stopCheckFrameInRecordingProcess(),stopCheckFrameInModelProcess(),stopTimers(),setMessage(""),setErrorMessage(""),setNumberOfCaptures((function(n){return n+1})),refImageBlobTaken.current=imageBlobTaken,enableConfirmPopup?showPopup({popupType:PopupType_CONFIRM}):outputResult(),setIsProcessing(!1);case 14:case"end":return _context4.stop()}}),_callee4)}))),[stopCheckFrameInRecordingProcess,stopCheckFrameInModelProcess,stopTimers,showPopup,enableConfirmPopup,outputResult]);refHandleImageBlobTaken.current=handleImageBlobTaken;var handleOnClickTakePicture=Object(react.useCallback)(ReadIDCard_asyncToGenerator(regeneratorRuntime.mark((function _callee5(){var _yield$takePictureMan,imageBlob,error;return regeneratorRuntime.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return setIsProcessing(!0),_context5.next=3,takePictureManually();case 3:return _yield$takePictureMan=_context5.sent,imageBlob=_yield$takePictureMan.imageBlob,error=_yield$takePictureMan.error,setConfirmPopupError(error),_context5.next=9,handleImageBlobTaken({imageBlobTaken:imageBlob});case 9:setIsProcessing(!1);case 10:case"end":return _context5.stop()}}),_callee5)}))),[takePictureManually,handleImageBlobTaken]);return Object(jsx_runtime.jsxs)(components_Wrapper,{children:[Object(jsx_runtime.jsxs)(Camera.b,{frontCamera:frontCamera,onVideoPlayed:handleVideoPlayed,onClose:onClose,flipHorizontal:frontCamera,ref:refVideo,onError:onError,children:[!warmupDone&&Object(jsx_runtime.jsx)(Popup.a,{open:!0,children:Object(jsx_runtime.jsx)(InfoMessage,{className:"warmup-message",children:constants_Message.WARMUP_INTRO[lang]})}),videoPlayed?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[debug&&Object(jsx_runtime.jsx)(DebugInfo,{children:debugInfo}),Object(jsx_runtime.jsx)(components_SplashAnimation,{keyForTransition:numberOfCaptures}),cropArea?Object(jsx_runtime.jsx)(CropArea.a,{x:"".concat(cropArea.x,"px"),y:"".concat(cropArea.y,"px"),width:"".concat(cropArea.width,"px"),height:"".concat(cropArea.height,"px"),surroundStyle:cropArea.surroundStyle,children:Object(jsx_runtime.jsx)(WorkingCanvasFrame,{width:cropArea.width,height:cropArea.height,type:errorMessage?RectangleMask.a.ERROR:RectangleMask.a.DEFAULT})}):null,Object(jsx_runtime.jsx)(RotateAnimationWrapper,{y:"".concat(yTitle,"px"),children:Object(jsx_runtime.jsx)(SwitchTransition.a,{children:Object(jsx_runtime.jsx)(CSSTransition.a,{timeout:{enter:components_animationDuration,exit:components_animationDuration},classNames:"flipY",unmountOnExit:!0,children:Object(jsx_runtime.jsxs)(TitleWrapper,{children:[Object(jsx_runtime.jsx)(IconImage,{src:titleIconFullPath,alt:""}),Object(jsx_runtime.jsx)(Title,{className:"title",children:title})]})},title)})}),!errorMessage&&Object(jsx_runtime.jsx)(Description,{y:"".concat(yDescription,"px"),className:"description",children:description}),errorMessage&&Object(jsx_runtime.jsx)(ErrorMessage,{y:"".concat(yDescription,"px"),children:errorMessage}),isProcessing?Object(jsx_runtime.jsx)(Button,{onClick:null,children:Object(jsx_runtime.jsx)("img",{src:icLoading,alt:"",className:"spin"})}):errorMessage?null:Object(jsx_runtime.jsx)(Button,{onClick:handleOnClickTakePicture,children:Object(jsx_runtime.jsx)("img",{src:icCamera,alt:""})}),message&&Object(jsx_runtime.jsx)(Message,{className:"message",y:"".concat(yMessage,"px"),children:message},message)]}):null]}),Object(jsx_runtime.jsxs)(Popup.a,{open:popupShown,children:[popupType===PopupType_SESSION_TIMEOUT&&Object(jsx_runtime.jsx)(components_SessionTimeoutPopupContent,{onOk:handleRestartSession,maxSessionTime:null==apiSettings?void 0:apiSettings.sessionTime}),popupType===PopupType_CONFIRM&&Object(jsx_runtime.jsx)(components_ConfirmPopupContent,{imageBlobTaken:refImageBlobTaken.current,error:confirmPopupError,onConfirm:outputResult,onTryAgain:handleRestartSession})]})]})}ReadIDCard.displayName="ReadIDCard",ReadIDCard.propTypes={frontCamera:prop_types_default.a.bool,usePortraitMask:prop_types_default.a.bool,cardType:prop_types_default.a.string,cardSide:prop_types_default.a.string,title:prop_types_default.a.string,titleIcon:prop_types_default.a.string,description:prop_types_default.a.string,onClose:prop_types_default.a.func,apiCheck:prop_types_default.a.bool,onSuccess:prop_types_default.a.func,onError:prop_types_default.a.func,frontCardId:prop_types_default.a.string,enableRecording:prop_types_default.a.bool,onApiCheck:prop_types_default.a.func,resultWarmup:prop_types_default.a.shape({}),enableConfirmPopup:prop_types_default.a.bool},ReadIDCard.defaultProps={frontCamera:!0,usePortraitMask:!1,cardType:IDCardType.VN,cardSide:ReadIDCard_IDCardSide.FRONT,title:"",titleIcon:null,description:"",onClose:function onClose(){},apiCheck:!1,onSuccess:function onSuccess(){},onError:function onError(){},frontCardId:null,enableRecording:!1,onApiCheck:function onApiCheck(){},resultWarmup:null,enableConfirmPopup:!0},ReadIDCard.__docgenInfo={description:"",methods:[],displayName:"ReadIDCard",props:{frontCamera:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:""},usePortraitMask:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},cardType:{defaultValue:{value:"IDCardType.VN",computed:!0},type:{name:"string"},required:!1,description:""},cardSide:{defaultValue:{value:"IDCardSide.FRONT",computed:!0},type:{name:"string"},required:!1,description:""},title:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""},titleIcon:{defaultValue:{value:"null",computed:!1},type:{name:"string"},required:!1,description:""},description:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""},onClose:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""},apiCheck:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},onSuccess:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""},onError:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""},frontCardId:{defaultValue:{value:"null",computed:!1},type:{name:"string"},required:!1,description:""},enableRecording:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},onApiCheck:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""},resultWarmup:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},enableConfirmPopup:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:""}}};var src_ReadIDCard=ReadIDCard;function ReadIDCard_stories_slicedToArray(arr,i){return function ReadIDCard_stories_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function ReadIDCard_stories_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function ReadIDCard_stories_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return ReadIDCard_stories_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ReadIDCard_stories_arrayLikeToArray(o,minLen)}(arr,i)||function ReadIDCard_stories_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ReadIDCard_stories_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ReadIDCard/index.js"]={name:"ReadIDCard",docgenInfo:ReadIDCard.__docgenInfo,path:"packages/tvweb-ui/src/ReadIDCard/index.js"});var ReadIDCard_stories_apiClient=new trustvision_sdk_umd_default.a("5767c20d-87aa-4cad-8dbb-f5429f76c34b","c1446919-e60a-4575-a05d-304318212a1b","https://tv-testing.trustingsocial.com/api"),ReadIDCard_stories_Front=function Front(){return Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:"/tvweb-sdk/assets",apiClient:ReadIDCard_stories_apiClient,debug:!1},children:Object(jsx_runtime.jsx)(src_ReadIDCard,{cardSide:tvweb_core_esm.e.IDCardSide.FRONT,apiCheck:!0,enableRecording:!1,title:"Mặt trước CMND/CCCD",description:"Vui lòng đặt CMND mặt trước vào trong khung",onError:console.log,onSuccess:console.log,frontCamera:!1})})};ReadIDCard_stories_Front.displayName="Front";var ReadIDCard_stories_Back=function Back(){return Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:"/tvweb-sdk/assets",apiClient:ReadIDCard_stories_apiClient,debug:!1},children:Object(jsx_runtime.jsx)(src_ReadIDCard,{cardSide:tvweb_core_esm.e.IDCardSide.BACK,apiCheck:!1,enableRecording:!0,title:"Mặt sau CMND/CCCD",description:"Vui lòng đặt CMND mặt sau vào trong khung",onError:console.log,onSuccess:console.log,frontCamera:!1})})};ReadIDCard_stories_Back.displayName="Back";var steps=[{title:"Mặt trước CMND/CCCD",description:"Vui lòng đặt CMND mặt trước vào trong khung",titleIcon:"id_card_front.svg"},{title:"Mặt sau CMND/CCCD",description:"Vui lòng đặt CMND mặt sau vào trong khung",titleIcon:"id_card_back.svg"}],ReadIDCard_stories_ContinuousPhotoCapture=function ContinuousPhotoCapture(){var _useState2=ReadIDCard_stories_slicedToArray(Object(react.useState)(0),2),stepIndex=_useState2[0],setStepIndex=_useState2[1],step=steps[stepIndex];return stepIndex>=steps.length?Object(jsx_runtime.jsx)("div",{children:"Done"}):Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:"/tvweb-sdk/assets"},children:Object(jsx_runtime.jsx)(src_ReadIDCard,Object.assign({},step,{onSuccess:function onSuccess(){return setStepIndex((function(s){return s+1}))}}))})};ReadIDCard_stories_ContinuousPhotoCapture.displayName="ContinuousPhotoCapture";__webpack_exports__.default={title:"[Default] Read ID Card"};ReadIDCard_stories_Front.parameters=Object.assign({storySource:{source:'function Front() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: \'vi\', assetRoot, apiClient, debug: false }}>\n      <ReadIDCard\n        cardSide={Constants.IDCardSide.FRONT}\n        apiCheck\n        enableRecording={false}\n        title="Mặt trước CMND/CCCD"\n        // titleIcon="id_card_front.svg"\n        description="Vui lòng đặt CMND mặt trước vào trong khung"\n        onError={console.log}\n        onSuccess={console.log}\n        frontCamera={false}\n      />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}'}},ReadIDCard_stories_Front.parameters),ReadIDCard_stories_Back.parameters=Object.assign({storySource:{source:'function Back() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: \'vi\', assetRoot, apiClient, debug: false }}>\n      <ReadIDCard\n        cardSide={Constants.IDCardSide.BACK}\n        apiCheck={false}\n        enableRecording\n        title="Mặt sau CMND/CCCD"\n        // titleIcon="id_card_back.svg"\n        description="Vui lòng đặt CMND mặt sau vào trong khung"\n        onError={console.log}\n        onSuccess={console.log}\n        frontCamera={false}\n      />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}'}},ReadIDCard_stories_Back.parameters),ReadIDCard_stories_ContinuousPhotoCapture.parameters=Object.assign({storySource:{source:"function ContinuousPhotoCapture() {\n  const [stepIndex, setStepIndex] = useState(0);\n  const step = steps[stepIndex];\n  if (stepIndex >= steps.length) {\n    return <div>Done</div>;\n  }\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: 'vi', assetRoot }}>\n      {}\n      <ReadIDCard {...step} onSuccess={() => setStepIndex((s) => s + 1)} />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}"}},ReadIDCard_stories_ContinuousPhotoCapture.parameters),ReadIDCard_stories_Front.__docgenInfo={description:"",methods:[],displayName:"Front"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ReadIDCard/ReadIDCard.stories.js"]={name:"Front",docgenInfo:ReadIDCard_stories_Front.__docgenInfo,path:"packages/tvweb-ui/src/ReadIDCard/ReadIDCard.stories.js"}),ReadIDCard_stories_Back.__docgenInfo={description:"",methods:[],displayName:"Back"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ReadIDCard/ReadIDCard.stories.js"]={name:"Back",docgenInfo:ReadIDCard_stories_Back.__docgenInfo,path:"packages/tvweb-ui/src/ReadIDCard/ReadIDCard.stories.js"}),ReadIDCard_stories_ContinuousPhotoCapture.__docgenInfo={description:"",methods:[],displayName:"ContinuousPhotoCapture"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/ReadIDCard/ReadIDCard.stories.js"]={name:"ContinuousPhotoCapture",docgenInfo:ReadIDCard_stories_ContinuousPhotoCapture.__docgenInfo,path:"packages/tvweb-ui/src/ReadIDCard/ReadIDCard.stories.js"})},1748:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ActiveMode",(function(){return LivenessDetection_stories_ActiveMode})),__webpack_require__.d(__webpack_exports__,"PassiveMode",(function(){return LivenessDetection_stories_PassiveMode}));__webpack_require__(15);var jsx_runtime=__webpack_require__(5),react=__webpack_require__(1),tvweb_core_esm=__webpack_require__(8),trustvision_sdk_umd=__webpack_require__(432),trustvision_sdk_umd_default=__webpack_require__.n(trustvision_sdk_umd),styled_components_browser_esm=(__webpack_require__(21),__webpack_require__(37),__webpack_require__(39),__webpack_require__(10)),prop_types=(__webpack_require__(32),__webpack_require__(19),__webpack_require__(4)),prop_types_default=__webpack_require__.n(prop_types),dist=__webpack_require__(93),Camera=__webpack_require__(82),CropArea=__webpack_require__(433),Icon_Camera=__webpack_require__(431),debounce=(__webpack_require__(35),__webpack_require__(72),__webpack_require__(154),__webpack_require__(63),__webpack_require__(114),__webpack_require__(24),__webpack_require__(368),__webpack_require__(36),__webpack_require__(61),__webpack_require__(22),__webpack_require__(95),__webpack_require__(47),__webpack_require__(134),__webpack_require__(27),__webpack_require__(108),__webpack_require__(64),__webpack_require__(30),__webpack_require__(196),__webpack_require__(194),__webpack_require__(99),__webpack_require__(592)),debounce_default=__webpack_require__.n(debounce),tfjs_core_dist=__webpack_require__(0),blazeface_esm=__webpack_require__(436),tfjs_backend_wasm_dist=__webpack_require__(596),throttle=(__webpack_require__(1742),__webpack_require__(1744),__webpack_require__(951)),throttle_default=__webpack_require__.n(throttle),template=__webpack_require__(206),template_default=__webpack_require__.n(template),get=(__webpack_require__(29),__webpack_require__(88)),get_default=__webpack_require__.n(get);function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var Errors=tvweb_core_esm.e.Errors;var LivenessDetection_useLivenessSettings=function useLivenessSettings(_ref){var livenessSettingsProp=_ref.livenessSettings,apiClient=_ref.apiClient,apiCheck=_ref.apiCheck,onError=_ref.onError,_useState2=_slicedToArray(Object(react.useState)({face_tracking_setting:{enable:!1,web_terminate_threshold:.0030152991993743408,web_warning_threshold:.0017317430600108828,limit_for:"all_flow",max_warning_time:5},flow_interval_time_ms:3e3,limit_time_liveness_check:{enable:!1,limit_time_second:45},terminate_if_no_face:{enable:!1,max_invalid_frame:5,max_time_ms:1e3}}),2),livenessSettings=_useState2[0],setLivenessSettings=_useState2[1];return Object(react.useEffect)((function(){livenessSettingsProp?get_default()(livenessSettingsProp,"face_tracking_setting.web_terminate_threshold")?setLivenessSettings(livenessSettingsProp):onError(Errors.client_web_setting_not_found):apiCheck&&apiClient.clientSettings().then((function(result){if(result&&result.data){var isFaceTrackingEnable=get_default()(result,"data.settings.sdk_settings.active_liveness_settings.face_tracking_setting.enable"),_webThreshold=get_default()(result,"data.settings.sdk_settings.active_liveness_settings.face_tracking_setting.web_terminate_threshold");if(isFaceTrackingEnable&&_webThreshold){var clientLivenessSettings=get_default()(result,"data.settings.sdk_settings.active_liveness_settings");setLivenessSettings(clientLivenessSettings)}isFaceTrackingEnable&&!_webThreshold&&onError(Errors.client_web_setting_not_found)}result&&result.errors&&onError(Errors.server_error)})).catch((function(error){onError(error)}))}),[livenessSettingsProp,apiClient,onError,apiCheck]),livenessSettings};function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var LivenessDetection_videoRecordHandler=function videoRecordHandler(_ref){var mediaRecorder,canvas=_ref.canvas,_ref$resultsOutput=_ref.resultsOutput,resultsOutput=void 0===_ref$resultsOutput?[]:_ref$resultsOutput,stream=canvas.captureStream(25);try{mediaRecorder=new MediaRecorder(stream);var saveVideoPromise=function saveVideoPromise(){return new Promise((function(resolve,reject){mediaRecorder.ondataavailable=function(event){return function handleDataAvailable(event,output,resolve,reject){if(event.data.size>0){var blob=new Blob([event.data],{type:"video/webm"});output.push({id:null,blob:blob}),resolve()}else console.error("No video have recored!"),reject()}(event,resultsOutput,resolve,reject)},"inactive"!==mediaRecorder.state&&mediaRecorder.stop()}))},stopVideoRecording=function(){var _ref2=function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,saveVideoPromise();case 2:case"end":return _context.stop()}}),_callee)})));return function stopVideoRecording(){return _ref2.apply(this,arguments)}}();mediaRecorder.stopVideoRecording=stopVideoRecording}catch(error){}return mediaRecorder||(mediaRecorder={start:function start(){},stop:function stop(){},pause:function pause(){},resume:function resume(){},requestData:function requestData(){},stopVideoRecording:function stopVideoRecording(){}}),{mediaRecorder:mediaRecorder}},helpers_shouldDelay=function shouldDelay(_ref){var curStep=_ref.curStep,faceDirection=_ref.faceDirection,delayTime=get_default()(curStep,"stepTimeConstraints.delayTime");return!!delayTime&&(null===curStep.firstFrameSpottedAt?(curStep.name===faceDirection&&(curStep.firstFrameSpottedAt=(new Date).getTime()),!0):(new Date).getTime()-curStep.firstFrameSpottedAt<delayTime)};function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return useLivenessDetection_arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(iter))return Array.from(iter)}(arr)||useLivenessDetection_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useLivenessDetection_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function useLivenessDetection_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){useLivenessDetection_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){useLivenessDetection_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function useLivenessDetection_slicedToArray(arr,i){return function useLivenessDetection_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function useLivenessDetection_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||useLivenessDetection_unsupportedIterableToArray(arr,i)||function useLivenessDetection_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useLivenessDetection_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return useLivenessDetection_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?useLivenessDetection_arrayLikeToArray(o,minLen):void 0}}function useLivenessDetection_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var track=tvweb_core_esm.g.faceTracker(),Mode=tvweb_core_esm.e.Mode,FaceDirection=tvweb_core_esm.e.FaceDirection,useLivenessDetection_Errors=tvweb_core_esm.e.Errors,Messages=tvweb_core_esm.e.Messages;tfjs_backend_wasm_dist.a("//cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@".concat(tfjs_backend_wasm_dist.b,"/dist/"));var _ANGLE,LivenessDetection_useLivenessDetection=function useLivenessDetection(){var _ref2,_ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},apiCheck=_ref.apiCheck,mode=_ref.mode,bgCameraMask=_ref.bgCameraMask,bgCameraMaskRed=_ref.bgCameraMaskRed,surroundStyle=_ref.surroundStyle,cropAreaDimension=_ref.cropAreaDimension,customInstructions=_ref.customInstructions,customIcon=_ref.customIcon,customDirectionIcon=_ref.customDirectionIcon,_ref$customStepTimeCo=_ref.customStepTimeConstraints,customStepTimeConstraints=void 0===_ref$customStepTimeCo?(_defineProperty(_ref2={},tvweb_core_esm.e.FaceDirection.UP,{delayTime:1e3}),_defineProperty(_ref2,tvweb_core_esm.e.FaceDirection.LEFT,{delayTime:1e3}),_defineProperty(_ref2,tvweb_core_esm.e.FaceDirection.RIGHT,{delayTime:1e3}),_defineProperty(_ref2,tvweb_core_esm.e.FaceDirection.FRONTAL,{delayTime:2e3}),_ref2):_ref$customStepTimeCo,onLivenessDetectionDone=_ref.onLivenessDetectionDone,onError=_ref.onError,frontalMinSize=_ref.frontalMinSize,_ref$enableRecording=_ref.enableRecording,enableRecording=void 0!==_ref$enableRecording&&_ref$enableRecording,_ref$waitingTimeToGet=_ref.waitingTimeToGetBetterFrames,waitingTimeToGetBetterFrames=void 0===_ref$waitingTimeToGet?500:_ref$waitingTimeToGet,_ref$captureFrameData=_ref.captureFrameData,captureFrameData=void 0!==_ref$captureFrameData&&_ref$captureFrameData,livenessSettings=_ref.livenessSettings,_ref$setRemainingTime=_ref.setRemainingTime,setRemainingTime=void 0===_ref$setRemainingTime?function(){}:_ref$setRemainingTime,onApiCheck=_ref.onApiCheck,customErrors=_ref.customErrors,_ref$framesIntervalTi=_ref.framesIntervalTime,framesIntervalTime=void 0===_ref$framesIntervalTi?180:_ref$framesIntervalTi,_useState=Object(react.useState)(!1),_useState2=useLivenessDetection_slicedToArray(_useState,2),videoPlayed=_useState2[0],setVideoPlayed=_useState2[1],_useState3=Object(react.useState)(),_useState4=useLivenessDetection_slicedToArray(_useState3,2),model=_useState4[0],setModel=_useState4[1],_useState5=Object(react.useState)(!1),_useState6=useLivenessDetection_slicedToArray(_useState5,2),activeCapturing=_useState6[0],setActiveCapturing=_useState6[1],_useState7=Object(react.useState)(!1),_useState8=useLivenessDetection_slicedToArray(_useState7,2),isFirstValidFrameFound=_useState8[0],setIsFirstValidFrameFound=_useState8[1],refVideo=Object(react.useRef)(null),_SettingsContext$useS=tvweb_core_esm.m.useSDKSettings(),lang=_SettingsContext$useS.lang,assetRoot=_SettingsContext$useS.assetRoot,apiClient=_SettingsContext$useS.apiClient,isActiveMode=mode===Mode.ACTIVE,_useReducer=Object(react.useReducer)((function(x){return x+1}),0),_useReducer2=useLivenessDetection_slicedToArray(_useReducer,2),forceUpdate=(_useReducer2[0],_useReducer2[1]),cropArea=Object(react.useRef)(null),waitingForFrontal=Object(react.useRef)(!1),faceVerificationFlowData=Object(react.useRef)(null);null===faceVerificationFlowData.current&&(faceVerificationFlowData.current=tvweb_core_esm.g.initFaceVerificationData({assetRoot:assetRoot,customInstructions:customInstructions,customIcon:customIcon,customDirectionIcon:customDirectionIcon,customStepTimeConstraints:customStepTimeConstraints}));var _useState9=Object(react.useState)(""),_useState10=useLivenessDetection_slicedToArray(_useState9,2),faceDetectionError=_useState10[0],setFaceDetectionError=_useState10[1],throttleSetFaceDetectionError=Object(react.useMemo)((function(){return throttle_default()(setFaceDetectionError,500)}),[setFaceDetectionError]),refVideoRecord=Object(react.useRef)([]),refMediaRecorder=Object(react.useRef)(),refFrames=Object(react.useRef)([]),refFrameCount=Object(react.useRef)(-1),startTime=Object(react.useRef)(),_useLivenessSettings=LivenessDetection_useLivenessSettings({livenessSettings:livenessSettings,apiClient:apiClient,apiCheck:apiCheck,onError:onError}),faceTrackingSetting=_useLivenessSettings.face_tracking_setting,flowIntervalTime=_useLivenessSettings.flow_interval_time_ms,limitTime=_useLivenessSettings.limit_time_liveness_check,terminateNoFace=_useLivenessSettings.terminate_if_no_face,faceTrackingWarningTime=Object(react.useRef)(0),faceTrackingNoFaceRef=Object(react.useRef)(),resetFlow=Object(react.useCallback)((function(){setRemainingTime(""),faceVerificationFlowData.current.curStepIndex=faceVerificationFlowData.current.steps.length,setActiveCapturing(!1),setTimeout((function(){faceVerificationFlowData.current=tvweb_core_esm.g.initFaceVerificationData({assetRoot:assetRoot,customInstructions:customInstructions,customIcon:customIcon,customDirectionIcon:customDirectionIcon}),startTime.current=Date.now(),faceTrackingWarningTime.current=0,faceTrackingNoFaceRef.current=null,refFrames.current=[],refFrameCount.current=0,setIsFirstValidFrameFound(!1),forceUpdate()}),flowIntervalTime)}),[assetRoot,customInstructions,customIcon,customDirectionIcon,flowIntervalTime,setRemainingTime]),refTimerInterval=Object(react.useRef)(null),errorsMapping=Object(react.useMemo)((function(){return Object.assign({},useLivenessDetection_Errors,customErrors)}),[customErrors]);Object(react.useEffect)((function(){if(videoPlayed&&limitTime.enable&&isFirstValidFrameFound){startTime.current=Date.now();var limitTimeValue=limitTime.limit_time_second+1;refTimerInterval.current=setInterval((function(){var remainTime=Math.round((1e3*limitTimeValue-(Date.now()-startTime.current))/1e3);if(faceVerificationFlowData.current.curStepIndex<faceVerificationFlowData.current.steps.length){if(remainTime<=10&&remainTime>=1){var compiledErr=template_default()(Messages.REMAIN_TIME[lang]);setRemainingTime(compiledErr({x:remainTime}))}if(Math.round((Date.now()-startTime.current)/1e3)===limitTimeValue){var _compiledErr=template_default()(errorsMapping.liveness_terminated_time_out.msg[lang]);setFaceDetectionError({error:_compiledErr({x:limitTime.limit_time_second}),duration:flowIntervalTime}),resetFlow()}}}),1e3)}return function(){clearInterval(refTimerInterval.current)}}),[resetFlow,setRemainingTime,videoPlayed,lang,flowIntervalTime,limitTime.enable,limitTime.limit_time_second,isFirstValidFrameFound,errorsMapping.liveness_terminated_time_out]);var handleVideoPlayed=Object(react.useCallback)((function(_ref3){var width,height,clientWidth=_ref3.clientWidth,clientHeight=_ref3.clientHeight,videoAreaWidth=_ref3.videoAreaWidth,videoAreaHeight=_ref3.videoAreaHeight,lostX=_ref3.lostX,lostY=_ref3.lostY;dist.isMobile?height=width=videoAreaWidth:width=height=videoAreaHeight-200;var x=Math.floor((videoAreaWidth-width)/2)+lostX,y=5+lostY,image=bgCameraMask;cropArea.current={x:x,y:y,width:width,height:height,image:image,surroundStyle:surroundStyle},"object"===_typeof(cropAreaDimension)?cropArea.current=Object.assign({},cropArea.current,cropAreaDimension):"function"==typeof cropAreaDimension&&(cropArea.current=Object.assign({},cropArea.current,cropAreaDimension({clientWidth:clientWidth,clientHeight:clientHeight,videoAreaWidth:videoAreaWidth,videoAreaHeight:videoAreaHeight,lostX:lostX,lostY:lostY,isMobile:dist.isMobile,width:width,height:height}))),forceUpdate(),setVideoPlayed(!0)}),[bgCameraMask,surroundStyle,cropAreaDimension]),_useState11=Object(react.useState)(3),_useState12=useLivenessDetection_slicedToArray(_useState11,2),countdownToTakePicture=_useState12[0],setCountdownToTakePicture=_useState12[1],_useState13=Object(react.useState)(!1),_useState14=useLivenessDetection_slicedToArray(_useState13,2),showCountdown=_useState14[0],setShowCountdown=_useState14[1],refCountdownIsShown=Object(react.useRef)(!1),handleSetShownCountDown=Object(react.useCallback)((function(value){setShowCountdown(value),refCountdownIsShown.current=value}),[]),refInterval=Object(react.useRef)(null),refFrontalFacesInPassiveMode=Object(react.useRef)([]),handleTriggerPassiveMode=Object(react.useCallback)((function(){setCountdownToTakePicture(3),clearInterval(refInterval.current),handleSetShownCountDown(!0),refInterval.current=setInterval((function(){setCountdownToTakePicture((function(prev){if(prev-1==0){clearInterval(refInterval.current);var frontalFaceImages=refFrontalFacesInPassiveMode.current,recordedVideos=refVideoRecord.current.map((function(v){return v.blob}));if(apiCheck){var uploadFilePromises=frontalFaceImages.map((function(i){return apiClient.uploadImage({file:i.blob,label:"portrait",metadata:JSON.stringify({gesture_score:i.leftRightScore,gesture:FaceDirection.FRONTAL})})})).concat(recordedVideos.map((function(i){return apiClient.uploadFile({file:i,label:"video"})})));Promise.all(uploadFilePromises).then((function(uploadResults){var imageResults=uploadResults.filter((function(file,idx){return idx<frontalFaceImages.length})),videoResults=uploadResults.filter((function(file,idx){return idx>=frontalFaceImages.length}));return apiClient.verifyFaceLiveness({images:imageResults.map((function(j){return{id:j.data.image_id}})),videos:videoResults.map((function(j){return{id:j.data.file_id}}))})})).then((function(verifyFaceLivenessResult){onLivenessDetectionDone({apiCheckPassed:verifyFaceLivenessResult.data.is_live,verifyFaceLivenessResult:verifyFaceLivenessResult.data})})).catch((function(error){onError({error:error})}))}else onLivenessDetectionDone({frontalFaces:frontalFaceImages,videoRecord:recordedVideos})}return prev-1}))}),1e3)}),[handleSetShownCountDown,apiCheck,onLivenessDetectionDone,apiClient,onError]);Object(react.useEffect)((function(){faceDetectionError&&(clearInterval(refInterval.current),handleSetShownCountDown(!1))}),[faceDetectionError,handleSetShownCountDown]),Object(react.useEffect)((function(){var hasError=!1;(function(){var _ref4=useLivenessDetection_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return tfjs_core_dist.V.set("WASM_HAS_SIMD_SUPPORT",!1),tfjs_core_dist.V.set("WASM_HAS_MULTITHREAD_SUPPORT",!1),_context.prev=2,_context.next=5,tfjs_core_dist.Dd("wasm");case 5:_context.next=25;break;case 7:return _context.prev=7,_context.t0=_context.catch(2),_context.prev=9,_context.next=12,tfjs_core_dist.Dd("webgl");case 12:_context.next=25;break;case 14:return _context.prev=14,_context.t1=_context.catch(9),_context.prev=16,_context.next=19,tfjs_core_dist.Dd("cpu");case 19:_context.next=25;break;case 21:_context.prev=21,_context.t2=_context.catch(16),console.error(_context.t2),hasError=!0;case 25:case"end":return _context.stop()}}),_callee,null,[[2,7],[9,14],[16,21]])})));return function loadModel(){return _ref4.apply(this,arguments)}})()().then(useLivenessDetection_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var blazefaceModel;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!hasError){_context2.next=5;break}setFaceDetectionError(errorsMapping.unable_to_load_model.msg[lang]),onError(errorsMapping.unable_to_load_model),_context2.next=9;break;case 5:return _context2.next=7,blazeface_esm.a();case 7:blazefaceModel=_context2.sent,setModel(blazefaceModel);case 9:case"end":return _context2.stop()}}),_callee2)}))))}),[lang,onError,errorsMapping.unable_to_load_model]),Object(react.useEffect)((function(){var requestAnimationFrameId,videoEl=refVideo.current,uploadFiles=function(){var _ref6=useLivenessDetection_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var steps,allImageUploadPromises,uploadResults;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return steps=faceVerificationFlowData.current.steps,allImageUploadPromises=[],steps.forEach((function(step){var name=step.name,image=step.image,frontalFaceImage=step.frontalFaceImage;name!==FaceDirection.FRONTAL?allImageUploadPromises.push(apiClient.uploadImage({file:image.blob,label:"portrait",metadata:JSON.stringify({gesture_score:image.leftRightScore,gesture:name})})):allImageUploadPromises.push(Promise.resolve({data:{image_id:null}})),frontalFaceImage.blob?allImageUploadPromises.push(apiClient.uploadImage({file:frontalFaceImage.blob,label:"portrait",metadata:JSON.stringify({gesture_score:frontalFaceImage.leftRightScore,gesture:FaceDirection.FRONTAL})})):allImageUploadPromises.push(Promise.resolve({data:{image_id:null}}))})),_context3.next=5,Promise.all(allImageUploadPromises);case 5:uploadResults=_context3.sent,steps.forEach((function(step,index){step.image.imageId=uploadResults[2*index].data.image_id,step.frontalFaceImage.imageId=uploadResults[2*index+1].data.image_id}));case 7:case"end":return _context3.stop()}}),_callee3)})));return function uploadFiles(){return _ref6.apply(this,arguments)}}(),processApiCheckMode=function(){var _ref7=useLivenessDetection_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){var completeSteps,stepsHavingFrontalImageId;return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.prev=0,_context4.next=3,uploadFiles();case 3:completeSteps=faceVerificationFlowData.current.steps,0===(stepsHavingFrontalImageId=completeSteps.filter((function(i){return i.frontalFaceImage.imageId}))).length?onLivenessDetectionDone({error:"wrong_face_movement"}):apiClient.verifyFaceLiveness({images:stepsHavingFrontalImageId.map((function(i){return{id:i.frontalFaceImage.imageId}})),gesture_images:completeSteps.filter((function(i){return i.image.imageId&&i.name!==FaceDirection.FRONTAL})).map((function(_ref8){return{gesture:_ref8.name,images:[{id:_ref8.image.imageId}]}})),videos:[{frames:refFrames.current}],metadata:captureFrameData?{sdk_logs:{tracking_frames:refFrames.current.map((function(_ref9){return{index:_ref9.index,landmarks:_ref9.landmarks,original_landmarks:_ref9.original_landmarks,score:_ref9.score,time:_ref9.time,bbox:_ref9.bbox,original_bbox:_ref9.original_bbox}}))}}:void 0}).then((function(verifyFaceLivenessResponse){var apiCheckPassed=!0===verifyFaceLivenessResponse.data.is_live;onLivenessDetectionDone({apiCheckPassed:apiCheckPassed,verifyFaceLivenessResult:verifyFaceLivenessResponse.data})})),_context4.next=11;break;case 8:_context4.prev=8,_context4.t0=_context4.catch(0),onError({error:_context4.t0});case 11:case"end":return _context4.stop()}}),_callee4,null,[[0,8]])})));return function processApiCheckMode(){return _ref7.apply(this,arguments)}}(),goToNextStepInActiveMode=function(){var _ref10=useLivenessDetection_asyncToGenerator(regeneratorRuntime.mark((function _callee5(){var steps,_steps$find,_steps$find$image,faceGesturesResult,frontalFacesResult,frontalMain,frontalScaledImage;return regeneratorRuntime.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(steps=faceVerificationFlowData.current.steps,faceVerificationFlowData.current.curStepIndex++,faceTrackingSetting.enable&&"each_gesture"===faceTrackingSetting.limit_for&&(faceTrackingWarningTime.current=0),faceVerificationFlowData.current.curStepIndex!==steps.length){_context5.next=28;break}if(!enableRecording){_context5.next=7;break}return _context5.next=7,refMediaRecorder.current.stopVideoRecording();case 7:if(limitTime.enable&&setRemainingTime(""),!onLivenessDetectionDone){_context5.next=28;break}if(apiCheck){_context5.next=25;break}if(faceGesturesResult=steps.filter((function(step){return step.name!==FaceDirection.FRONTAL})).map((function(step){return{name:step.name,image:{blob:step.image.blob}}})),frontalFacesResult=steps.filter((function(step){return step.name!==FaceDirection.FRONTAL})).map((function(step){return step.frontalFaceImage.blob})).filter((function(blob){return null!==blob})),!(frontalMain=null===(_steps$find=steps.find((function(step){return step.name===FaceDirection.FRONTAL})))||void 0===_steps$find||null===(_steps$find$image=_steps$find.image)||void 0===_steps$find$image?void 0:_steps$find$image.blob)||!frontalMinSize){_context5.next=19;break}return _context5.next=16,tvweb_core_esm.i.scaleImage(frontalMain,{minSize:frontalMinSize});case 16:_context5.t0=_context5.sent,_context5.next=20;break;case 19:_context5.t0=null;case 20:frontalScaledImage=_context5.t0,frontalMain&&frontalFacesResult.push(frontalMain),onLivenessDetectionDone({steps:faceGesturesResult,frontalFaces:frontalFacesResult,videoRecord:[],frontalScaledImage:frontalScaledImage,capturedFrames:refFrames.current}),_context5.next=28;break;case 25:return onApiCheck(),_context5.next=28,processApiCheckMode();case 28:forceUpdate();case 29:case"end":return _context5.stop()}}),_callee5)})));return function goToNextStepInActiveMode(){return _ref10.apply(this,arguments)}}(),validateCurrentStep=debounce_default()((function(){var _faceVerificationFlow=faceVerificationFlowData.current,curStepIndex=_faceVerificationFlow.curStepIndex,steps=_faceVerificationFlow.steps,curStep=steps[curStepIndex],hasGestureImage=null!==(null==curStep?void 0:curStep.image.blob),hasFrontalImage=null!==(null==curStep?void 0:curStep.frontalFaceImage.blob),currentFrontalCount=steps.filter((function(step){return step.frontalFaceImage.blob})).length,valid=!1;return hasGestureImage&&(hasFrontalImage||![1].includes(curStepIndex)||currentFrontalCount>=1)?(waitingForFrontal.current=!1,goToNextStepInActiveMode(),valid=!0):waitingForFrontal.current=!(!hasGestureImage||hasFrontalImage),setActiveCapturing(!1),valid}),waitingTimeToGetBetterFrames);function processActiveMode(_x,_x2,_x3,_x4){return _processActiveMode.apply(this,arguments)}function _processActiveMode(){return(_processActiveMode=useLivenessDetection_asyncToGenerator(regeneratorRuntime.mark((function _callee6(faceDirection,canvas,blurScore,leftRightScore){var _faceVerificationFlow2,curStepIndex,steps,_curStep,blob,_blob;return regeneratorRuntime.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(_faceVerificationFlow2=faceVerificationFlowData.current,curStepIndex=_faceVerificationFlow2.curStepIndex,steps=_faceVerificationFlow2.steps,!(curStepIndex<steps.length)){_context6.next=24;break}if(_curStep=steps[curStepIndex],!helpers_shouldDelay({faceDirection:faceDirection,curStep:_curStep})){_context6.next=5;break}return _context6.abrupt("return");case 5:if(faceDirection!==FaceDirection.FRONTAL||null!==_curStep.frontalFaceImage.blurScore&&!tvweb_core_esm.c.hasBetterBlurScore(blurScore,_curStep.frontalFaceImage.blurScore)){_context6.next=13;break}return _curStep.frontalFaceImage.blurScore=blurScore,_context6.next=9,tvweb_core_esm.d.takePicture({canvas:canvas});case 9:blob=_context6.sent,_curStep.frontalFaceImage.blob=blob,_curStep.frontalFaceImage.leftRightScore=leftRightScore,waitingForFrontal.current&&(waitingForFrontal.current=!1,goToNextStepInActiveMode());case 13:if(_curStep.name!==faceDirection||null!==_curStep.image.blurScore&&!tvweb_core_esm.c.hasBetterBlurScore(blurScore,_curStep.image.blurScore)){_context6.next=24;break}return setActiveCapturing(!0),_curStep.image.blurScore=blurScore,_context6.next=18,tvweb_core_esm.d.takePicture({canvas:canvas});case 18:_blob=_context6.sent,_curStep.image.blob=_blob,_curStep.image.leftRightScore=leftRightScore,_curStep.image.objUrl&&URL.revokeObjectURL(_curStep.image.objUrl),_curStep.image.objUrl=URL.createObjectURL(_blob),validateCurrentStep();case 24:case"end":return _context6.stop()}}),_callee6)})))).apply(this,arguments)}function processPassiveMode(_x5,_x6,_x7){return _processPassiveMode.apply(this,arguments)}function _processPassiveMode(){return(_processPassiveMode=useLivenessDetection_asyncToGenerator(regeneratorRuntime.mark((function _callee7(faceDirection,canvas,leftRightScore){return regeneratorRuntime.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:!0===refCountdownIsShown.current&&faceDirection===FaceDirection.FRONTAL&&refFrontalFacesInPassiveMode.current.length<3&&(tvweb_core_esm.d.takePicture({canvas:canvas}).then((function(blob){refFrontalFacesInPassiveMode.current.push({blob:blob,leftRightScore:leftRightScore})})),2===refFrontalFacesInPassiveMode.current.length&&enableRecording&&refMediaRecorder.current.stopVideoRecording());case 1:case"end":return _context7.stop()}}),_callee7)})))).apply(this,arguments)}function captureFrame(predictions,croppedCanvas,landmarks,isStop){if(refFrames.current.length&&Date.now()-refFrames.current[refFrames.current.length-1].time<framesIntervalTime)return null;if(refFrameCount.current++,captureFrameData&&!isStop){var topLeft=predictions.topLeft,bottomRight=predictions.bottomRight,bbox=[].concat(_toConsumableArray(topLeft),_toConsumableArray(bottomRight)),original_bbox=[];[topLeft,bottomRight].forEach((function(point){original_bbox=[].concat(_toConsumableArray(original_bbox),[point[0]/tvweb_core_esm.l.SIZE*croppedCanvas.width,point[1]/tvweb_core_esm.l.SIZE*croppedCanvas.height])}));var _track=track(predictions,0===refFrames.current.length),score=_track.score,time=_track.time,base64=croppedCanvas.toDataURL("image/jpeg",.8);return refFrames.current.push({label:"portrait",base64:base64.split(",")[1],landmarks:landmarks,original_landmarks:landmarks.map((function(point){return[point[0]/tvweb_core_esm.l.SIZE*croppedCanvas.width,point[1]/tvweb_core_esm.l.SIZE*croppedCanvas.height]})),score:score,time:time,index:refFrames.current.length,bbox:bbox,original_bbox:original_bbox}),score}return null}function faceTrackingAllowContinue(trackingScore){if(!faceTrackingSetting.enable||null===trackingScore||!isFirstValidFrameFound)return!0;var warningThreshold=faceTrackingSetting.web_warning_threshold,terminateThreshold=faceTrackingSetting.web_terminate_threshold,maxWarningTime=faceTrackingSetting.max_warning_time;return trackingScore<warningThreshold||(trackingScore<terminateThreshold&&faceTrackingWarningTime.current<maxWarningTime?(faceTrackingWarningTime.current++,faceTrackingWarningTime.current===maxWarningTime?setFaceDetectionError({error:errorsMapping.liveness_terminated_face_tracking.msg[lang],duration:flowIntervalTime}):setFaceDetectionError({error:errorsMapping.liveness_too_fast.msg[lang],duration:1500}),!0):(setFaceDetectionError({error:errorsMapping.liveness_terminated.msg[lang],duration:flowIntervalTime}),resetFlow(),!1))}function faceTrackingNoFace(noFace){if(terminateNoFace.enable&&isFirstValidFrameFound){var maxTime=terminateNoFace.max_time_ms;faceTrackingNoFaceRef.current&&noFace||(faceTrackingNoFaceRef.current={time:Date.now(),frame:0}),noFace&&faceTrackingNoFaceRef.current.frame++;var time=faceTrackingNoFaceRef.current.time;noFace&&Date.now()-time>=maxTime&&(setFaceDetectionError({error:errorsMapping.liveness_terminated_no_face.msg[lang],duration:flowIntervalTime}),resetFlow())}}function renderPrediction(_x8,_x9){return _renderPrediction.apply(this,arguments)}function _renderPrediction(){return(_renderPrediction=useLivenessDetection_asyncToGenerator(regeneratorRuntime.mark((function _callee8(resultAnalyzeVideoAndWindowSizes,croppedCanvas){var cropX,cropY,cropWidth,cropHeight,blurScore,predictions,_yield$FaceUtils$vali,error,fullFace,errorMsg,faceDirection,leftRightScore,landmarks,_faceVerificationFlow3,curStepIndex,steps,_curStep2,result,hasNoFace,notFinsish,_errorsMapping$error$;return regeneratorRuntime.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return cropX=resultAnalyzeVideoAndWindowSizes.cropX,cropY=resultAnalyzeVideoAndWindowSizes.cropY,cropWidth=resultAnalyzeVideoAndWindowSizes.cropWidth,cropHeight=resultAnalyzeVideoAndWindowSizes.cropHeight,croppedCanvas.getContext("2d").drawImage(videoEl,cropX,cropY,cropWidth,cropHeight,0,0,cropWidth,cropHeight),_context8.next=5,tvweb_core_esm.c.calculateBlurScore(croppedCanvas);case 5:return blurScore=_context8.sent,_context8.next=8,tvweb_core_esm.l.getModelPredictions({model:model,sCanvas:croppedCanvas});case 8:return predictions=_context8.sent,_context8.next=11,tvweb_core_esm.g.validatePredictions({predictions:predictions,width:tvweb_core_esm.l.SIZE,height:tvweb_core_esm.l.SIZE});case 11:if(_yield$FaceUtils$vali=_context8.sent,error=_yield$FaceUtils$vali.error,fullFace=_yield$FaceUtils$vali.fullFace,errorMsg="",cropArea.current.image=bgCameraMask,faceDirection=null,leftRightScore=null,landmarks=null,_faceVerificationFlow3=faceVerificationFlowData.current,curStepIndex=_faceVerificationFlow3.curStepIndex,steps=_faceVerificationFlow3.steps,!fullFace){_context8.next=27;break}return _curStep2=steps[curStepIndex],landmarks=fullFace.landmarks,_context8.next=25,tvweb_core_esm.g.calculateFaceDirection({landmarks:landmarks,getPerfectFrontal:_curStep2&&_curStep2.name===FaceDirection.FRONTAL});case 25:(result=_context8.sent)&&(faceDirection=result.gesture,leftRightScore=result.leftRightScore);case 27:if(hasNoFace="no_face"===(null==error?void 0:error.code)||"partial_face"===(null==error?void 0:error.code),notFinsish=curStepIndex<steps.length,faceTrackingNoFace(hasNoFace&&notFinsish),error&&("face_too_small"!==error.code||![FaceDirection.DOWN,FaceDirection.UP,FaceDirection.LEFT,FaceDirection.RIGHT].includes(faceDirection))){_context8.next=43;break}if(!isActiveMode){_context8.next=39;break}if(isFirstValidFrameFound||setIsFirstValidFrameFound(!0),!faceTrackingAllowContinue(captureFrame(predictions[0],croppedCanvas,landmarks,curStepIndex>=steps.length))){_context8.next=37;break}return _context8.next=37,processActiveMode(faceDirection,croppedCanvas,blurScore,leftRightScore);case 37:_context8.next=41;break;case 39:return _context8.next=41,processPassiveMode(faceDirection,croppedCanvas,leftRightScore);case 41:_context8.next=44;break;case 43:curStepIndex<steps.length&&(errorMsg=null===(_errorsMapping$error$=errorsMapping[error.code])||void 0===_errorsMapping$error$?void 0:_errorsMapping$error$.msg[lang],cropArea.current.image=bgCameraMaskRed);case 44:throttleSetFaceDetectionError(errorMsg),-1!==requestAnimationFrameId&&(requestAnimationFrameId=requestAnimationFrame((function(){return renderPrediction(resultAnalyzeVideoAndWindowSizes,croppedCanvas)})));case 46:case"end":return _context8.stop()}}),_callee8)})))).apply(this,arguments)}function _triggerCheckFace(){return(_triggerCheckFace=useLivenessDetection_asyncToGenerator(regeneratorRuntime.mark((function _callee9(){var resultAnalyzeVideoAndWindowSizes,cropWidth,cropHeight,croppedCanvas,canvasContext,_ref11,mediaRecorder;return regeneratorRuntime.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:model&&(resultAnalyzeVideoAndWindowSizes=tvweb_core_esm.d.analyzeVideoAndWindowSizes(videoEl,cropArea.current),cropWidth=resultAnalyzeVideoAndWindowSizes.cropWidth,cropHeight=resultAnalyzeVideoAndWindowSizes.cropHeight,(croppedCanvas=document.createElement("canvas")).width=cropWidth,croppedCanvas.height=cropHeight,(canvasContext=croppedCanvas.getContext("2d")).translate(cropWidth,0),canvasContext.scale(-1,1),_ref11=enableRecording?LivenessDetection_videoRecordHandler({canvas:croppedCanvas,resultsOutput:refVideoRecord.current}):{},mediaRecorder=_ref11.mediaRecorder,refMediaRecorder.current=mediaRecorder,refMediaRecorder.current&&refMediaRecorder.current.start(),renderPrediction(resultAnalyzeVideoAndWindowSizes,croppedCanvas));case 1:case"end":return _context9.stop()}}),_callee9)})))).apply(this,arguments)}return videoPlayed&&setTimeout((function(){!function triggerCheckFace(){return _triggerCheckFace.apply(this,arguments)}()}),2e3),function(){cancelAnimationFrame(requestAnimationFrameId),requestAnimationFrameId=-1}}),[videoPlayed,lang,isActiveMode,apiClient,apiCheck,bgCameraMask,bgCameraMaskRed,onLivenessDetectionDone,onError,enableRecording,frontalMinSize,waitingTimeToGetBetterFrames,captureFrameData,onApiCheck,faceTrackingSetting,limitTime.enable,setRemainingTime,throttleSetFaceDetectionError,flowIntervalTime,resetFlow,terminateNoFace,model,isFirstValidFrameFound,errorsMapping,framesIntervalTime]);var _faceVerificationFlow4=faceVerificationFlowData.current,curStepIndex=_faceVerificationFlow4.curStepIndex,steps=_faceVerificationFlow4.steps,frontalStep=Object(react.useMemo)((function(){return steps.find((function(step){return step.name===tvweb_core_esm.e.FaceDirection.FRONTAL}))}),[steps]),curStep=waitingForFrontal.current?frontalStep:steps[curStepIndex],instructions=curStep&&isFirstValidFrameFound?curStep.instructions[lang]:null,directionIcon=curStep&&isFirstValidFrameFound?curStep.directionIcon:"",directionIconAnimation=curStep?curStep.directionIconAnimation:"";return{countdownToTakePicture:countdownToTakePicture,cropArea:cropArea,curStepIndex:curStepIndex,directionIcon:directionIcon,directionIconAnimation:directionIconAnimation,faceDetectionError:faceDetectionError,handleTriggerPassiveMode:handleTriggerPassiveMode,handleVideoPlayed:handleVideoPlayed,instructions:instructions,isActiveMode:isActiveMode,refVideo:refVideo,showCountdown:showCountdown,steps:steps,videoPlayed:videoPlayed,activeCapturing:activeCapturing,isFirstValidFrameFound:isFirstValidFrameFound}};function _templateObject7(){var data=_taggedTemplateLiteral(["\n  animation-delay: 1s;\n"]);return _templateObject7=function _templateObject7(){return data},data}function _templateObject6(){var data=_taggedTemplateLiteral(["\n  animation-delay: 0.5s;\n"]);return _templateObject6=function _templateObject6(){return data},data}function _templateObject5(){var data=_taggedTemplateLiteral(["\n  animation-delay: 0s;\n"]);return _templateObject5=function _templateObject5(){return data},data}function _templateObject4(){var data=_taggedTemplateLiteral(["\n  display: flex;\n  margin: 4px 0;\n  width: 100%;\n  height: 15px;\n  animation: "," 1s infinite;\n  animation-direction: alternate;\n\n  &::before,\n  &::after {\n    content: '';\n    height: 100%;\n    width: 50%;\n    background: rgba(255, 255, 255, 0.8);\n  }\n\n  &::before {\n    transform: skewY(32deg);\n  }\n\n  &::after {\n    width: 50%;\n    transform: skewY(-32deg);\n  }\n"]);return _templateObject4=function _templateObject4(){return data},data}function _templateObject3(){var data=_taggedTemplateLiteral(["\n  width: 70px;\n  transform: rotate(","deg);\n"]);return _templateObject3=function _templateObject3(){return data},data}function _templateObject2(){var data=_taggedTemplateLiteral(["\n  width: 200px;\n  height: 200px;\n  position: relative;\n  transform: scale(0.48);\n\n  .top,\n  .right,\n  .bottom,\n  .left {\n    position: absolute;\n  }\n\n  .top {\n    top: 0;\n    left: 50%;\n    transform: rotate(","deg) translateX(-50%);\n  }\n\n  .right {\n    right: 0;\n    top: 50%;\n    transform: rotate(","deg) translateX(-50%);\n  }\n\n  .bottom {\n    bottom: 0;\n    left: 50%;\n    transform: rotate(","deg) translateX(50%);\n  }\n\n  .left {\n    left: 0;\n    top: 50%;\n    transform: rotate(","deg) translateX(50%);\n  }\n"]);return _templateObject2=function _templateObject2(){return data},data}function _templateObject(){var data=_taggedTemplateLiteral(["\n  0% {\n    opacity: 0.15;\n  }\n  50% {\n    opacity: 0.3;\n  }\n  100% {\n    opacity: 1;\n  }\n"]);return _templateObject=function _templateObject(){return data},data}function _taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}function DirectionIcon_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var ANGLE=(DirectionIcon_defineProperty(_ANGLE={},tvweb_core_esm.e.FaceDirection.LEFT,90),DirectionIcon_defineProperty(_ANGLE,tvweb_core_esm.e.FaceDirection.RIGHT,270),DirectionIcon_defineProperty(_ANGLE,tvweb_core_esm.e.FaceDirection.UP,180),DirectionIcon_defineProperty(_ANGLE,tvweb_core_esm.e.FaceDirection.DOWN,0),_ANGLE),arrowScroll=Object(styled_components_browser_esm.d)(_templateObject()),FrontalWrapper=styled_components_browser_esm.c.div(_templateObject2(),ANGLE[tvweb_core_esm.e.FaceDirection.DOWN],ANGLE[tvweb_core_esm.e.FaceDirection.LEFT],ANGLE[tvweb_core_esm.e.FaceDirection.UP],ANGLE[tvweb_core_esm.e.FaceDirection.RIGHT]),ArrowWrapper=styled_components_browser_esm.c.div(_templateObject3(),(function(_ref){var _ANGLE$direction,direction=_ref.direction;return null!==(_ANGLE$direction=ANGLE[direction])&&void 0!==_ANGLE$direction?_ANGLE$direction:0})),Arrow=styled_components_browser_esm.c.span(_templateObject4(),arrowScroll),FirstArrow=Object(styled_components_browser_esm.c)(Arrow)(_templateObject5()),SecondArrow=Object(styled_components_browser_esm.c)(Arrow)(_templateObject6()),ThirdArrow=Object(styled_components_browser_esm.c)(Arrow)(_templateObject7());function DirectionIcon(_ref2){var type=_ref2.type;return type!==tvweb_core_esm.e.FaceDirection.FRONTAL?Object(jsx_runtime.jsxs)(ArrowWrapper,{direction:type,children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}):Object(jsx_runtime.jsxs)(FrontalWrapper,{children:[Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"top",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}),Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"right",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}),Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"bottom",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}),Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"left",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]})]})}DirectionIcon.displayName="DirectionIcon",DirectionIcon.propTypes={type:prop_types_default.a.oneOf([tvweb_core_esm.e.FaceDirection.LEFT,tvweb_core_esm.e.FaceDirection.RIGHT,tvweb_core_esm.e.FaceDirection.UP,tvweb_core_esm.e.FaceDirection.FRONTAL])},DirectionIcon.defaultProps={type:tvweb_core_esm.e.FaceDirection.LEFT},DirectionIcon.__docgenInfo={description:"",methods:[],displayName:"DirectionIcon",props:{type:{defaultValue:{value:"Constants.FaceDirection.LEFT",computed:!0},type:{name:"enum",value:[{value:"Constants.FaceDirection.LEFT",computed:!0},{value:"Constants.FaceDirection.RIGHT",computed:!0},{value:"Constants.FaceDirection.UP",computed:!0},{value:"Constants.FaceDirection.FRONTAL",computed:!0}]},required:!1,description:""}}};var LivenessDetection_DirectionIcon=DirectionIcon;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/LivenessDetection/DirectionIcon.js"]={name:"DirectionIcon",docgenInfo:DirectionIcon.__docgenInfo,path:"packages/tvweb-ui/src/LivenessDetection/DirectionIcon.js"});var ErrorDuration=tvweb_core_esm.e.ErrorDuration;function FaceDetectionError(_ref){var children=_ref.children,className=_ref.className,timer=Object(react.useRef)(0),lastError=Object(react.useRef)(""),duration=Object(react.useRef)(ErrorDuration.SHORT),errorMsg="",errorDuration=0;if("string"==typeof children)errorMsg=children;else{var error=children.error;errorDuration=children.duration,errorMsg=error}return Date.now()-timer.current>=duration.current?(timer.current=Date.now(),lastError.current=errorMsg,duration.current=errorDuration,errorMsg?Object(jsx_runtime.jsx)("div",{className:className,children:errorMsg}):null):lastError.current?Object(jsx_runtime.jsx)("div",{className:className,children:lastError.current}):null}FaceDetectionError.propTypes={children:prop_types_default.a.node.isRequired,className:prop_types_default.a.string},FaceDetectionError.defaultProps={className:""},FaceDetectionError.__docgenInfo={description:"",methods:[],displayName:"FaceDetectionError",props:{className:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""},children:{type:{name:"node"},required:!0,description:""}}};var LivenessDetection_FaceDetectionError=FaceDetectionError;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/LivenessDetection/FaceDetectionError.js"]={name:"FaceDetectionError",docgenInfo:FaceDetectionError.__docgenInfo,path:"packages/tvweb-ui/src/LivenessDetection/FaceDetectionError.js"});var ProgressCircle=__webpack_require__(167);function CameraMark(_ref){var className=_ref.className;return Object(jsx_runtime.jsx)("svg",{className:className,width:"320",height:"320",viewBox:"0 0 320 320",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(jsx_runtime.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M320 0H0V320H320V0ZM160 296C235.111 296 296 235.111 296 160C296 84.8893 235.111 24 160 24C84.8893 24 24 84.8893 24 160C24 235.111 84.8893 296 160 296Z",fill:"currentColor"})})}CameraMark.displayName="CameraMark",CameraMark.propTypes={className:prop_types_default.a.string},CameraMark.defaultProps={className:""},CameraMark.__docgenInfo={description:"",methods:[],displayName:"CameraMark",props:{className:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""}}};var _customDirectionIcon,_customStepTimeConstr,CameraMask=CameraMark;function LivenessDetection_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function LivenessDetection_slicedToArray(arr,i){return function LivenessDetection_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function LivenessDetection_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function LivenessDetection_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return LivenessDetection_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return LivenessDetection_arrayLikeToArray(o,minLen)}(arr,i)||function LivenessDetection_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function LivenessDetection_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _templateObject25(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  width: 100%;\n  top: 0;\n  bottom: 0;\n  z-index: -1;\n  background: rgba(255, 255, 255, 0.3);\n  animation: "," 1s infinite;\n  border-radius: 50%;\n"]);return _templateObject25=function _templateObject25(){return data},data}function _templateObject24(){var data=LivenessDetection_taggedTemplateLiteral(["\n  from {\n    opacity: 1;\n  }\n\n  to {\n    opacity: 0;\n  }\n"]);return _templateObject24=function _templateObject24(){return data},data}function _templateObject23(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  z-index: -1;\n  background: rgba(223, 0, 0, 0.2);\n  border-radius: 50%;\n  width: 86%;\n  height: 86%;\n  top: 7%;\n  left: 7%;\n"]);return _templateObject23=function _templateObject23(){return data},data}function _templateObject22(){var data=LivenessDetection_taggedTemplateLiteral(["\n  width: 100%;\n  height: 100%;\n  vertical-align: middle;\n  margin: 0;\n  color: ",";\n"]);return _templateObject22=function _templateObject22(){return data},data}function _templateObject21(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n"]);return _templateObject21=function _templateObject21(){return data},data}function _templateObject20(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  width: 100%;\n  top: 0;\n  bottom: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]);return _templateObject20=function _templateObject20(){return data},data}function _templateObject19(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  width: 100%;\n  top: 0;\n  bottom: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: #ffffff;\n  font-size: 140px;\n  opacity: 0.6;\n"]);return _templateObject19=function _templateObject19(){return data},data}function _templateObject18(){var data=LivenessDetection_taggedTemplateLiteral(["\n  cursor: pointer;\n  text-align: center;\n  width: 50px;\n\n  img {\n    width: 100%;\n  }\n"]);return _templateObject18=function _templateObject18(){return data},data}function _templateObject17(){var data=LivenessDetection_taggedTemplateLiteral(["\n  color: #ffffff;\n  height: 70px;\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: ",";\n"]);return _templateObject17=function _templateObject17(){return data},data}function _templateObject16(){var data=LivenessDetection_taggedTemplateLiteral(["\n      opacity: 0.6;\n    "]);return _templateObject16=function _templateObject16(){return data},data}function _templateObject15(){var data=LivenessDetection_taggedTemplateLiteral(["\n  width: ",";\n  height: ",";\n  border-radius: 50%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border: 2px solid #ffffff;\n  font-size: 16px;\n  color: #fff;\n  font-weight: 700;\n\n  & + & {\n    margin-left: 10px;\n  }\n\n  ","\n  img {\n    width: 100%;\n    margin: 0;\n    border-radius: 50%;\n  }\n"]);return _templateObject15=function _templateObject15(){return data},data}function _templateObject14(){var data=LivenessDetection_taggedTemplateLiteral(["\n      bottom: ","px;\n    "]);return _templateObject14=function _templateObject14(){return data},data}function _templateObject13(){var data=LivenessDetection_taggedTemplateLiteral(["\n      top: ","px;\n    "]);return _templateObject13=function _templateObject13(){return data},data}function _templateObject12(){var data=LivenessDetection_taggedTemplateLiteral(["\n  height: ",";\n  position: absolute;\n  ","\n  ","\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: ",";\n"]);return _templateObject12=function _templateObject12(){return data},data}function _templateObject11(){var data=LivenessDetection_taggedTemplateLiteral(["\n      bottom: ","px;\n    "]);return _templateObject11=function _templateObject11(){return data},data}function _templateObject10(){var data=LivenessDetection_taggedTemplateLiteral(["\n      top: ","px;\n    "]);return _templateObject10=function _templateObject10(){return data},data}function _templateObject9(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  ","\n  ","\n  font-size: ",";\n  text-shadow: 2px 2px 4px #000000;\n"]);return _templateObject9=function _templateObject9(){return data},data}function _templateObject8(){var data=LivenessDetection_taggedTemplateLiteral(["\n      top: ","px;\n    "]);return _templateObject8=function _templateObject8(){return data},data}function LivenessDetection_templateObject7(){var data=LivenessDetection_taggedTemplateLiteral(["\n  ","\n  font-size: 18px;\n  background: #ea3223;\n  color: #fff;\n  padding: 5px 10px;\n  border-radius: 3px;\n  position: absolute;\n  left: 50%;\n  transform: translate(-50%, 0);\n  white-space: nowrap;\n"]);return LivenessDetection_templateObject7=function _templateObject7(){return data},data}function LivenessDetection_templateObject6(){var data=LivenessDetection_taggedTemplateLiteral(["\n      top: 50%;\n      transform: translateY(-50%);\n    "]);return LivenessDetection_templateObject6=function _templateObject6(){return data},data}function LivenessDetection_templateObject5(){var data=LivenessDetection_taggedTemplateLiteral(["\n      bottom: ","px;\n    "]);return LivenessDetection_templateObject5=function _templateObject5(){return data},data}function LivenessDetection_templateObject4(){var data=LivenessDetection_taggedTemplateLiteral(["\n      top: ","px;\n    "]);return LivenessDetection_templateObject4=function _templateObject4(){return data},data}function LivenessDetection_templateObject3(){var data=LivenessDetection_taggedTemplateLiteral(["\n  ","\n  ","\n  ","\n  ","\n  font-size: 18px;\n  background: #ea3223;\n  color: #fff;\n  padding: 5px 10px;\n  border-radius: 3px;\n  position: absolute;\n  white-space: pre-wrap;\n  text-align: center;\n  max-width: 80%;\n"]);return LivenessDetection_templateObject3=function _templateObject3(){return data},data}function LivenessDetection_templateObject2(){var data=LivenessDetection_taggedTemplateLiteral(["\n  ","\n"]);return LivenessDetection_templateObject2=function _templateObject2(){return data},data}function LivenessDetection_templateObject(){var data=LivenessDetection_taggedTemplateLiteral(["\n  z-index: ",";\n  color: #ffffff;\n"]);return LivenessDetection_templateObject=function _templateObject(){return data},data}function LivenessDetection_taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/LivenessDetection/CameraMask.js"]={name:"CameraMark",docgenInfo:CameraMark.__docgenInfo,path:"packages/tvweb-ui/src/LivenessDetection/CameraMask.js"});var textStyle=Object(styled_components_browser_esm.b)(LivenessDetection_templateObject(),Camera.a+20),Text=styled_components_browser_esm.c.div(LivenessDetection_templateObject2(),textStyle),LivenessDetection_LivenessDetection_FaceDetectionError=Object(styled_components_browser_esm.c)(LivenessDetection_FaceDetectionError)(LivenessDetection_templateObject3(),textStyle,(function(_ref){var top=_ref.top;return top&&Object(styled_components_browser_esm.b)(LivenessDetection_templateObject4(),top)}),(function(_ref2){var bottom=_ref2.bottom;return bottom&&Object(styled_components_browser_esm.b)(LivenessDetection_templateObject5(),bottom)}),(function(_ref3){return _ref3.centerY&&Object(styled_components_browser_esm.b)(LivenessDetection_templateObject6())})),CountdownTime=Object(styled_components_browser_esm.c)(Text)(LivenessDetection_templateObject7(),(function(_ref4){var top=_ref4.top;return top&&Object(styled_components_browser_esm.b)(_templateObject8(),top)})),FaceVerificationInstructions=Object(styled_components_browser_esm.c)(Text)(_templateObject9(),(function(_ref5){var top=_ref5.top;return top&&Object(styled_components_browser_esm.b)(_templateObject10(),top)}),(function(_ref6){var bottom=_ref6.bottom;return bottom&&Object(styled_components_browser_esm.b)(_templateObject11(),bottom)}),(function(){return dist.isMobile?"20px":"22px"})),FaceVerificationStepsWrapper=styled_components_browser_esm.c.div(_templateObject12(),(function(){return dist.isMobile?"50px":"70px"}),(function(_ref7){var top=_ref7.top;return top&&Object(styled_components_browser_esm.b)(_templateObject13(),top)}),(function(_ref8){var bottom=_ref8.bottom;return bottom&&Object(styled_components_browser_esm.b)(_templateObject14(),bottom)}),Camera.a+20),StepItem=styled_components_browser_esm.c.div(_templateObject15(),(function(){return dist.isMobile?"40px":"50px"}),(function(){return dist.isMobile?"40px":"50px"}),(function(props){return!props.active&&Object(styled_components_browser_esm.b)(_templateObject16())})),BottomButtonsOverlay=styled_components_browser_esm.c.div(_templateObject17(),Camera.a+20),Button=styled_components_browser_esm.c.div(_templateObject18()),CountDownOverlay=styled_components_browser_esm.c.div(_templateObject19()),InstructionsOverlay=styled_components_browser_esm.c.div(_templateObject20()),OverlayProgressCircle=Object(styled_components_browser_esm.c)(ProgressCircle.a)(_templateObject21()),StyledCameraMark=Object(styled_components_browser_esm.c)(CameraMask)(_templateObject22(),(function(_ref9){var color=_ref9.color;return null!=color?color:"rgba(0, 0, 0, 0.6)"})),ErrorOverlay=styled_components_browser_esm.c.div(_templateObject23()),blinkAnimation=Object(styled_components_browser_esm.d)(_templateObject24()),CapturingOverlay=styled_components_browser_esm.c.div(_templateObject25(),blinkAnimation),videoSettings=dist.isMobile?{width:640}:null,LivenessDetection_surroundStyle={background:"#000000",opacity:.6};function LivenessDetection(props){var apiCheck=props.apiCheck,mode=props.mode,onLivenessDetectionDone=props.onLivenessDetectionDone,onClose=props.onClose,onError=props.onError,captureFrameData=props.captureFrameData,frontCamera=props.frontCamera,customDirectionIcon=props.customDirectionIcon,customStepTimeConstraints=props.customStepTimeConstraints,onApiCheck=props.onApiCheck,customErrors=props.customErrors,framesIntervalTime=props.framesIntervalTime,livenessSettings=props.livenessSettings,bgCameraMask=tvweb_core_esm.a.useAsset("bg_camera_mask.png"),bgCameraMaskRed=tvweb_core_esm.a.useAsset("bg_camera_mask_red.png"),_useState2=LivenessDetection_slicedToArray(Object(react.useState)({}),2),uiSpacing=_useState2[0],setUISpacing=_useState2[1],yFaceDetectionError=uiSpacing.yFaceDetectionError,yFaceVerificationStepsWrapper=uiSpacing.yFaceVerificationStepsWrapper,_useState4=LivenessDetection_slicedToArray(Object(react.useState)(""),2),remainingTime=_useState4[0],setRemainingTime=_useState4[1],cropAreaDimension=Object(react.useCallback)((function(_ref10){var lostY=_ref10.lostY,height=_ref10.height,yFaceDetectionErrorNew=lostY+25,yCropAreaNew=yFaceDetectionErrorNew+30;return setUISpacing({yFaceDetectionError:yFaceDetectionErrorNew,yFaceVerificationStepsWrapper:yCropAreaNew+height+20}),{y:Math.floor(yCropAreaNew)}}),[]),_useLivenessDetection=LivenessDetection_useLivenessDetection({apiCheck:apiCheck,mode:mode,bgCameraMask:bgCameraMask,bgCameraMaskRed:bgCameraMaskRed,surroundStyle:LivenessDetection_surroundStyle,onLivenessDetectionDone:onLivenessDetectionDone,onError:onError,cropAreaDimension:cropAreaDimension,customDirectionIcon:customDirectionIcon,captureFrameData:captureFrameData,livenessSettings:livenessSettings,setRemainingTime:setRemainingTime,customStepTimeConstraints:customStepTimeConstraints,onApiCheck:onApiCheck,customErrors:customErrors,framesIntervalTime:framesIntervalTime}),countdownToTakePicture=_useLivenessDetection.countdownToTakePicture,cropArea=_useLivenessDetection.cropArea,curStepIndex=_useLivenessDetection.curStepIndex,directionIcon=_useLivenessDetection.directionIcon,faceDetectionError=_useLivenessDetection.faceDetectionError,handleTriggerPassiveMode=_useLivenessDetection.handleTriggerPassiveMode,handleVideoPlayed=_useLivenessDetection.handleVideoPlayed,instructions=_useLivenessDetection.instructions,isActiveMode=_useLivenessDetection.isActiveMode,refVideo=_useLivenessDetection.refVideo,showCountdown=_useLivenessDetection.showCountdown,steps=_useLivenessDetection.steps,videoPlayed=_useLivenessDetection.videoPlayed,activeCapturing=_useLivenessDetection.activeCapturing,isFirstValidFrameFound=_useLivenessDetection.isFirstValidFrameFound;return Object(jsx_runtime.jsx)(Camera.b,{frontCamera:frontCamera,onVideoPlayed:handleVideoPlayed,onClose:onClose,flipHorizontal:frontCamera,ref:refVideo,videoSettings:videoSettings,onError:onError,children:videoPlayed?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(LivenessDetection_LivenessDetection_FaceDetectionError,{top:yFaceDetectionError-15,className:"face-detection-error",children:faceDetectionError}),cropArea.current?Object(jsx_runtime.jsxs)(CropArea.a,{x:"".concat(cropArea.current.x,"px"),y:"".concat(cropArea.current.y,"px"),width:"".concat(cropArea.current.width,"px"),height:"".concat(cropArea.current.height,"px"),surroundStyle:cropArea.current.surroundStyle,children:[Object(jsx_runtime.jsx)(StyledCameraMark,{}),Object(jsx_runtime.jsx)(OverlayProgressCircle,{progress:curStepIndex/steps.length*100,hasError:!!faceDetectionError,showDashedRing:!1,showOutsideRing:!1,insideRingWidth:1,errorRingWidth:1,insideRingStrokeDash:"2"}),showCountdown?Object(jsx_runtime.jsx)(CountDownOverlay,{children:countdownToTakePicture}):null,isActiveMode?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(InstructionsOverlay,{children:directionIcon}),activeCapturing&&Object(jsx_runtime.jsx)(CapturingOverlay,{})]}):null,faceDetectionError&&Object(jsx_runtime.jsx)(ErrorOverlay,{})]}):null,isActiveMode?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[remainingTime&&Object(jsx_runtime.jsx)(CountdownTime,{top:yFaceVerificationStepsWrapper-30,children:remainingTime}),instructions?Object(jsx_runtime.jsx)(FaceVerificationInstructions,{top:yFaceVerificationStepsWrapper+5,className:"instructions",children:instructions}):null,isFirstValidFrameFound&&Object(jsx_runtime.jsx)(FaceVerificationStepsWrapper,{top:yFaceVerificationStepsWrapper+35,children:steps.map((function(step,index){var name=step.name,objUrl=step.image.objUrl;return Object(jsx_runtime.jsx)(StepItem,{active:curStepIndex>=index,className:"step-item",children:objUrl?Object(jsx_runtime.jsx)("img",{src:objUrl,alt:""}):Object(jsx_runtime.jsx)("span",{children:index+1})},name)}))})]}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:faceDetectionError?null:Object(jsx_runtime.jsx)(BottomButtonsOverlay,{children:Object(jsx_runtime.jsx)(Button,{onClick:handleTriggerPassiveMode,children:Object(jsx_runtime.jsx)(Icon_Camera.a,{})})})})]}):null})}LivenessDetection.displayName="LivenessDetection",LivenessDetection.propTypes={apiCheck:prop_types_default.a.bool,mode:prop_types_default.a.string,onLivenessDetectionDone:prop_types_default.a.func,onClose:prop_types_default.a.func,onError:prop_types_default.a.func,captureFrameData:prop_types_default.a.bool,frontCamera:prop_types_default.a.bool,customDirectionIcon:prop_types_default.a.shape({}),customStepTimeConstraints:prop_types_default.a.shape({}),onApiCheck:prop_types_default.a.func,customErrors:prop_types_default.a.shape({}),framesIntervalTime:prop_types_default.a.number,livenessSettings:prop_types_default.a.shape({})},LivenessDetection.defaultProps={apiCheck:!1,mode:null,onLivenessDetectionDone:null,onClose:null,onError:function onError(){},captureFrameData:!1,frontCamera:!0,customDirectionIcon:(_customDirectionIcon={},LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.LEFT,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.LEFT})),LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.RIGHT,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.RIGHT})),LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.UP,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.UP})),LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.FRONTAL,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.FRONTAL})),_customDirectionIcon),customStepTimeConstraints:(_customStepTimeConstr={},LivenessDetection_defineProperty(_customStepTimeConstr,tvweb_core_esm.e.FaceDirection.UP,{delayTime:1e3}),LivenessDetection_defineProperty(_customStepTimeConstr,tvweb_core_esm.e.FaceDirection.LEFT,{delayTime:1e3}),LivenessDetection_defineProperty(_customStepTimeConstr,tvweb_core_esm.e.FaceDirection.RIGHT,{delayTime:1e3}),LivenessDetection_defineProperty(_customStepTimeConstr,tvweb_core_esm.e.FaceDirection.FRONTAL,{delayTime:2e3}),_customStepTimeConstr),onApiCheck:function onApiCheck(){},customErrors:null,framesIntervalTime:180,livenessSettings:null},LivenessDetection.__docgenInfo={description:"",methods:[],displayName:"LivenessDetection",props:{apiCheck:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},mode:{defaultValue:{value:"null",computed:!1},type:{name:"string"},required:!1,description:""},onLivenessDetectionDone:{defaultValue:{value:"null",computed:!1},type:{name:"func"},required:!1,description:""},onClose:{defaultValue:{value:"null",computed:!1},type:{name:"func"},required:!1,description:""},onError:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""},captureFrameData:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},frontCamera:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:""},customDirectionIcon:{defaultValue:{value:"{\n  [Constants.FaceDirection.LEFT]: <DirectionIcon type={Constants.FaceDirection.LEFT} />,\n  [Constants.FaceDirection.RIGHT]: <DirectionIcon type={Constants.FaceDirection.RIGHT} />,\n  [Constants.FaceDirection.UP]: <DirectionIcon type={Constants.FaceDirection.UP} />,\n  [Constants.FaceDirection.FRONTAL]: <DirectionIcon type={Constants.FaceDirection.FRONTAL} />,\n}",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},customStepTimeConstraints:{defaultValue:{value:"{\n  [Constants.FaceDirection.UP]: { delayTime: 1000 },\n  [Constants.FaceDirection.LEFT]: { delayTime: 1000 },\n  [Constants.FaceDirection.RIGHT]: { delayTime: 1000 },\n  [Constants.FaceDirection.FRONTAL]: { delayTime: 2000 },\n}",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},onApiCheck:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""},customErrors:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},framesIntervalTime:{defaultValue:{value:"180",computed:!1},type:{name:"number"},required:!1,description:""},livenessSettings:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{}},required:!1,description:""}}};var LivenessDetection_LivenessDetection=LivenessDetection;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/LivenessDetection/LivenessDetection.js"]={name:"LivenessDetection",docgenInfo:LivenessDetection.__docgenInfo,path:"packages/tvweb-ui/src/LivenessDetection/LivenessDetection.js"});var Popup=__webpack_require__(316);function OrientationDetection_slicedToArray(arr,i){return function OrientationDetection_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function OrientationDetection_iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function OrientationDetection_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return OrientationDetection_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return OrientationDetection_arrayLikeToArray(o,minLen)}(arr,i)||function OrientationDetection_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function OrientationDetection_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var MODE_LANDSCAPE="landscape",MODE_PORTRAIT="portrait",MODE_DESKTOP="desktop",OrientationDetection=function useDetectOrientation(){var initOrientation=Object(react.useRef)(window.innerWidth>window.innerHeight?MODE_LANDSCAPE:MODE_PORTRAIT),_useState2=OrientationDetection_slicedToArray(Object(react.useState)(initOrientation.current),2),curOrientation=_useState2[0],setCurOrientation=_useState2[1];return Object(react.useEffect)((function(){function handleResize(){window.innerWidth>window.innerHeight?setCurOrientation(MODE_LANDSCAPE):setCurOrientation(MODE_PORTRAIT)}return window.addEventListener("resize",handleResize),function(){window.removeEventListener("resize",handleResize)}}),[]),dist.isMobile?{curOrientation:curOrientation,initOrientation:initOrientation.current}:{curOrientation:MODE_DESKTOP}};function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function src_LivenessDetection_templateObject(){var data=function src_LivenessDetection_taggedTemplateLiteral(strings,raw){raw||(raw=strings.slice(0));return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}(["\n  text-align: center;\n  font-size: 20px;\n  font-weight: 600;\n"]);return src_LivenessDetection_templateObject=function _templateObject(){return data},data}var LivenessDetection_Errors=tvweb_core_esm.e.Errors,PopupContent=styled_components_browser_esm.c.div(src_LivenessDetection_templateObject()),src_LivenessDetection=function(_ref){var props=_extends({},_ref),lang=tvweb_core_esm.m.useSDKSettings().lang,errMsg=LivenessDetection_Errors.wrong_orientation.msg[lang],curOrientation=OrientationDetection().curOrientation;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[curOrientation===MODE_LANDSCAPE&&Object(jsx_runtime.jsx)(Popup.a,{open:!0,children:Object(jsx_runtime.jsx)(PopupContent,{children:errMsg})}),(curOrientation===MODE_PORTRAIT||curOrientation===MODE_DESKTOP)&&Object(jsx_runtime.jsx)(LivenessDetection_LivenessDetection,Object.assign({},props))]})},LivenessDetection_stories_apiClient=new trustvision_sdk_umd_default.a("5767c20d-87aa-4cad-8dbb-f5429f76c34b","c1446919-e60a-4575-a05d-304318212a1b","https://tv-testing.trustingsocial.com/api"),LivenessDetection_stories_ActiveMode=function ActiveMode(){return Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:"/tvweb-sdk/assets",apiClient:LivenessDetection_stories_apiClient},children:Object(jsx_runtime.jsx)(src_LivenessDetection,{apiCheck:!1,mode:tvweb_core_esm.e.Mode.ACTIVE,onLivenessDetectionDone:console.log,onClose:console.log,onError:console.log,captureFrameData:!0,livenessSettings:{face_tracking_setting:{enable:!0,web_terminate_threshold:.0030152991993743408,web_warning_threshold:.0017317430600108828,limit_for:"all_flow",max_warning_time:5},flow_interval_time_ms:3e3,limit_time_liveness_check:{enable:!0,limit_time_second:15},terminate_if_no_face:{enable:!0,max_invalid_frame:5,max_time_ms:1e3}}})})};LivenessDetection_stories_ActiveMode.displayName="ActiveMode";var LivenessDetection_stories_PassiveMode=function PassiveMode(){return Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:"/tvweb-sdk/assets",apiClient:LivenessDetection_stories_apiClient},children:Object(jsx_runtime.jsx)(src_LivenessDetection,{apiCheck:!1,mode:tvweb_core_esm.e.Mode.PASSIVE,onLivenessDetectionDone:console.log,onClose:console.log,onError:console.log})})};LivenessDetection_stories_PassiveMode.displayName="PassiveMode";__webpack_exports__.default={title:"[Default] Liveness Detection"};LivenessDetection_stories_ActiveMode.parameters=Object.assign({storySource:{source:"function ActiveMode() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: 'vi', assetRoot, apiClient }}>\n      <LivenessDetection\n        apiCheck={false}\n        mode={Constants.Mode.ACTIVE}\n        onLivenessDetectionDone={console.log}\n        onClose={console.log}\n        onError={console.log}\n        captureFrameData\n        livenessSettings={{\n          face_tracking_setting: {\n            enable: true,\n            web_terminate_threshold: 0.0030152991993743408,\n            web_warning_threshold: 0.0017317430600108828,\n            limit_for: 'all_flow',\n            max_warning_time: 5,\n          },\n          flow_interval_time_ms: 3000,\n          limit_time_liveness_check: {\n            enable: true,\n            limit_time_second: 15,\n          },\n          terminate_if_no_face: {\n            enable: true,\n            max_invalid_frame: 5,\n            max_time_ms: 1000,\n          },\n        }}\n      />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}"}},LivenessDetection_stories_ActiveMode.parameters),LivenessDetection_stories_PassiveMode.parameters=Object.assign({storySource:{source:"function PassiveMode() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: 'vi', assetRoot, apiClient }}>\n      <LivenessDetection\n        apiCheck={false}\n        mode={Constants.Mode.PASSIVE}\n        onLivenessDetectionDone={console.log}\n        onClose={console.log}\n        onError={console.log}\n      />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}"}},LivenessDetection_stories_PassiveMode.parameters),LivenessDetection_stories_ActiveMode.__docgenInfo={description:"",methods:[],displayName:"ActiveMode"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/LivenessDetection/LivenessDetection.stories.js"]={name:"ActiveMode",docgenInfo:LivenessDetection_stories_ActiveMode.__docgenInfo,path:"packages/tvweb-ui/src/LivenessDetection/LivenessDetection.stories.js"}),LivenessDetection_stories_PassiveMode.__docgenInfo={description:"",methods:[],displayName:"PassiveMode"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/LivenessDetection/LivenessDetection.stories.js"]={name:"PassiveMode",docgenInfo:LivenessDetection_stories_PassiveMode.__docgenInfo,path:"packages/tvweb-ui/src/LivenessDetection/LivenessDetection.stories.js"})},1749:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ActiveMode",(function(){return LivenessDetection_stories_ActiveMode})),__webpack_require__.d(__webpack_exports__,"PassiveMode",(function(){return LivenessDetection_stories_PassiveMode})),__webpack_require__.d(__webpack_exports__,"ShowInstructionAnimation",(function(){return LivenessDetection_stories_ShowInstructionAnimation})),__webpack_require__.d(__webpack_exports__,"MAFCActiveMode",(function(){return LivenessDetection_stories_MAFCActiveMode})),__webpack_require__.d(__webpack_exports__,"MAFCActiveModeImproved",(function(){return LivenessDetection_stories_MAFCActiveModeImproved}));__webpack_require__(63),__webpack_require__(24),__webpack_require__(19),__webpack_require__(15),__webpack_require__(22),__webpack_require__(27),__webpack_require__(64),__webpack_require__(30),__webpack_require__(194);var jsx_runtime=__webpack_require__(5),react=__webpack_require__(1),react_default=__webpack_require__.n(react),tvweb_core_esm=__webpack_require__(8),styled_components_browser_esm=(__webpack_require__(18),__webpack_require__(25),__webpack_require__(32),__webpack_require__(21),__webpack_require__(37),__webpack_require__(39),__webpack_require__(10)),prop_types=__webpack_require__(4),prop_types_default=__webpack_require__.n(prop_types),tvweb_ui_esm=__webpack_require__(51);function CameraMark(_ref){var className=_ref.className;return Object(jsx_runtime.jsx)("svg",{className:className,width:"320",height:"320",viewBox:"0 0 320 320",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(jsx_runtime.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M320 0H0V320H320V0ZM160 296C235.111 296 296 235.111 296 160C296 84.8893 235.111 24 160 24C84.8893 24 24 84.8893 24 160C24 235.111 84.8893 296 160 296Z",fill:"currentColor"})})}CameraMark.displayName="CameraMark",CameraMark.propTypes={className:prop_types_default.a.string},CameraMark.defaultProps={className:""},CameraMark.__docgenInfo={description:"",methods:[],displayName:"CameraMark",props:{className:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""}}};var CameraMask=CameraMark;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.dop/src/LivenessDetection/CameraMask.js"]={name:"CameraMark",docgenInfo:CameraMark.__docgenInfo,path:"packages/tvweb-sdk.dop/src/LivenessDetection/CameraMask.js"});var _ANGLE;__webpack_require__(61);function _templateObject7(){var data=_taggedTemplateLiteral(["\n  animation-delay: 1s;\n"]);return _templateObject7=function _templateObject7(){return data},data}function _templateObject6(){var data=_taggedTemplateLiteral(["\n  animation-delay: 0.5s;\n"]);return _templateObject6=function _templateObject6(){return data},data}function _templateObject5(){var data=_taggedTemplateLiteral(["\n  animation-delay: 0s;\n"]);return _templateObject5=function _templateObject5(){return data},data}function _templateObject4(){var data=_taggedTemplateLiteral(["\n  display: flex;\n  margin: 4px 0;\n  width: 100%;\n  height: 15px;\n  animation: "," 1s infinite;\n  animation-direction: alternate;\n\n  &::before,\n  &::after {\n    content: '';\n    height: 100%;\n    width: 50%;\n    background: rgba(255, 255, 255, 0.8);\n  }\n\n  &::before {\n    transform: skewY(32deg);\n  }\n\n  &::after {\n    width: 50%;\n    transform: skewY(-32deg);\n  }\n"]);return _templateObject4=function _templateObject4(){return data},data}function _templateObject3(){var data=_taggedTemplateLiteral(["\n  width: 70px;\n  transform: rotate(","deg);\n"]);return _templateObject3=function _templateObject3(){return data},data}function _templateObject2(){var data=_taggedTemplateLiteral(["\n  width: 200px;\n  height: 200px;\n  position: relative;\n  transform: scale(0.48);\n\n  .top,\n  .right,\n  .bottom,\n  .left {\n    position: absolute;\n  }\n\n  .top {\n    top: 0;\n    left: 50%;\n    transform: rotate(","deg) translateX(-50%);\n  }\n\n  .right {\n    right: 0;\n    top: 50%;\n    transform: rotate(","deg) translateX(-50%);\n  }\n\n  .bottom {\n    bottom: 0;\n    left: 50%;\n    transform: rotate(","deg) translateX(50%);\n  }\n\n  .left {\n    left: 0;\n    top: 50%;\n    transform: rotate(","deg) translateX(50%);\n  }\n"]);return _templateObject2=function _templateObject2(){return data},data}function _templateObject(){var data=_taggedTemplateLiteral(["\n  0% {\n    opacity: 0.15;\n  }\n  50% {\n    opacity: 0.3;\n  }\n  100% {\n    opacity: 1;\n  }\n"]);return _templateObject=function _templateObject(){return data},data}function _taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var ANGLE=(_defineProperty(_ANGLE={},tvweb_core_esm.e.FaceDirection.LEFT,90),_defineProperty(_ANGLE,tvweb_core_esm.e.FaceDirection.RIGHT,270),_defineProperty(_ANGLE,tvweb_core_esm.e.FaceDirection.UP,180),_defineProperty(_ANGLE,tvweb_core_esm.e.FaceDirection.DOWN,0),_ANGLE),arrowScroll=Object(styled_components_browser_esm.d)(_templateObject()),FrontalWrapper=styled_components_browser_esm.c.div(_templateObject2(),ANGLE[tvweb_core_esm.e.FaceDirection.DOWN],ANGLE[tvweb_core_esm.e.FaceDirection.LEFT],ANGLE[tvweb_core_esm.e.FaceDirection.UP],ANGLE[tvweb_core_esm.e.FaceDirection.RIGHT]),ArrowWrapper=styled_components_browser_esm.c.div(_templateObject3(),(function(_ref){var _ANGLE$direction,direction=_ref.direction;return null!==(_ANGLE$direction=ANGLE[direction])&&void 0!==_ANGLE$direction?_ANGLE$direction:0})),Arrow=styled_components_browser_esm.c.span(_templateObject4(),arrowScroll),FirstArrow=Object(styled_components_browser_esm.c)(Arrow)(_templateObject5()),SecondArrow=Object(styled_components_browser_esm.c)(Arrow)(_templateObject6()),ThirdArrow=Object(styled_components_browser_esm.c)(Arrow)(_templateObject7());function DirectionIcon(_ref2){var type=_ref2.type;return type!==tvweb_core_esm.e.FaceDirection.FRONTAL?Object(jsx_runtime.jsxs)(ArrowWrapper,{direction:type,children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}):Object(jsx_runtime.jsxs)(FrontalWrapper,{children:[Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"top",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}),Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"right",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}),Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"bottom",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}),Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"left",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]})]})}DirectionIcon.displayName="DirectionIcon",DirectionIcon.propTypes={type:prop_types_default.a.oneOf([tvweb_core_esm.e.FaceDirection.LEFT,tvweb_core_esm.e.FaceDirection.RIGHT,tvweb_core_esm.e.FaceDirection.UP,tvweb_core_esm.e.FaceDirection.FRONTAL])},DirectionIcon.defaultProps={type:tvweb_core_esm.e.FaceDirection.LEFT},DirectionIcon.__docgenInfo={description:"",methods:[],displayName:"DirectionIcon",props:{type:{defaultValue:{value:"Constants.FaceDirection.LEFT",computed:!0},type:{name:"enum",value:[{value:"Constants.FaceDirection.LEFT",computed:!0},{value:"Constants.FaceDirection.RIGHT",computed:!0},{value:"Constants.FaceDirection.UP",computed:!0},{value:"Constants.FaceDirection.FRONTAL",computed:!0}]},required:!1,description:""}}};var _customDirectionIcon,LivenessDetection_DirectionIcon=DirectionIcon;function LivenessDetection_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _templateObject18(){var data=LivenessDetection_taggedTemplateLiteral(["\n  background: rgba(255, 255, 255, 0.3);\n  animation: "," 1s infinite;\n"]);return _templateObject18=function _templateObject18(){return data},data}function _templateObject17(){var data=LivenessDetection_taggedTemplateLiteral(["\n  from {\n    opacity: 1;\n  }\n\n  to {\n    opacity: 0;\n  }\n"]);return _templateObject17=function _templateObject17(){return data},data}function _templateObject16(){var data=LivenessDetection_taggedTemplateLiteral(["\n  background: rgba(223, 0, 0, 0.2);\n"]);return _templateObject16=function _templateObject16(){return data},data}function _templateObject15(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  width: 100%;\n  top: 0;\n  bottom: 0;\n  z-index: -1;\n"]);return _templateObject15=function _templateObject15(){return data},data}function _templateObject14(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n"]);return _templateObject14=function _templateObject14(){return data},data}function _templateObject13(){var data=LivenessDetection_taggedTemplateLiteral(["\n      border-color: #f2f6f9;\n      opacity: 0.3;\n    "]);return _templateObject13=function _templateObject13(){return data},data}function _templateObject12(){var data=LivenessDetection_taggedTemplateLiteral(["\n  width: 50px;\n  height: 50px;\n  border: 1px solid #005993;\n  border-radius: 50%;\n\n  & + & {\n    margin-left: 10px;\n  }\n\n  ","\n"]);return _templateObject12=function _templateObject12(){return data},data}function _templateObject11(){var data=LivenessDetection_taggedTemplateLiteral(["\n        width: 42px;\n      "]);return _templateObject11=function _templateObject11(){return data},data}function _templateObject10(){var data=LivenessDetection_taggedTemplateLiteral(["\n  && {\n    width: 20px;\n    border-radius: 50%;\n    margin: 0;\n\n    ","\n  }\n"]);return _templateObject10=function _templateObject10(){return data},data}function _templateObject9(){var data=LivenessDetection_taggedTemplateLiteral(["\n  width: 100%;\n  height: 100%;\n  vertical-align: middle;\n  margin: 0;\n  color: ",";\n"]);return _templateObject9=function _templateObject9(){return data},data}function _templateObject8(){var data=LivenessDetection_taggedTemplateLiteral(["\n      font-size: 0.875rem;\n    "]);return _templateObject8=function _templateObject8(){return data},data}function LivenessDetection_templateObject7(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  font-size: 1.125rem;\n  text-align: center;\n  padding: 0 1.75rem;\n  color: ",";\n  text-shadow: none;\n\n  ",";\n"]);return LivenessDetection_templateObject7=function _templateObject7(){return data},data}function LivenessDetection_templateObject6(){var data=LivenessDetection_taggedTemplateLiteral(["\n      font-size: 0.875rem;\n    "]);return LivenessDetection_templateObject6=function _templateObject6(){return data},data}function LivenessDetection_templateObject5(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  font-size: 1.125rem;\n  text-align: center;\n\n  ",";\n"]);return LivenessDetection_templateObject5=function _templateObject5(){return data},data}function LivenessDetection_templateObject4(){var data=LivenessDetection_taggedTemplateLiteral(["\n      font-size: 1.125rem;\n    "]);return LivenessDetection_templateObject4=function _templateObject4(){return data},data}function LivenessDetection_templateObject3(){var data=LivenessDetection_taggedTemplateLiteral(["\n      top: ","px;\n    "]);return LivenessDetection_templateObject3=function _templateObject3(){return data},data}function LivenessDetection_templateObject2(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  font-style: normal;\n  font-weight: bold;\n  font-size: 1.5rem;\n  text-align: center;\n  padding: 0 1.75rem;\n  color: ",";\n\n  ","\n\n  ",";\n"]);return LivenessDetection_templateObject2=function _templateObject2(){return data},data}function LivenessDetection_templateObject(){var data=LivenessDetection_taggedTemplateLiteral(["\n  height: 50px;\n"]);return LivenessDetection_templateObject=function _templateObject(){return data},data}function LivenessDetection_taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.dop/src/LivenessDetection/DirectionIcon.js"]={name:"DirectionIcon",docgenInfo:DirectionIcon.__docgenInfo,path:"packages/tvweb-sdk.dop/src/LivenessDetection/DirectionIcon.js"});var heightBreaks_sm=650,heightBreaks_md=750,CameraIcon=tvweb_ui_esm.c.Camera,BaseText=tvweb_ui_esm.d.Text,BaseFaceDetectionError=tvweb_ui_esm.d.FaceDetectionError,BaseFaceVerificationInstructions=tvweb_ui_esm.d.FaceVerificationInstructions,BaseFaceVerificationStepsWrapper=tvweb_ui_esm.d.FaceVerificationStepsWrapper,BaseStepItem=tvweb_ui_esm.d.StepItem,BottomButtonsOverlay=tvweb_ui_esm.d.BottomButtonsOverlay,Button=tvweb_ui_esm.d.Button,CountDownOverlay=tvweb_ui_esm.d.CountDownOverlay,InstructionsOverlay=tvweb_ui_esm.d.InstructionsOverlay,FaceVerificationStepsWrapper=Object(styled_components_browser_esm.c)(BaseFaceVerificationStepsWrapper)(LivenessDetection_templateObject()),Title=Object(styled_components_browser_esm.c)(BaseText)(LivenessDetection_templateObject2(),(function(_ref){return _ref.color}),(function(_ref2){var top=_ref2.top;return top&&Object(styled_components_browser_esm.b)(LivenessDetection_templateObject3(),top)}),(function(_ref3){return _ref3.isMobile&&Object(styled_components_browser_esm.b)(LivenessDetection_templateObject4())})),ErrorText=Object(styled_components_browser_esm.c)(BaseFaceDetectionError)(LivenessDetection_templateObject5(),(function(_ref4){return _ref4.isMobile&&Object(styled_components_browser_esm.b)(LivenessDetection_templateObject6())})),InstructionText=Object(styled_components_browser_esm.c)(BaseFaceVerificationInstructions)(LivenessDetection_templateObject7(),(function(_ref5){return _ref5.color}),(function(_ref6){return _ref6.isMobile&&Object(styled_components_browser_esm.b)(_templateObject8())})),StyledCameraMark=Object(styled_components_browser_esm.c)(CameraMask)(_templateObject9(),(function(_ref7){var color=_ref7.color;return null!=color?color:"#06243c"})),StepItemImage=styled_components_browser_esm.c.img(_templateObject10(),(function(_ref8){return"preview"===_ref8.mode&&Object(styled_components_browser_esm.b)(_templateObject11())})),StepItem=Object(styled_components_browser_esm.c)(BaseStepItem)(_templateObject12(),(function(props){return!props.active&&Object(styled_components_browser_esm.b)(_templateObject13())})),OverlayProgressCircle=Object(styled_components_browser_esm.c)(tvweb_ui_esm.f)(_templateObject14()),Overlay=styled_components_browser_esm.c.div(_templateObject15()),ErrorOverlay=Object(styled_components_browser_esm.c)(Overlay)(_templateObject16()),blinkAnimation=Object(styled_components_browser_esm.d)(_templateObject17()),CapturingOverlay=Object(styled_components_browser_esm.c)(Overlay)(_templateObject18(),blinkAnimation),videoSettings=tvweb_ui_esm.e.isMobile?{width:640}:null;function LivenessDetection(_ref9){var className=_ref9.className,apiCheck=_ref9.apiCheck,enableRecording=_ref9.enableRecording,enableInstructionsOverlay=_ref9.enableInstructionsOverlay,enableErrorOverlay=_ref9.enableErrorOverlay,enableCapturingOverlay=_ref9.enableCapturingOverlay,frontalMinSize=_ref9.frontalMinSize,mode=_ref9.mode,minPadding=_ref9.minPadding,backgroundColor=_ref9.backgroundColor,textColor=_ref9.textColor,progressProps=_ref9.progressProps,title=_ref9.title,description=_ref9.description,customInstructions=_ref9.customInstructions,customIcon=_ref9.customIcon,customDirectionIcon=_ref9.customDirectionIcon,onLivenessDetectionDone=_ref9.onLivenessDetectionDone,onClose=_ref9.onClose,onError=_ref9.onError,getCropAreaDimension=Object(react.useCallback)((function(_ref10){var clientWidth=_ref10.clientWidth,clientHeight=_ref10.clientHeight,videoAreaWidth=_ref10.videoAreaWidth,videoAreaHeight=_ref10.videoAreaHeight,lostX=_ref10.lostX,lostY=_ref10.lostY,paddingTop=Math.max(80,lostY),paddingBottom=Math.max(140,lostY);clientHeight>heightBreaks_sm&&(paddingTop=Math.max(110,lostY),paddingBottom=Math.max(170,lostY)),clientHeight>heightBreaks_md&&(paddingTop=Math.max(140,lostY),paddingBottom=Math.max(200,lostY));var paddingLeft=Math.max(minPadding,lostX),paddingRight=Math.max(minPadding,lostX),minSize=Math.min(videoAreaWidth,videoAreaHeight),cropSize=Math.max(Math.floor(Math.min(clientWidth-(paddingLeft+paddingRight),clientHeight-(paddingTop+paddingBottom),minSize)),160);return{x:Math.min(Math.floor(paddingLeft+(clientWidth-paddingRight-paddingLeft)/2-cropSize/2),clientWidth-cropSize),y:Math.min(Math.floor(paddingTop+(clientHeight-paddingBottom-paddingTop)/2-cropSize/2),clientHeight-cropSize),width:cropSize,height:cropSize}}),[minPadding]),surroundStyle=Object(react.useMemo)((function(){return{background:backgroundColor,opacity:1}}),[backgroundColor]),_useLivenessDetection=Object(tvweb_ui_esm.g)({apiCheck:apiCheck,enableRecording:enableRecording,frontalMinSize:frontalMinSize,mode:mode,bgCameraMask:null,bgCameraMaskRed:null,surroundStyle:surroundStyle,cropAreaDimension:getCropAreaDimension,customInstructions:customInstructions,customIcon:customIcon,customDirectionIcon:customDirectionIcon,onLivenessDetectionDone:onLivenessDetectionDone}),countdownToTakePicture=_useLivenessDetection.countdownToTakePicture,cropArea=_useLivenessDetection.cropArea,curStepIndex=_useLivenessDetection.curStepIndex,directionIcon=_useLivenessDetection.directionIcon,faceDetectionError=_useLivenessDetection.faceDetectionError,handleTriggerPassiveMode=_useLivenessDetection.handleTriggerPassiveMode,handleVideoPlayed=_useLivenessDetection.handleVideoPlayed,instructions=_useLivenessDetection.instructions,isActiveMode=_useLivenessDetection.isActiveMode,refVideo=_useLivenessDetection.refVideo,showCountdown=_useLivenessDetection.showCountdown,steps=_useLivenessDetection.steps,videoPlayed=_useLivenessDetection.videoPlayed,activeCapturing=_useLivenessDetection.activeCapturing,titleTop=10,instructionTop=45,faceDetectionErrorMarginTop=2,faceVerificationStepsHeight=50,faceVerificationStepsMarginBottom=12,faceVerificationStepsWrapperBottom=14;window.innerHeight>heightBreaks_sm&&(titleTop=25,instructionTop=65,faceDetectionErrorMarginTop=3,faceVerificationStepsHeight=50,faceVerificationStepsMarginBottom=24,faceVerificationStepsWrapperBottom=34),window.innerHeight>heightBreaks_md&&(titleTop=30,instructionTop=80,faceDetectionErrorMarginTop=5,faceVerificationStepsHeight=50,faceVerificationStepsMarginBottom=32,faceVerificationStepsWrapperBottom=54);var faceDetectionErrorTop=cropArea.current?cropArea.current.y+cropArea.current.height+faceDetectionErrorMarginTop:0,faceVerificationInstructionsBottom=faceVerificationStepsWrapperBottom+faceVerificationStepsHeight+faceVerificationStepsMarginBottom,showErrorOverlay=enableErrorOverlay&&faceDetectionError;function renderIcon(icon,props){return"string"==typeof icon?Object(jsx_runtime.jsx)(StepItemImage,{src:icon,alt:""}):react_default.a.cloneElement(icon,props)}return Object(jsx_runtime.jsx)(tvweb_ui_esm.a,{ref:refVideo,className:className,frontCamera:!0,flipHorizontal:!0,videoSettings:videoSettings,onVideoPlayed:handleVideoPlayed,onClose:onClose,onError:onError,children:videoPlayed?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(Title,{top:titleTop,isMobile:tvweb_ui_esm.e.isMobile,color:textColor,children:title}),cropArea.current?Object(jsx_runtime.jsxs)(tvweb_ui_esm.b,{x:"".concat(cropArea.current.x,"px"),y:"".concat(cropArea.current.y,"px"),width:"".concat(cropArea.current.width,"px"),height:"".concat(cropArea.current.height,"px"),surroundStyle:cropArea.current.surroundStyle,children:[Object(jsx_runtime.jsx)(StyledCameraMark,{color:backgroundColor}),Object(jsx_runtime.jsx)(OverlayProgressCircle,Object.assign({progress:curStepIndex/steps.length*100,hasError:showErrorOverlay},progressProps)),showCountdown?Object(jsx_runtime.jsx)(CountDownOverlay,{children:countdownToTakePicture}):null,isActiveMode&&enableInstructionsOverlay&&directionIcon?Object(jsx_runtime.jsx)(InstructionsOverlay,{children:directionIcon}):null,isActiveMode&&enableCapturingOverlay&&activeCapturing?Object(jsx_runtime.jsx)(CapturingOverlay,{}):null,showErrorOverlay?Object(jsx_runtime.jsx)(ErrorOverlay,{}):null]}):null,faceDetectionError?Object(jsx_runtime.jsx)(ErrorText,{top:faceDetectionErrorTop,isMobile:tvweb_ui_esm.e.isMobile,children:faceDetectionError}):null,isActiveMode?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(InstructionText,{top:instructionTop,isMobile:tvweb_ui_esm.e.isMobile,color:textColor,children:description}),instructions?Object(jsx_runtime.jsx)(InstructionText,{bottom:faceVerificationInstructionsBottom,isMobile:tvweb_ui_esm.e.isMobile,color:textColor,children:instructions}):null,Object(jsx_runtime.jsx)(FaceVerificationStepsWrapper,{bottom:faceVerificationStepsWrapperBottom,children:steps.map((function(step,index){var name=step.name,icon=step.icon,objUrl=step.image.objUrl,active=curStepIndex>=index;return Object(jsx_runtime.jsx)(StepItem,{active:active,children:objUrl?Object(jsx_runtime.jsx)(StepItemImage,{src:objUrl,alt:"",mode:"preview"}):renderIcon(icon,{active:active})},name)}))})]}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:faceDetectionError?null:Object(jsx_runtime.jsx)(BottomButtonsOverlay,{children:Object(jsx_runtime.jsx)(Button,{onClick:handleTriggerPassiveMode,children:Object(jsx_runtime.jsx)(CameraIcon,{})})})})]}):null})}LivenessDetection.displayName="LivenessDetection",LivenessDetection.propTypes={className:prop_types_default.a.string,apiCheck:prop_types_default.a.bool,enableRecording:prop_types_default.a.bool,enableInstructionsOverlay:prop_types_default.a.bool,enableErrorOverlay:prop_types_default.a.bool,enableCapturingOverlay:prop_types_default.a.bool,frontalMinSize:prop_types_default.a.number,mode:prop_types_default.a.string,minPadding:prop_types_default.a.number,backgroundColor:prop_types_default.a.string,textColor:prop_types_default.a.string,progressProps:prop_types_default.a.shape({className:prop_types_default.a.string,style:prop_types_default.a.shape({}),radius:prop_types_default.a.number,strokeWidth:prop_types_default.a.number,progress:prop_types_default.a.number,activeColor:prop_types_default.a.string,innerPadding:prop_types_default.a.number,outsideRingColor:prop_types_default.a.string,insideRingColor:prop_types_default.a.string,insideRingWidth:prop_types_default.a.number,dashedRingColor:prop_types_default.a.string,dashedRingWidth:prop_types_default.a.number,dashedRingLineThick:prop_types_default.a.number,dashedRingLineSpacing:prop_types_default.a.number,showOutsideRing:prop_types_default.a.bool,showDashedRing:prop_types_default.a.bool,showInsideRing:prop_types_default.a.bool}),title:prop_types_default.a.string,description:prop_types_default.a.string,customInstructions:prop_types_default.a.shape({}),customIcon:prop_types_default.a.shape({}),customDirectionIcon:prop_types_default.a.shape({}),onLivenessDetectionDone:prop_types_default.a.func,onClose:prop_types_default.a.func,onError:prop_types_default.a.func},LivenessDetection.defaultProps={className:"",apiCheck:!1,enableRecording:!1,enableInstructionsOverlay:!1,enableErrorOverlay:!1,enableCapturingOverlay:!1,frontalMinSize:720,mode:null,minPadding:30,backgroundColor:"#06243c",textColor:"#ffffff",progressProps:null,title:"Chụp ảnh chân dung",description:"Xin đưa khuôn mặt vào khung hình. Hình ảnh sẽ tự động được ghi lại.",customInstructions:null,customIcon:null,customDirectionIcon:(_customDirectionIcon={},LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.LEFT,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.LEFT})),LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.RIGHT,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.RIGHT})),LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.UP,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.UP})),LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.FRONTAL,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.FRONTAL})),_customDirectionIcon),onLivenessDetectionDone:null,onClose:null,onError:function onError(){}},LivenessDetection.__docgenInfo={description:"",methods:[],displayName:"LivenessDetection",props:{className:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""},apiCheck:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},enableRecording:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},enableInstructionsOverlay:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},enableErrorOverlay:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},enableCapturingOverlay:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},frontalMinSize:{defaultValue:{value:"720",computed:!1},type:{name:"number"},required:!1,description:""},mode:{defaultValue:{value:"null",computed:!1},type:{name:"string"},required:!1,description:""},minPadding:{defaultValue:{value:"30",computed:!1},type:{name:"number"},required:!1,description:""},backgroundColor:{defaultValue:{value:"'#06243c'",computed:!1},type:{name:"string"},required:!1,description:""},textColor:{defaultValue:{value:"'#ffffff'",computed:!1},type:{name:"string"},required:!1,description:""},progressProps:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{className:{name:"string",required:!1},style:{name:"shape",value:{},required:!1},radius:{name:"number",required:!1},strokeWidth:{name:"number",required:!1},progress:{name:"number",required:!1},activeColor:{name:"string",required:!1},innerPadding:{name:"number",required:!1},outsideRingColor:{name:"string",required:!1},insideRingColor:{name:"string",required:!1},insideRingWidth:{name:"number",required:!1},dashedRingColor:{name:"string",required:!1},dashedRingWidth:{name:"number",required:!1},dashedRingLineThick:{name:"number",required:!1},dashedRingLineSpacing:{name:"number",required:!1},showOutsideRing:{name:"bool",required:!1},showDashedRing:{name:"bool",required:!1},showInsideRing:{name:"bool",required:!1}}},required:!1,description:""},title:{defaultValue:{value:"'Chụp ảnh chân dung'",computed:!1},type:{name:"string"},required:!1,description:""},description:{defaultValue:{value:"'Xin đưa khuôn mặt vào khung hình. Hình ảnh sẽ tự động được ghi lại.'",computed:!1},type:{name:"string"},required:!1,description:""},customInstructions:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},customIcon:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},customDirectionIcon:{defaultValue:{value:"{\n  [Constants.FaceDirection.LEFT]: <DirectionIcon type={Constants.FaceDirection.LEFT} />,\n  [Constants.FaceDirection.RIGHT]: <DirectionIcon type={Constants.FaceDirection.RIGHT} />,\n  [Constants.FaceDirection.UP]: <DirectionIcon type={Constants.FaceDirection.UP} />,\n  [Constants.FaceDirection.FRONTAL]: <DirectionIcon type={Constants.FaceDirection.FRONTAL} />,\n}",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},onLivenessDetectionDone:{defaultValue:{value:"null",computed:!1},type:{name:"func"},required:!1,description:""},onClose:{defaultValue:{value:"null",computed:!1},type:{name:"func"},required:!1,description:""},onError:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""}}};var src_LivenessDetection=LivenessDetection;function LivenessDetection_stories_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.dop/src/LivenessDetection/index.js"]={name:"LivenessDetection",docgenInfo:LivenessDetection.__docgenInfo,path:"packages/tvweb-sdk.dop/src/LivenessDetection/index.js"});var assetRoot="/tvweb-sdk.dop/assets/";function logActiveResult(data){console.log("Raw data",data),console.log("Scaled image",URL.createObjectURL(data.frontalScaledImage)),data.frontalFaces.forEach((function(frontal,index){console.log("Frontal #".concat(index),URL.createObjectURL(frontal))})),data.steps.forEach((function(step){console.log("Step #".concat(step.name),URL.createObjectURL(step.image.blob))}))}var LivenessDetection_stories_ActiveMode=function ActiveMode(){return Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:assetRoot},children:Object(jsx_runtime.jsx)(src_LivenessDetection,{mode:tvweb_core_esm.e.Mode.ACTIVE,onLivenessDetectionDone:logActiveResult,onClose:console.log,onError:console.log})})};LivenessDetection_stories_ActiveMode.displayName="ActiveMode";var LivenessDetection_stories_PassiveMode=function PassiveMode(){return Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:assetRoot},children:Object(jsx_runtime.jsx)(src_LivenessDetection,{mode:tvweb_core_esm.e.Mode.PASSIVE,onLivenessDetectionDone:console.log,onClose:console.log,onError:console.log})})};LivenessDetection_stories_PassiveMode.displayName="PassiveMode";var LivenessDetection_stories_ShowInstructionAnimation=function ShowInstructionAnimation(){return Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:assetRoot},children:Object(jsx_runtime.jsx)(src_LivenessDetection,{mode:tvweb_core_esm.e.Mode.ACTIVE,minPadding:0,enableInstructionsOverlay:!0,enableErrorOverlay:!0,enableCapturingOverlay:!0,onLivenessDetectionDone:logActiveResult,onClose:console.log,onError:console.log})})};LivenessDetection_stories_ShowInstructionAnimation.displayName="ShowInstructionAnimation";var LivenessDetection_stories_MAFCActiveMode=function MAFCActiveMode(){var _ref;return Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:"".concat(assetRoot,"/mafc")},children:Object(jsx_runtime.jsx)(src_LivenessDetection,{mode:tvweb_core_esm.e.Mode.ACTIVE,backgroundColor:"#ffffff",textColor:"inherit",progressProps:{activeColor:"#f08200",insideRingWidth:18,outsideRingColor:"#f2f2f2",insideRingColor:"#ffffff",dashedRingColor:"#d7d7d7",dashedRingOpacity:1,dashedInsideRingColor:"#d7d7d7",dashedInsideRingWidth:1},title:"Chụp hình khuôn mặt",description:"Xin đưa khuôn mặt chính diện vào khung hình. Hình ảnh sẽ tự động được ghi lại.",customInstructions:(_ref={},LivenessDetection_stories_defineProperty(_ref,tvweb_core_esm.e.FaceDirection.LEFT,{vi:"Vui lòng quay mặt sang bên trái"}),LivenessDetection_stories_defineProperty(_ref,tvweb_core_esm.e.FaceDirection.RIGHT,{vi:"Vui lòng quay mặt sang bên phải"}),LivenessDetection_stories_defineProperty(_ref,tvweb_core_esm.e.FaceDirection.UP,{vi:"Vui lòng ngước mặt lên"}),LivenessDetection_stories_defineProperty(_ref,tvweb_core_esm.e.FaceDirection.FRONTAL,{vi:"Xin đưa khuôn mặt chính diện vào khung hình"}),_ref),onLivenessDetectionDone:logActiveResult,onClose:console.log,onError:console.log})})};LivenessDetection_stories_MAFCActiveMode.displayName="MAFCActiveMode";var LivenessDetection_stories_MAFCActiveModeImproved=function MAFCActiveModeImproved(){var _ref2;return Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:"".concat(assetRoot,"/mafc")},children:Object(jsx_runtime.jsx)(src_LivenessDetection,{mode:tvweb_core_esm.e.Mode.ACTIVE,enableInstructionsOverlay:!0,enableErrorOverlay:!0,enableCapturingOverlay:!0,backgroundColor:"#ffffff",textColor:"inherit",progressProps:{activeColor:"#f08200",insideRingWidth:18,outsideRingColor:"#f2f2f2",insideRingColor:"#ffffff",dashedRingColor:"#d7d7d7",dashedRingOpacity:1,dashedInsideRingColor:"#d7d7d7",dashedInsideRingWidth:1},title:"Chụp hình khuôn mặt",description:"Xin đưa khuôn mặt chính diện vào khung hình. Hình ảnh sẽ tự động được ghi lại.",customInstructions:(_ref2={},LivenessDetection_stories_defineProperty(_ref2,tvweb_core_esm.e.FaceDirection.LEFT,{vi:"Vui lòng quay mặt sang bên trái"}),LivenessDetection_stories_defineProperty(_ref2,tvweb_core_esm.e.FaceDirection.RIGHT,{vi:"Vui lòng quay mặt sang bên phải"}),LivenessDetection_stories_defineProperty(_ref2,tvweb_core_esm.e.FaceDirection.UP,{vi:"Vui lòng ngước mặt lên"}),LivenessDetection_stories_defineProperty(_ref2,tvweb_core_esm.e.FaceDirection.FRONTAL,{vi:"Xin đưa khuôn mặt chính diện vào khung hình"}),_ref2),onLivenessDetectionDone:logActiveResult,onClose:console.log,onError:console.log})})};LivenessDetection_stories_MAFCActiveModeImproved.displayName="MAFCActiveModeImproved";__webpack_exports__.default={title:"[DOP] Liveness Detection"};LivenessDetection_stories_ActiveMode.parameters=Object.assign({storySource:{source:"function ActiveMode() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: 'vi', assetRoot }}>\n      <LivenessDetection\n        mode={Constants.Mode.ACTIVE}\n        onLivenessDetectionDone={logActiveResult}\n        onClose={console.log}\n        onError={console.log}\n      />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}"}},LivenessDetection_stories_ActiveMode.parameters),LivenessDetection_stories_PassiveMode.parameters=Object.assign({storySource:{source:"function PassiveMode() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: 'vi', assetRoot }}>\n      <LivenessDetection\n        mode={Constants.Mode.PASSIVE}\n        onLivenessDetectionDone={console.log}\n        onClose={console.log}\n        onError={console.log}\n      />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}"}},LivenessDetection_stories_PassiveMode.parameters),LivenessDetection_stories_ShowInstructionAnimation.parameters=Object.assign({storySource:{source:"function ShowInstructionAnimation() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: 'vi', assetRoot }}>\n      <LivenessDetection\n        mode={Constants.Mode.ACTIVE}\n        minPadding={0}\n        enableInstructionsOverlay\n        enableErrorOverlay\n        enableCapturingOverlay\n        onLivenessDetectionDone={logActiveResult}\n        onClose={console.log}\n        onError={console.log}\n      />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}"}},LivenessDetection_stories_ShowInstructionAnimation.parameters),LivenessDetection_stories_MAFCActiveMode.parameters=Object.assign({storySource:{source:"function MAFCActiveMode() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: 'vi', assetRoot: `${assetRoot}/mafc` }}>\n      <LivenessDetection\n        mode={Constants.Mode.ACTIVE}\n        backgroundColor=\"#ffffff\"\n        textColor=\"inherit\"\n        progressProps={{\n          activeColor: '#f08200',\n          insideRingWidth: 18,\n          outsideRingColor: '#f2f2f2',\n          insideRingColor: '#ffffff',\n          dashedRingColor: '#d7d7d7',\n          dashedRingOpacity: 1,\n          dashedInsideRingColor: '#d7d7d7',\n          dashedInsideRingWidth: 1,\n        }}\n        title=\"Chụp hình khuôn mặt\"\n        description=\"Xin đưa khuôn mặt chính diện vào khung hình. Hình ảnh sẽ tự động được ghi lại.\"\n        customInstructions={{\n          [Constants.FaceDirection.LEFT]: {\n            vi: 'Vui lòng quay mặt sang bên trái',\n          },\n          [Constants.FaceDirection.RIGHT]: {\n            vi: 'Vui lòng quay mặt sang bên phải',\n          },\n          [Constants.FaceDirection.UP]: {\n            vi: 'Vui lòng ngước mặt lên',\n          },\n          [Constants.FaceDirection.FRONTAL]: {\n            vi: 'Xin đưa khuôn mặt chính diện vào khung hình',\n          },\n        }}\n        onLivenessDetectionDone={logActiveResult}\n        onClose={console.log}\n        onError={console.log}\n      />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}"}},LivenessDetection_stories_MAFCActiveMode.parameters),LivenessDetection_stories_MAFCActiveModeImproved.parameters=Object.assign({storySource:{source:"function MAFCActiveModeImproved() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: 'vi', assetRoot: `${assetRoot}/mafc` }}>\n      <LivenessDetection\n        mode={Constants.Mode.ACTIVE}\n        enableInstructionsOverlay\n        enableErrorOverlay\n        enableCapturingOverlay\n        backgroundColor=\"#ffffff\"\n        textColor=\"inherit\"\n        progressProps={{\n          activeColor: '#f08200',\n          insideRingWidth: 18,\n          outsideRingColor: '#f2f2f2',\n          insideRingColor: '#ffffff',\n          dashedRingColor: '#d7d7d7',\n          dashedRingOpacity: 1,\n          dashedInsideRingColor: '#d7d7d7',\n          dashedInsideRingWidth: 1,\n        }}\n        title=\"Chụp hình khuôn mặt\"\n        description=\"Xin đưa khuôn mặt chính diện vào khung hình. Hình ảnh sẽ tự động được ghi lại.\"\n        customInstructions={{\n          [Constants.FaceDirection.LEFT]: {\n            vi: 'Vui lòng quay mặt sang bên trái',\n          },\n          [Constants.FaceDirection.RIGHT]: {\n            vi: 'Vui lòng quay mặt sang bên phải',\n          },\n          [Constants.FaceDirection.UP]: {\n            vi: 'Vui lòng ngước mặt lên',\n          },\n          [Constants.FaceDirection.FRONTAL]: {\n            vi: 'Xin đưa khuôn mặt chính diện vào khung hình',\n          },\n        }}\n        onLivenessDetectionDone={logActiveResult}\n        onClose={console.log}\n        onError={console.log}\n      />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}"}},LivenessDetection_stories_MAFCActiveModeImproved.parameters),LivenessDetection_stories_ActiveMode.__docgenInfo={description:"",methods:[],displayName:"ActiveMode"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js"]={name:"ActiveMode",docgenInfo:LivenessDetection_stories_ActiveMode.__docgenInfo,path:"packages/tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js"}),LivenessDetection_stories_PassiveMode.__docgenInfo={description:"",methods:[],displayName:"PassiveMode"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js"]={name:"PassiveMode",docgenInfo:LivenessDetection_stories_PassiveMode.__docgenInfo,path:"packages/tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js"}),LivenessDetection_stories_ShowInstructionAnimation.__docgenInfo={description:"",methods:[],displayName:"ShowInstructionAnimation"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js"]={name:"ShowInstructionAnimation",docgenInfo:LivenessDetection_stories_ShowInstructionAnimation.__docgenInfo,path:"packages/tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js"}),LivenessDetection_stories_MAFCActiveMode.__docgenInfo={description:"",methods:[],displayName:"MAFCActiveMode"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js"]={name:"MAFCActiveMode",docgenInfo:LivenessDetection_stories_MAFCActiveMode.__docgenInfo,path:"packages/tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js"}),LivenessDetection_stories_MAFCActiveModeImproved.__docgenInfo={description:"",methods:[],displayName:"MAFCActiveModeImproved"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js"]={name:"MAFCActiveModeImproved",docgenInfo:LivenessDetection_stories_MAFCActiveModeImproved.__docgenInfo,path:"packages/tvweb-sdk.dop/src/LivenessDetection/LivenessDetection.stories.js"})},1750:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"MSBActiveMode",(function(){return LivenessDetection_stories_MSBActiveMode}));__webpack_require__(15),__webpack_require__(61);var jsx_runtime=__webpack_require__(5),react=__webpack_require__(1),react_default=__webpack_require__.n(react),tvweb_core_esm=__webpack_require__(8),styled_components_browser_esm=(__webpack_require__(32),__webpack_require__(21),__webpack_require__(19),__webpack_require__(37),__webpack_require__(39),__webpack_require__(10)),prop_types=__webpack_require__(4),prop_types_default=__webpack_require__.n(prop_types),tvweb_ui_esm=__webpack_require__(51);function CameraMark(_ref){var className=_ref.className;return Object(jsx_runtime.jsx)("svg",{className:className,width:"320",height:"320",viewBox:"0 0 320 320",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Object(jsx_runtime.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M320 0H0V320H320V0ZM160 296C235.111 296 296 235.111 296 160C296 84.8893 235.111 24 160 24C84.8893 24 24 84.8893 24 160C24 235.111 84.8893 296 160 296Z",fill:"currentColor"})})}CameraMark.displayName="CameraMark",CameraMark.propTypes={className:prop_types_default.a.string},CameraMark.defaultProps={className:""},CameraMark.__docgenInfo={description:"",methods:[],displayName:"CameraMark",props:{className:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""}}};var _ANGLE,CameraMask=CameraMark;function _templateObject7(){var data=_taggedTemplateLiteral(["\n  animation-delay: 1s;\n"]);return _templateObject7=function _templateObject7(){return data},data}function _templateObject6(){var data=_taggedTemplateLiteral(["\n  animation-delay: 0.5s;\n"]);return _templateObject6=function _templateObject6(){return data},data}function _templateObject5(){var data=_taggedTemplateLiteral(["\n  animation-delay: 0s;\n"]);return _templateObject5=function _templateObject5(){return data},data}function _templateObject4(){var data=_taggedTemplateLiteral(["\n  display: flex;\n  margin: 4px 0;\n  width: 100%;\n  height: 15px;\n  animation: "," 1s infinite;\n  animation-direction: alternate;\n\n  &::before,\n  &::after {\n    content: '';\n    height: 100%;\n    width: 50%;\n    background: rgba(255, 255, 255, 0.8);\n  }\n\n  &::before {\n    transform: skewY(32deg);\n  }\n\n  &::after {\n    width: 50%;\n    transform: skewY(-32deg);\n  }\n"]);return _templateObject4=function _templateObject4(){return data},data}function _templateObject3(){var data=_taggedTemplateLiteral(["\n  width: 70px;\n  transform: rotate(","deg);\n"]);return _templateObject3=function _templateObject3(){return data},data}function _templateObject2(){var data=_taggedTemplateLiteral(["\n  width: 200px;\n  height: 200px;\n  position: relative;\n  transform: scale(0.48);\n\n  .top,\n  .right,\n  .bottom,\n  .left {\n    position: absolute;\n  }\n\n  .top {\n    top: 0;\n    left: 50%;\n    transform: rotate(","deg) translateX(-50%);\n  }\n\n  .right {\n    right: 0;\n    top: 50%;\n    transform: rotate(","deg) translateX(-50%);\n  }\n\n  .bottom {\n    bottom: 0;\n    left: 50%;\n    transform: rotate(","deg) translateX(50%);\n  }\n\n  .left {\n    left: 0;\n    top: 50%;\n    transform: rotate(","deg) translateX(50%);\n  }\n"]);return _templateObject2=function _templateObject2(){return data},data}function _templateObject(){var data=_taggedTemplateLiteral(["\n  0% {\n    opacity: 0.15;\n  }\n  50% {\n    opacity: 0.3;\n  }\n  100% {\n    opacity: 1;\n  }\n"]);return _templateObject=function _templateObject(){return data},data}function _taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.msb/src/LivenessDetection/CameraMask.js"]={name:"CameraMark",docgenInfo:CameraMark.__docgenInfo,path:"packages/tvweb-sdk.msb/src/LivenessDetection/CameraMask.js"});var ANGLE=(_defineProperty(_ANGLE={},tvweb_core_esm.e.FaceDirection.LEFT,90),_defineProperty(_ANGLE,tvweb_core_esm.e.FaceDirection.RIGHT,270),_defineProperty(_ANGLE,tvweb_core_esm.e.FaceDirection.UP,180),_defineProperty(_ANGLE,tvweb_core_esm.e.FaceDirection.DOWN,0),_ANGLE),arrowScroll=Object(styled_components_browser_esm.d)(_templateObject()),FrontalWrapper=styled_components_browser_esm.c.div(_templateObject2(),ANGLE[tvweb_core_esm.e.FaceDirection.DOWN],ANGLE[tvweb_core_esm.e.FaceDirection.LEFT],ANGLE[tvweb_core_esm.e.FaceDirection.UP],ANGLE[tvweb_core_esm.e.FaceDirection.RIGHT]),ArrowWrapper=styled_components_browser_esm.c.div(_templateObject3(),(function(_ref){var _ANGLE$direction,direction=_ref.direction;return null!==(_ANGLE$direction=ANGLE[direction])&&void 0!==_ANGLE$direction?_ANGLE$direction:0})),Arrow=styled_components_browser_esm.c.span(_templateObject4(),arrowScroll),FirstArrow=Object(styled_components_browser_esm.c)(Arrow)(_templateObject5()),SecondArrow=Object(styled_components_browser_esm.c)(Arrow)(_templateObject6()),ThirdArrow=Object(styled_components_browser_esm.c)(Arrow)(_templateObject7());function DirectionIcon(_ref2){var type=_ref2.type;return type!==tvweb_core_esm.e.FaceDirection.FRONTAL?Object(jsx_runtime.jsxs)(ArrowWrapper,{direction:type,children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}):Object(jsx_runtime.jsxs)(FrontalWrapper,{children:[Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"top",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}),Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"right",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}),Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"bottom",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]}),Object(jsx_runtime.jsxs)(ArrowWrapper,{className:"left",children:[Object(jsx_runtime.jsx)(FirstArrow,{}),Object(jsx_runtime.jsx)(SecondArrow,{}),Object(jsx_runtime.jsx)(ThirdArrow,{})]})]})}DirectionIcon.displayName="DirectionIcon",DirectionIcon.propTypes={type:prop_types_default.a.oneOf([tvweb_core_esm.e.FaceDirection.LEFT,tvweb_core_esm.e.FaceDirection.RIGHT,tvweb_core_esm.e.FaceDirection.UP,tvweb_core_esm.e.FaceDirection.FRONTAL])},DirectionIcon.defaultProps={type:tvweb_core_esm.e.FaceDirection.LEFT},DirectionIcon.__docgenInfo={description:"",methods:[],displayName:"DirectionIcon",props:{type:{defaultValue:{value:"Constants.FaceDirection.LEFT",computed:!0},type:{name:"enum",value:[{value:"Constants.FaceDirection.LEFT",computed:!0},{value:"Constants.FaceDirection.RIGHT",computed:!0},{value:"Constants.FaceDirection.UP",computed:!0},{value:"Constants.FaceDirection.FRONTAL",computed:!0}]},required:!1,description:""}}};var _customDirectionIcon,LivenessDetection_DirectionIcon=DirectionIcon;function LivenessDetection_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _templateObject15(){var data=LivenessDetection_taggedTemplateLiteral(["\n  background: rgba(255, 255, 255, 0.3);\n  animation: "," 1s infinite;\n"]);return _templateObject15=function _templateObject15(){return data},data}function _templateObject14(){var data=LivenessDetection_taggedTemplateLiteral(["\n  from {\n    opacity: 1;\n  }\n\n  to {\n    opacity: 0;\n  }\n"]);return _templateObject14=function _templateObject14(){return data},data}function _templateObject13(){var data=LivenessDetection_taggedTemplateLiteral(["\n  background: rgba(223, 0, 0, 0.2);\n"]);return _templateObject13=function _templateObject13(){return data},data}function _templateObject12(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  width: 100%;\n  top: 0;\n  bottom: 0;\n  z-index: -1;\n"]);return _templateObject12=function _templateObject12(){return data},data}function _templateObject11(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n"]);return _templateObject11=function _templateObject11(){return data},data}function _templateObject10(){var data=LivenessDetection_taggedTemplateLiteral(["\n      border-color: #f2f6f9;\n      opacity: 0.3;\n    "]);return _templateObject10=function _templateObject10(){return data},data}function _templateObject9(){var data=LivenessDetection_taggedTemplateLiteral(["\n  width: 50px;\n  height: 50px;\n  border: 1px solid #005993;\n  border-radius: 50%;\n\n  & + & {\n    margin-left: 10px;\n  }\n\n  ","\n"]);return _templateObject9=function _templateObject9(){return data},data}function _templateObject8(){var data=LivenessDetection_taggedTemplateLiteral(["\n        width: 42px;\n      "]);return _templateObject8=function _templateObject8(){return data},data}function LivenessDetection_templateObject7(){var data=LivenessDetection_taggedTemplateLiteral(["\n  && {\n    width: 20px;\n    border-radius: 50%;\n    margin: 0;\n\n    ","\n  }\n"]);return LivenessDetection_templateObject7=function _templateObject7(){return data},data}function LivenessDetection_templateObject6(){var data=LivenessDetection_taggedTemplateLiteral(["\n  width: 100%;\n  height: 100%;\n  vertical-align: middle;\n  margin: 0;\n  color: ",";\n"]);return LivenessDetection_templateObject6=function _templateObject6(){return data},data}function LivenessDetection_templateObject5(){var data=LivenessDetection_taggedTemplateLiteral(["\n      font-size: 0.875rem;\n    "]);return LivenessDetection_templateObject5=function _templateObject5(){return data},data}function LivenessDetection_templateObject4(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  font-size: 1.125rem;\n  text-align: center;\n  padding: 0 1.75rem;\n  color: ",";\n  text-shadow: none;\n\n  ",";\n"]);return LivenessDetection_templateObject4=function _templateObject4(){return data},data}function LivenessDetection_templateObject3(){var data=LivenessDetection_taggedTemplateLiteral(["\n      font-size: 0.875rem;\n    "]);return LivenessDetection_templateObject3=function _templateObject3(){return data},data}function LivenessDetection_templateObject2(){var data=LivenessDetection_taggedTemplateLiteral(["\n  position: absolute;\n  font-size: 1.125rem;\n  text-align: center;\n\n  ",";\n"]);return LivenessDetection_templateObject2=function _templateObject2(){return data},data}function LivenessDetection_templateObject(){var data=LivenessDetection_taggedTemplateLiteral(["\n  height: 50px;\n"]);return LivenessDetection_templateObject=function _templateObject(){return data},data}function LivenessDetection_taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.msb/src/LivenessDetection/DirectionIcon.js"]={name:"DirectionIcon",docgenInfo:DirectionIcon.__docgenInfo,path:"packages/tvweb-sdk.msb/src/LivenessDetection/DirectionIcon.js"});var heightBreaks_sm=650,heightBreaks_md=750,CameraIcon=tvweb_ui_esm.c.Camera,BaseFaceDetectionError=tvweb_ui_esm.d.FaceDetectionError,BaseFaceVerificationInstructions=tvweb_ui_esm.d.FaceVerificationInstructions,BaseFaceVerificationStepsWrapper=tvweb_ui_esm.d.FaceVerificationStepsWrapper,BaseStepItem=tvweb_ui_esm.d.StepItem,BottomButtonsOverlay=tvweb_ui_esm.d.BottomButtonsOverlay,Button=tvweb_ui_esm.d.Button,CountDownOverlay=tvweb_ui_esm.d.CountDownOverlay,InstructionsOverlay=tvweb_ui_esm.d.InstructionsOverlay,FaceVerificationStepsWrapper=Object(styled_components_browser_esm.c)(BaseFaceVerificationStepsWrapper)(LivenessDetection_templateObject()),ErrorText=Object(styled_components_browser_esm.c)(BaseFaceDetectionError)(LivenessDetection_templateObject2(),(function(_ref){return _ref.isMobile&&Object(styled_components_browser_esm.b)(LivenessDetection_templateObject3())})),InstructionText=Object(styled_components_browser_esm.c)(BaseFaceVerificationInstructions)(LivenessDetection_templateObject4(),(function(_ref2){return _ref2.color}),(function(_ref3){return _ref3.isMobile&&Object(styled_components_browser_esm.b)(LivenessDetection_templateObject5())})),StyledCameraMark=Object(styled_components_browser_esm.c)(CameraMask)(LivenessDetection_templateObject6(),(function(_ref4){var color=_ref4.color;return null!=color?color:"#06243c"})),StepItemImage=styled_components_browser_esm.c.img(LivenessDetection_templateObject7(),(function(_ref5){return"preview"===_ref5.mode&&Object(styled_components_browser_esm.b)(_templateObject8())})),StepItem=Object(styled_components_browser_esm.c)(BaseStepItem)(_templateObject9(),(function(props){return!props.active&&Object(styled_components_browser_esm.b)(_templateObject10())})),OverlayProgressCircle=Object(styled_components_browser_esm.c)(tvweb_ui_esm.f)(_templateObject11()),Overlay=styled_components_browser_esm.c.div(_templateObject12()),ErrorOverlay=Object(styled_components_browser_esm.c)(Overlay)(_templateObject13()),blinkAnimation=Object(styled_components_browser_esm.d)(_templateObject14()),CapturingOverlay=Object(styled_components_browser_esm.c)(Overlay)(_templateObject15(),blinkAnimation),videoSettings=tvweb_ui_esm.e.isMobile?{width:640}:null;function LivenessDetection(_ref6){var className=_ref6.className,apiCheck=_ref6.apiCheck,enableRecording=_ref6.enableRecording,enableInstructionsOverlay=_ref6.enableInstructionsOverlay,enableErrorOverlay=_ref6.enableErrorOverlay,enableCapturingOverlay=_ref6.enableCapturingOverlay,frontalMinSize=_ref6.frontalMinSize,mode=_ref6.mode,minPadding=_ref6.minPadding,backgroundColor=_ref6.backgroundColor,textColor=_ref6.textColor,progressProps=_ref6.progressProps,customInstructions=_ref6.customInstructions,customIcon=_ref6.customIcon,customDirectionIcon=_ref6.customDirectionIcon,onLivenessDetectionDone=_ref6.onLivenessDetectionDone,onClose=_ref6.onClose,onError=_ref6.onError,getCropAreaDimension=Object(react.useCallback)((function(_ref7){var clientWidth=_ref7.clientWidth,clientHeight=_ref7.clientHeight,videoAreaWidth=_ref7.videoAreaWidth,videoAreaHeight=_ref7.videoAreaHeight,lostX=_ref7.lostX,lostY=_ref7.lostY,paddingTop=Math.max(60,lostY),paddingBottom=Math.max(90,lostY);clientHeight>heightBreaks_sm&&(paddingTop=Math.max(70,lostY),paddingBottom=Math.max(140,lostY)),clientHeight>heightBreaks_md&&(paddingTop=Math.max(70,lostY),paddingBottom=Math.max(140,lostY));var paddingLeft=Math.max(minPadding,lostX),paddingRight=Math.max(minPadding,lostX),minSize=Math.min(videoAreaWidth,videoAreaHeight),cropSize=Math.max(Math.floor(Math.min(clientWidth-(paddingLeft+paddingRight),clientHeight-(paddingTop+paddingBottom),minSize)),160);return{x:Math.min(Math.floor(paddingLeft+(clientWidth-paddingRight-paddingLeft)/2-cropSize/2),clientWidth-cropSize),y:Math.min(Math.floor(paddingTop+(clientHeight-paddingBottom-paddingTop)/2-cropSize/2),clientHeight-cropSize),width:cropSize,height:cropSize}}),[minPadding]),surroundStyle=Object(react.useMemo)((function(){return{background:backgroundColor,opacity:1}}),[backgroundColor]),_useLivenessDetection=Object(tvweb_ui_esm.g)({apiCheck:apiCheck,enableRecording:enableRecording,frontalMinSize:frontalMinSize,mode:mode,bgCameraMask:null,bgCameraMaskRed:null,surroundStyle:surroundStyle,cropAreaDimension:getCropAreaDimension,customInstructions:customInstructions,customIcon:customIcon,customDirectionIcon:customDirectionIcon,onLivenessDetectionDone:onLivenessDetectionDone}),countdownToTakePicture=_useLivenessDetection.countdownToTakePicture,cropArea=_useLivenessDetection.cropArea,curStepIndex=_useLivenessDetection.curStepIndex,directionIcon=_useLivenessDetection.directionIcon,faceDetectionError=_useLivenessDetection.faceDetectionError,handleTriggerPassiveMode=_useLivenessDetection.handleTriggerPassiveMode,handleVideoPlayed=_useLivenessDetection.handleVideoPlayed,instructions=_useLivenessDetection.instructions,isActiveMode=_useLivenessDetection.isActiveMode,refVideo=_useLivenessDetection.refVideo,showCountdown=_useLivenessDetection.showCountdown,steps=_useLivenessDetection.steps,videoPlayed=_useLivenessDetection.videoPlayed,activeCapturing=_useLivenessDetection.activeCapturing,faceVerificationStepsHeight=50,faceVerificationStepsMarginBottom=12,faceVerificationStepsWrapperBottom=14;window.innerHeight>heightBreaks_sm&&(faceVerificationStepsHeight=50,faceVerificationStepsMarginBottom=24,faceVerificationStepsWrapperBottom=34),window.innerHeight>heightBreaks_md&&(faceVerificationStepsHeight=50,faceVerificationStepsMarginBottom=24,faceVerificationStepsWrapperBottom=40);var faceVerificationInstructionsBottom=faceVerificationStepsWrapperBottom+faceVerificationStepsHeight+faceVerificationStepsMarginBottom,showErrorOverlay=enableErrorOverlay&&faceDetectionError;function renderIcon(icon,props){return"string"==typeof icon?Object(jsx_runtime.jsx)(StepItemImage,{src:icon,alt:""}):react_default.a.cloneElement(icon,props)}return Object(jsx_runtime.jsx)(tvweb_ui_esm.a,{ref:refVideo,className:className,frontCamera:!0,flipHorizontal:!0,videoSettings:videoSettings,onVideoPlayed:handleVideoPlayed,onClose:onClose,onError:onError,children:videoPlayed?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[cropArea.current?Object(jsx_runtime.jsxs)(tvweb_ui_esm.b,{x:"".concat(cropArea.current.x,"px"),y:"".concat(cropArea.current.y,"px"),width:"".concat(cropArea.current.width,"px"),height:"".concat(cropArea.current.height,"px"),surroundStyle:cropArea.current.surroundStyle,children:[Object(jsx_runtime.jsx)(StyledCameraMark,{color:backgroundColor}),Object(jsx_runtime.jsx)(OverlayProgressCircle,Object.assign({progress:curStepIndex/steps.length*100,hasError:showErrorOverlay},progressProps)),showCountdown?Object(jsx_runtime.jsx)(CountDownOverlay,{children:countdownToTakePicture}):null,isActiveMode&&enableInstructionsOverlay&&directionIcon?Object(jsx_runtime.jsx)(InstructionsOverlay,{children:directionIcon}):null,isActiveMode&&enableCapturingOverlay&&activeCapturing?Object(jsx_runtime.jsx)(CapturingOverlay,{}):null,showErrorOverlay?Object(jsx_runtime.jsx)(ErrorOverlay,{}):null]}):null,faceDetectionError?Object(jsx_runtime.jsx)(ErrorText,{top:30,isMobile:tvweb_ui_esm.e.isMobile,children:faceDetectionError}):null,isActiveMode?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[instructions?Object(jsx_runtime.jsx)(InstructionText,{bottom:faceVerificationInstructionsBottom,isMobile:tvweb_ui_esm.e.isMobile,color:textColor,children:instructions}):null,Object(jsx_runtime.jsx)(FaceVerificationStepsWrapper,{bottom:faceVerificationStepsWrapperBottom,children:steps.map((function(step,index){var name=step.name,icon=step.icon,objUrl=step.image.objUrl,active=curStepIndex>=index;return Object(jsx_runtime.jsx)(StepItem,{active:active,children:objUrl?Object(jsx_runtime.jsx)(StepItemImage,{src:objUrl,alt:"",mode:"preview"}):renderIcon(icon,{active:active})},name)}))})]}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:faceDetectionError?null:Object(jsx_runtime.jsx)(BottomButtonsOverlay,{children:Object(jsx_runtime.jsx)(Button,{onClick:handleTriggerPassiveMode,children:Object(jsx_runtime.jsx)(CameraIcon,{})})})})]}):null})}LivenessDetection.displayName="LivenessDetection",LivenessDetection.propTypes={className:prop_types_default.a.string,apiCheck:prop_types_default.a.bool,enableRecording:prop_types_default.a.bool,enableInstructionsOverlay:prop_types_default.a.bool,enableErrorOverlay:prop_types_default.a.bool,enableCapturingOverlay:prop_types_default.a.bool,frontalMinSize:prop_types_default.a.number,mode:prop_types_default.a.string,minPadding:prop_types_default.a.number,backgroundColor:prop_types_default.a.string,textColor:prop_types_default.a.string,progressProps:prop_types_default.a.shape({className:prop_types_default.a.string,style:prop_types_default.a.shape({}),radius:prop_types_default.a.number,strokeWidth:prop_types_default.a.number,progress:prop_types_default.a.number,activeColor:prop_types_default.a.string,innerPadding:prop_types_default.a.number,outsideRingColor:prop_types_default.a.string,insideRingColor:prop_types_default.a.string,insideRingWidth:prop_types_default.a.number,dashedRingColor:prop_types_default.a.string,dashedRingWidth:prop_types_default.a.number,dashedRingLineThick:prop_types_default.a.number,dashedRingLineSpacing:prop_types_default.a.number,showOutsideRing:prop_types_default.a.bool,showDashedRing:prop_types_default.a.bool,showInsideRing:prop_types_default.a.bool}),title:prop_types_default.a.string,description:prop_types_default.a.string,customInstructions:prop_types_default.a.shape({}),customIcon:prop_types_default.a.shape({}),customDirectionIcon:prop_types_default.a.shape({}),onLivenessDetectionDone:prop_types_default.a.func,onClose:prop_types_default.a.func,onError:prop_types_default.a.func},LivenessDetection.defaultProps={className:"",apiCheck:!1,enableRecording:!1,enableInstructionsOverlay:!1,enableErrorOverlay:!1,enableCapturingOverlay:!1,frontalMinSize:720,mode:null,minPadding:5,backgroundColor:"#06243c",textColor:"#ffffff",progressProps:null,title:"Chụp ảnh chân dung",description:"Xin đưa khuôn mặt vào khung hình. Hình ảnh sẽ tự động được ghi lại.",customInstructions:null,customIcon:null,customDirectionIcon:(_customDirectionIcon={},LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.LEFT,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.LEFT})),LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.RIGHT,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.RIGHT})),LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.UP,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.UP})),LivenessDetection_defineProperty(_customDirectionIcon,tvweb_core_esm.e.FaceDirection.FRONTAL,Object(jsx_runtime.jsx)(LivenessDetection_DirectionIcon,{type:tvweb_core_esm.e.FaceDirection.FRONTAL})),_customDirectionIcon),onLivenessDetectionDone:null,onClose:null,onError:function onError(){}},LivenessDetection.__docgenInfo={description:"",methods:[],displayName:"LivenessDetection",props:{className:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""},apiCheck:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},enableRecording:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},enableInstructionsOverlay:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},enableErrorOverlay:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},enableCapturingOverlay:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},frontalMinSize:{defaultValue:{value:"720",computed:!1},type:{name:"number"},required:!1,description:""},mode:{defaultValue:{value:"null",computed:!1},type:{name:"string"},required:!1,description:""},minPadding:{defaultValue:{value:"5",computed:!1},type:{name:"number"},required:!1,description:""},backgroundColor:{defaultValue:{value:"'#06243c'",computed:!1},type:{name:"string"},required:!1,description:""},textColor:{defaultValue:{value:"'#ffffff'",computed:!1},type:{name:"string"},required:!1,description:""},progressProps:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{className:{name:"string",required:!1},style:{name:"shape",value:{},required:!1},radius:{name:"number",required:!1},strokeWidth:{name:"number",required:!1},progress:{name:"number",required:!1},activeColor:{name:"string",required:!1},innerPadding:{name:"number",required:!1},outsideRingColor:{name:"string",required:!1},insideRingColor:{name:"string",required:!1},insideRingWidth:{name:"number",required:!1},dashedRingColor:{name:"string",required:!1},dashedRingWidth:{name:"number",required:!1},dashedRingLineThick:{name:"number",required:!1},dashedRingLineSpacing:{name:"number",required:!1},showOutsideRing:{name:"bool",required:!1},showDashedRing:{name:"bool",required:!1},showInsideRing:{name:"bool",required:!1}}},required:!1,description:""},title:{defaultValue:{value:"'Chụp ảnh chân dung'",computed:!1},type:{name:"string"},required:!1,description:""},description:{defaultValue:{value:"'Xin đưa khuôn mặt vào khung hình. Hình ảnh sẽ tự động được ghi lại.'",computed:!1},type:{name:"string"},required:!1,description:""},customInstructions:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},customIcon:{defaultValue:{value:"null",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},customDirectionIcon:{defaultValue:{value:"{\n  [Constants.FaceDirection.LEFT]: <DirectionIcon type={Constants.FaceDirection.LEFT} />,\n  [Constants.FaceDirection.RIGHT]: <DirectionIcon type={Constants.FaceDirection.RIGHT} />,\n  [Constants.FaceDirection.UP]: <DirectionIcon type={Constants.FaceDirection.UP} />,\n  [Constants.FaceDirection.FRONTAL]: <DirectionIcon type={Constants.FaceDirection.FRONTAL} />,\n}",computed:!1},type:{name:"shape",value:{}},required:!1,description:""},onLivenessDetectionDone:{defaultValue:{value:"null",computed:!1},type:{name:"func"},required:!1,description:""},onClose:{defaultValue:{value:"null",computed:!1},type:{name:"func"},required:!1,description:""},onError:{defaultValue:{value:"() => {}",computed:!1},type:{name:"func"},required:!1,description:""}}};var src_LivenessDetection=LivenessDetection;function LivenessDetection_stories_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.msb/src/LivenessDetection/index.js"]={name:"LivenessDetection",docgenInfo:LivenessDetection.__docgenInfo,path:"packages/tvweb-sdk.msb/src/LivenessDetection/index.js"});var LivenessDetection_stories_MSBActiveMode=function MSBActiveMode(){var _ref;return Object(jsx_runtime.jsx)(tvweb_core_esm.m.SDKSettingsProvider,{value:{lang:"vi",assetRoot:"".concat("/tvweb-sdk.msb/assets/","/msb")},children:Object(jsx_runtime.jsx)(src_LivenessDetection,{mode:tvweb_core_esm.e.Mode.ACTIVE,enableInstructionsOverlay:!0,enableErrorOverlay:!0,enableCapturingOverlay:!0,backgroundColor:"#ffffff",textColor:"inherit",progressProps:{activeColor:"#f08200",insideRingWidth:8,outsideRingColor:"#f2f2f2",insideRingColor:"#ffffff",dashedRingColor:"#d7d7d7",dashedRingOpacity:1,dashedInsideRingColor:"#d7d7d7",dashedInsideRingWidth:1},title:"Chụp hình khuôn mặt",description:"",customInstructions:(_ref={},LivenessDetection_stories_defineProperty(_ref,tvweb_core_esm.e.FaceDirection.LEFT,{vi:"Vui lòng quay mặt sang bên trái"}),LivenessDetection_stories_defineProperty(_ref,tvweb_core_esm.e.FaceDirection.RIGHT,{vi:"Vui lòng quay mặt sang bên phải"}),LivenessDetection_stories_defineProperty(_ref,tvweb_core_esm.e.FaceDirection.UP,{vi:"Vui lòng ngước mặt lên"}),LivenessDetection_stories_defineProperty(_ref,tvweb_core_esm.e.FaceDirection.FRONTAL,{vi:"Xin đưa khuôn mặt chính diện vào khung hình"}),_ref),onLivenessDetectionDone:console.log,onClose:console.log,onError:console.log})})};LivenessDetection_stories_MSBActiveMode.displayName="MSBActiveMode";__webpack_exports__.default={title:"[MSB] Liveness Detection"};LivenessDetection_stories_MSBActiveMode.parameters=Object.assign({storySource:{source:"function MSBActiveMode() {\n  return (\n    <SettingsContext.SDKSettingsProvider value={{ lang: 'vi', assetRoot: `${assetRoot}/msb` }}>\n      <LivenessDetection\n        mode={Constants.Mode.ACTIVE}\n        enableInstructionsOverlay\n        enableErrorOverlay\n        enableCapturingOverlay\n        backgroundColor=\"#ffffff\"\n        textColor=\"inherit\"\n        progressProps={{\n          activeColor: '#f08200',\n          insideRingWidth: 8,\n          outsideRingColor: '#f2f2f2',\n          insideRingColor: '#ffffff',\n          dashedRingColor: '#d7d7d7',\n          dashedRingOpacity: 1,\n          dashedInsideRingColor: '#d7d7d7',\n          dashedInsideRingWidth: 1,\n        }}\n        title=\"Chụp hình khuôn mặt\"\n        description=\"\"\n        customInstructions={{\n          [Constants.FaceDirection.LEFT]: {\n            vi: 'Vui lòng quay mặt sang bên trái',\n          },\n          [Constants.FaceDirection.RIGHT]: {\n            vi: 'Vui lòng quay mặt sang bên phải',\n          },\n          [Constants.FaceDirection.UP]: {\n            vi: 'Vui lòng ngước mặt lên',\n          },\n          [Constants.FaceDirection.FRONTAL]: {\n            vi: 'Xin đưa khuôn mặt chính diện vào khung hình',\n          },\n        }}\n        onLivenessDetectionDone={console.log}\n        onClose={console.log}\n        onError={console.log}\n      />\n    </SettingsContext.SDKSettingsProvider>\n  );\n}"}},LivenessDetection_stories_MSBActiveMode.parameters),LivenessDetection_stories_MSBActiveMode.__docgenInfo={description:"",methods:[],displayName:"MSBActiveMode"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-sdk.msb/src/LivenessDetection/LivenessDetection.stories.js"]={name:"MSBActiveMode",docgenInfo:LivenessDetection_stories_MSBActiveMode.__docgenInfo,path:"packages/tvweb-sdk.msb/src/LivenessDetection/LivenessDetection.stories.js"})},303:function(module,exports){},316:function(module,__webpack_exports__,__webpack_require__){"use strict";var jsx_runtime=__webpack_require__(5),reactjs_popup_esm=(__webpack_require__(1),__webpack_require__(952)),prop_types=__webpack_require__(4),prop_types_default=__webpack_require__.n(prop_types),Camera=__webpack_require__(82),styled_components_browser_esm=(__webpack_require__(21),__webpack_require__(37),__webpack_require__(39),__webpack_require__(10));function _templateObject(){var data=function _taggedTemplateLiteral(strings,raw){raw||(raw=strings.slice(0));return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}(["\n  .popup-content {\n    margin: auto;\n    background: #fff;\n    width: 100%;\n    padding: 5px;\n    border: 1px solid #d7d7d7;\n    max-width: 568px;\n    border-radius: 0.25rem;\n  }\n\n  [role=tooltip].popup-content {\n    width: 200px;\n    box-shadow: 0 0 3px rgba(0, 0, 0, .16);\n    border-radius: 5px\n  }\n\n  .popup-overlay {\n    background: rgba(0, 0, 0, .5);\n    padding: 10px;\n  }\n\n  [data-popup=tooltip].popup-overlay {\n    background: transparent\n  }\n\n  .popup-arrow {\n    -webkit-filter: drop-shadow(0 -3px 3px rgba(0, 0, 0, .16));\n    filter: drop-shadow(0 -3px 3px rgba(0, 0, 0, .16));\n    color: #fff;\n    stroke-width: 2px;\n    stroke: #d7d7d7;\n    stroke-dasharray: 30px;\n    stroke-dashoffset: -54px;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0\n  }\n"]);return _templateObject=function _templateObject(){return data},data}var style=Object(styled_components_browser_esm.a)(_templateObject()),Z_INDEX=Camera.a+1e3,Popup_PopupComponent=function PopupComponent(_ref){var open=_ref.open,children=_ref.children;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(reactjs_popup_esm.a,{overlayStyle:{zIndex:Z_INDEX},closeOnDocumentClick:!1,closeOnEscape:!1,modal:!0,open:open,children:children}),Object(jsx_runtime.jsx)(style,{})]})};Popup_PopupComponent.propTypes={open:prop_types_default.a.bool,children:prop_types_default.a.node},Popup_PopupComponent.defaultProps={open:!1,children:null},Popup_PopupComponent.__docgenInfo={description:"",methods:[],displayName:"PopupComponent",props:{open:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:""},children:{defaultValue:{value:"null",computed:!1},type:{name:"node"},required:!1,description:""}}};__webpack_exports__.a=Popup_PopupComponent;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/Popup/index.js"]={name:"PopupComponent",docgenInfo:Popup_PopupComponent.__docgenInfo,path:"packages/tvweb-ui/src/Popup/index.js"})},431:function(module,__webpack_exports__,__webpack_require__){"use strict";var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),prop_types__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__(1),__webpack_require__(4)),prop_types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_2__);function CameraIcon(_ref){var className=_ref.className;return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("svg",{className:className,width:"38px",height:"32px",viewBox:"0 0 24 21",children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("title",{children:"FA45C15C-1E21-4D7B-9585-07FB9F999CB8"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("desc",{children:"Created with sketchtool."}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("g",{id:"Web-demo",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("g",{id:"step1",transform:"translate(-950.000000, -380.000000)",fill:"currentColor",fillRule:"nonzero",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("g",{id:"Group",transform:"translate(950.000000, 380.000000)",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("g",{id:"Group-2",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("g",{id:"camera",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("path",{d:"M21,3 L17,3 L15,0 L9,0 L7,3 L3,3 C1.34314575,3 0,4.34314575 0,6 L0,18 C0,19.6568542 1.34314575,21 3,21 L21,21 C22.6568542,21 24,19.6568542 24,18 L24,6 C24,4.34314575 22.6568542,3 21,3 Z M12,17 C9.23857625,17 7,14.7614237 7,12 C7,9.23857625 9.23857625,7 12,7 C14.7614237,7 17,9.23857625 17,12 C17,14.7614237 14.7614237,17 12,17 L12,17 Z",id:"Shape"})})})})})})]})}CameraIcon.displayName="CameraIcon",CameraIcon.propTypes={className:prop_types__WEBPACK_IMPORTED_MODULE_2___default.a.string},CameraIcon.defaultProps={className:""},CameraIcon.__docgenInfo={description:"",methods:[],displayName:"CameraIcon",props:{className:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""}}},__webpack_exports__.a=CameraIcon,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/Icon/Camera.js"]={name:"CameraIcon",docgenInfo:CameraIcon.__docgenInfo,path:"packages/tvweb-ui/src/Icon/Camera.js"})},433:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return CropAreaOverlayWrapper}));__webpack_require__(21),__webpack_require__(37),__webpack_require__(39);var styled_components__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(10),_PlacementArea__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(434),_Camera__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(82);function _templateObject(){var data=function _taggedTemplateLiteral(strings,raw){raw||(raw=strings.slice(0));return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}(["\n  background: transparent;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  z-index: ",";\n"]);return _templateObject=function _templateObject(){return data},data}var CropAreaOverlayWrapper=Object(styled_components__WEBPACK_IMPORTED_MODULE_3__.c)(_PlacementArea__WEBPACK_IMPORTED_MODULE_4__.a)(_templateObject(),_Camera__WEBPACK_IMPORTED_MODULE_5__.a+10)},434:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__(52),__webpack_require__(24),__webpack_require__(32),__webpack_require__(21),__webpack_require__(15),__webpack_require__(37),__webpack_require__(39),__webpack_require__(22),__webpack_require__(27),__webpack_require__(30);var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(5),styled_components__WEBPACK_IMPORTED_MODULE_12__=(__webpack_require__(1),__webpack_require__(10)),prop_types__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(4),prop_types__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_13__);function _templateObject2(){var data=_taggedTemplateLiteral(["\n  position: relative;\n"]);return _templateObject2=function _templateObject2(){return data},data}function _templateObject(){var data=_taggedTemplateLiteral(["\n  width: 100%;\n  height: 100%;\n  td {\n    text-align: center;\n    vertical-align: middle;\n    padding: 0;\n    border: 0;\n  }\n  border-spacing: 0px;\n  table-layout: auto;\n"]);return _templateObject=function _templateObject(){return data},data}function _taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var Table=styled_components__WEBPACK_IMPORTED_MODULE_12__.c.table(_templateObject()),ChildrenWrapper=styled_components__WEBPACK_IMPORTED_MODULE_12__.c.div(_templateObject2()),rows=Array.from(Array(3).keys()),cols=Array.from(Array(3).keys());function PlacementArea(props){var children=props.children,x=props.x,y=props.y,width=props.width,height=props.height,className=props.className,surroundStyle=props.surroundStyle;return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(Table,{className:className,children:rows.map((function(row,indexRow){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("tr",{style:{height:0===indexRow?y:"auto"},children:cols.map((function(col,indexCol){var isCenteredCell=1===indexRow&&1===indexCol,cellWidth="auto";return isCenteredCell?cellWidth=width:0===indexCol&&(cellWidth=x),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("td",{style:Object.assign({width:cellWidth,height:isCenteredCell?height:"auto"},isCenteredCell?{}:surroundStyle),children:isCenteredCell?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(ChildrenWrapper,{style:{width:cellWidth,height:height},children:children}):null},col)}))},row)}))})}PlacementArea.displayName="PlacementArea",PlacementArea.propTypes={children:prop_types__WEBPACK_IMPORTED_MODULE_13___default.a.node,x:prop_types__WEBPACK_IMPORTED_MODULE_13___default.a.string,y:prop_types__WEBPACK_IMPORTED_MODULE_13___default.a.string,width:prop_types__WEBPACK_IMPORTED_MODULE_13___default.a.string,height:prop_types__WEBPACK_IMPORTED_MODULE_13___default.a.string,className:prop_types__WEBPACK_IMPORTED_MODULE_13___default.a.string,surroundStyle:prop_types__WEBPACK_IMPORTED_MODULE_13___default.a.object},PlacementArea.defaultProps={children:null,x:"auto",y:"auto",width:"auto",height:"auto",className:"",surroundStyle:{}},PlacementArea.__docgenInfo={description:"",methods:[],displayName:"PlacementArea",props:{children:{defaultValue:{value:"null",computed:!1},type:{name:"node"},required:!1,description:""},x:{defaultValue:{value:"'auto'",computed:!1},type:{name:"string"},required:!1,description:""},y:{defaultValue:{value:"'auto'",computed:!1},type:{name:"string"},required:!1,description:""},width:{defaultValue:{value:"'auto'",computed:!1},type:{name:"string"},required:!1,description:""},height:{defaultValue:{value:"'auto'",computed:!1},type:{name:"string"},required:!1,description:""},className:{defaultValue:{value:"''",computed:!1},type:{name:"string"},required:!1,description:""},surroundStyle:{defaultValue:{value:"{}",computed:!1},type:{name:"object"},required:!1,description:""}}},__webpack_exports__.a=PlacementArea,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/tvweb-ui/src/PlacementArea/index.js"]={name:"PlacementArea",docgenInfo:PlacementArea.__docgenInfo,path:"packages/tvweb-ui/src/PlacementArea/index.js"})},51:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(global,process,Buffer,__filename,__dirname){__webpack_require__.d(__webpack_exports__,"a",(function(){return Ne})),__webpack_require__.d(__webpack_exports__,"b",(function(){return Fe})),__webpack_require__.d(__webpack_exports__,"c",(function(){return AW})),__webpack_require__.d(__webpack_exports__,"d",(function(){return WW})),__webpack_require__.d(__webpack_exports__,"e",(function(){return q})),__webpack_require__.d(__webpack_exports__,"f",(function(){return iS})),__webpack_require__.d(__webpack_exports__,"g",(function(){return zW}));__webpack_require__(18),__webpack_require__(25),__webpack_require__(468),__webpack_require__(42),__webpack_require__(35),__webpack_require__(748),__webpack_require__(192),__webpack_require__(750),__webpack_require__(72),__webpack_require__(154),__webpack_require__(794),__webpack_require__(63),__webpack_require__(52),__webpack_require__(114),__webpack_require__(38),__webpack_require__(29),__webpack_require__(24),__webpack_require__(96),__webpack_require__(751),__webpack_require__(32),__webpack_require__(124),__webpack_require__(753),__webpack_require__(21),__webpack_require__(528),__webpack_require__(334),__webpack_require__(520),__webpack_require__(754),__webpack_require__(543),__webpack_require__(368),__webpack_require__(36),__webpack_require__(285),__webpack_require__(757),__webpack_require__(19),__webpack_require__(346),__webpack_require__(758),__webpack_require__(760),__webpack_require__(761),__webpack_require__(762),__webpack_require__(763),__webpack_require__(764),__webpack_require__(765),__webpack_require__(766),__webpack_require__(767),__webpack_require__(768),__webpack_require__(769),__webpack_require__(770),__webpack_require__(243),__webpack_require__(771),__webpack_require__(504),__webpack_require__(518),__webpack_require__(544),__webpack_require__(545),__webpack_require__(772),__webpack_require__(775),__webpack_require__(15),__webpack_require__(244),__webpack_require__(37),__webpack_require__(61),__webpack_require__(39),__webpack_require__(539),__webpack_require__(540),__webpack_require__(776),__webpack_require__(232),__webpack_require__(1616),__webpack_require__(23),__webpack_require__(22),__webpack_require__(519),__webpack_require__(517),__webpack_require__(95),__webpack_require__(510),__webpack_require__(47),__webpack_require__(777),__webpack_require__(40),__webpack_require__(239),__webpack_require__(357),__webpack_require__(134),__webpack_require__(27),__webpack_require__(176),__webpack_require__(778),__webpack_require__(94),__webpack_require__(242),__webpack_require__(108),__webpack_require__(240),__webpack_require__(216),__webpack_require__(1617),__webpack_require__(779),__webpack_require__(783),__webpack_require__(784),__webpack_require__(785),__webpack_require__(786),__webpack_require__(787),__webpack_require__(546),__webpack_require__(788),__webpack_require__(789),__webpack_require__(547),__webpack_require__(548),__webpack_require__(549),__webpack_require__(550),__webpack_require__(551),__webpack_require__(552),__webpack_require__(553),__webpack_require__(790),__webpack_require__(554),__webpack_require__(555),__webpack_require__(556),__webpack_require__(557),__webpack_require__(558),__webpack_require__(559),__webpack_require__(560),__webpack_require__(561),__webpack_require__(562),__webpack_require__(563),__webpack_require__(564),__webpack_require__(565),__webpack_require__(566),__webpack_require__(567),__webpack_require__(568),__webpack_require__(569),__webpack_require__(481),__webpack_require__(791),__webpack_require__(64),__webpack_require__(30),__webpack_require__(196),__webpack_require__(194),__webpack_require__(792),__webpack_require__(99);var react__WEBPACK_IMPORTED_MODULE_126__=__webpack_require__(1),react__WEBPACK_IMPORTED_MODULE_126___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_126__),styled_components__WEBPACK_IMPORTED_MODULE_127__=__webpack_require__(10),prop_types__WEBPACK_IMPORTED_MODULE_128__=__webpack_require__(4),prop_types__WEBPACK_IMPORTED_MODULE_128___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_128__),_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__=__webpack_require__(8);function _get(target,property,receiver){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(iter))return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e380){throw _e380},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e381){didErr=!0,err=_e381},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function S(e){return(S="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return _typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof(e)})(e)}function _(e,t,n,r,a,o,s){try{var i=e[o](s),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}function $(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){_(o,r,a,s,i,"next",e)}function i(e){_(o,r,a,s,i,"throw",e)}s(void 0)}))}}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}}(e,t)||B(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e){return function(e){if(Array.isArray(e))return z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||B(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){if(e){if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var W="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};function U(e,t,n){return e(n={path:t,exports:{},require:function require(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}function H(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function get(){return e[n]}})})),t}var j=U((function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){e.exports={BROWSER_TYPES:{CHROME:"Chrome",FIREFOX:"Firefox",OPERA:"Opera",YANDEX:"Yandex",SAFARI:"Safari",INTERNET_EXPLORER:"Internet Explorer",EDGE:"Edge",CHROMIUM:"Chromium",IE:"IE",MOBILE_SAFARI:"Mobile Safari",EDGE_CHROMIUM:"Edge Chromium"},DEVICE_TYPES:{MOBILE:"mobile",TABLET:"tablet",SMART_TV:"smarttv",CONSOLE:"console",WEARABLE:"wearable",BROWSER:void 0},OS_TYPES:{IOS:"iOS",ANDROID:"Android",WINDOWS_PHONE:"Windows Phone",WINDOWS:"Windows",MAC_OS:"Mac OS"},defaultData:{isMobile:!1,isTablet:!1,isBrowser:!1,isSmartTV:!1,isConsole:!1,isWearable:!1}}},function(e,t,n){var r,a=n(2),o=n(0),s=o.BROWSER_TYPES,i=o.OS_TYPES,u=o.DEVICE_TYPES,l=n(4),c=l.checkType,d=l.broPayload,p=l.mobilePayload,f=l.wearPayload,h=l.consolePayload,m=l.stvPayload,g=l.getNavigatorInstance,b=l.isIOS13Check,y=new a,x=y.getBrowser(),v=y.getDevice(),k=y.getEngine(),w=y.getOS(),I=y.getUA(),N=s.CHROME,T=s.CHROMIUM,C=s.IE,E=s.INTERNET_EXPLORER,S=s.OPERA,_=s.FIREFOX,$=s.SAFARI,R=s.EDGE,A=s.YANDEX,F=s.MOBILE_SAFARI,O=u.MOBILE,M=u.TABLET,D=u.SMART_TV,P=u.BROWSER,L=u.WEARABLE,B=u.CONSOLE,z=i.ANDROID,W=i.WINDOWS_PHONE,V=i.IOS,U=i.WINDOWS,H=i.MAC_OS,j=function j(){return w.name===i.WINDOWS&&"10"===w.version&&"string"==typeof I&&-1!==I.indexOf("Edg/")},G=function G(){return x.name===R},q=function q(){return b("iPad")},K=v.type===D,X=v.type===B,Y=v.type===L,Q=x.name===F||q(),Z=x.name===T,J=function(){switch(v.type){case O:case M:return!0;default:return!1}}()||q(),ee=v.type===O,te=v.type===M||q(),ne=v.type===P,re=w.name===z,ae=w.name===W,oe=w.name===V||q(),se=x.name===N,ie=x.name===_,ue=x.name===$||x.name===F,le=x.name===S,ce=x.name===E||x.name===C,de=w.version?w.version:"none",pe=w.name?w.name:"none",fe=x.major,he=x.version,me=x.name,ge=v.vendor?v.vendor:"none",be=v.model?v.model:"none",ye=k.name,xe=k.version,ve=I,ke=G()||j(),we=x.name===A,Ie=v.type,Ne=(r=g())&&(/iPad|iPhone|iPod/.test(r.platform)||"MacIntel"===r.platform&&r.maxTouchPoints>1)&&!window.MSStream,Te=q(),Ce=b("iPhone"),Ee=b("iPod"),Se=function(){var e=g(),t=e&&e.userAgent.toLowerCase();return"string"==typeof t&&/electron/.test(t)}(),_e=j(),$e=G(),Re=w.name===U,Ae=w.name===H,Fe=c(v.type);e.exports={deviceDetect:function deviceDetect(){var e=Fe.isBrowser,t=Fe.isMobile,n=Fe.isTablet,r=Fe.isSmartTV,a=Fe.isConsole,o=Fe.isWearable;return e?d(e,x,k,w,I):r?m(r,k,w,I):a?h(a,k,w,I):t||n?p(Fe,v,w,I):o?f(o,k,w,I):void 0},isSmartTV:K,isConsole:X,isWearable:Y,isMobileSafari:Q,isChromium:Z,isMobile:J,isMobileOnly:ee,isTablet:te,isBrowser:ne,isAndroid:re,isWinPhone:ae,isIOS:oe,isChrome:se,isFirefox:ie,isSafari:ue,isOpera:le,isIE:ce,osVersion:de,osName:pe,fullBrowserVersion:fe,browserVersion:he,browserName:me,mobileVendor:ge,mobileModel:be,engineName:ye,engineVersion:xe,getUA:ve,isEdge:ke,isYandex:we,deviceType:Ie,isIOS13:Ne,isIPad13:Te,isIPhone13:Ce,isIPod13:Ee,isElectron:Se,isEdgeChromium:_e,isLegacyEdge:$e,isWindows:Re,isMacOs:Ae}},function(e,t,n){var r;!function(a,o){var s="function",i="undefined",u="object",l="model",c="name",d="type",p="vendor",f="version",h="architecture",m="console",g="mobile",b="tablet",y="smarttv",x="wearable",v={extend:function extend(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},has:function has(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function lowerize(e){return e.toLowerCase()},major:function major(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:o},trim:function trim(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},k={rgx:function rgx(e,t){for(var n,r,a,i,l,c,d=0;d<t.length&&!l;){var p=t[d],f=t[d+1];for(n=r=0;n<p.length&&!l;)if(l=p[n++].exec(e))for(a=0;a<f.length;a++)c=l[++r],_typeof(i=f[a])===u&&i.length>0?2==i.length?_typeof(i[1])==s?this[i[0]]=i[1].call(this,c):this[i[0]]=i[1]:3==i.length?_typeof(i[1])!==s||i[1].exec&&i[1].test?this[i[0]]=c?c.replace(i[1],i[2]):o:this[i[0]]=c?i[1].call(this,c,i[2]):o:4==i.length&&(this[i[0]]=c?i[3].call(this,c.replace(i[1],i[2])):o):this[i]=c||o;d+=2}},str:function str(e,t){for(var n in t)if(_typeof(t[n])===u&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(v.has(t[n][r],e))return"?"===n?o:n}else if(v.has(t[n],e))return"?"===n?o:n;return e}},w={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},I={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[c,f],[/(opios)[\/\s]+([\w\.]+)/i],[[c,"Opera Mini"],f],[/\s(opr)\/([\w\.]+)/i],[[c,"Opera"],f],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[c,f],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[c,"IE"],f],[/(edge|edgios|edgea)\/((\d+)?[\w\.]+)/i],[[c,"Edge"],f],[/(yabrowser)\/([\w\.]+)/i],[[c,"Yandex"],f],[/(puffin)\/([\w\.]+)/i],[[c,"Puffin"],f],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[c,"UCBrowser"],f],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],f],[/(micromessenger)\/([\w\.]+)/i],[[c,"WeChat"],f],[/(qqbrowserlite)\/([\w\.]+)/i],[c,f],[/(QQ)\/([\d\.]+)/i],[c,f],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[c,f],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[c,f],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[c,f],[/(MetaSr)[\/\s]?([\w\.]+)/i],[c],[/(LBBROWSER)/i],[c],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[f,[c,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[f,[c,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[f,[c,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[c,/(.+)/,"$1 WebView"],f],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[c,/(.+(?:g|us))(.+)/,"$1 $2"],f],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[f,[c,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[c,f],[/(dolfin)\/([\w\.]+)/i],[[c,"Dolphin"],f],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[c,"Chrome"],f],[/(coast)\/([\w\.]+)/i],[[c,"Opera Coast"],f],[/fxios\/([\w\.-]+)/i],[f,[c,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[f,[c,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[f,c],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[c,"GSA"],f],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[c,[f,k.str,w.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[c,f],[/(navigator|netscape)\/([\w\.-]+)/i],[[c,"Netscape"],f],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[c,f]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,v.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[h,/ower/,"",v.lowerize]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[h,v.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[l,p,[d,b]],[/applecoremedia\/[\w\.]+ \((ipad)/],[l,[p,"Apple"],[d,b]],[/(apple\s{0,1}tv)/i],[[l,"Apple TV"],[p,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[p,l,[d,b]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[l,[p,"Amazon"],[d,b]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[l,k.str,w.device.amazon.model],[p,"Amazon"],[d,g]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[l,p,[d,g]],[/\((ip[honed|\s\w*]+);/i],[l,[p,"Apple"],[d,g]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[p,l,[d,g]],[/\(bb10;\s(\w+)/i],[l,[p,"BlackBerry"],[d,g]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[l,[p,"Asus"],[d,b]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[p,"Sony"],[l,"Xperia Tablet"],[d,b]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[l,[p,"Sony"],[d,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[p,l,[d,m]],[/android.+;\s(shield)\sbuild/i],[l,[p,"Nvidia"],[d,m]],[/(playstation\s[34portablevi]+)/i],[l,[p,"Sony"],[d,m]],[/(sprint\s(\w+))/i],[[p,k.str,w.device.sprint.vendor],[l,k.str,w.device.sprint.model],[d,g]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[p,l,[d,b]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[p,[l,/_/g," "],[d,g]],[/(nexus\s9)/i],[l,[p,"HTC"],[d,b]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[l,[p,"Huawei"],[d,g]],[/(microsoft);\s(lumia[\s\w]+)/i],[p,l,[d,g]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[l,[p,"Microsoft"],[d,m]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[p,"Microsoft"],[d,g]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[l,[p,"Motorola"],[d,g]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[l,[p,"Motorola"],[d,b]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[p,v.trim],[l,v.trim],[d,y]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[p,"Samsung"],[d,y]],[/\(dtv[\);].+(aquos)/i],[l,[p,"Sharp"],[d,y]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[p,"Samsung"],l,[d,b]],[/smart-tv.+(samsung)/i],[p,[d,y],l],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[p,"Samsung"],l,[d,g]],[/sie-(\w*)/i],[l,[p,"Siemens"],[d,g]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[p,"Nokia"],l,[d,g]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[l,[p,"Acer"],[d,b]],[/android.+([vl]k\-?\d{3})\s+build/i],[l,[p,"LG"],[d,b]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[p,"LG"],l,[d,b]],[/(lg) netcast\.tv/i],[p,l,[d,y]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[l,[p,"LG"],[d,g]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[l,[p,"Lenovo"],[d,b]],[/linux;.+((jolla));/i],[p,l,[d,g]],[/((pebble))app\/[\d\.]+\s/i],[p,l,[d,x]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[p,l,[d,g]],[/crkey/i],[[l,"Chromecast"],[p,"Google"]],[/android.+;\s(glass)\s\d/i],[l,[p,"Google"],[d,x]],[/android.+;\s(pixel c)\s/i],[l,[p,"Google"],[d,b]],[/android.+;\s(pixel xl|pixel)\s/i],[l,[p,"Google"],[d,g]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[l,/_/g," "],[p,"Xiaomi"],[d,g]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[l,/_/g," "],[p,"Xiaomi"],[d,b]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[l,[p,"Meizu"],[d,b]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[l,[p,"OnePlus"],[d,g]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[l,[p,"RCA"],[d,b]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[l,[p,"Dell"],[d,b]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[l,[p,"Verizon"],[d,b]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[p,"Barnes & Noble"],l,[d,b]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[l,[p,"NuVision"],[d,b]],[/android.+;\s(k88)\sbuild/i],[l,[p,"ZTE"],[d,b]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[l,[p,"Swiss"],[d,g]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[l,[p,"Swiss"],[d,b]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[l,[p,"Zeki"],[d,b]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[p,"Dragon Touch"],l,[d,b]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[l,[p,"Insignia"],[d,b]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[l,[p,"NextBook"],[d,b]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[p,"Voice"],l,[d,g]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[p,"LvTel"],l,[d,g]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[l,[p,"Envizen"],[d,b]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[p,l,[d,b]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[l,[p,"MachSpeed"],[d,b]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[p,l,[d,b]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[l,[p,"Rotor"],[d,b]],[/android.+(KS(.+))\s+build/i],[l,[p,"Amazon"],[d,b]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[p,l,[d,b]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[d,v.lowerize],p,l],[/(android[\w\.\s\-]{0,9});.+build/i],[l,[p,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[f,[c,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[c,f],[/rv\:([\w\.]{1,9}).+(gecko)/i],[f,c]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[c,f],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[c,[f,k.str,w.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[c,"Windows"],[f,k.str,w.os.windows.version]],[/\((bb)(10);/i],[[c,"BlackBerry"],f],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[c,f],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[c,"Symbian"],f],[/\((series40);/i],[c],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[c,"Firefox OS"],f],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[c,f],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[c,"Chromium OS"],f],[/(sunos)\s?([\w\.\d]*)/i],[[c,"Solaris"],f],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[c,f],[/(haiku)\s(\w+)/i],[c,f],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[f,/_/g,"."],[c,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[c,"Mac OS"],[f,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]*)/i],[c,f]]},N=function N(e,t){if("object"==_typeof(e)&&(t=e,e=o),!(this instanceof N))return new N(e,t).getResult();var n=e||(a&&a.navigator&&a.navigator.userAgent?a.navigator.userAgent:""),r=t?v.extend(I,t):I;return this.getBrowser=function(){var e={name:o,version:o};return k.rgx.call(e,n,r.browser),e.major=v.major(e.version),e},this.getCPU=function(){var e={architecture:o};return k.rgx.call(e,n,r.cpu),e},this.getDevice=function(){var e={vendor:o,model:o,type:o};return k.rgx.call(e,n,r.device),e},this.getEngine=function(){var e={name:o,version:o};return k.rgx.call(e,n,r.engine),e},this.getOS=function(){var e={name:o,version:o};return k.rgx.call(e,n,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this};N.VERSION="0.7.18",N.BROWSER={NAME:c,MAJOR:"major",VERSION:f},N.CPU={ARCHITECTURE:h},N.DEVICE={MODEL:l,VENDOR:p,TYPE:d,CONSOLE:m,MOBILE:g,SMARTTV:y,TABLET:b,WEARABLE:x,EMBEDDED:"embedded"},N.ENGINE={NAME:c,VERSION:f},N.OS={NAME:c,VERSION:f},_typeof(t)!==i?(_typeof(e)!==i&&e.exports&&(t=e.exports=N),t.UAParser=N):n(3)?(r=function(){return N}.call(t,n,t,e))===o||(e.exports=r):a&&(a.UAParser=N);var T=a&&(a.jQuery||a.Zepto);if(_typeof(T)!==i){var C=new N;T.ua=C.getResult(),T.ua.get=function(){return C.getUA()},T.ua.set=function(e){C.setUA(e);var t=C.getResult();for(var n in t)T.ua[n]=t[n]}}}("object"==("undefined"==typeof window?"undefined":_typeof(window))?window:this)},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=n(0),o=a.DEVICE_TYPES,s=a.defaultData,i=t.getNavigatorInstance=function(){return!("undefined"==typeof window||!window.navigator&&!navigator)&&(window.navigator||navigator)},u=t.isIOS13Check=function(e){var t=i();return t&&t.platform&&(-1!==t.platform.indexOf(e)||"MacIntel"===t.platform&&t.maxTouchPoints>1&&!window.MSStream)};e.exports={checkType:function checkType(e){switch(e){case o.MOBILE:return{isMobile:!0};case o.TABLET:return{isTablet:!0};case o.SMART_TV:return{isSmartTV:!0};case o.CONSOLE:return{isConsole:!0};case o.WEARABLE:return{isWearable:!0};case o.BROWSER:return{isBrowser:!0};default:return s}},broPayload:function broPayload(e,t,n,r,a){return{isBrowser:e,browserMajorVersion:t.major,browserFullVersion:t.version,browserName:t.name,engineName:n.name||!1,engineVersion:n.version,osName:r.name,osVersion:r.version,userAgent:a}},mobilePayload:function mobilePayload(e,t,n,a){return r({},e,{vendor:t.vendor,model:t.model,os:n.name,osVersion:n.version,ua:a})},stvPayload:function stvPayload(e,t,n,r){return{isSmartTV:e,engineName:t.name,engineVersion:t.version,osName:n.name,osVersion:n.version,userAgent:r}},consolePayload:function consolePayload(e,t,n,r){return{isConsole:e,engineName:t.name,engineVersion:t.version,osName:n.name,osVersion:n.version,userAgent:r}},wearPayload:function wearPayload(e,t,n,r){return{isWearable:e,engineName:t.name,engineVersion:t.version,osName:n.name,osVersion:n.version,userAgent:r}},getNavigatorInstance:i,isIOS13Check:u}}])})),G=function V(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(j),q=Object.freeze(Object.assign(Object.create(null),j,{default:G}));function K(){return"function"==typeof navigator.enumerateDevices?navigator.enumerateDevices():"object"===S(navigator.mediaDevices)&&"function"==typeof navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices():new Promise((function(e,t){try{if(null==window.MediaStreamTrack||null==window.MediaStreamTrack.getSources)throw new Error;window.MediaStreamTrack.getSources((function(t){e(t.filter((function(e){return"video"===e.kind.toLowerCase()||"videoinput"===e.kind.toLowerCase()})).map((function(e){return{deviceId:null!=e.deviceId?e.deviceId:"",groupId:e.groupId,kind:"videoinput",label:e.label,toJSON:function toJSON(){return this}}})))}))}catch(e){return t(e)}}))}function X(){var e=D(["\n  padding: 0.625rem 0 0.9375rem;\n  margin: 0;\n  text-align: left;\n  width: 100%;\n  cursor: pointer;\n  font-size: 0.82rem;\n  transition: all 550ms ease-in-out;\n\n  &:hover {\n    opacity: 0.8;\n  }\n"]);return X=function X(){return e},e}function Y(){var e=D(["\n  list-style: none;\n  padding: 0;\n"]);return Y=function Y(){return e},e}function Q(){var e=D(["\n  padding: 0 0 0.3125rem;\n  margin: 0.25rem auto;\n  font-size: 0.8rem;\n"]);return Q=function Q(){return e},e}function Z(){var e=D(["\n  margin: 0.25rem auto;\n  padding: 0;\n  font-weight: 600;\n  font-size: 1.2rem;\n"]);return Z=function Z(){return e},e}function J(){var e=D(["\n  text-align: center;\n  padding: 0.625rem 0;\n  border-bottom: 1px solid #dddddd;\n"]);return J=function J(){return e},e}function ee(){var e=D(["\n  width: 260px;\n  margin: 1.25rem;\n  padding: 0.625rem 1.875rem;\n  background: #ffffff;\n  border-radius: 0.3125rem;\n  box-shadow: 2px 2px 14px rgba(0, 0, 0, 0.15);\n"]);return ee=function ee(){return e},e}function te(){var e=D(["\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: ",";\n"]);return te=function te(){return e},e}function ne(){var e=D(["\n  z-index: ",";\n  position: absolute;\n  top: 40px;\n  color: red;\n"]);return ne=function ne(){return e},e}function re(){var e=D(["\n  z-index: ",";\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  width: 20px;\n"]);return re=function re(){return e},e}function ae(){var e=D(["\n  cursor: pointer;\n  text-align: center;\n  width: 50px;\n  img {\n    width: 100%;\n  }\n"]);return ae=function ae(){return e},e}function oe(){var e=D(["\n  width: 100%;\n  ","\n"]);return oe=function oe(){return e},e}function se(){var e=D(["\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  background: #000;\n  display: flex;\n  justify-content: center;\n  z-index: ",";\n  ","\n"]);return se=function se(){return e},e}var ie=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.Errors,le=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(se(),1e3,(function(e){return e.checkCameraMode&&"opacity: 0;"})),ce=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.video(oe(),(function(e){return e.flipHorizontal&&"\n     transform: scaleX(-1);\n  "})),de=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(ae()),pe=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(de)(re(),1100),fe=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(ne(),1020),he=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(te(),1030),me=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.section(ee()),ge=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.header(J()),be=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.h2(Z()),ye=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.p(Q()),xe=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.ul(Y()),ve=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.li(X()),ke=react__WEBPACK_IMPORTED_MODULE_126___default.a.createRef(),we=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices;var e=navigator.mozGetUserMedia||navigator.webkitGetUserMedia;return e?{getUserMedia:function getUserMedia(t){return new Promise((function(n,r){e.call(navigator,t,n,r)}))}}:null}();function Ie(o){var e,s=o.checkCameraMode,i=o.frontCamera,u=o.onClose,l=o.children,c=o.onVideoPlayed,d=o.flipHorizontal,p=o.videoSettings,f=o.refVideo,h=o.onError,m=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.m.useSDKSettings().lang,x=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.a.useAsset("ic_close.png"),v=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(""),2),k=v[0],w=v[1],I=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)([]),2),N=I[0],T=I[1],C=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(!1),2),E=C[0],S=C[1],_=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(!1),R=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){f.current.srcObject instanceof MediaStream&&(f.current.srcObject.getTracks().forEach((function(e){return e.stop()})),f.current.srcObject=null)}),[f]),A=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((e=$(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=j.isMobile?j.isIOS?{width:{ideal:1460},aspectRatio:{ideal:window.innerHeight/window.innerWidth}}:{width:{ideal:1650},aspectRatio:{ideal:window.innerHeight/window.innerWidth}}:{height:{ideal:9999}},e.prev=2,e.next=5,we.getUserMedia({audio:!1,video:M(M({},t?{deviceId:t}:{facingMode:i?"user":"environment"}),p||n)});case 5:return(r=e.sent)||(w(ie.not_supported.msg[m]),h(ie.not_supported)),e.abrupt("return",r);case 10:e.prev=10,e.t0=e.catch(2),"NotAllowedError"===e.t0.name?(w(ie.no_permission.msg[m]),h(ie.no_permission)):(S(!0),w(e.t0.message),h({code:e.t0.name||e.t0.code}));case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[2,10]])}))),function(t){return e.apply(this,arguments)}),[i,p,m,h]),F=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)(function(){var e=$(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=f.current).oncanplaythrough=function(){n.play();var e=window.innerWidth,t=window.innerHeight,r=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.d.analyzeVideoAndWindowSizes(n),a=r.lostX,o=void 0===a?0:a,s=r.lostY,i=void 0===s?0:s,u=Math.min(e,Math.floor(e-2*o)),l=Math.min(t,Math.floor(t-2*i));c&&c({clientWidth:e,clientHeight:t,videoAreaWidth:u,videoAreaHeight:l,lostX:o,lostY:i})},e.next=4,A(t);case 4:(r=e.sent)&&(n.srcObject=r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[f,A,c]);Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){function e(){return(e=$(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,K();case 3:t=e.sent,n=t.filter((function(e){return e.deviceId&&"videoinput"===e.kind})),T(n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}E&&!_.current&&(_.current=!0,function(){e.apply(this,arguments)}())}),[E]),Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){function e(){return(e=$(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F();case 2:return e.next=4,K();case 4:t=e.sent,(n=t.filter((function(e){return"videoinput"===e.kind&&e.label.includes("0")}))).length>0&&(r=n[0].deviceId,R(),F(r));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var t=f.current;return!we||j.browserName&&["facebook"].includes(j.browserName.toLowerCase())?(w(ie.not_supported.msg[m]),h(ie.not_supported)):t&&(j.isAndroid&&!1===i?function(){e.apply(this,arguments)}():F()),function(){R()}}),[f,m,i,F,R,h]);var O=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){R(),u&&u()}),[u,R]);return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(le,{checkCameraMode:s},E&&null!=N&&N.length?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(he,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(me,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ge,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(be,null,"Không thể mở camera mặc định"),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ye,null,"Vui lòng thử chọn camera khác trong danh sách dưới đây")),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(xe,null,N.map((function(t,n){return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ve,{key:t.deviceId,onClick:function onClick(){w(""),R(),S(!1),F(t.deviceId)}},t.label?t.label:"Camera ".concat(n+1))}))))):null,k?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(fe,null,k):null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ce,{ref:f,playsInline:!0,muted:!0,flipHorizontal:d}),l,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(pe,{onClick:O},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("img",{src:x,alt:""})))}Ie.propTypes={checkCameraMode:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,frontCamera:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,onClose:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,onError:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,onVideoPlayed:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,children:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.node,flipHorizontal:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,videoSettings:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.object,refVideo:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.object},Ie.defaultProps={checkCameraMode:!1,frontCamera:!0,onClose:null,onError:function onError(){},onVideoPlayed:null,children:null,flipHorizontal:!1,videoSettings:null,refVideo:null};var Ne=react__WEBPACK_IMPORTED_MODULE_126___default.a.forwardRef((function(t,n){return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Ie,F({},t,{refVideo:n||ke}))}));function Te(){var e=D(["\n  position: relative;\n"]);return Te=function Te(){return e},e}function Ce(){var e=D(["\n  width: 100%;\n  height: 100%;\n  td {\n    text-align: center;\n    vertical-align: middle;\n    padding: 0;\n    border: 0;\n  }\n  border-spacing: 0px;\n  table-layout: auto;\n"]);return Ce=function Ce(){return e},e}var Ee=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.table(Ce()),Se=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(Te()),_e=Array.from(Array(3).keys()),$e=Array.from(Array(3).keys());function Re(t){var n=t.children,r=t.x,a=t.y,o=t.width,s=t.height,i=t.className,u=t.surroundStyle;return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Ee,{className:i},_e.map((function(t,i){return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("tr",{key:t,style:{height:0===i?a:"auto"}},$e.map((function(t,a){var l=1===i&&1===a,c="auto";return l?c=o:0===a&&(c=r),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("td",{key:t,style:M({width:c,height:l?s:"auto"},l?{}:u)},l?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Se,{style:{width:c,height:s}},n):null)})))})))}function Ae(){var e=D(["\n  background: transparent;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  z-index: ",";\n"]);return Ae=function Ae(){return e},e}Re.propTypes={children:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.node,x:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,y:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,width:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,height:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,className:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,surroundStyle:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.object},Re.defaultProps={children:null,x:"auto",y:"auto",width:"auto",height:"auto",className:"",surroundStyle:{}};var Fe=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(Re)(Ae(),1010);function Oe(t){var n=t.className;return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("svg",{className:n,width:"38px",height:"32px",viewBox:"0 0 24 21"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("title",null,"FA45C15C-1E21-4D7B-9585-07FB9F999CB8"),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("desc",null,"Created with sketchtool."),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("g",{id:"Web-demo",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("g",{id:"step1",transform:"translate(-950.000000, -380.000000)",fill:"currentColor",fillRule:"nonzero"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("g",{id:"Group",transform:"translate(950.000000, 380.000000)"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("g",{id:"Group-2"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("g",{id:"camera"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("path",{d:"M21,3 L17,3 L15,0 L9,0 L7,3 L3,3 C1.34314575,3 0,4.34314575 0,6 L0,18 C0,19.6568542 1.34314575,21 3,21 L21,21 C22.6568542,21 24,19.6568542 24,18 L24,6 C24,4.34314575 22.6568542,3 21,3 Z M12,17 C9.23857625,17 7,14.7614237 7,12 C7,9.23857625 9.23857625,7 12,7 C14.7614237,7 17,9.23857625 17,12 C17,14.7614237 14.7614237,17 12,17 L12,17 Z",id:"Shape"})))))))}Oe.propTypes={className:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string},Oe.defaultProps={className:""};var Me=function Me(e){var t=_typeof(e);return null!=e&&("object"==t||"function"==t)},De="object"==_typeof(W)&&W&&W.Object===Object&&W,Pe="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self&&self.Object===Object&&self,Le=De||Pe||Function("return this")(),Be=function Be(){return Le.Date.now()},ze=Le.Symbol,We=Object.prototype,Ve=We.hasOwnProperty,Ue=We.toString,He=ze?ze.toStringTag:void 0,Ge=Object.prototype.toString,Ke=ze?ze.toStringTag:void 0,Xe=function Xe(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Ke&&Ke in Object(e)?function je(e){var t=Ve.call(e,He),n=e[He];try{e[He]=void 0;var r=!0}catch(e){}var a=Ue.call(e);return r&&(t?e[He]=n:delete e[He]),a}(e):function qe(e){return Ge.call(e)}(e)},Ye=function Ye(e){return null!=e&&"object"==_typeof(e)},Qe=function Qe(e){return"symbol"==_typeof(e)||Ye(e)&&"[object Symbol]"==Xe(e)},Ze=/^\s+|\s+$/g,Je=/^[-+]0x[0-9a-f]+$/i,et=/^0b[01]+$/i,tt=/^0o[0-7]+$/i,nt=parseInt,rt=function rt(e){if("number"==typeof e)return e;if(Qe(e))return NaN;if(Me(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Me(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Ze,"");var n=et.test(e);return n||tt.test(e)?nt(e.slice(2),n?2:8):Je.test(e)?NaN:+e},at=Math.max,ot=Math.min,st=function st(e,t,n){var r,a,o,s,i,u,l=0,c=!1,d=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=r,o=a;return r=a=void 0,l=t,s=e.apply(o,n)}function h(e){return l=e,i=setTimeout(g,t),c?f(e):s}function m(e){var n=e-u;return void 0===u||n>=t||n<0||d&&e-l>=o}function g(){var e=Be();if(m(e))return b(e);i=setTimeout(g,function(e){var n=t-(e-u);return d?ot(n,o-(e-l)):n}(e))}function b(e){return i=void 0,p&&r?f(e):(r=a=void 0,s)}function y(){var e=Be(),n=m(e);if(r=arguments,a=this,u=e,n){if(void 0===i)return h(u);if(d)return clearTimeout(i),i=setTimeout(g,t),f(u)}return void 0===i&&(i=setTimeout(g,t)),s}return t=rt(t)||0,Me(n)&&(c=!!n.leading,o=(d="maxWait"in n)?at(rt(n.maxWait)||0,t):o,p="trailing"in n?!!n.trailing:p),y.cancel=function(){void 0!==i&&clearTimeout(i),l=0,r=u=a=i=void 0},y.flush=function(){return void 0===i?s:b(Be())},y},it=function(){function it(e,t){_classCallCheck(this,it),this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return _createClass(it,[{key:"get",value:function get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function set(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function has(e){return this.data.has(e)}},{key:"delete",value:function _delete(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function numDataIds(){return this.dataIdsCount}}]),it}(),ut=function(){function ut(){_classCallCheck(this,ut)}return _createClass(ut,[{key:"refCount",value:function refCount(e){return lt("refCount")}},{key:"incRef",value:function incRef(e){return lt("incRef")}},{key:"timerAvailable",value:function timerAvailable(){return!0}},{key:"time",value:function time(e){return lt("time")}},{key:"read",value:function read(e){return lt("read")}},{key:"readSync",value:function readSync(e){return lt("readSync")}},{key:"numDataIds",value:function numDataIds(){return lt("numDataIds")}},{key:"disposeData",value:function disposeData(e,t){return lt("disposeData")}},{key:"write",value:function write(e,t,n){return lt("write")}},{key:"move",value:function move(e,t,n,r,a){return lt("move")}},{key:"memory",value:function memory(){return lt("memory")}},{key:"floatPrecision",value:function floatPrecision(){return lt("floatPrecision")}},{key:"epsilon",value:function epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function dispose(){return lt("dispose")}}]),ut}();function lt(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function ct(e,t,n){return Math.max(e,Math.min(t,n))}function dt(e){return e%2==0?e:e+1}function pt(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function ft(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";pt(bt(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function ht(e){pt(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function mt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||St(e)&&!n)for(var _r2=0;_r2<e.length;++_r2)mt(e[_r2],t,n);else t.push(e);return t}function gt(e){if(0===e.length)return 1;for(var t=e[0],_n2=1;_n2<e.length;_n2++)t*=e[_n2];return t}function bt(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var _n3=0;_n3<e.length;_n3++)if(e[_n3]!==t[_n3])return!1;return!0}function yt(e){return e%1==0}function xt(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function vt(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function kt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var o=0;!function s(){if(e())r();else{o++;var i=t(o);null!=n&&o>=n?a():setTimeout(s,i)}}()}))}function wt(e,t){for(var n=1,r=-1,_t2=0;_t2<e.length;++_t2)if(e[_t2]>=0)n*=e[_t2];else if(-1===e[_t2]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(_t2));r=_t2}else if(e[_t2]<0)throw Error("Shapes can not be < 0. Found ".concat(e[_t2]," at dim ").concat(_t2));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var a=e.slice();return a[r]=t/n,a}function It(e,t){var n=t.length;return pt((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e)})),pt(e.every((function(e){return yt(e)})),(function(){return"All values in axis param must be integers but got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function Nt(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,o=null==t||a?null:It(t,e).sort(),s=0,_t3=0;_t3<e.length;++_t3){if(null!=o){if(o[s]===_t3&&1!==e[_t3])throw new Error("Can't squeeze axis ".concat(_t3," since its dim '").concat(e[_t3],"' is not 1"));(null==o[s]||o[s]>_t3)&&1===e[_t3]&&(n.push(e[_t3]),r.push(_t3)),o[s]<=_t3&&s++}1!==e[_t3]&&(n.push(e[_t3]),r.push(_t3))}return{newShape:n,keptDims:r}}function Tt(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function Ct(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function Et(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function St(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function _t(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function $t(e){return"string"==typeof e||e instanceof String}function Rt(e){return Array.isArray(e)?Rt(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":"number"==typeof e?"float32":$t(e)?"string":function(e){return"boolean"==typeof e}(e)?"bool":"float32"}function At(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Ft(e,t){for(var _n4=t;_n4<e;++_n4)if(e%_n4==0)return _n4;return e}function Ot(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var _r3=t-3;_r3>=0;--_r3)n[_r3]=n[_r3+1]*e[_r3+1];return n}function Dt(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length,"."));return function Mt(e,t,n){var r=new Array;if(1===t.length)for(var _a2=t[0],_t4=0;_t4<_a2;_t4++)r[_t4]=n[e+_t4];else for(var _a3=t[0],_o2=t.slice(1),_s2=_o2.reduce((function(e,t){return e*t})),_t5=0;_t5<_a3;_t5++)r[_t5]=Mt(e+_t5*_s2,_o2,n);return r}(0,e,t)}function Pt(e,t){for(var n=Lt(e,t),_e2=0;_e2<n.length;_e2++)n[_e2]=1;return n}function Lt(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Bt(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return Dt(e,new Float32Array(n));if("int32"===t)return Dt(e,new Int32Array(n));if("bool"===t)return Dt(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function zt(e){e.forEach((function(t){pt(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function Wt(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],_t6=0;_t6<e.length-1;++_t6)r+=n[_t6]*e[_t6];return r}function Vt(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),_t7=0;_t7<r.length-1;++_t7)r[_t7]=Math.floor(e/n[_t7]),e-=r[_t7]*n[_t7];return r[r.length-1]=e,r}function Ut(e){return e&&e.then&&"function"==typeof e.then}var Ht=function(){function Ht(e){_classCallCheck(this,Ht),this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}var _getAsync;return _createClass(Ht,[{key:"setPlatform",value:function setPlatform(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(t,".")),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var _t8=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(_t8,".")),this.set(e,_t8)}}},{key:"getAsync",value:(_getAsync=_asyncToGenerator(regeneratorRuntime.mark((function _callee(e){return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_context.t0=e in this.flags,_context.t0){_context.next=5;break}return _context.next=4,this.evaluateFlag(e);case 4:this.flags[e]=_context.sent;case 5:return _context.abrupt("return",this.flags[e]);case 6:case"end":return _context.stop()}}),_callee,this)}))),function getAsync(_x2){return _getAsync.apply(this,arguments)})},{key:"get",value:function get(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Ut(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function getNumber(e){return this.get(e)}},{key:"getBool",value:function getBool(e){return this.get(e)}},{key:"getFlags",value:function getFlags(){return this.flags}},{key:"set",value:function set(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function setFlags(e){this.flags=Object.assign({},e)}},{key:"reset",value:function reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function populateURLFlags(){var _this=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e=function(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var _len=arguments.length,n=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)n[_key-1]=arguments[_key];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")})),t}(this.global.location.search);"tfjsflags"in e&&e.tfjsflags.split(",").forEach((function(e){var _e$split2=_slicedToArray(e.split(":"),2),t=_e$split2[0],n=_e$split2[1];_this.urlFlags[t]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(t,n)}))}}},{key:"features",get:function get(){return this.flags}}]),Ht}();function jt(){return qt}var Gt,qt=null;function Kt(){if(null==Gt){var _e3;if("undefined"!=typeof window)_e3=window;else if(void 0!==global)_e3=global;else if(void 0!==process)_e3=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");_e3=self}Gt=_e3}return Gt}function Xt(e,t){var n=function(){var e=Kt();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var _r4=t();return n.set(e,_r4),n.get(e)}var Yt="Add",Qt=Xt("kernelRegistry",(function(){return new Map})),Zt=Xt("gradRegistry",(function(){return new Map}));function Jt(e,t){var n=rn(e,t);return Qt.get(n)}function en(e){return Zt.get(e)}function tn(e){for(var t=Qt.entries(),n=[];;){var _t$next=t.next(),_r5=_t$next.done,_a4=_t$next.value;if(_r5)break;var _a5=_slicedToArray(_a4,2),_o3=_a5[0],_s3=_a5[1];_slicedToArray(_o3.split("_"),1)[0]===e&&n.push(_s3)}return n}function nn(e){var t=e.kernelName,n=e.backendName,r=rn(t,n);Qt.has(r)&&console.warn("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),Qt.set(r,e)}function rn(e,t){return"".concat(t,"_").concat(e)}function an(e,t){return"string"===t?un(e):on([e],t)}function on(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=mt(e)),jt().getBool("DEBUG")&&function(e,t){for(var _n5=0;_n5<e.length;_n5++){var _r6=e[_n5];if(isNaN(_r6)||!isFinite(_r6))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(_r6,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var _t9=new Uint8Array(e.length),_n6=0;_n6<_t9.length;++_n6)0!==Math.round(e[_n6])&&(_t9[_n6]=1);return _t9}throw new Error("Unknown data type ".concat(t))}function sn(){return jt().platform.now()}function un(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",jt().platform.encode(e,t)}function ln(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",jt().platform.decode(e,t)}var cn=function(){function cn(e,t){_classCallCheck(this,cn),this.backendTimer=e,this.logger=t,null==t&&(this.logger=new pn)}return _createClass(cn,[{key:"profileKernel",value:function profileKernel(e,t,n){var r,o,a=function a(){r=n()},s=sn();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(a);else{a();var _step,_iterator=_createForOfIteratorHelper(r);try{for(_iterator.s();!(_step=_iterator.n()).done;){_step.value.dataSync()}}catch(err){_iterator.e(err)}finally{_iterator.f()}o=Promise.resolve({kernelMs:sn()-s})}if(jt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var _loop=function _loop(_t10){var n=r[_t10];n.data().then((function(t){!function dn(e,t,n){if("float32"!==t)return!1;for(var _t11=0;_t11<e.length;_t11++){var _r7=e[_t11];if(isNaN(_r7)||!isFinite(_r7))return console.warn("Found ".concat(_r7," in the result of '").concat(n,"'")),!0}return!1}(t,n.dtype,e)}))},_t10=0;_t10<r.length;_t10++)_loop(_t10);return{kernelName:e,outputs:r,inputs:t,timeMs:o.then((function(e){return e.kernelMs})),extraInfo:o.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function logKernelProfile(e){var _this2=this,t=e.kernelName,n=e.outputs,r=e.timeMs,a=e.inputs,o=e.extraInfo;n.forEach((function(e){Promise.all([e.data(),r,o]).then((function(n){_this2.logger.logKernelProfile(t,e,n[0],n[1],a,n[2])}))}))}}]),cn}();var pn=function(){function pn(){_classCallCheck(this,pn)}return _createClass(pn,[{key:"logKernelProfile",value:function logKernelProfile(e,t,n,r,a,o){var s="number"==typeof r?vt("".concat(r,"ms"),9):r.error,i=vt(e,25),u=t.rank,l=t.size,c=vt(t.shape.toString(),14),d="";for(var _e5 in a){var _n7=a[_e5];if(null!=_n7){var _r8=_n7.shape||t.shape,_a6=_r8.length;d+="".concat(_e5,": ").concat(_a6,"D ").concat(_a6>0?_r8:""," ")}}console.log("%c".concat(i,"\t%c").concat(s,"\t%c").concat(u,"D ").concat(c,"\t%c").concat(l,"\t%c").concat(d,"\t%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),pn}();function fn(e,t,n,r){var a=Ot(t),o=function(e,t,n,r){var a=gt(t),o=r[r.length-1],s=new Array(o).fill(0),i=t.length,u="complex64"===n?bn(e):e;if(i>1)for(var _e6=0;_e6<a/o;_e6++)for(var _t12=_e6*o,_e7=0;_e7<o;_e7++)s[_e7]=Math.max(s[_e7],hn(u[_t12+_e7],0,n).length);return s}(e,t,n,a),s=t.length,i=function gn(e,t,n,r,a){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s="complex64"===n?2:1,i=t[0],u=t.length;if(0===u)return"complex64"===n?[hn(bn(e)[0],0,n)]:"bool"===n?[mn(e[0])]:[e[0].toString()];if(1===u){if(i>20){var _t13=3*s,_r9=Array.from(e.slice(0,_t13)),_o4=Array.from(e.slice((i-3)*s,i*s));return"complex64"===n&&(_r9=bn(_r9),_o4=bn(_o4)),["["+_r9.map((function(e,t){return hn(e,a[t],n)})).join(", ")+", ..., "+_o4.map((function(e,t){return hn(e,a[i-3+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?bn(e):Array.from(e)).map((function(e,t){return hn(e,a[t],n)})).join(", ")+"]"]}var l=t.slice(1),c=r.slice(1),d=r[0]*s,p=[];if(i>20){for(var _t14=0;_t14<3;_t14++){var _r10=_t14*d,_o5=_r10+d;p.push.apply(p,_toConsumableArray(gn(e.slice(_r10,_o5),l,n,c,a,!1)))}p.push("...");for(var _t15=i-3;_t15<i;_t15++){var _r11=_t15*d,_o6=_r11+d;p.push.apply(p,_toConsumableArray(gn(e.slice(_r11,_o6),l,n,c,a,_t15===i-1)))}}else for(var _t16=0;_t16<i;_t16++){var _r12=_t16*d,_o7=_r12+d;p.push.apply(p,_toConsumableArray(gn(e.slice(_r12,_o7),l,n,c,a,_t16===i-1)))}var f=2===u?",":"";p[0]="["+p[0]+f;for(var _e8=1;_e8<p.length-1;_e8++)p[_e8]=" "+p[_e8]+f;for(var h=",\n",_e9=2;_e9<u;_e9++)h+="\n";return p[p.length-1]=" "+p[p.length-1]+"]"+(o?"":h),p}(e,t,n,a,o),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(s)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(i.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function hn(e,t,n){return vt(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ").concat(parseFloat(e[1].toFixed(7)),"j"):$t(e)?"'".concat(e,"'"):"bool"===n?mn(e):parseFloat(e.toFixed(7)).toString(),t)}function mn(e){return 0===e?"false":"true"}function bn(e){for(var t=[],_n8=0;_n8<e.length;_n8+=2)t.push([e[_n8],e[_n8+1]]);return t}var yn=function(){function yn(e,t,n){var _this3=this;if(_classCallCheck(this,yn),this.dtype=t,this.shape=e.slice(),this.size=gt(e),null!=n){var _e10=n.length;pt(_e10===this.size,(function(){return"Length of values '".concat(_e10,"' does not match the size inferred by the shape '").concat(_this3.size,"'.")}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Ct(t,this.size),this.strides=Ot(e)}return _createClass(yn,[{key:"set",value:function set(e){for(var _this4=this,_len2=arguments.length,t=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)t[_key2-1]=arguments[_key2];0===t.length&&(t=[0]),pt(t.length===this.rank,(function(){return"The number of provided coordinates (".concat(t.length,") must match the rank (").concat(_this4.rank,")")}));var n=this.locToIndex(t);this.values[n]=e}},{key:"get",value:function get(){for(var _len3=arguments.length,e=new Array(_len3),_key3=0;_key3<_len3;_key3++)e[_key3]=arguments[_key3];0===e.length&&(e=[0]);for(var t=0,_i3=0,_e11=e;_i3<_e11.length;_i3++){var _n9=_e11[_i3];if(_n9<0||_n9>=this.shape[t]){var _t17="Requested out of range element at ".concat(e,".   Buffer shape=").concat(this.shape);throw new Error(_t17)}t++}for(var n=e[e.length-1],_t18=0;_t18<e.length-1;++_t18)n+=this.strides[_t18]*e[_t18];return this.values[n]}},{key:"locToIndex",value:function locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],_n10=0;_n10<e.length-1;++_n10)t+=this.strides[_n10]*e[_n10];return t}},{key:"indexToLoc",value:function indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),_n11=0;_n11<t.length-1;++_n11)t[_n11]=Math.floor(e/this.strides[_n11]),e-=t[_n11]*this.strides[_n11];return t[t.length-1]=e,t}},{key:"toTensor",value:function toTensor(){return xn().makeTensor(this.values,this.shape,this.dtype)}},{key:"rank",get:function get(){return this.shape.length}}]),yn}(),xn=null,vn=null,kn=function(){function kn(e,t,n,r){_classCallCheck(this,kn),this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=gt(e),this.strides=Ot(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}var _bytes,_data,_array,_buffer;return _createClass(kn,[{key:"buffer",value:(_buffer=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var e;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.data();case 2:return e=_context2.sent,_context2.abrupt("return",vn.buffer(this.shape,this.dtype,e));case 4:case"end":return _context2.stop()}}),_callee2,this)}))),function buffer(){return _buffer.apply(this,arguments)})},{key:"bufferSync",value:function bufferSync(){return vn.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:(_array=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var e;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.data();case 2:return e=_context3.sent,_context3.abrupt("return",Dt(this.shape,e));case 4:case"end":return _context3.stop()}}),_callee3,this)}))),function array(){return _array.apply(this,arguments)})},{key:"arraySync",value:function arraySync(){return Dt(this.shape,this.dataSync())}},{key:"data",value:(_data=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){var e,_t19;return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(this.throwIfDisposed(),e=xn().read(this.dataId),"string"!==this.dtype){_context4.next=13;break}return _context4.next=5,e;case 5:return _t19=_context4.sent,_context4.prev=6,_context4.abrupt("return",_t19.map((function(e){return ln(e)})));case 10:throw _context4.prev=10,_context4.t0=_context4.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return _context4.abrupt("return",e);case 14:case"end":return _context4.stop()}}),_callee4,this,[[6,10]])}))),function data(){return _data.apply(this,arguments)})},{key:"dataSync",value:function dataSync(){this.throwIfDisposed();var e=xn().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return ln(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:(_bytes=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(){var e;return regeneratorRuntime.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return this.throwIfDisposed(),_context5.next=3,xn().read(this.dataId);case 3:return e=_context5.sent,_context5.abrupt("return","string"===this.dtype?e:new Uint8Array(e.buffer));case 5:case"end":return _context5.stop()}}),_callee5,this)}))),function bytes(){return _bytes.apply(this,arguments)})},{key:"dispose",value:function dispose(){this.isDisposed||(xn().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"throwIfDisposed",value:function throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function print(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return vn.print(this,e)}},{key:"clone",value:function clone(){return this.throwIfDisposed(),vn.clone(this)}},{key:"toString",value:function toString(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return fn(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function cast(e){return this.throwIfDisposed(),vn.cast(this,e)}},{key:"variable",value:function variable(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),xn().makeVariable(this,e,t,n)}},{key:"rank",get:function get(){return this.shape.length}},{key:"isDisposed",get:function get(){return this.isDisposedInternal}}]),kn}();Object.defineProperty(kn,Symbol.hasInstance,{value:function value(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),Xt("Tensor",(function(){return kn}));var In,Nn,Tn,Cn,En,e,wn=function(_kn){_inherits(wn,_kn);var _super=_createSuper(wn);function wn(e,t,n,r){var _this5;return _classCallCheck(this,wn),(_this5=_super.call(this,e.shape,e.dtype,e.dataId,r)).trainable=t,_this5.name=n,_this5}return _createClass(wn,[{key:"assign",value:function assign(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!bt(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));xn().disposeTensor(this),this.dataId=e.dataId,xn().incRef(this,null)}},{key:"dispose",value:function dispose(){xn().disposeVariable(this),this.isDisposedInternal=!0}}]),wn}(kn);Object.defineProperty(wn,Symbol.hasInstance,{value:function value(e){return e instanceof kn&&null!=e.assign&&e.assign instanceof Function}}),(e=In||(In={})).R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6",function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Nn||(Nn={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Tn||(Tn={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Cn||(Cn={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(En||(En={}));var Sn={float32:Cn,int32:Nn,bool:Tn,complex64:En};function _n(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Sn[e][t]}function $n(e){return _n(e,"int32")}function Rn(e,t){if(e.dtype===t.dtype)return[e,t];var n=_n(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function An(e){var t=[];return function Fn(e,t,n){if(null==e)return;if(e instanceof kn)return void t.push(e);if(r=e,!Array.isArray(r)&&"object"!=_typeof(r))return;var r,a=e;for(var _e12 in a){var _r13=a[_e12];n.has(_r13)||(n.add(_r13),Fn(_r13,t,n))}}(e,t,new Set),t}function On(e){return null!=e.kernelName}var Mn=function(){function Mn(){_classCallCheck(this,Mn),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return _createClass(Mn,[{key:"dispose",value:function dispose(){for(var _e13 in this.registeredVariables)this.registeredVariables[_e13].dispose()}}]),Mn}(),Dn=function(){function Dn(e){_classCallCheck(this,Dn),this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Mn}var _time,_profile,_setBackend,_ready;return _createClass(Dn,[{key:"ready",value:(_ready=_asyncToGenerator(regeneratorRuntime.mark((function _callee6(){var e,_t20,_n12;return regeneratorRuntime.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(null==this.pendingBackendInit){_context6.next=2;break}return _context6.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){_context6.next=4;break}return _context6.abrupt("return");case 4:e=this.getSortedBackends(),_t20=0;case 6:if(!(_t20<e.length)){_context6.next=17;break}return _n12=e[_t20],_context6.next=10,this.initializeBackend(_n12).success;case 10:if(!_context6.sent){_context6.next=14;break}return _context6.next=13,this.setBackend(_n12);case 13:return _context6.abrupt("return",void _context6.sent);case 14:_t20++,_context6.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return _context6.stop()}}),_callee6,this)}))),function ready(){return _ready.apply(this,arguments)})},{key:"backendNames",value:function backendNames(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function registerBackend(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:(_setBackend=_asyncToGenerator(regeneratorRuntime.mark((function _callee7(e){var _this$initializeBacke2,_t22;return regeneratorRuntime.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(null!=this.registryFactory[e]){_context7.next=2;break}throw new Error("Backend name '".concat(e,"' not found in registry"));case 2:if(this.backendName=e,null!=this.registry[e]){_context7.next=14;break}if(this.backendInstance=null,_this$initializeBacke2=this.initializeBackend(e),_t22=_this$initializeBacke2.success,!_this$initializeBacke2.asyncInit){_context7.next=11;break}return _context7.next=8,_t22;case 8:_context7.t0=_context7.sent,_context7.next=12;break;case 11:_context7.t0=_t22;case 12:if(_context7.t0){_context7.next=14;break}return _context7.abrupt("return",!1);case 14:return _context7.abrupt("return",(this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new cn(this.backendInstance),!0));case 15:case"end":return _context7.stop()}}),_callee7,this)}))),function setBackend(_x3){return _setBackend.apply(this,arguments)})},{key:"setupRegisteredKernels",value:function setupRegisteredKernels(){var _this6=this;tn(this.backendName).forEach((function(e){null!=e.setupFunc&&e.setupFunc(_this6.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function disposeRegisteredKernels(e){var _this7=this;tn(e).forEach((function(t){null!=t.disposeFunc&&t.disposeFunc(_this7.registry[e])}))}},{key:"initializeBackend",value:function initializeBackend(e){var _this8=this,t=this.registryFactory[e];if(null==t)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var _n14=t.factory();if(!_n14||_n14 instanceof ut||"function"!=typeof _n14.then)return this.registry[e]=_n14,{success:!0,asyncInit:!1};var _t23=++this.pendingBackendInitId,_r14=_n14.then((function(n){return!(_t23<_this8.pendingBackendInitId||(_this8.registry[e]=n,_this8.pendingBackendInit=null,0))})).catch((function(n){return _t23<_this8.pendingBackendInitId||(_this8.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1}));return this.pendingBackendInit=_r14,{success:_r14,asyncInit:!0}}catch(t){return console.warn("Initialization of backend ".concat(e," failed")),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function removeBackend(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function getSortedBackends(){var _this9=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(e,t){return _this9.registryFactory[t].priority-_this9.registryFactory[e].priority}))}},{key:"initializeBackendsAndReturnBest",value:function initializeBackendsAndReturnBest(){for(var e=this.getSortedBackends(),_t24=0;_t24<e.length;_t24++){var _n15=e[_t24],_this$initializeBacke3=this.initializeBackend(_n15),_r15=_this$initializeBacke3.success,_a7=_this$initializeBacke3.asyncInit;if(_a7||_r15)return{name:_n15,asyncInit:_a7}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function moveData(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function tidy(e,t){var n,_this10=this,r=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun((function(){return _this10.startScope(r)}),(function(){return _this10.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function scopedRun(e,t,n){e();try{var _e14=n();return t(),_e14}catch(e){throw t(),e}}},{key:"nextTensorId",value:function nextTensorId(){return Dn.nextTensorId++}},{key:"nextVariableId",value:function nextVariableId(){return Dn.nextVariableId++}},{key:"clone",value:function clone(e){var t=Ln.runKernel("Identity",{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function x(){var t={x:e};return Ln.runKernel("Cast",t,{dtype:"float32"})}}}),[],{}),t}},{key:"runKernel",value:function runKernel(e,t,n){if(null==Jt(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function checkKernelForMemLeak(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=r-t-a-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(s," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function runKernelFunc(e){var t,s,i,_this11=this,n=[],r=this.isTapeOn(),a=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var u=On(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(On(e)){var _t25=e.kernelName,_a8=e.inputs,_o8=e.attrs;null==this.backendName&&this.backend;var _u2=Jt(_t25,this.backendName);pt(null!=_u2,(function(){return"Cannot find registered kernel '".concat(_t25,"' for backend '").concat(_this11.backendName,"'")})),s=function s(){var e=_this11.backend.numDataIds();i=_u2.kernelFunc({inputs:_a8,attrs:_o8,backend:_this11.backend});var s=Array.isArray(i)?i:[i];_this11.shouldCheckForMemLeaks()&&_this11.checkKernelForMemLeak(_t25,e,s);var l=s.map((function(e){if(null!=e.rank)return e;var t=e.dataId,n=e.shape,r=e.dtype;return _this11.makeTensorFromDataId(t,n,r)}));if(r){var _e15=_this11.getTensorsForGradient(_t25,_a8,l);n=_this11.saveTensorsForBackwardMode(_e15)}return l}}else{var _t26=e.forwardFunc,_a9=function _a9(e){r&&(n=e.map((function(e){return _this11.keep(_this11.clone(e))})))};s=function s(){var e=_this11.backend.numDataIds();i=_this11.tidy((function(){return _t26(_this11.backend,_a9)}));var n=Array.isArray(i)?i:[i];return _this11.shouldCheckForMemLeaks()&&_this11.checkKernelForMemLeak(u,e,n),n}}var p,l=e.inputs,c=e.attrs,d=On(e)?null:e.backwardsFunc;return this.scopedRun((function(){return _this11.state.kernelDepth++}),(function(){return _this11.state.kernelDepth--}),(function(){_this11.ENV.getBool("DEBUG")||_this11.state.profiling?(p=_this11.profiler.profileKernel(u,l,(function(){return s()})),_this11.ENV.getBool("DEBUG")&&_this11.profiler.logKernelProfile(p),t=p.outputs):t=s()})),r&&this.addTapeNode(u,l,t,d,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map((function(e){return null!=l[e]?l[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(i)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function saveTensorsForBackwardMode(e){var _this12=this;return e.map((function(e){return _this12.keep(_this12.clone(e))}))}},{key:"getTensorsForGradient",value:function getTensorsForGradient(e,t,n){var r=en(e);if(null!=r){var _o9,_e16=r.inputsToSave||[],_a10=r.outputsToSave||[];r.saveAllInputs?(pt(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),_o9=Object.keys(t).map((function(e){return t[e]}))):_o9=_e16.map((function(e){return t[e]}));var _s4=n.filter((function(e,t){return _a10[t]}));return _o9.concat(_s4)}return[]}},{key:"makeTensor",value:function makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&$t(e[0])&&(a=e.map((function(e){return un(e)})));var o=r.write(a,t,n),s=new kn(t,n,o,this.nextTensorId());if(this.trackTensor(s,r),"string"===n){var _e17=this.state.tensorInfo.get(o),_t27=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=_t27-_e17.bytes,_e17.bytes=_t27}return s}},{key:"makeTensorFromDataId",value:function makeTensorFromDataId(e,t,n,r){var a=new kn(t,n=n||"float32",e,this.nextTensorId());return this.trackTensor(a,r),a}},{key:"makeVariable",value:function makeVariable(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new wn(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*_t(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof wn||this.track(e)}},{key:"incRef",value:function incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function disposeTensor(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var _t28=e.size*_t(e.dtype);this.state.numBytes-=_t28}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function disposeVariables(){for(var _e18 in this.state.registeredVariables){var _t29=this.state.registeredVariables[_e18];this.disposeVariable(_t29)}}},{key:"disposeVariable",value:function disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function memory(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:(_profile=_asyncToGenerator(regeneratorRuntime.mark((function _callee8(e){var t,n,_iterator2,_step2,_e19;return regeneratorRuntime.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],_context8.next=5,e();case 5:this.state.activeProfile.result=_context8.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,_toConsumableArray(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,_iterator2=_createForOfIteratorHelper(this.state.activeProfile.kernels),_context8.prev=11,_iterator2.s();case 13:if((_step2=_iterator2.n()).done){_context8.next=23;break}return _e19=_step2.value,_context8.next=17,_e19.kernelTimeMs;case 17:return _e19.kernelTimeMs=_context8.sent,_context8.next=20,_e19.extraInfo;case 20:_e19.extraInfo=_context8.sent;case 21:_context8.next=13;break;case 23:_context8.next=28;break;case 25:_context8.prev=25,_context8.t0=_context8.catch(11),_iterator2.e(_context8.t0);case 28:return _context8.prev=28,_iterator2.f(),_context8.finish(28);case 31:return _context8.abrupt("return",this.state.activeProfile);case 32:case"end":return _context8.stop()}}),_callee8,this,[[11,25,28,31]])}))),function profile(_x4){return _profile.apply(this,arguments)})},{key:"isTapeOn",value:function isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function addTapeNode(e,t,n,r,a,o){var _this13=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},i=en(e);null!=i&&(r=i.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var _e20=n[t],_r16=Lt(_e20.size,_e20.dtype);return _this13.makeTensor(_r16,_e20.shape,_e20.dtype)}return e})),r(e.length>1?e:e[0],a,o)}),this.state.activeTape.push(s)}},{key:"keep",value:function keep(e){return e.kept=!0,e}},{key:"startTape",value:function startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function endTape(){this.state.gradientDepth--}},{key:"startScope",value:function startScope(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function endScope(e){for(var _this14=this,t=An(e),n=new Set(t.map((function(e){return e.id}))),_e21=0;_e21<this.state.activeScope.track.length;_e21++){var _t30=this.state.activeScope.track[_e21];_t30.kept||n.has(_t30.id)||_t30.dispose()}var r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach((function(e){e.kept||e.scopeId!==r.id||_this14.track(e)}))}},{key:"gradients",value:function gradients(e,t,n){var _this15=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(pt(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var a=this.scopedRun((function(){return _this15.startTape()}),(function(){return _this15.endTape()}),(function(){return _this15.tidy("forward",e)}));pt(a instanceof kn,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},_e22=0;_e22<t.length;_e22++)r[t[_e22].id]=!0;for(var _n16=0;_n16<e.length;_n16++){var _o10=e[_n16],_s5=_o10.inputs;for(var _e23 in _s5){for(var _n17=_s5[_e23],_i4=!1,_e24=0;_e24<t.length;_e24++)if(r[_n17.id]){_o10.outputs.forEach((function(e){return r[e.id]=!0})),_i4=!0,a[_o10.id]=!0;break}if(_i4)break}}var o={};o[n.id]=!0;for(var s={},_t31=e.length-1;_t31>=0;_t31--)for(var _n18=e[_t31],_r17=_n18.inputs,_e25=0;_e25<_n18.outputs.length;_e25++)if(o[_n18.outputs[_e25].id]){for(var _e26 in _r17)o[_r17[_e26].id]=!0,s[_n18.id]=!0;break}for(var i=[],_t32=0;_t32<e.length;_t32++){var _n19=e[_t32];if(a[_n19.id]&&s[_n19.id]){var _e27={};for(var _t34 in _n19.inputs){var _a11=_n19.inputs[_t34];r[_a11.id]&&(_e27[_t34]=_a11)}var _t33=Object.assign({},_n19);_t33.inputs=_e27,_t33.outputs=_n19.outputs,i.push(_t33)}}return i}(this.state.activeTape,t,a);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[a.id]=null==n?function(e){var t=Pt(gt(e),"float32");return Ln.makeTensor(t,e,"float32")}(a.shape):n,function(e,t,n,r){for(var _loop2=function _loop2(_a12){var o=t[_a12],s=[];if(o.outputs.forEach((function(t){var n=e[t.id];null!=n?s.push(n):s.push(null)})),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(o.kernelName,"."));var i=o.gradient(s),_loop3=function _loop3(_t35){if(!(_t35 in i))throw new Error("Cannot backprop through input ".concat(_t35,". Available gradients found: ").concat(Object.keys(i),"."));var a=function(e){return _this15.tidy(e)}((function(){return i[_t35]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(o.kernelName,". The gradient of input ").concat(_t35," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var s=o.inputs[_t35];if(!bt(a.shape,s.shape))throw new Error("Error in gradient for op ".concat(o.kernelName,". The gradient of input '").concat(_t35,"' has shape '").concat(a.shape,"', which does not match the shape of the input '").concat(s.shape,"'"));if(null==e[s.id])e[s.id]=a;else{var _t36=e[s.id];e[s.id]=r(_t36,a),_t36.dispose()}};for(var _t35 in o.inputs)_loop3(_t35)},_a12=t.length-1;_a12>=0;_a12--)_loop2(_a12)}(e,o,0,Bn);var r=t.map((function(t){return e[t.id]}));return 0===_this15.state.gradientDepth&&(_this15.state.activeTape.forEach((function(e){var _step3,_iterator3=_createForOfIteratorHelper(e.saved);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){_step3.value.dispose()}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}})),_this15.state.activeTape=null),{value:a,grads:r}}))}},{key:"customGrad",value:function customGrad(e){var _this16=this;return pt(At(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var _len4=arguments.length,t=new Array(_len4),_key4=0;_key4<_len4;_key4++)t[_key4]=arguments[_key4];var n;pt(t.every((function(e){return e instanceof kn})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var r={};return t.forEach((function(e,t){r[t]=e})),_this16.runKernelFunc({forwardFunc:function forwardFunc(r,a){return pt((n=e.apply(void 0,t.concat([a]))).value instanceof kn,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),pt(At(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value},backwardsFunc:function backwardsFunc(e,r){var a=n.gradFunc(e,r),o=Array.isArray(a)?a:[a];pt(o.length===t.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),pt(o.every((function(e){return e instanceof kn})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var s={};return o.forEach((function(e,t){s[t]=function(){return e}})),s},inputs:r})}}},{key:"readSync",value:function readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function read(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"time",value:(_time=_asyncToGenerator(regeneratorRuntime.mark((function _callee9(e){var t,n;return regeneratorRuntime.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return t=sn(),_context9.next=3,this.backend.time(e);case 3:return n=_context9.sent,_context9.abrupt("return",(n.wallMs=sn()-t,n));case 5:case"end":return _context9.stop()}}),_callee9,this)}))),function time(_x5){return _time.apply(this,arguments)})},{key:"track",value:function track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"reset",value:function reset(){for(var _e28 in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Mn,this.registry)this.disposeRegisteredKernels(_e28),this.registry[_e28].dispose(),delete this.registry[_e28];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}},{key:"backend",get:function get(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var _this$initializeBacke4=this.initializeBackendsAndReturnBest(),_e29=_this$initializeBacke4.name;if(_this$initializeBacke4.asyncInit)throw new Error("The highest priority backend '".concat(_e29,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(_e29)}return this.backendInstance}},{key:"registeredVariables",get:function get(){return this.state.registeredVariables}}]),Dn}();function Pn(){var t,e=Kt();if(null==e._tfengine){var _t39=new Ht(e);e._tfengine=new Dn(_t39)}return t=e._tfengine.ENV,qt=t,xn=function xn(){return e._tfengine},e._tfengine}Dn.nextTensorId=0,Dn.nextVariableId=0;var Ln=Pn();function Bn(e,t){var n={a:e,b:t};return Ln.runKernel(Yt,n)}function zn(){if("undefined"!=typeof navigator&&null!=navigator){var _e30=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(_e30)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(_e30.substr(0,4))}return!1}function Wn(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Vn=jt();function Un(e,t){var n=e;if(St(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||St(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&jt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function Hn(e,t,n){if(n=n||[],!Array.isArray(e)&&!St(e))return void pt(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(t[0]," elements")}));pt(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, but is an array of ").concat(e.length," elements")})),pt(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," elements, but has ").concat(e.length," elements")}));for(var r=t.slice(1),_t40=0;_t40<e.length;++_t40)Hn(e[_t40],r,n.concat(_t40))}(e,r,[]),r}function jn(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function Gn(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof kn)return jn(r,e.dtype,t,n),e;var a=Rt(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),jn(r,a,t,n),null==e||!St(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var _r18=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(_r18,"'"))}var o=Un(e,a);St(e)||Array.isArray(e)||(e=[e]);var s="string"!==a?on(e,a):mt(e,[],!0);return Ln.makeTensor(s,o,a)}function qn(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,a){return Gn(e,"".concat(t,"[").concat(a,"]"),n,r)}))}function Kn(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function a(){Ln.startScope(n);try{var _t41=r.apply(void 0,arguments);return Ut(_t41)&&console.error("Cannot return a Promise inside of tidy."),Ln.endScope(_t41),_t41}catch(e){throw Ln.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}Vn.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Vn.registerFlag("IS_BROWSER",(function(){return Wn()})),Vn.registerFlag("IS_NODE",(function(){return void 0!==process&&void 0!==process.versions&&void 0!==process.versions.node})),Vn.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Vn.registerFlag("PROD",(function(){return!1})),Vn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Vn.getBool("DEBUG")})),Vn.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Vn.registerFlag("IS_TEST",(function(){return!1})),Vn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),Vn.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1}));var Xn=Kn({complex_:function complex_(e,t){var n=Gn(e,"real","complex"),r=Gn(t,"imag","complex");ft(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex()."));var a={real:n,imag:r};return Ln.runKernel("Complex",a)}});function Yn(e,t,n,r){if(null==r&&(r=Rt(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!St(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){zt(t);var _e31=gt(t),_r19=gt(n);pt(_e31===_r19,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(_e31," values but has ").concat(_r19)}));for(var _e32=0;_e32<n.length;++_e32){var _r20=n[_e32],_a13=_e32!==n.length-1||_r20!==gt(t.slice(_e32));pt(n[_e32]===t[_e32]||!_a13,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return St(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?on(e,r):mt(e,[],!0),Ln.makeTensor(e,t,r)}function Qn(e,t,n){return Yn(e,t,Un(e,n),n)}var Zn={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Jn=void 0!==Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function er(e){return Jn?Buffer.byteLength(e):new Blob([e]).size}function tr(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function nr(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:er(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:er(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function rr(){var e=function(){var e=function e(_e33){for(var t=_e33<<13,n=0;0==(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|(n+=947912704)},t=new Uint32Array(2048);t[0]=0;for(var _n20=1;_n20<1024;_n20++)t[_n20]=e(_n20);for(var _e34=1024;_e34<2048;_e34++)t[_e34]=939524096+(_e34-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var _t42=1;_t42<31;_t42++)e[_t42]=_t42<<23;for(var _t43=33;_t43<63;_t43++)e[_t43]=2147483648+(_t43-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),_t44=0;_t44<64;_t44++)e[_t44]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),o=new Uint32Array(a),_a14=0;_a14<r.length;_a14++){var _s6=r[_a14],_i5=e[n[_s6>>10]+(1023&_s6)]+t[_s6>>10];o[_a14]=_i5}return new Float32Array(a)}}var ar=function(){function ar(){_classCallCheck(this,ar),this.saveRouters=[],this.loadRouters=[]}return _createClass(ar,null,[{key:"getInstance",value:function getInstance(){return null==ar.instance&&(ar.instance=new ar),ar.instance}},{key:"registerSaveRouter",value:function registerSaveRouter(e){ar.getInstance().saveRouters.push(e)}},{key:"registerLoadRouter",value:function registerLoadRouter(e){ar.getInstance().loadRouters.push(e)}},{key:"getSaveHandlers",value:function getSaveHandlers(e){return ar.getHandlers(e,"save")}},{key:"getLoadHandlers",value:function getLoadHandlers(e,t){return ar.getHandlers(e,"load",t)}},{key:"getHandlers",value:function getHandlers(e,t,n){var r=[];return("load"===t?ar.getInstance().loadRouters:ar.getInstance().saveRouters).forEach((function(t){var a=t(e,n);null!==a&&r.push(a)})),r}}]),ar}();function or(){if(!jt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function sr(e){var t=e.result;t.createObjectStore("models_store",{keyPath:"modelPath"}),t.createObjectStore("model_info_store",{keyPath:"modelPath"})}var ir=function(){function ir(e){if(_classCallCheck(this,ir),this.indexedDB=or(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}var _load,_save;return _createClass(ir,[{key:"save",value:(_save=_asyncToGenerator(regeneratorRuntime.mark((function _callee10(e){return regeneratorRuntime.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(!(e.modelTopology instanceof ArrayBuffer)){_context10.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return _context10.abrupt("return",this.databaseAction(this.modelPath,e));case 3:case"end":return _context10.stop()}}),_callee10,this)}))),function save(_x6){return _save.apply(this,arguments)})},{key:"load",value:(_load=_asyncToGenerator(regeneratorRuntime.mark((function _callee11(){return regeneratorRuntime.wrap((function _callee11$(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return _context11.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return _context11.stop()}}),_callee11,this)}))),function load(){return _load.apply(this,arguments)})},{key:"databaseAction",value:function databaseAction(e,t){var _this17=this;return new Promise((function(e,n){var r=_this17.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return sr(r)},r.onsuccess=function(){var a=r.result;if(null==t){var _t45=a.transaction("models_store","readonly"),_r21=_t45.objectStore("models_store").get(_this17.modelPath);_r21.onsuccess=function(){if(null==_r21.result)return a.close(),n(new Error("Cannot find model with path '".concat(_this17.modelPath,"' in IndexedDB.")));e(_r21.result.modelArtifacts)},_r21.onerror=function(e){return a.close(),n(_r21.error)},_t45.oncomplete=function(){return a.close()}}else{var _u3,_r22=nr(t),_o11=a.transaction("model_info_store","readwrite"),_s7=_o11.objectStore("model_info_store"),_i6=_s7.put({modelPath:_this17.modelPath,modelArtifactsInfo:_r22});_i6.onsuccess=function(){var i=(_u3=a.transaction("models_store","readwrite")).objectStore("models_store").put({modelPath:_this17.modelPath,modelArtifacts:t,modelArtifactsInfo:_r22});i.onsuccess=function(){return e({modelArtifactsInfo:_r22})},i.onerror=function(e){var t=(_s7=_o11.objectStore("model_info_store")).delete(_this17.modelPath);t.onsuccess=function(){return a.close(),n(i.error)},t.onerror=function(e){return a.close(),n(i.error)}}},_i6.onerror=function(e){return a.close(),n(_i6.error)},_o11.oncomplete=function(){null==_u3?a.close():_u3.oncomplete=function(){return a.close()}}}},r.onerror=function(e){return n(r.error)}}))}}]),ir}();ir.URL_SCHEME="indexeddb://";var ur=function ur(e){return jt().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ir.URL_SCHEME)?(t=e.slice(ir.URL_SCHEME.length),new ir(t)):null;var t};ar.registerSaveRouter(ur),ar.registerLoadRouter(ur);var lr=function(){function lr(){_classCallCheck(this,lr),this.indexedDB=or()}var _removeModel,_listModels;return _createClass(lr,[{key:"listModels",value:(_listModels=_asyncToGenerator(regeneratorRuntime.mark((function _callee12(){var _this18=this;return regeneratorRuntime.wrap((function _callee12$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return _context12.abrupt("return",new Promise((function(e,t){var n=_this18.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=function(){return sr(n)},n.onsuccess=function(){var r=n.result,a=r.transaction("model_info_store","readonly"),o=a.objectStore("model_info_store").getAll();o.onsuccess=function(){var _step4,t={},_iterator4=_createForOfIteratorHelper(o.result);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _e35=_step4.value;t[_e35.modelPath]=_e35.modelArtifactsInfo}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}e(t)},o.onerror=function(e){return r.close(),t(o.error)},a.oncomplete=function(){return r.close()}},n.onerror=function(e){return t(n.error)}})));case 1:case"end":return _context12.stop()}}),_callee12)}))),function listModels(){return _listModels.apply(this,arguments)})},{key:"removeModel",value:(_removeModel=_asyncToGenerator(regeneratorRuntime.mark((function _callee13(e){var t,_this19=this;return regeneratorRuntime.wrap((function _callee13$(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return _context13.abrupt("return",(e=(t=e).startsWith(ir.URL_SCHEME)?t.slice(ir.URL_SCHEME.length):t,new Promise((function(t,n){var r=_this19.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return sr(r)},r.onsuccess=function(){var u,a=r.result,o=a.transaction("model_info_store","readwrite"),s=o.objectStore("model_info_store"),i=s.get(e);i.onsuccess=function(){if(null==i.result)return a.close(),n(new Error("Cannot find model with path '".concat(e,"' in IndexedDB.")));var _r23=s.delete(e),_o12=function _o12(){var r=(u=a.transaction("models_store","readwrite")).objectStore("models_store").delete(e);r.onsuccess=function(){return t(i.result.modelArtifactsInfo)},r.onerror=function(e){return n(i.error)}};_r23.onsuccess=_o12,_r23.onerror=function(e){return _o12(),a.close(),n(i.error)}},i.onerror=function(e){return a.close(),n(i.error)},o.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}},r.onerror=function(e){return n(r.error)}}))));case 1:case"end":return _context13.stop()}}),_callee13)}))),function removeModel(_x7){return _removeModel.apply(this,arguments)})}]),lr}(),cr="tensorflowjs_models",dr="info",pr="model_topology",fr="weight_specs",hr="weight_data",mr="model_metadata";function gr(e){return{info:[cr,e,dr].join("/"),topology:[cr,e,pr].join("/"),weightSpecs:[cr,e,fr].join("/"),weightData:[cr,e,hr].join("/"),modelMetadata:[cr,e,mr].join("/")}}function br(e){var t=e.split("/");if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join("/")}var yr=function(){function yr(e){if(_classCallCheck(this,yr),!jt().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=gr(this.modelPath)}var _load2,_save2;return _createClass(yr,[{key:"save",value:(_save2=_asyncToGenerator(regeneratorRuntime.mark((function _callee14(e){var t,_n21,_r24,_a15;return regeneratorRuntime.wrap((function _callee14$(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(!(e.modelTopology instanceof ArrayBuffer)){_context14.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return t=JSON.stringify(e.modelTopology),_n21=JSON.stringify(e.weightSpecs),_r24=nr(e),_context14.prev=3,this.LS.setItem(this.keys.info,JSON.stringify(_r24)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,_n21),this.LS.setItem(this.keys.weightData,function(e){if(Jn)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",_e36=0,_r25=t.length;_e36<_r25;_e36++)n+=String.fromCharCode(t[_e36]);return btoa(n)}(e.weightData)),_a15={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy},_context14.abrupt("return",(null!=e.signature&&(_a15.signature=e.signature),null!=e.userDefinedMetadata&&(_a15.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(_a15.modelInitializer=e.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(_a15)),{modelArtifactsInfo:_r24}));case 9:throw _context14.prev=9,_context14.t0=_context14.catch(3),this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(_r24.modelTopologyBytes,", weightSpecsBytes=").concat(_r24.weightSpecsBytes,", weightDataBytes=").concat(_r24.weightDataBytes,"."));case 12:case"end":return _context14.stop()}}),_callee14,this,[[3,9]])}))),function save(_x8){return _save2.apply(this,arguments)})},{key:"load",value:(_load2=_asyncToGenerator(regeneratorRuntime.mark((function _callee15(){var e,t,n,r,a,_e37,o;return regeneratorRuntime.wrap((function _callee15$(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:if(null!=(e=JSON.parse(this.LS.getItem(this.keys.info)))){_context15.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===e.modelTopologyType){_context15.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(t={},null!=(n=JSON.parse(this.LS.getItem(this.keys.topology)))){_context15.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(t.modelTopology=n,null!=(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){_context15.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(t.weightSpecs=r,null!=(a=this.LS.getItem(this.keys.modelMetadata))&&(_e37=JSON.parse(a),t.format=_e37.format,t.generatedBy=_e37.generatedBy,t.convertedBy=_e37.convertedBy,null!=_e37.signature&&(t.signature=_e37.signature),null!=_e37.userDefinedMetadata&&(t.userDefinedMetadata=_e37.userDefinedMetadata),null!=_e37.modelInitializer&&(t.modelInitializer=_e37.modelInitializer)),null!=(o=this.LS.getItem(this.keys.weightData))){_context15.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return _context15.abrupt("return",(t.weightData=function(e){if(Jn){var _t46=Buffer.from(e,"base64");return _t46.buffer.slice(_t46.byteOffset,_t46.byteOffset+_t46.byteLength)}for(var t=atob(e),n=new Uint8Array(t.length),_e38=0;_e38<t.length;++_e38)n.set([t.charCodeAt(_e38)],_e38);return n.buffer}(o),t));case 19:case"end":return _context15.stop()}}),_callee15,this)}))),function load(){return _load2.apply(this,arguments)})}]),yr}();yr.URL_SCHEME="localstorage://";var xr=function xr(e){return jt().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(yr.URL_SCHEME)?(t=e.slice(yr.URL_SCHEME.length),new yr(t)):null;var t};ar.registerSaveRouter(xr),ar.registerLoadRouter(xr);var vr=function(){function vr(){_classCallCheck(this,vr),pt(jt().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),pt("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}var _removeModel2,_listModels2;return _createClass(vr,[{key:"listModels",value:(_listModels2=_asyncToGenerator(regeneratorRuntime.mark((function _callee16(){var e,t,n,_r26,_a16;return regeneratorRuntime.wrap((function _callee16$(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:for(e={},t=cr+"/",n="/"+dr,_r26=0;_r26<this.LS.length;++_r26)(_a16=this.LS.key(_r26)).startsWith(t)&&_a16.endsWith(n)&&(e[br(_a16)]=JSON.parse(this.LS.getItem(_a16)));return _context16.abrupt("return",e);case 3:case"end":return _context16.stop()}}),_callee16,this)}))),function listModels(){return _listModels2.apply(this,arguments)})},{key:"removeModel",value:(_removeModel2=_asyncToGenerator(regeneratorRuntime.mark((function _callee17(e){var t,n,r;return regeneratorRuntime.wrap((function _callee17$(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(n=gr(e=(t=e).startsWith(yr.URL_SCHEME)?t.slice(yr.URL_SCHEME.length):t),null!=this.LS.getItem(n.info)){_context17.next=3;break}throw new Error("Cannot find model at path '".concat(e,"'"));case 3:return r=JSON.parse(this.LS.getItem(n.info)),_context17.abrupt("return",(this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),r));case 5:case"end":return _context17.stop()}}),_callee17,this)}))),function removeModel(_x9){return _removeModel2.apply(this,arguments)})}]),vr}(),kr=function(){function kr(){_classCallCheck(this,kr),this.managers={}}return _createClass(kr,null,[{key:"getInstance",value:function getInstance(){return null==kr.instance&&(kr.instance=new kr),kr.instance}},{key:"registerManager",value:function registerManager(e,t){pt(null!=e,(function(){return"scheme must not be undefined or null."})),e.endsWith("://")&&(e=e.slice(0,e.indexOf("://"))),pt(e.length>0,(function(){return"scheme must not be an empty string."}));var n=kr.getInstance();pt(null==n.managers[e],(function(){return"A model store manager is already registered for scheme '".concat(e,"'.")})),n.managers[e]=t}},{key:"getManager",value:function getManager(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function getSchemes(){return Object.keys(this.getInstance().managers)}}]),kr}(),wr=function(){function wr(){_classCallCheck(this,wr)}return _createClass(wr,[{key:"fetch",value:function(_fetch){function fetch(_x10,_x11){return _fetch.apply(this,arguments)}return fetch.toString=function(){return _fetch.toString()},fetch}((function(e,t){return fetch(e,t)}))},{key:"now",value:function now(){return performance.now()}},{key:"encode",value:function encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function decode(e,t){return new TextDecoder(t).decode(e)}}]),wr}();if(jt().get("IS_BROWSER")){jt().setPlatform("browser",new wr);try{kr.registerManager(yr.URL_SCHEME,new vr)}catch(e){}try{kr.registerManager(ir.URL_SCHEME,new lr)}catch(e){}}var Nr,Tr=function(){function Tr(){_classCallCheck(this,Tr),this.util=__webpack_require__(530),this.textEncoder=new this.util.TextEncoder}return _createClass(Tr,[{key:"fetch",value:function fetch(e,t){return null!=jt().global.fetch?jt().global.fetch(e,t):(null==Nr&&(Nr=function Ir(){return __webpack_require__(793)}()),Nr(e,t))}},{key:"now",value:function now(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),Tr}();function Cr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",zt(e),new yn(e,t,n)}jt().get("IS_NODE")&&jt().setPlatform("node",new Tr);var Er=Kn({cast_:function cast_(e,t){var n=Gn(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return Ln.runKernel("Cast",r,a)}}),Sr=Kn({clone_:function clone_(e){var t={x:Gn(e,"x","clone","string_or_numeric")};return Ln.runKernel("Identity",t)}});function _r(e,t,n,r){!function(e){pt(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){pt(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction ".concat(e)})),pt(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction ".concat(t)})),pt(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ").concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(o){return o.then((function(o){var s=n+ ++a/e.length*(r-n);return t(s),o})),o})))}Pn(),vn={buffer:Cr,cast:Er,clone:Sr,print:function print(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};var $r=function(){function $r(e,t){if(_classCallCheck(this,$r),this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(pt("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=jt().platform.fetch,pt(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&pt(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(e.length,").")})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}var _loadWeights,_load3,_save3;return _createClass($r,[{key:"save",value:(_save3=_asyncToGenerator(regeneratorRuntime.mark((function _callee18(e){var t,n,r,a;return regeneratorRuntime.wrap((function _callee18$(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:if(!(e.modelTopology instanceof ArrayBuffer)){_context18.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),_context18.next=8,this.fetch(this.path,t);case 8:if(!(a=_context18.sent).ok){_context18.next=11;break}return _context18.abrupt("return",{modelArtifactsInfo:nr(e),responses:[a]});case 11:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status ".concat(a.status,"."));case 12:case"end":return _context18.stop()}}),_callee18,this)}))),function save(_x12){return _save3.apply(this,arguments)})},{key:"load",value:(_load3=_asyncToGenerator(regeneratorRuntime.mark((function _callee19(){var e,t,_t47,n,r,a,o,s,i,u,l,c,_e39,_e40,d,p;return regeneratorRuntime.wrap((function _callee19$(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return _context19.next=2,this.fetch(this.path,this.requestInit);case 2:if((e=_context19.sent).ok){_context19.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ").concat(e.status,". Please verify this URL points to the model JSON of the model to load."));case 5:return _context19.prev=5,_context19.next=8,e.json();case 8:t=_context19.sent,_context19.next=15;break;case 11:throw _context19.prev=11,_context19.t0=_context19.catch(5),_t47="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?_t47+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":_t47+=" Please make sure the server is serving valid JSON for this request.",new Error(_t47);case 15:if(n=t.modelTopology,r=t.weightsManifest,a=t.generatedBy,o=t.convertedBy,s=t.format,i=t.signature,u=t.userDefinedMetadata,null!=n||null!=r){_context19.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:if(null==r){_context19.next=25;break}return _context19.next=21,this.loadWeights(r);case 21:_e39=_context19.sent,_e40=_slicedToArray(_e39,2),l=_e40[0],c=_e40[1];case 25:return d={modelTopology:n,weightSpecs:l,weightData:c,generatedBy:a,convertedBy:o,format:s},null!=i&&(d.signature=i),null!=u&&(d.userDefinedMetadata=u),p=t.modelInitializer,_context19.abrupt("return",(p&&(d.modelInitializer=p),d));case 29:case"end":return _context19.stop()}}),_callee19,this,[[5,11]])}))),function load(){return _load3.apply(this,arguments)})},{key:"loadWeights",value:(_loadWeights=_asyncToGenerator(regeneratorRuntime.mark((function _callee21(e){var t,_ref,_ref2,n,r,a,o,_iterator5,_step5,_t48,s,i,_iterator6,_step6,_t49,_iterator7,_step7,_e41;return regeneratorRuntime.wrap((function _callee21$(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,_ref=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),_ref2=_slicedToArray(_ref,2),n=_ref2[0],r=_ref2[1],a=this.weightPathPrefix||n,o=[],_iterator5=_createForOfIteratorHelper(e);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;)_t48=_step5.value,o.push.apply(o,_toConsumableArray(_t48.weights))}catch(err){_iterator5.e(err)}finally{_iterator5.f()}s=[],i=[],_iterator6=_createForOfIteratorHelper(e);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){_t49=_step6.value,_iterator7=_createForOfIteratorHelper(_t49.paths);try{for(_iterator7.s();!(_step7=_iterator7.n()).done;)_e41=_step7.value,null!=this.weightUrlConverter?i.push(this.weightUrlConverter(_e41)):s.push(a+_e41+r)}catch(err){_iterator7.e(err)}finally{_iterator7.f()}}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}if(_context21.t0=this.weightUrlConverter,!_context21.t0){_context21.next=16;break}return _context21.t1=s.push,_context21.t2=s,_context21.t3=_toConsumableArray,_context21.next=13,Promise.all(i);case 13:_context21.t4=_context21.sent,_context21.t5=(0,_context21.t3)(_context21.t4),_context21.t1.apply.call(_context21.t1,_context21.t2,_context21.t5);case 16:return _context21.t6=o,_context21.t7=tr,_context21.next=20,function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee20(e,t){var n,r,a;return regeneratorRuntime.wrap((function _callee20$(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:if(null==t&&(t={}),n=null==t.fetchFunc?jt().platform.fetch:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),null!=t.onProgress){_context20.next=9;break}return _context20.next=6,Promise.all(r);case 6:_context20.t0=_context20.sent,_context20.next=12;break;case 9:return _context20.next=11,_r(r,t.onProgress,0,.5);case 11:_context20.t0=_context20.sent;case 12:if(a=_context20.t0.map((function(e){return e.arrayBuffer()})),null!=t.onProgress){_context20.next=19;break}return _context20.next=16,Promise.all(a);case 16:_context20.t1=_context20.sent,_context20.next=22;break;case 19:return _context20.next=21,_r(a,t.onProgress,.5,1);case 21:_context20.t1=_context20.sent;case 22:return _context20.abrupt("return",_context20.t1);case 23:case"end":return _context20.stop()}}),_callee20)})));return function(_x14,_x15){return _ref3.apply(this,arguments)}}()(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 20:return _context21.t8=_context21.sent,_context21.t9=(0,_context21.t7)(_context21.t8),_context21.abrupt("return",[_context21.t6,_context21.t9]);case 23:case"end":return _context21.stop()}}),_callee21,this)}))),function loadWeights(_x13){return _loadWeights.apply(this,arguments)})}]),$r}();function Rr(e){return null!=e.match($r.URL_SCHEME_REGEX)}$r.URL_SCHEME_REGEX=/^https?:\/\//;var Ar=function Ar(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return Rr(e)})):Rr(e))?Fr(e,t):null};function Fr(e,t){return new $r(e,t)}function Or(e,t){return Fr(e,t)}ar.registerSaveRouter(Ar),ar.registerLoadRouter(Ar);var Lr,Mr=Kn({matMul_:function matMul_(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gn(e,"a","matMul"),o=Gn(t,"b","matMul"),_Rn=Rn(a,o),_Rn2=_slicedToArray(_Rn,2),s={a:a=_Rn2[0],b:o=_Rn2[1]},i={transposeA:n,transposeB:r};return Ln.runKernel("BatchMatMul",s,i)}}),Dr=Kn({oneHot_:function oneHot_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var a={indices:Gn(e,"indices","oneHot","int32")},o={depth:t,onValue:n,offValue:r};return Ln.runKernel("OneHot",a,o)}}),Pr=Kn({transpose_:function transpose_(e,t){var n=Gn(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),pt(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of perm ").concat(t,".")})),t.forEach((function(e){pt(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got ".concat(t)}))})),n.rank<=1)return n.clone();var r={x:n},a={perm:t};return Ln.runKernel("Transpose",r,a)}}),Br=Kn({fromPixels_:function fromPixels_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,o=!1,s=!1,i=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)o=!0;else if(null!=e.getContext)s=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ".concat(e.constructor.name));i=!0}if(a){var _t50=2;if(a&&e.readyState<_t50)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=Jt("FromPixels",Ln.backendName)){var _n23={pixels:e},_r27={numChannels:t};return Ln.runKernel("FromPixels",_n23,_r27)}var c,d,_ref4=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],_ref5=_slicedToArray(_ref4,2),u=_ref5[0],l=_ref5[1];if(s?c=e.getContext("2d").getImageData(0,0,u,l).data:r||n?c=e.data:(o||a||i)&&(null==Lr&&(Lr=document.createElement("canvas").getContext("2d")),Lr.canvas.width=u,Lr.canvas.height=l,Lr.drawImage(e,0,0,u,l),c=Lr.getImageData(0,0,u,l).data),4===t)d=new Int32Array(c);else{var _e42=u*l;d=new Int32Array(_e42*t);for(var _n24=0;_n24<_e42;_n24++)for(var _e43=0;_e43<t;++_e43)d[_n24*t+_e43]=c[4*_n24+_e43]}return function(e,t,n){if(ht(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Un(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Yn(e,t,r,n)}(d,[l,u,t],"int32")}});function zr(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===gt(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,o=a[a.length-1],s=1,_e44=0;_e44<a.length-1;++_e44)s*=a[_e44];var i=e.shape,u=a.slice();u.pop();for(var l=1,_e45=o;_e45<n;++_e45)l*=i[_e45],u.push(i[_e45]);var c=[].concat(_toConsumableArray(Ot(e.shape).map((function(e){return e/l}))),[1]).slice(0,o);return[u,s,l,c]}function Wr(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(o+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(o+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(o+" update.rank != "+(a+e.length-r));for(var _e46=0;_e46<a;++_e46)if(n.shape[_e46]!==t.shape[_e46])throw new Error(o+" updates.shape[".concat(_e46,"] (").concat(n.shape[_e46],") != indices.shape[").concat(_e46,"] (").concat(t.shape[_e46],")."));for(var _t51=0;_t51<n.rank-a;++_t51)if(n.shape[_t51+a]!==e[_t51+r])throw new Error(o+" updates.shape[".concat(_t51+a,"] (").concat(n.shape[_t51+a],") != shape[").concat(_t51+a,"] (").concat(e[_t51+a],")"))}function Vr(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}Wr(n,t,e)}function Ur(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,o=n.length,s=1,_e47=a;_e47<o;++_e47)s*=n[_e47];var i=a<1?1:a;return{sliceRank:a,numUpdates:gt(t.shape)/i,sliceSize:s,strides:[].concat(_toConsumableArray(Ot(n.slice(0,a))),[1]),outputSize:gt(n)}}function Hr(e,t,n){var r=e.shape.length;pt(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),pt(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var _loop4=function _loop4(_a17){pt(t[_a17]+n[_a17]<=e.shape[_a17],(function(){return"Error in slice".concat(r,"D: begin[").concat(_a17,"] + size[").concat(_a17,"] (").concat(t[_a17]+n[_a17],") would overflow input.shape[").concat(_a17,"] (").concat(e.shape[_a17],")")}))},_a17=0;_a17<r;++_a17)_loop4(_a17)}function jr(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Gr(e,t,n){for(var r=[],_a18=0;_a18<e.length;_a18++)r[_a18]=Math.ceil((t[_a18]-e[_a18])/n[_a18]);return r}function qr(e,t,n,r){for(var a=_toConsumableArray(e),_e48=a.length;_e48<r.length;_e48++)a.push(1);for(var _e49=0;_e49<n;_e49++)0===_e49?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Kr(e,t,n){return n<=e?n:n-(t-1)}function Xr(e,t){for(var n=[],_r28=0;_r28<e;_r28++)n.push(t+_r28);return n}function Yr(e,t,n,r,a,o,s,i,u){var l=e.length,c=new Array(l),d=new Array(l),p=new Array(l);if(t.length&&n>0){var _u4=t[0],_l2=n+1;c=Qr(s,_u4,_l2,r,e),d=Zr(i,_u4,_l2,a,e),p=qr(o,_u4,_l2,e)}else for(var _t52=0;_t52<l;_t52++)c[_t52]=ea(s,r,o,e,_t52,u),d[_t52]=ta(i,a,o,e,_t52,u),p[_t52]=Jr(o,_t52,u);return{begin:c,end:d,strides:p}}function Qr(e,t,n,r,a){for(var o=_toConsumableArray(a),s=Xr(n,t),_a19=0;_a19<o.length;_a19++)if(s.indexOf(_a19)>-1)o[_a19]=0;else{var _s8=Kr(t,n,_a19),_i7=r[_s8];e&1<<_s8&&(_i7=0),o[_a19]=_i7}return o}function Zr(e,t,n,r,a){for(var o=_toConsumableArray(a),s=Xr(n,t),_a20=0;_a20<o.length;_a20++)if(s.indexOf(_a20)>-1)o[_a20]=Number.MAX_SAFE_INTEGER;else{var _s9=Kr(t,n,_a20),_i8=r[_s9];e&1<<_s9&&(_i8=Number.MAX_SAFE_INTEGER),o[_a20]=_i8}for(var _e50=0;_e50<o.length;_e50++){var _t53=a[_e50];o[_e50]<0&&(o[_e50]+=_t53),o[_e50]=ct(0,o[_e50],a[_e50])}return o}function Jr(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function ea(e,t,n,r,a,o){var s=t[a],i=n[a]||1;(e&1<<a||o&1<<a||null==s)&&(s=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return s<0&&(s+=u),s=ct(0,s,u-1)}function ta(e,t,n,r,a,o){var s=t[a],i=n[a]||1;(e&1<<a||o&1<<a||null==s)&&(s=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return s<0&&(s+=u),s=i>0?ct(0,s,u):ct(-1,s,u-1)}function na(e,t,n){for(var r=n.length,_e51=0;_e51<n.length;_e51++)if(n[_e51]>1){r=_e51;break}for(var _a21=r+1;_a21<n.length;_a21++)if(t[_a21]>0||n[_a21]!==e[_a21])return!1;return!0}function ra(e,t){for(var n=e.length>0?e[e.length-1]:1,_r29=0;_r29<e.length-1;_r29++)n+=e[_r29]*t[_r29];return n}function aa(e,t,n){var r,o,a=e.shape.length;return(r="number"==typeof t?[t].concat(_toConsumableArray(new Array(a-1).fill(0))):t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice()).forEach((function(e){pt(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=null==n?new Array(a).fill(-1):"number"==typeof n?[n].concat(_toConsumableArray(new Array(a-1).fill(-1))):n.length<a?n.concat(new Array(a-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(pt(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,o]}function oa(e,t,n,r,a,o,s,i,u){var l=t.slice(),c=n.slice(),d=r;null==r&&(d=new Array(l.length));var p=jr(s);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==s&&0!==i)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==s&&0!==u)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var f=e.length-l.length,h=jr(i),m=e.slice();h.forEach((function(e){l[e]=0,c[e]=1,m.splice(e,0,1)}));var _Yr=Yr(m,p,f,l,c,d,a,o,s),g=_Yr.begin,b=_Yr.end,y=_Yr.strides;l=g,c=b,d=y;var x=jr(u);x.forEach((function(e){c[e]=l[e]+1,d[e]=1}));var v=Gr(l,c,d),k=v.filter((function(e,t){return-1===x.indexOf(t)}));return{nonStrided:d.every((function(e){return 1===e})),$begin:l,$end:c,$strides:d,size:v,newShape:m,outShape:k}}var sa=Object.freeze({__proto__:null,assertParamsValid:Hr,maskToAxes:jr,computeOutShape:Gr,stridesWithElidedDims:qr,getNormalizedAxes:Yr,startIndicesWithElidedDims:Qr,stopIndicesWithElidedDims:Zr,stridesForAxis:Jr,startForAxis:ea,stopForAxis:ta,isSliceContinous:na,computeFlatOffset:ra,parseSliceParams:aa,sliceInfo:oa});function ia(){return Ln}function ua(e,t){return Ln.tidy(e,t)}function la(e){return Ln.keep(e)}function ca(e){return Ln.setBackend(e)}function da(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Ln.registerBackend(e,t,n)}var pa=Kn({add_:function add_(e,t){var n=Gn(e,"a","add"),r=Gn(t,"b","add"),_Rn4=_slicedToArray(Rn(n,r),2),a={a:n=_Rn4[0],b:r=_Rn4[1]};return Ln.runKernel(Yt,a)}}),fa=Kn({floorDiv_:function floorDiv_(e,t){var n=Gn(e,"a","floorDiv"),r=Gn(t,"b","floorDiv"),_Rn6=_slicedToArray(Rn(n,r),2),a={a:n=_Rn6[0],b:r=_Rn6[1]};return Ln.runKernel("FloorDiv",a)}}),ha=Kn({div_:function div_(e,t){var _Rn8,n=Gn(e,"a","div"),r=Gn(t,"b","div");if(n=(_Rn8=_slicedToArray(Rn(n,r),2))[0],r=_Rn8[1],"int32"===n.dtype&&"int32"===r.dtype)return fa(n,r);var a={a:n,b:r};return Ln.runKernel("RealDiv",a,{})}}),ma=Kn({mul_:function mul_(e,t){var n=Gn(e,"a","mul"),r=Gn(t,"b","mul"),_Rn10=_slicedToArray(Rn(n,r),2),a={a:n=_Rn10[0],b:r=_Rn10[1]};return Ln.runKernel("Multiply",a)}}),ga=Kn({abs_:function abs_(e){var t=Gn(e,"x","abs");if("complex64"===t.dtype){var _e52={x:t};return Ln.runKernel("ComplexAbs",_e52)}var _e53={x:t};return Ln.runKernel("Abs",_e53)}}),ba=Kn({acos_:function acos_(e){var t={x:Gn(e,"x","acos")};return Ln.runKernel("Acos",t)}}),ya=Kn({acosh_:function acosh_(e){var t={x:Gn(e,"x","acosh")};return Ln.runKernel("Acosh",t)}}),xa=Kn({addN_:function addN_(e){pt(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),pt(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got ".concat(e.length)}));var t=e.map((function(e,t){return Gn(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!bt(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return Ln.runKernel("AddN",r)}}),va=Kn({all_:function all_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Gn(e,"x","all","bool")},a={axis:t,keepDims:n};return Ln.runKernel("All",r,a)}}),ka=Kn({any_:function any_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Gn(e,"x","any","bool")},a={axis:t,keepDims:n};return Ln.runKernel("Any",r,a)}}),wa=Kn({argMax_:function argMax_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:Gn(e,"x","argMax")},r={axis:t};return Ln.runKernel("ArgMax",n,r)}}),Ia=Kn({argMin_:function argMin_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:Gn(e,"x","argMin")},r={axis:t};return Ln.runKernel("ArgMin",n,r)}}),Na=Kn({asin_:function asin_(e){var t={x:Gn(e,"x","asin")};return Ln.runKernel("Asin",t)}}),Ta=Kn({asinh_:function asinh_(e){var t={x:Gn(e,"x","asinh")};return Ln.runKernel("Asinh",t)}}),Ca=Kn({atan_:function atan_(e){var t={x:Gn(e,"x","atan")};return Ln.runKernel("Atan",t)}}),Ea=Kn({atan2_:function atan2_(e,t){var n=Gn(e,"a","atan2"),r=Gn(t,"b","atan2"),_Rn12=_slicedToArray(Rn(n,r),2),a={a:n=_Rn12[0],b:r=_Rn12[1]};return Ln.runKernel("Atan2",a)}}),Sa=Kn({atanh_:function atanh_(e){var t={x:Gn(e,"x","atanh")};return Ln.runKernel("Atanh",t)}});function _a(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",o=arguments.length>5?arguments[5]:void 0;return Aa(e,[].concat(_toConsumableArray(t),[e[3]]),n,o,r,null,null,Wa(a))}function $a(e,t,n,r,a,o){var l,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",_Ma=Ma(t),_Ma2=_slicedToArray(_Ma,2),i=_Ma2[0],u=_Ma2[1];if("channelsLast"===s)l=[i,u,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));l=[i,u,e[1],e[1]]}return Aa(e,l,n,r,a,o,!1,s)}function Ra(e,t,n,r,a,o){var c,d,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",_Da=Da(t),_Da2=_slicedToArray(_Da,3),i=_Da2[0],u=_Da2[1],l=_Da2[2];if("NDHWC"===s)d="channelsLast",c=[i,u,l,e[4],e[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat ".concat(s));d="channelsFirst",c=[i,u,l,e[1],e[1]]}return Fa(e,c,n,r,a,!1,d,o)}function Aa(e,t,n,r,a,o){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,l=-1,c=-1,d=-1;if("channelsLast"===i){var _e54=_slicedToArray(e,4);u=_e54[0],l=_e54[1],c=_e54[2],d=_e54[3]}else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat ".concat(i));var _e55=_slicedToArray(e,4);u=_e55[0],d=_e55[1],l=_e55[2],c=_e55[3]}var T,_t54=_slicedToArray(t,4),p=_t54[0],f=_t54[1],h=_t54[3],_Ma3=Ma(n),_Ma4=_slicedToArray(_Ma3,2),m=_Ma4[0],g=_Ma4[1],_Ma5=Ma(r),_Ma6=_slicedToArray(_Ma5,2),b=_Ma6[0],y=_Ma6[1],x=Pa(p,b),v=Pa(f,y),_ref6=function(e,t,n,r,a,o,s,i,u){var l,c,d;if("number"==typeof e){l={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var _a22=function(e,t,n,r,a){null==r&&(r=Oa(e,t,n));var s=e[1];return[La((e[0]-t+2*r)/n+1,a),La((s-t+2*r)/n+1,a)]}([t,n],o,r,e,i);c=_a22[0],d=_a22[1]}else if("same"===e){c=Math.ceil(t/r),d=Math.ceil(n/a);var _e56=Math.max(0,(c-1)*r+o-t),_i9=Math.max(0,(d-1)*a+s-n),_u5=Math.floor(_e56/2),_p2=_e56-_u5,_f2=Math.floor(_i9/2);l={top:_u5,bottom:_p2,left:_f2,right:_i9-_f2,type:"SAME"}}else if("valid"===e)l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-o+1)/r),d=Math.ceil((n-s+1)/a);else{if("object"!=_typeof(e))throw Error("Unknown padding parameter: ".concat(e));var _p3="channelsLast"===u?e[1][0]:e[2][0],_f3="channelsLast"===u?e[1][1]:e[2][1],_h2="channelsLast"===u?e[2][0]:e[3][0],_m2="channelsLast"===u?e[2][1]:e[3][1];l={top:_p3,bottom:_f3,left:_h2,right:_m2,type:0===_p3&&0===_f3&&0===_h2&&0===_m2?"VALID":"EXPLICIT"},c=La((t-o+_p3+_f3)/r+1,i),d=La((n-s+_h2+_m2)/a+1,i)}return{padInfo:l,outHeight:c,outWidth:d}}(a,l,c,m,g,x,v,o,i),k=_ref6.padInfo,w=_ref6.outHeight,I=_ref6.outWidth,N=s?h*d:h;return"channelsFirst"===i?T=[u,N,w,I]:"channelsLast"===i&&(T=[u,w,I,N]),{batchSize:u,dataFormat:i,inHeight:l,inWidth:c,inChannels:d,outHeight:w,outWidth:I,outChannels:N,padInfo:k,strideHeight:m,strideWidth:g,filterHeight:p,filterWidth:f,effectiveFilterHeight:x,effectiveFilterWidth:v,dilationHeight:b,dilationWidth:y,inShape:e,outShape:T,filterShape:t}}function Fa(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",i=arguments.length>7?arguments[7]:void 0,u=-1,l=-1,c=-1,d=-1,p=-1;if("channelsLast"===s){var _e57=_slicedToArray(e,5);u=_e57[0],l=_e57[1],c=_e57[2],d=_e57[3],p=_e57[4]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var _e58=_slicedToArray(e,5);u=_e58[0],p=_e58[1],l=_e58[2],c=_e58[3],d=_e58[4]}var R,_t55=_slicedToArray(t,5),f=_t55[0],h=_t55[1],m=_t55[2],g=_t55[4],_Da3=Da(n),_Da4=_slicedToArray(_Da3,3),b=_Da4[0],y=_Da4[1],x=_Da4[2],_Da5=Da(r),_Da6=_slicedToArray(_Da5,3),v=_Da6[0],k=_Da6[1],w=_Da6[2],I=Pa(f,v),N=Pa(h,k),T=Pa(m,w),_ref7=function(e,t,n,r,a,o,s,i,u,l,c){var d,p,f,h;if("number"==typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var _o13=function(e,t,n,r,a,o){null==a&&(a=Oa(e,t,r));var i=e[1],u=e[2];return[La((e[0]-t+2*a)/r+1,o),La((i-t+2*a)/r+1,o),La((u-t+2*a)/r+1,o),1]}([t,n,r,1],i,0,a,e,c);p=_o13[0],f=_o13[1],h=_o13[2]}else if("same"===e){var _e59=((p=Math.ceil(t/a))-1)*a+i-t,_c2=((f=Math.ceil(n/o))-1)*o+u-n,_m3=((h=Math.ceil(r/s))-1)*s+l-r,_g2=Math.floor(_e59/2),_b2=_e59-_g2,_y2=Math.floor(_c2/2),_x16=_c2-_y2,_v2=Math.floor(_m3/2);d={top:_y2,bottom:_x16,left:_v2,right:_m3-_v2,front:_g2,back:_b2,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-i+1)/a),f=Math.ceil((n-u+1)/o),h=Math.ceil((r-l+1)/s)}return{padInfo:d,outDepth:p,outHeight:f,outWidth:h}}(a,l,c,d,b,y,x,I,N,T,i),C=_ref7.padInfo,E=_ref7.outDepth,S=_ref7.outHeight,_=_ref7.outWidth,$=o?g*p:g;return"channelsFirst"===s?R=[u,$,E,S,_]:"channelsLast"===s&&(R=[u,E,S,_,$]),{batchSize:u,dataFormat:s,inDepth:l,inHeight:c,inWidth:d,inChannels:p,outDepth:E,outHeight:S,outWidth:_,outChannels:$,padInfo:C,strideDepth:b,strideHeight:y,strideWidth:x,filterDepth:f,filterHeight:h,filterWidth:m,effectiveFilterDepth:I,effectiveFilterHeight:N,effectiveFilterWidth:T,dilationDepth:v,dilationHeight:k,dilationWidth:w,inShape:e,outShape:R,filterShape:t}}function Oa(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Pa(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Ma(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Da(e){return"number"==typeof e?[e,e,e]:e}function Pa(e,t){return t<=1?e:e+(e-1)*(t-1)}function La(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function Ba(e){var _Ma8=_slicedToArray(Ma(e),3),t=_Ma8[0],n=_Ma8[1],r=_Ma8[2];return 1===t&&1===n&&1===r}function za(e,t){return Ba(e)||Ba(t)}function Wa(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}var Va=Kn({reshape_:function reshape_(e,t){var n={x:Gn(e,"x","reshape","string_or_numeric")},r={shape:t};return Ln.runKernel("Reshape",n,r)}}),Ua=Kn({avgPool_:function avgPool_(e,t,n,r,a){var o=Gn(e,"x","avgPool","float32");pt(za(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '1'")}));var s=o,i=!1;3===o.rank&&(i=!0,s=Va(o,[1,o.shape[0],o.shape[1],o.shape[2]])),pt(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")})),null!=a&&pt(yt(r),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a},c=Ln.runKernel("AvgPool",u,l);return c=Er(c,o.dtype),i?Va(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),Ha=Kn({avgPool3d_:function avgPool3d_(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",s=Gn(e,"x","avgPool3d","float32"),i=s,u=!1;4===s.rank&&(u=!0,i=Va(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),pt(5===i.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(i.rank,".")})),pt("NDHWC"===o,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(o)})),null!=a&&pt(yt(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l={x:i},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:o},d=Ln.runKernel("AvgPool3D",l,c);return d=Er(d,i.dtype),u?Va(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),ja=Kn({concat_:function concat_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;pt(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=qn(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return Sr(n[0]);var r=n,a={axis:t};return Ln.runKernel("Concat",r,a)}}),Ga=Kn({sigmoid_:function sigmoid_(e){var t={x:Gn(e,"x","sigmoid")};return Ln.runKernel("Sigmoid",t)}}),qa=Kn({slice_:function slice_(e,t,n){var r=Gn(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},o={begin:t,size:n};return Ln.runKernel("Slice",a,o)}}),Ka=Kn({tanh_:function tanh_(e){var t={x:Gn(e,"x","tanh")};return Ln.runKernel("Tanh",t)}}),Xa=Kn({batchToSpaceND_:function batchToSpaceND_(e,t,n){var r=Gn(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));pt(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),pt(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),pt(r.shape[0]%a==0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)}));var o={x:r},s={blockShape:t,crops:n};return Ln.runKernel("BatchToSpaceND",o,s)}}),Ya=Kn({batchNorm_:function batchNorm_(e,t,n,r,a,o){null==o&&(o=.001);var l,c,s=Gn(e,"x","batchNorm"),i=Gn(t,"mean","batchNorm"),u=Gn(n,"variance","batchNorm");null!=a&&(l=Gn(a,"scale","batchNorm")),null!=r&&(c=Gn(r,"offset","batchNorm")),pt(i.rank===u.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),pt(null==c||i.rank===c.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),pt(null==l||i.rank===l.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var d={x:function(e){return 0===e.rank||1===e.rank?Va(e,[1,1,1,e.size]):2===e.rank?Va(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Va(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(s),scale:l,offset:c,mean:i,variance:u},p={varianceEpsilon:o},f=Ln.runKernel("FusedBatchNorm",d,p);return Va(f,s.shape)}}),Qa=Kn({bincount_:function bincount_(e,t,n){var r=Gn(e,"x","bincount"),a=Gn(t,"weights","bincount");pt("int32"===r.dtype,(function(){return"Error in bincount: input dtype must be int32, but got ".concat(r.dtype)})),pt(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),pt(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(r.shape,", weights shape: ").concat(a.shape,".")}));var o={x:r,weights:a},s={size:n};return Ln.runKernel("Bincount",o,s)}}),Za=Kn({broadcastTo_:function broadcastTo_(e,t){var n=Gn(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var _e60=n.shape.slice();_e60.length<t.length;)_e60.unshift(1);n=Va(n,_e60)}for(var a=n.shape,o=Array.from(t),_e61=t.length-1;_e61>=0;_e61--)if(a[_e61]===t[_e61])o[_e61]=1;else if(1!==n.shape[_e61])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));if(0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length)return Sr(n);var s={x:n},i={reps:o};return Ln.runKernel("Tile",s,i)}}),Ja=Kn({ceil_:function ceil_(e){var t={x:Gn(e,"x","ceil")};return Ln.runKernel("Ceil",t)}}),eo=Kn({clipByValue_:function clipByValue_(e,t,n){var r=Gn(e,"x","clipByValue");pt(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")}));var a={x:r},o={clipValueMin:t,clipValueMax:n};return Ln.runKernel("ClipByValue",a,o)}}),to=Kn({concat2d_:function concat2d_(e,t){return ja(e,t)}}),no=Kn({conv2d_:function conv2d_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0,i=Gn(e,"x","conv2d"),u=Gn(t,"filter","conv2d"),l=i,c=!1;3===i.rank&&(c=!0,l=Va(i,[1,i.shape[0],i.shape[1],i.shape[2]])),pt(4===l.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),pt(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank ".concat(u.rank,".")})),null!=s&&pt(yt(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode ".concat(s," but got pad ").concat(r,".")}));var d="NHWC"===a?l.shape[3]:l.shape[1];pt(d===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(d,") must match input depth for filter ").concat(u.shape[2],".")})),pt(za(n,o),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(o,"'")}));var p={x:l,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:o,dimRoundingMode:s},h=Ln.runKernel("Conv2D",p,f);return c?Va(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),ro=Kn({conv1d_:function conv1d_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6?arguments[6]:void 0,i=Gn(e,"x","conv1d"),u=Gn(t,"filter","conv1d"),l=i,c=!1;2===i.rank&&(c=!0,l=Va(i,[1,i.shape[0],i.shape[1]])),pt(3===l.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(l.rank,".")})),pt(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank ".concat(u.rank,".")})),null!=s&&pt(yt(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode ".concat(s," but got pad ").concat(r,".")})),pt(l.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(l.shape[2],") must match input depth for filter ").concat(u.shape[1],".")})),pt(za(n,o),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(o,"'")})),pt("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var d=Va(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=Va(l,[l.shape[0],1,l.shape[1],l.shape[2]]),f=no(p,d,[1,n],r,"NHWC",[1,o],s);return Va(f,c?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}}),ao=Kn({conv2DBackpropInput_:function conv2DBackpropInput_(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",s=arguments.length>6?arguments[6]:void 0;pt(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,u=t,l=!1;3===t.rank&&(l=!0,u=Va(t,[1,t.shape[0],t.shape[1],t.shape[2]]),i=[1,e[0],e[1],e[2]]),pt(4===i.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length ".concat(i.length,".")})),pt(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank ".concat(u.rank)})),pt(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank ".concat(n.rank)}));var c="NHWC"===o?i[3]:i[1],d="NHWC"===o?u.shape[3]:u.shape[1];pt(c===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(c,") must match input depth for filter ").concat(n.shape[2],".")})),pt(d===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(d,") must match output depth for filter ").concat(n.shape[3],".")})),null!=s&&pt(yt(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ".concat(s," but got pad ").concat(a,".")}));var p={dy:u,filter:n},f={strides:r,pad:a,dataFormat:o,dimRoundingMode:s,inputShape:i},h=Ln.runKernel("Conv2DBackpropInput",p,f);return l?Va(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),oo=Kn({conv2dTranspose_:function conv2dTranspose_(e,t,n,r,a,o){var s=Gn(e,"x","conv2dTranspose"),i=Gn(t,"filter","conv2dTranspose");return ao(n,s,i,r,a,"NHWC",o)}}),so=Kn({conv3d_:function conv3d_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],s=Gn(e,"x","conv3d"),i=Gn(t,"filter","conv3d"),u=s,l=!1;4===s.rank&&(l=!0,u=Va(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),pt(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),pt(5===i.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank ".concat(i.rank,".")})),pt(u.shape[4]===i.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match input depth for filter ").concat(i.shape[3],".")})),pt(za(n,o),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(o,"'")})),pt("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var c={x:u,filter:i},d={strides:n,pad:r,dataFormat:a,dilations:o},p=Ln.runKernel("Conv3D",c,d);return l?Va(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),io=Kn({cos_:function cos_(e){var t={x:Gn(e,"x","cos")};return Ln.runKernel("Cos",t)}}),uo=Kn({cosh_:function cosh_(e){var t={x:Gn(e,"x","cosh")};return Ln.runKernel("Cosh",t)}}),lo=Kn({cumsum_:function cumsum_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:Gn(e,"x","cumsum")},o={axis:t,exclusive:n,reverse:r};return Ln.runKernel("Cumsum",a,o)}}),co=Kn({denseBincount_:function denseBincount_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gn(e,"x","denseBincount"),o=Gn(t,"weights","denseBincount");pt("int32"===a.dtype,(function(){return"Error in denseBincount: input dtype must be int32, but got ".concat(a.dtype)})),pt(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got rank ".concat(a.rank,".")})),pt(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),pt(o.size===a.size||0===o.size,(function(){return"Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ".concat(a.shape,", weights shape: ").concat(o.shape,".")}));var s={x:a,weights:o},i={size:n,binaryOutput:r};return Ln.runKernel("DenseBincount",s,i)}}),po=Kn({depthToSpace_:function depthToSpace_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=Gn(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],s="NHWC"===n?r.shape[3]:r.shape[1];pt(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),pt(o*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(o," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),pt(s%(t*t)==0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(s," for depthToSpace with input shape ").concat(r.shape)}));var i={x:r},u={blockSize:t,dataFormat:n};return Ln.runKernel("DepthToSpace",i,u)}}),fo=Kn({depthwiseConv2d_:function depthwiseConv2d_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0,i=Gn(e,"x","depthwiseConv2d"),u=Gn(t,"filter","depthwiseConv2d"),l=i,c=!1;3===i.rank&&(c=!0,l=Va(i,[1,i.shape[0],i.shape[1],i.shape[2]])),pt(4===l.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),pt(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank ".concat(u.rank,".")})),pt(l.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(l.shape[3],") must match the inChannels dimension in filter ").concat(u.shape[2],".")})),null!=s&&pt(yt(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ".concat(s," but got pad ").concat(r,".")}));var d={x:l,filter:u},p={strides:n,pad:r,dataFormat:a,dilations:o,dimRoundingMode:s},f=Ln.runKernel("DepthwiseConv2dNative",d,p);return c?Va(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),ho=Kn({dilation2d_:function dilation2d_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",s=Gn(e,"x","dilation2d"),i=Gn(t,"filter","dilation2d");pt(3===s.rank||4===s.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank ".concat(s.rank,".")})),pt(3===i.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank ".concat(i.rank,".")})),pt("NHWC"===o,(function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ".concat(o)}));var u=s,l=!1;3===s.rank&&(u=Va(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=!0);var c={x:u,filter:i},d={strides:n,pad:r,dilations:a},p=Ln.runKernel("Dilation2D",c,d);return l?Va(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});function mo(e,t){for(var n=e.length,r=[],_a23=0;_a23<n;_a23++){var _o14=n-1-_a23,_s10=e[_o14]||1;(t[t.length-1-_a23]||1)>1&&1===_s10&&r.unshift(_o14)}return r}function go(e,t){for(var n=[],_r30=0;_r30<t.length;_r30++){var _a24=e[e.length-_r30-1],_o15=t.length-_r30-1,_s11=t[_o15];(null==_a24||1===_a24&&_s11>1)&&n.unshift(_o15)}return n}function bo(e,t){for(var n=[],r=Math.max(e.length,t.length),_a25=0;_a25<r;_a25++){var _r31=e[e.length-_a25-1];null==_r31&&(_r31=1);var _o16=t[t.length-_a25-1];if(null==_o16&&(_o16=1),1===_r31)n.unshift(_o16);else if(1===_o16)n.unshift(_r31);else{if(_r31!==_o16)throw Error("Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,"."));n.unshift(_r31)}}return n}var yo=Kn({equal_:function equal_(e,t){var _Rn14,n=Gn(e,"a","equal"),r=Gn(t,"b","equal");n=(_Rn14=_slicedToArray(Rn(n,r),2))[0],r=_Rn14[1],bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("Equal",a)}}),xo=Kn({where_:function where_(e,t,n){var r=Gn(t,"a","where"),a=Gn(n,"b","where"),o=Gn(e,"condition","where","bool"),s=bo(r.shape,a.shape),i=Za(r,s),u=Za(a,s);1===o.rank&&pt(o.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})),1!==o.rank&&ft(o.shape,u.shape,"Error in where: ");var l={condition:o,t:i,e:u};return Ln.runKernel("Select",l)}}),vo=Kn({zerosLike_:function zerosLike_(e){var t={x:Gn(e,"x","zerosLike")};return Ln.runKernel("ZerosLike",t)}}),ko=Kn({divNoNan_:function divNoNan_(e,t){var n=Gn(e,"a","div"),r=Gn(t,"b","div"),_Rn16=_slicedToArray(Rn(n,r),2);n=_Rn16[0],r=_Rn16[1];var a=ha(n,r),o=vo(a),s=yo(r,o);return xo(s,o,a)}}),wo=Kn({elu_:function elu_(e){var t={x:Gn(e,"x","elu")};return Ln.runKernel("Elu",t)}}),Io=Kn({erf_:function erf_(e){var t=Gn(e,"x","erf");pt("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=Er(t,"float32"));var n={x:t};return Ln.runKernel("Erf",n)}}),No=Kn({exp_:function exp_(e){var t={x:Gn(e,"x","exp")};return Ln.runKernel("Exp",t)}}),To=Kn({expandDims_:function expandDims_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gn(e,"x","expandDims","string_or_numeric");pt(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return Ln.runKernel("ExpandDims",r,a)}}),Co=Kn({expm1_:function expm1_(e){var t={x:Gn(e,"x","expm1")};return Ln.runKernel("Expm1",t)}}),Eo=Kn({tile_:function tile_(e,t){var n=Gn(e,"x","tile","string_or_numeric");pt(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")}));var r={x:n},a={reps:t};return Ln.runKernel("Tile",r,a)}});function So(e,t,n){var r={shape:e,value:t,dtype:n};return Ln.runKernel("Fill",{},r)}var _o=Kn({floor_:function floor_(e){var t={x:Gn(e,"x","floor")};return Ln.runKernel("Floor",t)}}),$o=Kn({gather_:function gather_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={x:Gn(e,"x","gather"),indices:Gn(t,"indices","gather","int32")},o={axis:n,batchDims:r};return Ln.runKernel("GatherV2",a,o)}}),Ro=Kn({greater_:function greater_(e,t){var _Rn18,n=Gn(e,"a","greater"),r=Gn(t,"b","greater");n=(_Rn18=_slicedToArray(Rn(n,r),2))[0],r=_Rn18[1],bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("Greater",a)}}),Ao=Kn({greaterEqual_:function greaterEqual_(e,t){var _Rn20,n=Gn(e,"a","greaterEqual"),r=Gn(t,"b","greaterEqual");n=(_Rn20=_slicedToArray(Rn(n,r),2))[0],r=_Rn20[1],bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("GreaterEqual",a)}}),Fo=Kn({imag_:function imag_(e){var t={input:Gn(e,"input","imag")};return Ln.runKernel("Imag",t)}}),Oo=Kn({leakyRelu_:function leakyRelu_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:Gn(e,"x","leakyRelu")},r={alpha:t};return Ln.runKernel("LeakyRelu",n,r)}}),Mo=Kn({less_:function less_(e,t){var _Rn22,n=Gn(e,"a","less"),r=Gn(t,"b","less");n=(_Rn22=_slicedToArray(Rn(n,r),2))[0],r=_Rn22[1],bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("Less",a)}}),Do=Kn({lessEqual_:function lessEqual_(e,t){var _Rn24,n=Gn(e,"a","lessEqual"),r=Gn(t,"b","lessEqual");n=(_Rn24=_slicedToArray(Rn(n,r),2))[0],r=_Rn24[1],bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("LessEqual",a)}});function Po(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return Ln.runKernel("LinSpace",{},r)}var Lo=Kn({localResponseNormalization_:function localResponseNormalization_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,o=Gn(e,"x","localResponseNormalization");pt(4===o.rank||3===o.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(o.rank,".")})),pt(yt(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")}));var s=o,i=!1;3===o.rank&&(i=!0,s=Va(o,[1,o.shape[0],o.shape[1],o.shape[2]]));var u={x:s},l={depthRadius:t,bias:n,alpha:r,beta:a},c=Ln.runKernel("LRN",u,l);return i?Va(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),Bo=Kn({log_:function log_(e){var t={x:Gn(e,"x","log")};return Ln.runKernel("Log",t)}}),zo=Kn({log1p_:function log1p_(e){var t={x:Gn(e,"x","log1p")};return Ln.runKernel("Log1p",t)}});function Wo(e){return Ln.customGrad(e)}var Vo=Kn({neg_:function neg_(e){var t={x:Gn(e,"x","neg")};return Ln.runKernel("Neg",t)}}),Uo=Kn({softplus_:function softplus_(e){var t={x:Gn(e,"x","softplus")};return Ln.runKernel("Softplus",t)}}),Ho=Kn({max_:function max_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Gn(e,"x","max")},a={reductionIndices:t,keepDims:n};return Ln.runKernel("Max",r,a)}}),jo=Kn({sub_:function sub_(e,t){var n=Gn(e,"a","sub"),r=Gn(t,"b","sub"),_Rn26=_slicedToArray(Rn(n,r),2),a={a:n=_Rn26[0],b:r=_Rn26[1]};return Ln.runKernel("Sub",a)}}),Go=Kn({sum_:function sum_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gn(e,"x","sum");"bool"===r.dtype&&(r=Er(r,"int32"));var a={x:r},o={axis:t,keepDims:n};return Ln.runKernel("Sum",a,o)}}),qo=Kn({logSoftmax_:function logSoftmax_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Gn(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return Wo((function(e,n){var r=Ho(e,t,!0),a=jo(e,r),o=jo(Er(a,"float32"),Bo(Go(No(a),t,!0)));return n([o]),{value:o,gradFunc:function gradFunc(e,n){var r=_slicedToArray(n,1)[0],a=No(r);return jo(e,ma(Go(e,t,!0),a))}}}))(n)}});function Ko(e,t){for(var _n26=0;_n26<e.length;++_n26)if(e[e.length-_n26-1]!==t-1-_n26)return!1;return!0}function Xo(e,t,n){for(var r=e.length+t.length,a=[],o=0,s=0,_i10=0;_i10<r;_i10++)-1===n.indexOf(_i10)?a.push(e[o++]):a.push(t[s++]);return a}function Yo(e,t){for(var n=[],r=e.length,_a26=0;_a26<r;_a26++)-1===t.indexOf(_a26)&&n.push(e[_a26]);return[n,t.map((function(t){return e[t]}))]}function Qo(e,t){return Xo(e,t.map((function(e){return 1})),t)}function Zo(e,t,n){pt(Ko(t,n),(function(){return"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")}))}function Jo(e,t){if(Ko(e,t))return null;for(var n=[],_r32=0;_r32<t;++_r32)-1===e.indexOf(_r32)&&n.push(_r32);return e.forEach((function(e){return n.push(e)})),n}function es(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function ts(e,t){for(var n=[],_r33=t-e;_r33<t;++_r33)n.push(_r33);return n}var ns=Kn({logicalAnd_:function logicalAnd_(e,t){var n=Gn(e,"a","logicalAnd","bool"),r=Gn(t,"b","logicalAnd","bool");bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("LogicalAnd",a)}}),rs=Kn({logicalNot_:function logicalNot_(e){var t={x:Gn(e,"x","logicalNot","bool")};return Ln.runKernel("LogicalNot",t)}}),as=Kn({logicalOr_:function logicalOr_(e,t){var n=Gn(e,"a","logicalOr","bool"),r=Gn(t,"b","logicalOr","bool");bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("LogicalOr",a)}}),os=Kn({maxPool_:function maxPool_(e,t,n,r,a){var o=Gn(e,"x","maxPool"),s=o,i=!1;3===o.rank&&(i=!0,s=Va(o,[1,o.shape[0],o.shape[1],o.shape[2]])),pt(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")})),pt(za(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '1'")})),null!=a&&pt(yt(r),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a},c=Ln.runKernel("MaxPool",u,l);return i?Va(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),ss=Kn({maxPool3d_:function maxPool3d_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",s=Gn(e,"x","maxPool3d"),i=s,u=!1;4===s.rank&&(u=!0,i=Va(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),pt(5===i.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(i.rank,".")})),pt("NDHWC"===o,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(o)})),null!=a&&pt(yt(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l={x:i},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:o},d=Ln.runKernel("MaxPool3D",l,c);return u?Va(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),is=Kn({maxPoolWithArgmax_:function maxPoolWithArgmax_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o={x:Gn(e,"x","maxPoolWithArgmax")},s={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},i=Ln.runKernel("MaxPoolWithArgmax",o,s);return{result:i[0],indexes:i[1]}}}),us=Kn({maximum_:function maximum_(e,t){var _Rn28,n=Gn(e,"a","maximum"),r=Gn(t,"b","maximum");n=(_Rn28=_slicedToArray(Rn(n,r),2))[0],r=_Rn28[1],"bool"===n.dtype&&(n=Er(n,"int32"),r=Er(r,"int32")),bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("Maximum",a)}}),ls=Kn({mean_:function mean_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Gn(e,"x","mean")},a={axis:t,keepDims:n};return Ln.runKernel("Mean",r,a)}}),cs=Kn({min_:function min_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Gn(e,"x","min")},a={axis:t,keepDims:n};return Ln.runKernel("Min",r,a)}}),ds=Kn({minimum_:function minimum_(e,t){var _Rn30,n=Gn(e,"a","minimum"),r=Gn(t,"b","minimum");n=(_Rn30=_slicedToArray(Rn(n,r),2))[0],r=_Rn30[1],"bool"===n.dtype&&(n=Er(n,"int32"),r=Er(r,"int32")),bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("Minimum",a)}}),ps=Kn({mirrorPad_:function mirrorPad_(e,t,n){pt("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=Gn(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");pt(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,_loop5=function _loop5(_e62){pt(2===t[_e62].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),pt(t[_e62][0]>=0&&t[_e62][0]<=r.shape[_e62]-a&&t[_e62][1]>=0&&t[_e62][1]<=r.shape[_e62]-a,(function(){return"Padding in dimension ".concat(_e62," cannot be greater than or equal to ").concat(r.shape[_e62]-a," or less than 0 for input of shape ").concat(r.shape)}))},_e62=0;_e62<r.rank;_e62++)_loop5(_e62);var o={paddings:t,mode:n},s={x:r};return Ln.runKernel("MirrorPad",s,o)}}),fs=Kn({mod_:function mod_(e,t){var n=Gn(e,"a","mod"),r=Gn(t,"b","mod"),_Rn32=_slicedToArray(Rn(n,r),2),a={a:n=_Rn32[0],b:r=_Rn32[1]};return Ln.runKernel("Mod",a)}}),hs=Kn({square_:function square_(e){var t=Gn(e,"x","square");return Ln.runKernel("Square",{x:t},{})}}),ms=Kn({multinomial_:function multinomial_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gn(e,"logits","multinomial"),o=a.size,s=a.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got ".concat(o,"."));if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(s));n=n||Math.random();var i={logits:1===s?Va(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},l=Ln.runKernel("Multinomial",i,u);return 1===s?Va(l,[l.size]):l}}),gs=Kn({notEqual_:function notEqual_(e,t){var _Rn34,n=Gn(e,"a","notEqual"),r=Gn(t,"b","notEqual");n=(_Rn34=_slicedToArray(Rn(n,r),2))[0],r=_Rn34[1],bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("NotEqual",a)}});function bs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var _t56=bs(e,"float32"),_n27=bs(e,"float32");return Xn(_t56,_n27)}var n=Lt(gt(e),t);return Ln.makeTensor(n,e,t)}function ys(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var _t57=ys(e,"float32"),_n28=bs(e,"float32");return Xn(_t57,_n28)}var n=Pt(gt(e),t);return Ln.makeTensor(n,e,t)}var xs=Kn({onesLike_:function onesLike_(e){var t={x:Gn(e,"x","onesLike")};return Ln.runKernel("OnesLike",t)}}),vs=Kn({pad_:function pad_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Gn(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},o={x:r};return Ln.runKernel("PadV2",o,a)}}),ks=Kn({spaceToBatchND_:function spaceToBatchND_(e,t,n){var r=Gn(e,"x","spaceToBatchND");pt(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),pt(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),pt(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},o={blockShape:t,paddings:n};return Ln.runKernel("SpaceToBatchND",a,o)}}),ws=Kn({pow_:function pow_(e,t){var n=Gn(e,"base","pow"),r=Gn(t,"exp","pow"),_Rn36=_slicedToArray(Rn(n,r),2),a={a:n=_Rn36[0],b:r=_Rn36[1]};return Ln.runKernel("Pow",a)}}),Is=Kn({prelu_:function prelu_(e,t){var n={x:Gn(e,"x","prelu"),alpha:Gn(t,"alpha","prelu")};return Ln.runKernel("Prelu",n)}}),Ns=Kn({prod_:function prod_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gn(e,"x","prod");"bool"===r.dtype&&(r=Er(r,"int32"));var a={x:r},o={axis:t,keepDims:n};return Ln.runKernel("Prod",a,o)}}),Ts=U((function(e){!function(e,t,n){function r(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new r(e),o=t&&t.state,s=n.next;return s.int32=function(){return 4294967296*n.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,o&&("object"==_typeof(o)&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.alea=o}(0,e)})),Cs=U((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new r(e),o=t&&t.state,s=function s(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&("object"==_typeof(o)&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xor128=o}(0,e)})),Es=U((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,s=function s(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&("object"==_typeof(o)&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xorwow=o}(0,e)})),Ss=U((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,s=function s(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&(o.x&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xorshift7=o}(0,e)})),_s=U((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,o=t.i;return t.w=r=r+1640531527|0,n=a[o+34&127],e=a[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[o]=n^e,t.i=o,n+(r^r>>>16)|0},function(e,t){var n,r,a,o,s,i=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,o=-32;o<u;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(s=s+1640531527|0,a=0==(n=i[127&o]^=r+s)?a+1:0);for(a>=128&&(i[127&(t&&t.length||0)]=-1),a=127,o=512;o>0;--o)r=i[a+34&127],n=i[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,i[a]=r^n;e.w=s,e.X=i,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,s=function s(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&(o.X&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xor4096=o}(0,e)})),$s=U((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,s=function s(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&("object"==_typeof(o)&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.tychei=o}(0,e)})),Rs=H(Object.freeze({__proto__:null,default:{}})),As=U((function(e){!function(t,n){var r,a=this,o=256,s=n.pow(o,6),i=n.pow(2,52),u=2*i,l=255;function c(e,l,c){var g=[],b=h(function f(e,t){var n,r=[],a=_typeof(e);if(t&&"object"==a)for(n in e)try{r.push(f(e[n],t-1))}catch(e){}return r.length?r:"string"==a?e:e+"\0"}((l=1==l?{entropy:!0}:l||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=a.navigator,s=n&&n.plugins;return[+new Date,a,s,a.screen,m(t)]}}():e,3),g),y=new d(g),x=function x(){for(var e=y.g(6),t=s,n=0;e<i;)e=(e+n)*o,t*=o,n=y.g(1);for(;e>=u;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,h(m(y.S),t),(l.pass||c||function(e,t,r,a){return a&&(a.S&&p(a,y),e.state=function(){return p(y,{})}),r?(n.random=e,t):e})(x,b,"global"in l?l.global:this==n,l.state)}function d(e){var t,n=e.length,r=this,a=0,s=r.i=r.j=0,i=r.S=[];for(n||(e=[n++]);a<o;)i[a]=a++;for(a=0;a<o;a++)i[a]=i[s=l&s+e[a%n]+(t=i[a])],i[s]=t;(r.g=function(e){for(var t,n=0,a=r.i,s=r.j,i=r.S;e--;)t=i[a=l&a+1],n=n*o+i[l&(i[a]=i[s=l&s+t])+(i[s]=t)];return r.i=a,r.j=s,n})(o)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function h(e,t){for(var n,r=e+"",a=0;a<r.length;)t[l&a]=l&(n^=19*t[l&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(n.seedrandom=c,h(n.random(),t),e.exports){e.exports=c;try{r=Rs}catch(e){}}}([],Math)}));As.alea=Ts,As.xor128=Cs,As.xorwow=Es,As.xorshift7=Ss,As.xor4096=_s,As.tychei=$s;var Fs=As,Os=function(){function Os(e,t,n,r,a){_classCallCheck(this,Os),this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=a||Math.random();this.random=Fs.alea(o.toString())}return _createClass(Os,[{key:"nextValue",value:function nextValue(){if(!isNaN(this.nextVal)){var _e63=this.nextVal;return this.nextVal=NaN,_e63}for(var e,t,n=!1;!n;){var _r34=void 0,_a27=void 0,_o17=void 0;do{_o17=(_r34=2*this.random()-1)*_r34+(_a27=2*this.random()-1)*_a27}while(_o17>=1||0===_o17);var _s12=Math.sqrt(-2*Math.log(_o17)/_o17);e=this.mean+this.stdDev*_r34*_s12,t=this.mean+this.stdDev*_a27*_s12,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}},{key:"convertValue",value:function convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function isValidTruncated(e){return e<=this.upper&&e>=this.lower}}]),Os}(),Ms=function(){function Ms(){var _this20=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(_classCallCheck(this,Ms),this.canReturnFloat=function(){return null==_this20.dtype||"float32"===_this20.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=Fs.alea(r)}return _createClass(Ms,[{key:"convertValue",value:function convertValue(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function nextValue(){return this.convertValue(this.min+this.range*this.random())}}]),Ms}(),Ds=Kn({randomUniform_:function randomUniform_(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,o=Cr(e,r),s=new Ms(t,n,null,a),_e64=0;_e64<o.values.length;_e64++)o.values[_e64]=s.nextValue();return o.toTensor()}});function Ps(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return Ln.runKernel("Range",{},a)}var Ls=Kn({real_:function real_(e){var t={input:Gn(e,"input","real")};return Ln.runKernel("Real",t)}}),Bs=Kn({reciprocal_:function reciprocal_(e){var t={x:Gn(e,"x","reciprocal")};return Ln.runKernel("Reciprocal",t)}}),zs=Kn({relu_:function relu_(e){var t={x:Gn(e,"x","relu")};return Ln.runKernel("Relu",t)}}),Ws=Kn({relu6_:function relu6_(e){var t={x:Gn(e,"x","relu6")};return Ln.runKernel("Relu6",t)}}),Vs=Kn({reverse_:function reverse_(e,t){var n={x:Gn(e,"x","reverse")},r={dims:t};return Ln.runKernel("Reverse",n,r)}}),Us=Kn({round_:function round_(e){var t={x:Gn(e,"x","round")};return Ln.runKernel("Round",t)}}),Hs=Kn({rsqrt_:function rsqrt_(e){var t={x:Gn(e,"x","rsqrt")};return Ln.runKernel("Rsqrt",t)}});function js(e,t){if((St(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&St(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Yn(e,[],[],t)}var Gs=Kn({selu_:function selu_(e){var t={x:Gn(e,"x","selu")};return Ln.runKernel("Selu",t)}}),qs=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark((function _callee22(e,t){var n,r,a,o,s,i,_e65,u,l,_e66,_t58;return regeneratorRuntime.wrap((function _callee22$(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:return n=Gn(e,"x","setdiff1d"),r=Gn(t,"y","setdiff1d"),pt(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(n.dtype,") and y (").concat(r.dtype,").")})),pt(1===n.rank,(function(){return"x should be 1D tensor, but got x (".concat(n.shape,").")})),pt(1===r.rank,(function(){return"y should be 1D tensor, but got y (".concat(r.shape,").")})),_context22.next=4,n.data();case 4:return a=_context22.sent,_context22.next=7,r.data();case 7:for(o=_context22.sent,s=new Set(o),i=0,_e65=0;_e65<a.length;_e65++)s.has(a[_e65])||i++;for(u=new yn([i],n.dtype),l=new yn([i],"int32"),_e66=0,_t58=0;_e66<a.length;_e66++)s.has(a[_e66])||(u.values[_t58]=a[_e66],l.values[_t58]=_e66,_t58++);return _context22.abrupt("return",[u.toTensor(),l.toTensor()]);case 14:case"end":return _context22.stop()}}),_callee22)})));return function qs(_x17,_x18){return _ref8.apply(this,arguments)}}(),Ks=Kn({sign_:function sign_(e){var t={x:Gn(e,"x","sign")};return Ln.runKernel("Sign",t)}}),Xs=Kn({sin_:function sin_(e){var t={x:Gn(e,"x","sin")};return Ln.runKernel("Sin",t)}}),Ys=Kn({sinh_:function sinh_(e){var t={x:Gn(e,"x","sinh")};return Ln.runKernel("Sinh",t)}}),Qs=Kn({softmax_:function softmax_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Gn(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return Ln.runKernel("Softmax",r,a)}}),Zs=Kn({fft_:function fft_(e){pt("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Ln.runKernel("FFT",t)}}),Js=Kn({ifft_:function ifft_(e){pt("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Ln.runKernel("IFFT",t)}}),ei=Kn({irfft_:function irfft_(e){var r,t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var _a28=Va(e,[n,t]);r=Js(_a28)}else{var _a29=[n,2*(t-1)],_o18=Va(Ls(e),[n,t]),_s13=Va(Fo(e),[n,t]),_i11=Vs(qa(_o18,[0,1],[n,t-2]),1),_u6=ma(Vs(qa(_s13,[0,1],[n,t-2]),1),js(-1)),l=ja([_o18,_i11],1),c=ja([_s13,_u6],1),_d2=Va(Xn(l,c),[_a29[0],_a29[1]]);r=Js(_d2)}if(r=Ls(r),3===e.rank&&0!==e.shape[0]){var _t59=r,_n29=e.shape[0];r=Va(r,[_n29,r.shape[0]/_n29,r.shape[1]]),_t59.dispose()}return r}}),ti=Kn({split_:function split_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:Gn(e,"x","split")},a={numOrSizeSplits:t,axis:n};return Ln.runKernel("SplitV",r,a)}}),ni=Kn({rfft_:function rfft_(e,t){pt("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var a,n=e.shape[e.shape.length-1],r=e.size/n;if(null!=t&&t<n){var _r35=e.shape.map((function(e){return 0})),_o19=e.shape.map((function(e){return e}));_o19[e.shape.length-1]=t,a=qa(e,_r35,_o19),n=t}else if(null!=t&&t>n){var _r36=e.shape.map((function(e){return e}));_r36[e.shape.length-1]=t-n,a=ja([e,bs(_r36)],e.shape.length-1),n=t}else a=e;var o=vo(a),s=Va(Xn(a,o),[r,n]),i=Zs(s),u=Math.floor(n/2)+1,l=Ls(i),c=Fo(i),d=ti(l,[u,n-u],l.shape.length-1),p=ti(c,[u,n-u],c.shape.length-1),f=a.shape.slice();return f[a.shape.length-1]=u,Va(Xn(d[0],p[0]),f)}}),ri=Kn({sqrt_:function sqrt_(e){var t={x:Gn(e,"x","sqrt")};return Ln.runKernel("Sqrt",t)}}),ai=Kn({squaredDifference_:function squaredDifference_(e,t){var _Rn38,n=Gn(e,"a","squaredDifference"),r=Gn(t,"b","squaredDifference");n=(_Rn38=_slicedToArray(Rn(n,r),2))[0],r=_Rn38[1],bo(n.shape,r.shape);var a={a:n,b:r};return Ln.runKernel("SquaredDifference",a,{})}}),oi=Kn({squeeze_:function squeeze_(e,t){var n=Gn(e,"x","squeeze");return Va(n,Nt(n.shape,t).newShape)}}),si=Kn({stack_:function stack_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=qn(e,"tensors","stack","string_or_numeric");pt(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&pt(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return Ln.runKernel("Pack",r,a)}}),ii=Kn({step_:function step_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:Gn(e,"x","step")},r={alpha:t};return Ln.runKernel("Step",n,r)}}),ui=Kn({stridedSlice_:function stridedSlice_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l={x:Gn(e,"x","stridedSlice")},c={begin:t,end:n,strides:r,beginMask:a,endMask:o,ellipsisMask:s,newAxisMask:i,shrinkAxisMask:u};return Ln.runKernel("StridedSlice",l,c)}}),li=Kn({tan_:function tan_(e){var t={x:Gn(e,"x","tan")};return Ln.runKernel("Tan",t)}});function ci(e,t){ht(e);var n=Un(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Yn(e,null,n,t)}function di(e,t,n){if(ht(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Un(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Yn(e,t,r,n)}var pi=Kn({topk_:function topk_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Gn(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") but got ").concat(t));var o={x:r},s={k:t,sorted:n},_Ln$runKernel=Ln.runKernel("TopK",o,s),_Ln$runKernel2=_slicedToArray(_Ln$runKernel,2),i=_Ln$runKernel2[0],u=_Ln$runKernel2[1];return{values:i,indices:u}}}),fi=Kn({truncatedNormal_:function truncatedNormal_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var o=new Os(t,n,r,!0,a),s=Cr(e,r),_e67=0;_e67<s.values.length;_e67++)s.values[_e67]=o.nextValue();return s.toTensor()}}),hi=Kn({unique_:function unique_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gn(e,"x","unique","string_or_numeric");pt(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},_Ln$runKernel3=Ln.runKernel("Unique",r,a),_Ln$runKernel4=_slicedToArray(_Ln$runKernel3,2),o=_Ln$runKernel4[0],s=_Ln$runKernel4[1];return{values:o,indices:s}}}),mi=Kn({unstack_:function unstack_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gn(e,"x","unstack","string_or_numeric");pt(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return Ln.runKernel("Unpack",r,a)}});function gi(e,t){for(var n=[],_e68=0;_e68<t.length;_e68++)t[_e68]&&n.push(_e68);for(var r=Cr(e,"int32"),a=Cr([n.length,e.length],"int32"),_t60=0;_t60<n.length;_t60++){var _o20=r.indexToLoc(n[_t60]),_s14=_t60*e.length;a.values.set(_o20,_s14)}return a.toTensor()}var bi=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark((function _callee23(e){var t,n,r;return regeneratorRuntime.wrap((function _callee23$(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:return t=Gn(e,"condition","whereAsync","bool"),_context23.next=3,t.data();case 3:return n=_context23.sent,r=gi(t.shape,n),_context23.abrupt("return",(e!==t&&t.dispose(),r));case 6:case"end":return _context23.stop()}}),_callee23)})));return function bi(_x19){return _ref9.apply(this,arguments)}}(),yi=Kn({scatterND_:function scatterND_(e,t,n){var r=Gn(e,"indices","scatterND","int32"),a=Gn(t,"updates","scatterND");Vr(a,r,n);var o={indices:r,updates:a},s={shape:n};return Ln.runKernel("ScatterNd",o,s)}}),xi=Kn({sparseToDense_:function sparseToDense_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Gn(e,"sparseIndices","sparseToDense","int32"),o=Gn(t,"sparseValues","sparseToDense"),s=Gn(r,"defaultValue","sparseToDense",o.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,o=e.rank>1?e.shape[1]:1;if(n.length!==o)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(o,"."));var s=t.size;if(0!==t.rank&&(1!==t.rank||s!==a))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,o,n,s);var i={sparseIndices:a,sparseValues:o,defaultValue:s},u={outputShape:n};return Ln.runKernel("SparseToDense",i,u)}}),vi=Kn({gatherND_:function gatherND_(e,t){var n=Gn(t,"indices","gatherND","int32"),r={params:Gn(e,"x","gatherND"),indices:n};return Ln.runKernel("GatherNd",r)}}),ki=Kn({conv2DBackpropFilter_:function conv2DBackpropFilter_(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",s=arguments.length>6?arguments[6]:void 0,i=e;3===e.rank&&(i=Va(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Va(t,[1,t.shape[0],t.shape[1],t.shape[2]])),pt(4===i.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape ".concat(i.shape,".")})),pt(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape ".concat(u.shape,".")})),pt(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got ".concat(n,".")}));var l="NHWC"===o?i.shape[3]:i.shape[1],c="NHWC"===o?u.shape[3]:u.shape[1];pt(l===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(l,") must match input depth in filter (").concat(n[2],".")})),pt(c===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(c,") must match output depth for filter (").concat(n[3],").")})),null!=s&&pt(yt(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ".concat(s," but got pad ").concat(a,".")}));var d={x:i,dy:u},p={strides:r,pad:a,dataFormat:o,dimRoundingMode:s,filterShape:n};return Ln.runKernel("Conv2DBackpropFilter",d,p)}});function wi(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return ma(e,ii(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function Ii(e,t){var n=t,r=go(e.shape,t.shape);return r.length>0&&(n=Go(n,r)),Va(n,e.shape)}function Ni(e,t,n,r){if("linear"===t)return e;if("relu"===t)return zs(e);if("elu"===t)return wo(e);if("relu6"===t)return Ws(e);if("prelu"===t)return Is(e,n);if("leakyrelu"===t)return Oo(e,r);throw new Error("Unknown fused activation ".concat(t,"."))}var Ti=function Ti(e,t){return!(e>0)||"linear"===t},Ci=Kn({fusedConv2d_:function fusedConv2d_(_ref10){var e=_ref10.x,t=_ref10.filter,n=_ref10.strides,r=_ref10.pad,_ref10$dataFormat=_ref10.dataFormat,a=void 0===_ref10$dataFormat?"NHWC":_ref10$dataFormat,_ref10$dilations=_ref10.dilations,o=void 0===_ref10$dilations?[1,1]:_ref10$dilations,s=_ref10.dimRoundingMode,i=_ref10.bias,_ref10$activation=_ref10.activation,u=void 0===_ref10$activation?"linear":_ref10$activation,l=_ref10.preluActivationWeights,c=_ref10.leakyreluAlpha;if(u=u||"linear",!1===Ti(Ln.state.gradientDepth,u)){var _d3=no(e,t,n,r,a,o,s);return null!=i&&(_d3=pa(_d3,i)),Ni(_d3,u,l,c)}var d=Gn(e,"x","conv2d"),p=Gn(t,"filter","conv2d"),f=d,h=!1;3===d.rank&&(h=!0,f=Va(d,[1,d.shape[0],d.shape[1],d.shape[2]])),pt(4===f.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank ".concat(f.rank,".")})),pt(4===p.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank ".concat(p.rank,".")})),null!=s&&pt(yt(r),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode ".concat(s," but got pad ").concat(r,".")})),pt(f.shape[3]===p.shape[2],(function(){return"Error in conv2d: depth of input (".concat(f.shape[3],") must match input depth for filter ").concat(p.shape[2],".")})),pt(za(n,o),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(o,"'")})),pt("NHWC"===a,(function(){return"Error in conv2d: got dataFormat of ".concat(a," but only NHWC is currently supported.")}));var g,b,m=Aa(f.shape,p.shape,n,o,r,s);null!=i&&(g=_slicedToArray(Rn(g=Gn(i,"bias","fused conv2d"),d),1)[0],bo(m.outShape,g.shape)),null!=l&&(b=Gn(l,"prelu weights","fused conv2d"));var y=function y(e,t){var _t61=_slicedToArray(t,4),a=_t61[0],s=_t61[1],i=_t61[2],l=_t61[3],c=wi(e,i,u);pt(Ba(o),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(o,"'")}));var d=[ao(s.shape,c,a,n,r),ki(s,c,a.shape,n,r)];if(null!=l){var _e69=Ii(l,c);d.push(_e69)}return d},x={x:f,filter:p,bias:g,preluActivationWeights:b},v={strides:n,pad:r,dataFormat:a,dilations:o,dimRoundingMode:s,activation:u,leakyreluAlpha:c};return null==i?Wo((function(e,t,n){var r=Ln.runKernel("FusedConv2D",x,v);return n([t,e,r]),h&&(r=Va(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:y}}))(f,p):Wo((function(e,t,n,r){var a=Ln.runKernel("FusedConv2D",x,v);return r([t,e,a,n]),h&&(a=Va(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:y}}))(f,p,g)}}),Ei=Kn({depthwiseConv2dNativeBackpropFilter_:function depthwiseConv2dNativeBackpropFilter_(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0,i=e;3===e.rank&&(i=Va(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Va(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var l={x:i,dy:u},c={strides:r,pad:a,dimRoundingMode:s,dilations:o,filterShape:n};return Ln.runKernel("DepthwiseConv2dNativeBackpropFilter",l,c)}}),Si=Kn({depthwiseConv2dNativeBackpropInput_:function depthwiseConv2dNativeBackpropInput_(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0,i=t,u=!1;3===t.rank&&(u=!0,i=Va(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var l={dy:i,filter:n},c={strides:r,pad:a,dimRoundingMode:s,dilations:o,inputShape:e},d=Ln.runKernel("DepthwiseConv2dNativeBackpropInput",l,c);return u?Va(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),_i=Kn({fusedDepthwiseConv2d_:function fusedDepthwiseConv2d_(_ref11){var _Rn42,e=_ref11.x,t=_ref11.filter,n=_ref11.strides,r=_ref11.pad,_ref11$dataFormat=_ref11.dataFormat,a=void 0===_ref11$dataFormat?"NHWC":_ref11$dataFormat,_ref11$dilations=_ref11.dilations,o=void 0===_ref11$dilations?[1,1]:_ref11$dilations,s=_ref11.dimRoundingMode,i=_ref11.bias,_ref11$activation=_ref11.activation,u=void 0===_ref11$activation?"linear":_ref11$activation,l=_ref11.preluActivationWeights,c=_ref11.leakyreluAlpha;if(!1===Ti(Ln.state.gradientDepth,u)){var _d4=fo(e,t,n,r,a,o,s);return null!=i&&(_d4=pa(_d4,i)),Ni(_d4,u,l,c)}var d=Gn(e,"x","depthwiseConv2d"),p=Gn(t,"filter","depthwiseConv2d"),f=d,h=!1;3===d.rank&&(h=!0,f=Va(d,[1,d.shape[0],d.shape[1],d.shape[2]])),pt(4===f.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(f.rank,".")})),pt(4===p.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(p.rank,".")})),pt(f.shape[3]===p.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(f.shape[3],") must match the inChannels dimension in filter ").concat(p.shape[2],".")})),null==o&&(o=[1,1]),pt(za(n,o),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=s&&pt(yt(r),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ".concat(s," but got pad ").concat(r,".")}));var g,b,m=Aa(f.shape,p.shape,n,o,r,s,!0);null!=i&&(_Rn42=_slicedToArray(Rn(g=Gn(i,"bias","fused conv2d"),d),1),g=_Rn42[0],bo(m.outShape,g.shape)),null!=l&&(b=Gn(l,"prelu weights","fused depthwiseConv2d"));var y=function y(e,t){pt(Ba(o),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(o,"'")}));var _t62=_slicedToArray(t,4),a=_t62[0],i=_t62[1],l=_t62[2],c=_t62[3],d=wi(e,l,u),p=Si(i.shape,d,a,n,r,o,s),f=Ei(i,d,a.shape,n,r,o,s);return null!=c?[p,f,Ii(g,d)]:[p,f]},x={x:f,filter:p,bias:g,preluActivationWeights:b},v={strides:n,pad:r,dataFormat:a,dilations:o,dimRoundingMode:s,activation:u,leakyreluAlpha:c};return null==i?Wo((function(e,t,n){var r=Ln.runKernel("FusedDepthwiseConv2D",x,v);return n([t,e,r]),h&&(r=Va(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:y}}))(f,p):Wo((function(e,t,n,r){var a=Ln.runKernel("FusedDepthwiseConv2D",x,v);return r([t,e,a,n]),h&&(a=Va(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:y}}))(f,p,g)}}),$i=Kn({fusedMatMul_:function fusedMatMul_(_ref12){var e=_ref12.a,t=_ref12.b,_ref12$transposeA=_ref12.transposeA,n=void 0!==_ref12$transposeA&&_ref12$transposeA,_ref12$transposeB=_ref12.transposeB,r=void 0!==_ref12$transposeB&&_ref12$transposeB,a=_ref12.bias,_ref12$activation=_ref12.activation,o=void 0===_ref12$activation?"linear":_ref12$activation,s=_ref12.preluActivationWeights,i=_ref12.leakyreluAlpha;if(!1===Ti(Ln.state.gradientDepth,o)){var _u7=Mr(e,t,n,r);return null!=a&&(_u7=pa(_u7,a)),Ni(_u7,o,s,i)}var u=Gn(e,"a","fused matMul"),l=Gn(t,"b","fused matMul"),_Rn44=_slicedToArray(Rn(u,l),2);u=_Rn44[0],l=_Rn44[1];var c=n?u.shape[u.rank-2]:u.shape[u.rank-1],d=r?l.shape[l.rank-1]:l.shape[l.rank-2],p=n?u.shape[u.rank-1]:u.shape[u.rank-2],f=r?l.shape[l.rank-2]:l.shape[l.rank-1],h=u.shape.slice(0,-2),m=l.shape.slice(0,-2),g=gt(h),b=gt(m);pt(u.rank>=2&&l.rank>=2&&u.rank===l.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks ".concat(u.rank," and ").concat(l.rank,".")})),pt(bt(h,m),(function(){return"Error in fused matMul: outer dimensions (".concat(h,") and (").concat(m,") of Tensors with shapes ").concat(u.shape," and ").concat(l.shape," must match.")})),pt(c===d,(function(){return"Error in fused matMul: inner shapes (".concat(c,") and (").concat(d,") of Tensors with shapes ").concat(u.shape," and ").concat(l.shape," and transposeA=").concat(n," and transposeB=").concat(r," must match.")}));var k,w,y=u.shape.slice(0,-2).concat([p,f]),x=Va(u,n?[g,c,p]:[g,p,c]),v=Va(l,r?[b,f,d]:[b,d,f]);null!=a&&(k=_slicedToArray(Rn(k=Gn(a,"bias","fused matMul"),u),1)[0],bo(y,k.shape)),null!=s&&(w=Gn(s,"prelu weights","fused matMul"));var I=function I(e,t){var d,p,_t63=_slicedToArray(t,4),s=_t63[0],i=_t63[1],u=_t63[2],l=_t63[3],c=wi(Va(e,u.shape),u,o);return n||r?!n&&r?(d=Mr(c,i,!1,!1),p=Mr(c,s,!0,!1)):n&&!r?(d=Mr(i,c,!1,!0),p=Mr(s,c,!1,!1)):(d=Mr(i,c,!0,!0),p=Mr(c,s,!0,!0)):(d=Mr(c,i,!1,!0),p=Mr(s,c,!0,!1)),null!=a?[d,p,Ii(l,c)]:[d,p]},N={a:x,b:v,bias:k,preluActivationWeights:w},T={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:i};return null==a?Wo((function(e,t,n){var r=Ln.runKernel("_FusedMatMul",N,T);return n([e,t,r]),{value:Va(r,y),gradFunc:I}}))(x,v):Wo((function(e,t,n,r){var a=Ln.runKernel("_FusedMatMul",N,T);return r([e,t,a,n]),{value:Va(a,y),gradFunc:I}}))(x,v,k)}}),Ri=Kn({cropAndResize_:function cropAndResize_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=Gn(e,"image","cropAndResize"),i=Gn(t,"boxes","cropAndResize","float32"),u=Gn(n,"boxInd","cropAndResize","int32"),l=i.shape[0];pt(4===s.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(s.rank,".")})),pt(2===i.rank&&4===i.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(l,",4] but had shape ").concat(i.shape,".")})),pt(1===u.rank&&u.shape[0]===l,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(l,"] but had shape ").concat(i.shape,".")})),pt(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),pt(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),pt("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var c={image:s,boxes:i,boxInd:u},d={method:a,extrapolationValue:o,cropSize:r};return Ln.runKernel("CropAndResize",c,d)}}),Ai=Kn({flipLeftRight_:function flipLeftRight_(e){var t=Gn(e,"image","flipLeftRight","float32");pt(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")}));var n={image:t};return Ln.runKernel("FlipLeftRight",n,{})}}),Fi=Kn({rotateWithOffset_:function rotateWithOffset_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Gn(e,"image","rotateWithOffset","float32");pt(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")}));var o={image:a},s={radians:t,fillValue:n,center:r};return Ln.runKernel("RotateWithOffset",o,s)}});function Oi(e,t,n,r,a,o){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==o&&(o=0);var s=e.shape[0];return n=Math.min(n,s),pt(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),pt(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),pt(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),pt(1===t.rank,(function(){return"scores must be a 1D tensor"})),pt(t.shape[0]===s,(function(){return"scores has incompatible shape with boxes. Expected ".concat(s,", but was ").concat(t.shape[0])})),pt(0<=o&&o<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(o,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:o}}var Mi=Kn({nonMaxSuppression_:function nonMaxSuppression_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,o=Gn(e,"boxes","nonMaxSuppression"),s=Gn(t,"scores","nonMaxSuppression"),i=Oi(o,s,n,r,a),u={maxOutputSize:n=i.maxOutputSize,iouThreshold:r=i.iouThreshold,scoreThreshold:a=i.scoreThreshold};return Ln.runKernel("NonMaxSuppressionV3",{boxes:o,scores:s},u)}});function Di(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,o=0,s=!1;r<a;){var _i12=n(t,e[o=r+(a-r>>>1)]);_i12>0?r=o+1:(a=o,s=!_i12)}return s?r:-r-1}(e,t,n||Pi)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Pi(e,t){return e>t?1:e<t?-1:0}function Li(e,t,n,r,a){return Wi(e,t,n,r,a,0)}function Bi(e,t,n,r,a,o){return Wi(e,t,n,r,a,0,!1,o,!0)}function zi(e,t,n,r,a,o){return Wi(e,t,n,r,a,o,!0)}function Wi(e,t,n,r,a,o){for(var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=[],_e70=0;_e70<t.length;_e70++)t[_e70]>a&&l.push({score:t[_e70],boxIndex:_e70,suppressBeginIndex:0});l.sort(Hi);for(var c=o>0?-.5/o:0,d=[],p=[];d.length<n&&l.length>0;){var _t64=l.pop(),_n30=_t64.score,_o21=_t64.boxIndex,_s15=_t64.suppressBeginIndex;if(_n30<a)break;for(var _i13=!1,_n31=d.length-1;_n31>=_s15;--_n31){var _s16=Vi(e,_o21,d[_n31]);if(_s16>=r){_i13=!0;break}if(_t64.score=_t64.score*Ui(r,c,_s16),_t64.score<=a)break}_t64.suppressBeginIndex=d.length,_i13||(_t64.score===_n30?(d.push(_o21),p.push(_t64.score)):_t64.score>a&&Di(l,_t64,Hi))}var f=d.length,h=n-f;i&&h>0&&(d.push.apply(d,_toConsumableArray(new Array(h).fill(0))),p.push.apply(p,_toConsumableArray(new Array(h).fill(0))));var m={selectedIndices:d};return s&&(m.selectedScores=p),u&&(m.validOutputs=f),m}function Vi(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),i=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),d=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),f=(i-o)*(u-s),h=(d-l)*(p-c);if(f<=0||h<=0)return 0;var m=Math.max(o,l),g=Math.max(s,c),b=Math.min(i,d),y=Math.min(u,p),x=Math.max(b-m,0)*Math.max(y-g,0);return x/(f+h-x)}function Ui(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Hi(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}var ji=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark((function _callee24(e,t,n){var r,a,o,s,i,u,l,c,_Li,d,_args24=arguments;return regeneratorRuntime.wrap((function _callee24$(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:return r=_args24.length>3&&void 0!==_args24[3]?_args24[3]:.5,a=_args24.length>4&&void 0!==_args24[4]?_args24[4]:Number.NEGATIVE_INFINITY,o=Gn(e,"boxes","nonMaxSuppressionAsync"),s=Gn(t,"scores","nonMaxSuppressionAsync"),i=Oi(o,s,n,r,a),n=i.maxOutputSize,r=i.iouThreshold,a=i.scoreThreshold,_context24.next=6,Promise.all([o.data(),s.data()]);case 6:return u=_context24.sent,l=u[0],c=u[1],_Li=Li(l,c,n,r,a),d=_Li.selectedIndices,_context24.abrupt("return",(o!==e&&o.dispose(),s!==t&&s.dispose(),ci(d,"int32")));case 12:case"end":return _context24.stop()}}),_callee24)})));return function ji(_x20,_x21,_x22){return _ref13.apply(this,arguments)}}(),Gi=Kn({nonMaxSuppressionWithScore_:function nonMaxSuppressionWithScore_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=Gn(e,"boxes","nonMaxSuppression"),i=Gn(t,"scores","nonMaxSuppression"),u=Oi(s,i,n,r,a,o),l={boxes:s,scores:i},c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},d=Ln.runKernel("NonMaxSuppressionV5",l,c);return{selectedIndices:d[0],selectedScores:d[1]}}}),qi=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark((function _callee25(e,t,n){var r,a,o,s,i,u,l,c,d,_zi,p,f,_args25=arguments;return regeneratorRuntime.wrap((function _callee25$(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:return r=_args25.length>3&&void 0!==_args25[3]?_args25[3]:.5,a=_args25.length>4&&void 0!==_args25[4]?_args25[4]:Number.NEGATIVE_INFINITY,o=_args25.length>5&&void 0!==_args25[5]?_args25[5]:0,s=Gn(e,"boxes","nonMaxSuppressionAsync"),i=Gn(t,"scores","nonMaxSuppressionAsync"),u=Oi(s,i,n,r,a,o),n=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,o=u.softNmsSigma,_context25.next=7,Promise.all([s.data(),i.data()]);case 7:return l=_context25.sent,c=l[0],d=l[1],_zi=zi(c,d,n,r,a,o),p=_zi.selectedIndices,f=_zi.selectedScores,_context25.abrupt("return",(s!==e&&s.dispose(),i!==t&&i.dispose(),{selectedIndices:ci(p,"int32"),selectedScores:ci(f)}));case 14:case"end":return _context25.stop()}}),_callee25)})));return function qi(_x23,_x24,_x25){return _ref14.apply(this,arguments)}}(),Ki=Kn({nonMaxSuppressionPadded_:function nonMaxSuppressionPadded_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=Gn(e,"boxes","nonMaxSuppression"),i=Gn(t,"scores","nonMaxSuppression"),u=Oi(s,i,n,r,a,null),l={boxes:s,scores:i},c={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},d=Ln.runKernel("NonMaxSuppressionV4",l,c);return{selectedIndices:d[0],validOutputs:d[1]}}}),Xi=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark((function _callee26(e,t,n){var r,a,o,s,i,u,l,c,d,_yield$Promise$all,_yield$Promise$all2,p,f,_Bi,h,m,_args26=arguments;return regeneratorRuntime.wrap((function _callee26$(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return r=_args26.length>3&&void 0!==_args26[3]?_args26[3]:.5,a=_args26.length>4&&void 0!==_args26[4]?_args26[4]:Number.NEGATIVE_INFINITY,o=_args26.length>5&&void 0!==_args26[5]&&_args26[5],s=Gn(e,"boxes","nonMaxSuppressionAsync"),i=Gn(t,"scores","nonMaxSuppressionAsync"),u=Oi(s,i,n,r,a,null),l=u.maxOutputSize,c=u.iouThreshold,d=u.scoreThreshold,_context26.next=11,Promise.all([s.data(),i.data()]);case 11:return _yield$Promise$all=_context26.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2),p=_yield$Promise$all2[0],f=_yield$Promise$all2[1],_Bi=Bi(p,f,l,c,d,o),h=_Bi.selectedIndices,m=_Bi.validOutputs,_context26.abrupt("return",(s!==e&&s.dispose(),i!==t&&i.dispose(),{selectedIndices:ci(h,"int32"),validOutputs:js(m,"int32")}));case 19:case"end":return _context26.stop()}}),_callee26)})));return function Xi(_x26,_x27,_x28){return _ref15.apply(this,arguments)}}(),Yi=Kn({resizeBilinear_:function resizeBilinear_(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gn(e,"images","resizeBilinear");pt(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),pt(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape ".concat(t,".")})),pt(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var o=a,s=!1;3===a.rank&&(s=!0,o=Va(a,[1,a.shape[0],a.shape[1],a.shape[2]]));var i={images:o},u={alignCorners:n,halfPixelCenters:r,size:t},l=Ln.runKernel("ResizeBilinear",i,u);return s?Va(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),Qi={flipLeftRight:Ai,resizeNearestNeighbor:Kn({resizeNearestNeighbor_:function resizeNearestNeighbor_(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gn(e,"images","resizeNearestNeighbor");pt(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),pt(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape ".concat(t,".")})),pt("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),pt(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var o=a,s=!1;3===a.rank&&(s=!0,o=Va(a,[1,a.shape[0],a.shape[1],a.shape[2]]));var i={images:o},u={alignCorners:n,halfPixelCenters:r,size:t},l=Ln.runKernel("ResizeNearestNeighbor",i,u);return s?Va(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),resizeBilinear:Yi,rotateWithOffset:Fi,cropAndResize:Ri,nonMaxSuppression:Mi,nonMaxSuppressionAsync:ji,nonMaxSuppressionWithScore:Gi,nonMaxSuppressionWithScoreAsync:qi,nonMaxSuppressionPadded:Ki,nonMaxSuppressionPaddedAsync:Xi,transform:Kn({transform_:function transform_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,s=Gn(e,"image","transform","float32"),i=Gn(t,"transforms","transform","float32");pt(4===s.rank,(function(){return"Error in transform: image must be rank 4,but got rank ".concat(s.rank,".")})),pt(2===i.rank&&(i.shape[0]===s.shape[0]||1===i.shape[0])&&8===i.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),pt(null==o||2===o.length,(function(){return"Error in transform: outputShape must be [height, width] or null, but got ".concat(o,".")}));var u={image:s,transforms:i},l={interpolation:n,fillMode:r,fillValue:a,outputShape:o};return Ln.runKernel("Transform",u,l)}})};function Zi(e,t){var n=e[0].length;e.forEach((function(e,t){pt(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),pt(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var _o22=0;_o22<n;_o22++)pt(_o22===t||e[_o22]===r[_o22],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function Ji(e,t){for(var n=e[0].slice(),_r37=1;_r37<e.length;_r37++)n[t]+=e[_r37][t];return n}function eu(e){return e<=30?e:Ft(e,Math.floor(Math.sqrt(e)))}function tu(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function nu(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var _n32=t.length,_r38=0;_r38<_n32;++_r38)a=a.concat([e[_r38+1]/t[_r38],t[_r38]]);a=a.concat(e.slice(_n32+1))}return a}function ru(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var _n33=t+1;_n33<e;++_n33)_n33<=2*t?(r.push(_n33),r.push(_n33-(t+1))):r.push(_n33)}else{for(var _n34=[],_a30=[],_r39=1;_r39<e;++_r39)_r39>=2*t+1||_r39%2==1?_a30.push(_r39):_n34.push(_r39);r.push.apply(r,_n34),r.push(0),r.push.apply(r,_a30)}return r}function au(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var _n35=1;_n35<e.length;++_n35)_n35<=t.length?r?a.push(t[_n35-1]*e[_n35]):a.push(e[_n35]/t[_n35-1]):a.push(e[_n35]);return a}function ou(e,t){for(var n=[0],_r40=0;_r40<t;++_r40)n.push(e[_r40][0]);return n}function su(e,t,n){for(var r=e.slice(0,1),_a31=0;_a31<n;++_a31)r.push(e[_a31+1]-t[_a31][0]-t[_a31][1]);return r}function iu(){var _console;jt().getBool("IS_TEST")||(_console=console).warn.apply(_console,arguments)}function uu(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),_r41=0;_r41<n.length;_r41+=2)n[_r41]=e[_r41/2],n[_r41+1]=t[_r41/2];return n}function lu(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),_r42=0;_r42<e.length;_r42+=2)t[_r42/2]=e[_r42],n[_r42/2]=e[_r42+1];return{real:t,imag:n}}function cu(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),_t65=0;_t65<e.length;_t65+=4)n[Math.floor(_t65/4)]=e[_t65],r[Math.floor(_t65/4)]=e[_t65+1];return{real:n,imag:r}}function du(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),_t66=2;_t66<e.length;_t66+=4)n[Math.floor(_t66/4)]=e[_t66],r[Math.floor(_t66/4)]=e[_t66+1];return{real:n,imag:r}}function pu(e,t){return{real:e[2*t],imag:e[2*t+1]}}function fu(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function hu(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),_a32=0;_a32<Math.ceil(e/2);_a32++){var _o23=(t?2:-2)*Math.PI*(_a32/e);n[_a32]=Math.cos(_o23),r[_a32]=Math.sin(_o23)}return{real:n,imag:r}}function mu(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function gu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)pt(e.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{pt(t.reduce((function(e,t){return-1===t&&(e+=1),e}),0)<=1,(function(){return"There should be only one negative value in split array."}));var _a33=t.indexOf(-1);if(-1!==_a33){var _r43=t.reduce((function(e,t){return t>0?e+t:e}));t[_a33]=e.shape[n]-_r43}pt(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function bu(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=Ft(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Ft(e,n+1);return n}function yu(e,t,n){for(var r=[],a=e.length,_o24=0;_o24<a;_o24++)_o24!==t?r.push(e[_o24]):r.push(n);return r}function xu(e,t,n,r){var a=t.shape.length,o=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>o)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(o,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var _n36=0;_n36<r;++_n36)if(e.shape[_n36]!==t.shape[_n36])throw new Error("x.shape[".concat(_n36,"]: ").concat(e.shape[_n36]," should be equal to indices.shape[").concat(_n36,"]: ").concat(t.shape[_n36],"."));for(var s=e.shape[n],i=[],u=1,l=1,c=1,_t67=0;_t67<r;++_t67)i.push(e.shape[_t67]),u*=e.shape[_t67];for(var _t68=r;_t68<n;_t68++)i.push(e.shape[_t68]),l*=e.shape[_t68];for(var _e71=r;_e71<a;_e71++)i.push(t.shape[_e71]);for(var _t69=n+1;_t69<o;_t69++)i.push(e.shape[_t69]),c*=e.shape[_t69];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:s,outputShape:i}}var vu=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:bu,computeOutShape:yu,collectGatherOpShapeInfo:xu});function ku(e){try{return e.map((function(e){return ln(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(e))}}function wu(e){return e.map((function(e){return un(e)}))}var Iu,Nu,Tu=Object.freeze({__proto__:null,slice_util:sa,segment_util:vu,fromUint8ToStringArray:ku,fromStringArrayToUint8:wu,upcastType:_n,axesAreInnerMostDims:Ko,combineLocations:Xo,computeOutAndReduceShapes:Yo,expandShapeToKeepDim:Qo,assertAxesAreInnerMostDims:Zo,getAxesPermutation:Jo,getUndoAxesPermutation:es,getInnerMostAxes:ts,getBroadcastDims:mo,getReductionAxes:go,assertAndGetBroadcastShape:bo,assertParamsConsistent:Zi,computeOutShape:Ji,computeDilation2DInfo:_a,computePool2DInfo:$a,computePool3DInfo:Ra,computeConv2DInfo:Aa,computeConv3DInfo:Fa,computeDefaultPad:Oa,tupleValuesAreOne:Ba,eitherStridesOrDilationsAreOne:za,convertConv2DDataFormat:Wa,getFusedDyActivation:wi,getFusedBiasGradient:Ii,applyActivation:Ni,shouldFuse:Ti,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:eu,getImageCenter:tu,getReshaped:nu,getPermuted:ru,getReshapedPermuted:au,getSliceBeginCoords:ou,getSliceSize:su,prepareAndValidate:zr,validateUpdateShape:Wr,validateInput:Vr,calculateShapes:Ur,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:iu,log:function log(){var _console2;jt().getBool("IS_TEST")||(_console2=console).log.apply(_console2,arguments)},mergeRealAndImagArrays:uu,splitRealAndImagArrays:lu,complexWithEvenIndex:cu,complexWithOddIndex:du,getComplexWithIndex:pu,assignToTypedArray:fu,exponents:hu,exponent:mu,prepareSplitSize:gu});!function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(Iu||(Iu={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(Nu||(Nu={}));var Cu={};function Eu(e){return Cu[e]}function Su(e,t,n,r,a){var o=t.inputParams[e];if(o&&void 0!==o.inputIndexStart){var _e72=o.inputIndexStart,_s17=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?_e72+1:o.inputIndexEnd;if("tensor"===o.type)return _u(t.inputNames[o.inputIndexStart],n,r,a);if("tensors"===o.type)return t.inputNames.slice(_e72,_s17).map((function(e){return _u(e,n,r,a)}));var _i14=_u(t.inputNames.slice(_e72)[0],n,r,a),_u8=_i14.dataSync();return"number"===o.type?_u8[0]:Dt(_i14.shape,_u8)}var s=t.attrParams[e];return s&&s.value}function _u(e,t,n,r){var _Au2=_slicedToArray(Au(e),2),a=_Au2[0],o=_Au2[1];if(null!=r){var _e73=r.getHashTableHandleByName(a);if(null!=_e73)return _e73}var s=n.currentContextIds.find((function(e){return!!t[Ru(a,e)]}));return void 0!==s?t[Ru(a,s)][o]:void 0}function $u(e,t){var _Au4=_slicedToArray(Au(e),2),n=_Au4[0],r=_Au4[1];return[Ru(n,t&&t.currentContextId),r]}function Ru(e,t){return t?"".concat(e,"-").concat(t):e}function Au(e){var t=e.split(":");return 1===t.length?[e,0]:[t[0],Number(t[t.length-1])]}function Fu(e,t,n){var r=Su("pad",e,t,n);if("explicit"===r){r=Su("explicitPaddings",e,t,n);for(var _a34=[[0,0],[0,0],[0,0],[0,0]],_e74=0;_e74<4;_e74++)_a34[_e74][0]=r[2*_e74],_a34[_e74][1]=r[2*_e74+1];return _a34}return r}function Ou(e){return e.kept?e:Sr(e)}var Mu=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Du=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Pu=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}]}),Lu=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]}),Bu=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),zu=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Wu=Object.freeze({__proto__:null,json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]}),Vu=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),Uu=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]}),Hu=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),ju=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Gu=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),qu=Object.freeze({__proto__:null,json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),Ku=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]}),Xu=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),Yu=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),Qu=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]}]}),Zu=function(){function Zu(){var _ref16;_classCallCheck(this,Zu);var e=(_ref16=[]).concat.apply(_ref16,_toConsumableArray([Mu,Du,Pu,Lu,Bu,zu,Wu,ju,Hu,Vu,Gu,qu,Ku,Xu,Yu,Qu,Uu].map((function(e){return e.json}))));this.opMappers=e.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return _createClass(Zu,null,[{key:"Instance",get:function get(){return this._instance||(this._instance=new this)}}]),_createClass(Zu,[{key:"transformGraph",value:function transformGraph(e){var _this21=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.node,r=[],a=[],o=[],s=n.reduce((function(e,t){return e[t.name]=_this21.mapNode(t),t.op.startsWith("Placeholder")?r.push(e[t.name]):"Const"===t.op?a.push(e[t.name]):null!=t.input&&0!==t.input.length||o.push(e[t.name]),e}),{}),i=[],u=[],l={},c={};null!=t&&(l=this.mapSignatureEntries(t.inputs),c=this.mapSignatureEntries(t.outputs));var d=Object.keys(s);d.forEach((function(e){var t=s[e];t.inputNames.forEach((function(e){var n=_slicedToArray($u(e),1)[0];t.inputs.push(s[n]),s[n].children.push(t)}))})),0===Object.keys(c).length?d.forEach((function(e){var t=s[e];0===t.children.length&&u.push(t)})):Object.keys(c).forEach((function(e){var t=_slicedToArray($u(e),1)[0],n=s[t];null!=n&&(n.signatureKey=c[e],u.push(n))})),Object.keys(l).length>0?Object.keys(l).forEach((function(e){var t=_slicedToArray($u(e),1)[0],n=s[t];n&&(n.signatureKey=l[e],i.push(n))})):i=r;var p={};null!=e.library&&null!=e.library.function&&(p=e.library.function.reduce((function(e,t){return e[t.signature.name]=_this21.mapFunction(t),e}),{}));var f={nodes:s,inputs:i,outputs:u,weights:a,placeholders:r,signature:t,functions:p};return o.length>0&&(f.initNodes=o),f}},{key:"mapSignatureEntries",value:function mapSignatureEntries(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function mapNode(e){var t=Eu(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.substr(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var a,r=n.type;switch(n.type){case"string":void 0===(a=el(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=el(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(a=cl(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=cl(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(a=nl(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(a=nl(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(a=ll(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=ll(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(a=tl(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=tl(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(a=pl(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=pl(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(a=ul(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=ul(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(a=dl(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=dl(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(a=ol(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=ol(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(a=sl(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=sl(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(a=al(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=al(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:a,type:r},t}),{})),n}},{key:"mapFunction",value:function mapFunction(e){var _this22=this,t=e.nodeDef,n=[],r={};null!=t&&(r=t.reduce((function(e,t){return e[t.name]=_this22.mapNode(t),"Const"===t.op&&n.push(e[t.name]),e}),{}));var a=[],o=[];e.signature.inputArg.forEach((function(e){var t=_slicedToArray($u(e.name),1)[0],n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:rl(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,a.push(n),r[t]=n})),Object.keys(r).forEach((function(e){var t=r[e];t.inputNames.forEach((function(e){var n=_slicedToArray($u(e),1)[0];t.inputs.push(r[n]),r[n].children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var _$u12=_slicedToArray($u(s[e.name]),2),t=_$u12[0],n=_$u12[1],a=r[t];null!=a&&(a.defaultOutput=n,o.push(a))}));var i=this.mapArgsToSignature(e);return{nodes:r,inputs:a,outputs:o,weights:n,placeholders:[],signature:i}}},{key:"mapArgsToSignature",value:function mapArgsToSignature(e){var _this23=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,t){return e[t.name]=_this23.mapArgToTensorInfo(t),e}),{}),outputs:e.signature.outputArg.reduce((function(t,n){return t[n.name]=_this23.mapArgToTensorInfo(n,e.ret),t}),{})}}},{key:"mapArgToTensorInfo",value:function mapArgToTensorInfo(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}]),Zu}();function Ju(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=jt().global;if(void 0!==t.atob)return t.atob(e);if(void 0!==Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function el(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?Ju(a.s,r):n}function tl(e,t,n){var r=e[t];return r?r.b:n}function nl(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function rl(e){switch("string"==typeof e&&(e=Iu[e]),e){case Iu.DT_FLOAT:return"float32";case Iu.DT_INT32:case Iu.DT_INT64:case Iu.DT_INT8:case Iu.DT_UINT8:return"int32";case Iu.DT_BOOL:return"bool";case Iu.DT_DOUBLE:return"float32";case Iu.DT_STRING:return"string";default:return null}}function al(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function ol(e,t,n){var r=e[t];return r&&r.type?rl(r.type):n}function sl(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return rl(e)})):n}function il(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function ul(e,t,n){var r=e[t];return r&&r.shape?il(r.shape):n}function ll(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function cl(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return Ju(e,r)})):n}function dl(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return il(e)})):n}function pl(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var fl=function(){function fl(e,t,n){var _this24=this;_classCallCheck(this,fl),this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map((function(e){return _this24.getInput(e)})),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce((function(e,t){return e[t]=_this24.getAttr(t),e}),{}))}return _createClass(fl,[{key:"getInput",value:function getInput(e){return _u(e,this.tensorMap,this.context)}},{key:"getAttr",value:function getAttr(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return _u(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return nl(this.node.rawAttrs,e,t);if(null!=n.s)return el(this.node.rawAttrs,e,t);if(null!=n.b)return tl(this.node.rawAttrs,e,t);if(null!=n.shape)return ul(this.node.rawAttrs,e,t);if(null!=n.type)return ol(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return ll(this.node.rawAttrs,e,t);if(null!=n.list.s)return cl(this.node.rawAttrs,e,t);if(null!=n.list.shape)return dl(this.node.rawAttrs,e,t);if(null!=n.list.b)return pl(this.node.rawAttrs,e,t);if(null!=n.list.type)return sl(this.node.rawAttrs,e,t)}return t}}]),fl}();function hl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!=typeof e&&"number"!=typeof t){pt(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var _r44=0;_r44<e.length;_r44++){var _a35=e[_r44],_o25=t[_r44];pt(_a35<0||_o25<0||_a35===_o25,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function ml(e){return"number"!=typeof e&&!e.some((function(e){return e<0}))}function gl(e,t,n){var r=bl(e,n),a=!ml(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=bl(e.shape,r)})),!ml(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function bl(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],_r45=0;_r45<e.length;++_r45){var _a36=e[_r45],_o26=t[_r45];if(_a36>=0&&_o26>=0&&_a36!==_o26)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[_r45]=_a36>=0?_a36:_o26}return n}var yl=function(){function yl(e,t,n,r,a,o,s){_classCallCheck(this,yl),this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=a,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=js(0),la(this.idTensor)}return _createClass(yl,[{key:"clearAndClose",value:function clearAndClose(e){this.tensors.forEach((function(t){null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function size(){return this.tensors.length}},{key:"read",value:function read(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function readMany(e){var _this25=this;return e.map((function(e){return _this25.read(e)}))}},{key:"write",value:function write(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),hl(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,la(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function writeMany(e,t){var _this26=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,n){return _this26.write(e,t[n])}))}},{key:"gather",value:function gather(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var _t70=0;_t70<this.size();_t70++)e.push(_t70)}if(0===e.length)return Qn([],[0].concat(this.elementShape));var n=this.readMany(e);return hl(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),si(n,0)}},{key:"concat",value:function concat(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return Qn([],[0].concat(this.elementShape));for(var t=[],_e75=0;_e75<this.size();_e75++)t.push(_e75);var n=this.readMany(t);return hl(this.elementShape,n[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(n[0].shape,")")),ja(n,0)}},{key:"scatter",value:function scatter(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,_toConsumableArray(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,mi(t,0))}},{key:"split",value:function split(e,t){var _this27=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var n=0,r=e.map((function(e){return n+=e}));if(n!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(n,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var a=0===n?0:t.size/n,o=[];ua((function(){t=Va(t,[1,n,a]);for(var _n37=0;_n37<e.length;++_n37){var _s18=[0,0===_n37?0:r[_n37-1],0],_i15=[1,e[_n37],a];o[_n37]=Va(qa(t,_s18,_i15),_this27.elementShape)}return o}));for(var s=[],_t71=0;_t71<e.length;_t71++)s[_t71]=_t71;this.writeMany(s,o)}},{key:"id",get:function get(){return this.idTensor.id}},{key:"closed",get:function get(){return this.closed_}}]),yl}(),xl=function(){function xl(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;_classCallCheck(this,xl),this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach((function(e){if(n!==e.dtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(e.dtype));hl(t,e.shape,"TensorList shape mismatch: "),la(e)})),this.idTensor=js(0),this.maxNumElements=r,la(this.idTensor)}return _createClass(xl,[{key:"copy",value:function copy(){return new xl(_toConsumableArray(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function clearAndClose(e){this.tensors.forEach((function(t){null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function size(){return this.tensors.length}},{key:"stack",value:function stack(e,t){var _this28=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==n&&this.tensors.length!==n)throw new Error("Operation expected a list with ".concat(n," elements but got a list with ").concat(this.tensors.length," elements."));hl(e,this.elementShape,"TensorList shape mismatch: ");var r=gl(this.elementShape,this.tensors,e);return ua((function(){var e=_this28.tensors.map((function(e){return Va(e,r)}));return si(e,0)}))}},{key:"popBack",value:function popBack(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=gl(this.elementShape,this.tensors,e),r=this.tensors.pop();return hl(r.shape,e,"TensorList shape mismatch: "),Va(r,n)}},{key:"pushBack",value:function pushBack(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(hl(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");la(e),this.tensors.push(e)}},{key:"resize",value:function resize(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));this.tensors.length=e}},{key:"getItem",value:function getItem(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));hl(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=gl(this.elementShape,this.tensors,t);return Va(this.tensors[e],r)}},{key:"setItem",value:function setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));hl(this.elementShape,t.shape,"TensorList shape mismatch: "),la(t),this.tensors[e]=t}},{key:"gather",value:function gather(e,t,n){var _this29=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));hl(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var r=gl(this.elementShape,this.tensors,n);return 0===e.length?Qn([],[0].concat(r)):ua((function(){var t=e.map((function(e){return Va(_this29.tensors[e],r)}));return si(t,0)}))}},{key:"concat",value:function concat(e,t){var _this30=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));hl(this.elementShape,t,"TensorList shape mismatch: ");var n=gl(this.elementShape,this.tensors,t);return 0===this.size()?Qn([],[0].concat(n)):ua((function(){var e=_this30.tensors.map((function(e){return Va(e,n)}));return ja(e,0)}))}},{key:"id",get:function get(){return this.idTensor.id}}]),xl}(),vl=function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark((function _callee28(e,t,n){var _r46,_a37,_o27,_s19,_ret,_r47,_a38,_r48,_r49,_a39,_r50,_r51,_r52,_a40,_o28,_s20,_i16,_u9,l,c,_r53,_a41,_o29,_s21,_r54,_a42,_r55,_a43,_o30,_r56,_a44,_o31,_s22,_r57,_a45,_o32,_r58,_a46,_o33,_s23,_r59,_r60,_a47,_r61,_a48,_o34,_s24,_r62,_a49,_o35,_s25,_r63,_a50,_r64,_a51,_o36,_s26,_r65,_a52,_o37,_s27,_r66,_a53,_o38,_s28,_r67,_r68,_a54,_o39,_s29,_r69,_a55,_o40,_r70,_a56,_o41,_r71,_a57,_o42;return regeneratorRuntime.wrap((function _callee28$(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:_context29.t0=e.op,_context29.next="If"===_context29.t0||"StatelessIf"===_context29.t0?3:"While"===_context29.t0||"StatelessWhile"===_context29.t0?12:"LoopCond"===_context29.t0?16:"Switch"===_context29.t0?17:"Merge"===_context29.t0?28:"Enter"===_context29.t0?32:"Exit"===_context29.t0?34:"NextIteration"===_context29.t0?36:"TensorArrayV3"===_context29.t0?38:"TensorArrayWriteV3"===_context29.t0?40:"TensorArrayReadV3"===_context29.t0?42:"TensorArrayGatherV3"===_context29.t0?44:"TensorArrayScatterV3"===_context29.t0?46:"TensorArrayConcatV3"===_context29.t0?48:"TensorArraySplitV3"===_context29.t0?50:"TensorArraySizeV3"===_context29.t0?52:"TensorArrayCloseV3"===_context29.t0?54:"TensorListSetItem"===_context29.t0?56:"TensorListGetItem"===_context29.t0?58:"TensorListScatterV2"===_context29.t0||"TensorListScatter"===_context29.t0?60:"TensorListReserve"===_context29.t0||"EmptyTensorList"===_context29.t0?62:"TensorListGather"===_context29.t0?66:"TensorListStack"===_context29.t0?68:"TensorListFromTensor"===_context29.t0?70:"TensorListConcat"===_context29.t0?72:"TensorListPushBack"===_context29.t0?74:"TensorListPopBack"===_context29.t0?76:"TensorListSplit"===_context29.t0?78:80;break;case 3:return _r46=Su("thenBranch",e,t,n),_a37=Su("elseBranch",e,t,n),_o27=Su("cond",e,t,n),_s19=Su("args",e,t,n),_context29.next=6,_o27.data();case 6:if(!_context29.sent[0]){_context29.next=10;break}_context29.t1=n.functionMap[_r46].executeFunctionAsync(_s19,n.tensorArrayMap,n.tensorListMap),_context29.next=11;break;case 10:_context29.t1=n.functionMap[_a37].executeFunctionAsync(_s19,n.tensorArrayMap,n.tensorListMap);case 11:return _context29.abrupt("return",_context29.t1);case 12:return _context29.delegateYield(regeneratorRuntime.mark((function _callee27(){var r,a,o,s,i,u,l,_loop6;return regeneratorRuntime.wrap((function _callee27$(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:return r=Su("body",e,t,n),a=Su("cond",e,t,n),o=Su("args",e,t,n),_context28.next=5,n.functionMap[a].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap);case 5:return s=_context28.sent,i=o.map((function(e){return e.id})),_context28.next=9,s[0].data();case 9:u=_context28.sent,s.forEach((function(e){e.kept||-1!==i.indexOf(e.id)||e.dispose()})),l=o,_loop6=regeneratorRuntime.mark((function _loop6(){var e,t,o;return regeneratorRuntime.wrap((function _loop6$(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return e=l,_context27.next=3,n.functionMap[r].executeFunctionAsync(l,n.tensorArrayMap,n.tensorListMap);case 3:return l=_context27.sent,t=l.map((function(e){return e.id})),e.forEach((function(e){e.kept||-1!==i.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()})),_context27.next=8,n.functionMap[a].executeFunctionAsync(l,n.tensorArrayMap,n.tensorListMap);case 8:return o=_context27.sent,_context27.next=11,o[0].data();case 11:u=_context27.sent,o.forEach((function(e){e.kept||-1!==i.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()}));case 13:case"end":return _context27.stop()}}),_loop6)}));case 13:if(!u[0]){_context28.next=17;break}return _context28.delegateYield(_loop6(),"t0",15);case 15:_context28.next=13;break;case 17:return _context28.abrupt("return",{v:l});case 18:case"end":return _context28.stop()}}),_callee27)}))(),"t2",13);case 13:if("object"!==_typeof(_ret=_context29.t2)){_context29.next=16;break}return _context29.abrupt("return",_ret.v);case 16:return _context29.abrupt("return",[Ou(Su("pred",e,t,n))]);case 17:return _r47=Su("pred",e,t,n),(_a38=Su("data",e,t,n)).kept||(_a38=Ou(_a38)),_context29.next=22,_r47.data();case 22:if(!_context29.sent[0]){_context29.next=26;break}_context29.t3=[void 0,_a38],_context29.next=27;break;case 26:_context29.t3=[_a38,void 0];case 27:return _context29.abrupt("return",_context29.t3);case 28:if(!(_r48=e.inputNames.find((function(e){return void 0!==_u(e,t,n)})))){_context29.next=31;break}return _context29.abrupt("return",[Ou(_u(_r48,t,n))]);case 31:return _context29.abrupt("return");case 32:return _r49=Su("frameName",e,t,n),_a39=Su("tensor",e,t,n),_context29.abrupt("return",(n.enterFrame(_r49),[Ou(_a39)]));case 34:return _r50=Su("tensor",e,t,n),_context29.abrupt("return",(n.exitFrame(),[Ou(_r50)]));case 36:return _r51=Su("tensor",e,t,n),_context29.abrupt("return",(n.nextIteration(),[Ou(_r51)]));case 38:return _r52=Su("size",e,t,n),_a40=Su("dtype",e,t,n),_o28=Su("elementShape",e,t,n),_s20=Su("dynamicSize",e,t,n),_i16=Su("clearAfterRead",e,t,n),_u9=Su("identicalElementShapes",e,t,n),l=Su("name",e,t,n),c=new yl(l,_a40,_r52,_o28,_u9,_s20,_i16),_context29.abrupt("return",(n.addTensorArray(c),[c.idTensor,js(1)]));case 40:return _r53=Su("tensorArrayId",e,t,n),_a41=Su("index",e,t,n),_o29=Su("tensor",e,t,n),_s21=n.getTensorArray(_r53.id),_context29.abrupt("return",(_s21.write(_a41,_o29),[_s21.idTensor]));case 42:return _r54=Su("tensorArrayId",e,t,n),_a42=Su("index",e,t,n),_context29.abrupt("return",[n.getTensorArray(_r54.id).read(_a42)]);case 44:return _r55=Su("tensorArrayId",e,t,n),_a43=Su("indices",e,t,n),_o30=Su("dtype",e,t,n),_context29.abrupt("return",[n.getTensorArray(_r55.id).gather(_a43,_o30)]);case 46:return _r56=Su("tensorArrayId",e,t,n),_a44=Su("indices",e,t,n),_o31=Su("tensor",e,t,n),_s22=n.getTensorArray(_r56.id),_context29.abrupt("return",(_s22.scatter(_a44,_o31),[_s22.idTensor]));case 48:return _r57=Su("tensorArrayId",e,t,n),_a45=n.getTensorArray(_r57.id),_o32=Su("dtype",e,t,n),_context29.abrupt("return",[_a45.concat(_o32)]);case 50:return _r58=Su("tensorArrayId",e,t,n),_a46=Su("tensor",e,t,n),_o33=Su("lengths",e,t,n),_s23=n.getTensorArray(_r58.id),_context29.abrupt("return",(_s23.split(_o33,_a46),[_s23.idTensor]));case 52:return _r59=Su("tensorArrayId",e,t,n),_context29.abrupt("return",[js(n.getTensorArray(_r59.id).size(),"int32")]);case 54:return _r60=Su("tensorArrayId",e,t,n),_a47=n.getTensorArray(_r60.id),_context29.abrupt("return",(_a47.clearAndClose(),[_a47.idTensor]));case 56:return _r61=Su("tensorListId",e,t,n),_a48=Su("index",e,t,n),_o34=Su("tensor",e,t,n),_s24=n.getTensorList(_r61.id),_context29.abrupt("return",(_s24.setItem(_a48,_o34),[_s24.idTensor]));case 58:return _r62=Su("tensorListId",e,t,n),_a49=Su("index",e,t,n),_o35=Su("elementShape",e,t,n),_s25=Su("elementDType",e,t,n),_context29.abrupt("return",[n.getTensorList(_r62.id).getItem(_a49,_o35,_s25)]);case 60:return _r63=Su("indices",e,t,n),_a50=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,_toConsumableArray(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var o=new xl([],n,e.dtype,r),s=mi(e,0);return t.forEach((function(e,t){o.setItem(e,s[t])})),o}(Su("tensor",e,t,n),_r63,Su("elementShape",e,t,n),Su("numElements",e,t,n)),_context29.abrupt("return",(n.addTensorList(_a50),[_a50.idTensor]));case 62:return _r64=Su("elementShape",e,t,n),_a51=Su("elementDType",e,t,n),_o36="TensorListReserve"===e.op?"numElements":"maxNumElements",_s26=function(e,t,n){return new xl([],e,t,n)}(_r64,_a51,Su(_o36,e,t,n)),_context29.abrupt("return",(n.addTensorList(_s26),[_s26.idTensor]));case 66:return _r65=Su("tensorListId",e,t,n),_a52=Su("indices",e,t,n),_o37=Su("elementShape",e,t,n),_s27=Su("elementDType",e,t,n),_context29.abrupt("return",[n.getTensorList(_r65.id).gather(_a52,_s27,_o37)]);case 68:return _r66=Su("tensorListId",e,t,n),_a53=Su("elementShape",e,t,n),_o38=Su("elementDType",e,t,n),_s28=Su("numElements",e,t,n),_context29.abrupt("return",[n.getTensorList(_r66.id).stack(_a53,_o38,_s28)]);case 70:return _r67=function(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));hl(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=mi(e);return new xl(a,t,r)}(Su("tensor",e,t,n),Su("elementShape",e,t,n),Su("elementDType",e,t,n)),_context29.abrupt("return",(n.addTensorList(_r67),[_r67.idTensor]));case 72:return _r68=Su("tensorListId",e,t,n),_a54=n.getTensorList(_r68.id),_o39=Su("dtype",e,t,n),_s29=Su("elementShape",e,t,n),_context29.abrupt("return",[_a54.concat(_o39,_s29)]);case 74:return _r69=Su("tensorListId",e,t,n),_a55=Su("tensor",e,t,n),_o40=n.getTensorList(_r69.id),_context29.abrupt("return",(_o40.pushBack(_a55),[_o40.idTensor]));case 76:return _r70=Su("tensorListId",e,t,n),_a56=Su("elementShape",e,t,n),_o41=Su("elementDType",e,t,n),_context29.abrupt("return",[n.getTensorList(_r70.id).popBack(_a56,_o41)]);case 78:return _r71=Su("tensor",e,t,n),_a57=Su("elementShape",e,t,n),_o42=function(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var o=bl(e.shape.slice(1),n),s=0===r?0:e.size/r,i=ua((function(){var n=[];e=Va(e,[1,r,s]);for(var _r72=0;_r72<t.length;++_r72){var _i17=[0,0===_r72?0:a[_r72-1],0],_u10=[1,t[_r72],s];n[_r72]=Va(qa(e,_i17,_u10),o)}return e.dispose(),n})),u=new xl([],n,e.dtype,t.length),_e76=0;_e76<i.length;_e76++)u.setItem(_e76,i[_e76]);return u}(_r71,Su("lengths",e,t,n),_a57),_context29.abrupt("return",(n.addTensorList(_o42),[_o42.idTensor]));case 80:throw TypeError("Node type ".concat(e.op," is not implemented"));case 81:case"end":return _context29.stop()}}),_callee28)})));return function vl(_x29,_x30,_x31){return _ref17.apply(this,arguments)}}();function kl(e,t,n){var _Su2=_slicedToArray(Su("fusedOps",e,t,n),2),r=_Su2[0],a=_Su2[1],o="biasadd"===r,s="prelu"===a,i="fusedbatchnorm"===r,u=Su("numArgs",e,t,n);if(o){if(s&&2!==u)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!s&&1!==u)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(i)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");var l=Su("strides",e,t,n),c=Fu(e,t,n),d=Su("dataFormat",e,t,n).toUpperCase(),p=Su("dilations",e,t,n),_Su4=_slicedToArray(Su("args",e,t,n),2);return{stride:l,pad:c,dataFormat:d,dilations:p,biasArg:_Su4[0],preluArg:_Su4[1],activationFunc:a,leakyreluAlpha:Su("leakyreluAlpha",e,t,n)}}function wl(e,t,n){return{boxes:Su("boxes",e,t,n),scores:Su("scores",e,t,n),maxOutputSize:Su("maxOutputSize",e,t,n),iouThreshold:Su("iouThreshold",e,t,n),scoreThreshold:Su("scoreThreshold",e,t,n),softNmsSigma:Su("softNmsSigma",e,t,n)}}var Il=function(){function Il(e,t){_classCallCheck(this,Il),this.keyDType=e,this.valueDType=t,this.handle=js(0),this.tensorMap=new Map,la(this.handle)}var _find,_import2;return _createClass(Il,[{key:"clearAndClose",value:function clearAndClose(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function size(){return this.tensorMap.size}},{key:"tensorSize",value:function tensorSize(){return js(this.size(),"int32")}},{key:"import",value:(_import2=_asyncToGenerator(regeneratorRuntime.mark((function _callee29(e,t){var n,_this31=this;return regeneratorRuntime.wrap((function _callee29$(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:return this.checkKeyAndValueTensor(e,t),_context30.next=3,e.data();case 3:return n=_context30.sent,_context30.abrupt("return",(this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),ua((function(){var e=mi(t),r=n.length,a=e.length;pt(r===a,(function(){return"The number of elements doesn't match, keys has ".concat(r," elements, the values has ").concat(a," elements.")}));for(var _t72=0;_t72<r;_t72++){var _r73=n[_t72],_a58=e[_t72];la(_a58),_this31.tensorMap.set(_r73,_a58)}return _this31.handle}))));case 5:case"end":return _context30.stop()}}),_callee29,this)}))),function _import(_x32,_x33){return _import2.apply(this,arguments)})},{key:"find",value:(_find=_asyncToGenerator(regeneratorRuntime.mark((function _callee30(e,t){var n,_this32=this;return regeneratorRuntime.wrap((function _callee30$(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:return this.checkKeyAndValueTensor(e,t),_context31.next=3,e.data();case 3:return n=_context31.sent,_context31.abrupt("return",ua((function(){for(var e=[],_r74=0;_r74<n.length;_r74++){var _a59=n[_r74],_o43=_this32.findWithDefault(_a59,t);e.push(_o43)}return si(e)})));case 5:case"end":return _context31.stop()}}),_callee30,this)}))),function find(_x34,_x35){return _find.apply(this,arguments)})},{key:"findWithDefault",value:function findWithDefault(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ").concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ").concat(t.dtype))}},{key:"id",get:function get(){return this.handle.id}}]),Il}();function Nl(e,t,n,r){var a=function(e,t,n){switch(e.category){case"arithmetic":return ua((function(){return function(e,t,n){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[pa(Su("a",e,t,n),Su("b",e,t,n))];case"AddN":return[xa(Su("tensors",e,t,n))];case"FloorMod":case"Mod":return[fs(Su("a",e,t,n),Su("b",e,t,n))];case"Mul":return[ma(Su("a",e,t,n),Su("b",e,t,n))];case"RealDiv":case"Div":return[ha(Su("a",e,t,n),Su("b",e,t,n))];case"DivNoNan":return[ko(Su("a",e,t,n),Su("b",e,t,n))];case"FloorDiv":return[fa(Su("a",e,t,n),Su("b",e,t,n))];case"Sub":return[jo(Su("a",e,t,n),Su("b",e,t,n))];case"Minimum":return[ds(Su("a",e,t,n),Su("b",e,t,n))];case"Maximum":return[us(Su("a",e,t,n),Su("b",e,t,n))];case"Pow":return[ws(Su("a",e,t,n),Su("b",e,t,n))];case"SquaredDifference":return[ai(Su("a",e,t,n),Su("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"basic_math":return ua((function(){return function(e,t,n){switch(e.op){case"Abs":case"ComplexAbs":return[ga(Su("x",e,t,n))];case"Acos":return[ba(Su("x",e,t,n))];case"Acosh":return[ya(Su("x",e,t,n))];case"Asin":return[Na(Su("x",e,t,n))];case"Asinh":return[Ta(Su("x",e,t,n))];case"Atan":return[Ca(Su("x",e,t,n))];case"Atan2":return[Ea(Su("x",e,t,n),Su("y",e,t,n))];case"Atanh":return[Sa(Su("x",e,t,n))];case"Ceil":return[Ja(Su("x",e,t,n))];case"Complex":return[Xn(Su("real",e,t,n),Su("imag",e,t,n))];case"Cos":return[io(Su("x",e,t,n))];case"Cosh":return[uo(Su("x",e,t,n))];case"Elu":return[wo(Su("x",e,t,n))];case"Erf":return[Io(Su("x",e,t,n))];case"Exp":return[No(Su("x",e,t,n))];case"Expm1":return[Co(Su("x",e,t,n))];case"Floor":return[_o(Su("x",e,t,n))];case"Log":return[Bo(Su("x",e,t,n))];case"Log1p":return[zo(Su("x",e,t,n))];case"Imag":return[Fo(Su("x",e,t,n))];case"Neg":return[Vo(Su("x",e,t,n))];case"Reciprocal":return[Bs(Su("x",e,t,n))];case"Real":return[Ls(Su("x",e,t,n))];case"Relu":return[zs(Su("x",e,t,n))];case"Round":return[Us(Su("x",e,t,n))];case"Selu":return[Gs(Su("x",e,t,n))];case"Sigmoid":return[Ga(Su("x",e,t,n))];case"Sin":return[Xs(Su("x",e,t,n))];case"Sign":return[Ks(Su("x",e,t,n))];case"Sinh":return[Ys(Su("x",e,t,n))];case"Softplus":return[Uo(Su("x",e,t,n))];case"Sqrt":return[ri(Su("x",e,t,n))];case"Square":return[hs(Su("x",e,t,n))];case"Tanh":return[Ka(Su("x",e,t,n))];case"Tan":return[li(Su("x",e,t,n))];case"ClipByValue":return[eo(Su("x",e,t,n),Su("clipValueMin",e,t,n),Su("clipValueMax",e,t,n))];case"Relu6":return[Ws(Su("x",e,t,n))];case"Rsqrt":return[Hs(_u(e.inputNames[0],t,n))];case"Prod":return[Ns(Su("x",e,t,n),Su("axes",e,t,n))];case"LeakyRelu":return[Oo(Su("x",e,t,n),Su("alpha",e,t,n))];case"Prelu":return[Is(Su("x",e,t,n),Su("alpha",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"control":return vl(e,t,n);case"convolution":return ua((function(){return function(e,t,n){switch(e.op){case"Conv1D":var _r75=Su("stride",e,t,n),_a61=Su("pad",e,t,n),_o44=Su("dataFormat",e,t,n).toUpperCase(),_s30=Su("dilation",e,t,n);return[ro(Su("x",e,t,n),Su("filter",e,t,n),_r75,_a61,_o44,_s30)];case"Conv2D":var _r76=Su("strides",e,t,n),_a62=Fu(e,t,n),_o45=Su("dataFormat",e,t,n).toUpperCase(),_s31=Su("dilations",e,t,n);return[no(Su("x",e,t,n),Su("filter",e,t,n),[_r76[1],_r76[2]],_a62,_o45,[_s31[1],_s31[2]])];case"_FusedConv2D":var _kl=kl(e,t,n),_r77=_kl.stride,_a63=_kl.pad,_o46=_kl.dataFormat,_s32=_kl.dilations,_i18=_kl.biasArg,_u11=_kl.preluArg,l=_kl.activationFunc,c=_kl.leakyreluAlpha;return[Ci({x:Su("x",e,t,n),filter:Su("filter",e,t,n),strides:[_r77[1],_r77[2]],pad:_a63,dataFormat:_o46,dilations:[_s32[1],_s32[2]],bias:_i18,activation:l,preluActivationWeights:_u11,leakyreluAlpha:c})];case"FusedDepthwiseConv2dNative":var _kl2=kl(e,t,n),_r78=_kl2.stride,_a64=_kl2.pad,_o47=_kl2.dataFormat,_s33=_kl2.dilations,_i19=_kl2.biasArg,_u12=_kl2.preluArg,_l3=_kl2.activationFunc,_c3=_kl2.leakyreluAlpha;return[_i({x:Su("x",e,t,n),filter:Su("filter",e,t,n),strides:[_r78[1],_r78[2]],pad:_a64,dataFormat:_o47,dilations:[_s33[1],_s33[2]],bias:_i19,activation:_l3,preluActivationWeights:_u12,leakyreluAlpha:_c3})];case"Conv2DBackpropInput":case"Conv2dTranspose":var _r79=Su("outputShape",e,t,n),_a65=Su("strides",e,t,n),_o48=Fu(e,t,n);return[oo(Su("x",e,t,n),Su("filter",e,t,n),_r79,[_a65[1],_a65[2]],_o48)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var _r80=Su("strides",e,t,n),_a66=Fu(e,t,n),_o49=Su("dilations",e,t,n),_s34=Su("dataFormat",e,t,n).toUpperCase();return[fo(Su("input",e,t,n),Su("filter",e,t,n),[_r80[1],_r80[2]],_a66,_s34,[_o49[1],_o49[2]])];case"Conv3D":var _r81=Su("strides",e,t,n),_a67=Su("pad",e,t,n),_o50=Su("dataFormat",e,t,n).toUpperCase(),_s35=Su("dilations",e,t,n);return[so(Su("x",e,t,n),Su("filter",e,t,n),[_r81[1],_r81[2],_r81[3]],_a67,_o50,[_s35[1],_s35[2],_s35[3]])];case"AvgPool":var _r82=Su("strides",e,t,n),_a68=Su("pad",e,t,n),_o51=Su("kernelSize",e,t,n);return[Ua(Su("x",e,t,n),[_o51[1],_o51[2]],[_r82[1],_r82[2]],_a68)];case"MaxPool":var _r83=Su("strides",e,t,n),_a69=Su("pad",e,t,n),_o52=Su("kernelSize",e,t,n);return[os(Su("x",e,t,n),[_o52[1],_o52[2]],[_r83[1],_r83[2]],_a69)];case"MaxPoolWithArgmax":var _r84=Su("strides",e,t,n),_a70=Su("pad",e,t,n),_o53=Su("kernelSize",e,t,n),_s36=Su("includeBatchInIndex",e,t,n),_is=is(Su("x",e,t,n),[_o53[1],_o53[2]],[_r84[1],_r84[2]],_a70,_s36);return[_is.result,_is.indexes];case"AvgPool3D":var _r85=Su("strides",e,t,n),_a71=Su("pad",e,t,n),_o54=Su("kernelSize",e,t,n);return[Ha(Su("x",e,t,n),[_o54[1],_o54[2],_o54[3]],[_r85[1],_r85[2],_r85[3]],_a71)];case"MaxPool3D":var _r86=Su("strides",e,t,n),_a72=Su("pad",e,t,n),_o55=Su("kernelSize",e,t,n);return[ss(Su("x",e,t,n),[_o55[1],_o55[2],_o55[3]],[_r86[1],_r86[2],_r86[3]],_a72)];case"Dilation2D":var _r87=Su("strides",e,t,n),_a73=Su("pad",e,t,n),_o56=Su("dilations",e,t,n),_s37=_r87[1],_i21=_r87[2],_u14=_o56[1],_l4=_o56[2];return[ho(Su("x",e,t,n),Su("filter",e,t,n),[_s37,_i21],_a73,[_u14,_l4],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"creation":return ua((function(){return function(e,t,n){switch(e.op){case"Fill":var _r88=Su("shape",e,t,n),_a74=Su("dtype",e,t,n);return[So(_r88,Su("value",e,t,n),_a74)];case"LinSpace":return[Po(Su("start",e,t,n),Su("stop",e,t,n),Su("num",e,t,n))];case"Multinomial":var _r89=Su("logits",e,t,n),_a75=Su("numSamples",e,t,n),_o57=Su("seed",e,t,n);return[ms(_r89,_a75,_o57)];case"OneHot":var _r90=Su("indices",e,t,n),_a76=Su("depth",e,t,n),_o58=Su("onValue",e,t,n),_s38=Su("offValue",e,t,n);return[Dr(_r90,_a76,_o58,_s38)];case"Ones":return[ys(Su("shape",e,t,n),Su("dtype",e,t,n))];case"OnesLike":return[xs(Su("x",e,t,n))];case"RandomUniform":return[Ds(Su("shape",e,t,n),Su("minval",e,t,n),Su("maxval",e,t,n),Su("dtype",e,t,n))];case"Range":return[Ps(Su("start",e,t,n),Su("stop",e,t,n),Su("step",e,t,n),Su("dtype",e,t,n))];case"TruncatedNormal":var _r91=Su("shape",e,t,n),_a77=Su("mean",e,t,n),_o59=Su("stdDev",e,t,n),_s39=Su("seed",e,t,n);return[fi(_r91,_a77,_o59,Su("dtype",e,t,n),_s39)];case"Zeros":return[bs(Su("shape",e,t,n),Su("dtype",e,t,n))];case"ZerosLike":return[vo(Su("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"dynamic":return(_ref18=_asyncToGenerator(regeneratorRuntime.mark((function _callee31(e,t,n){var _wl,_r92,_a78,_o60,_s40,_i22,_u15,l,_wl2,_r93,_a79,_o61,_s41,_i23,_u16,_l5,_wl3,_r94,_a80,_o62,_s42,_i24,_r95,_a81;return regeneratorRuntime.wrap((function _callee31$(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:_context32.t0=e.op,_context32.next="NonMaxSuppressionV5"===_context32.t0?3:"NonMaxSuppressionV4"===_context32.t0?14:"NonMaxSuppressionV3"===_context32.t0||"NonMaxSuppressionV2"===_context32.t0?25:"Where"===_context32.t0?30:"ListDiff"===_context32.t0?36:37;break;case 3:return _wl=wl(e,t,n),_r92=_wl.boxes,_a78=_wl.scores,_o60=_wl.maxOutputSize,_s40=_wl.iouThreshold,_i22=_wl.scoreThreshold,_u15=_wl.softNmsSigma,_context32.next=12,Qi.nonMaxSuppressionWithScoreAsync(_r92,_a78,_o60,_s40,_i22,_u15);case 12:return l=_context32.sent,_context32.abrupt("return",[l.selectedIndices,l.selectedScores]);case 14:return _wl2=wl(e,t,n),_r93=_wl2.boxes,_a79=_wl2.scores,_o61=_wl2.maxOutputSize,_s41=_wl2.iouThreshold,_i23=_wl2.scoreThreshold,_u16=Su("padToMaxOutputSize",e,t,n),_context32.next=23,Qi.nonMaxSuppressionPaddedAsync(_r93,_a79,_o61,_s41,_i23,_u16);case 23:return _l5=_context32.sent,_context32.abrupt("return",[_l5.selectedIndices,_l5.validOutputs]);case 25:return _wl3=wl(e,t,n),_r94=_wl3.boxes,_a80=_wl3.scores,_o62=_wl3.maxOutputSize,_s42=_wl3.iouThreshold,_i24=_wl3.scoreThreshold,_context32.next=28,Qi.nonMaxSuppressionAsync(_r94,_a80,_o62,_s42,_i24);case 28:return _context32.t1=_context32.sent,_context32.abrupt("return",[_context32.t1]);case 30:return _r95=Er(Su("condition",e,t,n),"bool"),_context32.next=33,bi(_r95);case 33:return _context32.t2=_context32.sent,_a81=[_context32.t2],_context32.abrupt("return",(_r95.dispose(),_a81));case 36:return _context32.abrupt("return",qs(Su("x",e,t,n),Su("y",e,t,n)));case 37:throw TypeError("Node type ".concat(e.op," is not implemented"));case 38:case"end":return _context32.stop()}}),_callee31)}))),function(_x36,_x37,_x38){return _ref18.apply(this,arguments)})(e,t,n);case"evaluation":return ua((function(){return function(e,t,n){switch(e.op){case"TopKV2":var _r96=Su("x",e,t,n),_a82=Su("k",e,t,n),_o63=Su("sorted",e,t,n),_s43=pi(_r96,_a82,_o63);return[_s43.values,_s43.indices];case"Unique":var _r97=Su("x",e,t,n),_a83=hi(_r97);return[_a83.values,_a83.indices];case"UniqueV2":var _r98=Su("x",e,t,n),_a84=Su("axis",e,t,n),_o64=hi(_r98,_a84);return[_o64.values,_o64.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"image":return ua((function(){return function(e,t,n){switch(e.op){case"ResizeBilinear":var _r99=Su("images",e,t,n),_a85=Su("size",e,t,n),_o65=Su("alignCorners",e,t,n),_s44=Su("halfPixelCenters",e,t,n);return[Qi.resizeBilinear(_r99,[_a85[0],_a85[1]],_o65,_s44)];case"ResizeNearestNeighbor":var _r100=Su("images",e,t,n),_a86=Su("size",e,t,n),_o66=Su("alignCorners",e,t,n),_s45=Su("halfPixelCenters",e,t,n);return[Qi.resizeNearestNeighbor(_r100,[_a86[0],_a86[1]],_o66,_s45)];case"CropAndResize":var _r101=Su("image",e,t,n),_a87=Su("boxes",e,t,n),_o67=Su("boxInd",e,t,n),_s46=Su("cropSize",e,t,n),_i25=Su("method",e,t,n),_u17=Su("extrapolationValue",e,t,n);return[Qi.cropAndResize(_r101,_a87,_o67,_s46,_i25,_u17)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"graph":return ua((function(){return function(e,t,n){switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var _r102=Su("default",e,t,n);return[_u(e.name,t,n)||_r102];case"Placeholder":return[_u(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[Ou(Su("x",e,t,n))];case"IdentityN":return Su("x",e,t,n).map((function(e){return Ou(e)}));case"Snapshot":return[Ou(Su("x",e,t,n))];case"Shape":return[ci(Su("x",e,t,n).shape,"int32")];case"ShapeN":return Su("x",e,t,n).map((function(e){return ci(e.shape)}));case"Size":return[js(Su("x",e,t,n).size,"int32")];case"Rank":return[js(Su("x",e,t,n).rank,"int32")];case"NoOp":return[js(1)];case"Print":var _a88=Su("x",e,t,n),_o68=Su("data",e,t,n),_s47=Su("message",e,t,n),_i26=Su("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(_s47);for(var _e77=0;_e77<_o68.length;_e77++)console.log(Array.prototype.slice.call(_o68[_e77].dataSync()).slice(0,_i26));return[_a88];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"logical":return ua((function(){return function(e,t,n){switch(e.op){case"Equal":return[yo(Su("a",e,t,n),Su("b",e,t,n))];case"NotEqual":return[gs(Su("a",e,t,n),Su("b",e,t,n))];case"Greater":return[Ro(Su("a",e,t,n),Su("b",e,t,n))];case"GreaterEqual":return[Ao(Su("a",e,t,n),Su("b",e,t,n))];case"Less":return[Mo(Su("a",e,t,n),Su("b",e,t,n))];case"LessEqual":return[Do(Su("a",e,t,n),Su("b",e,t,n))];case"LogicalAnd":return[ns(Su("a",e,t,n),Su("b",e,t,n))];case"LogicalNot":return[rs(Su("a",e,t,n))];case"LogicalOr":return[as(Su("a",e,t,n),Su("b",e,t,n))];case"Select":case"SelectV2":return[xo(Su("condition",e,t,n),Su("a",e,t,n),Su("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"matrices":return ua((function(){return function(e,t,n){switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Mr(Su("a",e,t,n),Su("b",e,t,n),Su("transposeA",e,t,n),Su("transposeB",e,t,n))];case"Transpose":return[Pr(Su("x",e,t,n),Su("perm",e,t,n))];case"_FusedMatMul":var _Su6=_slicedToArray(Su("fusedOps",e,t,n),2),_r103=_Su6[0],_a89=_Su6[1],_o69="biasadd"===_r103,_s48="prelu"===_a89,_i27=Su("numArgs",e,t,n),_u18=Su("leakyreluAlpha",e,t,n);if(_o69){if(_s48&&2!==_i27)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!_s48&&1!==_i27)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var _Su8=_slicedToArray(Su("args",e,t,n),2),l=_Su8[0],c=_Su8[1];return[$i({a:Su("a",e,t,n),b:Su("b",e,t,n),transposeA:Su("transposeA",e,t,n),transposeB:Su("transposeB",e,t,n),bias:l,activation:_a89,preluActivationWeights:c,leakyreluAlpha:_u18})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"normalization":return ua((function(){return function(e,t,n){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Ya(Su("x",e,t,n),Su("mean",e,t,n),Su("variance",e,t,n),Su("offset",e,t,n),Su("scale",e,t,n),Su("epsilon",e,t,n))];case"LRN":return[Lo(Su("x",e,t,n),Su("radius",e,t,n),Su("bias",e,t,n),Su("alpha",e,t,n),Su("beta",e,t,n))];case"Softmax":return[Qs(Su("x",e,t,n))];case"LogSoftmax":return[qo(Su("x",e,t,n))];case"SparseToDense":return[xi(Su("sparseIndices",e,t,n),Su("outputShape",e,t,n),Su("sparseValues",e,t,n),Su("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"reduction":return ua((function(){return function(e,t,n){switch(e.op){case"Max":var _r105=Su("axis",e,t,n),_a91=Su("keepDims",e,t,n);return[Ho(Su("x",e,t,n),_r105,_a91)];case"Mean":var _r106=Su("axis",e,t,n),_a92=Su("keepDims",e,t,n);return[ls(Su("x",e,t,n),_r106,_a92)];case"Min":var _r107=Su("axis",e,t,n),_a93=Su("keepDims",e,t,n);return[cs(Su("x",e,t,n),_r107,_a93)];case"Sum":var _r108=Su("axis",e,t,n),_a94=Su("keepDims",e,t,n);return[Go(Su("x",e,t,n),_r108,_a94)];case"All":var _r109=Su("axis",e,t,n),_a95=Su("keepDims",e,t,n);return[va(Su("x",e,t,n),_r109,_a95)];case"Any":var _r110=Su("axis",e,t,n),_a96=Su("keepDims",e,t,n);return[ka(Su("x",e,t,n),_r110,_a96)];case"ArgMax":var _r111=Su("axis",e,t,n);return[wa(Su("x",e,t,n),_r111)];case"ArgMin":var _r112=Su("axis",e,t,n);return[Ia(Su("x",e,t,n),_r112)];case"Prod":var _r113=Su("axis",e,t,n),_a97=Su("keepDims",e,t,n);return[Ns(Su("x",e,t,n),_r113,_a97)];case"Cumsum":var _r114=Su("axis",e,t,n),_a98=Su("exclusive",e,t,n),_o71=Su("reverse",e,t,n);return[lo(Su("x",e,t,n),_r114,_a98,_o71)];case"Bincount":var _r104=Su("x",e,t,n),_a90=Su("weights",e,t,n),_o70=Su("size",e,t,n);return[Qa(_r104,_a90,_o70)];case"DenseBincount":var _r115=Su("x",e,t,n),_a99=Su("weights",e,t,n),_o72=Su("size",e,t,n),_s49=Su("binaryOutput",e,t,n);return[co(_r115,_a99,_o72,_s49)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"slice_join":return ua((function(){return function(e,t,n){switch(e.op){case"ConcatV2":case"Concat":var _r116=Su("n",e,t,n),_a100=Su("axis",e,t,n),_o73=Su("tensors",e,t,n);return _o73=_o73.slice(0,_r116),[ja(_o73,_a100)];case"Gather":var _r117=Su("x",e,t,n),_a101=Su("indices",e,t,n);return[$o(_r117,Er(_a101,"int32"),0)];case"GatherV2":var _r118=Su("axis",e,t,n),_a102=Su("batchDims",e,t,n),_o74=Su("x",e,t,n),_s50=Su("indices",e,t,n);return[$o(_o74,Er(_s50,"int32"),_r118,_a102)];case"Reverse":for(var _r119=Su("dims",e,t,n),_a103=[],_e78=0;_e78<_r119.length;_e78++)_r119[_e78]&&_a103.push(_e78);var _o75=Su("x",e,t,n);return[Vs(_o75,_a103)];case"ReverseV2":var _r120=Su("axis",e,t,n),_a104=Su("x",e,t,n);return[Vs(_a104,_r120)];case"Slice":var _r121=Su("begin",e,t,n),_a105=Su("size",e,t,n);return[qa(Su("x",e,t,n),_r121,_a105)];case"StridedSlice":var _r122=Su("begin",e,t,n),_a106=Su("end",e,t,n),_o76=Su("strides",e,t,n),_s51=Su("beginMask",e,t,n),_i28=Su("endMask",e,t,n),_u19=Su("ellipsisMask",e,t,n),l=Su("newAxisMask",e,t,n),c=Su("shrinkAxisMask",e,t,n),_d5=Su("x",e,t,n);return[ui(_d5,_r122,_a106,_o76,_s51,_i28,_u19,l,c)];case"Pack":return ua((function(){var r=Su("axis",e,t,n),a=Su("tensors",e,t,n),o=a[0].shape,s=oi(a[0]).shape,i=a.map((function(e){var t=bt(e.shape,o);if(!t&&!bt(oi(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:Va(e,o)}));return[si(i,r)]}));case"Unpack":var _r123=Su("axis",e,t,n),_a107=Su("tensor",e,t,n);return mi(_a107,_r123);case"Tile":var _r124=Su("reps",e,t,n);return[Eo(Su("x",e,t,n),_r124)];case"Split":case"SplitV":var _r125=Su("axis",e,t,n),_a108=Su("numOrSizeSplits",e,t,n),_o77=Su("x",e,t,n);return ti(_o77,_a108,_r125);case"ScatterNd":var _r126=Su("indices",e,t,n),_a109=Su("values",e,t,n),_o78=Su("shape",e,t,n);return[yi(_r126,_a109,_o78)];case"GatherNd":var _r127=Su("x",e,t,n),_a110=Su("indices",e,t,n);return[vi(_r127,_a110)];case"SparseToDense":var _r128=Su("sparseIndices",e,t,n),_a111=Su("outputShape",e,t,n),_o79=Su("sparseValues",e,t,n),_s52=Su("defaultValue",e,t,n);return[xi(_r128,_o79,_a111,_o79.dtype===_s52.dtype?_s52:Er(_s52,_o79.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"spectral":return ua((function(){return function(e,t,n){switch(e.op){case"FFT":return[Zs(Su("x",e,t,n))];case"IFFT":return[Js(Su("x",e,t,n))];case"RFFT":return[ni(Su("x",e,t,n))];case"IRFFT":return[ei(Su("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"transformation":return ua((function(){return function(e,t,n){switch(e.op){case"Cast":return[Er(Su("x",e,t,n),Su("dtype",e,t,n))];case"ExpandDims":var _r129=Su("axis",e,t,n);return[To(Su("x",e,t,n),_r129)];case"Squeeze":var _r130=Su("axis",e,t,n);return[oi(Su("x",e,t,n),_r130)];case"Reshape":return[Va(Su("x",e,t,n),Su("shape",e,t,n))];case"MirrorPad":return[ps(Su("x",e,t,n),Su("padding",e,t,n),Su("mode",e,t,n))];case"PadV2":case"Pad":return[vs(Su("x",e,t,n),Su("padding",e,t,n),Su("constantValue",e,t,n))];case"SpaceToBatchND":var _r131=Su("blockShape",e,t,n),_a112=Su("paddings",e,t,n);return[ks(Su("x",e,t,n),_r131,_a112)];case"BatchToSpaceND":var _r132=Su("blockShape",e,t,n),_a113=Su("crops",e,t,n);return[Xa(Su("x",e,t,n),_r132,_a113)];case"DepthToSpace":var _r133=Su("blockSize",e,t,n),_a114=Su("dataFormat",e,t,n).toUpperCase();return[po(Su("x",e,t,n),_r133,_a114)];case"BroadcastTo":return[Za(Su("x",e,t,n),Su("shape",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"hash_table":return(_ref19=_asyncToGenerator(regeneratorRuntime.mark((function _callee32(e,t,n,r){var _a115,_o80,_s53,_a116,_o81,_s54,_i29,_a117,_o82,_s55,_i30,_a118;return regeneratorRuntime.wrap((function _callee32$(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:_context33.t0=e.op,_context33.next="HashTable"===_context33.t0||"HashTableV2"===_context33.t0?3:"LookupTableImport"===_context33.t0||"LookupTableImportV2"===_context33.t0?5:"LookupTableFind"===_context33.t0||"LookupTableFindV2"===_context33.t0?10:"LookupTableSize"===_context33.t0||"LookupTableSizeV2"===_context33.t0?15:17;break;case 3:return _a115=Su("keyDType",e,t,n),_o80=Su("valueDType",e,t,n),_s53=new Il(_a115,_o80),_context33.abrupt("return",(r.addHashTable(e.name,_s53),[_s53.handle]));case 5:return _a116=Su("tableHandle",e,t,n,r),_o81=Su("keys",e,t,n),_s54=Su("values",e,t,n),_i29=r.getHashTableById(_a116.id),_context33.next=8,_i29.import(_o81,_s54);case 8:return _context33.t1=_context33.sent,_context33.abrupt("return",[_context33.t1]);case 10:return _a117=Su("tableHandle",e,t,n,r),_o82=Su("keys",e,t,n),_s55=Su("defaultValue",e,t,n),_i30=r.getHashTableById(_a117.id),_context33.next=13,_i30.find(_o82,_s55);case 13:return _context33.t2=_context33.sent,_context33.abrupt("return",[_context33.t2]);case 15:return _a118=Su("tableHandle",e,t,n,r),_context33.abrupt("return",[r.getHashTableById(_a118.id).tensorSize()]);case 17:throw TypeError("Node type ".concat(e.op," is not implemented"));case 18:case"end":return _context33.stop()}}),_callee32)}))),function(_x39,_x40,_x41,_x42){return _ref19.apply(this,arguments)})(e,t,n,r);case"custom":var _a60=Eu(e.op);if(_a60&&_a60.customExecutor)return _a60.customExecutor(new fl(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}var _ref19,_ref18}(e,t,n);return Ut(a)?a.then((function(e){return[].concat(e)})):[].concat(a)}var Tl=function(){function Tl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck(this,Tl),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return _createClass(Tl,[{key:"newFrame",value:function newFrame(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"generateCurrentContextIds",value:function generateCurrentContextIds(){for(var e=[],t=0;t<this.contexts.length-1;t++){var _n38=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(_n38))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function contextIdforContexts(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var _e79=Object.assign({},this.contexts[this.contexts.length-1]);_e79.iterationId+=1,_e79.id=this.lastId,this.contexts.splice(-1,1,_e79),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function getWeight(e){return this.weightMap[e]}},{key:"addTensorArray",value:function addTensorArray(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function getTensorArray(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function addTensorList(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function getTensorList(e){return this.tensorListMap[e]}},{key:"dispose",value:function dispose(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var _t73 in this.tensorListMap)this.tensorListMap[_t73].clearAndClose(e)}},{key:"currentContext",set:function set(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},get:function get(){return this.contexts}},{key:"currentContextId",get:function get(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function get(){return this._currentContextIds}}]),Tl}();function Cl(e,t,n,r){var a=new Set,o=[],s=null,i=null,u=new Set,l=Object.keys(e).map((function(e){return Au(e)[0]})),c=[];null!=r&&(c=r.map((function(e){return Au(e.name)[0]})));for(var d=_toConsumableArray(t);d.length>0;){var _e80=d.pop();($l(_e80)||Rl(_e80)||Al(_e80))&&null==s&&(i=(s=_e80).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(_e80.name),null==n[_e80.name]&&-1===l.indexOf(_e80.name)&&-1===c.indexOf(_e80.name)&&(0!==_e80.inputs.length?_e80.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),d.push(e))})):o.push(_e80.name))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:o,dynamicNode:s,syncInputs:i}}var El=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],Sl=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],_l=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function $l(e){return El.indexOf(e.op)>=0}function Rl(e){return Sl.indexOf(e.op)>=0}function Al(e){return _l.indexOf(e.op)>=0}var Fl=function(){function Fl(e,t){var _this33=this;_classCallCheck(this,Fl),this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,null!=e.functions&&Object.keys(e.functions).forEach((function(t){_this33._functionExecutorMap[t]=new Fl(e.functions[t],_this33)}))}var _executeWithControlFlow,_executeFunctionAsync,_executeAsync3,_executeAsync2;return _createClass(Fl,[{key:"getCompilationKey",value:function getCompilationKey(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function compile(e,t){var n=Cl(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,o=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(o,"]"));if(r.length>0){var _n39=t.map((function(e){return e.name})),_a119=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(_n39,"] from the provided inputs [").concat(_a119,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,o=[],s=Object.keys(a).map((function(e){return Au(e)[0]})).map((function(t){return e.nodes[t]})),i=e.initNodes;s.forEach((function(e){r.has(e.name)&&o.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&o.push(e)})),null!=i&&i.forEach((function(e){r.has(e.name)&&o.push(e)}));for(var u=new Set,l=[];o.length>0;){var _e81=o.pop();u.add(_e81.name),t[_e81.name]||l.push(_e81),_e81.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&o.push(e)}))}return l}(this.graph,this.weightMap,n)}},{key:"execute",value:function execute(e,t){var _this34=this;e=this.mapInputs(e);var n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var r=n.map((function(e){return _this34.graph.nodes[Au(e)[0]]})),a=t.map((function(e){return Au(e)[0]})),o=a.map((function(e){return _this34.graph.nodes[e]}));0===o.length&&(o=this._outputs);var s=this.getCompilationKey(r,o),i=this.compiledMap.get(s);null==i&&(i=this.compile(e,o),this.compiledMap.set(s,i));var u={},l={};return ua((function(){var n=new Tl(_this34.weightMap,u,l,_this34.functionExecutorMap),r=Object.assign({},_this34.weightMap);Object.keys(e).forEach((function(t){var _Au6=_slicedToArray(Au(t),2),n=_Au6[0],o=[];o[_Au6[1]]=e[t],r[n]=o}));for(var o=_this34.getFrozenTensorIds(r),s={},_e82=0;_e82<i.length;_e82++){var _t74=i[_e82];if(!r[_t74.name]){var _e83=Nl(_t74,r,n,_this34._resourceManager);if(Ut(_e83))throw new Error("The execution of the op '".concat(_t74.op,"' returned a promise. Please use model.executeAsync() instead."));r[_t74.name]=_e83,_this34.checkTensorForDisposal(_t74.name,_t74,r,n,o,a,s)}}return null==_this34.parent&&n.dispose(o),t.map((function(e){return _u(e,r,n)}))}))}},{key:"getFrozenTensorIds",value:function getFrozenTensorIds(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function checkTensorForDisposal(e,t,n,r,a,o,s){"control"!==t.category&&-1===o.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(s[e.id]=(s[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var _t75=function(e,t,n){return t[Ru(e,n.currentContextId)]}(e.name,n,r);null!=_t75&&_t75.forEach((function(e){if(e&&!a.has(e.id)){var _t76=s[e.id];1===_t76?(e.dispose(),delete s[e.id]):null!=_t76&&s[e.id]--}}))}})))}},{key:"executeAsync",value:(_executeAsync2=_asyncToGenerator(regeneratorRuntime.mark((function _callee33(e,t){return regeneratorRuntime.wrap((function _callee33$(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:return _context34.abrupt("return",this._executeAsync(e,t));case 1:case"end":return _context34.stop()}}),_callee33,this)}))),function executeAsync(_x43,_x44){return _executeAsync2.apply(this,arguments)})},{key:"_executeAsync",value:(_executeAsync3=_asyncToGenerator(regeneratorRuntime.mark((function _callee34(e,t){var n,r,a,o,s,i,u,l,c,_args35=arguments;return regeneratorRuntime.wrap((function _callee34$(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:return n=_args35.length>2&&void 0!==_args35[2]&&_args35[2],r=_args35.length>3&&void 0!==_args35[3]?_args35[3]:{},a=_args35.length>4&&void 0!==_args35[4]?_args35[4]:{},n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t)),o=new Tl(this.weightMap,r,a,this.functionExecutorMap),_context35.next=7,this.executeWithControlFlow(e,o,t,n);case 7:return s=_context35.sent,i=t.map((function(e){return _u(e,s,o)})),u=i.map((function(e){return e.id})),l=Object.keys(e).map((function(t){return e[t].id})),c=new Set([].concat(_toConsumableArray(u),_toConsumableArray(l),_toConsumableArray(this.weightIds))),_context35.abrupt("return",(Object.keys(s).forEach((function(e){s[e].forEach((function(e){!e||e.isDisposed||c.has(e.id)||e.dispose()}))})),null==this.parent&&o.dispose(c),i));case 13:case"end":return _context35.stop()}}),_callee34,this)}))),function _executeAsync(_x45,_x46){return _executeAsync3.apply(this,arguments)})},{key:"executeFunctionAsync",value:(_executeFunctionAsync=_asyncToGenerator(regeneratorRuntime.mark((function _callee35(e,t,n){var r,_this35=this;return regeneratorRuntime.wrap((function _callee35$(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:return r=e.reduce((function(e,t,n){return e[_this35.inputs[n].name]=t,e}),{}),_context36.abrupt("return",this._executeAsync(r,this.outputNodes,!0,t,n));case 2:case"end":return _context36.stop()}}),_callee35,this)}))),function executeFunctionAsync(_x47,_x48,_x49){return _executeFunctionAsync.apply(this,arguments)})},{key:"executeWithControlFlow",value:(_executeWithControlFlow=_asyncToGenerator(regeneratorRuntime.mark((function _callee36(e,t,n,r){var a,o,s,i,_Cl,u,l,c,d,p,f,h,m,g,_e84,b,_e85,_this36=this;return regeneratorRuntime.wrap((function _callee36$(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:a=Object.keys(e),o=a.map((function(e){return _this36.graph.nodes[Au(e)[0]]})),s=n.map((function(e){return Au(e)[0]})),0===(i=s.map((function(e){return _this36.graph.nodes[e]}))).length&&(i=this._outputs),_Cl=Cl(e,i,this.weightMap,this._initNodes),u=_Cl.usedNodes,l=_Cl.missingInputs,c=_Cl.dynamicNode,d=_Cl.syncInputs,p=[].concat(_toConsumableArray(o),_toConsumableArray(this.graph.weights),_toConsumableArray(this._initNodes||[])).map((function(e){return{node:e,contexts:t.currentContext}})),f=Object.assign({},this.weightMap),Object.keys(e).forEach((function(t){var _Au8=_slicedToArray(Au(t),2),n=_Au8[0],a=[];a[_Au8[1]]=e[t],f[n]=a})),h={},m=this.getFrozenTensorIds(f),g={};case 6:if(!(p.length>0)){_context37.next=12;break}return _e84=this.processStack(o,p,t,f,g,m,s,h,u),_context37.next=10,Promise.all(_e84);case 10:_context37.next=6;break;case 12:if(null!=c||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((b=i.filter((function(e){return!$l(e)&&!_u(e.name,f,t)})).map((function(e){return e.name}))).length>0)){_context37.next=17;break}throw _e85="",null!=c&&(_e85="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(b,"] from the provided inputs [").concat(a,"]. Consider providing the following inputs: [").concat(l,"]. ").concat(_e85));case 17:return _context37.abrupt("return",f);case 18:case"end":return _context37.stop()}}),_callee36,this)}))),function executeWithControlFlow(_x50,_x51,_x52,_x53){return _executeWithControlFlow.apply(this,arguments)})},{key:"processStack",value:function processStack(e,t,n,r,a,o,s,i,u){for(var _this37=this,l=[],_loop7=function _loop7(){var _$u14,e=t.pop();n.currentContext=e.contexts;var c="";if("Enter"===e.node.op&&Su("isConstant",e.node,r,n)&&(_$u14=_slicedToArray($u(e.node.name,n),1),c=_$u14[0]),null==r[e.node.name]){var _$u16,_d6=Nl(e.node,r,n,_this37._resourceManager);c||(_$u16=_slicedToArray($u(e.node.name,n),1),c=_$u16[0]);var _p4=n.currentContext;Ut(_d6)?l.push(_d6.then((function(l){return r[c]=l,n.currentContext=_p4,_this37.checkTensorForDisposal(c,e.node,r,n,o,s,i),_this37.processChildNodes(e.node,t,n,r,a,u),l}))):(r[c]=_d6,_this37.checkTensorForDisposal(c,e.node,r,n,o,s,i),_this37.processChildNodes(e.node,t,n,r,a,u))}else _this37.processChildNodes(e.node,t,n,r,a,u)};t.length>0;)_loop7();return l}},{key:"processChildNodes",value:function processChildNodes(e,t,n,r,a,o){e.children.forEach((function(e){var s=_slicedToArray($u(e.name,n),1)[0];!a[s]&&o.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!_u(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!_u(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function dispose(){var _this38=this;Object.keys(this.weightMap).forEach((function(e){return _this38.weightMap[e].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function checkInputShapeAndType(e){var _this39=this;Object.keys(e).forEach((function(t){var n=e[t],r=_slicedToArray(Au(t),1)[0],a=_this39.graph.nodes[r];if(a.attrParams.shape&&a.attrParams.shape.value){var _e86=a.attrParams.shape.value;pt(_e86.length===n.shape.length&&n.shape.every((function(t,n){return-1===_e86[n]||_e86[n]===t})),(function(){return"The shape of dict['".concat(a.name,"'] provided in model.execute(dict) must be [").concat(_e86,"], but was [").concat(n.shape,"]")}))}a.attrParams.dtype&&a.attrParams.dtype.value&&pt(n.dtype===a.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(a.name,"'] provided in model.execute(dict) must be ").concat(a.attrParams.dtype.value,", but was ").concat(n.dtype)}))}))}},{key:"mapInputs",value:function mapInputs(e){var t={};for(var _n40 in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[_n40]?t[this._signature.inputs[_n40].name]=e[_n40]:t[_n40]=e[_n40];return t}},{key:"checkInputs",value:function checkInputs(e){var _this40=this,t=Object.keys(e).filter((function(e){var t=_slicedToArray(Au(e),1)[0];return null==_this40.graph.nodes[t]}));if(t.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(t,"] that are not part of graph"))}},{key:"mapOutputs",value:function mapOutputs(e){var _this41=this;return e.map((function(e){return null!=_this41._signature&&null!=_this41._signature.outputs&&null!=_this41._signature.outputs[e]?_this41._signature.outputs[e].name:e}),{})}},{key:"checkOutputs",value:function checkOutputs(e){var _this42=this;e.forEach((function(e){var t=_slicedToArray(Au(e),1)[0];if(!_this42.graph.nodes[t])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}},{key:"weightIds",get:function get(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function get(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function get(){return this.parent?this.parent.weightMap:this._weightMap},set:function set(e){var _ref20,t=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(_ref20=[]).concat.apply(_ref20,_toConsumableArray(t)),this._weightMap=e}},{key:"resourceManager",set:function set(e){this._resourceManager=e}},{key:"inputs",get:function get(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function get(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function get(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function get(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function get(){var _this43=this;return Object.keys(this._functions).reduce((function(e,t){return e[t]=_this43._functions[t].signature,e}),{})}}]),Fl}(),Ol=function(){function Ol(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,Ol),this.hashTableNameToHandle=e,this.hashTableMap=t}return _createClass(Ol,[{key:"addHashTable",value:function addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function getHashTableById(e){return this.hashTableMap[e]}},{key:"dispose",value:function dispose(){for(var _e87 in this.hashTableMap)this.hashTableMap[_e87].clearAndClose(),delete this.hashTableMap[_e87];for(var _e88 in this.hashTableNameToHandle)this.hashTableNameToHandle[_e88].dispose(),delete this.hashTableNameToHandle[_e88]}}]),Ol}(),Ml=function(){function Ml(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,Ml),this.modelUrl=e,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={}),this.resourceManager=new Ol}var _executeAsync4,_save4,_load4;return _createClass(Ml,[{key:"findIOHandler",value:function findIOHandler(){var t,n,e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=Or(e,this.loadOptions);else{var _r134=(t=e,n=this.loadOptions,ar.getLoadHandlers(t,n));if(0===_r134.length)_r134.push(Or(e,this.loadOptions));else if(_r134.length>1)throw new Error("Found more than one (".concat(_r134.length,") load handlers for URL '").concat([e],"'"));this.handler=_r134[0]}}},{key:"load",value:(_load4=_asyncToGenerator(regeneratorRuntime.mark((function _callee37(){var e;return regeneratorRuntime.wrap((function _callee37$(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:if(this.findIOHandler(),null!=this.handler.load){_context38.next=2;break}throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return _context38.next=4,this.handler.load();case 4:return e=_context38.sent,_context38.abrupt("return",this.loadSync(e));case 6:case"end":return _context38.stop()}}),_callee37,this)}))),function load(){return _load4.apply(this,arguments)})},{key:"loadSync",value:function loadSync(e){this.artifacts=e;var n,t=this.artifacts.modelTopology;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var r=function(e,t){var r,_step8,n={},a=0,_iterator8=_createForOfIteratorHelper(t);try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var _o83=_step8.value,_t77=_o83.name,_s56=_o83.dtype,_i31=_o83.shape,_u20=gt(_i31),l=void 0;if("quantization"in _o83){var _n41=_o83.quantization;if("uint8"===_n41.dtype||"uint16"===_n41.dtype){if(!("min"in _n41)||!("scale"in _n41))throw new Error("Weight ".concat(_o83.name," with quantization ").concat(_n41.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==_n41.dtype)throw new Error("Weight ".concat(_o83.name," has unknown quantization dtype ").concat(_n41.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==_s56)throw new Error("Weight ".concat(_o83.name," is quantized with ").concat(_n41.dtype," which only supports weights of type float32 not ").concat(_s56,"."))}var _i32=Zn[_n41.dtype],c=e.slice(a,a+_u20*_i32),_d7="uint8"===_n41.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===_s56)if("uint8"===_n41.dtype||"uint16"===_n41.dtype){l=new Float32Array(_d7.length);for(var _e89=0;_e89<_d7.length;_e89++){var _t78=_d7[_e89];l[_e89]=_t78*_n41.scale+_n41.min}}else{if("float16"!==_n41.dtype)throw new Error("Unsupported quantization type ".concat(_n41.dtype," for weight type float32."));void 0===r&&(r=rr()),l=r(_d7)}else{if("int32"!==_s56)throw new Error("Unsupported dtype in weight '".concat(_t77,"': ").concat(_s56));if("uint8"!==_n41.dtype&&"uint16"!==_n41.dtype)throw new Error("Unsupported quantization type ".concat(_n41.dtype," for weight type int32."));l=new Int32Array(_d7.length);for(var _e90=0;_e90<_d7.length;_e90++){var _t79=_d7[_e90];l[_e90]=Math.round(_t79*_n41.scale+_n41.min)}}a+=_u20*_i32}else if("string"===_s56){var _t80=gt(_o83.shape);l=[];for(var _n42=0;_n42<_t80;_n42++){var _t81=new Uint32Array(e.slice(a,a+4))[0];a+=4;var _n43=new Uint8Array(e.slice(a,a+_t81));l.push(_n43),a+=_t81}}else{var _r135=Zn[_s56],_o84=e.slice(a,a+_u20*_r135);if("float32"===_s56)l=new Float32Array(_o84);else if("int32"===_s56)l=new Int32Array(_o84);else if("bool"===_s56)l=new Uint8Array(_o84);else{if("complex64"!==_s56)throw new Error("Unsupported dtype in weight '".concat(_t77,"': ").concat(_s56));l=new Float32Array(_o84);for(var _e91=new Float32Array(l.length/2),_r136=new Float32Array(l.length/2),_t82=0;_t82<_e91.length;_t82++)_e91[_t82]=l[2*_t82],_r136[_t82]=l[2*_t82+1];var _a120=Qn(_e91,_i31,"float32"),_s57=Qn(_r136,_i31,"float32");n[_t77]=Xn(_a120,_s57),_a120.dispose(),_s57.dispose()}a+=_u20*_r135}"complex64"!==_s56&&(n[_t77]=Qn(l,_i31,_s56))}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}return n}(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new Fl(Zu.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var _t83=Zu.Instance.transformGraph(e.modelInitializer);this.initializer=new Fl(_t83),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"save",value:(_save4=_asyncToGenerator(regeneratorRuntime.mark((function _callee38(e,t){var _t84,n;return regeneratorRuntime.wrap((function _callee38$(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:if("string"!=typeof e){_context39.next=7;break}if(n=e,0!==(_t84=ar.getSaveHandlers(n)).length){_context39.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));case 4:if(!(_t84.length>1)){_context39.next=6;break}throw new Error("Found more than one (".concat(_t84.length,") save handlers for URL '").concat(e,"'"));case 6:e=_t84[0];case 7:if(null!=e.save){_context39.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return _context39.abrupt("return",e.save(this.artifacts));case 10:case"end":return _context39.stop()}}),_callee38,this)}))),function save(_x54,_x55){return _save4.apply(this,arguments)})},{key:"predict",value:function predict(e,t){return this.execute(e,this.outputNodes)}},{key:"normalizeInputs",value:function normalizeInputs(e){if(!(e instanceof kn||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has ".concat(this.inputNodes.length," placeholders, while there are ").concat(e.length," input tensors."));return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})}},{key:"normalizeOutputs",value:function normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function execute(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:(_executeAsync4=_asyncToGenerator(regeneratorRuntime.mark((function _callee39(e,t){var n;return regeneratorRuntime.wrap((function _callee39$(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),_context40.next=3,this.executor.executeAsync(e,t);case 3:return n=_context40.sent,_context40.abrupt("return",n.length>1?n:n[0]);case 5:case"end":return _context40.stop()}}),_callee39,this)}))),function executeAsync(_x56,_x57){return _executeAsync4.apply(this,arguments)})},{key:"convertTensorMapToTensorsMap",value:function convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}},{key:"modelVersion",get:function get(){return this.version}},{key:"inputNodes",get:function get(){return this.executor.inputNodes}},{key:"outputNodes",get:function get(){return this.executor.outputNodes}},{key:"inputs",get:function get(){return this.executor.inputs}},{key:"outputs",get:function get(){return this.executor.outputs}},{key:"weights",get:function get(){return this.executor.weightMap}},{key:"metadata",get:function get(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function get(){return this.signature}}]),Ml}();function Dl(_x58){return _Dl.apply(this,arguments)}function _Dl(){return(_Dl=_asyncToGenerator(regeneratorRuntime.mark((function _callee52(e){var t,n,_args53=arguments;return regeneratorRuntime.wrap((function _callee52$(_context53){for(;;)switch(_context53.prev=_context53.next){case 0:if(t=_args53.length>1&&void 0!==_args53[1]?_args53[1]:{},null!=e){_context53.next=3;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 3:return null==t&&(t={}),t.fromTFHub&&null==e.load&&(e.endsWith("/")||(e+="/"),e="".concat(e,"model.json?tfjs-format=file")),n=new Ml(e,t),_context53.next=7,n.load();case 7:return _context53.abrupt("return",n);case 8:case"end":return _context53.stop()}}),_callee52)})))).apply(this,arguments)}function Pl(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function i(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}u((r=r.apply(e,t||[])).next())}))}function Ll(e,t){var n,r,a,o,s={label:0,sent:function sent(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}}var Bl=function Bl(e){return{startEndTensor:e,startPoint:qa(e,[0,0],[-1,2]),endPoint:qa(e,[0,2],[-1,2])}},zl={strides:[8,16],anchors:[2,6]};function Wl(e,t){var n,r,a;if(e.topLeft instanceof kn&&e.bottomRight instanceof kn){var o=ua((function(){return[ja([qa(jo(t-1,e.topLeft),0,1),qa(e.topLeft,1,1)]),ja([jo(t-1,qa(e.bottomRight,0,1)),qa(e.bottomRight,1,1)])]}));n=o[0],r=o[1],null!=e.landmarks&&(a=ua((function(){var n=jo(ci([t-1,0]),e.landmarks),r=ci([1,-1]);return ma(n,r)})))}else{var s=e.topLeft,i=s[0],u=s[1],l=e.bottomRight,c=l[0],d=l[1];n=[t-1-i,u],r=[t-1-c,d],null!=e.landmarks&&(a=e.landmarks.map((function(e){return[t-1-e[0],e[1]]})))}var p={topLeft:n,bottomRight:r};return null!=a&&(p.landmarks=a),null!=e.probability&&(p.probability=e.probability instanceof kn?e.probability.clone():e.probability),p}function Vl(e,t){return ua((function(){var n;return n=e.hasOwnProperty("box")?e.box:e,oi(function(e,t){var n=ma(e.startPoint,t),r=ma(e.endPoint,t),a=to([n,r],1);return Bl(a)}(n,t).startEndTensor)}))}var Ul,Hl,ql,jl=function(){function e(e,t,n,r,a,o){this.blazeFaceModel=e,this.width=t,this.height=n,this.maxFaces=r,this.anchorsData=function(e,t,n){for(var r=[],a=0;a<n.strides.length;a++)for(var o=n.strides[a],s=Math.floor((t+o-1)/o),i=Math.floor((e+o-1)/o),u=n.anchors[a],l=0;l<s;l++)for(var c=o*(l+.5),d=0;d<i;d++)for(var p=o*(d+.5),f=0;f<u;f++)r.push([p,c]);return r}(t,n,zl),this.anchors=di(this.anchorsData),this.inputSizeData=[t,n],this.inputSize=ci([t,n]),this.iouThreshold=a,this.scoreThreshold=o}return e.prototype.getBoundingBoxes=function(e,t,n){return void 0===n&&(n=!0),Pl(this,void 0,void 0,(function(){var r,a,o,s,i,u,l,c,d,p,f,h,m,g,b=this;return Ll(this,(function(y){switch(y.label){case 0:return r=ua((function(){var t=Qi.resizeBilinear(e,[b.width,b.height]),n=ma(jo(ha(t,255),.5),2),r=b.blazeFaceModel.predict(n),a=oi(r),o=function(e,t,n){var r=qa(e,[0,1],[-1,2]),a=pa(r,t),o=qa(e,[0,3],[-1,2]),s=ha(o,n),i=ha(a,n),u=ha(s,2),l=jo(i,u),c=pa(i,u),d=ma(l,n),p=ma(c,n);return to([d,p],1)}(a,b.anchors,b.inputSize),s=qa(a,[0,0],[-1,1]);return[a,o,oi(Ga(s))]})),a=r[0],o=r[1],s=r[2],i=console.warn,console.warn=function(){},u=Qi.nonMaxSuppression(o,s,this.maxFaces,this.iouThreshold,this.scoreThreshold),console.warn=i,[4,u.array()];case 1:return l=y.sent(),u.dispose(),c=l.map((function(e){return qa(o,[e,0],[1,-1])})),t?[3,3]:[4,Promise.all(c.map((function(e){return Pl(b,void 0,void 0,(function(){var t;return Ll(this,(function(n){switch(n.label){case 0:return[4,e.array()];case 1:return t=n.sent(),e.dispose(),[2,t]}}))}))})))];case 2:c=y.sent(),y.label=3;case 3:for(d=e.shape[1],p=e.shape[2],f=t?ha([p,d],this.inputSize):[p/this.inputSizeData[0],d/this.inputSizeData[1]],h=[],m=function m(e){var r=c[e],o=ua((function(){var o=Bl(r instanceof kn?r:di(r));if(!n)return o;var i,u=l[e];return i=t?qa(b.anchors,[u,0],[1,2]):b.anchorsData[u],{box:o,landmarks:Va(oi(qa(a,[u,5],[1,-1])),[6,-1]),probability:qa(s,[u],[1]),anchor:i}}));h.push(o)},g=0;g<c.length;g++)m(g);return o.dispose(),s.dispose(),a.dispose(),[2,{boxes:h,scaleFactor:f}]}}))}))},e.prototype.estimateFaces=function(e,t,n,r){return void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r=!0),Pl(this,void 0,void 0,(function(){var a,o,s,i,u,l,c=this;return Ll(this,(function(d){switch(d.label){case 0:return a=function(e){return e instanceof kn?[e.shape[0],e.shape[1]]:[e.height,e.width]}(e),o=a[1],s=ua((function(){return e instanceof kn||(e=Br(e)),To(Er(e,"float32"),0)})),[4,this.getBoundingBoxes(s,t,r)];case 1:return i=d.sent(),u=i.boxes,l=i.scaleFactor,s.dispose(),t?[2,u.map((function(e){var t=Vl(e,l),a={topLeft:qa(t,[0],[2]),bottomRight:qa(t,[2],[2])};if(r){var s=e,i=s.landmarks,u=s.probability,c=s.anchor,d=ma(pa(i,c),l);a.landmarks=d,a.probability=u}return n&&(a=Wl(a,o)),a}))]:[2,Promise.all(u.map((function(e){return Pl(c,void 0,void 0,(function(){var t,a,s,i,u,c,d,p,f,h,m,g=this;return Ll(this,(function(b){switch(b.label){case 0:return t=Vl(e,l),r?[3,2]:[4,t.array()];case 1:return u=b.sent(),a={topLeft:u.slice(0,2),bottomRight:u.slice(2)},[3,4];case 2:return[4,Promise.all([e.landmarks,t,e.probability].map((function(e){return Pl(g,void 0,void 0,(function(){return Ll(this,(function(t){return[2,e.array()]}))}))})))];case 3:s=b.sent(),i=s[0],u=s[1],c=s[2],d=e.anchor,f=(p=l)[0],h=p[1],m=i.map((function(e){return[(e[0]+d[0])*f,(e[1]+d[1])*h]})),a={topLeft:u.slice(0,2),bottomRight:u.slice(2),landmarks:m,probability:c},function(e){e.startEndTensor.dispose(),e.startPoint.dispose(),e.endPoint.dispose()}(e.box),e.landmarks.dispose(),e.probability.dispose(),b.label=4;case 4:return t.dispose(),n&&(a=Wl(a,o)),[2,a]}}))}))})))]}}))}))},e}();function Gl(e){var t=void 0===e?{}:e,n=t.maxFaces,r=void 0===n?10:n,a=t.inputWidth,o=void 0===a?128:a,s=t.inputHeight,i=void 0===s?128:s,u=t.iouThreshold,l=void 0===u?.3:u,c=t.scoreThreshold,d=void 0===c?.75:c,p=t.modelUrl;return Pl(this,void 0,void 0,(function(){var e;return Ll(this,(function(t){switch(t.label){case 0:return null==p?[3,2]:[4,Dl(p)];case 1:return e=t.sent(),[3,4];case 2:return[4,Dl("https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",{fromTFHub:!0})];case 3:e=t.sent(),t.label=4;case 4:return[2,new jl(e,o,i,r,l,d)]}}))}))}!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(Ul||(Ul={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu"}(Hl||(Hl={}));var Kl={kernelName:"_FusedMatMul",backendName:"wasm",setupFunc:function setupFunc(e){ql=e.wasm.cwrap("_FusedMatMul",null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=t.bias,i=t.preluActivationWeights;if("float32"!==a.dtype||"float32"!==o.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");var u=r.transposeA,l=r.transposeB,c=r.activation,d=r.leakyreluAlpha,p=n.dataIdMap.get(a.dataId).id,f=n.dataIdMap.get(o.dataId).id,h=0;if(null!=s){var _e92=n.dataIdMap.get(s.dataId);if(1!==_e92.shape.length)throw new Error("_FusedMatMul only supports rank-1 bias but got rank ".concat(_e92.shape.length,"."));h=_e92.id}var m=null==i?0:n.dataIdMap.get(i.dataId).id,g=Hl[c];if(null==g)throw new Error("".concat(c," activation not yet supported for FusedConv2D in the wasm backend."));var b=u?a.shape[2]:a.shape[1],y=l?o.shape[1]:o.shape[2],x=a.shape[0],v=n.makeOutput([x,b,y],a.dtype),k=n.dataIdMap.get(v.dataId).id,w=new Uint8Array(new Int32Array(a.shape).buffer),I=new Uint8Array(new Int32Array(o.shape).buffer);return ql(p,w,a.shape.length,f,I,o.shape.length,u,l,g,h,m,d||0,k),v}};function Xl(e){var t;return{kernelName:e,backendName:"wasm",setupFunc:function setupFunc(n){t=n.wasm.cwrap(e,null,["number","number"])},kernelFunc:function kernelFunc(e){var n=e.backend,r=e.inputs.x,a=n.dataIdMap.get(r.dataId).id,o=n.makeOutput(r.shape,r.dtype),s=n.dataIdMap.get(o.dataId).id;return 0===gt(o.shape)||t(a,s),o}}}var Yl=Xl("Abs");function Ql(e,t,n){var r;return{kernelName:e,backendName:"wasm",setupFunc:function setupFunc(t){r=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function kernelFunc(a){var o=a.backend,s=a.inputs,i=s.a,u=s.b,l=o.dataIdMap.get(i.dataId).id,c=o.dataIdMap.get(u.dataId).id,d=null!=n?n:i.dtype,p=bo(i.shape,u.shape),f=o.makeOutput(p,d);if(0===gt(p))return f;var h=new Uint8Array(new Int32Array(i.shape).buffer),m=new Uint8Array(new Int32Array(u.shape).buffer),g=o.dataIdMap.get(f.dataId).id,b=function b(){return r(l,h,i.shape.length,c,m,u.shape.length,Ul[i.dtype],g)};if(t&&"float32"===i.dtype)return b(),f;var y=mo(i.shape,p),x=mo(u.shape,p),v=y.every((function(e,t){return e===t})),k=x.every((function(e,t){return e===t}));if(v&&k)return b(),f;throw new Error("Broadcasting along outer dims is not yet supported for ".concat(i.dtype," ").concat(e,"."))}}}var Jl,Zl=Ql(Yt,!0),ec={kernelName:"AddN",backendName:"wasm",setupFunc:function setupFunc(e){Jl=e.wasm.cwrap("AddN",null,["array","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=n.makeOutput(t[0].shape,t[0].dtype);if(0===gt(r.shape))return r;var a=t.map((function(e){return n.dataIdMap.get(e.dataId).id})),o=new Uint8Array(new Int32Array(a).buffer),s=n.dataIdMap.get(r.dataId).id;return Jl(o,a.length,Ul[r.dtype],s),r}};function tc(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var rc,nc={kernelName:"Identity",backendName:"wasm",kernelFunc:tc};function ac(e){for(var t=e.inputs,n=e.backend,r=e.attrs,_ref22=_slicedToArray(function(e,t){for(var n=[],r=[],_a121=0;_a121<e.length;++_a121)1!==e[_a121]&&n.push(e[_a121]),1!==e[t[_a121]]&&r.push(t[_a121]);for(var _e93=0;_e93<r.length;++_e93){for(var _t85=-1,_n44=0;_n44<r.length;++_n44)r[_n44]>=_e93&&(-1===_t85||r[_t85]>r[_n44])&&(_t85=_n44);r[_t85]=_e93}return[n,r]}(t.x.shape,r.perm),2),a=_ref22[0],o=_ref22[1],s=!0,_e94=0;_e94<o.length;_e94++)o[_e94]!==_e94&&(s=!1);var i=function(e,t){for(var n=new Array(e.length),_r137=0;_r137<n.length;_r137++)n[_r137]=e[t[_r137]];return n}(t.x.shape,r.perm),u={dataId:t.x.dataId,shape:a,dtype:t.x.dtype};if(s){var _e95=tc({inputs:t,backend:n});return _e95.shape=i,_e95}var l=n.makeOutput(i,u.dtype),c=n.dataIdMap.get(u.dataId).id,d=n.dataIdMap.get(l.dataId).id,p=new Uint8Array(new Int32Array(o).buffer),f=new Uint8Array(new Int32Array(u.shape).buffer);return rc(c,f,u.shape.length,Ul[u.dtype],d,p,o.length),l}var ic,oc={kernelName:"Transpose",backendName:"wasm",kernelFunc:ac,setupFunc:function setupFunc(e){rc=e.wasm.cwrap("Transpose",null,["number","array","number","number","number","array","number"])}};function sc(e,t,n){var r=e.shape,a=e.shape.length,o=It(t,r),s=o,i=Jo(s,a),u=null,l=!1;if(null!=i){for(var _t86=new Array(a),_e96=0;_e96<_t86.length;_e96++)_t86[_e96]=r[i[_e96]];s=ts(s.length,a),u=ac({inputs:{x:e},attrs:{perm:i},backend:n});var _o85=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==_o85&&(l=!0)}return{transposed:u,originalAxes:o,axes:s,inputWasTransposed:l}}var lc,uc={kernelName:"ArgMax",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,a=e.attrs.axis,o=n.x,s=t.dataIdMap.get(o.dataId).id,i=s,u=o,_sc=sc(o,a,t),l=_sc.transposed,c=_sc.axes,d=_sc.inputWasTransposed;if(d){var _e97=t.dataIdMap.get(l.dataId).id;_e97!==s&&(u=l,i=_e97)}var p=u.shape.slice(0,-1),f=t.makeOutput(p,"int32"),h=t.dataIdMap.get(f.dataId).id,m=gt(f.shape),g=u.shape[c[0]];return ic(i,Ul[u.dtype],m,g,h),d&&t.disposeData(l.dataId),f},setupFunc:function setupFunc(e){ic=e.wasm.cwrap("ArgMax",null,["number","number","number","number","number"])}},cc={kernelName:"AvgPool",backendName:"wasm",setupFunc:function setupFunc(e){lc=e.wasm.cwrap("AvgPool",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=r.dataIdMap.get(a.dataId).id,s=n.filterSize,i=n.strides,u=n.pad,l=n.dimRoundingMode,c=$a(a.shape,s,i,1,u,l),d=c.filterHeight,p=c.filterWidth,f=c.padInfo.top,h=c.padInfo.right,m=c.padInfo.bottom,g=c.padInfo.left,b=c.strideHeight,y=c.strideWidth,x=c.inChannels;if("channelsLast"!==c.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(c.dataFormat,"'. Please use 'channelsLast'."));if(1!==c.dilationWidth||1!==c.dilationHeight)throw new Error("was backend only supports average pooling with dilation = [1, 1], got [".concat(c.dilationHeight,", ").concat(c.dilationWidth,"]."));var v=r.makeOutput(c.outShape,"float32"),k=r.dataIdMap.get(v.dataId).id;return lc(o,a.shape[0],a.shape[1],a.shape[2],d,p,f,h,m,g,b,y,x,k),v}};function dc(e){var t=e.inputs,n=e.attrs,r=t.x,a=n.shape,o=gt(r.shape),s=wt(a,o);return pt(o===gt(s),(function(){return"new shape: ".concat(s,", old shape: ").concat(r.shape,". New shape and old shape must have the same number of elements.")})),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:s,dtype:r.dtype}}var fc,pc={kernelName:"Reshape",backendName:"wasm",kernelFunc:dc},hc={kernelName:"BatchMatMul",backendName:"wasm",setupFunc:function setupFunc(e){fc=e.wasm.cwrap("BatchMatMul",null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=r.transposeA,i=r.transposeB;if("float32"!==a.dtype||"float32"!==o.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");var u=a.shape.length,l=o.shape.length,c=s?a.shape[u-2]:a.shape[u-1],d=i?o.shape[l-1]:o.shape[l-2],p=s?a.shape[u-1]:a.shape[u-2],f=i?o.shape[l-2]:o.shape[l-1],h=a.shape.slice(0,-2),m=o.shape.slice(0,-2),g=gt(h),b=gt(m);pt(u>=2&&l>=2&&(g===b||1===g||1===b),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(h,") and (").concat(m,").")}));var y=(g>b?a.shape.slice(0,-2):o.shape.slice(0,-2)).concat([p,f]);pt(c===d,(function(){return"Error in matMul: inner shapes (".concat(c,") and (").concat(d,") of Tensors with shapes ").concat(a.shape," and ").concat(o.shape," and transposeA=").concat(s," and transposeB=").concat(i," must match.")}));var x=i?[b,f,d]:[b,d,f],v=dc({inputs:{x:a},backend:n,attrs:{shape:s?[g,c,p]:[g,p,c]}}),k=dc({inputs:{x:o},backend:n,attrs:{shape:x}}),w=n.dataIdMap.get(v.dataId).id,I=n.dataIdMap.get(k.dataId).id,N=s?v.shape[2]:v.shape[1],T=i?k.shape[1]:k.shape[2],C=Math.max(g,b),E=n.makeOutput([C,N,T],v.dtype),S=n.dataIdMap.get(E.dataId).id,_=new Uint8Array(new Int32Array(v.shape).buffer),$=new Uint8Array(new Int32Array(k.shape).buffer);return fc(w,_,v.shape.length,I,$,k.shape.length,s,i,S),n.disposeData(v.dataId),n.disposeData(k.dataId),E.shape=y,E}};function mc(e){var t=e.inputs.x,n=e.attrs.dtype,r=e.backend,a=r.makeOutput(t.shape,n),o=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(o),a}var yc,gc={kernelName:"Cast",backendName:"wasm",kernelFunc:mc},bc=Xl("Ceil"),xc={kernelName:"ClipByValue",backendName:"wasm",setupFunc:function setupFunc(e){yc=e.wasm.cwrap("ClipByValue",null,["number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.clipValueMin,s=r.clipValueMax,i=n.dataIdMap.get(a.dataId).id,u=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(u.dataId).id;return yc(i,o,s,l),u}};function vc(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&pt("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}function kc(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var wc={kernelName:"Abs",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs.x,n=e.backend;vc(t,"abs");var r=new Float32Array(gt(t.shape));return r=kc(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,"float32")}};function Ic(e){return function(t,n,r,a,o){var s=bo(t,n),i=s.length,u=Ot(s),l=Tt(o,gt(s)),c=t.length,d=n.length,p=Ot(t),f=Ot(n),h=mo(t,s),m=mo(n,s);if(h.length+m.length===0)for(var _t87=0;_t87<l.length;++_t87)l[_t87]=e(r[_t87%r.length],a[_t87%a.length]);else for(var _loop8=function _loop8(_t88){var n=Vt(_t88,i,u),o=n.slice(-c);h.forEach((function(e){return o[e]=0}));var s=Wt(o,c,p),g=n.slice(-d);m.forEach((function(e){return g[e]=0}));var b=Wt(g,d,f);l[_t88]=e(r[s],a[b])},_t88=0;_t88<l.length;++_t88)_loop8(_t88);return[l,s]}}function Nc(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,i=n.makeTensorInfo(r.shape,"complex64");return n.data.get(i.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",o),imag:n.makeTensorInfo(a.shape,"float32",s)},i}var Tc={kernelName:"Complex",backendName:"cpu",kernelFunc:Nc};function Cc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return Nc({inputs:{real:Cc(e,t,"float32"),imag:Cc(e,t,"float32")},backend:e});var r=Lt(gt(t),n);return e.makeTensorInfo(t,n,r)}function Ec(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Sc={kernelName:"Identity",backendName:"cpu",kernelFunc:Ec};function _c(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,o=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,o)}var $c={kernelName:"Real",backendName:"cpu",kernelFunc:_c};function Rc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.dtype;if("complex64"===o){if("complex64"===a.dtype)return Ec({inputs:{x:a},backend:n});var _e98=Cc(n,a.shape,a.dtype),_t89=Rc({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),_r138=Nc({inputs:{real:_t89,imag:_e98},backend:n});return n.disposeIntermediateTensorInfo(_e98),n.disposeIntermediateTensorInfo(_t89),_r138}if("complex64"===a.dtype){var _e99=_c({inputs:{input:a},backend:n}),_t90=Rc({inputs:{x:_e99},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(_e99),_t90}if(!Et(a.dtype,o)){var _e100=Ec({inputs:{x:a},backend:n});return{dataId:_e100.dataId,shape:_e100.shape,dtype:o}}if("int32"===o){var _e101=n.data.get(a.dataId).values,_t91=Int32Array.from(_e101);return n.makeTensorInfo(a.shape,"int32",_t91)}if("bool"===o){var _e102=n.data.get(a.dataId).values,_t92=on([0],a.dtype),_Ic2=_slicedToArray(Ic((function(e,t){return e!==t?1:0}))(a.shape,[],_e102,_t92,"bool"),2),_r139=_Ic2[0],_o86=_Ic2[1];return n.makeTensorInfo(_o86,"bool",_r139)}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(o))}var Ac={kernelName:"Cast",backendName:"cpu",kernelFunc:Rc};function Fc(e,t,n,r){return null==n?function(_ref23){var n=_ref23.inputs,a=_ref23.backend,o=n.a,s=n.b,i=a;vc([o,s],e);var u=i.data.get(o.dataId).values,l=i.data.get(s.dataId).values,c=r||o.dtype,_t94=_slicedToArray(t(o.shape,s.shape,u,l,c),2),d=_t94[0],p=_t94[1];return i.makeTensorInfo(p,c,d)}:function(_ref24){var e=_ref24.inputs,a=_ref24.backend,o=e.a,s=e.b,i=a;if("complex64"===o.dtype||"complex64"===s.dtype){var _e103=Rc({inputs:{x:o},backend:i,attrs:{dtype:"complex64"}}),_t95=i.data.get(_e103.dataId),_r140=_t95.complexTensorInfos.real,_a122=_t95.complexTensorInfos.imag,_u21=i.data.get(_r140.dataId).values,l=i.data.get(_a122.dataId).values,c=Rc({inputs:{x:s},backend:i,attrs:{dtype:"complex64"}}),_d8=i.data.get(c.dataId),_p5=_d8.complexTensorInfos.real,_f4=_d8.complexTensorInfos.imag,_h3=i.data.get(_p5.dataId).values,_m4=i.data.get(_f4.dataId).values,_n46=_slicedToArray(n(o.shape,s.shape,_u21,l,_h3,_m4),3),_g3=_n46[0],_b3=_n46[1],_y3=_n46[2],_x59=i.makeTensorInfo(_y3,"float32",_g3),_v3=i.makeTensorInfo(_y3,"float32",_b3),_k2=Nc({inputs:{real:_x59,imag:_v3},backend:i});return i.disposeIntermediateTensorInfo(_e103),i.disposeIntermediateTensorInfo(c),i.disposeIntermediateTensorInfo(_x59),i.disposeIntermediateTensorInfo(_v3),_k2}var _e104=i.data.get(o.dataId).values,_n47=i.data.get(s.dataId).values,_a123=r||o.dtype,_t97=_slicedToArray(t(o.shape,s.shape,_e104,_n47,_a123),2),_u22=_t97[0],_l6=_t97[1];return i.makeTensorInfo(_l6,_a123,_u22)}}function Oc(e){return function(t,n,r,a,o,s){var i=bo(t,n),u=gt(i),l=i.length,c=Ot(i),d=Tt("float32",u),p=Tt("float32",u),f=mo(t,i),h=mo(n,i),m=uu(r,a),g=uu(o,s),b=t.length,y=Ot(t),x=n.length,v=Ot(n);if(f.length+h.length===0)for(var _t98=0;_t98<d.length;_t98++){var _n48=_t98%m.length,_r141=_t98%g.length,_a124=e(m[2*_n48],m[2*_n48+1],g[2*_r141],g[2*_r141+1]);d[_t98]=_a124.real,p[_t98]=_a124.imag}else for(var _loop9=function _loop9(_t99){var n=Vt(_t99,l,c),r=n.slice(-b);f.forEach((function(e){return r[e]=0}));var a=Wt(r,b,y),o=n.slice(-x);h.forEach((function(e){return o[e]=0}));var s=Wt(o,x,v),i=e(m[2*a],m[2*a+1],g[2*s],g[2*s+1]);d[_t99]=i.real,p[_t99]=i.imag},_t99=0;_t99<d.length;_t99++)_loop9(_t99);return[d,p,i]}}var Mc=Ic((function(e,t){return e+t})),Dc=Oc((function(e,t,n,r){return{real:e+n,imag:t+r}})),Pc=Fc(Yt,Mc,Dc),Lc={kernelName:Yt,backendName:"cpu",kernelFunc:Pc};function Bc(e,t,n,r,a){for(var o=gt(r),s=Lt(a,n),_n49=0;_n49<e.length;_n49++){var _r142=e[_n49];if(_r142<0)throw new Error("Input x must be non-negative!");_r142>=a||(s[_r142]+=o>0?t[_n49]:1)}return s}function zc(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],o=e.shape[1],s=Cr([a,n],t.dtype),_i33=0;_i33<a;_i33++)for(var _a125=0;_a125<o;_a125++){var _o87=e.get(_i33,_a125);if(_o87<0)throw new Error("Input x must be non-negative!");_o87>=n||(r?s.set(1,_i33,_o87):t.size>0?s.set(s.get(_i33,_o87)+t.get(_i33,_a125),_i33,_o87):s.set(s.get(_i33,_o87)+1,_i33,_o87))}return s}function Wc(e){return function(t,n,r){for(var a=Tt(n,t.length),_n50=0;_n50<t.length;++_n50)a[_n50]=e(t[_n50],r);return a}}function Vc(e,t,n){return function(_ref25){var r=_ref25.inputs,a=_ref25.attrs,o=_ref25.backend,s=r.x;if(vc(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var i=o,u=i.data.get(s.dataId).values,l=gt(s.shape),c=n||s.dtype,d=Ct(c,l),_e105=0;_e105<l;++_e105)d[_e105]=t(u[_e105],a);return i.makeTensorInfo(s.shape,c,d)}}function Uc(e,t,n){return function(_ref26){var r=_ref26.inputs,a=_ref26.attrs,o=_ref26.backend,s=r.x;if(vc(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var i=o,u=i.data.get(s.dataId).values,l=n||s.dtype,c=t(u,l,a);return i.makeTensorInfo(s.shape,l,c)}}var Hc=Wc((function(e){return Math.ceil(e)})),jc={kernelName:"Ceil",backendName:"cpu",kernelFunc:Uc("Ceil",Hc)};function Gc(e,t,n,r){var a=Ct(n,gt(t));if(r&&"string"!==n){var _t100=0;e.forEach((function(e){var n=gt(e.shape);a.set(e.vals,_t100),_t100+=n}))}else{var _r143=0;e.forEach((function(e){for(var o="string"===n?ku(e.vals):e.vals,s=0,_n51=0;_n51<e.shape[0];++_n51)for(var _i34=_n51*t[1]+_r143,_t101=0;_t101<e.shape[1];++_t101)a[_i34+_t101]=o[s++];_r143+=e.shape[1]}))}return a}var qc=Wc((function(e){return Math.exp(e)})),Kc=Uc("Exp",qc),Xc={kernelName:"Exp",backendName:"cpu",kernelFunc:Kc},Yc=Wc((function(e){return Math.expm1(e)})),Qc={kernelName:"Expm1",backendName:"cpu",kernelFunc:Uc("Expm1",Yc)},Zc=Wc((function(e){return Math.floor(e)})),Jc={kernelName:"Floor",backendName:"cpu",kernelFunc:Uc("Floor",Zc)};function ed(e,t,n){for(var r=Cr(n,e.dtype),_n52=0;_n52<r.size;++_n52){var _a126=r.indexToLoc(_n52).slice(),_o88=_a126[0],_s58=_a126[2],_i35=t.locToIndex([_o88,_s58]);_a126[2]=t.values[_i35];var _u23=e.locToIndex(_a126);r.values[_n52]=e.values[_u23]}return r}var td=Ic((function(e,t){return e>t?1:0})),nd={kernelName:"Greater",backendName:"cpu",kernelFunc:Fc("Greater",td,null,"bool")},rd=Ic((function(e,t){return e<t?1:0})),ad={kernelName:"Less",backendName:"cpu",kernelFunc:Fc("Less",rd,null,"bool")};function od(e,t,n){var r=(t-e)/(n-1),a=Lt(n,"float32");a[0]=e;for(var _e106=1;_e106<a.length;_e106++)a[_e106]=a[_e106-1]+r;return a}var sd=Wc((function(e){return Math.log(e)})),id={kernelName:"Log",backendName:"cpu",kernelFunc:Uc("Log",sd)};function ud(e,t,n,r){for(var a=Tt(r,gt(n)),_n53=0;_n53<a.length;++_n53){for(var _r144=_n53*t,_o89=e[_r144],_n54=0;_n54<t;++_n54){var _t102=e[_r144+_n54];_t102>_o89&&(_o89=_t102)}a[_n53]=_o89}return a}var ld=Ic((function(e,t){return Math.max(e,t)})),cd={kernelName:"Maximum",backendName:"cpu",kernelFunc:Fc("Maximum",ld)},dd=Ic((function(e,t){return Math.min(e,t)})),pd={kernelName:"Minimum",backendName:"cpu",kernelFunc:Fc("Minimum",dd)},fd=Ic((function(e,t){return e*t})),hd=Oc((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),md=Fc("Multiply",fd,hd),gd={kernelName:"Multiply",backendName:"cpu",kernelFunc:md};function bd(e,t,n){var r=an(-1,n);return fd([],t,r,e,n)}var yd={kernelName:"Neg",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.x;vc(r,"neg");var _bd2=_slicedToArray(bd(n.data.get(r.dataId).values,r.shape,r.dtype),2),o=_bd2[0],s=_bd2[1];return n.makeTensorInfo(s,r.dtype,o)}},xd=Ic((function(e,t){return e!==t?1:0})),vd={kernelName:"NotEqual",backendName:"cpu",kernelFunc:Fc("NotEqual",xd,null,"bool")};function kd(e,t,n,r,a){for(var o=t.length,s=gt(t),i=Ot(t),u=Ot(a),l=Tt(n,gt(a)),_t103=0;_t103<s;++_t103){for(var _n55=Vt(_t103,o,i),_a127=new Array(_n55.length),_e107=0;_e107<_a127.length;_e107++)_a127[_e107]=_n55[r[_e107]];l[Wt(_a127,o,u)]=e[_t103]}return l}function wd(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=n.perm;vc(a,"transpose");for(var s=a.shape.length,i=new Array(s),_e108=0;_e108<i.length;_e108++)i[_e108]=a.shape[o[_e108]];var u=kd(r.data.get(a.dataId).values,a.shape,a.dtype,o,i);return{dataId:r.write(u,i,a.dtype),shape:i,dtype:a.dtype}}var Id={kernelName:"Transpose",backendName:"cpu",kernelFunc:wd};function Nd(e,t,n,r){for(var _Yo2=_slicedToArray(Yo(e,r),2),a=_Yo2[0],o=_Yo2[1],s=_n(t,"int32"),i=Lt(gt(a),s),u=gt(o),_e109=0;_e109<i.length;++_e109){for(var _t104=_e109*u,_r145=1,_e110=0;_e110<u;++_e110)_r145*=n[_t104+_e110];i[_e109]=_r145}return{outVals:i,outShape:a,outDtype:s}}var Td={kernelName:"Prod",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;vc(a,"prod");var i=a.shape.length,u=It(o,a.shape),l=Jo(u,i),c=u,d=a,p=[];null!=l&&(d=wd({inputs:{x:a},backend:n,attrs:{perm:l}}),p.push(d),c=ts(c.length,i));var f=n.data.get(d.dataId).values,_Nd=Nd(d.shape,d.dtype,f,c),h=_Nd.outVals,m=_Nd.outShape,g=_Nd.outDtype,b=m;return s&&(b=Qo(m,u)),p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(b,g,h)}};function Cd(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Lt(0,r);var a=Lt(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var _e111=1;_e111<a.length;_e111++)a[_e111]=a[_e111-1]+n;return a}var Ed=Wc((function(e){return 1/Math.sqrt(e)})),Sd={kernelName:"Rsqrt",backendName:"cpu",kernelFunc:Uc("Rsqrt",Ed)};function _d(e,t,n,r,a){var o=na(r,t,n),s=gt(n),i=Ot(r);if(o){var _n56=ra(t,i);return"string"===a?e.slice(_n56,_n56+s):e.subarray(_n56,_n56+s)}for(var u=Cr(r,a,"string"===a?ku(e):e),l=Cr(n,a),_e112=0;_e112<l.size;++_e112){var _n57=l.indexToLoc(_e112),_r146=_n57.map((function(e,n){return e+t[n]}));l.set.apply(l,[u.get.apply(u,_toConsumableArray(_r146))].concat(_toConsumableArray(_n57)))}return"string"===a?wu(l.values):l.values}function $d(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.begin,s=r.size;vc(a,"slice");var _aa2=_slicedToArray(aa(a,o,s),2),i=_aa2[0],u=_aa2[1];Hr(a,i,u);var l=_d(n.data.get(a.dataId).values,i,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,l)}var Rd={kernelName:"Slice",backendName:"cpu",kernelFunc:$d},Ad=Ic((function(e,t){var n=e-t;return n*n})),Fd={kernelName:"SquaredDifference",backendName:"cpu",kernelFunc:Fc("SquaredDifference",Ad)};function Od(e,t,n,r){for(var a=Cr(e,t.dtype),_e113=0;_e113<a.size;_e113++){for(var _o90=a.indexToLoc(_e113),_s59=new Array(_o90.length),_e114=0;_e114<_s59.length;_e114++)_s59[_e114]=_o90[_e114]*n[_e114]+r[_e114];a.set.apply(a,[t.get.apply(t,_s59)].concat(_toConsumableArray(_o90)))}return a}var Md=Ic((function(e,t){return e-t})),Dd=Fc("Sub",Md,Oc((function(e,t,n,r){return{real:e-n,imag:t-r}}))),Pd={kernelName:"Sub",backendName:"cpu",kernelFunc:Dd};function Ld(e,t){for(var n=new Array(e.rank),_r147=0;_r147<n.length;_r147++)n[_r147]=e.shape[_r147]*t[_r147];for(var r=Cr(n,e.dtype),_t105=0;_t105<r.values.length;++_t105){for(var _n58=r.indexToLoc(_t105),_a128=new Array(e.rank),_t106=0;_t106<_a128.length;_t106++)_a128[_t106]=_n58[_t106]%e.shape[_t106];var _o91=e.locToIndex(_a128);r.values[_t105]=e.values[_o91]}return r}function Bd(e,t,n,r,a){for(var o=t[t.length-1],s=e.length/o,i=o,u=Tt(n,s*r),l=Tt("int32",s*r),_t107=0;_t107<s;_t107++){for(var _n59=_t107*i,_a129=e.subarray(_n59,_n59+i),_o92=[],_e115=0;_e115<_a129.length;_e115++)_o92.push({value:_a129[_e115],index:_e115});_o92.sort((function(e,t){return t.value-e.value}));for(var _s60=_t107*r,_c4=u.subarray(_s60,_s60+r),_d9=l.subarray(_s60,_s60+r),_e116=0;_e116<r;_e116++)_c4[_e116]=_o92[_e116].value,_d9[_e116]=_o92[_e116].index}var c=t.slice();return c[c.length-1]=r,[Cr(c,n,u),Cr(c,"int32",l)]}function zd(e,t,n,r){for(var a=It(t,n)[0],o=[1,n[0],1],_e117=0;_e117<a;_e117++)o[0]*=n[_e117];o[1]=n[a];for(var _e118=a+1;_e118<n.length;_e118++)o[2]*=n[_e118];for(var s={},i=new Int32Array(n[a]),u=new yn(o,r,e),l=[],c=1===o[0]&&1===o[2],_t108=0;_t108<n[a];_t108++){var _n60=void 0;if(c)_n60=e[_t108].toString();else{for(var _e119=[],_n61=0;_n61<o[0];_n61++)for(var _r148=0;_r148<o[2];_r148++)_e119.push(u.get(_n61,_t108,_r148));_n60=_e119.join(",")}if(void 0!==s[_n60])i[_t108]=s[_n60];else{var _e120=Object.keys(s).length;s[_n60]=_e120,i[_t108]=_e120,l.push(_t108)}}var d=o.slice();d[1]=Object.keys(s).length;var p=new yn(d,r);l.forEach((function(e,t){for(var _n62=0;_n62<o[0];_n62++)for(var _r149=0;_r149<o[2];_r149++)p.set(u.get(_n62,e,_r149),_n62,t,_r149)}));var f=n.slice();return f[a]=d[1],{outputValues:p.values,outputShape:f,indices:i}}var Wd=Object.freeze({__proto__:null,simpleAbsImpl:kc,addImpl:Mc,bincountImpl:Bc,bincountReduceImpl:zc,ceilImpl:Hc,concatImpl:Gc,expImpl:qc,expm1Impl:Yc,floorImpl:Zc,gatherV2Impl:ed,greaterImpl:td,lessImpl:rd,linSpaceImpl:od,logImpl:sd,maxImpl:ud,maximumImpl:ld,minimumImpl:dd,multiplyImpl:fd,negImpl:bd,notEqualImpl:xd,prodImpl:Nd,rangeImpl:Cd,rsqrtImpl:Ed,sliceImpl:_d,squaredDifferenceImpl:Ad,stridedSliceImpl:Od,subImpl:Md,tileImpl:Ld,topKImpl:Bd,transposeImpl:kd,uniqueImpl:zd});function Vd(e){var t=e.inputs,n=e.backend,r=It(e.attrs.axis,t[0].shape)[0],a=Ji(t.map((function(e){return e.shape})),r),o=t.filter((function(e){return gt(e.shape)>0}));if(1===o.length)return tc({inputs:{x:o[0]},backend:n});var s=n.makeOutput(a,t[0].dtype);if(0===gt(a))return s;if(Zi(o.map((function(e){return e.shape})),r),"string"===o[0].dtype){var _e121=o.map((function(e){var t=gt(e.shape.slice(r));return dc({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),_i36=_e121.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}}));a=Ji(_e121.map((function(e){return e.shape})),1);var _u24=1===_e121[0].shape[0],_l7=Gc(_i36,a,t[0].dtype,_u24),_c5=Ji(o.map((function(e){return e.shape})),r);return s.shape=_c5,n.dataIdMap.get(s.dataId).stringBytes=wu(_l7),_e121.forEach((function(e){return n.disposeData(e.dataId)})),s}for(var i=gt(o[0].shape.slice(0,r)),u=0,l=o.map((function(e){var t=gt(e.shape.slice(r));return u+=t,t})),c=o.map((function(e){return n.typedArrayFromHeap(e)})),d=n.typedArrayFromHeap(s),_e122=0;_e122<i;_e122++)for(var _t109=_e122*u,_n63=0;_n63<c.length;_n63++){var _r150=l[_n63],_a130=_e122*_r150,_o93=c[_n63].subarray(_a130,_a130+_r150);d.set(_o93,_t109),_t109+=_r150}return s}var Hd,Gd,Xd,Yd,Ud={kernelName:"Concat",backendName:"wasm",kernelFunc:Vd},jd={kernelName:"Conv2D",backendName:"wasm",setupFunc:function setupFunc(e){Hd=e.wasm.cwrap("Conv2D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,s=r.dataIdMap.get(a.dataId).id,i=r.dataIdMap.get(o.dataId).id,u=n.strides,l=n.dilations,c=n.pad,d=n.dimRoundingMode,f=Wa(n.dataFormat),h=Aa(a.shape,o.shape,u,l,c,d,!1,f),m=h.filterHeight,g=h.filterWidth,b=h.padInfo.top,y=h.padInfo.right,x=h.padInfo.bottom,v=h.padInfo.left,k=h.dilationHeight,w=h.dilationWidth,I=h.strideHeight,N=h.strideWidth,T=h.inChannels,C=h.outChannels,E="SAME"===h.padInfo.type?1:0;if("channelsLast"!==h.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'".concat(h.dataFormat,"'. Please use 'channelsLast'."));var S=r.makeOutput(h.outShape,"float32"),_=r.dataIdMap.get(S.dataId).id;return Hd(s,a.shape[0],a.shape[1],a.shape[2],i,m,g,b,y,x,v,E,k,w,I,N,T,C,_),S}},qd={kernelName:"Conv2DBackpropInput",backendName:"wasm",setupFunc:function setupFunc(e){Gd=e.wasm.cwrap("Conv2DBackpropInput",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.dy,o=n.filter,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=r.inputShape,d=Wa(u),p=Aa(c,o.shape,s,1,i,l,!1,d),f=p.batchSize,h=p.filterHeight,m=p.filterWidth,g=p.inChannels,b=p.inHeight,y=p.inWidth,x=p.outChannels,v=p.outHeight,k=p.outWidth,w=p.strideHeight,I=p.strideWidth,N=h-1-p.padInfo.top,T=m-1-p.padInfo.left,C="channelsLast"===p.dataFormat,E=Ot(p.inShape),S=Ot(a.shape),_Ot2=_slicedToArray(Ot(o.shape),3),_=_Ot2[0],$=_Ot2[1],R=_Ot2[2],A=E[0],F=C?E[1]:E[2],O=C?E[2]:1,M=C?1:E[1],D=S[0],P=C?S[1]:S[2],L=C?S[2]:1,B=C?1:S[1],z=t.makeOutput(p.inShape,"float32"),W=t.dataIdMap.get(z.dataId).id,V=t.dataIdMap.get(a.dataId).id,U=t.dataIdMap.get(o.dataId).id;return Gd(V,U,f,h,m,b,y,g,v,k,x,w,I,N,T,_,$,R,A,F,O,M,D,P,L,B,W),z}},Kd=Xl("Cos");!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(Xd||(Xd={}));var Zd,ep,np,Qd={kernelName:"CropAndResize",backendName:"wasm",setupFunc:function setupFunc(e){Yd=e.wasm.cwrap("CropAndResize",null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var h,t=e.backend,n=e.inputs,r=e.attrs,a=r.method,o=r.extrapolationValue,s=r.cropSize,i=n.image,u=n.boxes,l=n.boxInd,c=u.shape[0],_s61=_slicedToArray(s,2),d=_s61[0],p=_s61[1],f=[c,d,p,i.shape[3]],m=t.dataIdMap.get(i.dataId);"float32"!==i.dtype&&(h=mc({backend:t,inputs:{x:i},attrs:{dtype:"float32"}}),m=t.dataIdMap.get(h.dataId));var g=m.id,b=t.dataIdMap.get(u.dataId).id,y=t.dataIdMap.get(l.dataId).id,x=t.makeOutput(f,"float32"),v=t.dataIdMap.get(x.dataId).id,k=new Uint8Array(new Int32Array(i.shape).buffer);return Yd(g,b,y,c,k,d,p,Xd[a],o,v),null!=h&&t.disposeData(h.dataId),x}},Jd={kernelName:"Cumsum",backendName:"wasm",setupFunc:function setupFunc(e){Zd=e.wasm.cwrap("Cumsum",null,["number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.exclusive,i=r.reverse,u=a.shape.length;pt("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumsum does not support ".concat(a.dtype," tensors in the WASM backend")}));var l=Jo([o],u),c=a;null!==l&&(c=ac({inputs:{x:a},attrs:{perm:l},backend:n}));var d=ts(1,u)[0];Zo("cumsum",[d],u);var p=n.makeOutput(c.shape,c.dtype),f=c.shape[d],h=n.dataIdMap.get(c.dataId).id,m=n.dataIdMap.get(p.dataId).id;Zd(h,s?1:0,i?1:0,f,m,Ul[a.dtype]);var g=p;return null!==l&&(g=ac({inputs:{x:p},attrs:{perm:es(l)},backend:n}),n.disposeData(c.dataId),n.disposeData(p.dataId)),g}},tp={kernelName:"DepthToSpace",backendName:"wasm",setupFunc:function setupFunc(e){ep=e.wasm.cwrap("DepthToSpace",null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,o=r.blockSize,s=r.dataFormat;pt(o>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(o)}));var i=a.shape[0],u="NHWC"===s?a.shape[1]:a.shape[2],l="NHWC"===s?a.shape[2]:a.shape[3],c="NHWC"===s?a.shape[3]:a.shape[1],d=u*o,p=l*o,f=c/(o*o),h="NHWC"===s?[i,d,p,f]:[i,f,d,p],m=t.makeOutput(h,"float32"),g=t.dataIdMap.get(a.dataId).id,b=new Uint8Array(new Int32Array(Ot(a.shape)).buffer),y=new Uint8Array(new Int32Array(h).buffer),x=new Uint8Array(new Int32Array(Ot(h)).buffer),v=t.dataIdMap.get(m.dataId).id;return ep(g,o,"NHWC"===s?1:0,b,a.shape.length-1,y,x,h.length,v),m}},rp={kernelName:"DepthwiseConv2dNative",backendName:"wasm",setupFunc:function setupFunc(e){np=e.wasm.cwrap("DepthwiseConv2dNative",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,s=r.dataIdMap.get(a.dataId).id,i=r.dataIdMap.get(o.dataId).id,u=n.strides,l=n.dilations,c=n.pad,d=n.dimRoundingMode,p=null==l?[1,1]:l,f=Aa(a.shape,o.shape,u,p,c,d,!0),h=f.filterHeight,m=f.filterWidth,g=f.padInfo.top,b=f.padInfo.right,y=f.padInfo.bottom,x=f.padInfo.left,v=f.dilationHeight,k=f.dilationWidth,w=f.strideHeight,I=f.strideWidth,N=f.inChannels,T=f.outChannels,C="SAME"===f.padInfo.type?1:0;if("channelsLast"!==f.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'".concat(f.dataFormat,"'. Please use 'channelsLast'."));var E=r.makeOutput(f.outShape,"float32"),S=r.dataIdMap.get(E.dataId).id;return np(s,a.shape[0],a.shape[1],a.shape[2],i,h,m,g,b,y,x,C,v,k,w,I,N,T,S),E}},ap=Ql("Equal",!1,"bool"),op=Xl("Exp");function sp(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.input,o=n.dim,s=a.shape.length,i=a.shape.slice(),u=o;return o<0&&(pt(-(s+1)<=o,(function(){return"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")})),u=s+o+1),i.splice(u,0,1),dc({inputs:{x:a},backend:r,attrs:{shape:i}})}var lp,fp,mp,bp,xp,kp,Tp,Rp,Op,Dp,Lp,Hp,ip={kernelName:"ExpandDims",backendName:"wasm",kernelFunc:sp},cp={kernelName:"FlipLeftRight",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.image,a=n.makeOutput(r.shape,r.dtype),o=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,_r$shape=_slicedToArray(r.shape,4),i=_r$shape[0],u=_r$shape[1],l=_r$shape[2],c=_r$shape[3];return lp(o,i,u,l,c,s),a},setupFunc:function setupFunc(e){lp=e.wasm.cwrap("FlipLeftRight",null,["number","number","number","number","number","number"])}},dp=Xl("Floor"),pp=Ql("FloorDiv",!1),hp={kernelName:"FusedBatchNorm",backendName:"wasm",setupFunc:function setupFunc(e){fp=e.wasm.cwrap("FusedBatchNorm",null,["number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,a=e.attrs.varianceEpsilon,o=n.x,s=n.mean,i=n.variance,u=n.offset,l=n.scale,c=t.dataIdMap.get(o.dataId).id,d=t.dataIdMap.get(s.dataId).id,p=t.dataIdMap.get(i.dataId).id,f=null!=u?t.dataIdMap.get(u.dataId).id:0,h=null!=l?t.dataIdMap.get(l.dataId).id:0,m=t.makeOutput(o.shape,o.dtype);if(0===gt(o.shape))return m;var g=t.dataIdMap.get(m.dataId).id;return fp(c,d,p,f,h,a,g),m}},gp={kernelName:"FusedConv2D",backendName:"wasm",setupFunc:function setupFunc(e){mp=e.wasm.cwrap("FusedConv2D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=n.strides,l=n.pad,c=n.dilations,d=n.dataFormat,p=n.dimRoundingMode,f=n.activation,h=n.leakyreluAlpha,m=Aa(a.shape,o.shape,u,c,l,p),g=Hl[f];if(null==g)throw new Error("".concat(f," activation not yet supported for FusedConv2D in the wasm backend."));var b=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(o.dataId).id,x=m.outChannels,v=0;if(null!=s){var _e123=r.dataIdMap.get(s.dataId);if(1!==_e123.shape.length)throw new Error("FusedConv2D only supports rank-1 bias but got rank ".concat(_e123.shape.length,"."));if(_e123.shape[0]!==x)throw new Error("FusedConv2D bias shape (".concat(_e123.shape,") does not match the number of output channels (").concat(x,")"));v=_e123.id}var k=m.filterHeight,w=m.filterWidth,I=m.padInfo.top,N=m.padInfo.right,T=m.padInfo.bottom,C=m.padInfo.left,E=m.dilationHeight,S=m.dilationWidth,_=m.strideHeight,$=m.strideWidth,R=m.inChannels,A="SAME"===m.padInfo.type?1:0,F=m.batchSize,O=m.inHeight,M=m.inWidth;if("NHWC"!==d)throw new Error("wasm backend FusedConv2D does not support dataFormat:'".concat(d,"'. Please use 'NHWC'."));var D=r.makeOutput(m.outShape,"float32"),P=r.dataIdMap.get(D.dataId).id,L=null==i?0:r.dataIdMap.get(i.dataId).id;return mp(b,F,O,M,y,k,w,v,I,N,T,C,A,E,S,_,$,R,x,g,L,h||0,P),D}},yp={kernelName:"FusedDepthwiseConv2D",backendName:"wasm",setupFunc:function setupFunc(e){bp=e.wasm.cwrap("FusedDepthwiseConv2D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=n.strides,l=n.pad,c=n.dilations,d=n.dataFormat,p=n.dimRoundingMode,f=n.activation,h=n.leakyreluAlpha,m=Aa(a.shape,o.shape,u,c,l,p,!0),g=Hl[f];if(null==g)throw new Error("".concat(f," activation not yet supported for FusedDepthwiseConv2D in the wasm backend."));var b=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(o.dataId).id,x=m.outChannels,v=0;if(null!=s){var _e124=r.dataIdMap.get(s.dataId);if(1!==_e124.shape.length)throw new Error("FusedDepthwiseConv2D only supports rank-1 bias but got rank ".concat(_e124.shape.length,"."));if(_e124.shape[0]!==x)throw new Error("FusedDepthwiseConv2D bias shape (".concat(_e124.shape,") does not match the number of output channels (").concat(x,")"));v=_e124.id}var k=m.filterHeight,w=m.filterWidth,I=m.padInfo.top,N=m.padInfo.right,T=m.padInfo.bottom,C=m.padInfo.left,E=m.dilationHeight,S=m.dilationWidth,_=m.strideHeight,$=m.strideWidth,R=m.inChannels,A="SAME"===m.padInfo.type?1:0,F=m.batchSize,O=m.inHeight,M=m.inWidth;if("NHWC"!==d)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'".concat(d,"'. Please use 'NHWC'."));var D=r.makeOutput(m.outShape,"float32"),P=r.dataIdMap.get(D.dataId).id,L=null==i?0:r.dataIdMap.get(i.dataId).id;return bp(b,F,O,M,y,k,w,v,I,N,T,C,A,E,S,_,$,R,x,g,L,h||0,P),D}},vp={kernelName:"GatherNd",backendName:"wasm",setupFunc:function setupFunc(e){xp=e.wasm.cwrap("GatherNd",null,["number","number","number","number","number","number","array","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=n.params,a=n.indices,_zr2=_slicedToArray(zr(r,a),4),o=_zr2[0],s=_zr2[1],i=_zr2[2],u=_zr2[3],l=t.makeOutput(o,r.dtype);if(0===s)return l;var c=a.shape,d=c[c.length-1],p=t.dataIdMap.get(r.dataId).id,f=t.dataIdMap.get(a.dataId).id,h=new Uint8Array(new Int32Array(u).buffer),m=t.dataIdMap.get(l.dataId).id;return xp(p,Ul[r.dtype],f,s,d,i,h,m),l}},wp={kernelName:"GatherV2",backendName:"wasm",setupFunc:function setupFunc(e){kp=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,o=n.indices,s=r.axis,i=r.batchDims,u=xu(a,o,It(s,a.shape)[0],i),l=dc({inputs:{x:a},attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]},backend:t}),c=gt(o.shape),d=dc({inputs:{x:o},attrs:{shape:[u.batchSize,c/u.batchSize]},backend:t}),p=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize],f=t.makeOutput(p,a.dtype);if(0===gt(a.shape))return f;var h=l.shape.length-1,m=t.dataIdMap.get(l.dataId).id,g=t.dataIdMap.get(d.dataId).id,b=t.dataIdMap.get(f.dataId).id,y=new Uint8Array(new Int32Array(Ot(l.shape)).buffer),x=new Uint8Array(new Int32Array(Ot(p)).buffer);return kp(m,Ul[a.dtype],y,h,g,u.batchSize,x,b),t.disposeData(l.dataId),t.disposeData(d.dataId),f.shape=u.outputShape,f}},Ip=Ql("Greater",!1,"bool"),Np=Ql("GreaterEqual",!1,"bool"),Cp={kernelName:"LeakyRelu",backendName:"wasm",setupFunc:function setupFunc(e){Tp=e.wasm.cwrap("LeakyRelu",null,["number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs.x,n=e.attrs.alpha,r=e.backend,a=r.dataIdMap.get(t.dataId).id,o=r.makeOutput(t.shape,t.dtype);if(0!==gt(t.shape)){var _e125=r.dataIdMap.get(o.dataId).id;Tp(a,n,_e125)}return o}},Ep=Ql("Less",!1,"bool"),Sp=Ql("LessEqual",!1,"bool"),_p=Xl("Log"),$p=Ql("LogicalAnd",!1,"bool"),Ap={kernelName:"Max",backendName:"wasm",setupFunc:function setupFunc(e){Rp=e.wasm.cwrap("Max",null,["number, number, number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.reductionIndices,o=r.keepDims,s=n.x,i=t.dataIdMap.get(s.dataId).id,u=s,_sc2=sc(s,a,t),l=_sc2.transposed,c=_sc2.axes,d=_sc2.originalAxes,p=_sc2.inputWasTransposed;p&&(u=l,i=t.dataIdMap.get(l.dataId).id),Zo("max",c,u.shape.length);var _Yo4=_slicedToArray(Yo(u.shape,c),2),f=_Yo4[0],m=gt(_Yo4[1]),g=t.makeOutput(f,s.dtype);if(0!==gt(u.shape)){var _e126=t.dataIdMap.get(g.dataId).id;Rp(i,m,_e126)}if(p&&t.disposeData(l.dataId),o){var _e127=Qo(g.shape,d);g.shape=_e127}return g}},Fp=Ql("Maximum",!1),Mp={kernelName:"MaxPool",backendName:"wasm",setupFunc:function setupFunc(e){Op=e.wasm.cwrap("MaxPool",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=r.dataIdMap.get(a.dataId).id,s=n.filterSize,i=n.strides,u=n.pad,l=n.dimRoundingMode,c=$a(a.shape,s,i,1,u,l),d=c.filterHeight,p=c.filterWidth,f=c.padInfo.top,h=c.padInfo.right,m=c.padInfo.bottom,g=c.padInfo.left,b=c.dilationHeight,y=c.dilationWidth,x=c.strideHeight,v=c.strideWidth,k=c.inChannels,w=c.outChannels;if("channelsLast"!==c.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(c.dataFormat,"'. Please use 'channelsLast'."));var I=r.makeOutput(c.outShape,"float32"),N=r.dataIdMap.get(I.dataId).id;return Op(o,a.shape[0],a.shape[1],a.shape[2],d,p,f,h,m,g,b,y,x,v,k,w,N),I}},Pp={kernelName:"Mean",backendName:"wasm",setupFunc:function setupFunc(e){Dp=e.wasm.cwrap("Mean",null,["number, number, number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,s=n.x,i=t.dataIdMap.get(s.dataId).id,u=i,l=s,_sc3=sc(s,a,t),c=_sc3.transposed,d=_sc3.axes,p=_sc3.originalAxes,f=_sc3.inputWasTransposed,h=d;if(f){var _e128=t.dataIdMap.get(c.dataId).id;_e128!==i&&(l=c,u=_e128,h=ts(h.length,l.shape.length))}Zo("mean",h,l.shape.length);var _Yo6=_slicedToArray(Yo(l.shape,h),2),m=_Yo6[0],b=gt(_Yo6[1]),y=l;"float32"!==l.dtype&&(y=mc({backend:t,inputs:{x:l},attrs:{dtype:"float32"}}),u=t.dataIdMap.get(y.dataId).id);var x=t.makeOutput(m,"float32");if(0!==gt(l.shape)){var _e129=t.dataIdMap.get(x.dataId).id;Dp(u,b,_e129)}if(f&&t.disposeData(c.dataId),o){var _e130=Qo(x.shape,p);x.shape=_e130}return"float32"!==l.dtype&&t.disposeData(y.dataId),x}},Bp={kernelName:"Min",backendName:"wasm",setupFunc:function setupFunc(e){Lp=e.wasm.cwrap("Min",null,["number, number, number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,s=n.x,i=t.dataIdMap.get(s.dataId).id,u=i,l=s,_sc4=sc(s,a,t),c=_sc4.transposed,d=_sc4.axes,p=_sc4.originalAxes,f=_sc4.inputWasTransposed;if(f){var _e131=t.dataIdMap.get(c.dataId).id;_e131!==i&&(l=c,u=_e131)}Zo("min",d,l.shape.length);var _Yo8=_slicedToArray(Yo(l.shape,d),2),h=_Yo8[0],g=gt(_Yo8[1]),b=t.makeOutput(h,l.dtype);if(0!==gt(l.shape)){var _e132=t.dataIdMap.get(b.dataId).id;Lp(u,g,_e132)}if(f&&t.disposeData(c.dataId),o){var _e133=Qo(b.shape,p);b.shape=_e133}return b}},zp=Ql("Minimum",!1),Wp=Ql("Multiply",!0),Vp=Xl("Neg");function Up(e,t){var n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],o=n[2],s=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:o,pValidOutputs:s}}var Gp,Kp,Qp,tf,af,sf,ff,mf,bf,vf,kf,wf,Nf,Tf,Cf,Ef,Sf,_f,jp={kernelName:"NonMaxSuppressionV3",backendName:"wasm",setupFunc:function setupFunc(e){Hp=e.wasm.cwrap("NonMaxSuppressionV3","number",["number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,o=r.maxOutputSize,s=r.scoreThreshold,i=n.boxes,u=n.scores,l=t.dataIdMap.get(i.dataId).id,c=t.dataIdMap.get(u.dataId).id,_Up=Up(t,Hp(l,c,o,a,s)),p=_Up.pSelectedIndices,f=_Up.selectedSize,h=_Up.pSelectedScores,m=_Up.pValidOutputs;return t.wasm._free(h),t.wasm._free(m),t.makeOutput([f],"int32",p)}},qp={kernelName:"NonMaxSuppressionV4",backendName:"wasm",setupFunc:function setupFunc(e){Gp=e.wasm.cwrap("NonMaxSuppressionV4","number",["number","number","number","number","number","bool"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,o=r.maxOutputSize,s=r.scoreThreshold,i=r.padToMaxOutputSize,u=n.boxes,l=n.scores,c=t.dataIdMap.get(u.dataId).id,d=t.dataIdMap.get(l.dataId).id,_Up2=Up(t,Gp(c,d,o,a,s,i)),f=_Up2.pSelectedIndices,h=_Up2.selectedSize,m=_Up2.pSelectedScores,g=_Up2.pValidOutputs;return t.wasm._free(m),[t.makeOutput([h],"int32",f),t.makeOutput([],"int32",g)]}},Xp={kernelName:"NonMaxSuppressionV5",backendName:"wasm",setupFunc:function setupFunc(e){Kp=e.wasm.cwrap("NonMaxSuppressionV5","number",["number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,o=r.maxOutputSize,s=r.scoreThreshold,i=r.softNmsSigma,u=n.boxes,l=n.scores,c=t.dataIdMap.get(u.dataId).id,d=t.dataIdMap.get(l.dataId).id,_Up3=Up(t,Kp(c,d,o,a,s,i)),f=_Up3.pSelectedIndices,h=_Up3.selectedSize,m=_Up3.pSelectedScores,g=_Up3.pValidOutputs;return t.wasm._free(g),[t.makeOutput([h],"int32",f),t.makeOutput([h],"float32",m)]}},Yp=Ql("NotEqual",!1,"bool"),Zp={kernelName:"OneHot",backendName:"wasm",setupFunc:function setupFunc(e){Qp=e.wasm.cwrap("OneHot",null,["number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=r.depth,s=r.onValue,i=r.offValue,u=n.makeOutput([].concat(_toConsumableArray(a.shape),[o]),"int32"),l=n.dataIdMap.get(u.dataId).id,c=n.dataIdMap.get(a.dataId).id;return Qp(c,o,s,i,l),u}},ef={kernelName:"Pack",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,a=e.attrs.axis;if(1===t.length)return sp({inputs:{input:t[0]},backend:n,attrs:{dim:a}});var o=t[0].shape,s=t[0].dtype;t.forEach((function(e){ft(o,e.shape,"All tensors passed to stack must have matching shapes"),pt(s===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=[],u=Vd({inputs:t.map((function(e){var t=sp({inputs:{input:e},backend:n,attrs:{dim:a}});return i.push(t),t})),backend:n,attrs:{axis:a}});return i.forEach((function(e){return n.disposeData(e.dataId)})),u}},nf={kernelName:"PadV2",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs.x,n=e.backend,_e$attrs2=e.attrs,r=_e$attrs2.paddings,a=_e$attrs2.constantValue,o=r.map((function(e,n){return e[0]+t.shape[n]+e[1]})),s=n.dataIdMap.get(t.dataId).id,i=n.makeOutput(o,t.dtype),u=n.dataIdMap.get(i.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),c=r.map((function(e){return e[0]})),d=r.map((function(e){return e[1]})),p=new Uint8Array(new Int32Array(c).buffer),f=new Uint8Array(new Int32Array(d).buffer);return tf(s,l,t.shape.length,Ul[t.dtype],p,f,a,u),i},setupFunc:function setupFunc(e){tf=e.wasm.cwrap("PadV2",null,["number","array","number","number","array","array","number","number"])}},rf=Ql("Pow",!1),of={kernelName:"Prelu",backendName:"wasm",setupFunc:function setupFunc(e){af=e.wasm.cwrap("Prelu",null,["number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,o=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,i=n.makeOutput(r.shape,"float32"),u=n.dataIdMap.get(i.dataId).id;return af(o,s,u),i}},uf={kernelName:"Prod",backendName:"wasm",setupFunc:function setupFunc(e){sf=e.wasm.cwrap("Prod",null,["number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,s=n.x,i=t.dataIdMap.get(s.dataId).id,u=i,l=s,_sc5=sc(s,a,t),c=_sc5.transposed,d=_sc5.axes,p=_sc5.originalAxes,f=_sc5.inputWasTransposed,h=d;if(f){var _e134=t.dataIdMap.get(c.dataId).id;_e134!==i&&(l=c,u=_e134,h=ts(h.length,l.shape.length))}Zo("prod",h,l.shape.length);var _Yo10=_slicedToArray(Yo(l.shape,h),2),m=_Yo10[0],b=gt(_Yo10[1]),y=t.makeOutput(m,l.dtype);if(0!==gt(l.shape)){var _e135=t.dataIdMap.get(y.dataId).id;sf(u,b,Ul[y.dtype],_e135)}if(f&&t.disposeData(c.dataId),o){var _e136=Qo(y.shape,p);y.shape=_e136}return y}},lf={kernelName:"Range",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.step,s=n.dtype,i=Cd(r,a,o,s),u=t.makeOutput([i.length],s);return t.typedArrayFromHeap(u).set(i),u}},cf=Ql("RealDiv",!0),df=Xl("Relu"),pf=Xl("Relu6"),hf={kernelName:"ResizeBilinear",backendName:"wasm",setupFunc:function setupFunc(e){ff=e.wasm.cwrap("ResizeBilinear",null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var m,t=e.backend,n=e.inputs,r=e.attrs,a=n.images,o=r.alignCorners,s=r.halfPixelCenters,_i37=_slicedToArray(r.size,2),u=_i37[0],l=_i37[1],_a$shape=_slicedToArray(a.shape,4),c=_a$shape[0],d=_a$shape[1],p=_a$shape[2],f=_a$shape[3],h=[c,u,l,f],g=t.dataIdMap.get(a.dataId);"float32"!==g.dtype&&(m=mc({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),g=t.dataIdMap.get(m.dataId));var b=g.id,y=t.makeOutput(h,"float32");if(0===gt(a.shape))return y;var x=t.dataIdMap.get(y.dataId).id;return ff(b,c,d,p,f,u,l,o?1:0,s?1:0,x),null!=m&&t.disposeData(m.dataId),y}},gf={kernelName:"Reverse",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,s=It(r.dims,a.shape);if(0===a.shape.length)return tc({inputs:{x:a},backend:n});var i=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(a.dataId).id,l=n.dataIdMap.get(i.dataId).id,c=new Uint8Array(new Int32Array(s).buffer),d=new Uint8Array(new Int32Array(a.shape).buffer);mf(u,c,s.length,d,a.shape.length,l);var p=dc({inputs:{x:i},attrs:{shape:a.shape},backend:n});return n.disposeData(i.dataId),p},setupFunc:function setupFunc(e){mf=e.wasm.cwrap("Reverse",null,["number","array","number","array","number","number"])}},yf={kernelName:"RotateWithOffset",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=r.radians,s=r.fillValue,i=r.center,u=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(u.dataId).id,_a$shape2=_slicedToArray(a.shape,4),d=_a$shape2[0],p=_a$shape2[1],f=_a$shape2[2],h=_a$shape2[3],_tu2=_slicedToArray(tu(i,p,f),2),m=_tu2[0],g=_tu2[1],b="number"==typeof s?[s,s,s,0===s?0:255]:[].concat(_toConsumableArray(s),[255]),y=new Uint8Array(new Int32Array(b).buffer);return bf(l,d,p,f,h,o,m,g,y,b.length,c),u},setupFunc:function setupFunc(e){bf=e.wasm.cwrap("RotateWithOffset",null,["number","number","number","number","number","number","number","number","array","number","number"])}},xf=Xl("Round");function If(e){var t=e.inputs.x,_e$attrs3=e.attrs,n=_e$attrs3.begin,r=_e$attrs3.size,a=e.backend,_aa4=_slicedToArray(aa(t,n,r),2),o=_aa4[0],s=_aa4[1],i=na(t.shape,o,s),u=a.readSync(t.dataId),l=a.makeOutput(s,t.dtype),c=Ot(t.shape),d=a.dataIdMap.get(l.dataId);if(i){var _e137=ra(o,c);return"string"===t.dtype?d.stringBytes=u.slice(_e137,_e137+gt(s)):a.typedArrayFromHeap(l).set(u.subarray(_e137,_e137+gt(s))),l}if("string"===t.dtype){var _e138=_d(u,o,s,t.shape,t.dtype);return d.stringBytes=_e138,l}var p=a.typedArrayFromHeap(l),f=t.shape.length;if(2===f)!function(e,t,n,r,a){for(var o=0,s=r[0],i=r[1],u=s+a[0],_r151=s;_r151<u;_r151++){var _s62=_r151*t+i;n.set(e.subarray(_s62,_s62+a[1]),o),o+=a[1]}}(u,c[0],p,o,s);else if(3===f)!function(e,t,n,r,a,o){for(var s=0,i=a[0],u=a[1],l=a[2],c=i+o[0],d=u+o[1],_a131=i;_a131<c;_a131++)for(var _i38=u;_i38<d;_i38++){var _u25=_a131*t+_i38*n+l;r.set(e.subarray(_u25,_u25+o[2]),s),s+=o[2]}}(u,c[0],c[1],p,o,s);else if(4===f)!function(e,t,n,r,a,o,s){for(var i=0,u=o[0],l=o[1],c=o[2],d=u+s[0],p=l+s[1],f=c+s[2],h=o[3],_o94=u;_o94<d;_o94++)for(var _u26=l;_u26<p;_u26++)for(var _l8=c;_l8<f;_l8++){var _c6=_o94*t+_u26*n+_l8*r+h;a.set(e.subarray(_c6,_c6+s[3]),i),i+=s[3]}}(u,c[0],c[1],c[2],p,o,s);else{var _e139=_d(u,o,s,t.shape,t.dtype);p.set(_e139)}return l}for(var _i39=0,_$f=[Yl,Zl,ec,uc,cc,hc,gc,bc,xc,Ud,jd,qd,Kd,Qd,Jd,tp,rp,ap,op,ip,{kernelName:"Fill",backendName:"wasm",kernelFunc:function kernelFunc(e){var _e$attrs=e.attrs,t=_e$attrs.shape,n=_e$attrs.value,r=_e$attrs.dtype,a=e.backend,o=a.makeOutput(t,r);return a.typedArrayFromHeap(o).fill(n),o}},cp,dp,pp,Kl,hp,gp,yp,vp,wp,Ip,Np,nc,Cp,Ep,Sp,_p,$p,Ap,Fp,Mp,Pp,Bp,zp,Wp,Vp,jp,qp,Xp,Yp,Zp,{kernelName:"OnesLike",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}},ef,nf,rf,of,uf,lf,cf,df,pf,pc,hf,gf,yf,Xl("Rsqrt"),xf,{kernelName:"ScatterNd",backendName:"wasm",setupFunc:function setupFunc(e){vf=e.wasm.cwrap("ScatterNd",null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.indices,o=n.updates,s=r.shape,i=t.makeOutput(s,o.dtype);if(0===gt(s))return i;var _Ur=Ur(0,a,s),u=_Ur.sliceRank,l=_Ur.numUpdates,c=_Ur.sliceSize,d=_Ur.strides,p=_Ur.outputSize,f=t.dataIdMap.get(a.dataId).id,h=t.dataIdMap.get(o.dataId).id,m=new Uint8Array(new Int32Array(d).buffer),g=t.dataIdMap.get(i.dataId).id;return vf(f,h,Ul[o.dtype],u,l,c,m,p,g),i}},{kernelName:"Select",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,o=t.e,s=n.dataIdMap.get(r.dataId).id,i=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(o.dataId).id,l=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(l.dataId).id,d=r.shape.length,p=a.shape.length,f=0===d||d>1||1===p?1:gt(a.shape.slice(1));return kf(s,i,u,f,c),l},setupFunc:function setupFunc(e){kf=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}},{kernelName:"Sigmoid",backendName:"wasm",setupFunc:function setupFunc(e){wf=e.wasm.cwrap("Sigmoid",null,["number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs.x,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(a.dataId).id;return 0===gt(a.shape)||wf(r,o),a}},Xl("Sin"),{kernelName:"Slice",backendName:"wasm",kernelFunc:If},{kernelName:"Softmax",backendName:"wasm",setupFunc:function setupFunc(e){Nf=e.wasm.cwrap("Softmax",null,["number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs.logits,r=e.attrs.dim,a=t.dataIdMap.get(n.dataId).id,o=t.makeOutput(n.shape,n.dtype),s=t.dataIdMap.get(o.dataId).id,i=n.shape[r],u=gt(n.shape)/i;return 0===gt(o.shape)||Nf(a,s,i,u),o}},{kernelName:"SplitV",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=n.numOrSizeSplits,i=It(n.axis,a.shape)[0],u=gu(a,o,i),l=new Array(a.shape.length).fill(0),c=a.shape.slice();return u.map((function(e){var t=_toConsumableArray(c);t[i]=e;var n=If({inputs:{x:a},attrs:{begin:l,size:t},backend:r});return l[i]+=e,n}))}},Xl("Sqrt"),Xl("Square"),Ql("SquaredDifference",!0),{kernelName:"Step",backendName:"wasm",setupFunc:function setupFunc(e){Tf=e.wasm.cwrap("Step",null,["number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,a=e.attrs.alpha,o=n.x,s=t.dataIdMap.get(o.dataId).id,i=t.makeOutput(o.shape,o.dtype),u=t.dataIdMap.get(i.dataId).id;return Tf(s,a,u),i}},{kernelName:"StridedSlice",backendName:"wasm",setupFunc:function setupFunc(e){Cf=e.wasm.cwrap("StridedSlice",null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,o=r.begin,s=r.end,i=r.strides;null==i&&(i=new Array(o.length));var u=r.beginMask,l=r.endMask,c=r.ellipsisMask,d=r.newAxisMask,p=r.shrinkAxisMask,f=jr(c);if(f.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==c&&0!==d)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==c&&0!==p)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var h=a.shape.length-o.length,m=jr(d),g=a.shape.slice();m.forEach((function(e){o[e]=0,s[e]=1,g.splice(e,0,1)}));var b=dc({inputs:{x:a},attrs:{shape:g},backend:t}),_Yr2=Yr(b.shape,f,h,o,s,i,u,l,c),y=_Yr2.begin,x=_Yr2.end,v=_Yr2.strides;o=y,s=x,i=v;var k=jr(p);k.forEach((function(e){s[e]=o[e]+1,i[e]=1}));var w=Gr(o,s,i),I=w.filter((function(e,t){return-1===k.indexOf(t)}));if(i.every((function(e){return 1===e}))){var _e140=If({inputs:{x:b},attrs:{begin:o,size:w},backend:t});t.disposeData(b.dataId);var _n64=dc({inputs:{x:_e140},attrs:{shape:I},backend:t});return t.disposeData(_e140.dataId),_n64}var N=t.makeOutput(I,"float32");if(!I.some((function(e){return 0===e}))){var _e141=t.dataIdMap.get(b.dataId).id,_n65=new Uint8Array(new Int32Array(Ot(b.shape)).buffer),_r152=new Uint8Array(new Int32Array(o).buffer),_a132=new Uint8Array(new Int32Array(s).buffer),_u27=new Uint8Array(new Int32Array(i).buffer),_l9=new Uint8Array(new Int32Array(I).buffer),_c7=new Uint8Array(new Int32Array(Ot(I)).buffer),_d10=t.dataIdMap.get(N.dataId).id;Cf(_e141,_n65,b.shape.length,_r152,_a132,_u27,_l9,_c7,I.length,_d10)}t.disposeData(b.dataId);var T=dc({inputs:{x:N},attrs:{shape:I},backend:t});return t.disposeData(N.dataId),T}},Ql("Sub",!0),{kernelName:"Sum",backendName:"wasm",setupFunc:function setupFunc(e){Ef=e.wasm.cwrap("Sum",null,["number, number, number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,s=n.x,i=t.dataIdMap.get(s.dataId).id,u=i,l=s,_sc6=sc(s,a,t),c=_sc6.transposed,d=_sc6.axes,p=_sc6.originalAxes,f=_sc6.inputWasTransposed,h=d;if(f){var _e142=t.dataIdMap.get(c.dataId).id;_e142!==i&&(l=c,u=_e142,h=ts(h.length,l.shape.length))}Zo("sum",h,l.shape.length);var _Yo12=_slicedToArray(Yo(l.shape,h),2),m=_Yo12[0],b=gt(_Yo12[1]),y=t.makeOutput(m,l.dtype);if(0!==gt(l.shape)){var _e143=t.dataIdMap.get(y.dataId).id;Ef(u,b,_e143)}if(f&&t.disposeData(c.dataId),o){var _e144=Qo(y.shape,p);y.shape=_e144}return y}},Xl("Tanh"),{kernelName:"Tile",backendName:"wasm",setupFunc:function setupFunc(e){Sf=e.wasm.cwrap("Tile",null,["number","array","number","array","number","number"])},kernelFunc:function kernelFunc(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=n.dataIdMap.get(a.dataId).id,s=r.reps,i=new Array(a.shape.length),_e145=0;_e145<i.length;_e145++)i[_e145]=a.shape[_e145]*s[_e145];var u=new Uint8Array(new Int32Array(a.shape).buffer),l=new Uint8Array(new Int32Array(i).buffer),c=n.makeOutput(i,a.dtype),d=n.dataIdMap.get(c.dataId).id;return Sf(o,u,a.shape.length,l,i.length,Ul[c.dtype],d),c}},{kernelName:"TopK",backendName:"wasm",setupFunc:function setupFunc(e){_f=e.wasm.cwrap("TopK",null,["number","array","number","number","number","bool","number","number"])},kernelFunc:function kernelFunc(_ref27){var e=_ref27.inputs,t=_ref27.backend,n=_ref27.attrs,r=e.x,a=n.k,o=n.sorted,s=t.dataIdMap.get(r.dataId).id,i=new Uint8Array(new Int32Array(r.shape).buffer),u=r.shape.slice();u[u.length-1]=a;var l=t.makeOutput(u,r.dtype),c=t.dataIdMap.get(l.dataId).id,d=t.makeOutput(u,"int32"),p=t.dataIdMap.get(d.dataId).id;return _f(s,i,r.shape.length,Ul[r.dtype],a,o,c,p),[l,d]}},oc,{kernelName:"Unpack",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,o=r.axis;o<0&&(o+=a.shape.length);for(var s=a.shape[o],i=a.shape.length,u=new Array(i-1),l=0,_e146=0;_e146<i;_e146++)_e146!==o&&(u[l++]=a.shape[_e146]);var c=new Array(s),d=new Array(i).fill(0),p=a.shape.slice();p[o]=1;for(var _e147=0;_e147<c.length;_e147++)d[o]=_e147,c[_e147]=If({inputs:{x:a},attrs:{begin:d,size:p},backend:n});return c.map((function(_ref28){return{dataId:_ref28.dataId,dtype:_ref28.dtype,shape:u}}))}},{kernelName:"ZerosLike",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}}];_i39<_$f.length;_i39++){nn(_$f[_i39])}var Rf=jt();function Af(e,t){for(var n=0,r=e.length-1;r>=0;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}Rf.registerFlag("WASM_HAS_SIMD_SUPPORT",_asyncToGenerator(regeneratorRuntime.mark((function _callee40(){return regeneratorRuntime.wrap((function _callee40$(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:return _context41.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 1:case"end":return _context41.stop()}}),_callee40)})))),Rf.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",_asyncToGenerator(regeneratorRuntime.mark((function _callee41(){return regeneratorRuntime.wrap((function _callee41$(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:if(!Rf.get("IS_NODE")){_context42.next=2;break}return _context42.abrupt("return",!1);case 2:return _context42.prev=2,_context42.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))));case 6:return _context42.prev=6,_context42.t0=_context42.catch(2),_context42.abrupt("return",!1);case 9:case"end":return _context42.stop()}}),_callee41,null,[[2,6]])}))));var Ff=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Of=function Of(e){return Ff.exec(e).slice(1)};function Mf(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var r=n>=0?arguments[n]:"/";if("string"!=typeof r)throw new TypeError("Arguments to path.resolve must be strings");r&&(e=r+"/"+e,t="/"===r.charAt(0))}return(t?"/":"")+(e=Af(Hf(e.split("/"),(function(e){return!!e})),!t).join("/"))||"."}function Df(e){var t=Pf(e),n="/"===Gf(e,-1);return(e=Af(Hf(e.split("/"),(function(e){return!!e})),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function Pf(e){return"/"===e.charAt(0)}function Lf(){var e=Array.prototype.slice.call(arguments,0);return Df(Hf(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))}function Bf(e,t){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=Mf(e).substr(1),t=Mf(t).substr(1);for(var r=n(e.split("/")),a=n(t.split("/")),o=Math.min(r.length,a.length),s=o,i=0;i<o;i++)if(r[i]!==a[i]){s=i;break}var u=[];for(i=s;i<r.length;i++)u.push("..");return(u=u.concat(a.slice(s))).join("/")}function zf(e){var t=Of(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."}function Wf(e,t){var n=Of(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n}function Vf(e){return Of(e)[3]}var Uf={extname:Vf,basename:Wf,dirname:zf,sep:"/",delimiter:":",relative:Bf,join:Lf,isAbsolute:Pf,normalize:Df,resolve:Mf};function Hf(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}var jf,Gf="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)},qf=Object.freeze({__proto__:null,resolve:Mf,normalize:Df,isAbsolute:Pf,join:Lf,relative:Bf,sep:"/",delimiter:":",dirname:zf,basename:Wf,extname:Vf,default:Uf}),Kf=Object.freeze({__proto__:null,default:{}});function Xf(){if(void 0===jf){var e=new ArrayBuffer(2),t=new Uint8Array(e),n=new Uint16Array(e);if(t[0]=1,t[1]=2,258===n[0])jf="BE";else{if(513!==n[0])throw new Error("unable to figure out endianess");jf="LE"}}return jf}function Yf(){return void 0!==global.location?global.location.hostname:""}function Qf(){return[]}function Zf(){return 0}function Jf(){return Number.MAX_VALUE}function eh(){return Number.MAX_VALUE}function th(){return[]}function nh(){return"Browser"}function rh(){return void 0!==global.navigator?global.navigator.appVersion:""}function ah(){}function oh(){}function sh(){return"/tmp"}var ih=sh,uh={EOL:"\n",tmpdir:ih,tmpDir:sh,networkInterfaces:ah,getNetworkInterfaces:oh,release:rh,type:nh,cpus:th,totalmem:eh,freemem:Jf,uptime:Zf,loadavg:Qf,hostname:Yf,endianness:Xf},lh=Object.freeze({__proto__:null,endianness:Xf,hostname:Yf,loadavg:Qf,uptime:Zf,freemem:Jf,totalmem:eh,cpus:th,type:nh,release:rh,networkInterfaces:ah,getNetworkInterfaces:oh,arch:function arch(){return"javascript"},platform:function platform(){return"browser"},tmpDir:sh,tmpdir:ih,EOL:"\n",default:uh}),ch=H(qf),dh=H(Kf),ph=H(lh),fh=U((function(e,t){var n,r=(n=(n="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||__filename,function(e){function t(){return _.buffer!=A&&Q(_.buffer),F}function r(){return _.buffer!=A&&Q(_.buffer),O}function a(){return _.buffer!=A&&Q(_.buffer),M}function o(){return _.buffer!=A&&Q(_.buffer),D}function s(){return _.buffer!=A&&Q(_.buffer),P}var i,u,l=void 0!==(e=e||{})?e:{};l.ready=new Promise((function(e,t){i=e,u=t}));var c,d={};for(c in l)l.hasOwnProperty(c)&&(d[c]=l[c]);var f,h,m,g,p=function p(e,t){throw t};f="object"==("undefined"==typeof window?"undefined":_typeof(window)),h="function"==typeof importScripts,m="object"==(void 0===process?"undefined":_typeof(process))&&"object"==_typeof(process.versions)&&"string"==typeof process.versions.node,g=!f&&!m&&!h;var b=l.ENVIRONMENT_IS_PTHREAD||!1;b&&(A=l.buffer);var y,x,v,k,w,I="";function N(e){return l.locateFile?l.locateFile(e,I):I+e}if(m){var T;I=h?ch.dirname(I)+"/":__dirname+"/",y=function y(e,t){return k||(k=Rs),w||(w=ch),e=w.normalize(e),k.readFileSync(e,t?null:"utf8")},v=function v(e){var t=y(e,!0);return t.buffer||(t=new Uint8Array(t)),B(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof nn))throw e})),process.on("unhandledRejection",he),p=function p(e){process.exit(e)},l.inspect=function(){return"[Emscripten Module object]"};try{T=dh}catch(e){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),e}W.Worker=T.Worker}else g?("undefined"!=typeof read&&(y=function y(e){return read(e)}),v=function v(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(B("object"==_typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs&&scriptArgs,"function"==typeof quit&&(p=function p(e){quit(e)}),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(f||h)&&(h?I=self.location.href:"undefined"!=typeof document&&document.currentScript&&(I=document.currentScript.src),void 0!==n&&n&&(I=n),I=0!==I.indexOf("blob:")?I.substr(0,I.lastIndexOf("/")+1):"",m?(y=function y(e,t){return k||(k=Rs),w||(w=ch),e=w.normalize(e),k.readFileSync(e,t?null:"utf8")},v=function v(e){var t=y(e,!0);return t.buffer||(t=new Uint8Array(t)),B(t.buffer),t}):(y=function y(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},h&&(v=function v(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),x=function x(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}));m&&"undefined"==typeof performance&&(W.performance=dh.performance);var C,E=l.print||console.log.bind(console),S=l.printErr||console.warn.bind(console);for(c in d)d.hasOwnProperty(c)&&(l[c]=d[c]);d=null,l.arguments&&l.arguments,l.thisProgram&&l.thisProgram,l.quit&&(p=l.quit),l.wasmBinary&&(C=l.wasmBinary);var _,$,R=l.noExitRuntime||!0;"object"!=("undefined"==typeof WebAssembly?"undefined":_typeof(WebAssembly))&&he("no native wasm support detected");var A,F,O,M,D,P,L=!1;function B(e,t){e||he("Assertion failed: "+t)}function z(e){var t=l["_"+e];return B(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function V(e,t,n,r,a){var o={string:function string(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);q(e,t=Qt(n),n)}return t},array:function array(e){var t=Qt(e.length);return X(e,t),t}},s=z(e),i=[],u=0;if(r)for(var l=0;l<r.length;l++){var c=o[n[l]];c?(0===u&&(u=Xt()),i[l]=c(r[l])):i[l]=r[l]}var d=s.apply(null,i);return d=function(e){return"string"===t?j(e):"boolean"===t?Boolean(e):e}(d),0!==u&&Yt(u),d}function H(e,t,n){for(var r=t+n,a="";!(t>=r);){var o=e[t++];if(!o)return a;if(128&o){var s=63&e[t++];if(192!=(224&o)){var i=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|i:(7&o)<<18|s<<12|i<<6|63&e[t++])<65536)a+=String.fromCharCode(o);else{var u=o-65536;a+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}function j(e,t){return e?H(r(),e,t):""}function q(e,t,n){return function G(e,t,n,r){if(!(r>0))return 0;for(var a=n,o=n+r-1,s=0;s<e.length;++s){var i=e.charCodeAt(s);if(i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++s)),i<=127){if(n>=o)break;t[n++]=i}else if(i<=2047){if(n+1>=o)break;t[n++]=192|i>>6,t[n++]=128|63&i}else if(i<=65535){if(n+2>=o)break;t[n++]=224|i>>12,t[n++]=128|i>>6&63,t[n++]=128|63&i}else{if(n+3>=o)break;t[n++]=240|i>>18,t[n++]=128|i>>12&63,t[n++]=128|i>>6&63,t[n++]=128|63&i}}return t[n]=0,n-a}(e,r(),t,n)}function X(e,n){t().set(e,n)}function Y(e,t){return e%t>0&&(e+=t-e%t),e}function Q(e){A=e,l.HEAP8=F=new Int8Array(e),l.HEAP16=new Int16Array(e),l.HEAP32=M=new Int32Array(e),l.HEAPU8=O=new Uint8Array(e),l.HEAPU16=new Uint16Array(e),l.HEAPU32=D=new Uint32Array(e),l.HEAPF32=new Float32Array(e),l.HEAPF64=P=new Float64Array(e)}var Z,J=l.INITIAL_MEMORY||16777216;if(b)_=l.wasmMemory,A=l.buffer;else if(l.wasmMemory)_=l.wasmMemory;else if(!((_=new WebAssembly.Memory({initial:J/65536,maximum:32768,shared:!0})).buffer instanceof SharedArrayBuffer))throw S("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),m&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");_&&(A=_.buffer),J=A.byteLength,Q(A);var ee=[],te=[],ne=[],re=[];function ue(e){ee.unshift(e)}function le(e){re.unshift(e)}b||te.push({func:function func(){Mt()}});var ce=0,de=null;function he(e){l.onAbort&&l.onAbort(e),b&&console.error("Pthread aborting at "+(new Error).stack),S(e+=""),L=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw u(t),t}function me(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}l.preloadedImages={},l.preloadedAudios={};function be(e){return me(e,"data:application/octet-stream;base64,")}function xe(e){return me(e,"file://")}var ve="tfjs-backend-wasm-threaded-simd.wasm";function ke(e){try{if(e==ve&&C)return new Uint8Array(C);if(v)return v(e);throw"both async and sync fetching of the wasm failed"}catch(e){he(e)}}be(ve)||(ve=N(ve));var Ne={8991:function _(e,t){setTimeout((function(){Ht(e,t)}),0)}};function Ce(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?Z.get(n)():Z.get(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(l)}}function Ee(e,n){if(e<=0||e>t().length||!0&e||n<0)return-28;if(0==n)return 0;n>=2147483647&&(n=1/0);var r=Atomics.load(a(),tn>>2),o=0;if(r==e&&Atomics.compareExchange(a(),tn>>2,r,0)==r&&(o=1,--n<=0))return 1;var s=Atomics.notify(a(),e>>2,n);if(s>=0)return s+o;throw"Atomics.notify returned an unexpected value "+s}function Se(e){if(b)throw"Internal Error! killThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in killThread!";a()[e+12>>2]=0;var t=Ae.pthreads[e];t.worker.terminate(),Ae.freeThreadData(t),Ae.runningWorkers.splice(Ae.runningWorkers.indexOf(t.worker),1),t.worker.pthread=void 0}function $e(e){if(b)throw"Internal Error! cleanupThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in cleanupThread!";a()[e+12>>2]=0;var t=Ae.pthreads[e];if(t){var n=t.worker;Ae.returnWorkerToPool(n)}}l._emscripten_futex_wake=Ee;var Re,Ae={unusedWorkers:[],runningWorkers:[],initMainThreadBlock:function initMainThreadBlock(){for(var e=0;e<8;++e)Ae.allocateUnusedWorker()},initRuntime:function initRuntime(){for(var e=Dt(228),t=0;t<57;++t)o()[e/4+t]=0;a()[e+12>>2]=e;var n=e+152;a()[n>>2]=n;var r=Dt(512);for(t=0;t<128;++t)o()[r/4+t]=0;Atomics.store(o(),e+100>>2,r),Atomics.store(o(),e+40>>2,e),Kt(e,!h,1),Ut(e)},initWorker:function initWorker(){},pthreads:{},threadExitHandlers:[],setThreadStatus:function setThreadStatus(){},runExitHandlers:function runExitHandlers(){for(;Ae.threadExitHandlers.length>0;)Ae.threadExitHandlers.pop()();b&&zt()&&Wt()},threadExit:function threadExit(e){var t=zt();t&&(Atomics.store(o(),t+4>>2,e),Atomics.store(o(),t+0>>2,1),Atomics.store(o(),t+56>>2,1),Atomics.store(o(),t+60>>2,0),Ae.runExitHandlers(),Ee(t+0,2147483647),Kt(0,0,0),b&&postMessage({cmd:"exit"}))},threadCancel:function threadCancel(){Ae.runExitHandlers();var e=zt();Atomics.store(o(),e+4>>2,-1),Atomics.store(o(),e+0>>2,1),Ee(e+0,2147483647),Kt(0,0,0),postMessage({cmd:"cancelDone"})},terminateAllThreads:function terminateAllThreads(){for(var e in Ae.pthreads)(r=Ae.pthreads[e])&&r.worker&&Ae.returnWorkerToPool(r.worker);Ae.pthreads={};for(var t=0;t<Ae.unusedWorkers.length;++t)(n=Ae.unusedWorkers[t]).terminate();for(Ae.unusedWorkers=[],t=0;t<Ae.runningWorkers.length;++t){var n,r=(n=Ae.runningWorkers[t]).pthread;Ae.freeThreadData(r),n.terminate()}Ae.runningWorkers=[]},freeThreadData:function freeThreadData(e){if(e){if(e.threadInfoStruct){var t=a()[e.threadInfoStruct+100>>2];a()[e.threadInfoStruct+100>>2]=0,Pt(t),Pt(e.threadInfoStruct)}e.threadInfoStruct=0,e.allocatedOwnStack&&e.stackBase&&Pt(e.stackBase),e.stackBase=0,e.worker&&(e.worker.pthread=null)}},returnWorkerToPool:function returnWorkerToPool(e){Ae.runWithoutMainThreadQueuedCalls((function(){delete Ae.pthreads[e.pthread.threadInfoStruct],Ae.unusedWorkers.push(e),Ae.runningWorkers.splice(Ae.runningWorkers.indexOf(e),1),Ae.freeThreadData(e.pthread),e.pthread=void 0}))},runWithoutMainThreadQueuedCalls:function runWithoutMainThreadQueuedCalls(e){a()[en>>2]=0;try{e()}finally{a()[en>>2]=1}},receiveObjectTransfer:function receiveObjectTransfer(e){},loadWasmModuleToWorker:function loadWasmModuleToWorker(e,t){e.onmessage=function(n){var r=n.data,a=r.cmd;if(e.pthread&&(Ae.currentProxiedOperationCallerThread=e.pthread.threadInfoStruct),r.targetThread&&r.targetThread!=zt()){var s=Ae.pthreads[r.targetThread];return s?s.worker.postMessage(n.data,r.transferList):console.error('Internal error! Worker sent a message "'+a+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(Ae.currentProxiedOperationCallerThread=void 0)}if("processQueuedMainThreadWork"===a)Vt();else if("spawnThread"===a)_t(n.data);else if("cleanupThread"===a)$e(r.thread);else if("killThread"===a)Se(r.thread);else if("cancelThread"===a)!function _e(e){if(b)throw"Internal Error! cancelThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in cancelThread!";Ae.pthreads[e].worker.postMessage({cmd:"cancel"})}(r.thread);else if("loaded"===a)e.loaded=!0,t&&t(e),e.runPthread&&(e.runPthread(),delete e.runPthread);else if("print"===a)E("Thread "+r.threadId+": "+r.text);else if("printErr"===a)S("Thread "+r.threadId+": "+r.text);else if("alert"===a)alert("Thread "+r.threadId+": "+r.text);else if("exit"===a)e.pthread&&Atomics.load(o(),e.pthread.threadInfoStruct+64>>2)&&Ae.returnWorkerToPool(e);else if("exitProcess"===a)try{!function an(e,t){if(!t||!R||0!==e){if(!t&&b)throw postMessage({cmd:"exitProcess",returnCode:e}),new nn(e);R||(Ae.terminateAllThreads(),l.onExit&&l.onExit(e),L=!0),p(e,new nn(e))}}(r.returnCode)}catch(n){if(n instanceof nn)return;throw n}else"cancelDone"===a?Ae.returnWorkerToPool(e):"objectTransfer"===a?Ae.receiveObjectTransfer(n.data):"setimmediate"===n.data.target?e.postMessage(n.data):S("worker sent an unknown command "+a);Ae.currentProxiedOperationCallerThread=void 0},e.onerror=function(e){S("pthread sent an error! "+e.filename+":"+e.lineno+": "+e.message)},m&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("exit",(function(e){}))),e.postMessage({cmd:"load",urlOrBlob:l.mainScriptUrlOrBlob||n,wasmMemory:_,wasmModule:$})},allocateUnusedWorker:function allocateUnusedWorker(){var e=N("tfjs-backend-wasm-threaded-simd.worker.js");Ae.unusedWorkers.push(new Worker(e))},getNewWorker:function getNewWorker(){return 0==Ae.unusedWorkers.length&&(Ae.allocateUnusedWorker(),Ae.loadWasmModuleToWorker(Ae.unusedWorkers[0])),Ae.unusedWorkers.length>0?Ae.unusedWorkers.pop():null},busySpinWait:function busySpinWait(e){for(var t=performance.now()+e;performance.now()<t;);}};function qe(e,t){for(var n=arguments.length-2,r=Xt(),a=n,o=Qt(8*a),i=o>>3,u=0;u<n;u++){var l=arguments[2+u];s()[i+u]=l}var c=Gt(e,a,o,t);return Yt(r),c}l.establishStackSpace=function Fe(e,t){Zt(e,t),Yt(e)},l.getNoExitRuntime=function Oe(){return R},l.invokeEntryPoint=function Me(e,t){return Z.get(e)(t)},Re=m?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:b?function(){return performance.now()-l.__performance_now_clock_drift}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var Ke=[],Xe=[];function Ye(e,t){var n;for(Xe.length=0,t>>=2;n=r()[e++];){var o=n<105;o&&1&t&&t++,Xe.push(o?s()[t++>>1]:a()[t]),++t}return Xe}function Ze(){return r().length}function Je(e){try{return _.grow(e-A.byteLength+65535>>>16),Q(_.buffer),1}catch(e){}}var tt={inEventHandler:0,removeAllEventListeners:function removeAllEventListeners(){for(var e=tt.eventHandlers.length-1;e>=0;--e)tt._removeHandler(e);tt.eventHandlers=[],tt.deferredCalls=[]},registerRemoveEventListeners:function registerRemoveEventListeners(){tt.removeEventListenersRegistered||(tt.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function deferCall(e,t,n){function r(e,t){if(e.length!=t.length)return!1;for(var n in e)if(e[n]!=t[n])return!1;return!0}for(var a in tt.deferredCalls){var o=tt.deferredCalls[a];if(o.targetFunction==e&&r(o.argsList,n))return}tt.deferredCalls.push({targetFunction:e,precedence:t,argsList:n}),tt.deferredCalls.sort((function(e,t){return e.precedence<t.precedence}))},removeDeferredCalls:function removeDeferredCalls(e){for(var t=0;t<tt.deferredCalls.length;++t)tt.deferredCalls[t].targetFunction==e&&(tt.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function canPerformEventHandlerRequests(){return tt.inEventHandler&&tt.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function runDeferredCalls(){if(tt.canPerformEventHandlerRequests())for(var e=0;e<tt.deferredCalls.length;++e){var t=tt.deferredCalls[e];tt.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:function removeAllHandlersOnTarget(e,t){for(var n=0;n<tt.eventHandlers.length;++n)tt.eventHandlers[n].target!=e||t&&t!=tt.eventHandlers[n].eventTypeString||tt._removeHandler(n--)},_removeHandler:function _removeHandler(e){var t=tt.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),tt.eventHandlers.splice(e,1)},registerOrRemoveHandler:function registerOrRemoveHandler(e){var t=function t(_t110){++tt.inEventHandler,tt.currentEventHandler=e,tt.runDeferredCalls(),e.handlerFunc(_t110),tt.runDeferredCalls(),--tt.inEventHandler};if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),tt.eventHandlers.push(e),tt.registerRemoveEventListeners();else for(var n=0;n<tt.eventHandlers.length;++n)tt.eventHandlers[n].target==e.target&&tt.eventHandlers[n].eventTypeString==e.eventTypeString&&tt._removeHandler(n--)},queueEventHandlerOnThread_iiii:function queueEventHandlerOnThread_iiii(e,t,n,r,o){var s=Xt(),i=Qt(12);a()[i>>2]=n,a()[i+4>>2]=r,a()[i+8>>2]=o,qt(0,e,637534208,t,r,i),Yt(s)},getTargetThreadForEventCallback:function getTargetThreadForEventCallback(e){switch(e){case 1:return 0;case 2:return Ae.currentProxiedOperationCallerThread;default:return e}},getNodeNameForTarget:function getNodeNameForTarget(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function fullscreenEnabled(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function rt(e,t,n,r){var o=Xt(),s=Qt(12),i=0;t&&(i=function nt(e){var t=function K(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}(e)+1,n=Dt(t);return q(e,n,t),n}(t)),a()[s>>2]=i,a()[s+4>>2]=n,a()[s+8>>2]=r,qt(0,e,657457152,0,i,s),Yt(o)}var st=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0];function it(e){return e=function ot(e){return e>2?j(e):e}(e),st[e]||("undefined"!=typeof document?document.querySelector(e):void 0)}function ut(e){return it(e)}function lt(e,t,n){var r=ut(e);if(!r)return-4;if(r.canvasSharedPtr&&(a()[r.canvasSharedPtr>>2]=t,a()[r.canvasSharedPtr+4>>2]=n),!r.offscreenCanvas&&r.controlTransferredOffscreen)return r.canvasSharedPtr?(function at(e,t,n,r){rt(e,t=t?j(t):"",n,r)}(a()[r.canvasSharedPtr+8>>2],e,t,n),1):-4;r.offscreenCanvas&&(r=r.offscreenCanvas);var o=!1;if(r.GLctxObject&&r.GLctxObject.GLctx){var s=r.GLctxObject.GLctx.getParameter(2978);o=0===s[0]&&0===s[1]&&s[2]===r.width&&s[3]===r.height}return r.width=t,r.height=n,o&&r.GLctxObject.GLctx.viewport(0,0,t,n),0}function ct(e,t,n){return b?qe(2,1,e,t,n):lt(e,t,n)}var yt={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:{},offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,recordError:function recordError(e){yt.lastError||(yt.lastError=e)},getNewId:function getNewId(e){for(var t=yt.counter++,n=e.length;n<t;n++)e[n]=null;return t},getSource:function getSource(e,t,n,r){for(var o="",s=0;s<t;++s){var i=r?a()[r+4*s>>2]:-1;o+=j(a()[n+4*s>>2],i<0?void 0:i)}return o},createContext:function createContext(e,t){var n=e.getContext("webgl",t);return n?yt.registerContext(n,t):0},registerContext:function registerContext(e,t){var n=Dt(8);a()[n+4>>2]=zt();var r={handle:n,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=r),yt.contexts[n]=r,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&yt.initExtensions(r),n},makeContextCurrent:function makeContextCurrent(e){return yt.currentContext=yt.contexts[e],l.ctx=wt=yt.currentContext&&yt.currentContext.GLctx,!(e&&!wt)},getContext:function getContext(e){return yt.contexts[e]},deleteContext:function deleteContext(e){yt.currentContext===yt.contexts[e]&&(yt.currentContext=null),"object"==_typeof(tt)&&tt.removeAllHandlersOnTarget(yt.contexts[e].GLctx.canvas),yt.contexts[e]&&yt.contexts[e].GLctx.canvas&&(yt.contexts[e].GLctx.canvas.GLctxObject=void 0),Pt(yt.contexts[e].handle),yt.contexts[e]=null},initExtensions:function initExtensions(e){if(e||(e=yt.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t=e.GLctx;(function ht(e){var t=e.getExtension("ANGLE_instanced_arrays");if(t)return e.vertexAttribDivisor=function(e,n){t.vertexAttribDivisorANGLE(e,n)},e.drawArraysInstanced=function(e,n,r,a){t.drawArraysInstancedANGLE(e,n,r,a)},e.drawElementsInstanced=function(e,n,r,a,o){t.drawElementsInstancedANGLE(e,n,r,a,o)},1})(t),function mt(e){var t=e.getExtension("OES_vertex_array_object");if(t)return e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)},1}(t),function gt(e){var t=e.getExtension("WEBGL_draw_buffers");if(t)return e.drawBuffers=function(e,n){t.drawBuffersWEBGL(e,n)},1}(t),t.disjointTimerQueryExt=t.getExtension("EXT_disjoint_timer_query"),function bt(e){return!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw"))}(t),(t.getSupportedExtensions()||[]).forEach((function(e){e.indexOf("lose_context")<0&&e.indexOf("debug")<0&&t.getExtension(e)}))}},populateUniformTable:function populateUniformTable(e){for(var t=yt.programs[e],n=yt.programInfos[e]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1},r=n.uniforms,a=wt.getProgramParameter(t,35718),o=0;o<a;++o){var s=wt.getActiveUniform(t,o),i=s.name;n.maxUniformLength=Math.max(n.maxUniformLength,i.length+1),"]"==i.slice(-1)&&(i=i.slice(0,i.lastIndexOf("[")));var u=wt.getUniformLocation(t,i);if(u){var l=yt.getNewId(yt.uniforms);r[i]=[s.size,l],yt.uniforms[l]=u;for(var c=1;c<s.size;++c){var d=i+"["+c+"]";u=wt.getUniformLocation(t,d),l=yt.getNewId(yt.uniforms),yt.uniforms[l]=u}}}}},xt=["default","low-power","high-performance"];var wt,It={mappings:{},buffers:[null,[],[]],printChar:function printChar(e,t){var n=It.buffers[e];0===t||10===t?((1===e?E:S)(H(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function get(){return It.varargs+=4,a()[It.varargs-4>>2]},getStr:function getStr(e){return j(e)},get64:function get64(e,t){return e}};function Nt(e){return b?qe(3,1,e):0}function Tt(e,t,n,r,a){if(b)return qe(4,1,e,t,n,r,a)}function Ct(e,t,n,o){if(b)return qe(5,1,e,t,n,o);for(var s=0,i=0;i<n;i++){for(var u=a()[t+8*i>>2],l=a()[t+(8*i+4)>>2],c=0;c<l;c++)It.printChar(e,r()[u+c]);s+=l}return a()[o>>2]=s,0}function _t(e){if(b)throw"Internal Error! spawnThread() can only ever be called from main application thread!";var t=Ae.getNewWorker();if(void 0!==t.pthread)throw"Internal error!";if(!e.pthread_ptr)throw"Internal error, no pthread ptr!";Ae.runningWorkers.push(t);for(var n=Dt(512),r=0;r<128;++r)a()[n+4*r>>2]=0;var s=e.stackBase+e.stackSize,i=Ae.pthreads[e.pthread_ptr]={worker:t,stackBase:e.stackBase,stackSize:e.stackSize,allocatedOwnStack:e.allocatedOwnStack,threadInfoStruct:e.pthread_ptr},u=i.threadInfoStruct>>2;Atomics.store(o(),u+16,e.detached),Atomics.store(o(),u+25,n),Atomics.store(o(),u+10,i.threadInfoStruct),Atomics.store(o(),u+20,e.stackSize),Atomics.store(o(),u+19,s),Atomics.store(o(),u+26,e.stackSize),Atomics.store(o(),u+28,s),Atomics.store(o(),u+29,e.detached);var l=Bt()+40;Atomics.store(o(),u+43,l),t.pthread=i;var c={cmd:"run",start_routine:e.startRoutine,arg:e.arg,threadInfoStruct:e.pthread_ptr,stackBase:e.stackBase,stackSize:e.stackSize};t.runPthread=function(){c.time=performance.now(),t.postMessage(c,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread)}function Rt(e){if(b)return qe(6,1,e);switch(e){case 30:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==("undefined"==typeof navigator?"undefined":_typeof(navigator))&&navigator.hardwareConcurrency||1}return function Le(e){return a()[Lt()>>2]=e,e}(28),-1}b||Ae.initMainThreadBlock();var At,Ft=[null,function Be(e,t){if(b)return qe(1,1,e,t)},ct,Nt,Tt,Ct,Rt],Ot={e:function De(e,t,n,r){he("Assertion failed: "+j(e)+", at: "+[t?j(t):"unknown filename",n,r?j(r):"unknown function"])},r:function Pe(e,t){_main(e,t)},x:function ze(e,t){if(e==t)postMessage({cmd:"processQueuedMainThreadWork"});else if(b)postMessage({targetThread:e,cmd:"processThreadQueue"});else{var n=Ae.pthreads[e],r=n&&n.worker;if(!r)return;r.postMessage({cmd:"processThreadQueue"})}return 1},b:function We(){he()},y:function Ve(e,t,n){var r=Ye(t,n);return Ne[e].apply(null,r)},j:function Ue(e,t){},c:function He(e,n,r){if(e<=0||e>t().length||!0&e)return-28;if(f){if(Atomics.load(a(),e>>2)!=n)return-6;var o=performance.now(),s=o+r;for(Atomics.exchange(a(),tn>>2,e);;){if((o=performance.now())>s)return Atomics.exchange(a(),tn>>2,0),-73;if(0==Atomics.exchange(a(),tn>>2,0))break;if(Vt(),Atomics.load(a(),e>>2)!=n)return-6;Atomics.exchange(a(),tn>>2,e)}return 0}var i=Atomics.wait(a(),e>>2,n,r);if("timed-out"===i)return-73;if("not-equal"===i)return-6;if("ok"===i)return 0;throw"Atomics.wait returned an unexpected value "+i},d:Ee,f:Re,p:function je(e,t,n){r().copyWithin(e,t,t+n)},z:function Ge(){return m?ph.cpus().length:navigator.hardwareConcurrency},u:function Qe(e,t,n){Ke.length=t;for(var r=n>>3,a=0;a<t;a++)Ke[a]=s()[r+a];return(e<0?Ne[-e-1]:Ft[e]).apply(null,Ke)},q:function et(e){var t=Ze();if(e<=t)return!1;var n=2147483648;if(e>n)return!1;for(var r=1;r<=4;r*=2){var a=t*(1+.2/r);if(a=Math.min(a,e+100663296),Je(Math.min(n,Y(Math.max(e,a),65536))))return!0}return!1},v:function dt(e,t,n){return ut(e)?lt(e,t,n):ct(e,t,n)},i:function pt(e){},t:function ft(e,t){},w:function kt(e,t){return function vt(e,t){var n=t>>2,r=a()[n+6],o={alpha:!!a()[n+0],depth:!!a()[n+1],stencil:!!a()[n+2],antialias:!!a()[n+3],premultipliedAlpha:!!a()[n+4],preserveDrawingBuffer:!!a()[n+5],powerPreference:xt[r],failIfMajorPerformanceCaveat:!!a()[n+7],majorVersion:a()[n+8],minorVersion:a()[n+9],enableExtensionsByDefault:a()[n+10],explicitSwapControl:a()[n+11],proxyContextToMainThread:a()[n+12],renderViaOffscreenBackBuffer:a()[n+13]},s=ut(e);return s?o.explicitSwapControl?0:yt.createContext(s,o):0}(e,t)},m:Nt,n:Tt,g:Ct,o:function Te(){Ae.initRuntime()},a:_||l.wasmMemory,k:function Et(e){var t=Ae.threadExitHandlers.pop();e&&t()},l:function St(e,t){Ae.threadExitHandlers.push((function(){Z.get(e)(t)}))},h:function $t(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return S("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;if(!e)return S("pthread_create called with a null thread pointer!"),28;var s=[];if(b&&0===s.length)return jt(687865856,e,t,n,r);var i=0,u=0,l=0;t&&-1!=t?(i=a()[t>>2],i+=81920,u=a()[t+8>>2],l=0!==a()[t+12>>2]):i=2097152;var c=0==u;c?u=Jt(16,i):B((u-=i)>0);for(var d=Dt(228),p=0;p<57;++p)o()[(d>>2)+p]=0;a()[e>>2]=d,a()[d+12>>2]=d;var f=d+152;a()[f>>2]=f;var h={stackBase:u,stackSize:i,allocatedOwnStack:c,detached:l,startRoutine:n,pthread_ptr:d,arg:r,transferList:s};return b?(h.cmd="spawnThread",postMessage(h,s)):_t(h),0},s:Rt},Mt=(function Ie(){var e={a:Ot};function t(e,t){var n=e.exports;if(l.asm=n,Z=l.asm.F,$=t,!b){var r=Ae.unusedWorkers.length;Ae.unusedWorkers.forEach((function(e){Ae.loadWasmModuleToWorker(e,(function(){--r||function fe(e){if(ce--,l.monitorRunDependencies&&l.monitorRunDependencies(ce),0==ce&&de){var t=de;de=null,t()}}()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return function we(){if(!C&&(f||h)){if("function"==typeof fetch&&!xe(ve))return fetch(ve,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ve+"'";return e.arrayBuffer()})).catch((function(){return ke(ve)}));if(x)return new Promise((function(e,t){x(ve,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return ke(ve)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){S("failed to asynchronously prepare wasm: "+e),he(e)}))}if(b||function pe(e){B(!b,"addRunDependency cannot be used in a pthread worker"),ce++,l.monitorRunDependencies&&l.monitorRunDependencies(ce)}(),l.instantiateWasm)try{return l.instantiateWasm(e,t)}catch(e){return S("Module.instantiateWasm callback failed with error: "+e),!1}return(C||"function"!=typeof WebAssembly.instantiateStreaming||be(ve)||xe(ve)||"function"!=typeof fetch?r(n):fetch(ve,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return S("wasm streaming compile failed: "+e),S("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(u),{}}(),l.___wasm_call_ctors=function(){return(Mt=l.___wasm_call_ctors=l.asm.A).apply(null,arguments)}),Dt=(l._init=function(){return(l._init=l.asm.B).apply(null,arguments)},l._register_tensor=function(){return(l._register_tensor=l.asm.C).apply(null,arguments)},l._dispose_data=function(){return(l._dispose_data=l.asm.D).apply(null,arguments)},l._dispose=function(){return(l._dispose=l.asm.E).apply(null,arguments)},l._Abs=function(){return(l._Abs=l.asm.G).apply(null,arguments)},l._Add=function(){return(l._Add=l.asm.H).apply(null,arguments)},l._AddN=function(){return(l._AddN=l.asm.I).apply(null,arguments)},l._ArgMax=function(){return(l._ArgMax=l.asm.J).apply(null,arguments)},l._AvgPool=function(){return(l._AvgPool=l.asm.K).apply(null,arguments)},l._BatchMatMul=function(){return(l._BatchMatMul=l.asm.L).apply(null,arguments)},l._Ceil=function(){return(l._Ceil=l.asm.M).apply(null,arguments)},l._ClipByValue=function(){return(l._ClipByValue=l.asm.N).apply(null,arguments)},l._Conv2D=function(){return(l._Conv2D=l.asm.O).apply(null,arguments)},l._Conv2DBackpropInput=function(){return(l._Conv2DBackpropInput=l.asm.P).apply(null,arguments)},l._Cos=function(){return(l._Cos=l.asm.Q).apply(null,arguments)},l._CropAndResize=function(){return(l._CropAndResize=l.asm.R).apply(null,arguments)},l._Cumsum=function(){return(l._Cumsum=l.asm.S).apply(null,arguments)},l._DepthToSpace=function(){return(l._DepthToSpace=l.asm.T).apply(null,arguments)},l._DepthwiseConv2dNative=function(){return(l._DepthwiseConv2dNative=l.asm.U).apply(null,arguments)},l._Equal=function(){return(l._Equal=l.asm.V).apply(null,arguments)},l._Exp=function(){return(l._Exp=l.asm.W).apply(null,arguments)},l._FlipLeftRight=function(){return(l._FlipLeftRight=l.asm.X).apply(null,arguments)},l._Floor=function(){return(l._Floor=l.asm.Y).apply(null,arguments)},l._FloorDiv=function(){return(l._FloorDiv=l.asm.Z).apply(null,arguments)},l._FusedBatchNorm=function(){return(l._FusedBatchNorm=l.asm._).apply(null,arguments)},l._FusedConv2D=function(){return(l._FusedConv2D=l.asm.$).apply(null,arguments)},l._FusedDepthwiseConv2D=function(){return(l._FusedDepthwiseConv2D=l.asm.aa).apply(null,arguments)},l._Gather=function(){return(l._Gather=l.asm.ba).apply(null,arguments)},l._GatherNd=function(){return(l._GatherNd=l.asm.ca).apply(null,arguments)},l._Greater=function(){return(l._Greater=l.asm.da).apply(null,arguments)},l._GreaterEqual=function(){return(l._GreaterEqual=l.asm.ea).apply(null,arguments)},l._LeakyRelu=function(){return(l._LeakyRelu=l.asm.fa).apply(null,arguments)},l._Less=function(){return(l._Less=l.asm.ga).apply(null,arguments)},l._LessEqual=function(){return(l._LessEqual=l.asm.ha).apply(null,arguments)},l._Log=function(){return(l._Log=l.asm.ia).apply(null,arguments)},l._LogicalAnd=function(){return(l._LogicalAnd=l.asm.ja).apply(null,arguments)},l._Max=function(){return(l._Max=l.asm.ka).apply(null,arguments)},l._MaxPool=function(){return(l._MaxPool=l.asm.la).apply(null,arguments)},l._Maximum=function(){return(l._Maximum=l.asm.ma).apply(null,arguments)},l._Mean=function(){return(l._Mean=l.asm.na).apply(null,arguments)},l._Min=function(){return(l._Min=l.asm.oa).apply(null,arguments)},l._Minimum=function(){return(l._Minimum=l.asm.pa).apply(null,arguments)},l._Multiply=function(){return(l._Multiply=l.asm.qa).apply(null,arguments)},l._Neg=function(){return(l._Neg=l.asm.ra).apply(null,arguments)},l._NonMaxSuppressionV3=function(){return(l._NonMaxSuppressionV3=l.asm.sa).apply(null,arguments)},l._NonMaxSuppressionV4=function(){return(l._NonMaxSuppressionV4=l.asm.ta).apply(null,arguments)},l._NonMaxSuppressionV5=function(){return(l._NonMaxSuppressionV5=l.asm.ua).apply(null,arguments)},l._NotEqual=function(){return(l._NotEqual=l.asm.va).apply(null,arguments)},l._OneHot=function(){return(l._OneHot=l.asm.wa).apply(null,arguments)},l._PadV2=function(){return(l._PadV2=l.asm.xa).apply(null,arguments)},l._Pow=function(){return(l._Pow=l.asm.ya).apply(null,arguments)},l._Prelu=function(){return(l._Prelu=l.asm.za).apply(null,arguments)},l._Prod=function(){return(l._Prod=l.asm.Aa).apply(null,arguments)},l._RealDiv=function(){return(l._RealDiv=l.asm.Ba).apply(null,arguments)},l._Relu=function(){return(l._Relu=l.asm.Ca).apply(null,arguments)},l._Relu6=function(){return(l._Relu6=l.asm.Da).apply(null,arguments)},l._ResizeBilinear=function(){return(l._ResizeBilinear=l.asm.Ea).apply(null,arguments)},l._Reverse=function(){return(l._Reverse=l.asm.Fa).apply(null,arguments)},l._RotateWithOffset=function(){return(l._RotateWithOffset=l.asm.Ga).apply(null,arguments)},l._Round=function(){return(l._Round=l.asm.Ha).apply(null,arguments)},l._Rsqrt=function(){return(l._Rsqrt=l.asm.Ia).apply(null,arguments)},l._ScatterNd=function(){return(l._ScatterNd=l.asm.Ja).apply(null,arguments)},l._SelectV2=function(){return(l._SelectV2=l.asm.Ka).apply(null,arguments)},l._Sigmoid=function(){return(l._Sigmoid=l.asm.La).apply(null,arguments)},l._Sin=function(){return(l._Sin=l.asm.Ma).apply(null,arguments)},l._Softmax=function(){return(l._Softmax=l.asm.Na).apply(null,arguments)},l._Sqrt=function(){return(l._Sqrt=l.asm.Oa).apply(null,arguments)},l._Square=function(){return(l._Square=l.asm.Pa).apply(null,arguments)},l._SquaredDifference=function(){return(l._SquaredDifference=l.asm.Qa).apply(null,arguments)},l._Step=function(){return(l._Step=l.asm.Ra).apply(null,arguments)},l._StridedSlice=function(){return(l._StridedSlice=l.asm.Sa).apply(null,arguments)},l._Sub=function(){return(l._Sub=l.asm.Ta).apply(null,arguments)},l._Sum=function(){return(l._Sum=l.asm.Ua).apply(null,arguments)},l._Tanh=function(){return(l._Tanh=l.asm.Va).apply(null,arguments)},l._Tile=function(){return(l._Tile=l.asm.Wa).apply(null,arguments)},l._TopK=function(){return(l._TopK=l.asm.Xa).apply(null,arguments)},l._Transpose=function(){return(l._Transpose=l.asm.Ya).apply(null,arguments)},l.__FusedMatMul=function(){return(l.__FusedMatMul=l.asm.Za).apply(null,arguments)},l._malloc=function(){return(Dt=l._malloc=l.asm._a).apply(null,arguments)}),Pt=l._free=function(){return(Pt=l._free=l.asm.$a).apply(null,arguments)},Lt=l.___errno_location=function(){return(Lt=l.___errno_location=l.asm.ab).apply(null,arguments)},Bt=l._emscripten_get_global_libc=function(){return(Bt=l._emscripten_get_global_libc=l.asm.bb).apply(null,arguments)},zt=l._pthread_self=function(){return(zt=l._pthread_self=l.asm.cb).apply(null,arguments)},Wt=l.___pthread_tsd_run_dtors=function(){return(Wt=l.___pthread_tsd_run_dtors=l.asm.db).apply(null,arguments)},Vt=l._emscripten_main_thread_process_queued_calls=function(){return(Vt=l._emscripten_main_thread_process_queued_calls=l.asm.eb).apply(null,arguments)},Ut=(l._emscripten_current_thread_process_queued_calls=function(){return(l._emscripten_current_thread_process_queued_calls=l.asm.fb).apply(null,arguments)},l._emscripten_register_main_browser_thread_id=function(){return(Ut=l._emscripten_register_main_browser_thread_id=l.asm.gb).apply(null,arguments)}),Ht=l.__emscripten_do_dispatch_to_thread=function(){return(Ht=l.__emscripten_do_dispatch_to_thread=l.asm.hb).apply(null,arguments)},jt=l._emscripten_sync_run_in_main_thread_4=function(){return(jt=l._emscripten_sync_run_in_main_thread_4=l.asm.ib).apply(null,arguments)},Gt=l._emscripten_run_in_main_runtime_thread_js=function(){return(Gt=l._emscripten_run_in_main_runtime_thread_js=l.asm.jb).apply(null,arguments)},qt=l.__emscripten_call_on_thread=function(){return(qt=l.__emscripten_call_on_thread=l.asm.kb).apply(null,arguments)},Kt=(l._emscripten_tls_init=function(){return(l._emscripten_tls_init=l.asm.lb).apply(null,arguments)},l.__emscripten_thread_init=function(){return(Kt=l.__emscripten_thread_init=l.asm.mb).apply(null,arguments)}),Xt=l.stackSave=function(){return(Xt=l.stackSave=l.asm.nb).apply(null,arguments)},Yt=l.stackRestore=function(){return(Yt=l.stackRestore=l.asm.ob).apply(null,arguments)},Qt=l.stackAlloc=function(){return(Qt=l.stackAlloc=l.asm.pb).apply(null,arguments)},Zt=l._emscripten_stack_set_limits=function(){return(Zt=l._emscripten_stack_set_limits=l.asm.qb).apply(null,arguments)},Jt=l._memalign=function(){return(Jt=l._memalign=l.asm.rb).apply(null,arguments)},en=l.__emscripten_allow_main_runtime_queued_calls=9880,tn=l.__emscripten_main_thread_futex=11368;function nn(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function rn(e){if(!(ce>0)){if(b)return i(l),void postMessage({cmd:"loaded"});(function ae(){if(!b){if(l.preRun)for("function"==typeof l.preRun&&(l.preRun=[l.preRun]);l.preRun.length;)ue(l.preRun.shift());Ce(ee)}})(),ce>0||(l.setStatus?(l.setStatus("Running..."),setTimeout((function(){setTimeout((function(){l.setStatus("")}),1),t()}),1)):t())}function t(){At||(At=!0,l.calledRun=!0,L||(function oe(){Ce(te)}(),function se(){b||Ce(ne)}(),i(l),l.onRuntimeInitialized&&l.onRuntimeInitialized(),function ie(){if(!b){if(l.postRun)for("function"==typeof l.postRun&&(l.postRun=[l.postRun]);l.postRun.length;)le(l.postRun.shift());Ce(re)}}()))}}if(l.cwrap=function U(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&a&&!r?z(e):function(){return V(e,t,n,arguments)}},l.PThread=Ae,l.PThread=Ae,l.wasmMemory=_,l.ExitStatus=nn,de=function e(){At||rn(),At||(de=e)},l.run=rn,l.preInit)for("function"==typeof l.preInit&&(l.preInit=[l.preInit]);l.preInit.length>0;)l.preInit.pop()();return b&&(R=!1,Ae.initWorker()),rn(),e.ready});e.exports=r})),hh=U((function(e,t){var n,r=(n=(n="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||__filename,function(e){var t,r,a=void 0!==(e=e||{})?e:{};a.ready=new Promise((function(e,n){t=e,r=n}));var o,s={};for(o in a)a.hasOwnProperty(o)&&(s[o]=a[o]);var i,u,l,c;i="object"==("undefined"==typeof window?"undefined":_typeof(window)),u="function"==typeof importScripts,l="object"==(void 0===process?"undefined":_typeof(process))&&"object"==_typeof(process.versions)&&"string"==typeof process.versions.node,c=!i&&!l&&!u;var d,p,f,h,m,g="";l?(g=u?ch.dirname(g)+"/":__dirname+"/",d=function d(e,t){return h||(h=Rs),m||(m=ch),e=m.normalize(e),h.readFileSync(e,t?null:"utf8")},f=function f(e){var t=d(e,!0);return t.buffer||(t=new Uint8Array(t)),I(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof Ce))throw e})),process.on("unhandledRejection",ee),a.inspect=function(){return"[Emscripten Module object]"}):c?("undefined"!=typeof read&&(d=function d(e){return read(e)}),f=function f(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(I("object"==_typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs&&scriptArgs,"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(i||u)&&(u?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),n&&(g=n),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",d=function d(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},u&&(f=function f(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),p=function p(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var y,x,v=a.print||console.log.bind(console),k=a.printErr||console.warn.bind(console);for(o in s)s.hasOwnProperty(o)&&(a[o]=s[o]);s=null,a.arguments&&a.arguments,a.thisProgram&&a.thisProgram,a.quit&&a.quit,a.wasmBinary&&(y=a.wasmBinary),a.noExitRuntime,"object"!=("undefined"==typeof WebAssembly?"undefined":_typeof(WebAssembly))&&ee("no native wasm support detected");var w=!1;function I(e,t){e||ee("Assertion failed: "+t)}function N(e){var t=a["_"+e];return I(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function T(e,t,n,r,a){var o={string:function string(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);!function M(e,t,n){return function O(e,t,n,r){if(!(r>0))return 0;for(var a=n,o=n+r-1,s=0;s<e.length;++s){var i=e.charCodeAt(s);if(i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++s)),i<=127){if(n>=o)break;t[n++]=i}else if(i<=2047){if(n+1>=o)break;t[n++]=192|i>>6,t[n++]=128|63&i}else if(i<=65535){if(n+2>=o)break;t[n++]=224|i>>12,t[n++]=128|i>>6&63,t[n++]=128|63&i}else{if(n+3>=o)break;t[n++]=240|i>>18,t[n++]=128|i>>12&63,t[n++]=128|i>>6&63,t[n++]=128|63&i}}return t[n]=0,n-a}(e,_,t,n)}(e,t=Te(n),n)}return t},array:function array(e){var t=Te(e.length);return function D(e,t){S.set(e,t)}(e,t),t}},s=N(e),i=[],u=0;if(r)for(var l=0;l<r.length;l++){var c=o[n[l]];c?(0===u&&(u=Ie()),i[l]=c(r[l])):i[l]=r[l]}var d=s.apply(null,i);return d=function(e){return"string"===t?F(e):"boolean"===t?Boolean(e):e}(d),0!==u&&Ne(u),d}var E,S,_,$,R="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function A(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.subarray&&R)return R.decode(e.subarray(t,a));for(var o="";t<a;){var s=e[t++];if(128&s){var i=63&e[t++];if(192!=(224&s)){var u=63&e[t++];if((s=224==(240&s)?(15&s)<<12|i<<6|u:(7&s)<<18|i<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var l=s-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&s)<<6|i)}else o+=String.fromCharCode(s)}return o}function F(e,t){return e?A(_,e,t):""}function P(e,t){return e%t>0&&(e+=t-e%t),e}function L(e){E=e,a.HEAP8=S=new Int8Array(e),a.HEAP16=new Int16Array(e),a.HEAP32=$=new Int32Array(e),a.HEAPU8=_=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAPU32=new Uint32Array(e),a.HEAPF32=new Float32Array(e),a.HEAPF64=new Float64Array(e)}a.INITIAL_MEMORY;var B,z=[],W=[],V=[],U=[];function K(e){z.unshift(e)}function X(e){U.unshift(e)}W.push({func:function func(){we()}});var Y=0,Q=null;function ee(e){a.onAbort&&a.onAbort(e),k(e+=""),w=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw r(t),t}function te(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}a.preloadedImages={},a.preloadedAudios={};function re(e){return te(e,"data:application/octet-stream;base64,")}function oe(e){return te(e,"file://")}var se="tfjs-backend-wasm.wasm";function ie(e){try{if(e==se&&y)return new Uint8Array(y);if(f)return f(e);throw"both async and sync fetching of the wasm failed"}catch(e){ee(e)}}function ce(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?B.get(n)():B.get(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(a)}}function he(e){try{return x.grow(e-E.byteLength+65535>>>16),L(x.buffer),1}catch(e){}}re(se)||(se=function b(e){return a.locateFile?a.locateFile(e,g):g+e}(se));var ge={mappings:{},buffers:[null,[],[]],printChar:function printChar(e,t){var n=ge.buffers[e];0===t||10===t?((1===e?v:k)(A(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function get(){return ge.varargs+=4,$[ge.varargs-4>>2]},getStr:function getStr(e){return F(e)},get64:function get64(e,t){return e}};var ve,ke={a:function de(){ee()},d:function pe(e,t,n){_.copyWithin(e,t,t+n)},e:function me(e){var t=function fe(){return _.length}(),n=2147483648;if(e>n)return!1;for(var r=1;r<=4;r*=2){var a=t*(1+.2/r);if(a=Math.min(a,e+100663296),he(Math.min(n,P(Math.max(e,a),65536))))return!0}return!1},f:function be(e){return 0},c:function ye(e,t,n,r,a){},b:function xe(e,t,n,r){for(var a=0,o=0;o<n;o++){for(var s=$[t+8*o>>2],i=$[t+(8*o+4)>>2],u=0;u<i;u++)ge.printChar(e,_[s+u]);a+=i}return $[r>>2]=a,0}},we=(function le(){var e={a:ke};function t(e,t){var n=e.exports;a.asm=n,L((x=a.asm.g).buffer),B=a.asm.m,function J(e){if(Y--,a.monitorRunDependencies&&a.monitorRunDependencies(Y),0==Y&&Q){var t=Q;Q=null,t()}}()}function n(e){t(e.instance)}function o(t){return function ue(){if(!y&&(i||u)){if("function"==typeof fetch&&!oe(se))return fetch(se,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+se+"'";return e.arrayBuffer()})).catch((function(){return ie(se)}));if(p)return new Promise((function(e,t){p(se,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return ie(se)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){k("failed to asynchronously prepare wasm: "+e),ee(e)}))}if(function Z(e){Y++,a.monitorRunDependencies&&a.monitorRunDependencies(Y)}(),a.instantiateWasm)try{return a.instantiateWasm(e,t)}catch(e){return k("Module.instantiateWasm callback failed with error: "+e),!1}return(y||"function"!=typeof WebAssembly.instantiateStreaming||re(se)||oe(se)||"function"!=typeof fetch?o(n):fetch(se,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return k("wasm streaming compile failed: "+e),k("falling back to ArrayBuffer instantiation"),o(n)}))}))).catch(r),{}}(),a.___wasm_call_ctors=function(){return(we=a.___wasm_call_ctors=a.asm.h).apply(null,arguments)}),Ie=(a._init=function(){return(a._init=a.asm.i).apply(null,arguments)},a._register_tensor=function(){return(a._register_tensor=a.asm.j).apply(null,arguments)},a._dispose_data=function(){return(a._dispose_data=a.asm.k).apply(null,arguments)},a._dispose=function(){return(a._dispose=a.asm.l).apply(null,arguments)},a._Abs=function(){return(a._Abs=a.asm.n).apply(null,arguments)},a._Add=function(){return(a._Add=a.asm.o).apply(null,arguments)},a._AddN=function(){return(a._AddN=a.asm.p).apply(null,arguments)},a._ArgMax=function(){return(a._ArgMax=a.asm.q).apply(null,arguments)},a._AvgPool=function(){return(a._AvgPool=a.asm.r).apply(null,arguments)},a._BatchMatMul=function(){return(a._BatchMatMul=a.asm.s).apply(null,arguments)},a._Ceil=function(){return(a._Ceil=a.asm.t).apply(null,arguments)},a._ClipByValue=function(){return(a._ClipByValue=a.asm.u).apply(null,arguments)},a._Conv2D=function(){return(a._Conv2D=a.asm.v).apply(null,arguments)},a._Conv2DBackpropInput=function(){return(a._Conv2DBackpropInput=a.asm.w).apply(null,arguments)},a._Cos=function(){return(a._Cos=a.asm.x).apply(null,arguments)},a._CropAndResize=function(){return(a._CropAndResize=a.asm.y).apply(null,arguments)},a._Cumsum=function(){return(a._Cumsum=a.asm.z).apply(null,arguments)},a._DepthToSpace=function(){return(a._DepthToSpace=a.asm.A).apply(null,arguments)},a._DepthwiseConv2dNative=function(){return(a._DepthwiseConv2dNative=a.asm.B).apply(null,arguments)},a._Equal=function(){return(a._Equal=a.asm.C).apply(null,arguments)},a._Exp=function(){return(a._Exp=a.asm.D).apply(null,arguments)},a._FlipLeftRight=function(){return(a._FlipLeftRight=a.asm.E).apply(null,arguments)},a._Floor=function(){return(a._Floor=a.asm.F).apply(null,arguments)},a._FloorDiv=function(){return(a._FloorDiv=a.asm.G).apply(null,arguments)},a._FusedBatchNorm=function(){return(a._FusedBatchNorm=a.asm.H).apply(null,arguments)},a._FusedConv2D=function(){return(a._FusedConv2D=a.asm.I).apply(null,arguments)},a._FusedDepthwiseConv2D=function(){return(a._FusedDepthwiseConv2D=a.asm.J).apply(null,arguments)},a._Gather=function(){return(a._Gather=a.asm.K).apply(null,arguments)},a._GatherNd=function(){return(a._GatherNd=a.asm.L).apply(null,arguments)},a._Greater=function(){return(a._Greater=a.asm.M).apply(null,arguments)},a._GreaterEqual=function(){return(a._GreaterEqual=a.asm.N).apply(null,arguments)},a._LeakyRelu=function(){return(a._LeakyRelu=a.asm.O).apply(null,arguments)},a._Less=function(){return(a._Less=a.asm.P).apply(null,arguments)},a._LessEqual=function(){return(a._LessEqual=a.asm.Q).apply(null,arguments)},a._Log=function(){return(a._Log=a.asm.R).apply(null,arguments)},a._LogicalAnd=function(){return(a._LogicalAnd=a.asm.S).apply(null,arguments)},a._Max=function(){return(a._Max=a.asm.T).apply(null,arguments)},a._MaxPool=function(){return(a._MaxPool=a.asm.U).apply(null,arguments)},a._Maximum=function(){return(a._Maximum=a.asm.V).apply(null,arguments)},a._Mean=function(){return(a._Mean=a.asm.W).apply(null,arguments)},a._Min=function(){return(a._Min=a.asm.X).apply(null,arguments)},a._Minimum=function(){return(a._Minimum=a.asm.Y).apply(null,arguments)},a._Multiply=function(){return(a._Multiply=a.asm.Z).apply(null,arguments)},a._Neg=function(){return(a._Neg=a.asm._).apply(null,arguments)},a._NonMaxSuppressionV3=function(){return(a._NonMaxSuppressionV3=a.asm.$).apply(null,arguments)},a._NonMaxSuppressionV4=function(){return(a._NonMaxSuppressionV4=a.asm.aa).apply(null,arguments)},a._NonMaxSuppressionV5=function(){return(a._NonMaxSuppressionV5=a.asm.ba).apply(null,arguments)},a._NotEqual=function(){return(a._NotEqual=a.asm.ca).apply(null,arguments)},a._OneHot=function(){return(a._OneHot=a.asm.da).apply(null,arguments)},a._PadV2=function(){return(a._PadV2=a.asm.ea).apply(null,arguments)},a._Pow=function(){return(a._Pow=a.asm.fa).apply(null,arguments)},a._Prelu=function(){return(a._Prelu=a.asm.ga).apply(null,arguments)},a._Prod=function(){return(a._Prod=a.asm.ha).apply(null,arguments)},a._RealDiv=function(){return(a._RealDiv=a.asm.ia).apply(null,arguments)},a._Relu=function(){return(a._Relu=a.asm.ja).apply(null,arguments)},a._Relu6=function(){return(a._Relu6=a.asm.ka).apply(null,arguments)},a._ResizeBilinear=function(){return(a._ResizeBilinear=a.asm.la).apply(null,arguments)},a._Reverse=function(){return(a._Reverse=a.asm.ma).apply(null,arguments)},a._RotateWithOffset=function(){return(a._RotateWithOffset=a.asm.na).apply(null,arguments)},a._Round=function(){return(a._Round=a.asm.oa).apply(null,arguments)},a._Rsqrt=function(){return(a._Rsqrt=a.asm.pa).apply(null,arguments)},a._ScatterNd=function(){return(a._ScatterNd=a.asm.qa).apply(null,arguments)},a._SelectV2=function(){return(a._SelectV2=a.asm.ra).apply(null,arguments)},a._Sigmoid=function(){return(a._Sigmoid=a.asm.sa).apply(null,arguments)},a._Sin=function(){return(a._Sin=a.asm.ta).apply(null,arguments)},a._Softmax=function(){return(a._Softmax=a.asm.ua).apply(null,arguments)},a._Sqrt=function(){return(a._Sqrt=a.asm.va).apply(null,arguments)},a._Square=function(){return(a._Square=a.asm.wa).apply(null,arguments)},a._SquaredDifference=function(){return(a._SquaredDifference=a.asm.xa).apply(null,arguments)},a._Step=function(){return(a._Step=a.asm.ya).apply(null,arguments)},a._StridedSlice=function(){return(a._StridedSlice=a.asm.za).apply(null,arguments)},a._Sub=function(){return(a._Sub=a.asm.Aa).apply(null,arguments)},a._Sum=function(){return(a._Sum=a.asm.Ba).apply(null,arguments)},a._Tanh=function(){return(a._Tanh=a.asm.Ca).apply(null,arguments)},a._Tile=function(){return(a._Tile=a.asm.Da).apply(null,arguments)},a._TopK=function(){return(a._TopK=a.asm.Ea).apply(null,arguments)},a._Transpose=function(){return(a._Transpose=a.asm.Fa).apply(null,arguments)},a.__FusedMatMul=function(){return(a.__FusedMatMul=a.asm.Ga).apply(null,arguments)},a._malloc=function(){return(a._malloc=a.asm.Ha).apply(null,arguments)},a._free=function(){return(a._free=a.asm.Ia).apply(null,arguments)},a.stackSave=function(){return(Ie=a.stackSave=a.asm.Ja).apply(null,arguments)}),Ne=a.stackRestore=function(){return(Ne=a.stackRestore=a.asm.Ka).apply(null,arguments)},Te=a.stackAlloc=function(){return(Te=a.stackAlloc=a.asm.La).apply(null,arguments)};function Ce(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Ee(e){function n(){ve||(ve=!0,a.calledRun=!0,w||(function j(){ce(W)}(),function G(){ce(V)}(),t(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),function q(){if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)X(a.postRun.shift());ce(U)}()))}Y>0||(function H(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)K(a.preRun.shift());ce(z)}(),Y>0||(a.setStatus?(a.setStatus("Running..."),setTimeout((function(){setTimeout((function(){a.setStatus("")}),1),n()}),1)):n()))}if(a.cwrap=function C(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&a&&!r?N(e):function(){return T(e,t,n,arguments)}},Q=function e(){ve||Ee(),ve||(Q=e)},a.run=Ee,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return Ee(),e.ready});e.exports=r})),mh=function(_ut){_inherits(mh,_ut);var _read,_time2,_super2=_createSuper(mh);function mh(e){var _this44;return _classCallCheck(this,mh),(_this44=_super2.call(this)).wasm=e,_this44.dataIdNextNumber=1,_this44.wasm.tfjs.init(),_this44.dataIdMap=new it(_assertThisInitialized(_this44),ia()),_this44}return _createClass(mh,[{key:"write",value:function write(e,t,n){var r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}},{key:"numDataIds",value:function numDataIds(){return this.dataIdMap.numDataIds()}},{key:"time",value:(_time2=_asyncToGenerator(regeneratorRuntime.mark((function _callee42(e){var t;return regeneratorRuntime.wrap((function _callee42$(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:return t=sn(),e(),_context43.abrupt("return",{kernelMs:sn()-t});case 3:case"end":return _context43.stop()}}),_callee42)}))),function time(_x60){return _time2.apply(this,arguments)})},{key:"move",value:function move(e,t,n,r,a){var o=this.dataIdNextNumber++;if("string"!==r){var s=gt(n),i=s*_t(r),u=this.wasm._malloc(i);this.dataIdMap.set(e,{id:o,memoryOffset:u,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(o,s,u),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,i),u)}else{var _s63=t;this.dataIdMap.set(e,{id:o,stringBytes:_s63,shape:n,dtype:r,memoryOffset:null,refCount:a})}}},{key:"read",value:(_read=_asyncToGenerator(regeneratorRuntime.mark((function _callee43(e){return regeneratorRuntime.wrap((function _callee43$(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:return _context44.abrupt("return",this.readSync(e));case 1:case"end":return _context44.stop()}}),_callee43,this)}))),function read(_x61){return _read.apply(this,arguments)})},{key:"readSync",value:function readSync(e){var _this$dataIdMap$get=this.dataIdMap.get(e),t=_this$dataIdMap$get.memoryOffset,n=_this$dataIdMap$get.dtype,r=_this$dataIdMap$get.shape,a=_this$dataIdMap$get.stringBytes;return"string"===n?a:function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype ".concat(t))}}(this.wasm.HEAPU8.slice(t,t+gt(r)*_t(n)).buffer,n)}},{key:"disposeData",value:function disposeData(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.dataIdMap.has(e)){var n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}},{key:"refCount",value:function refCount(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}},{key:"incRef",value:function incRef(e){var t=this.dataIdMap.get(e);null!=t&&t.refCount++}},{key:"floatPrecision",value:function floatPrecision(){return 32}},{key:"getMemoryOffset",value:function getMemoryOffset(e){return this.dataIdMap.get(e).memoryOffset}},{key:"dispose",value:function dispose(){this.wasm.tfjs.dispose(),this.wasm=null}},{key:"memory",value:function memory(){return{unreliable:!1}}},{key:"makeOutput",value:function makeOutput(e,t,n){var r;if(null==n)r=this.write(null,e,t);else{var _a133=this.dataIdNextNumber++;r={id:_a133},this.dataIdMap.set(r,{id:_a133,memoryOffset:n,shape:e,dtype:t,refCount:1});var _o95=gt(e);this.wasm.tfjs.registerTensor(_a133,_o95,n)}return{dataId:r,shape:e,dtype:t}}},{key:"typedArrayFromHeap",value:function typedArrayFromHeap(_ref31){var e=_ref31.shape,t=_ref31.dtype,n=_ref31.dataId,r=this.wasm.HEAPU8.buffer,a=this.dataIdMap.get(n).memoryOffset,o=gt(e);switch(t){case"float32":return new Float32Array(r,a,o);case"int32":return new Int32Array(r,a,o);case"bool":return new Uint8Array(r,a,o);default:throw new Error("Unknown dtype ".concat(t))}}}]),mh}(ut);function gh(e){return function(t,n){return function(e,t){return jt().platform.fetch(e,{credentials:"same-origin"})}(e).then((function(r){r.ok||t.env.a("failed to load wasm binary file at '".concat(e,"'")),r.arrayBuffer().then((function(e){WebAssembly.instantiate(e,t).then((function(e){n(e.instance)}))}))})),{}}}function bh(e,t,n){var r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=kh&&null!=kh[r]?kh[r]:n+r}var yh=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],vh=null,kh={},wh=!1,Ih=!1;da("wasm",_asyncToGenerator(regeneratorRuntime.mark((function _callee45(){var _yield,e;return regeneratorRuntime.wrap((function _callee45$(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:return _context46.next=2,_asyncToGenerator(regeneratorRuntime.mark((function _callee44(){var _yield$Promise$all3,_yield$Promise$all4,e,t;return regeneratorRuntime.wrap((function _callee44$(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:return _context45.next=2,Promise.all([jt().getAsync("WASM_HAS_SIMD_SUPPORT"),jt().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);case 2:return _yield$Promise$all3=_context45.sent,_yield$Promise$all4=_slicedToArray(_yield$Promise$all3,2),e=_yield$Promise$all4[0],t=_yield$Promise$all4[1],_context45.abrupt("return",new Promise((function(n,r){var a={locateFile:function locateFile(n,r){if(n.endsWith(".worker.js")){var _e149=new Blob(['var Module={};function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;this.alert=threadAlert;Module["instantiateWasm"]=function(info,receiveInstance){var instance=new WebAssembly.Instance(Module["wasmModule"],info);Module["wasmModule"]=null;receiveInstance(instance);return instance.exports};function moduleLoaded(){}this.onmessage=function(e){try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob==="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module).then(function(instance){Module=instance;moduleLoaded()})}else if(e.data.cmd==="objectTransfer"){Module["PThread"].receiveObjectTransfer(e.data)}else if(e.data.cmd==="run"){Module["__performance_now_clock_drift"]=performance.now()-e.data.time;Module["__emscripten_thread_init"](e.data.threadInfoStruct,0,0);var max=e.data.stackBase;var top=e.data.stackBase+e.data.stackSize;Module["establishStackSpace"](top,max);Module["_emscripten_tls_init"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].setThreadStatus(Module["_pthread_self"](),1);try{var result=Module["invokeEntryPoint"](e.data.start_routine,e.data.arg);if(!Module["getNoExitRuntime"]())Module["PThread"].threadExit(result)}catch(ex){if(ex==="Canceled!"){Module["PThread"].threadCancel()}else if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["getNoExitRuntime"]()){}else{Module["PThread"].threadExit(ex.status)}}else{Module["PThread"].threadExit(-2);throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["PThread"].threadCancel()}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processThreadQueue"){if(Module["_pthread_self"]()){Module["_emscripten_current_thread_process_queued_calls"]()}}else{err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){err("worker.js onmessage() captured an uncaught exception: "+ex);if(ex&&ex.stack)err(ex.stack);throw ex}};if(typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string"){self={location:{href:__filename}};var onmessage=this.onmessage;var nodeWorkerThreads=require("worker_threads");global.Worker=nodeWorkerThreads.Worker;var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",function(data){onmessage({data:data})});var nodeFS=require("fs");var nodeRead=function(filename){return nodeFS.readFileSync(filename,"utf8")};function globalEval(x){global.require=require;global.Module=Module;eval.call(null,x)}importScripts=function(f){globalEval(nodeRead(f))};postMessage=function(msg){parentPort.postMessage(msg)};if(typeof performance==="undefined"){performance={now:function(){return Date.now()}}}}'],{type:"application/javascript"});return URL.createObjectURL(_e149)}return n.endsWith(".wasm")?bh(e,t,null!=vh?vh:r):r+n}};Ih&&(a.instantiateWasm=gh(bh(e,t,null!=vh?vh:"")));var o,s=!1;a.onAbort=function(){s||wh||(wh=!0,r({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))},t&&e?(a.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+fh.toString()],{type:"text/javascript"}),o=fh(a)):o=hh(a),o.then((function(e){s=!0,wh=!1,e.tfjs={init:e.cwrap("init",null,[]),registerTensor:e.cwrap("register_tensor",null,["number","number","number"]),disposeData:e.cwrap("dispose_data",null,["number"]),dispose:e.cwrap("dispose",null,[])},n({wasm:e})}))})));case 7:case"end":return _context45.stop()}}),_callee44)})))();case 2:return _yield=_context46.sent,e=_yield.wasm,_context46.abrupt("return",new mh(e));case 5:case"end":return _context46.stop()}}),_callee45)}))),2);var Eh,Sh,_h,Nh={},Th={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Ch(e){if(!(e in Nh)){var _t111=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Nh[e]}),!1),1===e?t.getContext("webgl",Th)||t.getContext("experimental-webgl",Th):t.getContext("webgl2",Th)}(e);if(null===_t111)return console.log("Could not get context for WebGL version",e),null;Nh[e]=_t111}var t=Nh[e];return t.isContextLost()?(delete Nh[e],Ch(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Nh[e])}function $h(e,t){return[t,e]}function Rh(e){var t=gt(e);return xt(Math.ceil(t/4))}function Ah(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Fh(e,t){var r,a,o,s,i,l,c,d,p,n=e;return 2===jt().getNumber("WEBGL_VERSION")?(r=n.R32F,a=n.R16F,o=n.RGBA16F,s=n.RGBA32F,i=n.RED,l=4,c=1,d=n.HALF_FLOAT,p=n.FLOAT):(r=e.RGBA,a=e.RGBA,o=e.RGBA,s=n.RGBA,i=e.RGBA,l=4,c=4,d=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:s,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:d,textureTypeFloat:p}}function Oh(e,t){var n=t();return jt().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}function Mh(e){return!!(jt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Dh(e,t){return jh(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Eh||(Eh={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Sh||(Sh={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(_h||(_h={}));var Qh,Zh,Lh=/ERROR: [0-9]+:([0-9]+):/g;function Bh(e,t){if(Oh(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function zh(e,t,n,r,a,o,s){var i=e.getAttribLocation(t,n);return-1!==i&&(Oh(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Oh(e,(function(){return e.vertexAttribPointer(i,a,e.FLOAT,!1,o,s)})),Oh(e,(function(){return e.enableVertexAttribArray(i)})),!0)}function Vh(e,t,n){Oh(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Oh(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function Uh(e,t){Oh(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),Oh(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function Hh(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function jh(e,t,n){var r=Oh(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function Gh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return gt(e.slice(0,e.length-t))}function qh(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Kh(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Gh(e)].concat(_toConsumableArray(qh(e)))),t}function Xh(e){return e%2==0}function Yh(e,t){if(bt(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],_r153=t.slice(-1)[0];if(n===_r153)return!0;if(Xh(n)&&Xh(_r153)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Xh(e[0])&&Xh(t[0])}function Jh(e,t){return null!=e.getExtension(t)}function em(e){try{if(null!=Ch(e))return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function nm(e){var t=Fh(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function rm(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&pt("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the WebGL backend.")}))}))}var am=jt();function om(){var e,t,n,r,a,o,s,i,u,l;return 2===jt().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",o="outputColor",s="out vec4 outputColor;",i="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",o="gl_FragColor",s="",i="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:o,defineOutput:s,defineSpecialNaN:i,defineSpecialInf:u,defineRound:l}}function sm(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Ot(t);return r.map((function(t,a){return"".concat("int ".concat(e[a]," = ").concat(n," / ").concat(t),"; ",a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t),";")})).join("")}function im(e){var t=Ot(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}am.registerFlag("HAS_WEBGL",(function(){return am.getNumber("WEBGL_VERSION")>0})),am.registerFlag("WEBGL_VERSION",(function(){return em(2)?2:em(1)?1:0})),am.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),am.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===am.get("WEBGL_VERSION")})),am.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),am.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),am.registerFlag("WEBGL_PACK",(function(){return am.getBool("HAS_WEBGL")})),am.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return am.getBool("WEBGL_PACK")})),am.registerFlag("WEBGL_PACK_CLIP",(function(){return am.getBool("WEBGL_PACK")})),am.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),am.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return am.getBool("WEBGL_PACK")})),am.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return am.getBool("WEBGL_PACK")})),am.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return am.getBool("WEBGL_PACK")})),am.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return am.getBool("WEBGL_PACK")})),am.registerFlag("WEBGL_PACK_REDUCE",(function(){return am.getBool("WEBGL_PACK")})),am.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return am.getBool("WEBGL_PACK")})),am.registerFlag("WEBGL_CONV_IM2COL",(function(){return am.getBool("WEBGL_PACK")})),am.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==Qh){var t=Ch(e);Qh=t.getParameter(t.MAX_TEXTURE_SIZE)}return Qh}(am.getNumber("WEBGL_VERSION"))})),am.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==Zh){var t=Ch(e);Zh=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Zh)}(am.getNumber("WEBGL_VERSION"))})),am.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=am.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var n=Ch(e);return Jh(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Jh(n,"EXT_disjoint_timer_query")?1:0}(e)})),am.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return am.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!zn()})),am.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=Ch(e);if(1===e){if(!Jh(t,"OES_texture_float"))return!1}else if(!Jh(t,"EXT_color_buffer_float"))return!1;return nm(t)}(am.getNumber("WEBGL_VERSION"))})),am.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!am.getBool("WEBGL_FORCE_F16_TEXTURES")&&am.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),am.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return function tm(e){if(0===e)return!1;var t=Ch(e);if(1!==e){if(Jh(t,"EXT_color_buffer_float"))return nm(t);var _e151="EXT_color_buffer_half_float";if(Jh(t,_e151)){var n=t.getExtension(_e151);return function(e,t){var n=Fh(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(s),i}(t,n)}return!1}return!!Jh(t,"OES_texture_float")&&(!!Jh(t,"WEBGL_color_buffer_float")&&nm(t))}(am.getNumber("WEBGL_VERSION"))})),am.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=am.getNumber("WEBGL_VERSION"))&&null!=Ch(e).fenceSync;var e})),am.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return am.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),am.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))})),am.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return zn()&&am.getBool("IS_CHROME")?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))}));var um="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",lm=function lm(e){_classCallCheck(this,lm),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Eh.DENSE;var t=Rh(e),n=om();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(sm(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(t[0],", ").concat(t[1],"));\n        int index = 4 * (resTexRC.x * ").concat(t[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},cm=function cm(e){_classCallCheck(this,cm),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Eh.DENSE;var t=Rh(e),n=om();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(sm(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(t[0],", ").concat(t[1],"));\n        int index = 4 * (resTexRC.x * ").concat(t[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},dm=function dm(e){_classCallCheck(this,dm),this.variableNames=["A"],this.outTexUsage=Sh.DOWNLOAD;var t=om();this.outputShape=e,this.userCode="\n      ".concat(um,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(t.output," = encode_float(x);\n      }\n    ")},pm=function pm(e){_classCallCheck(this,pm),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Sh.DOWNLOAD;var t=om();this.outputShape=e,this.userCode="\n      ".concat(um,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(t.output," = encode_float(x);\n      }\n    ")},fm=function fm(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,fm),this.variableNames=["A"];var r=om(),_t112=_slicedToArray(t,2),a=_t112[0],o=_t112[1];this.outputShape=e;var s="result";n&&(s="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(im(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ").concat(o,";\n        int c = imod(flatIndex, ").concat(o,");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(").concat(o,".0, ").concat(a,".0);\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(r.output," = vec4(").concat(s,", 0., 0., 0.);\n      }\n    ")},hm=function hm(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,hm),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=om(),_t113=_slicedToArray(t,2),a=_t113[0],o=_t113[1];this.outputShape=e;var s="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var _t114=0;_t114<=1;_t114++)for(var _n66=0;_n66<=1;_n66++){var _i40=2*_t114+_n66;s+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(_n66," < ").concat(e[2],") {\n            localCoords[2] += ").concat(_n66,";\n            if(localCoords[1] + ").concat(_t114," < ").concat(e[1],") {\n              localCoords[1] += ").concat(_t114,";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ").concat(o,";\n              c = imod(flatIndex, ").concat(o,");\n              uv = (vec2(c, r) + halfCR) / vec2(").concat(o,".0, ").concat(a,".0);\n              values = ").concat(r.texture2D,"(A, uv);\n\n              if(offset == 0) {\n                result[").concat(_i40,"] = values[0];\n              } else if(offset == 1) {\n                result[").concat(_i40,"] = values[1];\n              } else if(offset == 2) {\n                result[").concat(_i40,"] = values[2];\n              } else {\n                result[").concat(_i40,"] = values[3];\n              }\n            }\n          }\n        ")}this.userCode="\n      ".concat(im(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ").concat(s,"\n\n        ").concat(r.output," = ").concat(i,";\n      }\n    ")};function ym(e,t,n,r,a,o){!function(e,t){var n=jt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] is invalid."));if(e>n||t>n)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] greater than WebGL maximum on this browser / GPU [").concat(n,"x").concat(n,"]."))}(t,n);var s=function(e){return jh(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),i=e.TEXTURE_2D;return Oh(e,(function(){return e.bindTexture(i,s)})),Oh(e,(function(){return e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Oh(e,(function(){return e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Oh(e,(function(){return e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Oh(e,(function(){return e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST)})),Oh(e,(function(){return e.texImage2D(i,0,r,t,n,0,a,o,null)})),Oh(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function xm(e){return e.internalFormatFloat}function vm(e){return e.internalFormatHalfFloat}function km(e){return e.downloadTextureFormat}function wm(e){return e.internalFormatPackedFloat}function Im(e){return e.internalFormatPackedHalfFloat}var Tm=function(){function Tm(e){_classCallCheck(this,Tm),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=jt().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){Nh[e]=t}(t,e)):this.gl=Ch(t);var n="WEBGL_color_buffer_float",r="EXT_color_buffer_half_float";if(1===jt().getNumber("WEBGL_VERSION")){var _t115="OES_texture_half_float";if(this.textureFloatExtension=Dh(this.gl,"OES_texture_float"),Jh(this.gl,_t115))this.textureHalfFloatExtension=Dh(this.gl,_t115);else if(jt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Jh(this.gl,r))this.colorBufferHalfFloatExtension=Dh(this.gl,r);else if(jt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Jh(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Jh(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=function gm(e){return function(e,t){var n=jh(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Oh(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),Oh(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function bm(e){return function(e,t){var n=jh(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Oh(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),Oh(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return jh(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=Fh(this.gl,this.textureHalfFloatExtension)}var _waitForQueryAndGetTime;return _createClass(Tm,[{key:"dispose",value:function dispose(){var _this45=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Oh(e,(function(){return e.finish()})),Oh(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),Oh(e,(function(){return e.deleteFramebuffer(_this45.framebuffer)})),Oh(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,null)})),Oh(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)})),Oh(e,(function(){return e.deleteBuffer(_this45.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){var _$h2=_slicedToArray($h(t,n),2);return ym(e,_$h2[0],_$h2[1],xm(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){var _$h4=_slicedToArray($h(t,n),2);return ym(e,_$h4[0],_$h4[1],vm(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){var _$h6=_slicedToArray($h(t,n),2);return ym(e,_$h6[0],_$h6[1],km(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){Oh(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?Oh(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):Oh(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),Oh(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,o){var s,i,u;Oh(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(s=new Uint8Array(n*r*4),i=e.UNSIGNED_BYTE,u=e.RGBA):(s=new Float32Array(n*r*4),i=e.FLOAT,u=o.internalFormatPackedFloat),s.set(a),Oh(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,i,s)})),Oh(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){var _Ah4=_slicedToArray(Ah(t,n),2);return ym(e,_Ah4[0],_Ah4[1],Im(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){var _Ah6=_slicedToArray(Ah(t,n),2);return ym(e,_Ah6[0],_Ah6[1],wm(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function deleteMatrixTexture(e){var _this46=this;this.throwIfDisposed(),this.outputTexture===e&&(Uh(this.gl,this.framebuffer),this.outputTexture=null),Oh(this.gl,(function(){return _this46.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){var _this47=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var _$h8=_slicedToArray($h(t,n),2),a=_$h8[0],o=_$h8[1],s=new Uint8Array(t*n*4);return Oh(e,(function(){return e.readPixels(0,0,a,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}(_this47.gl,t,n,_this47.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function downloadPackedMatrixFromBuffer(e,t,n,r,a,o){return function Nm(e,t,n,r,a,o,s,i){var u=e,l=new Float32Array(function(e,t){var _Ah2=_slicedToArray(Ah(e,t),2);return _Ah2[0]*_Ah2[1]*4}(o,s));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}(this.gl,e,0,0,0,a,o,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();Oh(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var o=16*t*n;return Oh(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),Oh(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),Oh(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function createAndWaitForFence(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function createFence(e){var t,n,_this48=this;if(jt().getBool("WEBGL_FENCE_API_ENABLED")){var _r154=e,_a134=_r154.fenceSync(_r154.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function n(){var e=_r154.clientWaitSync(_a134,0,0);return e===_r154.ALREADY_SIGNALED||e===_r154.CONDITION_SATISFIED},t=_a134}else jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function n(){return _this48.isQueryAvailable(t,jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function n(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function downloadMatrixFromPackedTexture(e,t,n){var _this49=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return Oh(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(_this49.gl,t,n)}))}},{key:"createProgram",value:function createProgram(e){this.throwIfDisposed();var t=this.gl,n=function Ph(e,t){var n=jh(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Oh(e,(function(){return e.shaderSource(n,t)})),Oh(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){var n=Lh.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),o=a.length.toString().length+2,s=a.map((function(e,t){return vt((t+1).toString(),o)+e})),i=0,_e150=0;_e150<s.length;_e150++)i=Math.max(s[_e150].length,i);var u=s.slice(0,r-1),l=s.slice(r-1,r),c=s.slice(r);console.log(u.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(vt(l[0],i)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t,e),r=function mm(e){var t=om();return function(e,t){var n=jh(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Oh(e,(function(){return e.shaderSource(n,t)})),Oh(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}(t),a=function(e){return jh(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(t);return Oh(t,(function(){return t.attachShader(a,r)})),Oh(t,(function(){return t.attachShader(a,n)})),function(e,t){if(Oh(e,(function(){return e.linkProgram(t)})),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,a),this.debug&&Bh(t,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=function(e,t,n){return Oh(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),zh(e,t,"clipSpacePos",n,3,20,0)&&zh(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),a}},{key:"deleteProgram",value:function deleteProgram(e){var _this50=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Oh(this.gl,(function(){return _this50.gl.deleteProgram(e)}))}},{key:"setProgram",value:function setProgram(e){var _this51=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Bh(this.gl,this.program),Oh(this.gl,(function(){return _this51.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function getUniformLocation(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return jh(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function getAttributeLocation(e,t){var _this52=this;return this.throwIfDisposed(),Oh(this.gl,(function(){return _this52.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){Oh(e,(function(){return function Wh(e,t,n){!function(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in ".concat("[gl.TEXTURE0, gl.TEXTURE".concat(n,"]"),"."))}(e,n),Oh(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),Oh(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),Oh(e,(function(){return e.uniform1i(n,r)}))}(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();var _Ah8=_slicedToArray(Ah(t,n),2),r=_Ah8[0],a=_Ah8[1];this.setOutputMatrixTextureDriver(e,r,a)}},{key:"setOutputMatrixWriteRegion",value:function setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function debugValidate(){null!=this.program&&Bh(this.gl,this.program),Hh(this.gl)}},{key:"executeProgram",value:function executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Oh(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function blockUntilAllProgramsCompleted(){var _this53=this;this.throwIfDisposed(),Oh(this.gl,(function(){return _this53.gl.finish()}))}},{key:"getQueryTimerExtension",value:function getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Dh(this.gl,2===jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function beginQuery(){if(2===jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var _e153=this.gl,_t116=this.getQueryTimerExtensionWebGL2(),n=_e153.createQuery();return _e153.beginQuery(_t116.TIME_ELAPSED_EXT,n),n}var e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}},{key:"endQuery",value:function endQuery(){if(2!==jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var _e154=this.gl,t=this.getQueryTimerExtensionWebGL2();_e154.endQuery(t.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:(_waitForQueryAndGetTime=_asyncToGenerator(regeneratorRuntime.mark((function _callee46(e){var _this54=this;return regeneratorRuntime.wrap((function _callee46$(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:return _context47.next=2,kt((function(){return _this54.disposed||_this54.isQueryAvailable(e,jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return _context47.abrupt("return",this.getQueryTime(e,jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return _context47.stop()}}),_callee46,this)}))),function waitForQueryAndGetTime(_x62){return _waitForQueryAndGetTime.apply(this,arguments)})},{key:"getQueryTime",value:function getQueryTime(e,t){if(0===t)return null;if(2===t){var _t117=this.gl;return _t117.getQueryParameter(e,_t117.QUERY_RESULT)/1e6}var _t118=this.getQueryTimerExtensionWebGL1();return _t118.getQueryObjectEXT(e,_t118.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function isQueryAvailable(e,t){if(0===t)return!0;if(2===t){var _t119=this.gl,n=this.getQueryTimerExtensionWebGL2(),_r155=_t119.getQueryParameter(e,_t119.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),_r155&&!this.disjoint}var _t120=this.getQueryTimerExtensionWebGL1(),_n67=_t120.getQueryObjectEXT(e,_t120.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(_t120.GPU_DISJOINT_EXT)),_n67&&!this.disjoint}},{key:"pollFence",value:function pollFence(e){var _this55=this;return new Promise((function(t){_this55.addItemToPoll((function(){return e.isFencePassed()}),(function(){return t()}))}))}},{key:"pollItems",value:function pollItems(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function addItemToPoll(e,t){var _this56=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||kt((function(){return _this56.pollItems(),0===_this56.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function bindTextureToFrameBuffer(e){this.throwIfDisposed(),Vh(this.gl,e,this.framebuffer),this.debug&&Hh(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function unbindTextureToFrameBuffer(){null!=this.outputTexture?(Vh(this.gl,this.outputTexture,this.framebuffer),this.debug&&Hh(this.gl)):Uh(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();var r=this.gl;Vh(r,e,this.framebuffer),this.debug&&Hh(r),this.outputTexture=e,Oh(r,(function(){return r.viewport(0,0,t,n)})),Oh(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function setOutputMatrixWriteRegionDriver(e,t,n,r){var _this57=this;this.throwIfDisposed(),Oh(this.gl,(function(){return _this57.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}},{key:"debug",get:function get(){return jt().getBool("DEBUG")}}]),Tm}(),Cm=Tu.getBroadcastDims;function Em(e,t,n,r){var a=[];e.forEach((function(e){var t=gt(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(a.push("uniform sampler2D ".concat(e.name,";")),a.push("uniform int offset".concat(e.name,";")))}));var c,d,o=a.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="";r+=n?_m(e):Sm(e);var a=e.shapeInfo.logicalShape,o=t.logicalShape;return a.length<=o.length&&(r+=n?function(e,t){var c,n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,i=Cm(e.shapeInfo.logicalShape,t.logicalShape),u=Pm(s),l=s-o,d=["x","y","z","w","u","v"];c=0===o?"":s<2&&i.length>=1?"coords = 0;":i.map((function(e){return"coords.".concat(d[e+l]," = 0;")})).join("\n");var p;p=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+l])})).join(", ");var f="return outputValue;",h=1===gt(e.shapeInfo.logicalShape),m=1===gt(t.logicalShape);if(1!==o||h||m){if(h&&!m)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(i.length){var _e156=o-2,_t121=o-1;i.indexOf(_e156)>-1&&i.indexOf(_t121)>-1?f="return vec4(outputValue.x);":i.indexOf(_e156)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":i.indexOf(_t121)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(a,"() {\n      ").concat(u," coords = getOutputCoords();\n      ").concat(c,"\n      vec4 outputValue = get").concat(r,"(").concat(p,");\n      ").concat(f,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",o=t.texShape,s=e.shapeInfo.texShape,i=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&i===u&&null==e.shapeInfo.flatOffset&&bt(s,o))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var p,l=Pm(u),c=Cm(e.shapeInfo.logicalShape,t.logicalShape),d=u-i,f=["x","y","z","w","u","v"];p=0===i?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords.".concat(f[e+d]," = 0;")})).join("\n");var h;return h=u<2&&i>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(f[t+d])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(p,"\n      return get").concat(r,"(").concat(h,");\n    }\n  ")}(e,t)),r}(e,t,r)})).join("\n"),i=t.texShape,u=om(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(u),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat($m,"\n    ").concat(Rm,"\n    ").concat(Am,"\n  ")}(u);return t.isPacked?(c=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(n[1],".0);\n      }\n    "):1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(n[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return 2 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n    }\n  ")}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(bt(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(n[0],", ").concat(n[1],"));\n      }\n    ");var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),a=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),o=a,s="",i="b, r, c",_t122=2;_t122<e.length-1;_t122++)o*=e[e.length-_t122-1],s="\n      int b".concat(_t122," = index / ").concat(o,";\n      index -= b").concat(_t122," * ").concat(o,";\n    ")+s,i="b".concat(_t122,", ")+i;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(i,");\n    }\n  ")}(e,t)}}(t.logicalShape,i),d=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(u)):(c=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t);case 2:return function(e,t){return bt(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=sm(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t);case 4:return function(e,t){var n=sm(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t);case 5:return function(e,t){var n=sm(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=sm(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,i),d=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(u)),r&&(p+=Fm),[p,l,d,o,c,s,n].join("\n")}function Sm(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var _e$shapeInfo$texShape=_slicedToArray(e.shapeInfo.texShape,2),r=_e$shapeInfo$texShape[0],a=_e$shapeInfo$texShape[1];if(1===r&&1===a)return"\n      float ".concat(n,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var _e$shapeInfo$texShape2=_slicedToArray(e.shapeInfo.texShape,2),o=_e$shapeInfo$texShape2[0],s=_e$shapeInfo$texShape2[1],i=Mm(t);return"\n    float ".concat(n,"() {\n      vec2 uv = uvFromFlat(").concat(o,", ").concat(s,", ").concat(i,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(n,"(int index) {\n        ").concat(Dm(e),"\n      }\n    ");var r=e.shapeInfo.texShape,a=r[0],o=r[1];if(1===o&&1===a)return"\n      float ".concat(n,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var s=Mm(t);return 1===o?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(a,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):1===a?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):"\n    float ".concat(n,"(int index) {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&bt(t,a)){var _e157=a[0];return"\n    float ".concat(r,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(a[1],".0, ").concat(_e157,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}var _Nt=Nt(t),o=_Nt.newShape,s=_Nt.keptDims,i=o;if(i.length<t.length){return"\n      ".concat(Sm(Lm(e,i)),"\n      float ").concat(r,"(int row, int col) {\n        return ").concat(r,"(").concat(Bm(["row","col"],s),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(t[1],", 1)));\n        ").concat(Dm(e),"\n      }\n    ");var u=a[0],l=a[1],c=Mm(n);return 1===l?"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(c,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(u,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):1===u?"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(c,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(l,".0, 0.5);\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n  float ".concat(r,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(t[1]," + col + ").concat(c,";\n    vec2 uv = uvFromFlat(").concat(u,", ").concat(l,", index);\n    return sampleTexture(").concat(n,", uv);\n  }\n")}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[1]*t[2],o=t[2],_Nt2=Nt(t),s=_Nt2.newShape,i=_Nt2.keptDims,u=s;if(u.length<t.length){return"\n        ".concat(Sm(Lm(e,u)),"\n        float ").concat(r,"(int row, int col, int depth) {\n          return ").concat(r,"(").concat(Bm(["row","col","depth"],i),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(a,", ").concat(o,", 1)));\n        ").concat(Dm(e),"\n      }\n    ");var l=e.shapeInfo.texShape,c=l[0],d=l[1],p=e.shapeInfo.flatOffset;if(d===a&&null==p)return"\n        float ".concat(r,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(d,".0, ").concat(c,".0);\n          return sampleTexture(").concat(n,", uv);\n        }\n      ");if(d===o&&null==p)return"\n    float ".concat(r,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(t[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(d,".0, ").concat(c,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var f=Mm(n);return"\n      float ".concat(r,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(a," + col * ").concat(o," + depth + ").concat(f,";\n        vec2 uv = uvFromFlat(").concat(c,", ").concat(d,", index);\n        return sampleTexture(").concat(n,", uv);\n      }\n  ")}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[3],o=t[2]*a,s=t[1]*o,_Nt3=Nt(t),i=_Nt3.newShape,u=_Nt3.keptDims;if(i.length<t.length){return"\n      ".concat(Sm(Lm(e,i)),"\n      float ").concat(r,"(int row, int col, int depth, int depth2) {\n        return ").concat(r,"(").concat(Bm(["row","col","depth","depth2"],u),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(a,", 1)));\n        ").concat(Dm(e),"\n      }\n    ");var l=e.shapeInfo.flatOffset,c=e.shapeInfo.texShape,d=c[0],p=c[1];if(p===s&&null==l)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(p,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(p===a&&null==l)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(t[1]*t[2],", ").concat(t[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(p,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var f=Mm(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(a," + depth2;\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index + ").concat(f,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],o=t[3]*a,s=t[2]*o,i=t[1]*s,_Nt4=Nt(t),u=_Nt4.newShape,l=_Nt4.keptDims;if(u.length<t.length){return"\n      ".concat(Sm(Lm(e,u)),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(Bm(["row","col","depth","depth2","depth3"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(i,", ").concat(s,", ").concat(o,", ").concat(a,")) +\n          depth3;\n        ").concat(Dm(e),"\n      }\n    ");var c=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],f=d[1];if(f===i&&null==c)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(s,", ").concat(o,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(f,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(f===a&&null==c)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(f,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var h=Mm(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(i," + col * ").concat(s," + depth * ").concat(o," +\n          depth2 * ").concat(a," + depth3 + ").concat(h,";\n      vec2 uv = uvFromFlat(").concat(p,", ").concat(f,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),_Nt5=Nt(t),a=_Nt5.newShape,o=_Nt5.keptDims;if(a.length<t.length){return"\n      ".concat(Sm(Lm(e,a)),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(Bm(["row","col","depth","depth2","depth3","depth4"],o),");\n      }\n    ")}var s=t[5],i=t[4]*s,u=t[3]*i,l=t[2]*u,c=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(c,", ").concat(l,", ").concat(u,", ").concat(i,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(s,", 1)));\n        ").concat(Dm(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,f=p[0],h=p[1];if(h===c&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(l,", ").concat(u,", ").concat(i,", ").concat(s,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(h,".0, ").concat(f,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(h===s&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(h,".0, ").concat(f,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var m=Mm(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(c," + col * ").concat(l," + depth * ").concat(u," +\n          depth2 * ").concat(i," + depth3 * ").concat(s," + depth4 + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(f,", ").concat(h,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(t.length,"-D input sampling is not yet supported"))}}function _m(e){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=om();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=om();return"\n    vec4 ".concat(n,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(a[0],", ").concat(a[1],", index);\n      return ").concat(o.texture2D,"(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,o=a[0],s=a[1],i=om();if(null!=a&&bt(t,a))return"\n      vec4 ".concat(r,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(i.texture2D,"(").concat(n,", uv);\n      }\n    ");var u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=Math.ceil(t[1]/2);return"\n    vec4 ".concat(r,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(u[0],", ").concat(u[1],", row, col);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===t[0]){return"\n        ".concat(_m(Lm(e,t.slice(1))),"\n        vec4 ").concat(r,"(int b, int row, int col) {\n          return ").concat(r,"(").concat(Bm(["b","row","col"],[1,2]),");\n        }\n      ")}var s=o[0],i=o[1],u=Math.ceil(t[2]/2),l=u*Math.ceil(t[1]/2),c=om();return"\n    vec4 ".concat(r,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(s,", ").concat(i,", ").concat(l,", ").concat(u,", b, row, col);\n      return ").concat(c.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape,s=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],i=s[0],u=s[1],l=Math.ceil(t[n-1]/2),c=l*Math.ceil(t[n-2]/2),d="int b, int row, int col",p="b * ".concat(c," + (row / 2) * ").concat(l," + (col / 2)"),_e158=2;_e158<n-1;_e158++)d="int b".concat(_e158,", ")+d,c*=t[n-_e158-1],p="b".concat(_e158," * ").concat(c," + ")+p;var f=om();return"\n    vec4 ".concat(a,"(").concat(d,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(i,");\n      return ").concat(f.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e)}}var $m="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Rm="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Am="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Fm="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Mm(e){return"offset".concat(e)}function Dm(e){var t=e.name,n=gt(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Pm(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Lm(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Bm(e,t){return t.map((function(t){return e[t]})).join(", ")}function zm(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],o=a.shape;if(!bt(r,o))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(o," must match"));if(!e.isUniform||!a.isUniform){var s=e.texShape,i=a.isUniform?null:a.texData.texShape;if(!bt(s,i))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(s," and ").concat(i," must match"))}}))}var Wm=Wd.addImpl,Vm=Wd.bincountImpl,Um=Wd.bincountReduceImpl,Hm=Wd.ceilImpl,jm=Wd.concatImpl,Gm=Wd.expImpl,qm=Wd.expm1Impl,Km=Wd.floorImpl,Xm=Wd.gatherV2Impl,Ym=Wd.greaterImpl,Qm=Wd.lessImpl,Zm=Wd.linSpaceImpl,Jm=Wd.logImpl,eg=Wd.maxImpl,tg=Wd.maximumImpl,ng=Wd.minimumImpl,rg=Wd.multiplyImpl,ag=Wd.negImpl,og=Wd.prodImpl,sg=Wd.rangeImpl,ig=Wd.rsqrtImpl,ug=Wd.simpleAbsImpl,lg=Wd.sliceImpl,cg=Wd.stridedSliceImpl,dg=Wd.subImpl,pg=Wd.tileImpl,fg=Wd.topKImpl,hg=Wd.transposeImpl,mg=Wd.uniqueImpl;function gg(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function bg(e,t){return 1===t?[e]:gg(e,t)}var yg=function yg(e){_classCallCheck(this,yg),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=bg("rc",t),_r156=Pm(t),_a136=function(e,t,n){if(1===e)return"rc > ".concat(t[0]);for(var r="",_a137=e-2;_a137<e;_a137++)r+="".concat(n[_a137]," >= ").concat(t[_a137]),_a137<e-1&&(r+="||");return r}(t,e,n),_o96=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = ".concat(a[0],";\n    int c = ").concat(a[1],";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ").concat(t,";\n    bool rEdge = rp1 >= ").concat(n,";\n  ")}(t,e[e.length-1],e[e.length-2],n),_s64=function(e,t){var n=e.length,r=function(e,t){for(var n=[],_r157=0;_r157<=1;_r157++)for(var _a138=0;_a138<=1;_a138++){for(var _o97="".concat(0===_r157?"r":"rp1",", ").concat(0===_a138?"c":"cp1"),_n69=2;_n69<e;_n69++)_o97="".concat(t[t.length-1-_n69],",")+_o97;n.push(_o97)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= ".concat(e[0]," ? 0. : getA(rc + 1),\n            0, 0"):"getA(".concat(r[0],"),\n          cEdge ? 0. : getA(").concat(r[1],"),\n          rEdge ? 0. : getA(").concat(r[2],"),\n          rEdge || cEdge ? 0. : getA(").concat(r[3],")")}(e,n);this.userCode="\n        void main() {\n          ".concat(_r156," rc = getOutputCoords();\n\n          if(").concat(_a136,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(_o96,"\n\n            setOutput(vec4(").concat(_s64,"));\n          }\n        }\n      ")}},xg=function xg(e,t){_classCallCheck(this,xg),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r,n="",_e159=0;_e159<4;_e159++){var _t128="thisRC = rc;";_e159%2==1&&(_t128+="thisRC.z += 1;"),_e159>1&&(_t128+="thisRC.y += 1;"),n+="\n        ".concat(_t128,"\n        ").concat(_e159>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(_e159,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(_e159>0?"}":"","\n      ")}this.userCode="\n      ".concat((r=t,"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(sm(["r","c","d"],r),"\n      return ivec3(r, c, d);\n    }\n  ")),"\n      ").concat(im(e),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(e[1],";\n        int cols = ").concat(e[2],";\n\n        ").concat(n,"\n\n        setOutput(result);\n      }\n    ")},vg=function(){function vg(e){_classCallCheck(this,vg),this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return _createClass(vg,[{key:"acquireTexture",value:function acquireTexture(e,t,n){var r=wg(t,n),a=Ig(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var s,o=kg(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var _e160=this.freeTextures[a].shift();return this.usedTextures[a].push(_e160),_e160}return r===_h.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===_h.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===_h.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===_h.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===_h.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(s),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),s}},{key:"releaseTexture",value:function releaseTexture(e,t,n,r){if(null!=this.freeTextures){var a=wg(n,r),o=Ig(t,a,r);o in this.freeTextures||(this.freeTextures[o]=[]);var s=kg(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),i=jt().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==i&&this._numBytesAllocated>i?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var u=this.usedTextures[o],l=u.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(l,1),this.log()}}},{key:"log",value:function log(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"getNumUsedTextures",value:function getNumUsedTextures(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function getNumFreeTextures(){return this.numFreeTextures}},{key:"dispose",value:function dispose(){var _this58=this;if(null!=this.freeTextures){for(var _e161 in this.freeTextures)this.freeTextures[_e161].forEach((function(e){_this58.gpgpu.deleteMatrixTexture(e)}));for(var _e162 in this.usedTextures)this.usedTextures[_e162].forEach((function(e){_this58.gpgpu.deleteMatrixTexture(e)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}},{key:"numBytesAllocated",get:function get(){return this._numBytesAllocated}},{key:"numBytesFree",get:function get(){return this._numBytesFree}}]),vg}();function kg(e,t,n,r,a){var s,o=function(e,t){switch(e){case _h.PACKED_2X2_FLOAT32:return wm(t);case _h.PACKED_2X2_FLOAT16:return Im(t);case _h.UNPACKED_FLOAT32:return xm(t);case _h.UNPACKED_FLOAT16:return vm(t);case _h.PACKED_4X1_UNSIGNED_BYTE:return km(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var _Ah10=_slicedToArray(Ah(e[0],e[1]),2);s=_Ah10[0]*_Ah10[1]}else{var _$h10=_slicedToArray($h(e[0],e[1]),2);s=_$h10[0]*_$h10[1]}return s*function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;throw new Error("Unknown internal format ".concat(t))}(n,o)}function wg(e,t){if(e===Sh.UPLOAD)return _h.PACKED_2X2_FLOAT32;if(e===Sh.RENDER||null==e)return function(e){return jt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?_h.PACKED_2X2_FLOAT32:_h.UNPACKED_FLOAT32:e?_h.PACKED_2X2_FLOAT16:_h.UNPACKED_FLOAT16}(t);if(e===Sh.DOWNLOAD||e===Sh.PIXELS)return _h.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function Ig(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var Ng=function Ng(e,t){_classCallCheck(this,Ng),this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},Tg="return abs(x);",Cg="return x;",Eg=function Eg(e,t){_classCallCheck(this,Eg),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},Sg=function Sg(e){_classCallCheck(this,Sg),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=bg("rc",t),r=Pm(t),a=function(e,t){if(1===e)return"rc";for(var n="",_r158=0;_r158<e;_r158++)n+=t[_r158],_r158<e-1&&(n+=",");return n}(t,n),o=n.slice(-2),s=t<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(r," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(a,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")},_g=gi,$g={},Rg=function(_ut2){_inherits(Rg,_ut2);var _getQueryTime,_time3,_read2,_super3=_createSuper(Rg);function Rg(e){var _this59,t;if(_classCallCheck(this,Rg),(_this59=_super3.call(this)).pendingRead=new WeakMap,_this59.pendingDisposal=new WeakSet,_this59.dataRefCount=new WeakMap,_this59.numBytesInGPU=0,_this59.uploadWaitMs=0,_this59.downloadWaitMs=0,_this59.lastGlFlushTime=0,_this59.warnedAboutMemory=!1,_this59.warnedAboutCPUBackend=!1,_this59.pendingDeletes=0,_this59.disposed=!1,!jt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var _e163=Ch(jt().getNumber("WEBGL_VERSION"));_this59.binaryCache=((t=jt().getNumber("WEBGL_VERSION"))in $g||($g[t]={}),$g[t]),_this59.gpgpu=new Tm(_e163),_this59.canvas=_e163.canvas,_this59.gpgpuCreatedLocally=!0}else _this59.gpgpu=e,_this59.binaryCache={},_this59.gpgpuCreatedLocally=!1,_this59.canvas=e.gl.canvas;return _this59.textureManager=new vg(_this59.gpgpu),_this59.numMBBeforeWarning=null==jt().global.screen?1024:jt().global.screen.height*jt().global.screen.width*window.devicePixelRatio*600/1024/1024,_this59.texData=new it(_assertThisInitialized(_this59),ia()),_possibleConstructorReturn(_this59)}return _createClass(Rg,[{key:"nextDataId",value:function nextDataId(){return Rg.nextDataId++}},{key:"numDataIds",value:function numDataIds(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}},{key:"write",value:function write(e,t,n){if((jt().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||jt().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Sh.UPLOAD,refCount:1}),r}},{key:"refCount",value:function refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function incRef(e){this.texData.get(e).refCount++}},{key:"decRef",value:function decRef(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function move(e,t,n,r,a){if(jt().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Sh.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}},{key:"readSync",value:function readSync(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,o=t.slice,s=t.shape,i=t.isPacked;if(null!=o){var _t131;_t131=i?new Eg(s,Cg):new Ng(s,Cg);var _n72=this.runWebGLProgram(_t131,[{dataId:e,shape:s,dtype:r}],r),_a139=this.readSync(_n72.dataId);return this.disposeIntermediateTensorInfo(_n72),_a139}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var l,c,u=null!=this.activeTimers;return u&&(l=sn()),c="complex64"===r?uu(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.getValuesFromTexture(e),u&&(this.downloadWaitMs+=sn()-l),this.convertAndCacheOnCPU(e,c)}},{key:"read",value:(_read2=_asyncToGenerator(regeneratorRuntime.mark((function _callee47(e){var _t132,t,n,r,a,o,s,i,_t133,_n73,_a140,u,l,c,_this$gpgpu,_t134,_e164,_e165,d,p;return regeneratorRuntime.wrap((function _callee47$(_context48){for(;;)switch(_context48.prev=_context48.next){case 0:if(!this.pendingRead.has(e)){_context48.next=3;break}return _t132=this.pendingRead.get(e),_context48.abrupt("return",new Promise((function(e){return _t132.push(e)})));case 3:if(t=this.texData.get(e),n=t.values,r=t.shape,a=t.slice,o=t.dtype,s=t.complexTensorInfos,i=t.isPacked,null==a){_context48.next=8;break}return _t133=i?new Eg(r,Cg):new Ng(r,Cg),_n73=this.runWebGLProgram(_t133,[{dataId:e,shape:r,dtype:o}],o),_a140=this.read(_n73.dataId),_context48.abrupt("return",(this.disposeIntermediateTensorInfo(_n73),_a140));case 8:if(null==n){_context48.next=10;break}return _context48.abrupt("return",this.convertAndCacheOnCPU(e));case 10:if(jt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==jt().getNumber("WEBGL_VERSION")){_context48.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(c=null,"complex64"!==o&&jt().get("WEBGL_BUFFER_SUPPORTED")&&(u=this.decode(e),_t134=this.texData.get(u.dataId),c=(_this$gpgpu=this.gpgpu).createBufferFromTexture.apply(_this$gpgpu,[_t134.texture].concat(_toConsumableArray(Rh(r))))),this.pendingRead.set(e,[]),_context48.t0="complex64"!==o,!_context48.t0){_context48.next=19;break}return _context48.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==o){_context48.next=26;break}return _context48.next=22,Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]);case 22:_e164=_context48.sent,l=uu(_e164[0],_e164[1]),_context48.next=27;break;case 26:null==c?l=this.getValuesFromTexture(e):(_e165=gt(r),l=this.gpgpu.downloadFloat32MatrixFromBuffer(c,_e165));case 27:return null!=u&&this.disposeIntermediateTensorInfo(u),d=this.convertAndCacheOnCPU(e,l),p=this.pendingRead.get(e),_context48.abrupt("return",(this.pendingRead.delete(e),p.forEach((function(e){return e(d)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ia().removeDataId(e,this),this.pendingDeletes--),d));case 30:case"end":return _context48.stop()}}),_callee47,this)}))),function read(_x63){return _read2.apply(this,arguments)})},{key:"bufferSync",value:function bufferSync(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return ln(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Cr(e.shape,e.dtype,n)}},{key:"checkNumericalProblems",value:function checkNumericalProblems(e){if(null!=e)for(var t=0;t<e.length;t++){var _n74=e[t];if(!Mh(_n74)){if(jt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(_n74," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"));throw Error("The value ".concat(_n74," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function getValuesFromTexture(e){var _this$texData$get=this.texData.get(e),t=_this$texData$get.shape,n=_this$texData$get.dtype,r=_this$texData$get.isPacked,a=gt(t);if(jt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var _this$gpgpu2,_n75=this.decode(e),_r159=this.texData.get(_n75.dataId),_o98=(_this$gpgpu2=this.gpgpu).downloadMatrixFromPackedTexture.apply(_this$gpgpu2,[_r159.texture].concat(_toConsumableArray(Rh(t)))).subarray(0,a);return this.disposeIntermediateTensorInfo(_n75),_o98}var o=jt().getBool("WEBGL_PACK")&&!0===r,s=o?Kh(t):t,i=o?new pm(s):new dm(s),u=this.runWebGLProgram(i,[{shape:s,dtype:n,dataId:e}],"float32"),l=this.texData.get(u.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(l.texture,l.texShape[0],l.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(u),c}},{key:"timerAvailable",value:function timerAvailable(){return jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:(_time3=_asyncToGenerator(regeneratorRuntime.mark((function _callee48(e){var t,n,r,a,o,s,_e166;return regeneratorRuntime.wrap((function _callee48$(_context49){for(;;)switch(_context49.prev=_context49.next){case 0:if(t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),a=mt(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=mt(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},!(jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){_context49.next=13;break}return _context49.next=9,Promise.all(a);case 9:_e166=_context49.sent,s.kernelMs=function(e){for(var t=0,_n76=0;_n76<e.length;_n76++)t+=e[_n76];return t}(_e166),s.getExtraProfileInfo=function(){return _e166.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},_context49.next=14;break;case 13:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 14:return _context49.abrupt("return",(this.uploadWaitMs=0,this.downloadWaitMs=0,s));case 15:case"end":return _context49.stop()}}),_callee48,this)}))),function time(_x64){return _time3.apply(this,arguments)})},{key:"memory",value:function memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function startTimer(){return jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:sn(),endMs:null}}},{key:"endTimer",value:function endTimer(e){return jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=sn(),e)}},{key:"getQueryTime",value:(_getQueryTime=_asyncToGenerator(regeneratorRuntime.mark((function _callee49(e){var t;return regeneratorRuntime.wrap((function _callee49$(_context50){for(;;)switch(_context50.prev=_context50.next){case 0:if(!(jt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){_context50.next=2;break}return _context50.abrupt("return",this.gpgpu.waitForQueryAndGetTime(e));case 2:return t=e,_context50.abrupt("return",t.endMs-t.startMs);case 4:case"end":return _context50.stop()}}),_callee49,this)}))),function getQueryTime(_x65){return _getQueryTime.apply(this,arguments)})},{key:"disposeData",value:function disposeData(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var _this$texData$get2=this.texData.get(e),n=_this$texData$get2.complexTensorInfos;return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function releaseGPUData(e){var _this$texData$get3=this.texData.get(e),t=_this$texData$get3.texture,n=_this$texData$get3.dtype,r=_this$texData$get3.texShape,a=_this$texData$get3.usage,o=_this$texData$get3.isPacked,s=_this$texData$get3.slice,i=s&&s.origDataId||e,u=this.dataRefCount.get(i);u>1?this.dataRefCount.set(i,u-1):(this.dataRefCount.delete(i),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,a,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}},{key:"getDataInfo",value:function getDataInfo(e){return this.texData.get(e)}},{key:"getCPUBackend",value:function getCPUBackend(){return jt().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=ia().findBackend("cpu")),this.cpuBackend):null}},{key:"shouldExecuteOnCPU",value:function shouldExecuteOnCPU(e){var _this60=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128,n=this.getCPUBackend();return jt().getBool("IS_TEST")||this.warnedAboutCPUBackend||null!=n||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=n&&e.every((function(e){return null==_this60.texData.get(e.dataId).texture&&gt(e.shape)<t}))}},{key:"getGPGPUContext",value:function getGPGPUContext(){return this.gpgpu}},{key:"where",value:function where(e){iu("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return _g(e.shape,t)}},{key:"packedUnaryOp",value:function packedUnaryOp(e,t,n){var r=new Eg(e.shape,t),a=this.compileAndRun(r,[e],n);return ia().makeTensorFromDataId(a.dataId,a.shape,a.dtype)}},{key:"abs",value:function abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var _t135=ug(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,_t135)}if(jt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Tg,e.dtype);var t=new Ng(e.shape,Tg),n=this.compileAndRun(t,[e]);return ia().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}},{key:"makeTensorInfo",value:function makeTensorInfo(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&$t(n[0])){var _a141=n.map((function(e){return un(e)}));r=this.write(_a141,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function makeOutput(e,t,n){var r=this.makeTensorInfo(e,t,n).dataId;return ia().makeTensorFromDataId(r,e,t,this)}},{key:"unpackTensor",value:function unpackTensor(e){var t=new Sg(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function packTensor(e){var t=new yg(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function packedReshape(e,t){var n=[Gh(e.shape)].concat(_toConsumableArray(qh(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[Gh(t)].concat(_toConsumableArray(qh(t))),o=new xg(a,n),s=this.runWebGLProgram(o,[r],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function decode(e){var s,t=this.texData.get(e),n=t.isPacked,r=t.shape,a=t.dtype,o=Kh(r);return s=n?new cm(o):new lm(o),{dtype:a,shape:r,dataId:this.runWebGLProgram(s,[{shape:o,dtype:a,dataId:e}],a,null,!0).dataId}}},{key:"runWebGLProgram",value:function runWebGLProgram(e,t,n,r){var _this61=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Eh.DENSE){var _t136=Rh(e.outputShape);s.texShape=_t136.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===gt(o.shape))return s.values=Tt(o.dtype,0),o;var i=[],u=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=_this61.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&gt(t.shape)<=jt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?_this61.unpackTensor(t):_this61.packTensor(t),i.push(t),n=_this61.texData.get(t.dataId);else if(n.isPacked&&!Yh(n.shape,t.shape)){var _e167=t,_r160=t.shape;t.shape=n.shape,t=_this61.packedReshape(t,_r160),i.push(t),n=_this61.texData.get(t.dataId),_e167.shape=_r160}return _this61.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var f,l={shape:o.shape,texData:s,isUniform:!1},c=function(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+="".concat(e.shape,"_").concat(n,"_").concat(t)}));var a=e.userCode,o=e.constructor.name;return o+="_"+r+"_"+a}(e,u,l),d=this.getAndSaveBinary(c,(function(){return function(e,t,n,r){var a=t.userCode,o=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),s=o.map((function(e){return e.shapeInfo})),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Em(o,i,a,t.packedInputs),l=e.createProgram(u),c=null,d=e.getUniformLocation(l,"NAN",!1);1===jt().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1));for(var p={},_n77=0;_n77<t.variableNames.length;_n77++){var _r161=t.variableNames[_n77];p[_r161]=e.getUniformLocation(l,_r161,!1),p["offset".concat(_r161)]=e.getUniformLocation(l,"offset".concat(_r161),!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:p,inShapeInfos:s,outShapeInfo:i,infLoc:c,nanLoc:d}}(_this61.gpgpu,e,u,l)})),p=null!=this.activeTimers;p&&(f=this.startTimer()),function(e,t,n,r,a){zm(t.inShapeInfos,n),zm([t.outShapeInfo],[r]);var o=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(o,s[0],s[1]):e.setOutputMatrixTexture(o,s[0],s[1]),e.setProgram(t.webGLProgram),1===jt().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],o=t.uniformLocations[a],s=t.uniformLocations["offset".concat(a)];if(null!=o)if(n.isUniform)if(gt(n.shape)<2)e.gl.uniform1f(o,n.uniformValues[0]);else{var _t137=n.uniformValues;_t137 instanceof Float32Array||(_t137=new Float32Array(_t137)),e.gl.uniform1fv(o,_t137)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,o,r)})),null!=a&&a(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,d,u,l,r),i.forEach((function(e){return _this61.disposeIntermediateTensorInfo(e)})),p&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)}));var h=jt().get("WEBGL_FLUSH_THRESHOLD");if(h>0){var _e168=sn();_e168-this.lastGlFlushTime>h&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=_e168)}if(!jt().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===a){var _e169=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),_e169}return o}},{key:"compileAndRun",value:function compileAndRun(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function getTextureManager(){return this.textureManager}},{key:"dispose",value:function dispose(){var _this62=this;this.disposed||(jt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(e){_this62.gpgpu.deleteProgram(_this62.binaryCache[e].webGLProgram),delete _this62.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function floatPrecision(){var _this63=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=ua((function(){if(!jt().get("WEBGL_RENDER_FLOAT32_ENABLED")){var _e170=jt().getBool("DEBUG");jt().set("DEBUG",!1);var t=_this63.abs(js(1e-8)).dataSync()[0];if(jt().set("DEBUG",_e170),t>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function uploadToGPU(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,o=t.texture,s=t.usage,i=t.isPacked;if(null==o){var l,u=null!=this.activeTimers;u&&(l=sn());var c=t.texShape;if(null==c&&(c=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=jt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((function(t,n){return n>=e.length-2?dt(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var _t138=Nt(e);e=_t138.newShape}var r=gt(e);if(e.length<=1&&r<=n)return[1,r];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var _qh2,_t139=Gh(e),_n78=2,_a143=2;return e.length&&(_n78=(_qh2=_slicedToArray(qh(e),2))[0],_a143=_qh2[1]),xt(r=_t139*(_n78/2)*(_a143/2)).map((function(e){return 2*e}))}return xt(r)}(n,i),t.texShape=c),null!=a){var _Ah12,_o99,_e171=Kh(n),_s65=c[1],_d11=c[0],_p6=a instanceof Uint8Array;i?(_s65=(_Ah12=_slicedToArray(Ah(c[0],c[1]),2))[0],_d11=_Ah12[1],_o99=new hm(_e171,[_d11,_s65],_p6)):_o99=new fm(_e171,[_d11,_s65],_p6);var _f5=this.makeTensorInfo([_d11,_s65],r);this.texData.get(_f5.dataId).usage=_p6?Sh.PIXELS:Sh.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(_f5.dataId),_s65,_d11,a);var _m5=this.runWebGLProgram(_o99,[_f5],r,null,!0),_g4=this.texData.get(_m5.dataId);t.texture=_g4.texture,t.texShape=_g4.texShape,t.isPacked=_g4.isPacked,t.usage=_g4.usage,this.disposeIntermediateTensorInfo(_f5),this.texData.delete(_m5.dataId),t.values=null,u&&(this.uploadWaitMs+=sn()-l)}else{var _e172=this.acquireTexture(c,s,r,i);t.texture=_e172}}}},{key:"convertAndCacheOnCPU",value:function convertAndCacheOnCPU(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var _n79="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),_t140=0;_t140<_n79.length;++_t140)_n79[_t140]=Math.round(e[_t140]);return _n79}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var _e173=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(_e173," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function computeBytes(e,t){return e[0]*e[1]*_t(t)}}]),Rg}(ut);Rg.nextDataId=0,Wn()&&da("webgl",(function(){return new Rg}),2);var Ag=function Ag(e,t,n){_classCallCheck(this,Ag),this.variableNames=["A","B"],this.outputShape=bo(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")},Fg=function Fg(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck(this,Fg),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=bo(t,n);var a=this.outputShape.length,o="";if(r)if(0===a||1===gt(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          ".concat(Pm(a)," coords = getOutputCoords();\n        "),1===a)o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var _e174=bg("coords",a);o+="\n            bool nextRowOutOfBounds =\n              (".concat(_e174[a-2]," + 1) >= ").concat(this.outputShape[a-2],";\n            bool nextColOutOfBounds =\n              (").concat(_e174[a-1]," + 1) >= ").concat(this.outputShape[a-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")};function Og(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Mg={kernelName:"Identity",backendName:"webgl",kernelFunc:Og};function Dg(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,o=n.makeTensorInfo(r.shape,"complex64"),s=n.texData.get(o.dataId),i=Og({inputs:{x:r},backend:n}),u=Og({inputs:{x:a},backend:n});return s.complexTensorInfos={real:i,imag:u},o}var Pg={kernelName:"Complex",backendName:"webgl",kernelFunc:Dg},Lg="return (a < 0.) ? b * a : a;",Bg="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",zg={kernelName:"LeakyRelu",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.alpha,s=n.makeTensorInfo([],"float32",an(o,"float32")),i=jt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fg(Bg,a.shape,s.shape):new Ag(Lg,a.shape,s.shape),u=n.runWebGLProgram(i,[a,s],a.dtype);return n.disposeIntermediateTensorInfo(s),u}},Wg="return (a < 0.) ? b * a : a;",Vg="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Ug={kernelName:"Prelu",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,o=jt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fg(Vg,r.shape,a.shape):new Ag(Wg,r.shape,a.shape);return n.runWebGLProgram(o,[r,a],r.dtype)}};function Hg(_ref34){var e=_ref34.opSnippet,t=_ref34.packedOpSnippet,n=_ref34.cpuKernelImpl,r=_ref34.dtype;return function(_ref35){var l,a=_ref35.inputs,o=_ref35.backend,s=a.x,i=o,u=r||s.dtype;if(i.shouldExecuteOnCPU([s])&&null!=n){var _e175=i.texData.get(s.dataId),_t141=n(_e175.values,u);return i.makeTensorInfo(s.shape,u,_t141)}return l=jt().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new Eg(s.shape,t):new Ng(s.shape,e),i.runWebGLProgram(l,[s],u)}}function jg(_ref36){var e=_ref36.opSnippet,t=_ref36.packedOpSnippet,_ref36$checkOutOfBoun=_ref36.checkOutOfBounds,n=void 0!==_ref36$checkOutOfBoun&&_ref36$checkOutOfBoun,_ref36$supportsComple=_ref36.supportsComplex,r=void 0!==_ref36$supportsComple&&_ref36$supportsComple,a=_ref36.cpuKernelImpl,o=_ref36.dtype;return function(_ref37){var s=_ref37.inputs,i=_ref37.backend,u=s.a,l=s.b,c=i;if(r&&"complex64"===u.dtype){var _t142=c.texData.get(u.dataId),_n80=c.texData.get(l.dataId),_map=[[_t142.complexTensorInfos.real,_n80.complexTensorInfos.real],[_t142.complexTensorInfos.imag,_n80.complexTensorInfos.imag]].map((function(t){var _t143=_slicedToArray(t,2),n=_t143[0],r=_t143[1],a={dataId:n.dataId,dtype:n.dtype,shape:u.shape},o={dataId:r.dataId,dtype:r.dtype,shape:l.shape},s=new Ag(e,u.shape,l.shape);return c.runWebGLProgram(s,[a,o],_n(n.dtype,r.dtype))})),_map2=_slicedToArray(_map,2),_r162=_map2[0],_a144=_map2[1],_o100=Dg({inputs:{real:_r162,imag:_a144},backend:c});return c.disposeIntermediateTensorInfo(_r162),c.disposeIntermediateTensorInfo(_a144),_o100}var p,d=o||_n(u.dtype,l.dtype);if(c.shouldExecuteOnCPU([u,l])&&null!=a){var _e176=c.texData.get(u.dataId),_t144=c.texData.get(l.dataId),_a146=_slicedToArray(a(u.shape,l.shape,_e176.values,_t144.values,d),2),_n81=_a146[0],_r163=_a146[1],_o101=c.makeTensorInfo(_r163,d);return c.texData.get(_o101.dataId).values=_n81,_o101}return p=jt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new Fg(t,u.shape,l.shape,n):new Ag(e,u.shape,l.shape),c.runWebGLProgram(p,[u,l],d)}}function Gg(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===e)return t?Vg:Wg;if("leakyrelu"===e)return t?Bg:Lg;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var qg=function qg(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8];_classCallCheck(this,qg),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var l=r?e[1]:e[2],c=Math.ceil(l/2),d=r?"i * 2, rc.y":"rc.y, i * 2",p=a?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";s&&(m=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):u?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");var y="rc.x",x="rc.x";e[0]<t[0]?y="int(min(float(rc.x), ".concat(e[0]-1,".))"):t[0]<e[0]&&(x="int(min(float(rc.x), ".concat(t[0]-1,".))")),this.userCode="\n      ".concat(m,"\n\n      const float sharedDimension = ").concat(c,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(c,"; i++) {\n          int batchA = ").concat(y,";\n          int batchB = ").concat(x,";\n          vec4 a = getMatrixA(batchA, ").concat(d,");\n          vec4 b = getMatrixB(batchB, ").concat(p,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(f[0]," * ").concat(h[0],");\n          result += (").concat(f[1]," * ").concat(h[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(b,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")},Yg=function Yg(e,t,n){_classCallCheck(this,Yg),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=bo(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")},Qg="return a * b;";function Zg(e){var s,t=e.inputs,n=e.backend,r=t.a,a=t.b,o=_n(r.dtype,a.dtype);if("complex64"===r.dtype){var _e177=n.texData.get(r.dataId),_t145=n.texData.get(a.dataId),_o102=new Yg("return areal * breal - aimag * bimag;",r.shape,a.shape),_s66=new Yg("return areal * bimag + aimag * breal;",r.shape,a.shape),_i41=[{dataId:_e177.complexTensorInfos.real.dataId,dtype:_e177.complexTensorInfos.real.dtype,shape:r.shape},{dataId:_e177.complexTensorInfos.imag.dataId,dtype:_e177.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:_t145.complexTensorInfos.real.dataId,dtype:_t145.complexTensorInfos.real.dtype,shape:a.shape},{dataId:_t145.complexTensorInfos.imag.dataId,dtype:_t145.complexTensorInfos.imag.dtype,shape:a.shape}],_u28=n.runWebGLProgram(_o102,_i41,"float32"),l=n.runWebGLProgram(_s66,_i41,"float32"),c=Dg({inputs:{real:_u28,imag:l},backend:n});return n.disposeIntermediateTensorInfo(_u28),n.disposeIntermediateTensorInfo(l),c}if(n.shouldExecuteOnCPU([r,a])){var _e178=n.texData.get(r.dataId),_t146=n.texData.get(a.dataId),_rg2=_slicedToArray(rg(r.shape,a.shape,_e178.values,_t146.values,o),2),_s67=_rg2[0],_i42=_rg2[1],_u29=n.makeTensorInfo(_i42,o);return n.texData.get(_u29.dataId).values=_s67,_u29}return s=jt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fg(Qg,r.shape,a.shape):new Ag(Qg,r.shape,a.shape),n.runWebGLProgram(s,[r,a],o)}var Jg={kernelName:"Multiply",backendName:"webgl",kernelFunc:Zg};function eb(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.shape,s=n,i=gt(a.shape),u=wt(o,i),l=gt(u);pt(i===l,(function(){return"The new shape (".concat(u,") has ").concat(l," elements and the old shape (").concat(a.shape,") has ").concat(i," elements. The new shape and old shape must have the same number of elements.")}));var c=s.texData.get(a.dataId);return!c.isPacked||Yh(a.shape,u)||null!==c.texture&&Yh(c.shape,u)?(s.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[Gh(e.shape)].concat(_toConsumableArray(qh(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},o=[Gh(t)].concat(_toConsumableArray(qh(t))),s=new xg(o,r),i=n.runWebGLProgram(s,[a],e.dtype,null,!0);return{dataId:i.dataId,shape:t,dtype:i.dtype}}(a,u,s)}var tb={kernelName:"Reshape",backendName:"webgl",kernelFunc:eb},nb=function nb(e,t){_classCallCheck(this,nb),this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,a=e.inSize,o=e.outSize;this.outputShape=[r,o];var s=4*Math.floor(n/4),i=n%4,u="sumValue += dot(values, ones);";if(null!=t){var _e179=1/t;u="sumValue += dot(values * ".concat(yt(_e179)?_e179.toPrecision(2):_e179,", ones);")}var l="";a%n>0&&(l="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(l,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(u,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===i,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(u,"\n        } else if (").concat(2===i,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(u,"\n        } else if (").concat(3===i,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(u,"\n        }\n        setOutput(sumValue);\n      }\n    ")},rb=function rb(e,t){_classCallCheck(this,rb),this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,a=e.inSize,o=e.outSize;this.outputShape=[r,o];var s="0.0",i="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",i="min"):"max"===t&&(s="-1.0 / 1e-20",i="max");var u="".concat(t,"(").concat(t,"(").concat(t,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,d="\n      if (".concat("sum"===t,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===t,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(i,"(values, minMaxValue);\n      }\n    "),p="vec4";"all"===t?(s="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===t&&(s="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var f="";a%n>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(f,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(d,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===c,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(2===c,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(3===c,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(d,"\n        }\n        setOutput(").concat(u,");\n      }\n    ")};function ab(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var _n82=t.length?t[t.length-1].outSize:e[1],_r164=eu(_n82);t.push({inSize:_n82,windowSize:_r164,outSize:Math.ceil(_n82/_r164)})}return t}(e.shape),o=e,_s68=0;_s68<a.length;_s68++){var c,_d12,_a$_s=a[_s68],_i43=_a$_s.inSize,_u30=_a$_s.windowSize,l=_a$_s.outSize;c="mean"===n?0===_s68?new nb({windowSize:_u30,inSize:_i43,batchSize:e.shape[0],outSize:l},_i43):new nb({windowSize:_u30,inSize:_i43,batchSize:e.shape[0],outSize:l}):new rb({windowSize:_u30,inSize:_i43,batchSize:e.shape[0],outSize:l},n),_d12=o,o=r.runWebGLProgram(c,[o],t),_d12.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(_d12)}return o}var ob=function ob(e,t){_classCallCheck(this,ob),this.variableNames=["A"];for(var n=new Array(e.length),_r165=0;_r165<n.length;_r165++)n[_r165]=e[t[_r165]];this.outputShape=n,this.rank=n.length;var r=Pm(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),_t147=0;_t147<e.length;_t147++)r[e[_t147]]=n[_t147];return r.join()}(t);this.userCode="\n    void main() {\n      ".concat(r," resRC = getOutputCoords();\n      setOutput(getA(").concat(a,"));\n    }\n    ")},sb=function sb(e,t){_classCallCheck(this,sb),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),_r166=0;_r166<n.length;_r166++)n[_r166]=e[t[_r166]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var r=Pm(this.rank),a=gg("rc",this.rank),o=new Array(this.rank),_e180=0;_e180<t.length;_e180++)o[t[_e180]]=a[_e180];var s="vec2(".concat(o.slice(-2).join(),")"),i="++".concat(a[this.rank-1]," < ").concat(n[this.rank-1]),u="getChannel(getA(".concat(o.join(),"), ").concat(s,")");this.userCode="\n    void main() {\n      ".concat(r," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(u,";\n      if(").concat(i,") {\n        result[1] = ").concat(u,";\n      }\n      --").concat(a[this.rank-1],";\n      if(++").concat(a[this.rank-2]," < ").concat(n[this.rank-2],") {\n        result[2] = ").concat(u,";\n        if(").concat(i,") {\n          result[3] = ").concat(u,";\n        }\n      }\n      setOutput(result);\n    }\n    ")};function ib(e,t,n){var r=jt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sb(e.shape,t):new ob(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function ub(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,o=e.shape.length,s=It(a,e.shape),i=s,u=Jo(i,o),l=null!=u,c=e;l&&(c=ib(e,u,r),i=ts(i.length,o)),Zo("sum",i,o);var _Yo14=_slicedToArray(Yo(c.shape,i),2),d=_Yo14[0],p=_Yo14[1],f=d;n&&(f=Qo(d,s));var h=gt(p),m=eb({inputs:{x:c},attrs:{shape:[gt(e.shape)/h,h]},backend:r}),g=ab(m,$n(e.dtype),"sum",r),b=eb({inputs:{x:g},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),l&&r.disposeIntermediateTensorInfo(c),b}(t.x,r.axis,r.keepDims,n)}var lb={kernelName:"Sum",backendName:"webgl",kernelFunc:ub};function cb(e){for(var l,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.perm,s=n,i=a.shape.length,u=new Array(i),_e181=0;_e181<u.length;_e181++)u[_e181]=a.shape[o[_e181]];if(s.shouldExecuteOnCPU([a])){var _e182=s.texData.get(a.dataId).values,_t148=hg(_e182,a.shape,a.dtype,o,u);l=s.makeTensorInfo(u,a.dtype),s.texData.get(l.dataId).values=_t148}else l=ib(a,o,s);return l}var db={kernelName:"Transpose",backendName:"webgl",kernelFunc:cb};function pb(_ref38){var e=_ref38.a,t=_ref38.b,n=_ref38.transposeA,r=_ref38.transposeB,a=_ref38.backend,_ref38$bias=_ref38.bias,o=void 0===_ref38$bias?null:_ref38$bias,_ref38$preluActivatio=_ref38.preluActivationWeights,s=void 0===_ref38$preluActivatio?null:_ref38$preluActivatio,_ref38$leakyreluAlpha=_ref38.leakyreluAlpha,i=void 0===_ref38$leakyreluAlpha?0:_ref38$leakyreluAlpha,_ref38$activation=_ref38.activation,u=void 0===_ref38$activation?null:_ref38$activation,l=e.shape.length,c=t.shape.length,d=n?e.shape[l-2]:e.shape[l-1],p=r?t.shape[c-1]:t.shape[c-2],f=n?e.shape[l-1]:e.shape[l-2],h=r?t.shape[c-2]:t.shape[c-1],m=e.shape.slice(0,-2),g=t.shape.slice(0,-2),b=gt(m),y=gt(g);pt(l>=2&&c>=2&&(b===y||1===b||1===y),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(m,") and (").concat(g,").")}));var x=(b>y?e.shape.slice(0,-2):t.shape.slice(0,-2)).concat([f,h]);pt(d===p,(function(){return"Error in matMul: inner shapes (".concat(d,") and (").concat(p,") of Tensors with shapes ").concat(e.shape," and ").concat(t.shape," and transposeA=").concat(n," and transposeB=").concat(r," must match.")}));var R,v=n?[b,d,f]:[b,f,d],k=r?[y,h,p]:[y,p,h],w=eb({inputs:{x:e},backend:a,attrs:{shape:v}}),I=eb({inputs:{x:t},backend:a,attrs:{shape:k}}),N=[w,I],T=Math.max(b,y),C=n?w.shape[1]:w.shape[2],E=null!=o,S=null!=s,_="leakyrelu"===u,$=null!=u?Gg(u,!0):null;if((1===f||1===h)&&C>1e3&&!1===(E||S||_||null!=$)){var _e183=w,_t149=I;n&&(_e183=cb({inputs:{x:w},backend:a,attrs:{perm:[0,2,1]}}),N.push(_e183)),r&&(_t149=cb({inputs:{x:I},backend:a,attrs:{perm:[0,2,1]}}),N.push(_t149));var _o103=1===h,_s69=_e183;1!==h&&(_s69=eb({inputs:{x:_e183},backend:a,attrs:{shape:[T,C,1]}}),N.push(_s69));var _i44=1===h?2:1,_u31=_t149;_o103&&(_u31=eb({inputs:{x:_t149},backend:a,attrs:{shape:[T,1,C]}}),N.push(_u31));var _l10=Zg({inputs:{a:_s69,b:_u31},backend:a});R=ub({inputs:{x:_l10},backend:a,attrs:{axis:_i44,keepDims:!0}}),N.push(_l10)}else{var _u32=_n(e.dtype,t.dtype),_l11=new qg(v,k,[T,f,h],n,r,E,$,S,_),_c8=[w,I];if(null!=o&&_c8.push(o),S&&_c8.push(s),_){var _e184=a.makeTensorInfo([],"float32",an(i,"float32"));_c8.push(_e184),N.push(_e184)}R=a.runWebGLProgram(_l11,_c8,_u32)}var A=eb({inputs:{x:R},backend:a,attrs:{shape:x}});N.push(R);for(var _i45=0,_N2=N;_i45<_N2.length;_i45++){var _e185=_N2[_i45];a.disposeIntermediateTensorInfo(_e185)}return A}var fb={kernelName:"_FusedMatMul",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=t.bias,i=t.preluActivationWeights,u=r.transposeA,l=r.transposeB,c=r.activation;return pb({a:a,b:o,transposeA:u,transposeB:l,backend:n,bias:s,preluActivationWeights:i,leakyreluAlpha:r.leakyreluAlpha,activation:c})}},hb={kernelName:"Abs",backendName:"webgl",kernelFunc:function kernelFunc(e){var a,t=e.inputs,n=e.backend,r=t.x;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){var _e186=n.texData.get(r.dataId),_t150=ug(_e186.values);return n.makeTensorInfo(r.shape,r.dtype,_t150)}return a=jt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Eg(r.shape,"return abs(x);"):new Ng(r.shape,"return abs(x);"),n.runWebGLProgram(a,[r],r.dtype)}},mb={kernelName:"Acos",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"})},gb={kernelName:"Acosh",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"})},bb="return a + b;",yb=jg({opSnippet:bb,packedOpSnippet:bb,supportsComplex:!0,cpuKernelImpl:Wm}),xb={kernelName:Yt,backendName:"webgl",kernelFunc:yb},vb=function vb(e,t){_classCallCheck(this,vb),this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=[];this.variableNames.forEach((function(e){n.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var r=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        float result = ").concat(r,";\n        setOutput(result);\n      }\n    ")},kb=function kb(e,t){_classCallCheck(this,kb),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var r=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        vec4 result = ").concat(r,";\n        setOutput(result);\n      }\n    ")},wb={kernelName:"AddN",backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return Og({inputs:{x:a[0]},backend:r});if(a.length>jt().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var _t151=Math.floor(a.length/2),_n83=e({inputs:a.slice(0,_t151),backend:r}),_o104=e({inputs:a.slice(_t151),backend:r});return e({inputs:[_n83,_o104],backend:r})}var o=a.map((function(e){return e.dtype})).reduce((function(e,t){return _n(e,t)})),s=a.map((function(e){return e.shape})),i=jt().getBool("WEBGL_PACK")?new kb(a[0].shape,s):new vb(a[0].shape,s);return r.runWebGLProgram(i,a,o)}},Ib={kernelName:"All",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,i=a.shape.length,u=It(o,a.shape),l=u,c=Jo(l,i),d=a;null!=c&&(d=cb({inputs:{x:a},backend:n,attrs:{perm:c}}),l=ts(l.length,i)),Zo("all",l,i);var g,_Yo16=_slicedToArray(Yo(d.shape,l),2),p=_Yo16[0],h=eb({inputs:{x:d},backend:n,attrs:{shape:[-1,gt(_Yo16[1])]}}),m=ab(h,h.dtype,"all",n);return g=eb(s?{inputs:{x:m},backend:n,attrs:{shape:Qo(p,u)}}:{inputs:{x:m},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),g}},Nb={kernelName:"Any",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,i=a.shape.length,u=It(o,a.shape),l=u,c=Jo(l,i),d=a;null!=c&&(d=cb({inputs:{x:a},backend:n,attrs:{perm:c}}),l=ts(l.length,i)),Zo("any",l,i);var g,_Yo18=_slicedToArray(Yo(d.shape,l),2),p=_Yo18[0],h=eb({inputs:{x:d},backend:n,attrs:{shape:[-1,gt(_Yo18[1])]}}),m=ab(h,h.dtype,"any",n);return g=eb(s?{inputs:{x:m},backend:n,attrs:{shape:Qo(p,u)}}:{inputs:{x:m},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),g}},Tb=function Tb(e,t,n){_classCallCheck(this,Tb),this.variableNames=["A"];var r=e.windowSize,a=e.batchSize,o=e.outSize;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var s="max"===t?">":"<",i=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(r,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          int inIdx = ").concat(i,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")},Cb=function Cb(e,t,n,r){_classCallCheck(this,Cb),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,pt(e.length>2,(function(){return"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2.")}));var a=e[e.length-1],o=Math.ceil(a/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var c,d,s=this.outputShape,i=s.length,u=Pm(i),l=bg("coords",i);if(1===o){var _e187=Pm(d=i+1);c="\n        ".concat(_e187," sourceLocR = ").concat(_e187,"(").concat(l.join(),", 0);\n        ++").concat(l[i-1],";\n        ").concat(_e187," sourceLocG = ").concat(_e187,"(").concat(l.join(),", 0);\n        ++").concat(l[i-2],";\n        ").concat(_e187," sourceLocA = ").concat(_e187,"(").concat(l.join(),", 0);\n        --").concat(l[i-1],";\n        ").concat(_e187," sourceLocB = ").concat(_e187,"(").concat(l.join(),", 0);\n        --").concat(l[i-2],";")}else d=i,c="\n        ".concat(u," sourceLocR = coords;\n        ++").concat(l[i-1],";\n        ").concat(u," sourceLocG = coords;\n        ++").concat(l[i-2],";\n        ").concat(u," sourceLocA = coords;\n        --").concat(l[i-1],";\n        ").concat(u," sourceLocB = coords;\n        --").concat(l[i-2],";");var p=["x","y","z","w","u","v"].slice(0,d),f="."+p[d-1],h=p.map((function(e){return"int "+e})),m=bg("sourceLocR",d-1).concat("inIdx.r"),g=bg("sourceLocG",d-1).concat("inIdx.g"),b=bg("sourceLocB",d-1).concat("inIdx.b"),y=bg("sourceLocA",d-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",v=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(m.join(),"),\n                             getBestIndicesAChannel(").concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),")));"),k="vec4(\n            getAChannel(".concat(m.join(),"),\n            hasNextCol ? getAChannel(").concat(g.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(y.join(),") : 0.)"),w=r?"":"\n      float getBestIndicesAChannel(".concat(h.join(),") {\n        return getChannel(getBestIndicesA(").concat(p.join(),"),\n                                          vec2(").concat(p.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(h.join(),") {\n        return getChannel(getA(").concat(p.join(),"),\n                               vec2(").concat(p.slice(-2).join(),"));\n      }\n      ").concat(w,"\n      void main() {\n        ").concat(u," coords = getOutputCoords();\n        bool hasNextCol = ").concat(l[i-1]," < ").concat(s[i-1]-1,";\n        bool hasNextRow = ").concat(l[i-2]," < ").concat(s[i-2]-1,";\n        ").concat(c,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(f,", sourceLocG").concat(f,",\n          sourceLocB").concat(f,", sourceLocA").concat(f,") * ").concat(t,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(k,";\n\n        for (int i = 0; i < ").concat(t,"; i++) {\n          inIdx = srcIdx;\n          ").concat(v,"\n          vec4 candidate = ").concat(k,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(x,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")};function _b(e,t,n,r){var a=[n];if(Zo("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!jt().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var _n84=[],_Yo20=_slicedToArray(Yo(t.shape,a),2),_o105=_Yo20[0],_i46=gt(_Yo20[1]),_u33=eb({inputs:{x:t},backend:e,attrs:{shape:[-1,_i46]}});_n84.push(_u33);var l=function Eb(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],o=t.shape[1];null!=r&&(a=r.shape[0],o=r.shape[1]);var s=eu(o),i={windowSize:s,inSize:o,batchSize:a,outSize:Math.ceil(o/s)},u=new Tb(i,n,null==r),l=[t];null!=r&&l.push(r);var c=e.runWebGLProgram(u,l,"int32");if(1===c.shape[1])return c;var d=Eb(e,t,n,c);return e.disposeIntermediateTensorInfo(c),d}(e,_u33,r);_n84.push(l);var c=eb({inputs:{x:l},backend:e,attrs:{shape:_o105}});return _n84.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),c}return function Sb(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,o=eu(a[a.length-1]),s=new Cb(a,o,n,null==r),i=null==r?[t]:[t,r],u=e.runWebGLProgram(s,i,"int32");if(u.shape.length===t.shape.length){var _r167=Sb(e,t,n,u);return e.disposeIntermediateTensorInfo(u),_r167}return u}(e,t,r)}var $b={kernelName:"ArgMax",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,s=It(r.axis,a.shape),i=Jo(s,a.shape.length),u=a,l=[];null!=i&&(u=cb({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),s=ts(s.length,u.shape.length)),Zo("argMax",[s[0]],u.shape.length);var c=_b(n,u,s[0],"max");return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},Rb={kernelName:"ArgMin",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,s=It(r.axis,a.shape),i=Jo(s,a.shape.length),u=a,l=[];null!=i&&(u=cb({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),s=ts(s.length,u.shape.length)),Zo("argMin",[s[0]],u.shape.length);var c=_b(n,u,s[0],"min");return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},Ab={kernelName:"Asin",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"})},Fb={kernelName:"Asinh",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"})},Ob={kernelName:"Atan",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"})},Mb={kernelName:"Atan2",backendName:"webgl",kernelFunc:jg({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},Db={kernelName:"Atanh",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"})},Pb=function Pb(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck(this,Pb),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,i=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var h="avg"===t,m="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),b="0.0";if(h||(b="-1.0 / 1e-20"),n){var _t152=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(i,");\n        const ivec2 pads = ivec2(").concat(p,", ").concat(f,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(u,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(_t152," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(r?a?m:g:"wR * ".concat(d," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var y="".concat(t,"(").concat(t,"(").concat(t,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===t&&(y="avgValue / count");var x=4*Math.floor(o/4),v=o%4,k="\n      if (".concat(h,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(i,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(f,");\n      const float initializationValue = ").concat(b,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(b,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(c,";\n            wR += ").concat(u,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(x,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(k,"\n          }\n\n          int xC = xCCorner + ").concat(x,";\n          if (").concat(1===v,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(2===v,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(3===v,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(k,"\n          }\n        }\n        setOutput(").concat(y,");\n      }\n    ")}},Lb=function Lb(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck(this,Lb),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,i=e.strideHeight,u=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;var y="avg"===t,x="0.0";if(y||(x="-1.0 / 1e-20"),n){var _t153=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(i,", ").concat(u,");\n        const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(b,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(p,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(f,";\n                wR += ").concat(c,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(h,";\n                  wC += ").concat(d,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(_t153," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(r?a?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(f," * ").concat(h," +\n                      wR * ").concat(h," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var v="".concat(t,"(").concat(t,"(").concat(t,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===t&&(v="avgValue / count");var k=4*Math.floor(o/4),w=o%4,I="\n      if (".concat(y,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(i,", ").concat(u,");\n      const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(b,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,";\n            wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(k,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(d,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(d,", ch)\n              );\n\n              ").concat(I,"\n            }\n\n            int xC = xCCorner + ").concat(k,";\n            if (").concat(1===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(I,"\n            } else if (").concat(2===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(I,"\n            } else if (").concat(3===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                initializationValue\n              );\n\n              ").concat(I,"\n            }\n          }\n          setOutput(").concat(v,");\n        }\n      }\n    ")}},Bb={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;rm(a,"avgPool");var o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode;pt(za(s,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l=$a(a.shape,o,s,1,i,u);if(1===l.filterWidth&&1===l.filterHeight&&bt(l.inShape,l.outShape))return Og({inputs:{x:a},backend:n});var c=new Pb(l,"avg",!1);return n.runWebGLProgram(c,[a],"float32")}},zb={kernelName:"AvgPool3D",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode,l=r.dataFormat,c=Ra(a.shape,o,s,[1,1,1],i,u,l),d=new Lb(c,"avg",!1);return n.runWebGLProgram(d,[a],"float32")}},Wb=function Wb(e){_classCallCheck(this,Wb),this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,i=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=i-1-e.padInfo.top,c=u-1-e.padInfo.left,d=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(c,");\n      const float avgMultiplier = float(").concat(d,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(u,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Vb=function Vb(e){_classCallCheck(this,Vb),this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,o=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=c-1-e.padInfo.front,h=d-1-e.padInfo.top,m=p-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3(".concat(f,", ").concat(h,", ").concat(m,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(c,";\n            wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(a,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(u,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(p,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Ub={kernelName:"AvgPool3DGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,s=t.input,i=r.filterSize,u=r.strides,l=r.pad,c=r.dimRoundingMode,d=Ra(s.shape,i,u,[1,1,1],l,c),p=new Vb(d);return n.runWebGLProgram(p,[a],s.dtype)}},Hb={kernelName:"AvgPoolGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,s=o;rm([a,o],"avgPoolGrad");var i=r.filterSize,u=r.strides,l=r.pad,c=$a(s.shape,i,u,1,l),d=new Wb(c);return n.runWebGLProgram(d,[a],s.dtype)}},jb={kernelName:"BatchMatMul",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs;return pb({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},Gb=function Gb(e,t,n,r,a,o){_classCallCheck(this,Gb),this.outputShape=[],this.variableNames=["x","mean","variance"],bo(e,t),bo(e,n);var s="0.0";null!=r&&(bo(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var i="1.0";null!=a&&(bo(e,a),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(i,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")},qb=function qb(e,t,n,r,a,o){_classCallCheck(this,qb),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],bo(e,t),bo(e,n);var s="vec4(0.0)";null!=r&&(bo(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var i="vec4(1.0)";null!=a&&(bo(e,a),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(i,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")},Kb={kernelName:"FusedBatchNorm",backendName:"webgl",kernelFunc:function kernelFunc(_ref39){var e=_ref39.inputs,t=_ref39.backend,n=_ref39.attrs,r=e.x,a=e.mean,o=e.variance,s=e.offset,i=e.scale;pt(a.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),pt(null==s||a.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),pt(null==i||a.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var u=n.varianceEpsilon;null==u&&(u=.001);var l=[r,a,o],c=null;null!=s&&(c=s.shape,l.push(s));var d=null;null!=i&&(d=i.shape,l.push(i));var p=jt().getBool("WEBGL_PACK_NORMALIZATION")?new qb(r.shape,a.shape,o.shape,c,d,u):new Gb(r.shape,a.shape,o.shape,c,d,u);return t.runWebGLProgram(p,l,l[0].dtype)}},Xb=function(){function Xb(e){_classCallCheck(this,Xb),this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var a,t=Pm(this.rank),n="uniform int start[".concat(this.rank,"];"),r=function(e){if(1===e)return"sourceLoc";if(e<=6)return Yb.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);a="\n        ".concat(t," sourceLoc;\n        ").concat(t," coords = getOutputCoords();\n        ").concat(e.map((function(e,t){return"sourceLoc.".concat(Yb[t]," = start[").concat(t,"] + coords.").concat(Yb[t],";")})).join("\n"),"\n      "),this.userCode="\n      ".concat(n,"\n      void main() {\n        ").concat(a,"\n        setOutput(getSource(").concat(r,"));\n      }\n    ")}return _createClass(Xb,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this64=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(t,n){null==_this64.startLoc&&(_this64.startLoc=t.getUniformLocationNoThrow(n,"start"),null==_this64.startLoc)||t.gl.uniform1iv(_this64.startLoc,e)}}}]),Xb}(),Yb=["x","y","z","w","u","v"],Qb=function(){function Qb(e){_classCallCheck(this,Qb),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Pm(this.rank),n=bg("coords",this.rank),r=bg("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":"vec2(".concat(r.slice(-2).join(),")"),o="getChannel(getSource(".concat(r.join(),"), ").concat(a,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n        ++").concat(r[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(r[this.rank-1],";\n      }\n    "),i=1===this.rank?"":"\n      --".concat(n[this.rank-1],";\n      if (++").concat(n[this.rank-2]," < ").concat(e[this.rank-2],") {\n        ++").concat(r[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n          ++").concat(r[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),u=this.rank<=4?"sourceLoc = coords +\n            ".concat(t,"(").concat(e.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):e.map((function(e,t){return"".concat(r[t]," = ").concat(n[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      uniform int start[".concat(this.rank,"];\n      void main() {\n        ").concat(t," coords = getOutputCoords();\n        ").concat(t," sourceLoc;\n        ").concat(u,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(i,"\n        setOutput(result);\n      }\n    ")}return _createClass(Qb,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this65=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(t,n){null==_this65.startLoc&&(_this65.startLoc=t.getUniformLocationNoThrow(n,"start"),null==_this65.startLoc)||t.gl.uniform1iv(_this65.startLoc,e)}}}]),Qb}();function Zb(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,_aa6=_slicedToArray(aa(a,r.begin,r.size),2),i=_aa6[0],u=_aa6[1];if(Hr(a,i,u),0===gt(u))return n.makeTensorInfo(u,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var _e188=n.texData.get(a.dataId),_t154=lg(_e188.values,i,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,_t154)}var l=n.texData.get(a.dataId).isPacked,c=na(a.shape,i,u);if(l||!c){var _e189=jt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Qb(u):new Xb(u),_t155=_e189.getCustomSetupFunc(i);return n.runWebGLProgram(_e189,[a],a.dtype,_t155)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),o=r.makeTensorInfo(n,e.dtype),s=r.texData.get(o.dataId);Object.assign(s,a),s.refCount=1,s.shape=n,s.dtype=e.dtype;var i=ra(t,Ot(e.shape));a.slice&&(i+=a.slice.flatOffset),s.slice={flatOffset:i,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,u+1),o}(a,i,u,n)}var Jb={kernelName:"Slice",backendName:"webgl",kernelFunc:Zb},ey={kernelName:"BatchToSpaceND",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,s=r.crops;pt(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var i=o.reduce((function(e,t){return e*t})),u=nu(a.shape,o,i),l=ru(u.length,o.length),c=au(a.shape,o,i),d=ou(s,o.length),p=su(c,s,o.length),f=[],h=eb({inputs:{x:a},backend:n,attrs:{shape:u}}),m=cb({inputs:{x:h},backend:n,attrs:{perm:l}}),g=eb({inputs:{x:m},backend:n,attrs:{shape:c}}),b=Zb({inputs:{x:g},backend:n,attrs:{begin:d,size:p}});return f.push(h),f.push(m),f.push(g),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}},ty={kernelName:"Bincount",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.weights,s=r.size,i=n.readSync(a.dataId),u=n.readSync(o.dataId),l=Vm(i,u,o.dtype,o.shape,s);return n.makeTensorInfo([s],o.dtype,l)}},ny=jg({opSnippet:"return float(a != b);",dtype:"bool"}),ry={kernelName:"NotEqual",backendName:"webgl",kernelFunc:ny};function ay(e){var t=e.inputs,n=e.backend,r=t.input;return Og({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var oy={kernelName:"Real",backendName:"webgl",kernelFunc:ay},sy={kernelName:"Cast",backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,o=n.x,s=a.dtype;if("complex64"===s){if("complex64"===o.dtype)return Og({inputs:{x:o},backend:r});var _t156=bs(o.shape),_n85=e({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),_a147=Dg({inputs:{real:_n85,imag:_t156},backend:r});return _t156.dispose(),r.disposeIntermediateTensorInfo(_n85),_a147}if("complex64"===o.dtype){var _t157=ay({inputs:{input:o},backend:r}),_n86=e({inputs:{x:_t157},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(_t157),_n86}if(!Et(o.dtype,s)){var _e190=Og({inputs:{x:o},backend:r});return{dataId:_e190.dataId,shape:_e190.shape,dtype:s}}if("int32"===s)return function(e,t){var n=new Ng(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(o,r);if("bool"===s){var _e191=r.makeTensorInfo([],"bool",Tt("bool",1)),_t158=ny({inputs:{a:o,b:_e191},backend:r});return r.disposeIntermediateTensorInfo(_e191),_t158}throw new Error("Error in Cast: failed to cast ".concat(o.dtype," to ").concat(s))}},iy="return ceil(x);",uy={kernelName:"Ceil",backendName:"webgl",kernelFunc:Hg({opSnippet:iy,packedOpSnippet:iy,cpuKernelImpl:Hm})},ly=function(){function ly(e){_classCallCheck(this,ly),this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return _createClass(ly,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e,t){var _this66=this;return function(n,r){null==_this66.minLoc&&(_this66.minLoc=n.getUniformLocationNoThrow(r,"minVal"),_this66.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(_this66.minLoc,e),n.gl.uniform1f(_this66.maxLoc,t)}}}]),ly}(),cy=function(){function cy(e){_classCallCheck(this,cy),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return _createClass(cy,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e,t){var _this67=this;return function(n,r){null==_this67.minLoc&&(_this67.minLoc=n.getUniformLocationNoThrow(r,"minVal"),_this67.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(_this67.minLoc,e),n.gl.uniform1f(_this67.maxLoc,t)}}}]),cy}(),dy={kernelName:"ClipByValue",backendName:"webgl",kernelFunc:function kernelFunc(e){var i,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.clipValueMin,s=r.clipValueMax,u=(i=jt().getBool("WEBGL_PACK_CLIP")?new cy(a.shape):new ly(a.shape)).getCustomSetupFunc(o,s);return n.runWebGLProgram(i,[a],a.dtype,u)}},py=function py(e){_classCallCheck(this,py),this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "};function fy(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var hy={kernelName:"ComplexAbs",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),o=new py(r.shape),s=[fy(r,a.complexTensorInfos.real),fy(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(o,s,s[0].dtype)}},my=function my(e){_classCallCheck(this,my),this.outputShape=[],this.outputShape=Ji(e,1),this.variableNames=e.map((function(e,t){return"T".concat(t)}));var t=new Array(e.length-1);t[0]=e[0][1];for(var _n87=1;_n87<t.length;_n87++)t[_n87]=t[_n87-1]+e[_n87][1];for(var n=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")],_e192=1;_e192<t.length;_e192++){var _r168=t[_e192-1];n.push("else if (yC < ".concat(t[_e192],") setOutput(getT").concat(_e192,"(yR, yC-").concat(_r168,"));"))}var r=t.length,a=t[t.length-1];n.push("else setOutput(getT".concat(r,"(yR, yC-").concat(a,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(n.join("\n        "),"\n      }\n    ")},gy=function gy(e,t){_classCallCheck(this,gy),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ji(e,t);var n=this.outputShape,r=n.length,a=Pm(r),o=bg("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T".concat(t)}));var i=new Array(e.length-1);i[0]=e[0][t];for(var _n88=1;_n88<i.length;_n88++)i[_n88]=i[_n88-1]+e[_n88][t];for(var u=s[t],l=s.slice(-2),c=s.join(),d="if (".concat(u," < ").concat(i[0],") {\n        return getChannel(\n            getT0(").concat(c,"), vec2(").concat(l.join(),"));\n        }"),_e193=1;_e193<i.length;_e193++){var _t159=i[_e193-1];d+="\n        if (".concat(u," < ").concat(i[_e193],"  && ").concat(u," >= ").concat(i[_e193-1],") {\n          return getChannel(\n            getT").concat(_e193,"(").concat(by(s,u,_t159),"),\n            vec2(").concat(by(l,u,_t159),"));\n        }")}var p=i.length,f=i[i.length-1];d+="\n        return getChannel(\n          getT".concat(p,"(").concat(by(s,u,f),"),\n          vec2(").concat(by(l,u,f),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(a," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[r-1]," = ").concat(o[r-1]," + 1;\n        if (").concat(o[r-1]," < ").concat(n[r-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[r-2]," = ").concat(o[r-2]," + 1;\n        if (").concat(o[r-2]," < ").concat(n[r-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[r-1]," = ").concat(o[r-1]," - 1;\n        if (").concat(o[r-2]," < ").concat(n[r-2]," &&\n            ").concat(o[r-1]," < ").concat(n[r-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")};function by(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function yy(e){var t=e.inputs,n=e.backend,r=t.input;return Og({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var xy={kernelName:"Imag",backendName:"webgl",kernelFunc:yy};function ky(e,t,n){var r=Ji(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return eb({inputs:{x:e},attrs:{shape:[-1,gt(e.shape.slice(t))]},backend:n})})),outShape:r}}function wy(e){var t=e.inputs,n=e.backend,o=It(e.attrs.axis,t[0].shape)[0],s=Ji(t.map((function(e){return e.shape})),o);if(0===gt(s))return n.makeTensorInfo(s,t[0].dtype,[]);var i=t.filter((function(e){return gt(e.shape)>0}));return 1===i.length?Og({inputs:{x:i[0]},backend:n}):(Zi(i.map((function(e){return e.shape})),o),function vy(e,t,n){var r=e[0].dtype;if("complex64"===r){var _r169=e.map((function(e){return ay({inputs:{input:e},backend:n})})),_a148=e.map((function(e){return yy({inputs:{input:e},backend:n})})),_o106=vy(_r169,t,n),_s71=vy(_a148,t,n),_i47=Dg({inputs:{real:_o106,imag:_s71},backend:n});return _r169.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),_a148.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(_o106),n.disposeIntermediateTensorInfo(_s71),_i47}if("string"===r){var _ky=ky(e,t,n),_a149=_ky.tensors2D,_o107=_ky.outShape,_s72=_a149.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),_i48=1===_a149[0].shape[0],_u34=jm(_s72,_o107,r,_i48),_l12=Ji(e.map((function(e){return e.shape})),t),c=n.makeTensorInfo(_l12,r,_u34);return _a149.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}if(e.length>jt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var _r170=Math.floor(e.length/2),_a150=vy(e.slice(0,_r170),t,n),_o108=vy(e.slice(_r170),t,n),_s73=vy([_a150,_o108],t,n);return n.disposeIntermediateTensorInfo(_a150),n.disposeIntermediateTensorInfo(_o108),_s73}if(jt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var _a151=new gy(e.map((function(e){return e.shape})),t);return n.runWebGLProgram(_a151,e,r)}var _ky2=ky(e,t,n),a=_ky2.tensors2D,o=_ky2.outShape,s=new my(a.map((function(e){return e.shape}))),i=n.runWebGLProgram(s,a,r);a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var u=eb({inputs:{x:i},attrs:{shape:o},backend:n});return n.disposeIntermediateTensorInfo(i),u}(i,o,n))}var Iy={kernelName:"Concat",backendName:"webgl",kernelFunc:wy},Ny=function Ny(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,Ny),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,i=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,f=4*Math.floor(e.inChannels/4),h=e.inChannels%4,m="channelsLast"===e.dataFormat,g=m?1:2,b=m?2:3,y=m?3:1,x="",v="";n&&(x=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),v="result = activation(result);");var k=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(i,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(y,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(b,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(p,"; wC++) {\n            int xC = xCCorner + wC * ").concat(c,";\n\n            if (xC < 0 || xC >= ").concat(e.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===h,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(f,") *\n                    getW(wR, wC, ").concat(f,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(f,", xR, xC) *\n                    getW(wR, wC, ").concat(f,", d2);\n              }\n\n            } else if (").concat(2===h,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===h,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2),\n                getW(wR, wC, ").concat(f," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1),\n                  getX(batch, xR, xC, ").concat(f," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC),\n                  getX(batch, ").concat(f," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(k,"\n        ").concat(v,"\n        setOutput(result);\n      }\n    ")},Ty=function Ty(e){_classCallCheck(this,Ty),this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,o=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,d=e.filterHeight,p=e.filterWidth,f=4*Math.floor(e.inChannels/4),h=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(a,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(t,", ").concat(n,", ").concat(r,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(c,"; wF++) {\n          int xF = xFCorner + wF * ").concat(i,";\n\n          if (xF < 0 || xF >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(d,"; wR++) {\n            int xR = xRCorner + wR * ").concat(u,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(p,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===h,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(f,") *\n                  getW(wF, wR, wC, ").concat(f,", d2);\n              } else if (").concat(2===h,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===h,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1),\n                  getX(batch, xF, xR, xC, ").concat(f," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2),\n                  getW(wF, wR, wC, ").concat(f," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Cy=function Cy(e,t,n){_classCallCheck(this,Cy),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,a=n.inChannels,o=n.strideWidth,s=n.strideHeight,i=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,d=n.dataFormat,p=i.left,f=i.top,h=a*r,m=om(),g="channelsLast"===d,b=g?0:1,y=g?1:2,x="",_n89=0;_n89<=1;_n89++)for(var _r171=0;_r171<=1;_r171++)x+="\n          blockIndex = rc.y + ".concat(_r171,";\n          pos = rc.x + ").concat(_n89,";\n\n          if(blockIndex < ").concat(e[1]," && pos < ").concat(e[0],") {\n            offsetY = int(blockIndex / (").concat(u,")) * ").concat(s," - ").concat(f,";\n            d0 = offsetY + ").concat(c," * (pos / ").concat(h,");\n\n            if(d0 < ").concat(t[b]," && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ").concat(u,".) * ").concat(o,". - ").concat(p,".);\n              d1 = offsetX + ").concat(l," * (int(mod(float(pos), ").concat(h,".) / ").concat(a,".));\n\n              if(d1 < ").concat(t[y]," && d1 >= 0) {\n\n                ch = int(mod(float(pos), ").concat(a,".));\n\n                if (").concat(g,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*_n89+_r171,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*_n89+_r171,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(x,"\n\n        ").concat(m.output," = result;\n      }\n    ")};function Ey(_ref40){var h,e=_ref40.x,t=_ref40.filter,n=_ref40.convInfo,r=_ref40.backend,_ref40$bias=_ref40.bias,a=void 0===_ref40$bias?null:_ref40$bias,_ref40$preluActivatio=_ref40.preluActivationWeights,o=void 0===_ref40$preluActivatio?null:_ref40$preluActivatio,_ref40$leakyreluAlpha=_ref40.leakyreluAlpha,s=void 0===_ref40$leakyreluAlpha?0:_ref40$leakyreluAlpha,_ref40$activation=_ref40.activation,i=void 0===_ref40$activation?null:_ref40$activation,u=e.shape,l=r.texData.get(e.dataId),c=n.inChannels,d=u[0]*u[1]*u[2],p=n.outChannels,f="channelsLast"===n.dataFormat,m=[],g=(1===d||1===p)&&c>1e3,b=u[2]%2!=0&&!!l.isPacked;if(!g&&jt().getBool("WEBGL_LAZILY_UNPACK")&&jt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&b){var _c9=f?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),_d13={dataId:e.dataId,shape:[1,_c9,n.inChannels],dtype:e.dtype},_p7=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,pt(Yh(l.shape,_d13.shape),(function(){return"packed reshape ".concat(l.shape," to ").concat(_d13.shape," isn't free")}));var _g5=eb({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(_g5);var _b4=pb({a:_d13,b:_g5,backend:r,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:o,leakyreluAlpha:s}),_y4=r.texData.get(_b4.dataId);pt(_y4.isPacked,(function(){return"batchMatMul result is expected to be packed"})),l.shape=_p7,_y4.shape=n.outShape,(h=Og({inputs:{x:_b4},backend:r})).shape=n.outShape,m.push(_b4)}else{var _l13=eb({inputs:{x:e},backend:r,attrs:{shape:[1,f?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],n.inChannels]}}),_c10=eb({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),_d14=pb({a:_l13,b:_c10,transposeA:!1,transposeB:!1,backend:r,bias:a,activation:i,preluActivationWeights:o,leakyreluAlpha:s});h=eb({inputs:{x:_d14},backend:r,attrs:{shape:n.outShape}}),m.push(_l13),m.push(_c10),m.push(_d14)}for(var _i49=0,_m6=m;_i49<_m6.length;_i49++){var _e194=_m6[_i49];r.disposeIntermediateTensorInfo(_e194)}return h}function Sy(_ref41){var e=_ref41.x,t=_ref41.filter,n=_ref41.convInfo,r=_ref41.backend,_ref41$bias=_ref41.bias,a=void 0===_ref41$bias?null:_ref41$bias,_ref41$preluActivatio=_ref41.preluActivationWeights,o=void 0===_ref41$preluActivatio?null:_ref41$preluActivatio,_ref41$leakyreluAlpha=_ref41.leakyreluAlpha,s=void 0===_ref41$leakyreluAlpha?0:_ref41$leakyreluAlpha,_ref41$activation=_ref41.activation,i=void 0===_ref41$activation?null:_ref41$activation,u=n.filterWidth,l=n.filterHeight,c=n.inChannels,d=n.outWidth,p=n.outHeight,h="channelsLast"===n.dataFormat,m=u*l*c,g=p*d,b=[m,g],y=[],x=eb({inputs:{x:e},backend:r,attrs:{shape:e.shape.slice(1)}}),v=eb({inputs:{x:t},backend:r,attrs:{shape:[1,m,gt(t.shape)/m]}});y.push(x),y.push(v);var k=new Cy(b,x.shape,n),w=r.runWebGLProgram(k,[x],"float32"),I=eb({inputs:{x:w},backend:r,attrs:{shape:[1,b[0],b[1]]}});y.push(w),y.push(I);var N=null!=a,T=null!=o,C="leakyrelu"===i,E=i?Gg(i,!0):null,S=new qg(I.shape,v.shape,[1,g,n.outChannels],!0,!1,N,E,T,C),_=[I,v];if(a&&_.push(a),T&&_.push(o),C){var _e195=r.makeTensorInfo([],"float32",an(s,"float32"));_.push(_e195),y.push(_e195)}var $=r.runWebGLProgram(S,_,"float32"),R=eb({inputs:{x:$},backend:r,attrs:{shape:h?[1,p,d,n.outChannels]:[1,n.outChannels,p,d]}});y.push($);for(var _i50=0,_y5=y;_i50<_y5.length;_i50++){var _e196=_y5[_i50];r.disposeIntermediateTensorInfo(_e196)}return R}var _y={kernelName:"Conv2D",backendName:"webgl",kernelFunc:function kernelFunc(e){var f,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dilations,c=r.dimRoundingMode,d=Wa(u),p=Aa(a.shape,o.shape,s,l,i,c,!1,d);if(1!==p.filterHeight||1!==p.filterWidth||1!==p.dilationHeight||1!==p.dilationWidth||1!==p.strideHeight||1!==p.strideWidth||"SAME"!==p.padInfo.type&&"VALID"!==p.padInfo.type)if(jt().getBool("WEBGL_CONV_IM2COL")&&1===a.shape[0])f=Sy({x:a,filter:o,convInfo:p,backend:n});else{var _e197=new Ny(p);f=n.runWebGLProgram(_e197,[a,o],"float32")}else f=Ey({x:a,filter:o,convInfo:p,backend:n});var h=eb({inputs:{x:f},backend:n,attrs:{shape:p.outShape}});return n.disposeIntermediateTensorInfo(f),h}},$y=function $y(e){_classCallCheck(this,$y),this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,o="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(a,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Ry=function Ry(e){_classCallCheck(this,Ry),this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,o="channelsLast"===e.dataFormat,s=t-1-e.padInfo.top,i=n-1-e.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(c,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(u,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Ay=function Ay(e){_classCallCheck(this,Ay),this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(e.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t," - ").concat(a,";\n\n            if (xF < 0 || xF >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(n," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(r," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Fy=function Fy(e){_classCallCheck(this,Fy),this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,o=e.strideHeight,s=e.strideWidth,i=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(i,", ").concat(u,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(t,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(a,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(e.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(t," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(n,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(n," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(r,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(r," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Oy={kernelName:"Conv2DBackpropFilter",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=r.filterShape,d=Wa(u),p=Aa(a.shape,c,s,1,i,l,!1,d),f=new $y(p);return n.runWebGLProgram(f,[a,o],"float32")}},My={kernelName:"Conv2DBackpropInput",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.inputShape,i=r.strides,u=r.pad,l=r.dataFormat,c=r.dimRoundingMode,d=Wa(l),p=Aa(s,o.shape,i,1,u,c,!1,d),f=new Ry(p);return n.runWebGLProgram(f,[a,o],"float32")}},Dy={kernelName:"Conv3D",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dilations,l=Fa(a.shape,o.shape,s,u,i),c=new Ty(l);return n.runWebGLProgram(c,[a,o],"float32")}},Py={kernelName:"Conv3DBackpropFilterV2",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.pad,u=r.filterShape,l=Fa(a.shape,u,s,1,i),c=new Ay(l);return n.runWebGLProgram(c,[a,o],"float32")}},Ly={kernelName:"Conv3DBackpropInputV2",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.pad,i=r.strides,l=Fa(r.inputShape,o.shape,i,1,s),c=new Fy(l);return n.runWebGLProgram(c,[a,o],"float32")}},By={kernelName:"Cos",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"})},zy={kernelName:"Cosh",backendName:"webgl",kernelFunc:Hg({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"})},Wy=function Wy(e,t,n,r,a){_classCallCheck(this,Wy),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var _e198=_slicedToArray(e,4),o=_e198[0],s=_e198[1],i=_e198[2],u=_e198[3],l=_slicedToArray(t,1)[0],_n90=_slicedToArray(n,2),c=_n90[0],d=_n90[1];this.outputShape=[l,c,d,u];var p="bilinear"===r?1:0,f=s-1+".0",h=i-1+".0",_ref43=_slicedToArray(c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio","y1*".concat(f," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(f)],3),m=_ref43[0],g=_ref43[1],b=_ref43[2],_ref45=_slicedToArray(d>1?[""+(i-1)/(d-1),"(x2-x1) * width_ratio","x1*".concat(h," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(h)],3),y=_ref45[0],x=_ref45[1],v=_ref45[2];this.userCode="\n      const float height_ratio = float(".concat(m,");\n      const float width_ratio = float(").concat(y,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(o,") {\n          return;\n        }\n\n        float height_scale = ").concat(g,";\n        float width_scale = ").concat(x,";\n\n        float in_y = ").concat(b,";\n        if( in_y < 0.0 || in_y > ").concat(f," ) {\n          setOutput(float(").concat(a,"));\n          return;\n        }\n        float in_x = ").concat(v,";\n        if( in_x < 0.0 || in_x > ").concat(h," ) {\n          setOutput(float(").concat(a,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(p," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")},Vy={kernelName:"CropAndResize",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.boxes,s=t.boxInd,i=r.cropSize,u=r.method,l=r.extrapolationValue,c=new Wy(a.shape,o.shape,i,u,l);return n.runWebGLProgram(c,[a,o,s],"float32")}},Uy=function(){function Uy(e,t,n){_classCallCheck(this,Uy),this.variableNames=["x"],this.outputShape=e;var r=e.length,a=t?"0.0":"getX(".concat(Hy(r,"coords"),")"),o=e[e.length-1],s="",i="";t?(s=n?"end != "+(o-1):"end != 0",i=n?"end + 1":"end - 1"):(s=n?"end + pow2 < ".concat(o):"end >= pow2",i=n?"end + pow2":"end - pow2"),this.userCode="\n      uniform float index;\n      void main() {\n        ".concat(Pm(r)," coords = getOutputCoords();\n        int end = ").concat(jy(r,"coords"),";\n        float val = ").concat(a,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(i,";\n          ").concat(jy(r,"coords")," = idx;\n          val += getX(").concat(Hy(r,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}return _createClass(Uy,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this68=this;return function(t,n){null==_this68.index&&(_this68.index=t.getUniformLocation(n,"index")),t.gl.uniform1f(_this68.index,e)}}}]),Uy}();function Hy(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}function jy(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}var Gy={kernelName:"Cumsum",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.exclusive,i=r.reverse,u=a.shape.length,l=Jo([o],u),c=a;null!=l&&(c=cb({inputs:{x:a},backend:n,attrs:{perm:l}}));var d=ts(1,u)[0];if(d!==u-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(a.shape.length-1," but got axis=").concat(o));for(var p=c.shape[d],f=Og({inputs:{x:c},backend:n}),_e199=0;_e199<=Math.ceil(Math.log2(p))-1;_e199++){var _t161=new Uy(c.shape,!1,i),_r172=_t161.getCustomSetupFunc(_e199),_a152=f;f=n.runWebGLProgram(_t161,[f],f.dtype,_r172),n.disposeIntermediateTensorInfo(_a152)}if(s){var _e200=new Uy(c.shape,s,i),_t162=f;f=n.runWebGLProgram(_e200,[f],f.dtype),n.disposeIntermediateTensorInfo(_t162)}if(null!=l){var _e201=cb({inputs:{x:f},backend:n,attrs:{perm:es(l)}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(c),_e201}return f}},qy={kernelName:"DenseBincount",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.weights,s=r.size,i=r.binaryOutput;if(1===a.shape.length){var _e202=n.readSync(a.dataId),_t163=n.readSync(o.dataId),_r173=Vm(_e202,_t163,o.dtype,o.shape,s);return n.makeTensorInfo([s],o.dtype,_r173)}if(2===a.shape.length){var _e203=n.bufferSync(a),_t164=n.bufferSync(o),_r174=Um(_e203,_t164,s,i);return n.makeTensorInfo(_r174.shape,o.dtype,_r174.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},Ky=function(){function Ky(e,t,n){_classCallCheck(this,Ky),this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(t,";\n      int offset_h = imod(h, ").concat(t,");\n      int in_w = w / ").concat(t,";\n      int offset_w = imod(w, ").concat(t,");\n      int offset_d = (offset_h * ").concat(t," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return _createClass(Ky,[{key:"getHeightCoordString",value:function getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),Ky}(),Xy={kernelName:"DepthToSpace",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockSize,s=r.dataFormat;pt(o>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(o)}));var i=a.shape[0],u="NHWC"===s?a.shape[1]:a.shape[2],l="NHWC"===s?a.shape[2]:a.shape[3],c="NHWC"===s?a.shape[3]:a.shape[1],d=u*o,p=l*o,f=c/(o*o),h=new Ky("NHWC"===s?[i,d,p,f]:[i,f,d,p],o,s);return n.runWebGLProgram(h,[a],a.dtype)}},Yy=function Yy(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,Yy),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,s=e.inWidth,i=e.padInfo.top,u=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,p=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,m=e.outChannels/e.inChannels,g="",b="";n&&(g=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),b="result = activation(result);");var y=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(g,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(m,";\n        int q = d2 - d1 * ").concat(m,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(f,"; wR++) {\n          int xR = xRCorner + wR * ").concat(d,";\n\n          if (xR < 0 || xR >= ").concat(o,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(h,"; wC++) {\n            int xC = xCCorner + wC * ").concat(p,";\n\n            if (xC < 0 || xC >= ").concat(s,") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(y,"\n        ").concat(b,"\n        setOutput(result);\n      }\n    ")},Qy=function Qy(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,Qy),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,s=e.inWidth,i=e.padInfo.top,u=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,p=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,m=h,g="int xR; int xC; int xCOffset;",_e204=0;_e204<f;_e204++)for(var _t165=0;_t165<h;_t165++)g+="\n          vec4 xTexelR".concat(_e204,"C").concat(2*_t165," = vec4(0.);\n          vec4 wR").concat(_e204,"C").concat(_t165," = vec4(0.);\n          vec4 xR").concat(_e204,"C").concat(_t165," = vec4(0.);");for(var _e205=0;_e205<f;_e205++)for(var _t166=0;_t166<m;_t166++){var _n91=2*_t166;if(g+="\n          xR = xRCorner + ".concat(_e205*d,";\n          xC = xCCorner + ").concat(_n91*p,";\n        "),1===c){if(_n91<h&&(g+=u%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ".concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(_e205,"C").concat(_n91," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    xTexelR").concat(_e205,"C").concat(_n91,".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR").concat(_e205,"C").concat(_n91," = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ").concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR").concat(_e205,"C").concat(_n91," = vec4(previous.zw, xTexelR").concat(_e205,"C").concat(_n91,".xy);\n                } else {\n                  xR").concat(_e205,"C").concat(_n91," = vec4(0, 0, xTexelR").concat(_e205,"C").concat(_n91,".xy);\n                }\n              "):"\n                if(xR >= 0 && xR < ".concat(o," && xC >= 0 && xC < ").concat(s,") {\n                  xTexelR").concat(_e205,"C").concat(_n91," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(_e205,"C").concat(_n91," = vec4(0.);\n                }\n\n                xR").concat(_e205,"C").concat(_n91," = xTexelR").concat(_e205,"C").concat(_n91,";\n              "),_n91+1<h)){var _t167=u%2==0?dt(p):p;p%2==0&&u%2==1||p%2!=0&&u%2!=1?(g+="\n                  xCOffset = xC + ".concat(u%2," + ").concat(_t167,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(_e205,"C").concat(_n91+2," = getX(batch, xR, xCOffset, d1);\n                  }\n                "),p>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ".concat(o," &&\n                      xCOffset >= 0 && xCOffset < ").concat(s,") {\n                      xTexelR").concat(_e205,"C").concat(_n91," = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR").concat(_e205,"C").concat(_n91," = vec4(0.);\n                    }\n                  ")),g+="\n                  xR".concat(_e205,"C").concat(_n91+1," = vec4(\n                    xTexelR").concat(_e205,"C").concat(_n91,".zw, xTexelR").concat(_e205,"C").concat(_n91+2,".xy);\n                ")):g+="\n                  xCOffset = xC + ".concat(_t167,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(_e205,"C").concat(_n91+2," = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR").concat(_e205,"C").concat(_n91+1," = xTexelR").concat(_e205,"C").concat(_n91+2,";\n                ")}}else _n91<h&&(g+="\n              if(xR >= 0 && xR < ".concat(o,") {\n            "),u%2==1?(g+="\n                xCOffset = xC + 1 - ".concat(c,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(_e205,"C").concat(_n91," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(_e205,"C").concat(_n91," = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ").concat(s,") {\n                  xTexelR").concat(_e205,"C").concat(_n91+2," = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR").concat(_e205,"C").concat(_n91+2," = vec4(0.);\n                }\n\n                xR").concat(_e205,"C").concat(_n91," = vec4(\n                  xTexelR").concat(_e205,"C").concat(_n91,".zw, xTexelR").concat(_e205,"C").concat(_n91+2,".zw);\n              "),_n91+1<h&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ".concat(c,";\n                  if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR").concat(_e205,"C").concat(_n91+1," = vec4(xTexelR").concat(_e205,"C").concat(_n91+2,".xy, final.xy);\n                "))):(g+="\n                if(xC >= 0 && xC < ".concat(s,") {\n                  xTexelR").concat(_e205,"C").concat(_n91," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(_e205,"C").concat(_n91," = vec4(0.);\n                }\n\n                xCOffset = xC + ").concat(c,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(_e205,"C").concat(_n91+2," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(_e205,"C").concat(_n91+2," = vec4(0.);\n                }\n\n                xR").concat(_e205,"C").concat(_n91," = vec4(\n                  xTexelR").concat(_e205,"C").concat(_n91,".xy, xTexelR").concat(_e205,"C").concat(_n91+2,".xy);\n              "),_n91+1<h&&(g+="\n                  xR".concat(_e205,"C").concat(_n91+1," = vec4(\n                    xTexelR").concat(_e205,"C").concat(_n91,".zw, xTexelR").concat(_e205,"C").concat(_n91+2,".zw);\n                "))),g+="}");_n91<h&&(g+="\n            vec4 wTexelR".concat(_e205,"C").concat(_n91," = getW(").concat(_e205,", ").concat(_n91,", d1, q);\n            wR").concat(_e205,"C").concat(_n91," = vec4(wTexelR").concat(_e205,"C").concat(_n91,".xz, wTexelR").concat(_e205,"C").concat(_n91,".xz);\n          "),_n91+1<h&&(g+="\n              vec4 wTexelR".concat(_e205,"C").concat(_n91+1," = getW(").concat(_e205,", ").concat(_n91+1,", d1, q);\n              wR").concat(_e205,"C").concat(_n91+1," =\n                vec4(wTexelR").concat(_e205,"C").concat(_n91+1,".xz, wTexelR").concat(_e205,"C").concat(_n91+1,".xz);")))}for(var _e206=0;_e206<f;_e206++)for(var _t168=0;_t168<h;_t168++)g+="dotProd += xR".concat(_e206,"C").concat(_t168," * wR").concat(_e206,"C").concat(_t168,";");var b="",y="";n&&(b=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(n,"\n        }"),y="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(b,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(u,");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ").concat(g,"\n\n        vec4 result = dotProd;\n        ").concat(x,"\n        ").concat(y,"\n        setOutput(result);\n      }\n    ")},Zy={kernelName:"DepthwiseConv2dNative",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dilations,l=r.dimRoundingMode,c=u;null==c&&(c=[1,1]),pt(za(s,c),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(c,"'")}));var p,d=Aa(a.shape,o.shape,s,c,i,l,!0);return p=jt().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels==1?new Qy(d):new Yy(d),n.runWebGLProgram(p,[a,o],"float32")}},Jy=function Jy(e){_classCallCheck(this,Jy),this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(a,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},ex=function ex(e){_classCallCheck(this,ex),this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(i,"; dm++) {\n              int d2 = d1 * ").concat(i," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},tx={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.dilations,u=r.pad,l=r.dimRoundingMode,c=r.filterShape,d=Aa(a.shape,c,s,i,u,l,!0),p=new Jy(d);return n.runWebGLProgram(p,[a,o],"float32")}},nx={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.strides,i=r.dilations,u=r.pad,l=r.dimRoundingMode,d=Aa(r.inputShape,o.shape,s,i,u,l,!0),p=new ex(d);return n.runWebGLProgram(p,[a,o],"float32")}},rx=function rx(e){_classCallCheck(this,rx),this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},ax={kernelName:"Diag",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(_toConsumableArray(r.shape),_toConsumableArray(r.shape)),o=gt(r.shape),s=eb({inputs:{x:r},backend:n,attrs:{shape:[o]}}),i=new rx(o),u=n.runWebGLProgram(i,[s],s.dtype),l=eb({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),l}},ox=function ox(e){_classCallCheck(this,ox),this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,r=e.padInfo,a=e.strideHeight,o=e.strideWidth,s=e.filterHeight,i=e.filterWidth,u=e.dilationHeight,l=e.dilationWidth,c=r.top,d=r.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(a,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(c,", ").concat(d,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(u,";\n\n          if (hIn >= 0 && hIn < ").concat(t,") {\n            for (int w = 0; w < ").concat(i,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(n,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")},sx={kernelName:"Dilation2D",backendName:"webgl",kernelFunc:function kernelFunc(e){var c,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dilations,l=_a(a.shape,o.shape,s,i,"NHWC",u),d=new ox(l),p=eb({inputs:{x:c=n.runWebGLProgram(d,[a,o],"float32")},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(c),p}},ix={kernelName:"Elu",backendName:"webgl",kernelFunc:Hg({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"})},ux={kernelName:"EluGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,o=jt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fg("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new Ag("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(o,[r,a],r.dtype)}},lx={kernelName:"Equal",backendName:"webgl",kernelFunc:jg({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool"})},cx={kernelName:"Erf",backendName:"webgl",kernelFunc:Hg({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n'})},dx="return exp(x);",px=Hg({opSnippet:dx,packedOpSnippet:dx,cpuKernelImpl:Gm}),fx={kernelName:"Exp",backendName:"webgl",kernelFunc:px};function hx(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,o=t.input,s=o.shape.length,i=o.shape.slice(),u=a;return a<0&&(pt(-(s+1)<=a,(function(){return"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")})),u=s+a+1),i.splice(u,0,1),eb({inputs:{x:o},backend:r,attrs:{shape:i}})}var mx={kernelName:"ExpandDims",backendName:"webgl",kernelFunc:hx},gx="return exp(x) - 1.0;",bx={kernelName:"Expm1",backendName:"webgl",kernelFunc:Hg({opSnippet:gx,packedOpSnippet:gx,cpuKernelImpl:qm})},yx=function yx(e,t,n){_classCallCheck(this,yx),this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var s,a=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),o=n?"".concat(r,".0"):"1.0";if("real"===e)s="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));s="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(a,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(s,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(r,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(o,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")};function xx(e,t,n){var r=n.texData.get(e.dataId),a=gt(e.shape),o=e.shape[e.shape.length-1],s=eb({inputs:{x:e},backend:n,attrs:{shape:[a/o,o]}}),i=s.shape,u=new yx("real",i,t),l=new yx("imag",i,t),c=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:i},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:i}],d=n.runWebGLProgram(u,c,"float32"),p=n.runWebGLProgram(l,c,"float32"),f=Dg({inputs:{real:d,imag:p},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p);var h=eb({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(f),h}var vx={kernelName:"FFT",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend;return xx(t.input,!1,n)}},kx=function(){function kx(e,t){_classCallCheck(this,kx),this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return _createClass(kx,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this69=this;return function(t,n){null==_this69.valueLoc&&(_this69.valueLoc=t.getUniformLocationNoThrow(n,"value")),t.gl.uniform1f(_this69.valueLoc,e)}}}]),kx}();function wx(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,o=n.dtype;if("string"===(o=o||Rt(a))){var _e207=Ct(o,gt(r));return _e207.fill(a),t.makeTensorInfo(r,o,_e207)}var _e208=new kx(r,a),_n92=_e208.getCustomSetupFunc(a);return t.runWebGLProgram(_e208,[],o,_n92)}var Ax,Ix={kernelName:"Fill",backendName:"webgl",kernelFunc:wx},Nx=function Nx(e){_classCallCheck(this,Nx),this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(t," - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(t,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},Tx={kernelName:"FlipLeftRight",backendName:"webgl",kernelFunc:function kernelFunc(_ref46){var e=_ref46.inputs,t=_ref46.backend,n=e.image,r=t,a=new Nx(n.shape);return r.runWebGLProgram(a,[n],n.dtype)}},Cx="return floor(x);",Ex={kernelName:"Floor",backendName:"webgl",kernelFunc:Hg({opSnippet:Cx,packedOpSnippet:Cx,cpuKernelImpl:Km})},Sx={kernelName:"FloorDiv",backendName:"webgl",kernelFunc:jg({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"})},_x=function _x(e){_classCallCheck(this,_x),this.variableNames=["A"];var t=om(),_e209=_slicedToArray(e,2),n=_e209[0],r=_e209[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(r,".0, ").concat(n,".0);\n\n        vec4 values = ").concat(t.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")},$x=function $x(e){_classCallCheck(this,$x),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=om(),_e210=_slicedToArray(e,2),n=_e210[0],r=_e210[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(r,".0, ").concat(n,".0);\n            vec4 values = ").concat(t.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")},Rx={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,o=r.numChannels,s="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,i="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,_ref48=_slicedToArray(s?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),u=_ref48[0],l=_ref48[1],c=[l,u],d=[l,u,o];(i||s)&&(null==Ax&&(Ax=document.createElement("canvas").getContext("2d")),Ax.canvas.width=u,Ax.canvas.height=l,Ax.drawImage(a,0,0,u,l),a=Ax.canvas);var p=n.makeTensorInfo(c,"int32");n.texData.get(p.dataId).usage=Sh.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),a);var f=jt().getBool("WEBGL_PACK")?new $x(d):new _x(d),h=n.runWebGLProgram(f,[p],"int32");return n.disposeData(p.dataId),h}},Fx={kernelName:"FusedConv2D",backendName:"webgl",kernelFunc:function kernelFunc(e){var b,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dataFormat,d=r.dilations,p=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=Wa(c),g=Aa(a.shape,o.shape,u,d,l,p,!1,m),y=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(jt().getBool("WEBGL_CONV_IM2COL")&&1===a.shape[0])b=Sy({x:a,filter:o,convInfo:g,backend:n,bias:s,activation:f,preluActivationWeights:i,leakyreluAlpha:h});else{var _e211=null!=s,_t169=null!=i,_r175="leakyrelu"===f,_u35=f?Gg(f,!1):null,_l14=new Ny(g,_e211,_u35,_t169,_r175),_c11=[a,o];if(s&&_c11.push(s),i&&_c11.push(i),_r175){var _e212=n.makeTensorInfo([],"float32",an(h,"float32"));_c11.push(_e212),y.push(_e212)}b=n.runWebGLProgram(_l14,_c11,"float32")}else b=Ey({x:a,filter:o,convInfo:g,backend:n,bias:s,activation:f,preluActivationWeights:i,leakyreluAlpha:h});var x=eb({inputs:{x:b},backend:n,attrs:{shape:g.outShape}});return y.push(b),y.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},Ox={kernelName:"FusedDepthwiseConv2D",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dilations,d=r.dimRoundingMode,p=r.activation,f=r.leakyreluAlpha,h=[],m=c;null==m&&(m=[1,1]),pt(za(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var I,g=Aa(a.shape,o.shape,u,m,l,d,!0),b=jt().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1,y=p?Gg(p,b):null,x=[a,o],v=null!=s,k=null!=i,w="leakyrelu"===p;if(v&&x.push(s),k&&x.push(i),w){var _e213=n.makeTensorInfo([],"float32",an(f,"float32"));x.push(_e213),h.push(_e213)}I=b?new Qy(g,v,y,k,w):new Yy(g,v,y,k,w);var N=n.runWebGLProgram(I,x,"float32");return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),N}},Mx=function Mx(e,t,n){_classCallCheck(this,Mx),this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Pm(t.length),a=Pm(n.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        ".concat(r," strides = ").concat(r,"(").concat(this.strides,");\n         void main() {\n          ").concat(a," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(o,";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")},Dx={kernelName:"GatherNd",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,o=a.shape,s=o[o.length-1],_zr4=_slicedToArray(zr(r,a),4),i=_zr4[0],u=_zr4[1],l=_zr4[2],c=_zr4[3],d=eb({inputs:{x:a},backend:n,attrs:{shape:[u,s]}}),p=eb({inputs:{x:r},backend:n,attrs:{shape:[gt(r.shape)/l,l]}}),f=new Mx(s,c,[u,l]),h=n.runWebGLProgram(f,[p,d],p.dtype),m=eb({inputs:{x:h},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),m}},Px=function Px(e,t){_classCallCheck(this,Px),this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var n=Pm(this.rank),r=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],_t170=0;_t170<e.length;_t170++)2===_t170?r.push("int(getIndices(resRC.x, resRC.z))"):r.push("".concat(n[_t170]));return r.join()}(e);this.userCode="\n      void main() {\n        ".concat(n," resRC = getOutputCoords();\n        setOutput(getA(").concat(r,"));\n      }\n    ")},Lx={kernelName:"GatherV2",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.indices,s=r.axis,i=r.batchDims,u=xu(a,o,It(s,a.shape)[0],i),l=gt(o.shape),c=[],d=eb({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=eb({inputs:{x:o},backend:n,attrs:{shape:[u.batchSize,l/u.batchSize]}});c.push(d),c.push(p);var f=[u.batchSize,u.outerSize,l/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([a,o])||"string"===a.dtype){var _e214=n.bufferSync(p),_t171=n.bufferSync(d),_r176=Xm(_t171,_e214,f);return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(u.outputShape,_r176.dtype,_r176.values)}var h=new Px(d.shape,f),m=n.runWebGLProgram(h,[d,p],d.dtype);c.push(m);var g=eb({inputs:{x:m},backend:n,attrs:{shape:u.outputShape}});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},Bx={kernelName:"Greater",backendName:"webgl",kernelFunc:jg({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:Ym,dtype:"bool"})},zx={kernelName:"GreaterEqual",backendName:"webgl",kernelFunc:jg({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool"})},Wx={kernelName:"IFFT",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend;return xx(t.input,!0,n)}},Vx={kernelName:"IsFinite",backendName:"webgl",kernelFunc:Hg({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"})},Ux={kernelName:"IsInf",backendName:"webgl",kernelFunc:Hg({opSnippet:"return float(isinf(x));",dtype:"bool"})},Hx={kernelName:"IsNan",backendName:"webgl",kernelFunc:Hg({opSnippet:"return float(isnan(x));",dtype:"bool"})},jx={kernelName:"Less",backendName:"webgl",kernelFunc:jg({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:Qm,dtype:"bool"})},Gx={kernelName:"LessEqual",backendName:"webgl",kernelFunc:jg({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",dtype:"bool"})},qx={kernelName:"LinSpace",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.num,s=Zm(r,a,o);return t.makeTensorInfo([s.length],"float32",s)}},Kx={kernelName:"Log",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (x < 0.0) return NAN;\n  return log(x);",packedOpSnippet:"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Jm})},Xx={kernelName:"Log1p",backendName:"webgl",kernelFunc:Hg({opSnippet:"return log(1.0 + x);"})},Yx={kernelName:"LogicalAnd",backendName:"webgl",kernelFunc:jg({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"})},Qx={kernelName:"LogicalNot",backendName:"webgl",kernelFunc:Hg({opSnippet:"return float(!(x >= 1.0));"})},Zx={kernelName:"LogicalOr",backendName:"webgl",kernelFunc:jg({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"})},Jx=function Jx(e,t,n,r,a){_classCallCheck(this,Jx),this.variableNames=["x"],this.outputShape=[];var i,o=t,s=e[3]-1;this.outputShape=e;var u="float(".concat(n,") + float(").concat(r,") * sum");i=.5===a?"inversesqrt(".concat(u,")"):1===a?"1.0/(".concat(u,")"):"exp(log(".concat(u,") * float(-").concat(a,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(o,"; j <= ").concat(o,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(s,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(i,";\n        setOutput(val);\n      }\n    ")},ev=function ev(e,t,n,r,a){_classCallCheck(this,ev),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,o=t,s=e[3]-1;this.outputShape=e;var u="float(".concat(n,") + float(").concat(r,") * sum");i=.5===a?"inversesqrt(".concat(u,")"):1===a?"1.0/(".concat(u,")"):"exp(log(".concat(u,") * float(-").concat(a,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(o,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(o,"; j <= ").concat(o,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(s,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(i,";\n        setOutput(result);\n      }\n    ")},tv={kernelName:"LRN",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.depthRadius,s=r.bias,i=r.alpha,u=r.beta,l=jt().getBool("WEBGL_PACK_NORMALIZATION")?new ev(a.shape,o,s,i,u):new Jx(a.shape,o,s,i,u);return n.runWebGLProgram(l,[a],a.dtype)}},nv=function nv(e,t,n,r,a){_classCallCheck(this,nv),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(t,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(t," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(r,") * norm + float(").concat(n,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(r,")\n                * float(").concat(a,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(a,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")},rv={kernelName:"LRNGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.y,s=t.dy,i=r.depthRadius,u=r.bias,l=r.alpha,c=r.beta,d=new nv(a.shape,i,u,l,c);return n.runWebGLProgram(d,[a,o,s],a.dtype)}};function av(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reductionIndices,s=r.keepDims,i=a.shape.length,u=It(o,a.shape),l=u,c=Jo(l,i),d=null!=c,p=n.shouldExecuteOnCPU([a]),f=a;if(d){if(p){for(var _e215=n.texData.get(f.dataId).values,_t172=new Array(i),_e216=0;_e216<_t172.length;_e216++)_t172[_e216]=a.shape[c[_e216]];var _r177=hg(_e215,a.shape,a.dtype,c,_t172);f=n.makeTensorInfo(_t172,a.dtype),n.texData.get(f.dataId).values=_r177}else f=ib(a,c,n);l=ts(l.length,i)}Zo("max",l,i);var g,_Yo22=_slicedToArray(Yo(f.shape,l),2),h=_Yo22[0],m=_Yo22[1],b=h;if(s&&(b=Qo(h,u)),p){var _e217=n.texData.get(f.dataId).values,_t173=eg(_e217,gt(m),b,a.dtype);g=n.makeTensorInfo(b,a.dtype),n.texData.get(g.dataId).values=_t173}else g=function(e,t,n,r){var a=gt(t),o=eb({inputs:{x:e},attrs:{shape:[gt(e.shape)/a,a]},backend:r}),s=ab(o,e.dtype,"max",r),i=eb({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),i}(f,m,b,n);return d&&n.disposeIntermediateTensorInfo(f),g}var ov={kernelName:"Max",backendName:"webgl",kernelFunc:av},sv={kernelName:"Maximum",backendName:"webgl",kernelFunc:jg({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:tg})},iv={kernelName:"MaxPool",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;rm(a,"maxPool");var o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode;pt(za(s,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l=$a(a.shape,o,s,1,i,u);if(1===l.filterWidth&&1===l.filterHeight&&bt(l.inShape,l.outShape))return Og({inputs:{x:a},backend:n});var c=new Pb(l,"max",!1);return n.runWebGLProgram(c,[a],a.dtype)}},uv={kernelName:"MaxPool3D",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.filterSize,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=Ra(a.shape,o,s,[1,1,1],i,l,u),d=new Lb(c,"max",!1);return n.runWebGLProgram(d,[a],a.dtype)}},lv=function lv(e){_classCallCheck(this,lv),this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=a-1-e.padInfo.top,i=o-1-e.padInfo.left,u=a*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(a,";\n          wR += ").concat(r,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(n,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(u," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},cv=function cv(e){_classCallCheck(this,cv),this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,i=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=i-1-e.padInfo.front,d=u-1-e.padInfo.top,p=l-1-e.padInfo.left,f=i*u*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(c,", ").concat(d,", ").concat(p,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(i,";\n           wD += ").concat(a,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(u,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(f," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(u," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},dv={kernelName:"MaxPool3DGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,s=t.input,i=r.filterSize,u=r.strides,l=r.pad,c=r.dimRoundingMode,d=Ra(s.shape,i,u,[1,1,1],l,c),p=new Lb(d,"max",!0),f=n.runWebGLProgram(p,[s],s.dtype),h=new cv(d),m=n.runWebGLProgram(h,[a,f],s.dtype);return n.disposeIntermediateTensorInfo(f),m}},pv={kernelName:"MaxPoolGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,i=o;rm([o,t.output],"maxPoolGrad");var u=r.filterSize,l=r.strides,c=r.pad,d=r.dimRoundingMode,p=$a(i.shape,u,l,1,c,d),f=new Pb(p,"max",!0),h=n.runWebGLProgram(f,[i],i.dtype),m=new lv(p),g=n.runWebGLProgram(m,[a,h],i.dtype);return n.disposeIntermediateTensorInfo(h),g}},fv={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function kernelFunc(_ref49){var e=_ref49.inputs,t=_ref49.attrs,n=_ref49.backend,r=e.x,a=t.filterSize,o=t.strides,s=t.pad,i=t.includeBatchInIndex,u=n;pt(4===r.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(r.shape.length,".")}));var l=[1,1];pt(za(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var c=$a(r.shape,a,o,l,s),_ref51=_slicedToArray(function(e,t,n,r){var a=new Pb(n,"max",!1),o=r.runWebGLProgram(a,[e],"float32");return a=new Pb(n,"max",!0,!0,t),[o,r.runWebGLProgram(a,[e],"float32")]}(r,i,c,u),2);return[_ref51[0],_ref51[1]]}},hv={kernelName:"Mean",backendName:"webgl",kernelFunc:function kernelFunc(_ref52){var e=_ref52.inputs,t=_ref52.attrs,n=_ref52.backend,r=e.x,a=t.keepDims,o=t.axis,s=n,i=r.shape.length,u=It(o,r.shape),l=u,c=Jo(l,i),d=null!=c,p=s.shouldExecuteOnCPU([r]),f=[],h=r;if(d){if(p){for(var _e218=s.texData.get(h.dataId).values,_t174=new Array(i),_e219=0;_e219<_t174.length;_e219++)_t174[_e219]=r.shape[c[_e219]];var _n93=hg(_e218,r.shape,r.dtype,c,_t174);h=s.makeTensorInfo(_t174,r.dtype),s.texData.get(h.dataId).values=_n93}else h=ib(r,c,s);f.push(h),l=ts(l.length,i)}Zo("sum",l,i);var _Yo24=_slicedToArray(Yo(h.shape,l),2),m=_Yo24[0],g=_Yo24[1],b=m;a&&(b=Qo(m,u));for(var y=function(e,t,n,r){var a=gt(t),o=eb({inputs:{x:e},attrs:{shape:[gt(e.shape)/a,a]},backend:r}),s=ab(o,"float32","mean",r),i=eb({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),i}(h,g,b,s),_i51=0,_f6=f;_i51<_f6.length;_i51++){var _e220=_f6[_i51];s.disposeIntermediateTensorInfo(_e220)}return y}},mv={kernelName:"Min",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,i=a.shape.length,u=It(o,a.shape),l=u,c=Jo(l,i),d=a;null!=c&&(d=cb({inputs:{x:a},backend:n,attrs:{perm:c}}),l=ts(l.length,a.shape.length)),Zo("min",l,i);var g,_Yo26=_slicedToArray(Yo(d.shape,l),2),p=_Yo26[0],h=eb({inputs:{x:d},backend:n,attrs:{shape:[-1,gt(_Yo26[1])]}}),m=ab(h,h.dtype,"min",n);return g=eb(s?{inputs:{x:m},backend:n,attrs:{shape:Qo(p,u)}}:{inputs:{x:m},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),g}},gv={kernelName:"Minimum",backendName:"webgl",kernelFunc:jg({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:ng})},bv=function bv(e,t,n){_classCallCheck(this,bv),this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,a=Pm(r),o=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u="reflect"===n?0:1;this.userCode=1!==r?"\n      ".concat(a," start = ").concat(a,"(").concat(o,");\n      ").concat(a," end = ").concat(a,"(").concat(s,");\n\n      void main() {\n        ").concat(a," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(r,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(u,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(u,";\n          }\n        }\n        ").concat(a," coords = outC - start;\n        setOutput(getX(").concat(i,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(u,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(u,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")},yv=function yv(e,t,n){_classCallCheck(this,yv),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,a=Pm(r),o=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),i=bg("rc",r),u=bg("source",r),l="".concat(i[r-1]," < ").concat(this.outputShape[r-1]),c=1===r?"source":"vec2(".concat(u.slice(-2).join(),")"),d="reflect"===n?0:1,p="";if(1===r){var _e221="\n        ".concat(a," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(d,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(d,";\n        }\n        source -= start;\n      ");p="\n        ".concat(a," rc = outputLoc;\n        ").concat(_e221,"\n        result[0] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n        ").concat(i[r-1]," += 1;\n        if(").concat(l,") {\n          ").concat(_e221,"\n          result[1] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n        }\n      ")}else{var _e222="\n        ".concat(a," source = rc;\n        ").concat(a," lt = ").concat(a,"(lessThan(source, start));\n        ").concat(a," gte = ").concat(a,"(greaterThanEqual(source, end));\n        ").concat(a," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(d,") +\n                gte * ((end - 1) * 2 - source + ").concat(d,");\n        source -= start;\n      ");p="\n        ".concat(a," rc = outputLoc;\n        ").concat(_e222,"\n        result[0] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n        ").concat(i[r-1]," += 1;\n        if(").concat(l,") {\n          ").concat(_e222,"\n          result[1] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n        }\n        rc = outputLoc;\n        ").concat(i[r-2]," += 1;\n        if(").concat(i[r-2]," < ").concat(this.outputShape[r-2],") {\n          ").concat(_e222,"\n          result[2] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n          ").concat(i[r-1]," += 1;\n          if(").concat(l,") {\n            ").concat(_e222,"\n            result[3] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(a," start = ").concat(a,"(").concat(o,");\n      const ").concat(a," end = ").concat(a,"(").concat(s,");\n\n      void main() {\n        ").concat(a," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")},xv={kernelName:"MirrorPad",backendName:"webgl",kernelFunc:function kernelFunc(_ref53){var e=_ref53.inputs,t=_ref53.backend,n=_ref53.attrs,r=e.x,a=n.paddings,o=n.mode,s=jt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yv(r.shape,a,o):new bv(r.shape,a,o);return t.runWebGLProgram(s,[r],r.dtype)}},vv={kernelName:"Mod",backendName:"webgl",kernelFunc:jg({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},kv=function(){function kv(e,t,n){_classCallCheck(this,kv),this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(t-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(t-1,"));\n      }\n    ")}return _createClass(kv,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this70=this;return function(t,n){null==_this70.seedLoc&&(_this70.seedLoc=t.getUniformLocation(n,"seed")),t.gl.uniform1f(_this70.seedLoc,e)}}}]),kv}(),wv=jg({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),Iv={kernelName:"RealDiv",backendName:"webgl",kernelFunc:wv},Nv="return a - b;",Tv=jg({opSnippet:Nv,packedOpSnippet:Nv,supportsComplex:!0,cpuKernelImpl:dg}),Cv={kernelName:"Sub",backendName:"webgl",kernelFunc:Tv};function Ev(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,s=It([r.dim],a.shape),i=av({inputs:{x:a},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),u=Qo(i.shape,s),l=eb({inputs:{x:i},backend:n,attrs:{shape:u}}),c=Tv({inputs:{a:a,b:l},backend:n}),d=px({inputs:{x:c},backend:n}),p=ub({inputs:{x:d},backend:n,attrs:{axis:s,keepDims:!1}}),f=eb({inputs:{x:p},backend:n,attrs:{shape:u}}),h=wv({inputs:{a:d,b:f},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),h}var Sv={kernelName:"Softmax",backendName:"webgl",kernelFunc:Ev},_v={kernelName:"Multinomial",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,o=r.numSamples,s=r.seed,i=r.normalized,u=i?a:Ev({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),l=u.shape[0],c=u.shape[1],d=new kv(l,c,o),p=d.getCustomSetupFunc(s),f=n.runWebGLProgram(d,[u],"int32",p);return i||n.disposeIntermediateTensorInfo(u),f}},$v="return -x;",Rv={kernelName:"Neg",backendName:"webgl",kernelFunc:function kernelFunc(e){var a,t=e.inputs,n=e.backend,r=t.x;if(n.shouldExecuteOnCPU([r])){var _e223=n.texData.get(r.dataId),_ag2=_slicedToArray(ag(_e223.values,r.shape,r.dtype),2),_t175=_ag2[0],_a153=_ag2[1];return n.makeTensorInfo(_a153,r.dtype,_t175)}return a=jt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Eg(r.shape,$v):new Ng(r.shape,$v),n.runWebGLProgram(a,[r],r.dtype)}},Av=Li,Fv={kernelName:"NonMaxSuppressionV3",backendName:"webgl",kernelFunc:function kernelFunc(e){iu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold,l=n.readSync(a.dataId),c=n.readSync(o.dataId),d=Av(l,c,s,i,u).selectedIndices;return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},Ov=Bi,Mv={kernelName:"NonMaxSuppressionV4",backendName:"webgl",kernelFunc:function kernelFunc(e){iu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold,l=r.padToMaxOutputSize,c=n.readSync(a.dataId),d=n.readSync(o.dataId),_Ov=Ov(c,d,s,i,u,l),p=_Ov.selectedIndices,f=_Ov.validOutputs;return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},Dv=zi,Pv={kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function kernelFunc(e){iu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold,l=r.softNmsSigma,c=n.readSync(a.dataId),d=n.readSync(o.dataId),_Dv=Dv(c,d,s,i,u,l),g=_Dv.selectedIndices,b=_Dv.selectedScores;return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([b.length],"float32",new Float32Array(b))]}},Lv=function Lv(e,t,n,r){_classCallCheck(this,Lv),this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(r,"), float(").concat(n,"),\n                      float(index == coords.y)));\n      }\n    ")},Bv={kernelName:"OneHot",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=r.depth,s=r.onValue,i=r.offValue,u=gt(a.shape),l=new Lv(u,o,s,i),c=eb({inputs:{x:a},backend:n,attrs:{shape:[u]}}),d=n.runWebGLProgram(l,[c],a.dtype);n.disposeIntermediateTensorInfo(c);var p=eb({inputs:{x:d},backend:n,attrs:{shape:[].concat(_toConsumableArray(a.shape),[o])}});return n.disposeIntermediateTensorInfo(d),p}};function zv(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var _e224=ay({inputs:{input:r},backend:n}),_t176=zv({inputs:{x:_e224},backend:n}),_a154=yy({inputs:{input:r},backend:n}),_o109=zv({inputs:{x:_a154},backend:n}),_s74=Dg({inputs:{real:_t176,imag:_o109},backend:n});return n.disposeIntermediateTensorInfo(_e224),n.disposeIntermediateTensorInfo(_t176),n.disposeIntermediateTensorInfo(_a154),n.disposeIntermediateTensorInfo(_o109),_s74}return wx({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var Wv={kernelName:"ZerosLike",backendName:"webgl",kernelFunc:zv},Vv={kernelName:"OnesLike",backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var _t177=ay({inputs:{input:a},backend:r}),_n94=e({inputs:{x:_t177},backend:r}),_o110=yy({inputs:{input:a},backend:r}),_s75=zv({inputs:{x:_o110},backend:r}),_i52=Dg({inputs:{real:_n94,imag:_s75},backend:r});return r.disposeIntermediateTensorInfo(_t177),r.disposeIntermediateTensorInfo(_n94),r.disposeIntermediateTensorInfo(_o110),r.disposeIntermediateTensorInfo(_s75),_i52}return wx({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}},Uv={kernelName:"Pack",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,a=e.attrs.axis;if(1===t.length)return hx({inputs:{input:t[0]},backend:n,attrs:{dim:a}});var o=t[0].shape,s=t[0].dtype;t.forEach((function(e){ft(o,e.shape,"All tensors passed to stack must have matching shapes"),pt(s===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=[],u=wy({inputs:t.map((function(e){var t=hx({inputs:{input:e},backend:n,attrs:{dim:a}});return i.push(t),t})),backend:n,attrs:{axis:a}});return i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}},Hv=function(){function Hv(e,t,n){_classCallCheck(this,Hv),this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,a=Pm(r),o=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      ".concat(a," start = ").concat(a,"(").concat(o,");\n      ").concat(a," end = ").concat(a,"(").concat(s,");\n      uniform float value;\n\n      void main() {\n        ").concat(a," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(a," coords = outC - start;\n          setOutput(getX(").concat(i,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n        uniform float value;\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")}return _createClass(Hv,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this71=this;return function(t,n){null==_this71.valueLoc&&(_this71.valueLoc=t.getUniformLocationNoThrow(n,"value")),t.gl.uniform1f(_this71.valueLoc,e)}}}]),Hv}(),jv=function(){function jv(e,t,n){_classCallCheck(this,jv),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,a=Pm(r),o=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),i=bg("rc",r),u=bg("source",r),l="".concat(i[r-1]," < ").concat(this.outputShape[r-1]),c=1===r?"source":"vec2(".concat(u.slice(-2).join(),")"),d=["".concat(a," rc = outputLoc;"),"".concat(i[r-1]," += 1;\n       if(").concat(l,") {\n      "),1===r?"":"}\n       rc = outputLoc;\n       ".concat(i[r-2]," += 1;\n       if(").concat(i[r-2]," < ").concat(this.outputShape[r-2],") {"),1===r?"":"  ".concat(i[r-1]," += 1;\n         if(").concat(l,") {")],p=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",_e225=0,_t178=1===r?2:4;_e225<_t178;_e225++)f+="\n        ".concat(d[_e225],"\n        if (").concat(p,") {\n          result[").concat(_e225,"] = float(value);\n        } else {\n          ").concat(a," source = rc - start;\n          result[").concat(_e225,"] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n        }\n      ");f+=1===r?"} ":"}}",this.userCode="\n      const ".concat(a," start = ").concat(a,"(").concat(o,");\n      const ").concat(a," end = ").concat(a,"(").concat(s,");\n      uniform float value;\n\n      void main() {\n        ").concat(a," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")}return _createClass(jv,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this72=this;return function(t,n){null==_this72.valueLoc&&(_this72.valueLoc=t.getUniformLocationNoThrow(n,"value")),t.gl.uniform1f(_this72.valueLoc,e)}}}]),jv}(),Gv=function Gv(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.paddings,s=r.constantValue,i=jt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jv(a.shape,o,s):new Hv(a.shape,o,s),u=i.getCustomSetupFunc(s);return n.runWebGLProgram(i,[a],a.dtype,u)},qv={kernelName:"PadV2",backendName:"webgl",kernelFunc:Gv},Kv={kernelName:"Pow",backendName:"webgl",kernelFunc:jg({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},Xv={kernelName:"Prod",backendName:"webgl",kernelFunc:function kernelFunc(e){var p,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,i=a.shape.length,u=[],l=It(o,a.shape),c=l,d=Jo(c,i),f=a;if(null!=d&&(f=cb({inputs:{x:a},backend:n,attrs:{perm:d}}),c=ts(c.length,i),u.push(f)),Zo("prod",c,i),n.shouldExecuteOnCPU([f])){var _e226=n.texData.get(f.dataId).values,_og=og(f.shape,f.dtype,_e226,c),_t179=_og.outVals,_r178=_og.outShape,_a155=_og.outDtype;p=n.makeTensorInfo(_r178,_a155,_t179)}else{var _Yo28=_slicedToArray(Yo(f.shape,c),2),_e227=_Yo28[0],_r179=gt(_Yo28[1]),_o111=eb({inputs:{x:f},backend:n,attrs:{shape:[-1,_r179]}}),_s76=ab(_o111,$n(a.dtype),"prod",n);p=eb({inputs:{x:_s76},backend:n,attrs:{shape:_e227}}),u.push(_o111),u.push(_s76)}if(s){u.push(p);var _e228=Qo(p.shape,l);p=eb({inputs:{x:p},backend:n,attrs:{shape:_e228}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),p}},Yv=function Yv(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.step,s=n.dtype,i=sg(r,a,o,s);return t.makeTensorInfo([i.length],s,i)},Qv={kernelName:"Range",backendName:"webgl",kernelFunc:Yv},Zv={kernelName:"Reciprocal",backendName:"webgl",kernelFunc:Hg({opSnippet:"return 1.0 / x;"})},Jv={kernelName:"Relu",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},ek={kernelName:"Relu6",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},tk=function tk(e,t,n,r,a){_classCallCheck(this,tk),this.variableNames=["A"],this.outputShape=[];var _e229=_slicedToArray(e,4),o=_e229[0],s=_e229[1],i=_e229[2],u=_e229[3];this.outputShape=[o,t,n,u];var d,l=[r&&t>1?s-1:s,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];d=a?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/c[0],",\n          ").concat(l[1]/c[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(i,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")},nk=function nk(e,t,n,r,a){_classCallCheck(this,nk),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var _e230=_slicedToArray(e,4),o=_e230[0],s=_e230[1],i=_e230[2],u=_e230[3];this.outputShape=[o,t,n,u];var d,l=[r&&t>1?s-1:s,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];d=a?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(l[0]/c[0],",\n          ").concat(l[1]/c[1],",\n          ").concat(l[1]/c[1],");\n      const vec3 inputShapeRC = vec3(").concat(s,".0, ").concat(i,".0,\n                                     ").concat(i,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(u-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")},rk={kernelName:"ResizeBilinear",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,_i53=_slicedToArray(r.size,2),u=_i53[0],l=_i53[1],c=jt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new nk(a.shape,u,l,o,s):new tk(a.shape,u,l,o,s);return n.runWebGLProgram(c,[a],"float32")}},ak=function ak(e,t,n){_classCallCheck(this,ak),this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var _t181=_slicedToArray(t,3),r=_t181[1],a=_t181[2],_e231=_slicedToArray(e,3),o=_e231[1],s=_e231[2],i=[n&&o>1?r-1:r,n&&s>1?a-1:a],u=[n&&o>1?o-1:o,n&&s>1?s-1:s],l=i[0]/u[0],c=i[1]/u[1],d=1/l,p=1/c,f=2*Math.ceil(d)+2,h=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(l,");\n        const float widthScale = float(").concat(c,");\n\n        const float invHeightScale = float(").concat(d,");\n        const float invWidthScale = float(").concat(p,");\n\n        const int winHeight = int(").concat(f,");\n        const int winWidth = int(").concat(h,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(o,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(s,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(r-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(a-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},ok={kernelName:"ResizeBilinearGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,s=r.alignCorners,i=new ak(o.shape,a.shape,s);return n.runWebGLProgram(i,[o],o.dtype)}},sk=function sk(e,t,n,r,a){_classCallCheck(this,sk),this.variableNames=["A"],this.outputShape=[];var _e232=_slicedToArray(e,4),o=_e232[0],s=_e232[1],i=_e232[2],u=_e232[3];this.outputShape=[o,t,n,u];var p,l=[r&&t>1?s-1:s,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=r?"0.5":"0.0";p=a?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/c[0],",\n          ").concat(l[1]/c[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(i,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(d,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")},ik={kernelName:"ResizeNearestNeighbor",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,_i54=_slicedToArray(r.size,2),u=_i54[0],l=_i54[1],c=new sk(a.shape,u,l,o,s);return n.runWebGLProgram(c,[a],a.dtype)}},uk=function uk(e,t,n){_classCallCheck(this,uk),this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var _t182=_slicedToArray(t,3),r=_t182[1],a=_t182[2],_e233=_slicedToArray(e,3),o=_e233[1],s=_e233[2],i=[n&&o>1?r-1:r,n&&s>1?a-1:a],u=[n&&o>1?o-1:o,n&&s>1?s-1:s],l=i[0]/u[0],c=i[1]/u[1],d=1/l,p=1/c,f=2*Math.ceil(d)+2,h=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(l,");\n        const float widthScale = float(").concat(c,");\n\n        const float invHeightScale = float(").concat(d,");\n        const float invWidthScale = float(").concat(p,");\n\n        const int winHeight = int(").concat(f,");\n        const int winWidth = int(").concat(h,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(o,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(s,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(i[0],") *\n                (float(dyR) / float(").concat(u[0],"));\n\n            float sourceFracCol =\n                float(").concat(i[1],") *\n                  (float(dyC) / float(").concat(u[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(r,") - 1),\n                ").concat(n," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(a,") - 1),\n                ").concat(n," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},lk={kernelName:"ResizeNearestNeighborGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,s=r.alignCorners,i=new uk(o.shape,a.shape,s);return n.runWebGLProgram(i,[o],o.dtype)}},ck=function ck(e,t){_classCallCheck(this,ck),this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - coords[").concat(n,"] - 1"):"coords[".concat(n,"]")}(r)})).join(","),a=Pm(n);this.userCode="\n      void main() {\n        ".concat(a," coords = getOutputCoords();\n        setOutput(getX(").concat(r,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(e[0]," - coord - 1));\n        }\n      ")},dk=function dk(e,t){_classCallCheck(this,dk),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;var r=bg("rc",n),a="".concat(r[n-1]," + 1 < ").concat(this.outputShape[n-1]),o="".concat(r[n-2]," + 1 < ").concat(this.outputShape[n-2]),s=Pm(n);function i(n){var r=e.map((function(r,a){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - ").concat(r[n]," - 1"):"".concat(r[n])}(a,n)}));return"getChannel(getX(".concat(r.join(","),"), vec2(").concat(r.slice(-2).join(","),"))")}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(e[0]," - rc - 1),\n            ").concat(e[0]," - rc - 1);\n          if(").concat(a,"){\n              result.g = getChannel(getX(").concat(e[0]," - (rc  + 1) - 1),\n                ").concat(e[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return i(e)}(r.slice()),";\n          if(").concat(a,"){\n            result.g = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",i(e)}(r.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[n-2]="("+e[n-2]+" + 1)",i(e)}(r.slice()),";\n            if(").concat(a,") {\n              result.a = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",i(e)}(r.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")},pk={kernelName:"Reverse",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.dims,s=a.shape.length,i=It(o,a.shape);if(0===s)return Og({inputs:{x:a},backend:n});var u=jt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dk(a.shape,i):new ck(a.shape,i);return n.runWebGLProgram(u,[a],a.dtype)}},fk=function(){function fk(e,t){_classCallCheck(this,fk),this.variableNames=["Image"],this.outputShape=[];var n=e[1],r=e[2];this.outputShape=e;var a;a="number"==typeof t?"float outputValue = ".concat(t.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(t.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        uniform vec4 params;\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(a,"\n          if(coordX >= 0 && coordX < ").concat(r," && coordY >= 0 && coordY < ").concat(n,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}return _createClass(fk,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e,t,n,r){var _this73=this;return function(a,o){null==_this73.paramsLoc&&(_this73.paramsLoc=a.getUniformLocationNoThrow(o,"params")),a.gl.uniform4f(_this73.paramsLoc,e,t,n,r)}}}]),fk}(),hk={kernelName:"RotateWithOffset",backendName:"webgl",kernelFunc:function kernelFunc(_ref54){var e=_ref54.inputs,t=_ref54.attrs,n=_ref54.backend,r=e.image,a=t.radians,o=t.fillValue,s=t.center,i=n,u=new fk(r.shape,o),_tu4=_slicedToArray(tu(s,r.shape[1],r.shape[2]),2),l=_tu4[0],c=_tu4[1],d=u.getCustomSetupFunc(l,c,Math.sin(a),Math.cos(a));return i.runWebGLProgram(u,[r],r.dtype,d)}},mk={kernelName:"Round",backendName:"webgl",kernelFunc:Hg({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"})},gk={kernelName:"Rsqrt",backendName:"webgl",kernelFunc:Hg({opSnippet:"return inversesqrt(x);",cpuKernelImpl:ig})},bk=function bk(e,t,n,r,a,o){_classCallCheck(this,bk),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var i=Pm(a.length),u=Pm(o.length),l="";1===n?l="i":2===n&&(l="i, j");var c="getIndices(".concat(l,")"),d="";1===r?d="i":2===r&&(d="i, coords[1]");var p="getUpdates(".concat(d,")"),f=t>1?"strides[j]":"strides";this.userCode="\n        ".concat(i," strides = ").concat(i,"(").concat(a,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(e,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(t,"; j++) {\n              int index = round(").concat(c,");\n              flattenedIndex += index * ").concat(f,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(p,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")},yk={kernelName:"ScatterNd",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=t.updates,s=r.shape,_Ur2=Ur(0,a,s),i=_Ur2.sliceRank,u=_Ur2.numUpdates,l=_Ur2.sliceSize,c=_Ur2.strides,d=_Ur2.outputSize,p=[d/l,l];if(0===d)return n.makeTensorInfo(s,a.dtype);var f=eb({inputs:{x:a},backend:n,attrs:{shape:[u,i]}}),h=eb({inputs:{x:o},backend:n,attrs:{shape:[u,l]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new bk(u,i,f.shape.length,h.shape.length,c,p),b=n.runWebGLProgram(g,[h,f,m],h.dtype),y=eb({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(m),y}},xk=function xk(e,t,n){var r,a;if(_classCallCheck(this,xk),this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(1===n)a="resRC",r="resRC";else{for(var _n95=["resRC.x","resRC.y","resRC.z","resRC.w"],_o112=[],_s77=[],_r180=0;_r180<t.length;_r180++)_s77.push("".concat(_n95[_r180])),_r180<e&&_o112.push("".concat(_n95[_r180]));r=_o112.join(),a=_s77.join()}var o=Pm(n);this.userCode="\n      void main() {\n        ".concat(o," resRC = getOutputCoords();\n        float cVal = getC(").concat(r,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(a,"));\n        } else {\n          setOutput(getB(").concat(a,"));\n        }\n      }\n    ")},vk={kernelName:"Select",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,o=t.e,s=new xk(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(s,[r,a,o],_n(a.dtype,o.dtype))}},kk={kernelName:"Selu",backendName:"webgl",kernelFunc:Hg({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n"})},wk={kernelName:"Sigmoid",backendName:"webgl",kernelFunc:Hg({opSnippet:"return 1.0 / (1.0 + exp(-1.0 * x));"})},Ik={kernelName:"Sign",backendName:"webgl",kernelFunc:Hg({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"})},Nk={kernelName:"Sin",backendName:"webgl",kernelFunc:Hg({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"})},Tk={kernelName:"Sinh",backendName:"webgl",kernelFunc:Hg({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"})},Ck={kernelName:"Softplus",backendName:"webgl",kernelFunc:Hg({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"})},Ek={kernelName:"SpaceToBatchND",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,s=r.paddings;pt(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var i=o.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,_toConsumableArray(s));for(var _e234=1+o.length;_e234<a.shape.length;++_e234)u.push([0,0]);var l=[],c=Gv({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),d=nu(c.shape,o,i,!1),p=ru(d.length,o.length,!1),f=au(c.shape,o,i,!1),h=eb({inputs:{x:c},backend:n,attrs:{shape:d}}),m=cb({inputs:{x:h},backend:n,attrs:{perm:p}}),g=eb({inputs:{x:m},backend:n,attrs:{shape:f}});return l.push(c),l.push(h),l.push(m),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},Sk={kernelName:"SparseToDense",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,o=t.sparseValues,s=t.defaultValue,i=r.outputShape,_Ur3=Ur(0,a,i),u=_Ur3.sliceRank,l=_Ur3.numUpdates,c=_Ur3.strides,d=_Ur3.outputSize,p=new bk(l,u,a.shape.length,o.shape.length,c,[d,1],!1),f=n.runWebGLProgram(p,[o,a,s],o.dtype),h=eb({inputs:{x:f},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(f),h}},_k={kernelName:"SplitV",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.numOrSizeSplits,i=It(r.axis,a.shape)[0],u=gu(a,o,i),l=a.shape.length,c=new Array(l).fill(0),d=a.shape.slice();return u.map((function(e){var t=_toConsumableArray(d);t[i]=e;var r=Zb({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[i]+=e,r}))}},$k={kernelName:"Sqrt",backendName:"webgl",kernelFunc:Hg({opSnippet:"return sqrt(x);"})},Rk={kernelName:"Square",backendName:"webgl",kernelFunc:Hg({opSnippet:"return x * x;"})},Ak={kernelName:"SquaredDifference",backendName:"webgl",kernelFunc:jg({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"})},Fk={kernelName:"Step",backendName:"webgl",kernelFunc:function kernelFunc(_ref55){var e=_ref55.inputs,t=_ref55.attrs,n=_ref55.backend,r=e.x,a="if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(".concat(t.alpha,");\n  "),o=new Ng(r.shape,a);return n.runWebGLProgram(o,[r],r.dtype)}},Ok=function Ok(e,t,n){_classCallCheck(this,Ok),this.variableNames=["x"],this.outputShape=n;var r=n.length,a=Pm(n.length),o=Pm(n.length),s="";if(1===r)s="coords * strides + begin";else{var _e235=0;s=n.map((function(t,r){return _e235++,1===n.length?"coords * strides[".concat(r,"] + begin[").concat(r,"]"):"coords[".concat(_e235-1,"] * strides[").concat(r,"] + begin[").concat(r,"]")})).join(",")}this.userCode="\n      ".concat(a," begin = ").concat(a,"(").concat(e,");\n      ").concat(a," strides = ").concat(a,"(").concat(t,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")},Mk={kernelName:"StridedSlice",backendName:"webgl",kernelFunc:function kernelFunc(e){var v,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.begin,s=r.end,i=r.strides,u=r.beginMask,l=r.endMask,c=r.ellipsisMask,d=r.newAxisMask,p=r.shrinkAxisMask,_oa=oa(a.shape,o,s,i,u,l,c,d,p),f=_oa.nonStrided,h=_oa.$begin,m=_oa.$strides,g=_oa.size,b=_oa.newShape,y=_oa.outShape,x=eb({inputs:{x:a},backend:n,attrs:{shape:b}});if(f){var _e236=Zb({inputs:{x:x},backend:n,attrs:{begin:h,size:g}});v=eb({inputs:{x:_e236},backend:n,attrs:{shape:y}}),n.disposeIntermediateTensorInfo(_e236)}else if(y.some((function(e){return 0===e})))v=n.makeTensorInfo(y,a.dtype,[]);else if(n.shouldExecuteOnCPU([x])){var _e237=n.texData.get(x.dataId).values,_t183=Cr(x.shape,x.dtype,_e237),_r181=cg(y,_t183,m,h);v=n.makeTensorInfo(y,x.dtype,_r181.values)}else{var _e238=new Ok(h,m,y);v=n.runWebGLProgram(_e238,[x],x.dtype)}var k=eb({inputs:{x:v},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(v),k}},Dk={kernelName:"Tan",backendName:"webgl",kernelFunc:Hg({opSnippet:"return tan(x);"})},Pk={kernelName:"Tanh",backendName:"webgl",kernelFunc:Hg({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"})},Lk=function Lk(e,t){_classCallCheck(this,Lk),this.variableNames=["A"];for(var n=new Array(e.length),_r182=0;_r182<n.length;_r182++)n[_r182]=e[_r182]*t[_r182];this.outputShape=n,this.rank=n.length;var r=Pm(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],_t184=0;_t184<e.length;_t184++)r.push("imod(".concat(n[_t184],", ").concat(e[_t184],")"));return r.join()}(e);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(a,"));\n      }\n    ")};function Bk(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reps;if("string"===a.dtype){var _e239=n.readSync(a.dataId).map((function(e){return ln(e)})),_t185=Cr(a.shape,a.dtype,_e239),_r183=pg(_t185,o);return n.makeTensorInfo(_r183.shape,_r183.dtype,_r183.values)}var s=new Lk(a.shape,o);return n.runWebGLProgram(s,[a],a.dtype)}for(var Vk=function Vk(e,t,n,r,a,o){_classCallCheck(this,Vk),this.variableNames=["Image","Transforms"],this.outputShape=o;var i,s="nearest"===n?1:2;switch(r){case"constant":i=1;break;case"reflect":i=2;break;case"wrap":i=3;break;case"nearest":i=4;break;default:i=1}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(i," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(i," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(i," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(e," && 0 <= coordX && coordX < ").concat(t,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(a,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(a,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(t,"));\n                float mapY = mapCoord(inY, float(").concat(e,"));\n\n                if (").concat(s," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")},Gk=function Gk(e,t){_classCallCheck(this,Gk),this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,a=e.inSize,o=e.numSegments,s=o*Math.ceil(a/n);this.outputShape=[r,s];var i=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";a%n>0&&(c="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return initializationValue;\n        }\n      "));var d="";a%n>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ".concat(c,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(d,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(n,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(i,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(i,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")},_i55=0,_qk=[tv,rv,fb,hb,mb,gb,xb,wb,Ib,Nb,$b,Rb,Ab,Fb,Mb,Ob,Db,zb,Bb,Ub,Hb,jb,Kb,ey,ty,sy,uy,dy,hy,Pg,Iy,Oy,My,_y,Py,Ly,Dy,By,zy,Vy,Gy,qy,Xy,tx,nx,Zy,ax,sx,ix,ux,lx,cx,fx,mx,bx,vx,Ix,Tx,Ex,Sx,Rx,Fx,Ox,Dx,Lx,Bx,zx,Mg,Wx,xy,Vx,Ux,Hx,zg,jx,Gx,qx,Xx,Kx,Yx,Qx,Zx,ov,uv,iv,dv,pv,fv,sv,hv,mv,gv,xv,vv,_v,Jg,Rv,Fv,Mv,Pv,ry,Bv,Vv,Uv,qv,Kv,Ug,Xv,Qv,oy,Iv,Zv,ek,Jv,tb,rk,ok,ik,lk,pk,hk,mk,gk,yk,vk,kk,wk,Ik,Nk,Tk,Jb,Sv,Ck,Ek,Sk,_k,$k,Rk,Ak,Fk,Mk,Cv,lb,Dk,Pk,{kernelName:"Tile",backendName:"webgl",kernelFunc:Bk},{kernelName:"TopK",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.k,s=r.sorted,i=n.readSync(a.dataId),_fg2=_slicedToArray(fg(i,a.shape,a.dtype,o,s),2),u=_fg2[0],l=_fg2[1];return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}},{kernelName:"Transform",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.transforms,s=r.interpolation,i=r.fillMode,u=r.fillValue,l=r.outputShape,_a$shape3=_slicedToArray(a.shape,4),c=_a$shape3[0],d=_a$shape3[1],p=_a$shape3[2],f=_a$shape3[3],_ref57=_slicedToArray(null!=l?l:[d,p],2),h=_ref57[0],m=_ref57[1],g=new Vk(d,p,s,i,u,[c,h,m,f]);return n.runWebGLProgram(g,[a,o],"float32")}},db,{kernelName:"Unique",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,o=t.x;rm(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var s=r.readSync(o.dataId),_mg=mg(s,a,o.shape,o.dtype),i=_mg.outputValues,u=_mg.outputShape,l=_mg.indices;return[r.makeTensorInfo(u,o.dtype,i),r.makeTensorInfo([l.length],"int32",l)]}},{kernelName:"Unpack",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,o=r.axis;o<0&&(o+=a.shape.length);for(var s=a,i=s.shape.length,u=a.shape[o],l=new Array(i-1),c=0,_e240=0;_e240<i;_e240++)_e240!==o&&(l[c++]=s.shape[_e240]);var d=[],p=new Array(i).fill(0),f=s.shape.slice();f[o]=1;for(var h=new Array(u),_e241=0;_e241<h.length;_e241++){p[o]=_e241;var _t186=Zb({inputs:{x:s},backend:n,attrs:{begin:p,size:f}}),_r184=eb({inputs:{x:_t186},backend:n,attrs:{shape:l}});h[_e241]=_r184,d.push(_t186)}return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),h}},{kernelName:"UnsortedSegmentSum",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.segmentIds,s=r.numSegments,i=a.shape.length,u=[],l=0,c=Jo([l],i),d=a;null!=c&&(d=cb({inputs:{x:a},backend:n,attrs:{perm:c}}),u.push(d),l=ts(1,i)[0]);var p=yu(d.shape,l,s),f=gt([d.shape[l]]),h=eb({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}});u.push(h);var b=eb({inputs:{x:function g(e,t,r,a,o){var s=e.shape[0],i=e.shape[1],l=bu(i,o),c=new Gk({windowSize:l,inSize:i,batchSize:s,numSegments:o},t),d=n.compileAndRun(c,[e,r],a);if(u.push(d),d.shape[1]===o)return d;var p=Yv({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),f=Bk({inputs:{x:p},backend:n,attrs:{reps:[i/l]}});return u.push(p),u.push(f),g(d,t,f,a,o)}(h,"unsortedSegmentSum",o,$n(a.dtype),s)},backend:n,attrs:{shape:p}}),y=b;if(null!=c){u.push(b);var _e242=es(c);y=cb({inputs:{x:y},backend:n,attrs:{perm:_e242}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}},Wv];_i55<_qk.length;_i55++){nn(_qk[_i55])}var Kk=gi,Xk=function(_ut3){_inherits(Xk,_ut3);var _time4,_read3,_super4=_createSuper(Xk);function Xk(){var _this74;return _classCallCheck(this,Xk),(_this74=_super4.call(this)).blockSize=48,_this74.firstUse=!0,_this74.data=new it(_assertThisInitialized(_this74),ia()),_this74}return _createClass(Xk,[{key:"nextDataId",value:function nextDataId(){return Xk.nextDataId++}},{key:"write",value:function write(e,t,n){this.firstUse&&(this.firstUse=!1,jt().get("IS_NODE")&&iu("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function makeTensorInfo(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&$t(n[0])){var _a156=n.map((function(e){return un(e)}));r=this.write(_a156,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function incRef(e){this.data.get(e).refCount++}},{key:"decRef",value:function decRef(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function move(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function numDataIds(){return this.data.numDataIds()}},{key:"read",value:(_read3=_asyncToGenerator(regeneratorRuntime.mark((function _callee50(e){return regeneratorRuntime.wrap((function _callee50$(_context51){for(;;)switch(_context51.prev=_context51.next){case 0:return _context51.abrupt("return",this.readSync(e));case 1:case"end":return _context51.stop()}}),_callee50,this)}))),function read(_x66){return _read3.apply(this,arguments)})},{key:"readSync",value:function readSync(e){var _this$data$get=this.data.get(e),t=_this$data$get.dtype,n=_this$data$get.complexTensorInfos;return"complex64"===t?uu(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):this.data.get(e).values}},{key:"bufferSync",value:function bufferSync(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return ln(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Cr(e.shape,e.dtype,n)}},{key:"makeOutput",value:function makeOutput(e,t,n){var r=this.write(e,t,n);return ia().makeTensorFromDataId(r,t,n,this)}},{key:"disposeData",value:function disposeData(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var _this$data$get2=this.data.get(e),_n96=_this$data$get2.complexTensorInfos;null!=_n96&&(this.disposeData(_n96.real.dataId,!0),this.disposeData(_n96.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}},{key:"time",value:(_time4=_asyncToGenerator(regeneratorRuntime.mark((function _callee51(e){var t;return regeneratorRuntime.wrap((function _callee51$(_context52){for(;;)switch(_context52.prev=_context52.next){case 0:return t=sn(),e(),_context52.abrupt("return",{kernelMs:sn()-t});case 3:case"end":return _context52.stop()}}),_callee51)}))),function time(_x67){return _time4.apply(this,arguments)})},{key:"memory",value:function memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function where(e){vc([e],"where");var t=this.readSync(e.dataId);return Kk(e.shape,t)}},{key:"dispose",value:function dispose(){}},{key:"floatPrecision",value:function floatPrecision(){return 32}},{key:"epsilon",value:function epsilon(){return _get(_getPrototypeOf(Xk.prototype),"epsilon",this).call(this)}}]),Xk}(ut);Xk.nextDataId=0,da("cpu",(function(){return new Xk}),1);var Yk=Vc("Elu",(function(e){return e>=0?e:Math.exp(e)-1})),Qk={kernelName:"Elu",backendName:"cpu",kernelFunc:Yk};function Zk(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.alpha;vc([a],"leakyRelu");for(var s=gt(a.shape),i=n.data.get(a.dataId).values,u=Tt("float32",s),_e244=0;_e244<i.length;_e244++)u[_e244]=i[_e244]<0?o*i[_e244]:i[_e244];return n.makeTensorInfo(a.shape,"float32",u)}var Jk={kernelName:"LeakyRelu",backendName:"cpu",kernelFunc:Zk},ew=Ic((function(e,t){return e<0?t*e:e}));function tw(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;vc([r,a],"prelu");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,_ew2=_slicedToArray(ew(r.shape,a.shape,o,s,r.dtype),2),i=_ew2[0],u=_ew2[1];return n.makeTensorInfo(u,r.dtype,i)}var nw={kernelName:"Prelu",backendName:"cpu",kernelFunc:tw},rw=Vc("Relu",(function(e){return Math.max(0,e)})),aw={kernelName:"Relu",backendName:"cpu",kernelFunc:rw},ow=Vc("Relu6",(function(e){return Math.min(Math.max(0,e),6)})),sw={kernelName:"Relu6",backendName:"cpu",kernelFunc:ow};function iw(e,t,n,r,a){if("linear"===n)return Ec({inputs:{x:t},backend:e});if("relu"===n)return rw({inputs:{x:t},backend:e});if("elu"===n)return Yk({inputs:{x:t},backend:e});if("relu6"===n)return ow({inputs:{x:t},backend:e});if("prelu"===n)return tw({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return Zk({inputs:{x:t},backend:e,attrs:{alpha:a}});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function uw(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.shape,s=gt(a.shape),i=wt(o,s),u=gt(i);pt(s===u,(function(){return"The new shape (".concat(i,") has ").concat(u," elements and the old shape (").concat(a.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")})),n.incRef(a.dataId);var l=n.data.get(a.dataId);if(null!=l.complexTensorInfos){var _e245=l.complexTensorInfos.real,_t187=l.complexTensorInfos.imag;_e245.shape=i,_t187.shape=i}return{dataId:a.dataId,shape:i,dtype:a.dtype}}var lw={kernelName:"Reshape",backendName:"cpu",kernelFunc:uw};function cw(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=r.transposeA,i=r.transposeB;vc([a,o],"matMul");var u=a.shape.length,l=o.shape.length,c=s?a.shape[u-2]:a.shape[u-1],d=i?o.shape[l-1]:o.shape[l-2],p=s?a.shape[u-1]:a.shape[u-2],f=i?o.shape[l-2]:o.shape[l-1],h=a.shape.slice(0,-2),m=o.shape.slice(0,-2),g=gt(h),b=gt(m);pt(u>=2&&l>=2&&(g===b||1===g||1===b),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(h,") and (").concat(m,").")}));var y=(g>b?a.shape.slice(0,-2):o.shape.slice(0,-2)).concat([p,f]);pt(c===d,(function(){return"Error in matMul: inner shapes (".concat(c,") and (").concat(d,") of Tensors with shapes ").concat(a.shape," and ").concat(o.shape," and transposeA=").concat(s," and transposeB=").concat(i," must match.")}));for(var x=i?[b,f,d]:[b,d,f],v=uw({inputs:{x:a},backend:n,attrs:{shape:s?[g,c,p]:[g,p,c]}}),k=uw({inputs:{x:o},backend:n,attrs:{shape:x}}),w=s?v.shape[1]:v.shape[2],I=s?v.shape[2]:v.shape[1],N=i?k.shape[1]:k.shape[2],T=Math.max(g,b),C=n.data.get(v.dataId).values,E=n.data.get(k.dataId).values,S=Ot(v.shape),_=Ot(k.shape),_ref59=_slicedToArray(s?[S[0],1,S[1]]:[S[0],S[1],1],3),$=_ref59[0],R=_ref59[1],A=_ref59[2],_ref61=_slicedToArray(i?[1,_[1],_[0]]:[_[1],1,_[0]],3),F=_ref61[0],O=_ref61[1],M=_ref61[2],D=I*N,P=Cr([T,I,N],v.dtype),L=P.values,B=n.blockSize,_e246=0;_e246<T;_e246++)for(var _t188=0;_t188<I;_t188+=B)for(var _n97=0;_n97<N;_n97+=B)for(var _r185=0;_r185<w;_r185+=B)for(var _a157=Math.min(_t188+B,I),_o113=Math.min(_n97+B,N),_s78=Math.min(_r185+B,w),_i56=_t188;_i56<_a157;_i56++)for(var _t189=_n97;_t189<_o113;_t189++){for(var _n98=0,_a158=_r185;_a158<_s78;_a158++){var _r186=Math.min(_e246,g-1)*$,_o114=Math.min(_e246,b-1)*M;_n98+=C[_r186+_i56*R+_a158*A]*E[_a158*F+_t189*O+_o114]}L[_e246*D+(_i56*N+_t189)]+=_n98}return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(k),n.makeTensorInfo(y,P.dtype,P.values)}var dw={kernelName:"BatchMatMul",backendName:"cpu",kernelFunc:cw},pw={kernelName:"_FusedMatMul",backendName:"cpu",kernelFunc:function kernelFunc(e){var p,f,h,t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=t.bias,i=t.preluActivationWeights,u=r.transposeA,l=r.transposeB,c=r.activation,d=r.leakyreluAlpha,m=[];p=cw({inputs:{a:a,b:o},attrs:{transposeA:u,transposeB:l},backend:n}),s&&(f=Pc({inputs:{a:p,b:s},backend:n}),m.push(p),p=f),c&&(h=iw(n,p,c,i,d),m.push(p),p=h);for(var _i57=0,_m7=m;_i57<_m7.length;_i57++){var _e247=_m7[_i57];n.disposeIntermediateTensorInfo(_e247)}return p}},fw={kernelName:"Acos",backendName:"cpu",kernelFunc:Vc("Acos",(function(e){return Math.acos(e)}))},hw={kernelName:"Acosh",backendName:"cpu",kernelFunc:Vc("Acosh",(function(e){return Math.acosh(e)}))},mw={kernelName:"AddN",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t;vc(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),o=Cr(r[0].shape,r[0].dtype),s=o.values,_e248=0;_e248<r.length;_e248++)for(var _t190=a[_e248],_e249=0;_e249<s.length;_e249++)s[_e249]+=_t190[_e249];return n.makeTensorInfo(o.shape,o.dtype,o.values)}},gw={kernelName:"All",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;vc(a,"all");var i=It(o,a.shape),u=i,l=Jo(u,a.shape.length),c=a;null!=l&&(c=wd({inputs:{x:a},backend:n,attrs:{perm:l}}),u=ts(u.length,a.shape.length)),Zo("all",u,c.shape.length);for(var _Yo30=_slicedToArray(Yo(c.shape,u),2),d=_Yo30[0],f=gt(_Yo30[1]),h=Lt(gt(d),c.dtype),m=n.data.get(c.dataId).values,_e250=0;_e250<h.length;++_e250){for(var _t191=_e250*f,_n99=m[_t191],_e251=0;_e251<f;++_e251){var _r187=m[_t191+_e251];_n99=_n99&&_r187}h[_e250]=_n99}null!=l&&n.disposeIntermediateTensorInfo(c);var g=n.makeTensorInfo(d,c.dtype,h);if(s){var _e252=uw({inputs:{x:g},backend:n,attrs:{shape:Qo(d,i)}});return n.disposeIntermediateTensorInfo(g),_e252}return g}},bw={kernelName:"Any",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;vc(a,"any");var i=It(o,a.shape),u=i,l=Jo(u,a.shape.length),c=a;null!=l&&(c=wd({inputs:{x:a},backend:n,attrs:{perm:l}}),u=ts(u.length,a.shape.length)),Zo("any",u,c.shape.length);for(var _Yo32=_slicedToArray(Yo(c.shape,u),2),d=_Yo32[0],f=gt(_Yo32[1]),h=Lt(gt(d),c.dtype),m=n.data.get(c.dataId).values,_e253=0;_e253<h.length;++_e253){for(var _t192=_e253*f,_n100=m[_t192],_e254=0;_e254<f;++_e254){var _r188=m[_t192+_e254];_n100=_n100||_r188}h[_e253]=_n100}null!=l&&n.disposeIntermediateTensorInfo(c);var g=n.makeTensorInfo(d,c.dtype,h);if(s){var _e255=uw({inputs:{x:g},backend:n,attrs:{shape:Qo(d,i)}});return n.disposeIntermediateTensorInfo(g),_e255}return g}},yw={kernelName:"ArgMax",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis;vc(a,"argMax");var s=It(o,a.shape),i=Jo(s,a.shape.length),u=a,l=[];null!=i&&(u=wd({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),s=ts(s.length,u.shape.length)),Zo("argMax",s=[s[0]],u.shape.length);for(var _Yo34=_slicedToArray(Yo(u.shape,s),2),c=_Yo34[0],d=_Yo34[1],p=Lt(gt(c),"int32"),f=gt(d),h=n.data.get(u.dataId).values,_e256=0;_e256<p.length;++_e256){for(var _t193=_e256*f,_n101=h[_t193],_r189=0,_e257=0;_e257<f;++_e257){var _a159=h[_t193+_e257];_a159>_n101&&(_n101=_a159,_r189=_e257)}p[_e256]=_r189}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(c,"int32",p)}},xw={kernelName:"ArgMin",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis;vc(a,"argMin");var s=It(o,a.shape),i=Jo(s,a.shape.length),u=a,l=[];null!=i&&(u=wd({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),s=ts(s.length,u.shape.length)),Zo("argMin",s=[s[0]],u.shape.length);for(var _Yo36=_slicedToArray(Yo(u.shape,s),2),c=_Yo36[0],d=_Yo36[1],p=Lt(gt(c),"int32"),f=gt(d),h=n.data.get(u.dataId).values,_e258=0;_e258<p.length;++_e258){for(var _t194=_e258*f,_n102=h[_t194],_r190=0,_e259=0;_e259<f;++_e259){var _a160=h[_t194+_e259];_a160<_n102&&(_n102=_a160,_r190=_e259)}p[_e258]=_r190}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(c,"int32",p)}},vw={kernelName:"Asin",backendName:"cpu",kernelFunc:Vc("Asin",(function(e){return Math.asin(e)}))},kw={kernelName:"Asinh",backendName:"cpu",kernelFunc:Vc("Asinh",(function(e){return Math.asinh(e)}))},ww={kernelName:"Atan",backendName:"cpu",kernelFunc:Vc("Atan",(function(e){return Math.atan(e)}))},Iw={kernelName:"Atan2",backendName:"cpu",kernelFunc:Fc("Atan2",Ic((function(e,t){return Math.atan2(e,t)})))},Nw={kernelName:"Atanh",backendName:"cpu",kernelFunc:Vc("Atanh",(function(e){return Math.atanh(e)}))};function Tw(e,t,n,r,a,o){for(var s=a.strideHeight,i=a.strideWidth,u=a.dilationHeight,l=a.dilationWidth,c=a.effectiveFilterHeight,d=a.effectiveFilterWidth,p=a.padInfo.top,f=a.padInfo.left,h="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Cr(a.outShape,n),g=m.values,b=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],x=a.outShape[3],_t195=0;_t195<a.batchSize;++_t195)for(var _n103=_t195*b,_m8=_t195*r[0],_t196=0;_t196<a.inChannels;++_t196)for(var _b5=0;_b5<a.outHeight;++_b5)for(var _v4=_b5*s-p,_k3=Math.max(0,_v4),_w2=Math.min(a.inHeight,c+_v4),_I2=_n103+_b5*y,_n104=0;_n104<a.outWidth;++_n104){for(var _s79=_n104*i-f,_c12=Math.max(0,_s79),_p8=Math.min(a.inWidth,d+_s79),_b6=h,_y6=0,_v5=0,_n105=_k3;_n105<_w2;_n105+=u){for(var _a161=_m8+_n105*r[1],_n106=_c12;_n106<_p8;_n106+=l){var _s80=e[_a161+_n106*r[2]+_t196];"max"===o&&_s80>_b6?_b6=_s80:"avg"===o&&(_y6+=_s80,_v5++)}if(isNaN(_b6))break}g[_I2+_n104*x+_t196]="avg"===o?_y6/_v5:_b6}return m}function Cw(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=Cr(r.outShape,"int32"),i=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=r.padInfo.top,h=r.padInfo.left,m=Cr(t,n,e),_e260=0;_e260<r.batchSize;++_e260)for(var _t197=0;_t197<r.inChannels;++_t197)for(var _n107=0;_n107<r.outHeight;++_n107){for(var _g6=_n107*i-f,_b7=_g6;_b7<0;)_b7+=l;for(var _y7=Math.min(r.inHeight,d+_g6),_i58=0;_i58<r.outWidth;++_i58){for(var _d15=_i58*u-h,_f7=_d15;_f7<0;)_f7+=c;for(var _x68=Math.min(r.inWidth,p+_d15),_v6=Number.NEGATIVE_INFINITY,_k4=-1,_n108=_b7;_n108<_y7;_n108+=l)for(var _s81=_n108-_g6,_i59=_f7;_i59<_x68;_i59+=c){var _u36=_i59-_d15,_l15=m.get(_e260,_n108,_i59,_t197);_l15>_v6&&(_v6=_l15,_k4=a?o?((_e260*r.inHeight+_n108)*r.inWidth+_i59)*r.inChannels+_t197:(_n108*r.inWidth+_i59)*r.inChannels+_t197:_s81*p+_u36)}s.set(_k4,_e260,_n107,_i58,_t197)}}return s}function Ew(e,t,n,r,a,o){for(var s=a.strideDepth,i=a.strideHeight,u=a.strideWidth,l=a.dilationDepth,c=a.dilationHeight,d=a.dilationWidth,p=a.effectiveFilterDepth,f=a.effectiveFilterHeight,h=a.effectiveFilterWidth,m=a.padInfo.front,g=a.padInfo.top,b=a.padInfo.left,y="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=Cr(a.outShape,n),v=x.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],I=a.outShape[3]*a.outShape[4],N=a.outShape[4],_t198=0;_t198<a.batchSize;++_t198)for(var _n109=_t198*k,_x69=_t198*r[0],_t199=0;_t199<a.inChannels;++_t199)for(var _k5=0;_k5<a.outDepth;++_k5){for(var _T2=_k5*s-m,_C2=_T2;_C2<0;)_C2+=l;for(var _E2=Math.min(a.inDepth,p+_T2),_S2=_n109+_k5*w,_n110=0;_n110<a.outHeight;++_n110){for(var _s82=_n110*i-g,_p9=_s82;_p9<0;)_p9+=c;for(var _m9=Math.min(a.inHeight,f+_s82),_k6=_S2+_n110*I,_n111=0;_n111<a.outWidth;++_n111){for(var _s83=_n111*u-b,_i60=_s83;_i60<0;)_i60+=d;for(var _f8=Math.min(a.inWidth,h+_s83),_g7=_k6+_n111*N,_w3=y,_I3=0,_T3=0,_n112=_C2;_n112<_E2;_n112+=l){for(var _a162=_x69+_n112*r[1],_n113=_p9;_n113<_m9;_n113+=c){for(var _s84=_a162+_n113*r[2],_n114=_i60;_n114<_f8;_n114+=d){var _a163=e[_s84+_n114*r[3]+_t199];if("max"===o&&_a163>_w3?_w3=_a163:"avg"===o&&(_I3+=_a163,_T3++),isNaN(_w3))break}if(isNaN(_w3))break}if(isNaN(_w3))break}v[_g7+_t199]="avg"===o?_I3/_T3:_w3}}}return x}var Sw={kernelName:"AvgPool",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;vc(a,"avgPool");var o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode;pt(za(s,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var c,l=$a(a.shape,o,s,1,i,u);if(1===l.filterWidth&&1===l.filterHeight&&bt(l.inShape,l.outShape))c=Ec({inputs:{x:a},backend:n});else{var _e261=n.data.get(a.dataId).values,_t200=Ot(a.shape),_r191=Tw(_e261,a.shape,a.dtype,_t200,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,_r191.values)}return c}},_w={kernelName:"AvgPool3D",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode,l=r.dataFormat;vc(a,"avgPool3d");var c=Ra(a.shape,o,s,1,i,u,l),d=Ew(n.data.get(a.dataId).values,a.shape,a.dtype,Ot(a.shape),c,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}},$w={kernelName:"AvgPool3DGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,s=r.filterSize,i=r.strides,u=r.pad,l=r.dimRoundingMode;vc([a,o],"avgPool3DGrad");for(var c=Ra(o.shape,s,i,1,u,l),d=c.strideDepth,p=c.strideHeight,f=c.strideWidth,h=c.filterDepth,m=c.filterHeight,g=c.filterWidth,b=c.dilationDepth,y=c.dilationHeight,x=c.dilationWidth,v=c.effectiveFilterDepth,k=c.effectiveFilterHeight,w=c.effectiveFilterWidth,I=v-1-c.padInfo.front,N=w-1-c.padInfo.left,T=k-1-c.padInfo.top,C=Cr(o.shape,"float32"),E=1/(h*m*g),S=n.bufferSync(a),_e262=0;_e262<c.batchSize;++_e262)for(var _t201=0;_t201<c.inChannels;++_t201)for(var _n115=0;_n115<c.inDepth;++_n115)for(var _r192=0;_r192<c.inHeight;++_r192)for(var _a164=0;_a164<c.inWidth;++_a164){for(var _o115=_n115-I,_s85=_r192-T,_i61=_a164-N,_u37=0,_n116=0;_n116<v;_n116+=b){var _r193=(_o115+_n116)/d;if(!(_r193<0||_r193>=c.outDepth||Math.floor(_r193)!==_r193))for(var _n117=0;_n117<k;_n117+=y){var _a165=(_s85+_n117)/p;if(!(_a165<0||_a165>=c.outHeight||Math.floor(_a165)!==_a165))for(var _n118=0;_n118<w;_n118+=x){var _o116=(_i61+_n118)/f;_o116<0||_o116>=c.outWidth||Math.floor(_o116)!==_o116||(_u37+=S.get(_e262,_r193,_a165,_o116,_t201))}}}C.set(_u37*E,_e262,_n115,_r192,_a164,_t201)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}},Rw={kernelName:"AvgPoolGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,s=o;vc([a,o],"avgPoolGrad");for(var i=r.filterSize,u=r.strides,l=r.pad,c=$a(s.shape,i,u,1,l),d=c.strideHeight,p=c.strideWidth,f=c.filterHeight,h=c.filterWidth,m=c.dilationHeight,g=c.dilationWidth,b=c.effectiveFilterHeight,y=c.effectiveFilterWidth,x=y-1-c.padInfo.left,v=b-1-c.padInfo.top,k=Cr(s.shape,"float32"),w=1/(f*h),I=n.data.get(a.dataId).values,N=Cr(a.shape,"float32",I),_e263=0;_e263<c.batchSize;++_e263)for(var _t202=0;_t202<c.inChannels;++_t202)for(var _n119=0;_n119<c.inHeight;++_n119)for(var _r194=0;_r194<c.inWidth;++_r194){for(var _a166=_n119-v,_o117=_r194-x,_s86=0,_n120=0;_n120<b;_n120+=m){var _r195=(_a166+_n120)/d;if(!(_r195<0||_r195>=c.outHeight||Math.floor(_r195)!==_r195))for(var _n121=0;_n121<y;_n121+=g){var _a167=(_o117+_n121)/p;_a167<0||_a167>=c.outWidth||Math.floor(_a167)!==_a167||(_s86+=N.get(_e263,_r195,_a167,_t202))}}k.set(_s86*w,_e263,_n119,_r194,_t202)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}},Aw={kernelName:"FusedBatchNorm",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.scale,s=t.offset,i=t.mean,u=t.variance;pt(i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),pt(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),pt(null==o||i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),vc([a,i,u,o,s],"batchNorm");var l=r.varianceEpsilon;null==l&&(l=.001);for(var c=n.data.get(a.dataId).values,d=n.data.get(i.dataId).values,p=n.data.get(u.dataId).values,f=o?n.data.get(o.dataId).values:new Float32Array([1]),h=s?n.data.get(s.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),g=h.length,b=f.length,y=p.length,x=d.length,v=0,k=0,w=0,I=0,_e264=0;_e264<c.length;++_e264)m[_e264]=h[v++]+(c[_e264]-d[k++])*f[w++]/Math.sqrt(p[I++]+l),v>=g&&(v=0),k>=x&&(k=0),w>=b&&(w=0),I>=y&&(I=0);return n.makeTensorInfo(a.shape,a.dtype,m)}},Fw={kernelName:"BatchToSpaceND",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,s=r.crops;vc([a],"batchToSpaceND");var i=o.reduce((function(e,t){return e*t})),u=nu(a.shape,o,i),l=ru(u.length,o.length),c=au(a.shape,o,i),d=ou(s,o.length),p=su(c,s,o.length),f=uw({inputs:{x:a},backend:n,attrs:{shape:u}}),h=wd({inputs:{x:f},backend:n,attrs:{perm:l}}),m=uw({inputs:{x:h},backend:n,attrs:{shape:c}}),g=$d({inputs:{x:m},backend:n,attrs:{begin:d,size:p}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),g}},Ow={kernelName:"Bincount",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.weights,s=r.size,i=Bc(n.data.get(a.dataId).values,n.data.get(o.dataId).values,o.dtype,o.shape,s);return n.makeTensorInfo([s],o.dtype,i)}},Mw={kernelName:"ClipByValue",backendName:"cpu",kernelFunc:Vc("ClipByValue",(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}))},Dw={kernelName:"ComplexAbs",backendName:"cpu",kernelFunc:function kernelFunc(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(gt(t.shape)),a=n.data.get(t.dataId),o=a.complexTensorInfos.real,s=a.complexTensorInfos.imag,i=n.data.get(o.dataId).values,u=n.data.get(s.dataId).values,_e265=0;_e265<i.length;_e265++){var _t203=i[_e265],_n122=u[_e265];r[_e265]=Math.hypot(_t203,_n122)}return n.makeOutput(r,t.shape,"float32")}};function Pw(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,o=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,o)}var Lw={kernelName:"Imag",backendName:"cpu",kernelFunc:Pw};function Bw(e){var t=e.inputs,n=e.backend,o=It(e.attrs.axis,t[0].shape)[0],s=Ji(t.map((function(e){return e.shape})),o);if(0===gt(s))return n.makeTensorInfo(s,t[0].dtype,[]);var i=t.filter((function(e){return gt(e.shape)>0}));if(1===i.length)return Ec({inputs:{x:i[0]},backend:n});if(Zi(i.map((function(e){return e.shape})),o),"complex64"===i[0].dtype){var _e266=i.map((function(e){return _c({inputs:{input:e},backend:n})})),_t204=i.map((function(e){return Pw({inputs:{input:e},backend:n})})),_r196=Bw({inputs:_e266,backend:n,attrs:{axis:o}}),_a168=Bw({inputs:_t204,backend:n,attrs:{axis:o}}),_s87=Nc({inputs:{real:_r196,imag:_a168},backend:n});return _e266.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),_t204.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(_r196),n.disposeIntermediateTensorInfo(_a168),_s87}var u=i.map((function(e){var t=gt(e.shape.slice(o));return uw({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),l=u.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));s=Ji(u.map((function(e){return e.shape})),1);var c=1===u[0].shape[0],d=Gc(l,s,t[0].dtype,c),p=Ji(i.map((function(e){return e.shape})),o),f=n.makeTensorInfo(p,t[0].dtype,d);return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),f}var zw={kernelName:"Concat",backendName:"cpu",kernelFunc:Bw};function Ww(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dilations,c=r.dimRoundingMode;vc([a,o],"conv2d");for(var d=Wa(u),p=Aa(a.shape,o.shape,s,l,i,c,!1,d),f=p.filterHeight,h=p.filterWidth,m=p.dilationHeight,g=p.dilationWidth,b=p.padInfo.left,y=p.padInfo.top,x="channelsLast"===p.dataFormat,v=new yn(p.outShape,a.dtype),k=Ot(a.shape),w=Ot(o.shape),I=k[0],N=x?k[1]:k[2],T=x?k[2]:1,C=x?1:k[1],E=v.strides[0],S=x?v.strides[1]:v.strides[2],_=x?v.strides[2]:1,$=x?1:v.strides[1],R=n.data.get(a.dataId).values,A=n.data.get(o.dataId).values,F=v.values,_e267=0;_e267<p.batchSize;++_e267)for(var _t205=_e267*I,_n123=_e267*E,_e268=0;_e268<p.outHeight;++_e268)for(var _r197=_n123+_e268*S,_a169=_e268*p.strideHeight-y,_e269=0;_e269<f;++_e269){var _n124=_a169+_e269*m;if(!(_n124<0||_n124>=p.inHeight))for(var _o118=_e269*w[0],_s88=_t205+_n124*N,_e270=0;_e270<p.outWidth;++_e270)for(var _t206=_r197+_e270*_,_n125=_e270*p.strideWidth-b,_e271=0;_e271<h;++_e271){var _r198=_n125+_e271*g;if(!(_r198<0||_r198>=p.inWidth))for(var _a170=_s88+_r198*T,_i62=_o118+_e271*w[1],_e272=0;_e272<p.inChannels;++_e272){for(var _n126=R[_a170+_e272*C],_e273=0;_e273<p.outChannels;++_e273)F[_t206+_e273*$]+=_n126*A[_i62+_e273];_i62+=p.outChannels}}}return n.makeTensorInfo(v.shape,v.dtype,F)}var Vw={kernelName:"Conv2D",backendName:"cpu",kernelFunc:Ww},Uw={kernelName:"Conv2DBackpropFilter",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=r.filterShape;vc([a,o],"conv2dBackpropFilter");for(var d=Wa(u),p=Aa(a.shape,c,s,1,i,l,!1,d),f=p.strideHeight,h=p.strideWidth,m=p.filterHeight,g=p.filterWidth,b="channelsLast"===p.dataFormat,y=new yn(p.filterShape,"float32"),x=p.padInfo.left,v=p.padInfo.top,k=n.data.get(a.dataId).values,w=n.data.get(o.dataId).values,I=new yn(a.shape,a.dtype,k),N=new yn(o.shape,o.dtype,w),_e274=0;_e274<m;++_e274)for(var _t207=Math.max(0,Math.ceil((v-_e274)/f)),_n127=Math.min(p.outHeight,(p.inHeight+v-_e274)/f),_r199=0;_r199<g;++_r199)for(var _a171=Math.max(0,Math.ceil((x-_r199)/h)),_o119=Math.min(p.outWidth,(p.inWidth+x-_r199)/h),_s89=0;_s89<p.inChannels;++_s89)for(var _i63=0;_i63<p.outChannels;++_i63){for(var _u38=0,_l16=0;_l16<p.batchSize;++_l16)for(var _c13=_t207;_c13<_n127;++_c13)for(var _t208=_e274+_c13*f-v,_e275=_a171;_e275<_o119;++_e275){var _n128=_r199+_e275*h-x;_u38+=b?I.get(_l16,_t208,_n128,_s89)*N.get(_l16,_c13,_e275,_i63):I.get(_l16,_s89,_t208,_n128)*N.get(_l16,_i63,_c13,_e275)}y.set(_u38,_e274,_r199,_s89,_i63)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},Hw={kernelName:"Conv2DBackpropInput",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.inputShape,i=r.strides,u=r.pad,l=r.dataFormat,c=r.dimRoundingMode;vc([a,o],"conv2dBackpropInput");var d=Ot(o.shape),p=Ot(a.shape),f=Wa(l),h=Aa(s,o.shape,i,1,u,c,!1,f),m=new yn(h.inShape,"float32"),g=m.values,b=n.data.get(a.dataId).values,y=n.data.get(o.dataId).values,_d16=_slicedToArray(d,3),x=_d16[0],v=_d16[1],k=_d16[2],w=h.batchSize,I=h.filterHeight,N=h.filterWidth,T=h.inChannels,C=h.inHeight,E=h.inWidth,S=h.outChannels,_=h.outHeight,$=h.outWidth,R=h.strideHeight,A=h.strideWidth;f=h.dataFormat;for(var F=I-1-h.padInfo.top,O=N-1-h.padInfo.left,M="channelsLast"===f,D=m.strides[0],P=M?m.strides[1]:m.strides[2],L=M?m.strides[2]:1,B=M?1:m.strides[1],z=p[0],W=M?p[1]:p[2],V=M?p[2]:1,U=M?1:p[1],_e276=0;_e276<w;++_e276)for(var _t209=0;_t209<T;++_t209)for(var _n129=0;_n129<C;++_n129)for(var _r200=_n129-F,_a172=Math.max(0,Math.ceil(_r200/R)),_o120=Math.min(_,(I+_r200)/R),_s90=0;_s90<E;++_s90){for(var _i64=_s90-O,_u39=Math.max(0,Math.ceil(_i64/A)),_l17=Math.min($,(N+_i64)/A),_c14=0,_n130=_a172;_n130<_o120;++_n130)for(var _a173=_n130*R-_r200,_r201=_u39;_r201<_l17;++_r201)for(var _o121=z*_e276+W*_n130+V*_r201,_s91=x*(I-1-_a173)+v*(N-1-(_r201*A-_i64))+k*_t209,_e277=0;_e277<S;++_e277)_c14+=b[_o121+U*_e277]*y[_s91+_e277];g[D*_e276+P*_n129+L*_s90+B*_t209]=_c14}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},jw={kernelName:"Conv3D",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dilations;vc([a,o],"conv3d");for(var l=Fa(a.shape,o.shape,s,u,i),c=l.filterDepth,d=l.filterHeight,p=l.filterWidth,f=l.dilationDepth,h=l.dilationHeight,m=l.dilationWidth,g=l.padInfo,b=g.front,y=g.left,x=g.top,v=new yn(l.outShape,a.dtype),k=n.data.get(a.dataId).values,w=n.data.get(o.dataId).values,I=v.values,N=Ot(a.shape),T=Ot(o.shape),_e278=0;_e278<l.batchSize;++_e278)for(var _t210=_e278*N[0],_n131=_e278*v.strides[0],_e279=0;_e279<l.outDepth;++_e279)for(var _r202=_n131+_e279*v.strides[1],_a174=_e279*l.strideDepth-b,_e280=0;_e280<c;++_e280){var _n132=_a174+_e280*f;if(!(_n132<0||_n132>=l.inDepth))for(var _o122=_e280*T[0],_s92=_t210+_n132*N[1],_e281=0;_e281<l.outHeight;++_e281)for(var _t211=_r202+_e281*v.strides[2],_n133=_e281*l.strideHeight-x,_e282=0;_e282<d;++_e282){var _r203=_n133+_e282*h;if(!(_r203<0||_r203>=l.inHeight))for(var _a175=_o122+_e282*T[1],_i65=_s92+_r203*N[2],_e283=0;_e283<l.outWidth;++_e283)for(var _n134=_t211+_e283*l.outChannels,_r204=_e283*l.strideWidth-y,_e284=0;_e284<p;++_e284){var _t212=_r204+_e284*m;if(!(_t212<0||_t212>=l.inWidth))for(var _o123=_a175+_e284*T[2],_s93=_i65+_t212*l.inChannels,_u40=_o123,_e285=0;_e285<l.inChannels;++_e285){for(var _t213=k[_s93+_e285],_e286=0;_e286<l.outChannels;++_e286)I[_n134+_e286]+=_t213*w[_u40+_e286];_u40+=l.outChannels}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}},Gw={kernelName:"Conv3DBackpropFilterV2",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.pad,u=r.filterShape;vc([a,o],"conv3dBackpropFilterV2");for(var l=Ot(a.shape),c=Ot(o.shape),d=Fa(a.shape,u,s,1,i),p=d.strideDepth,f=d.strideHeight,h=d.strideWidth,m=d.filterDepth,g=d.filterHeight,b=d.filterWidth,y=new yn(d.filterShape,"float32"),x=y.values,_y$strides=_slicedToArray(y.strides,4),v=_y$strides[0],k=_y$strides[1],w=_y$strides[2],I=_y$strides[3],N=n.data.get(o.dataId).values,_c15=_slicedToArray(c,4),T=_c15[0],C=_c15[1],E=_c15[2],S=_c15[3],_=n.data.get(a.dataId).values,_l18=_slicedToArray(l,4),$=_l18[0],R=_l18[1],A=_l18[2],F=_l18[3],O=d.padInfo.front,M=d.padInfo.left,D=d.padInfo.top,_e287=0;_e287<m;++_e287)for(var _t214=Math.max(0,Math.ceil((O-_e287)/p)),_n135=Math.min(d.outDepth,(d.inDepth+O-_e287)/p),_r205=_e287*v,_a176=0;_a176<g;++_a176)for(var _o124=Math.max(0,Math.ceil((D-_a176)/f)),_s94=Math.min(d.outHeight,(d.inHeight+D-_a176)/f),_i66=_a176*k+_r205,_r206=0;_r206<b;++_r206)for(var _u41=Math.max(0,Math.ceil((M-_r206)/h)),_l19=Math.min(d.outWidth,(d.inWidth+M-_r206)/h),_c16=_r206*w+_i66,_i67=0;_i67<d.inChannels;++_i67)for(var _m10=_i67*I+_c16,_c17=0;_c17<d.outChannels;++_c17){for(var _g8=0,_m11=0;_m11<d.batchSize;++_m11)for(var _d17=_m11*$,_b8=_m11*T,_m12=_t214;_m12<_n135;++_m12)for(var _t215=(_e287+_m12*p-O)*R+_d17,_n136=_m12*C+_b8,_e288=_o124;_e288<_s94;++_e288)for(var _o125=(_a176+_e288*f-D)*A+_t215,_s95=_e288*E+_n136,_e289=_u41;_e289<_l19;++_e289){var _t216=_e289*S+_s95;_g8+=_[(_r206+_e289*h-M)*F+_o125+_i67]*N[_t216+_c17]}x[_m10+_c17]=_g8}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},qw={kernelName:"Conv3DBackpropInputV2",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.pad,i=r.strides,u=r.inputShape;vc([a],"conv3dBackpropInputV2");for(var l=Ot(a.shape),c=Ot(o.shape),d=Fa(u,o.shape,i,1,s),p=new yn(d.inShape,"float32"),f=p.values,_p$strides=_slicedToArray(p.strides,4),h=_p$strides[0],m=_p$strides[1],g=_p$strides[2],b=_p$strides[3],y=n.data.get(a.dataId).values,_l20=_slicedToArray(l,4),x=_l20[0],v=_l20[1],k=_l20[2],w=_l20[3],I=n.data.get(o.dataId).values,_c18=_slicedToArray(c,4),N=_c18[0],T=_c18[1],C=_c18[2],E=_c18[3],S=d.batchSize,_=d.filterDepth,$=d.filterHeight,R=d.filterWidth,A=d.inChannels,F=d.inDepth,O=d.inHeight,M=d.inWidth,D=d.outChannels,P=d.outDepth,L=d.outHeight,B=d.outWidth,z=d.strideDepth,W=d.strideHeight,V=d.strideWidth,U=_-1-d.padInfo.front,H=$-1-d.padInfo.top,j=R-1-d.padInfo.left,_e290=0;_e290<S;++_e290)for(var _t217=0;_t217<A;++_t217)for(var _n137=0;_n137<F;++_n137)for(var _r207=_n137-U,_a177=Math.max(0,Math.ceil(_r207/z)),_o126=Math.min(P,(_+_r207)/z),_s96=0;_s96<O;++_s96)for(var _i68=_s96-H,_u42=Math.max(0,Math.ceil(_i68/W)),_l21=Math.min(L,($+_i68)/W),_c19=0;_c19<M;++_c19){for(var _d18=_c19-j,_p10=Math.max(0,Math.ceil(_d18/V)),_S3=Math.min(B,(R+_d18)/V),_A2=0,_n138=_a177;_n138<_o126;++_n138)for(var _a178=_n138*z-_r207,_r208=_u42;_r208<_l21;++_r208)for(var _o127=_r208*W-_i68,_s97=_p10;_s97<_S3;++_s97)for(var _i69=x*_e290+v*_n138+k*_r208+w*_s97,_u43=N*(_-1-_a178)+T*($-1-_o127)+C*(R-1-(_s97*V-_d18))+E*_t217,_e291=0;_e291<D;++_e291)_A2+=y[_i69+_e291]*I[_u43+_e291];f[h*_e290+m*_n137+g*_s96+b*_c19+_t217]=_A2}return n.makeTensorInfo(p.shape,p.dtype,p.values)}},Kw={kernelName:"Cos",backendName:"cpu",kernelFunc:Vc("Cos",(function(e){return Math.cos(e)}))},Xw={kernelName:"Cosh",backendName:"cpu",kernelFunc:Vc("Cosh",(function(e){return Math.cosh(e)}))},Yw={kernelName:"CropAndResize",backendName:"cpu",kernelFunc:function kernelFunc(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.boxes,s=t.boxInd,i=r.cropSize,u=r.method,l=r.extrapolationValue,_a$shape4=_slicedToArray(a.shape,4),c=_a$shape4[0],d=_a$shape4[1],p=_a$shape4[2],f=_a$shape4[3],h=o.shape[0],_i70=_slicedToArray(i,2),m=_i70[0],g=_i70[1],b=Cr([h,m,g,f],"float32"),y=n.data.get(o.dataId).values,x=n.data.get(s.dataId).values,v=n.data.get(a.dataId).values,k=Ot(a.shape),w=Ot(b.shape),_e292=0;_e292<h;_e292++){var _t218=4*_e292,_n139=y[_t218],_r209=y[_t218+1],_a179=y[_t218+2],_o128=y[_t218+3],_s98=x[_e292];if(!(_s98>=c))for(var _i71=m>1?(_a179-_n139)*(d-1)/(m-1):0,_h5=g>1?(_o128-_r209)*(p-1)/(g-1):0,_t219=0;_t219<m;_t219++){var _c20=m>1?_n139*(d-1)+_t219*_i71:.5*(_n139+_a179)*(d-1);if(_c20<0||_c20>d-1)for(var _n140=0;_n140<g;_n140++)for(var _r210=0;_r210<f;_r210++){var _a180=_r210+_n140*w[2]+_t219*w[1]+_e292*w[0];b.values[_a180]=l}else if("bilinear"===u)for(var _n141=Math.floor(_c20),_a181=Math.ceil(_c20),_i72=_c20-_n141,_u44=0;_u44<g;_u44++){var _c21=g>1?_r209*(p-1)+_u44*_h5:.5*(_r209+_o128)*(p-1);if(_c21<0||_c21>p-1)for(var _n142=0;_n142<f;_n142++){var _r211=_n142+_u44*w[2]+_t219*w[1]+_e292*w[0];b.values[_r211]=l}else for(var _d19=Math.floor(_c21),_m13=Math.ceil(_c21),_y8=_c21-_d19,_r212=0;_r212<f;_r212++){var _o129=_r212+_d19*k[2]+_n141*k[1]+_s98*k[0],_l22=v[_o129],_c22=v[_o129=_r212+_m13*k[2]+_n141*k[1]+_s98*k[0]],_p11=v[_o129=_r212+_d19*k[2]+_a181*k[1]+_s98*k[0]],_f9=_l22+(_c22-_l22)*_y8,_h6=_p11+(v[_o129=_r212+_m13*k[2]+_a181*k[1]+_s98*k[0]]-_p11)*_y8;_o129=_r212+_u44*w[2]+_t219*w[1]+_e292*w[0],b.values[_o129]=_f9+(_h6-_f9)*_i72}}else for(var _n143=0;_n143<g;++_n143){var _a182=g>1?_r209*(p-1)+_n143*_h5:.5*(_r209+_o128)*(p-1);if(_a182<0||_a182>p-1)for(var _r213=0;_r213<f;_r213++){var _a183=_r213+_n143*w[2]+_t219*w[1]+_e292*w[0];b.values[_a183]=l}else for(var _i73=Math.round(_a182),_u45=Math.round(_c20),_r214=0;_r214<f;_r214++){var _a184=_r214+_i73*k[2]+_u45*k[1]+_s98*k[0],_o130=_r214+_n143*w[2]+_t219*w[1]+_e292*w[0];b.values[_o130]=v[_a184]}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}},Qw={kernelName:"Cumsum",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.exclusive,i=r.reverse;vc(a,"cumsum");var u=Jo([o],a.shape.length),l=a;null!=u&&(l=wd({inputs:{x:a},backend:n,attrs:{perm:u}}));var c=ts(1,a.shape.length)[0];if(c!==l.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(l.shape.length-1," but got axis=").concat(c));for(var d=_n(l.dtype,"int32"),p=Lt(gt(l.shape),d),f=n.data.get(l.dataId).values,h=l.shape[l.shape.length-1],m=i?function(e,t){return e+h-t-1}:function(e,t){return e+t},_e293=0;_e293<f.length;_e293+=h)for(var _t220=0;_t220<h;_t220++){var _n144=m(_e293,_t220);if(0===_t220)p[_n144]=s?0:f[_n144];else{var _r215=m(_e293,_t220-1);p[_n144]=s?f[_r215]+p[_r215]:f[_n144]+p[_r215]}}var g=n.makeTensorInfo(l.shape,d,p);if(null!=u){var _e294=wd({inputs:{x:g},backend:n,attrs:{perm:es(u)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(l),_e294}return g}},Zw={kernelName:"DenseBincount",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.weights,s=r.size,i=r.binaryOutput;if(1===a.shape.length){var _e295=Bc(n.data.get(a.dataId).values,n.data.get(o.dataId).values,o.dtype,o.shape,s);return n.makeTensorInfo([s],o.dtype,_e295)}if(2===a.shape.length){var _e296=zc(n.bufferSync(a),n.bufferSync(o),s,i);return n.makeTensorInfo(_e296.shape,o.dtype,_e296.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},Jw={kernelName:"DepthToSpace",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockSize,s=r.dataFormat;pt("NHWC"===s,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(s)})),pt(o>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(o)}));for(var i=a.shape[0],u=a.shape[1],l=a.shape[2],c=a.shape[3],d=u*o,p=l*o,f=c/(o*o),h=n.data.get(a.dataId).values,m=new Float32Array(i*d*p*f),g=0,_e297=0;_e297<i;++_e297)for(var _t221=0;_t221<d;++_t221)for(var _n145=Math.floor(_t221/o),_r216=_t221%o,_t222=0;_t222<p;++_t222)for(var _a185=Math.floor(_t222/o),_s99=(_r216*o+_t222%o)*f,_t223=0;_t223<f;++_t223){var _r217=_t223+_s99+c*(_a185+l*(_n145+u*_e297));m[g++]=h[_r217]}return n.makeTensorInfo([i,d,p,f],a.dtype,m)}};function eI(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dilations,l=r.dimRoundingMode;vc([a,o],"depthwiseConv2DNative");var c=Ot(a.shape),d=Ot(o.shape),p=u;null==p&&(p=[1,1]),pt(za(s,p),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(p,"'")}));for(var f=Aa(a.shape,o.shape,s,p,i,l,!0),h=f.filterHeight,m=f.filterWidth,g=f.dilationHeight,b=f.dilationWidth,y=f.padInfo,x=y.left,v=y.top,k=f.outChannels/f.inChannels,w=new yn(f.outShape,a.dtype),I=n.data.get(a.dataId).values,N=n.data.get(o.dataId).values,T=w.values,_e298=0;_e298<f.batchSize;++_e298)for(var _t224=_e298*c[0],_n146=_e298*w.strides[0],_e299=0;_e299<f.outHeight;++_e299)for(var _r218=_n146+_e299*w.strides[1],_a186=_e299*f.strideHeight-x,_e300=0;_e300<h;++_e300){var _n147=_a186+_e300*g;if(!(_n147<0||_n147>=f.inHeight))for(var _o131=_e300*d[0],_s100=_t224+_n147*c[1],_e301=0;_e301<f.outWidth;++_e301)for(var _t225=_r218+_e301*w.strides[2],_n148=_e301*f.strideWidth-v,_e302=0;_e302<m;++_e302){var _r219=_n148+_e302*b;if(!(_r219<0||_r219>=f.inWidth))for(var _a187=_o131+_e302*d[1],_i74=_s100+_r219*f.inChannels,_u46=_t225,_l23=_a187,_e303=0;_e303<f.inChannels;++_e303){for(var _t226=I[_i74+_e303],_e304=0;_e304<k;++_e304)T[_u46+_e304]+=_t226*N[_l23+_e304];_u46+=k,_l23+=k}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var tI={kernelName:"DepthwiseConv2dNative",backendName:"cpu",kernelFunc:eI},nI={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.dilations,u=r.pad,l=r.dimRoundingMode,c=r.filterShape;vc([a,o],"depthwiseConv2dNativeBackpropFilter");for(var d=Aa(a.shape,c,s,i,u,l,!0),p=d.strideHeight,f=d.strideWidth,h=d.filterHeight,m=d.filterWidth,g=new yn(d.filterShape,"float32"),b=d.padInfo.left,y=d.padInfo.top,x=d.outChannels/d.inChannels,v=n.data.get(a.dataId).values,k=new yn(a.shape,a.dtype,v),w=n.data.get(o.dataId).values,I=new yn(o.shape,o.dtype,w),_e305=0;_e305<h;++_e305)for(var _t227=Math.max(0,Math.ceil((y-_e305)/p)),_n149=Math.min(d.outHeight,(d.inHeight+y-_e305)/p),_r220=0;_r220<m;++_r220)for(var _a188=Math.max(0,Math.ceil((b-_r220)/f)),_o132=Math.min(d.outWidth,(d.inWidth+b-_r220)/f),_s101=0;_s101<d.outChannels;++_s101){for(var _i75=Math.trunc(_s101/x),_u47=_s101%x,_l24=0,_u48=0;_u48<d.batchSize;++_u48)for(var _c23=_t227;_c23<_n149;++_c23)for(var _t228=_e305+_c23*p-y,_e306=_a188;_e306<_o132;++_e306){var _n150=_r220+_e306*f-b;_l24+=k.get(_u48,_t228,_n150,_i75)*I.get(_u48,_c23,_e306,_s101)}g.set(_l24,_e305,_r220,_i75,_u47)}return n.makeTensorInfo(g.shape,g.dtype,g.values)}},rI={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.strides,i=r.dilations,u=r.pad,l=r.dimRoundingMode,c=r.inputShape;vc([a,o],"depthwiseConv2DNativeBackpropInput");for(var d=Ot(a.shape),p=Ot(o.shape),f=Aa(c,o.shape,s,i,u,l,!0),h=new yn(f.inShape,"float32"),m=h.values,_h$strides=_slicedToArray(h.strides,3),g=_h$strides[0],b=_h$strides[1],y=_h$strides[2],x=n.data.get(a.dataId).values,_d20=_slicedToArray(d,3),v=_d20[0],k=_d20[1],w=_d20[2],I=n.data.get(o.dataId).values,_p12=_slicedToArray(p,3),N=_p12[0],T=_p12[1],C=_p12[2],E=f.batchSize,S=f.filterHeight,_=f.filterWidth,$=f.inChannels,R=f.inHeight,A=f.inWidth,F=f.outChannels,O=f.outHeight,M=f.outWidth,D=f.strideHeight,P=f.strideWidth,L=S-1-f.padInfo.top,B=_-1-f.padInfo.left,z=F/$,_e307=0;_e307<E;++_e307)for(var _t229=0;_t229<$;++_t229)for(var _n151=0;_n151<R;++_n151)for(var _r221=_n151-L,_a189=Math.max(0,Math.ceil(_r221/D)),_o133=Math.min(O,(S+_r221)/D),_s102=0;_s102<A;++_s102){for(var _i76=_s102-B,_u49=Math.max(0,Math.ceil(_i76/P)),_l25=Math.min(M,(_+_i76)/P),_c24=0,_n152=_a189;_n152<_o133;++_n152)for(var _a190=_n152*D-_r221,_r222=_u49;_r222<_l25;++_r222)for(var _o134=v*_e307+k*_n152+w*_r222,_s103=N*(S-1-_a190)+T*(_-1-(_r222*P-_i76))+C*_t229,_e308=0;_e308<z;++_e308)_c24+=x[_o134+(_t229*z+_e308)]*I[_s103+_e308];m[g*_e307+b*_n151+y*_s102+_t229]=_c24}return n.makeTensorInfo(h.shape,h.dtype,h.values)}},aI={kernelName:"Diag",backendName:"cpu",kernelFunc:function kernelFunc(e){for(var t=e.inputs,n=e.backend,r=t.x,a=gt(r.shape),o=n.data.get(r.dataId).values,s=Cr([a,a],r.dtype),i=s.values,_e309=0;_e309<o.length;_e309++)i[_e309*a+_e309]=o[_e309];var u=[].concat(_toConsumableArray(r.shape),_toConsumableArray(r.shape));return n.makeTensorInfo(u,s.dtype,s.values)}},oI={kernelName:"Dilation2D",backendName:"cpu",kernelFunc:function kernelFunc(_ref62){for(var e=_ref62.inputs,t=_ref62.backend,n=_ref62.attrs,r=e.x,a=e.filter,o=n.strides,s=n.pad,i=n.dilations,u=t,l=u.data.get(r.dataId).values,c=r.shape.length,d=u.data.get(a.dataId).values,p=a.shape.length,_a191=_a(r.shape,a.shape,o,s,"NHWC",i),f=_a191.batchSize,h=_a191.inHeight,m=_a191.inWidth,g=_a191.inChannels,b=_a191.outHeight,y=_a191.outWidth,x=_a191.padInfo,v=_a191.strideHeight,k=_a191.strideWidth,w=_a191.filterHeight,I=_a191.filterWidth,N=_a191.dilationHeight,T=_a191.dilationWidth,C=_a191.outShape,E=gt(C),S=C.length,_=Ct(r.dtype,E),_e310=0;_e310<f;++_e310)for(var _t230=0;_t230<b;++_t230)for(var _n153=_t230*v-x.top,_o135=0;_o135<y;++_o135)for(var _s104=_o135*k-x.left,_i77=0;_i77<g;++_i77){for(var _u50=Number.MIN_SAFE_INTEGER,_t231=0;_t231<w;++_t231){var _o136=_n153+_t231*N;if(_o136>=0&&_o136<h)for(var _n154=0;_n154<I;++_n154){var _f10=_s104+_n154*T;if(_f10>=0&&_f10<m){var _s105=Wt([_e310,_o136,_f10,_i77],c,Ot(r.shape)),_h7=Wt([_t231,_n154,_i77],p,Ot(a.shape)),_m14=l[_s105]+d[_h7];_m14>_u50&&(_u50=_m14)}}}_[Wt([_e310,_t230,_o135,_i77],S,Ot(C))]=_u50}return{dataId:u.write(on(_,r.dtype),C,r.dtype),shape:C,dtype:r.dtype}}},sI={kernelName:"Dilation2DBackpropFilter",backendName:"cpu",kernelFunc:function kernelFunc(_ref63){var e=_ref63.inputs,t=_ref63.backend,n=_ref63.attrs,r=e.x,a=e.filter,o=e.dy,s=n.strides,i=n.pad,u=n.dilations,l=t,c=Dt(r.shape,l.data.get(r.dataId).values),d=Dt(a.shape,l.data.get(a.dataId).values),_a192=_a(r.shape,a.shape,s,i,"NHWC",u),p=_a192.batchSize,f=_a192.inHeight,h=_a192.inWidth,m=_a192.inChannels,g=_a192.outHeight,b=_a192.outWidth,y=_a192.padInfo,x=_a192.strideHeight,v=_a192.strideWidth,k=_a192.filterHeight,w=_a192.filterWidth,I=_a192.dilationHeight,N=_a192.dilationWidth,T=_a192.outShape;pt(o.rank===T.length,(function(){return"Error in Dilation2DBackpropFilter, dy must have the same rank as output ".concat(T.length,", but got ").concat(o.rank)}));for(var C=Dt(T,l.data.get(o.dataId).values),E=Bt(a.shape,a.dtype),_e311=0;_e311<p;++_e311)for(var _t232=0;_t232<g;++_t232)for(var _n155=_t232*x-y.top,_r223=0;_r223<b;++_r223)for(var _a193=_r223*v-y.left,_o137=0;_o137<m;++_o137){for(var _s106=Number.MIN_SAFE_INTEGER,_i78=0,_u51=0,_t233=0;_t233<k;++_t233){var _r224=_n155+_t233*I;if(_r224>=0&&_r224<f)for(var _n156=0;_n156<w;++_n156){var _l26=_a193+_n156*N;if(_l26>=0&&_l26<h){var _a194=c[_e311][_r224][_l26][_o137]+d[_t233][_n156][_o137];_a194>_s106&&(_s106=_a194,_i78=_t233,_u51=_n156)}}}E[_i78][_u51][_o137]+=C[_e311][_t232][_r223][_o137]}return{dataId:l.write(on(E,r.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},iI={kernelName:"Dilation2DBackpropInput",backendName:"cpu",kernelFunc:function kernelFunc(_ref64){var e=_ref64.inputs,t=_ref64.backend,n=_ref64.attrs,r=e.x,a=e.filter,o=e.dy,s=n.strides,i=n.pad,u=n.dilations,l=t,c=Dt(r.shape,l.data.get(r.dataId).values),d=Dt(a.shape,l.data.get(a.dataId).values),_a195=_a(r.shape,a.shape,s,i,"NHWC",u),p=_a195.batchSize,f=_a195.inHeight,h=_a195.inWidth,m=_a195.inChannels,g=_a195.outHeight,b=_a195.outWidth,y=_a195.padInfo,x=_a195.strideHeight,v=_a195.strideWidth,k=_a195.filterHeight,w=_a195.filterWidth,I=_a195.dilationHeight,N=_a195.dilationWidth,T=_a195.outShape;pt(o.rank===T.length,(function(){return"Error in Dilation2DBackpropInput, dy must have the same rank as output ".concat(T.length,", but got ").concat(o.rank)}));for(var C=Dt(T,l.data.get(o.dataId).values),E=Bt(r.shape,r.dtype),_e312=0;_e312<p;++_e312)for(var _t234=0;_t234<g;++_t234)for(var _n157=_t234*x-y.top,_r225=0;_r225<b;++_r225)for(var _a196=_r225*v-y.left,_o138=0;_o138<m;++_o138){for(var _s107=Number.MIN_SAFE_INTEGER,_i79=_n157<0?0:_n157,_u52=_a196<0?0:_a196,_t235=0;_t235<k;++_t235){var _r226=_n157+_t235*I;if(_r226>=0&&_r226<f)for(var _n158=0;_n158<w;++_n158){var _l27=_a196+_n158*N;if(_l27>=0&&_l27<h){var _a197=c[_e312][_r226][_l27][_o138]+d[_t235][_n158][_o138];_a197>_s107&&(_s107=_a197,_i79=_r226,_u52=_l27)}}}E[_e312][_i79][_u52][_o138]+=C[_e312][_t234][_r225][_o138]}return{dataId:l.write(on(E,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},uI={kernelName:"EluGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;vc([r,a],"eluGrad");for(var o=new Float32Array(gt(a.shape)),s=n.data.get(a.dataId).values,i=n.data.get(r.dataId).values,_e313=0;_e313<s.length;++_e313){var _t236=s[_e313];o[_e313]=_t236>=1?i[_e313]:i[_e313]*(_t236+1)}return n.makeTensorInfo(a.shape,"float32",o)}},lI=Fc("Equal",Ic((function(e,t){return e===t?1:0})),null,"bool"),cI={kernelName:"Equal",backendName:"cpu",kernelFunc:lI},dI={kernelName:"Erf",backendName:"cpu",kernelFunc:Vc("Erf",(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+.3275911*n);return t*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))}))};function pI(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,o=r.dim,s=a.shape.length,i=a.shape.slice(),u=o;return o<0&&(pt(-(s+1)<=o,(function(){return"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")})),u=s+o+1),i.splice(u,0,1),uw({inputs:{x:a},backend:n,attrs:{shape:i}})}var fI={kernelName:"ExpandDims",backendName:"cpu",kernelFunc:pI},hI=Fc("RealDiv",Ic((function(e,t){return e/t}))),mI={kernelName:"RealDiv",backendName:"cpu",kernelFunc:hI};function gI(e,t,n){for(var r=e.shape,a=r[0],o=r[1],s=n.data.get(e.dataId),i=s.complexTensorInfos.real,u=s.complexTensorInfos.imag,l=[a,o],c=gt(l),d=Tt("float32",c),p=Tt("float32",c),_e314=0;_e314<a;_e314++){for(var _r227=$d({inputs:{x:i},backend:n,attrs:{begin:[_e314,0],size:[1,o]}}),_a198=$d({inputs:{x:u},backend:n,attrs:{begin:[_e314,0],size:[1,o]}}),_s108=Nc({inputs:{real:_r227,imag:_a198},backend:n}),_bI=bI(_s108,t,n),_f11=uu(_bI.real,_bI.imag),_t237=0;_t237<o;_t237++){var _n159=pu(_f11,_t237);d[_e314*o+_t237]=_n159.real,p[_e314*o+_t237]=_n159.imag}n.disposeIntermediateTensorInfo(_r227),n.disposeIntermediateTensorInfo(_a198),n.disposeIntermediateTensorInfo(_s108)}var f=n.makeTensorInfo(l,"float32",d),h=n.makeTensorInfo(l,"float32",p),m=Nc({inputs:{real:f,imag:h},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),m}function bI(e,t,n){var i,r=gt(e.shape),a=n.data.get(e.dataId),o=n.data.get(a.complexTensorInfos.real.dataId).values,s=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0==((i=r)&i-1)){var _a199=function yI(e,t,n,r,a){if(1===n)return{real:e,imag:t};var o=uu(e,t),s=n/2,i=cu(o),u=i.real,l=i.imag,c=[u.length],d=a.makeTensorInfo(c,"float32",u),p=a.makeTensorInfo(c,"float32",l),f=Nc({inputs:{real:d,imag:p},backend:a}),h=du(o),m=h.real,g=h.imag,b=[m.length],y=a.makeTensorInfo(b,"float32",m),x=a.makeTensorInfo(b,"float32",g),v=Nc({inputs:{real:y,imag:x},backend:a}),k=yI(u,l,s,r,a),w=k.real,I=k.imag,N=[w.length],T=a.makeTensorInfo(N,"float32",w),C=a.makeTensorInfo(N,"float32",I),E=Nc({inputs:{real:T,imag:C},backend:a}),S=yI(m,g,s,r,a),_=S.real,$=S.imag,R=[_.length],A=a.makeTensorInfo(R,"float32",_),F=a.makeTensorInfo(R,"float32",$),O=Nc({inputs:{real:A,imag:F},backend:a}),M=hu(n,r),D=[M.real.length],P=a.makeTensorInfo(D,"float32",M.real),L=a.makeTensorInfo(D,"float32",M.imag),B=Nc({inputs:{real:P,imag:L},backend:a}),z=md({inputs:{a:B,b:O},backend:a}),W=Pc({inputs:{a:E,b:z},backend:a}),V=Dd({inputs:{a:E,b:z},backend:a}),U=_c({inputs:{input:W},backend:a}),H=_c({inputs:{input:V},backend:a}),j=Pw({inputs:{input:W},backend:a}),G=Pw({inputs:{input:V},backend:a}),q=Bw({inputs:[U,H],backend:a,attrs:{axis:0}}),K=Bw({inputs:[j,G],backend:a,attrs:{axis:0}}),X=a.data.get(q.dataId).values,Y=a.data.get(K.dataId).values;return a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(v),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(A),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),{real:X,imag:Y}}(o,s,r,t,n),_i80=[e.shape[0],e.shape[1]];if(t){var _e315=n.makeTensorInfo(_i80,"float32",_a199.real),_t238=n.makeTensorInfo(_i80,"float32",_a199.imag),_o139=n.makeTensorInfo([],"float32",an(r,"float32")),_s109=Ec({inputs:{x:_o139},backend:n}),_u53=mI.kernelFunc({inputs:{a:_e315,b:_o139},backend:n}),_l29=mI.kernelFunc({inputs:{a:_t238,b:_s109},backend:n}),_c26=n.data.get(_u53.dataId).values,_d21=n.data.get(_l29.dataId).values;return n.disposeIntermediateTensorInfo(_e315),n.disposeIntermediateTensorInfo(_t238),n.disposeIntermediateTensorInfo(_o139),n.disposeIntermediateTensorInfo(_s109),n.disposeIntermediateTensorInfo(_u53),n.disposeIntermediateTensorInfo(_l29),{real:_c26,imag:_d21}}return _a199}return lu(function(e,t,n){for(var r=new Float32Array(2*t),_a200=0;_a200<t;_a200++){for(var _o140=0,_s110=0,_r228=0;_r228<t;_r228++){var _i81=mu(_a200*_r228,t,n),_u54=pu(e,_r228);_o140+=_u54.real*_i81.real-_u54.imag*_i81.imag,_s110+=_u54.real*_i81.imag+_u54.imag*_i81.real}n&&(_o140/=t,_s110/=t),fu(r,_o140,_s110,_a200)}return r}(uu(o,s),r,t))}var xI={kernelName:"FFT",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.input,a=gt(r.shape),o=r.shape[r.shape.length-1],s=uw({inputs:{x:r},backend:n,attrs:{shape:[a/o,o]}}),i=gI(s,!1,n),u=uw({inputs:{x:i},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),u}};function vI(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,s=n.dtype||Rt(a),i=Ct(s,gt(r));return function(e,t,n){e.fill(t)}(i,a),t.makeTensorInfo(r,s,i)}var kI={kernelName:"Fill",backendName:"cpu",kernelFunc:vI},wI={kernelName:"FlipLeftRight",backendName:"cpu",kernelFunc:function kernelFunc(_ref65){for(var e=_ref65.inputs,n=(_ref65.attrs,_ref65.backend),r=e.image,a=n,o=Tt(r.dtype,gt(r.shape)),_r$shape2=_slicedToArray(r.shape,4),s=_r$shape2[0],i=_r$shape2[1],u=_r$shape2[2],l=_r$shape2[3],c=a.data.get(r.dataId).values,_e316=0;_e316<s;_e316++)for(var _t239=_e316*u*i*l,_e317=0;_e317<i;_e317++)for(var _n160=_e317*(u*l),_r229=0;_r229<u;_r229++)for(var _a201=_r229*l,_i82=0;_i82<l;_i82++){var _d22=[s,_e317,_r229,_i82][2],_p13=Math.round(u-_d22),_f12=_t239+_n160+_a201+_i82,_h8=c[_f12];_p13>=0&&_p13<u&&(_h8=c[_t239+_n160+_p13*l+_i82]),o[_f12]=_h8}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},II={kernelName:"FloorDiv",backendName:"cpu",kernelFunc:Fc("FloorDiv",Ic((function(e,t){return Math.floor(e/t)})),null,"int32")},NI={kernelName:"FusedConv2D",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dataFormat,d=r.dilations,p=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=Ww({inputs:{x:a,filter:o},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:p}});if(s){var _e318=m;m=Pc({inputs:{a:m,b:s},backend:n}),n.disposeIntermediateTensorInfo(_e318)}if(f){var _e319=m;m=iw(n,m,f,i,h),n.disposeIntermediateTensorInfo(_e319)}return m}},TI={kernelName:"FusedDepthwiseConv2D",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dataFormat,d=r.dilations,p=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=eI({inputs:{x:a,filter:o},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:p}});if(s){var _e320=m;m=Pc({inputs:{a:m,b:s},backend:n}),n.disposeIntermediateTensorInfo(_e320)}if(f){var _e321=m;m=iw(n,m,f,i,h),n.disposeIntermediateTensorInfo(_e321)}return m}},CI={kernelName:"GatherNd",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,o=gt(r.shape),s=a.shape,i=s[s.length-1],_zr6=_slicedToArray(zr(r,a),4),u=_zr6[0],l=_zr6[1],c=_zr6[2],d=_zr6[3];if(0===l)return n.makeTensorInfo(u,r.dtype,[]);for(var p=Cr([l,c],r.dtype),f=n.data.get(a.dataId).values,h=n.data.get(r.dataId).values,_e322=0;_e322<l;_e322++){for(var _t240=[],_n161=0,_r230=0;_r230<i;_r230++){var _a202=f[_e322*i+_r230];_n161+=_a202*d[_r230],_t240.push(_a202)}if(_n161<0||_n161>=o/c)throw new Error("Invalid indices: ".concat(_t240," does not index into ").concat(r.shape));for(var _t241=0;_t241<c;_t241++)p.values[_e322*c+_t241]=h[_n161*c+_t241]}return n.makeTensorInfo(u,p.dtype,p.values)}},EI={kernelName:"GatherV2",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.indices,s=r.axis,i=r.batchDims;vc([a,o],"gatherV2");var u=i;null==i&&(u=0);var l=gt(o.shape),c=xu(a,o,It(s,a.shape)[0],u),d=uw({inputs:{x:a},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=uw({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}}),f=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize],h=n.bufferSync(p),m=ed(n.bufferSync(d),h,f);return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.makeTensorInfo(c.outputShape,m.dtype,m.values)}},SI={kernelName:"GreaterEqual",backendName:"cpu",kernelFunc:Fc("GreaterEqual",Ic((function(e,t){return e>=t?1:0})),null,"bool")},_I={kernelName:"IFFT",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.input,a=gt(r.shape),o=r.shape[r.shape.length-1],s=uw({inputs:{x:r},backend:n,attrs:{shape:[a/o,o]}}),i=gI(s,!0,n),u=uw({inputs:{x:i},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),u}},$I={kernelName:"IsFinite",backendName:"cpu",kernelFunc:Vc("IsFinite",(function(e){return Number.isFinite(e)?1:0}),"bool")},RI={kernelName:"IsInf",backendName:"cpu",kernelFunc:Vc("IsInf",(function(e){return Math.abs(e)===1/0?1:0}),"bool")},AI={kernelName:"IsNan",backendName:"cpu",kernelFunc:Vc("IsNan",(function(e){return Number.isNaN(e)?1:0}),"bool")},FI={kernelName:"LessEqual",backendName:"cpu",kernelFunc:Fc("LessEqual",Ic((function(e,t){return e<=t?1:0})),null,"bool")},OI={kernelName:"LinSpace",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.backend,n=e.attrs,s=od(n.start,n.stop,n.num);return t.makeTensorInfo([s.length],"float32",s)}},MI={kernelName:"Log1p",backendName:"cpu",kernelFunc:Vc("Log1p",(function(e){return Math.log1p(e)}))},DI={kernelName:"LogicalAnd",backendName:"cpu",kernelFunc:Fc("LogicalAnd",Ic((function(e,t){return e&&t})),null,"bool")},PI={kernelName:"LogicalNot",backendName:"cpu",kernelFunc:Vc("LogicalNot",(function(e){return e?0:1}),"bool")},LI={kernelName:"LogicalOr",backendName:"cpu",kernelFunc:Fc("LogicalOr",Ic((function(e,t){return e||t})),null,"bool")},BI={kernelName:"LRN",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.depthRadius,s=r.bias,i=r.alpha,u=r.beta;vc(a,"LRN");var l=a.shape[3],c=l-1,d=n.data.get(a.dataId).values,p=gt(a.shape),f=new Float32Array(p);function h(e){for(var t=e%l,n=e-t+Math.max(0,t-o),r=e-t+Math.min(t+o,c),a=0;n<=r;n++){var _e323=d[n];a+=_e323*_e323}return a}for(var _e324=0;_e324<p;_e324++){var _t242=h(_e324),_n162=d[_e324]*Math.pow(s+i*_t242,-u);f[_e324]=_n162}return n.makeTensorInfo(a.shape,a.dtype,f)}},zI={kernelName:"LRNGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.y,s=t.dy,i=r.depthRadius,u=r.bias,l=r.alpha,c=r.beta;vc(s,"LRNGrad");for(var d=gt(s.shape),p=s.shape[3],f=n.data.get(s.dataId).values,h=n.data.get(a.dataId).values,m=n.data.get(o.dataId).values,g=new Float32Array(d),b=d,_e325=0;_e325<b;_e325++){for(var _t243=_e325%p,_n163=_e325-_t243+Math.max(0,_t243-i),_r231=_e325-_t243+Math.min(p,_t243+i+1),_a203=0,_e326=_n163;_e326<_r231;_e326++)_a203+=Math.pow(h[_e326],2);_a203=l*_a203+u;for(var _t244=_n163;_t244<_r231;_t244++){var _n164=-2*l*c*h[_t244]*m[_e325]/_a203;_e325===_t244&&(_n164+=Math.pow(_a203,-c)),_n164*=f[_e325],g[_t244]+=_n164}}return n.makeTensorInfo(s.shape,a.dtype,g)}};function WI(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reductionIndices,s=r.keepDims,i=n,u=a.shape,l=u.length,c=It(o,u),d=c,p=Jo(d,l),f=i.data.get(a.dataId).values;if(null!=p){for(var _e327=new Array(l),_t245=0;_t245<_e327.length;_t245++)_e327[_t245]=u[p[_t245]];f=kd(f,u,a.dtype,p,_e327),d=ts(d.length,l),u=_e327}vc(a,"max"),Zo("max",d,l);var _Yo38=_slicedToArray(Yo(u,d),2),h=_Yo38[0],g=ud(f,gt(_Yo38[1]),h,a.dtype),b=i.write(g,h,a.dtype),y=h;return s&&(y=Qo(h,c)),{dataId:b,shape:y,dtype:a.dtype}}var VI={kernelName:"Max",backendName:"cpu",kernelFunc:WI},UI={kernelName:"MaxPool",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;vc(a,"maxPool");var o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode;pt(za(s,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var c,l=$a(a.shape,o,s,1,i,u);if(1===l.filterWidth&&1===l.filterHeight&&bt(l.inShape,l.outShape))c=Ec({inputs:{x:a},backend:n});else{var _e328=n.data.get(a.dataId).values,_t246=Ot(a.shape),_r232=Tw(_e328,a.shape,a.dtype,_t246,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,_r232.values)}return c}},HI={kernelName:"MaxPool3D",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode,l=r.dataFormat;vc(a,"maxPool3d");var c=Ra(a.shape,o,s,1,i,u,l),d=Ew(n.data.get(a.dataId).values,a.shape,a.dtype,Ot(a.shape),c,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}},jI={kernelName:"MaxPool3DGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,s=r.filterSize,i=r.strides,u=r.pad,l=r.dimRoundingMode;vc([a,o],"maxPool3DGrad");for(var c=Ra(o.shape,s,i,1,u,l),d=function(e,t){for(var n=Cr(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,o=t.strideWidth,s=t.dilationDepth,i=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=t.padInfo.front,f=t.padInfo.top,h=t.padInfo.left,_m15=0;_m15<t.batchSize;++_m15)for(var _g9=0;_g9<t.inChannels;++_g9)for(var _b9=0;_b9<t.outDepth;++_b9){for(var _y9=_b9*r-p,_x70=_y9;_x70<0;)_x70+=s;for(var _v7=Math.min(t.inDepth,l+_y9),_r233=0;_r233<t.outHeight;++_r233){for(var _l30=_r233*a-f,_p14=_l30;_p14<0;)_p14+=i;for(var _k7=Math.min(t.inHeight,c+_l30),_a204=0;_a204<t.outWidth;++_a204){for(var _f13=_a204*o-h,_w4=_f13;_w4<0;)_w4+=u;for(var _I4=Math.min(t.inWidth,d+_f13),_N3=Number.NEGATIVE_INFINITY,_T4=-1,_t247=_x70;_t247<_v7;_t247+=s)for(var _n165=_t247-_y9,_r234=_p14;_r234<_k7;_r234+=i)for(var _a205=_r234-_l30,_o141=_w4;_o141<_I4;_o141+=u){var _s111=_o141-_f13,_i83=e.get(_m15,_t247,_r234,_o141,_g9);_i83>=_N3&&(_N3=_i83,_T4=_n165*c*d+_a205*c+_s111)}n.set(_T4,_m15,_b9,_r233,_a204,_g9)}}}return n}(n.bufferSync(o),c),p=c.strideDepth,f=c.strideHeight,h=c.strideWidth,m=c.dilationDepth,g=c.dilationHeight,b=c.dilationWidth,y=c.effectiveFilterDepth,x=c.effectiveFilterHeight,v=c.effectiveFilterWidth,k=y-1-c.padInfo.front,w=v-1-c.padInfo.left,I=x-1-c.padInfo.top,N=Cr(o.shape,"float32"),T=n.bufferSync(a),_e329=0;_e329<c.batchSize;++_e329)for(var _t248=0;_t248<c.inChannels;++_t248)for(var _n166=0;_n166<c.inDepth;++_n166)for(var _r235=0;_r235<c.inHeight;++_r235)for(var _a206=0;_a206<c.inWidth;++_a206){for(var _o142=_n166-k,_s112=_r235-I,_i84=_a206-w,_u55=0,_n167=0;_n167<y;_n167+=m){var _r236=(_o142+_n167)/p;if(!(_r236<0||_r236>=c.outDepth||Math.floor(_r236)!==_r236))for(var _a207=0;_a207<x;_a207+=g){var _o143=(_s112+_a207)/f;if(!(_o143<0||_o143>=c.outHeight||Math.floor(_o143)!==_o143))for(var _s113=0;_s113<v;_s113+=b){var _l31=(_i84+_s113)/h;if(!(_l31<0||_l31>=c.outWidth||Math.floor(_l31)!==_l31)){var _p15=y*x*v-1-d.get(_e329,_r236,_o143,_l31,_t248)===_n167*x*v+_a207*v+_s113?1:0;0!==_p15&&(_u55+=T.get(_e329,_r236,_o143,_l31,_t248)*_p15)}}}}N.set(_u55,_e329,_n166,_r235,_a206,_t248)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}},GI={kernelName:"MaxPoolGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,i=o;vc([o,t.output],"maxPoolGrad");for(var u=r.filterSize,l=r.strides,c=r.pad,d=r.dimRoundingMode,p=$a(i.shape,u,l,1,c,d),f=n.data.get(i.dataId).values,h=Cr(p.outShape,i.dtype,Cw(f,i.shape,i.dtype,p).values),m=p.strideHeight,g=p.strideWidth,b=p.dilationHeight,y=p.dilationWidth,x=p.effectiveFilterHeight,v=p.effectiveFilterWidth,k=v-1-p.padInfo.left,w=x-1-p.padInfo.top,I=Cr(i.shape,"float32"),N=n.data.get(a.dataId).values,T=Cr(a.shape,"float32",N),_e330=0;_e330<p.batchSize;++_e330)for(var _t249=0;_t249<p.inChannels;++_t249)for(var _n168=0;_n168<p.inHeight;++_n168)for(var _r237=0;_r237<p.inWidth;++_r237){for(var _a208=_n168-w,_o144=_r237-k,_s114=0,_n169=0;_n169<x;_n169+=b){var _r238=(_a208+_n169)/m;if(!(_r238<0||_r238>=p.outHeight||Math.floor(_r238)!==_r238))for(var _a209=0;_a209<v;_a209+=y){var _i85=(_o144+_a209)/g;if(!(_i85<0||_i85>=p.outWidth||Math.floor(_i85)!==_i85)){var _u56=x*v-1-h.get(_e330,_r238,_i85,_t249)===_n169*v+_a209?1:0;0!==_u56&&(_s114+=T.get(_e330,_r238,_i85,_t249)*_u56)}}}I.set(_s114,_e330,_n168,_r237,_t249)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}},qI={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function kernelFunc(_ref66){var e=_ref66.inputs,t=_ref66.attrs,n=_ref66.backend,r=e.x,a=t.filterSize,o=t.strides,s=t.pad,i=t.includeBatchInIndex,u=n;vc(r,"MaxPoolWithArgmax");var l=u.data.get(r.dataId).values,c=$a(r.shape,a,o,[1,1],s),_ref68=_slicedToArray(function(e,t,n,r,a){var o=Tw(e,0,n,Ot(t),a,"max"),s=Cw(e,t,n,a,!0,r);return[o.values,s.values]}(l,r.shape,r.dtype,i,c),2),d=_ref68[0],p=_ref68[1],f=u.write(d,c.outShape,r.dtype),h=u.write(p,c.outShape,r.dtype);return[{dataId:f,shape:c.outShape,dtype:r.dtype},{dataId:h,shape:c.outShape,dtype:"int32"}]}};function KI(e){var i,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;vc(a,"sum");var u=(i="bool"===a.dtype?Rc({inputs:{x:a},backend:n,attrs:{dtype:"int32"}}):Ec({inputs:{x:a},backend:n})).shape.length,l=It(o,i.shape),c=Jo(l,u),d=l,p=i;null!=c&&(p=wd({inputs:{x:i},backend:n,attrs:{perm:c}}),d=ts(d.length,u)),Zo("sum",d,p.shape.length);for(var _Yo40=_slicedToArray(Yo(p.shape,d),2),f=_Yo40[0],h=_Yo40[1],m=Cc(n,f,_n(p.dtype,"int32")),g=gt(h),b=n.data.get(m.dataId).values,y=n.data.get(p.dataId).values,_e331=0;_e331<b.length;++_e331){for(var _t250=_e331*g,_n170=0,_e332=0;_e332<g;++_e332)_n170+=y[_t250+_e332];b[_e331]=_n170}if(s){var _e333=m;m=uw({inputs:{x:m},backend:n,attrs:{shape:Qo(m.shape,l)}}),n.disposeIntermediateTensorInfo(_e333)}return n.disposeIntermediateTensorInfo(i),null!=c&&n.disposeIntermediateTensorInfo(p),m}var XI={kernelName:"Sum",backendName:"cpu",kernelFunc:KI},YI={kernelName:"Mean",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,i=It(o,a.shape),u=gt(Yo(a.shape,i)[1]),l=[],c=n.makeTensorInfo([],"float32",new Float32Array([u]));l.push(c);var d=Rc({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});l.push(d);var p=hI({inputs:{a:d,b:c},backend:n});l.push(p);var f=KI({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:s}});return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),f}},QI={kernelName:"Min",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;vc(a,"min");var i=It(o,a.shape),u=i,l=Jo(u,a.shape.length),c=a;null!=l&&(c=wd({inputs:{x:a},backend:n,attrs:{perm:l}}),u=ts(u.length,a.shape.length)),Zo("min",u,c.shape.length);for(var _Yo42=_slicedToArray(Yo(c.shape,u),2),d=_Yo42[0],f=gt(_Yo42[1]),h=Lt(gt(d),c.dtype),m=n.data.get(c.dataId).values,_e334=0;_e334<h.length;++_e334){for(var _t251=_e334*f,_n171=m[_t251],_e335=0;_e335<f;++_e335){var _r239=m[_t251+_e335];_r239<_n171&&(_n171=_r239)}h[_e334]=_n171}null!=l&&n.disposeIntermediateTensorInfo(c);var g=n.makeTensorInfo(d,c.dtype,h);if(s){var _e336=uw({inputs:{x:g},backend:n,attrs:{shape:Qo(d,i)}});return n.disposeIntermediateTensorInfo(g),_e336}return g}},ZI={kernelName:"MirrorPad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.paddings,s=r.mode;vc(a,"mirrorPad");for(var i=o.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=o.map((function(e){return e[0]})),l=o.map((function(e,t){return e[0]+a.shape[t]})),c="reflect"===s?0:1,d=n.data.get(a.dataId).values,p=a.shape.length,f=Ot(a.shape),h=gt(i),m=i.length,g=Ot(i),b=Tt(a.dtype,h),_e337=0;_e337<h;_e337++){for(var _t252=Vt(_e337,m,g),_e338=0;_e338<m;_e338++)_t252[_e338]<u[_e338]?_t252[_e338]=2*u[_e338]-_t252[_e338]-c:_t252[_e338]>=l[_e338]&&(_t252[_e338]=2*(l[_e338]-1)-_t252[_e338]+c);var _n172=Wt(_t252=_t252.map((function(e,t){return e-u[t]})),p,f);b[_e337]=d[_n172]}return{dataId:n.write(b,i,a.dtype),shape:i,dtype:a.dtype}}},JI={kernelName:"Mod",backendName:"cpu",kernelFunc:Fc("Mod",Ic((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})))};function eN(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,o=r.dim,s=a.shape.length,i=o;if(-1===i&&(i=s-1),i!==s-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(s," and dim was ").concat(i));var u=It([i],a.shape),l=WI({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),c=Qo(l.shape,u),d=uw({inputs:{x:l},backend:n,attrs:{shape:c}}),p=Dd({inputs:{a:a,b:d},backend:n}),f=Kc({inputs:{x:p},backend:n}),h=KI({inputs:{x:f},backend:n,attrs:{axis:u,keepDims:!1}}),m=uw({inputs:{x:h},backend:n,attrs:{shape:c}}),g=hI({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),g}var tN={kernelName:"Softmax",backendName:"cpu",kernelFunc:eN},nN={kernelName:"Multinomial",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,o=r.numSamples,s=r.seed,i=r.normalized;vc(a,"multinomial");for(var u=i?a:eN({inputs:{logits:a},backend:n,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],d=n.data.get(u.dataId).values,p=[l,o],f=Lt(gt(p),"int32"),_e339=0;_e339<l;++_e339){var _t253=_e339*c,_n173=new Float32Array(c-1);_n173[0]=d[_t253];for(var _e340=1;_e340<_n173.length;++_e340)_n173[_e340]=_n173[_e340-1]+d[_t253+_e340];for(var _r240=Fs.alea(s.toString()),_a210=_e339*o,_e341=0;_e341<o;++_e341){var _t254=_r240();f[_a210+_e341]=_n173.length;for(var _r241=0;_r241<_n173.length;_r241++)if(_t254<_n173[_r241]){f[_a210+_e341]=_r241;break}}}return i||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(p,"int32",f)}},rN=Li,aN={kernelName:"NonMaxSuppressionV3",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold;vc(a,"NonMaxSuppression");var l=n.data.get(a.dataId).values,c=n.data.get(o.dataId).values,d=rN(l,c,s,i,u).selectedIndices;return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},oN=Bi,sN={kernelName:"NonMaxSuppressionV4",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold,l=r.padToMaxOutputSize;vc(a,"NonMaxSuppressionPadded");var c=n.data.get(a.dataId).values,d=n.data.get(o.dataId).values,_oN=oN(c,d,s,i,u,l),p=_oN.selectedIndices,f=_oN.validOutputs;return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},iN=zi,uN={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold,l=r.softNmsSigma;vc(a,"NonMaxSuppressionWithScore");var c=n.data.get(a.dataId).values,d=n.data.get(o.dataId).values,_iN=iN(c,d,s,i,u,l),g=_iN.selectedIndices,b=_iN.selectedScores;return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([b.length],"float32",new Float32Array(b))]}},lN={kernelName:"OneHot",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=r.depth,s=r.onValue,i=r.offValue;vc(a,"oneHot");var u=gt(a.shape),l=new Float32Array(u*o);l.fill(i);for(var c=n.data.get(a.dataId).values,_e342=0;_e342<u;++_e342)c[_e342]>=0&&c[_e342]<o&&(l[_e342*o+c[_e342]]=s);return n.makeTensorInfo([].concat(_toConsumableArray(a.shape),[o]),"int32",l)}};function cN(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var _e343=_c({inputs:{input:r},backend:n}),_t255=cN({inputs:{x:_e343},backend:n}),_a211=Pw({inputs:{input:r},backend:n}),_o145=cN({inputs:{x:_a211},backend:n}),_s115=Nc({inputs:{real:_t255,imag:_o145},backend:n});return n.disposeIntermediateTensorInfo(_e343),n.disposeIntermediateTensorInfo(_t255),n.disposeIntermediateTensorInfo(_a211),n.disposeIntermediateTensorInfo(_o145),_s115}return vI({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var dN={kernelName:"ZerosLike",backendName:"cpu",kernelFunc:cN},pN={kernelName:"OnesLike",backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var _t256=_c({inputs:{input:a},backend:r}),_n174=e({inputs:{x:_t256},backend:r}),_o146=Pw({inputs:{input:a},backend:r}),_s116=cN({inputs:{x:_o146},backend:r}),_i86=Nc({inputs:{real:_n174,imag:_s116},backend:r});return r.disposeIntermediateTensorInfo(_t256),r.disposeIntermediateTensorInfo(_n174),r.disposeIntermediateTensorInfo(_o146),r.disposeIntermediateTensorInfo(_s116),_i86}return vI({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function fN(e){var t=e.inputs,n=e.backend,a=e.attrs.axis;if(1===t.length)return pI({inputs:{input:t[0]},backend:n,attrs:{dim:a}});var o=t[0].shape,s=t[0].dtype;t.forEach((function(e){ft(o,e.shape,"All tensors passed to stack must have matching shapes"),pt(s===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=[],u=Bw({inputs:t.map((function(e){var t=pI({inputs:{input:e},backend:n,attrs:{dim:a}});return i.push(t),t})),backend:n,attrs:{axis:a}});return i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}var hN={kernelName:"Pack",backendName:"cpu",kernelFunc:fN},mN={kernelName:"PadV2",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.paddings,s=r.constantValue;vc(a,"pad");var i=o.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=o.map((function(e){return e[0]})),l=n.data.get(a.dataId).values,c=gt(a.shape),d=a.shape.length,p=Ot(a.shape),f=gt(i),h=i.length,m=Ot(i),g=Tt(a.dtype,f);0!==s&&g.fill(s);for(var _e344=0;_e344<c;_e344++)g[Wt(Vt(_e344,d,p).map((function(e,t){return e+u[t]})),h,m)]=l[_e344];return{dataId:n.write(g,i,a.dtype),shape:i,dtype:a.dtype}}},gN={kernelName:"Pow",backendName:"cpu",kernelFunc:Fc("Pow",Ic((function(e,t){return Math.pow(e,t)})))},bN={kernelName:"Range",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.dtype,i=Cd(r,a,n.step,o);return t.makeTensorInfo([i.length],o,i)}},yN={kernelName:"Reciprocal",backendName:"cpu",kernelFunc:Vc("Reciprocal",(function(e){return 1/e}))},xN={kernelName:"ResizeBilinear",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,i=r.size;vc(a,"resizeBilinear");for(var u=Ot(a.shape),_i87=_slicedToArray(i,2),l=_i87[0],c=_i87[1],_a$shape5=_slicedToArray(a.shape,4),d=_a$shape5[0],p=_a$shape5[1],f=_a$shape5[2],h=_a$shape5[3],m=n.data.get(a.dataId).values,g=new Float32Array(gt([d,l,c,h])),b=[o&&l>1?p-1:p,o&&c>1?f-1:f],y=[o&&l>1?l-1:l,o&&c>1?c-1:c],x=0,v=b[0]/y[0],k=b[1]/y[1],_e345=0;_e345<d;_e345++)for(var _t257=0;_t257<l;_t257++){var _n175;_n175=s?v*(_t257+.5)-.5:v*_t257;for(var _r242=Math.max(0,Math.floor(_n175)),_a212=_n175-_r242,_o147=Math.min(p-1,Math.ceil(_n175)),_i88=_e345*u[0]+_r242*u[1],_l32=_e345*u[0]+_o147*u[1],_e346=0;_e346<c;_e346++){var _t258;_t258=s?k*(_e346+.5)-.5:k*_e346;for(var _n176=Math.max(0,Math.floor(_t258)),_r243=_t258-_n176,_o148=Math.min(f-1,Math.ceil(_t258)),_c27=_i88+_n176*u[2],_d23=_l32+_n176*u[2],_p16=_i88+_o148*u[2],_b10=_l32+_o148*u[2],_e347=0;_e347<h;_e347++){var _t259=m[_c27+_e347],_n177=m[_d23+_e347],_o149=_t259+(m[_p16+_e347]-_t259)*_r243,_s117=_o149+(_n177+(m[_b10+_e347]-_n177)*_r243-_o149)*_a212;g[x++]=_s117}}}return n.makeTensorInfo([d,l,c,h],"float32",g)}},vN={kernelName:"ResizeBilinearGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,s=r.alignCorners;vc([o,a],"resizeBilinearGrad");for(var i=Ot(a.shape),_a$shape6=_slicedToArray(a.shape,4),u=_a$shape6[0],l=_a$shape6[1],c=_a$shape6[2],d=_a$shape6[3],_o$shape=_slicedToArray(o.shape,3),p=_o$shape[1],f=_o$shape[2],h=new Float32Array(u*l*c*d),m=[s&&p>1?l-1:l,s&&f>1?c-1:c],g=[s&&p>1?p-1:p,s&&f>1?f-1:f],b=m[0]/g[0],y=m[1]/g[1],x=n.data.get(o.dataId).values,v=0,_e348=0;_e348<u;_e348++)for(var _t260=_e348*i[0],_e349=0;_e349<p;_e349++)for(var _n178=_e349*b,_r244=Math.floor(_n178),_a213=Math.min(Math.ceil(_n178),l-1),_o150=_t260+_r244*i[1],_s118=_t260+_a213*i[1],_u57=_n178-_r244,_p17=1-_u57,_e350=0;_e350<f;_e350++)for(var _t261=_e350*y,_n179=Math.floor(_t261),_r245=Math.min(Math.ceil(_t261),c-1),_a214=_t261-_n179,_l33=1-_a214,_f14=_o150+_n179*i[2],_m16=_o150+_r245*i[2],_g10=_s118+_n179*i[2],_b11=_s118+_r245*i[2],_k8=_p17*_l33,_w5=_p17*_a214,_I5=_u57*_l33,_N4=_u57*_a214,_e351=0;_e351<d;_e351++){var _t262=x[v++];h[_f14+_e351]+=_t262*_k8,h[_m16+_e351]+=_t262*_w5,h[_g10+_e351]+=_t262*_I5,h[_b11+_e351]+=_t262*_N4}return n.makeTensorInfo([u,c,l,d],"float32",h)}},kN={kernelName:"ResizeNearestNeighbor",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,i=r.size;vc(a,"resizeNearestNeighbor");for(var u=Ot(a.shape),_i89=_slicedToArray(i,2),l=_i89[0],c=_i89[1],_a$shape7=_slicedToArray(a.shape,4),d=_a$shape7[0],p=_a$shape7[1],f=_a$shape7[2],h=_a$shape7[3],m=n.data.get(a.dataId).values,g=new Float32Array(d*l*c*h),b=[o&&l>1?p-1:p,o&&c>1?f-1:f],y=[o&&l>1?l-1:l,o&&c>1?c-1:c],x=b[0]/y[0],v=b[1]/y[1],k=0,_e352=0;_e352<d;_e352++)for(var _t263=_e352*u[0],_e353=0;_e353<l;_e353++){var _n180=s?x*(_e353+.5):x*_e353,_r246=Math.min(p-1,o?Math.round(_n180):Math.floor(_n180));s&&(_r246=Math.max(0,_r246));for(var _a215=_t263+_r246*u[1],_e354=0;_e354<c;_e354++){var _t264=s?v*(_e354+.5):v*_e354,_n181=Math.min(f-1,o?Math.round(_t264):Math.floor(_t264));s&&(_n181=Math.max(0,_n181));for(var _r247=_a215+_n181*u[2],_e355=0;_e355<h;_e355++){var _t265=m[_r247+_e355];g[k++]=_t265}}}return n.makeTensorInfo([d,l,c,h],a.dtype,g)}},wN={kernelName:"ResizeNearestNeighborGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,s=r.alignCorners;vc([o,a],"resizeNearestNeighborGrad");for(var i=Ot(a.shape),u=Ot(o.shape),_a$shape8=_slicedToArray(a.shape,4),l=_a$shape8[0],c=_a$shape8[1],d=_a$shape8[2],p=_a$shape8[3],_o$shape2=_slicedToArray(o.shape,3),f=_o$shape2[1],h=_o$shape2[2],m=new Float32Array(l*c*d*p),g=n.data.get(o.dataId).values,b=[s&&f>1?c-1:c,s&&h>1?d-1:d],y=[s&&f>1?f-1:f,s&&h>1?h-1:h],x=b[0]/y[0],v=b[1]/y[1],k=1/x,w=1/v,I=2*Math.ceil(k)+2,N=2*Math.ceil(w)+2,_e356=0;_e356<l;_e356++)for(var _t266=_e356*i[0],_e357=0;_e357<c;_e357++)for(var _n182=_t266+_e357*i[1],_r248=Math.floor(_e357*k),_a216=Math.floor(_r248-I/2),_r249=0;_r249<d;_r249++)for(var _o151=_n182+_r249*i[2],_l34=Math.floor(_r249*w),_b12=Math.floor(_l34-N/2),_n183=0;_n183<p;_n183++){for(var _i90=0,_o152=0;_o152<I;_o152++){var _l35=_o152+_a216;if(!(_l35<0||_l35>=f)){var _p18=_t266+_l35*u[1],_m17=_l35*x;if(_e357===Math.min(c-1,s?Math.round(_m17):Math.floor(_m17)))for(var _e358=0;_e358<N;_e358++){var _t267=_e358+_b12;if(!(_t267<0||_t267>=h)){var _a217=_p18+_t267*u[2],_o153=_t267*v;_r249===Math.min(d-1,s?Math.round(_o153):Math.floor(_o153))&&(_i90+=g[_a217+_n183])}}}}m[_o151+_n183]=_i90}return n.makeTensorInfo(a.shape,a.dtype,m)}},IN={kernelName:"Reverse",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.dims;vc(a,"reverse");var s=a.shape.length,i=It(o,a.shape);if(0===s)return Ec({inputs:{x:a},backend:n});for(var u=new yn(a.shape,a.dtype),l=n.bufferSync(a),_loop10=function _loop10(_e359){var t=u.indexToLoc(_e359),n=t.slice();i.forEach((function(e){return n[e]=a.shape[e]-1-n[e]})),u.set.apply(u,[l.get.apply(l,_toConsumableArray(n))].concat(_toConsumableArray(t)))},_e359=0;_e359<u.size;_e359++)_loop10(_e359);return n.makeTensorInfo(u.shape,u.dtype,u.values)}},NN={kernelName:"RotateWithOffset",backendName:"cpu",kernelFunc:function kernelFunc(_ref69){for(var e=_ref69.inputs,t=_ref69.attrs,n=_ref69.backend,r=e.image,a=t.radians,o=t.fillValue,s=t.center,i=n,u=Tt(r.dtype,gt(r.shape)),_r$shape3=_slicedToArray(r.shape,4),l=_r$shape3[0],c=_r$shape3[1],d=_r$shape3[2],p=_r$shape3[3],_tu6=_slicedToArray(tu(s,c,d),2),f=_tu6[0],h=_tu6[1],m=Math.sin(a),g=Math.cos(a),b=i.data.get(r.dataId).values,_e360=0;_e360<l;_e360++)for(var _t268=_e360*d*c*p,_e361=0;_e361<c;_e361++)for(var _n184=_e361*(d*p),_r250=0;_r250<d;_r250++)for(var _a218=_r250*p,_s119=0;_s119<p;_s119++){var _i91=[l,_e361,_r250,_s119],_y10=_i91[2],_x71=_i91[1],_v8=(_y10-f)*g-(_x71-h)*m,_k9=(_y10-f)*m+(_x71-h)*g;_v8=Math.round(_v8+f),_k9=Math.round(_k9+h);var _w6=o;"number"!=typeof o&&(_w6=3===_s119?255:o[_s119]),_v8>=0&&_v8<d&&_k9>=0&&_k9<c&&(_w6=b[_t268+_k9*(d*p)+_v8*p+_s119]),u[_t268+_n184+_a218+_s119]=_w6}return{dataId:i.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},TN={kernelName:"Round",backendName:"cpu",kernelFunc:Vc("Round",(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1}))};function CN(e,t,n,r,a,o,s,i,u,l){var c=[r/a,a],d=e.values,p=t.values;if(0===r)return Cr(n,t.dtype);var f=Cr(c,t.dtype);f.values.fill(u);for(var _e362=0;_e362<o;_e362++){for(var _o154=[],_u58=0,_t269=0;_t269<s;_t269++){var _n185=d[_e362*s+_t269];_o154.push(_n185),_u58+=_n185*i[_t269]}if(_u58<0||_u58>=r/a)throw new Error("Invalid indices: ".concat(_o154," does not index into ").concat(n));for(var _n186=0;_n186<a;_n186++)l?f.values[_u58*a+_n186]+=p[_e362*a+_n186]:f.values[_u58*a+_n186]=0===t.rank?p[0]:p[_e362*a+_n186]}return f}var EN={kernelName:"ScatterNd",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=t.updates,s=r.shape,_Ur4=Ur(0,a,s),i=_Ur4.sliceRank,u=_Ur4.numUpdates,l=_Ur4.sliceSize,c=_Ur4.strides,d=_Ur4.outputSize,p=CN(n.bufferSync(a),n.bufferSync(o),s,d,l,u,i,c,0,!0);return n.makeTensorInfo(s,p.dtype,p.values)}},SN={kernelName:"Select",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,o=t.e;vc([r,a,o],"select");for(var s=r.shape.length,i=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,l=n.data.get(o.dataId).values,c=_n(a.dtype,o.dtype),d=Lt(gt(a.shape),c),p=0,f=0===s||s>1||1===a.shape.length?1:gt(a.shape.slice(1)),_e363=0;_e363<i.length;_e363++)for(var _t270=0;_t270<f;_t270++)1===i[_e363]?d[p++]=u[_e363]:d[p++]=l[_e363];return n.makeTensorInfo(a.shape,c,d)}},_N={kernelName:"Selu",backendName:"cpu",kernelFunc:Vc("Selu",(function(e){return e>=0?1.0507009873554805*e:1.7580993408473768*(Math.exp(e)-1)}))},$N={kernelName:"Sigmoid",backendName:"cpu",kernelFunc:Vc("Sigmoid",(function(e){return 1/(1+Math.exp(-e))}))},RN={kernelName:"Sign",backendName:"cpu",kernelFunc:Vc("Sign",(function(e){return e<0?-1:e>0?1:0}))},AN={kernelName:"Sin",backendName:"cpu",kernelFunc:Vc("Sin",(function(e){return Math.sin(e)}))},FN={kernelName:"Sinh",backendName:"cpu",kernelFunc:Vc("Sinh",(function(e){return Math.sinh(e)}))},ON=Math.log(1.1920928955078125e-7)+2,MN={kernelName:"Softplus",backendName:"cpu",kernelFunc:Vc("Softplus",(function(e){var t=e>-ON,n=e<ON,r=Math.exp(e);return n?r:t?e:Math.log(1+r)}))},DN={kernelName:"SpaceToBatchND",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,s=r.paddings;vc([a],"spaceToBatchND");var i=gt(o),u=[[0,0]];u.push.apply(u,_toConsumableArray(s));for(var _e364=1+o.length;_e364<a.shape.length;++_e364)u.push([0,0]);var l=mN.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),c=nu(l.shape,o,i,!1),d=ru(c.length,o.length,!1),p=au(l.shape,o,i,!1),f=uw({inputs:{x:l},backend:n,attrs:{shape:c}}),h=wd({inputs:{x:f},backend:n,attrs:{perm:d}}),m=uw({inputs:{x:h},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),m}},PN={kernelName:"SparseToDense",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,o=t.sparseValues,s=t.defaultValue,i=r.outputShape,_Ur5=Ur(0,a,i),u=_Ur5.sliceRank,l=_Ur5.numUpdates,c=_Ur5.sliceSize,d=_Ur5.strides,p=_Ur5.outputSize,f=CN(n.bufferSync(a),n.bufferSync(o),i,p,c,l,u,d,n.data.get(s.dataId).values[0],!1);return n.makeTensorInfo(i,f.dtype,f.values)}},LN={kernelName:"SplitV",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.numOrSizeSplits,i=It(r.axis,a.shape)[0],u=gu(a,o,i),l=new Array(a.shape.length).fill(0),c=a.shape.slice();return u.map((function(e){var t=_toConsumableArray(c);t[i]=e;var r=$d({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[i]+=e,r}))}},BN={kernelName:"Sqrt",backendName:"cpu",kernelFunc:Vc("Sqrt",(function(e){return Math.sqrt(e)}))},zN={kernelName:"Square",backendName:"cpu",kernelFunc:function kernelFunc(_ref70){var e=_ref70.inputs,t=_ref70.backend,n=e.x,r=t;vc(n,"square");for(var a=r.data.get(n.dataId).values,o=new Float32Array(a.length),_e365=0;_e365<a.length;++_e365){var _t271=a[_e365];o[_e365]=_t271*_t271}return{dataId:r.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},WN={kernelName:"Step",backendName:"cpu",kernelFunc:Vc("Step",(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha}))},VN={kernelName:"StridedSlice",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.begin,s=r.end,i=r.strides,u=r.beginMask,l=r.endMask,c=r.ellipsisMask,d=r.newAxisMask,p=r.shrinkAxisMask;vc(a,"stridedSlice");var v,_oa2=oa(a.shape,o,s,i,u,l,c,d,p),f=_oa2.nonStrided,h=_oa2.$begin,m=_oa2.$strides,g=_oa2.size,b=_oa2.newShape,y=_oa2.outShape,x=uw({inputs:{x:a},backend:n,attrs:{shape:b}});if(f){var _e366=$d({inputs:{x:x},backend:n,attrs:{begin:h,size:g}});v=uw({inputs:{x:_e366},backend:n,attrs:{shape:y}}),n.disposeIntermediateTensorInfo(_e366)}else if(y.some((function(e){return 0===e})))v=n.makeTensorInfo(y,a.dtype,[]);else{var _e367=Od(y,n.bufferSync(x),m,h);v=n.makeTensorInfo(_e367.shape,_e367.dtype,_e367.values)}var k=uw({inputs:{x:v},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(v),k}},UN={kernelName:"Tan",backendName:"cpu",kernelFunc:Vc("Tan",(function(e){return Math.tan(e)}))},HN=Vc("Tanh",(function(e){return Math.tanh(e)}));function jN(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var _e368=2*t;n<_e368&&(n=_e368*Math.trunc(-n/_e368)+n),n=n<-t?n+_e368:-n-1}else if(n>t-1)if(t<=1)n=0;else{var _e369=2*t;(n-=_e369*Math.trunc(n/_e369))>=t&&(n=_e369-n-1)}return ct(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var _e370=t-1;n+=t*(Math.trunc(-n/_e370)+1)}else if(n>t-1)if(t<=1)n=0;else{var _e371=t-1;n-=t*Math.trunc(n/_e371)}return ct(0,n,t-1)}(e,t);case"nearest":return function(e,t){return ct(0,e,t-1)}(e,t);case"constant":default:return function(e,t){return e}(e)}}function GN(e,t,n,r,a,o,s,i,u,l,c){return 0<=i&&i<t&&0<=u&&u<n?e[s*r+i*a+u*o+l]:c}function qN(e,t,n,r,a,o,s,i,u,l,c){return GN(e,t,n,r,a,o,s,Math.round(i),Math.round(u),l,c)}function KN(e,t,n,r,a,o,s,i,u,l,c){var d=Math.floor(i),p=Math.floor(u),f=d+1,h=p+1;return(f-i)*((h-u)*GN(e,t,n,r,a,o,s,d,p,l,c)+(u-p)*GN(e,t,n,r,a,o,s,d,h,l,c))+(i-d)*((h-u)*GN(e,t,n,r,a,o,s,f,p,l,c)+(u-p)*GN(e,t,n,r,a,o,s,f,h,l,c))}for(var _i92=0,_XN=[pw,wc,fw,hw,Lc,mw,gw,bw,yw,xw,vw,kw,ww,Iw,Nw,Sw,_w,$w,Rw,dw,Aw,Fw,Ow,Ac,jc,Mw,Tc,Dw,zw,Uw,Hw,Vw,Gw,qw,jw,Kw,Xw,Yw,Qw,Zw,Jw,tI,nI,rI,aI,oI,iI,sI,mI,Qk,uI,cI,dI,Xc,fI,Qc,xI,kI,wI,Jc,II,NI,TI,CI,EI,nd,SI,Sc,_I,Lw,$I,RI,AI,Jk,ad,FI,OI,id,MI,DI,PI,LI,BI,zI,cd,UI,HI,jI,GI,qI,VI,YI,QI,pd,ZI,JI,nN,gd,yd,aN,sN,uN,vd,lN,pN,hN,mN,gN,nw,Td,bN,$c,yN,aw,sw,lw,xN,vN,kN,wN,IN,NN,TN,Sd,EN,SN,_N,$N,RN,AN,FN,Rd,tN,MN,DN,PN,LN,BN,zN,Fd,WN,VN,Pd,XI,UN,{kernelName:"Tanh",backendName:"cpu",kernelFunc:HN},{kernelName:"Tile",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reps;vc(a,"tile");var s=Ld(n.bufferSync(a),o);return n.makeTensorInfo(s.shape,s.dtype,s.values)}},{kernelName:"TopK",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.k;r.sorted;vc(a,"topk");var _Bd2=_slicedToArray(Bd(n.data.get(a.dataId).values,a.shape,a.dtype,o),2),u=_Bd2[0],l=_Bd2[1];return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}},Id,{kernelName:"Transform",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,o=t.transforms,s=n.interpolation,i=n.fillMode,u=n.fillValue,l=n.outputShape,_a$shape9=_slicedToArray(a.shape,4),c=_a$shape9[0],d=_a$shape9[1],p=_a$shape9[2],f=_a$shape9[3],_ref72=_slicedToArray(null!=l?l:[d,p],2),h=_ref72[0],m=_ref72[1],g=[c,h,m,f],b=Ot(a.shape),y=b[0],x=b[1],v=b[2],k=Tt(a.dtype,gt(g));k.fill(u);for(var w=r.data.get(a.dataId).values,I=r.data.get(o.dataId).values,_e372=0;_e372<c;++_e372){for(var _t272=1===o.shape[0]?I:I.subarray(8*_e372,8*_e372+8),_n187=0;_n187<h;++_n187)for(var _r251=0;_r251<m;++_r251)for(var _a219=0;_a219<f;++_a219){var _o155=void 0,_l36=_t272[6]*_r251+_t272[7]*_n187+1;if(0!==_l36){var _c28=(_t272[0]*_r251+_t272[1]*_n187+_t272[2])/_l36,_f15=(_t272[3]*_r251+_t272[4]*_n187+_t272[5])/_l36,_h9=jN(_c28,p,i),_m18=jN(_f15,d,i);switch(s){case"nearest":_o155=qN(w,d,p,y,x,v,_e372,_m18,_h9,_a219,u);break;case"bilinear":_o155=KN(w,d,p,y,x,v,_e372,_m18,_h9,_a219,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or 'bilinear', but got ".concat(s))}k[_e372*y+_n187*x+_r251*v+_a219]=_o155}}return r.makeTensorInfo(g,a.dtype,k)}return{dataId:r.write(k,g,a.dtype),shape:a.shape,dtype:a.dtype}}},{kernelName:"Unique",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,o=t.x;vc(o,"unique");var _zd=zd(r.data.get(o.dataId).values,a,o.shape,o.dtype),i=_zd.outputValues,u=_zd.outputShape,l=_zd.indices;return[r.makeTensorInfo(u,o.dtype,i),r.makeTensorInfo([l.length],"int32",l)]}},{kernelName:"Unpack",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,o=r.axis;o<0&&(o+=a.shape.length);for(var s=a.shape.length,i=a.shape[o],u=new Array(s-1),l=0,_e373=0;_e373<s;_e373++)_e373!==o&&(u[l++]=a.shape[_e373]);var c=new Array(s).fill(0),d=a.shape.slice();d[o]=1;for(var p=new Array(i),_e374=0;_e374<p.length;_e374++){c[o]=_e374;var _t273=$d({inputs:{x:a},backend:n,attrs:{begin:c,size:d}});p[_e374]=uw({inputs:{x:_t273},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(_t273)}return p}},{kernelName:"UnsortedSegmentSum",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.segmentIds,s=r.numSegments;vc(a,"unsortedSegmentSum");for(var i=[],u=[],l=a.shape.length-o.shape.length,c=o,_e375=0;_e375<l;++_e375){var _t274=pI({inputs:{input:c},backend:n,attrs:{dim:_e375+1}});c=_t274,u.push(_t274)}for(var _e376=0;_e376<s;++_e376){var _t275=an(_e376,"int32"),_r252=n.makeTensorInfo([],"int32",_t275),_o156=lI({inputs:{a:_r252,b:c},backend:n}),_s120=Rc({inputs:{x:_o156},backend:n,attrs:{dtype:"float32"}}),_l37=md({inputs:{a:_s120,b:a},backend:n}),_d24=KI({inputs:{x:_l37},backend:n,attrs:{axis:0,keepDims:!1}});i.push(_d24),u.push(_r252),u.push(_o156),u.push(_s120),u.push(_l37),u.push(_d24)}var d=fN({inputs:i,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),d}},dN];_i92<_XN.length;_i92++){nn(_XN[_i92])}var QN,YN=function YN(e,t,n){var r=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Me(n)&&(r="leading"in n?!!n.leading:r,a="trailing"in n?!!n.trailing:a),st(e,t,{leading:r,maxWait:t,trailing:a})},ZN=function ZN(e){if(!Me(e))return!1;var t=Xe(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},JN=Le["__core-js_shared__"],eT=(QN=/[^.]+$/.exec(JN&&JN.keys&&JN.keys.IE_PROTO||""))?"Symbol(src)_1."+QN:"",nT=Function.prototype.toString,aT=/^\[object .+?Constructor\]$/,oT=Function.prototype,sT=Object.prototype,iT=oT.toString,uT=sT.hasOwnProperty,lT=RegExp("^"+iT.call(uT).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),cT=function cT(e){return!(!Me(e)||function tT(e){return!!eT&&eT in e}(e))&&(ZN(e)?lT:aT).test(function rT(e){if(null!=e){try{return nT.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))},pT=function pT(e,t){var n=function dT(e,t){return null==e?void 0:e[t]}(e,t);return cT(n)?n:void 0},fT=function(){try{var e=pT(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),hT=function hT(e,t,n){"__proto__"==t&&fT?fT(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},mT=function mT(e,t){return e===t||e!=e&&t!=t},gT=Object.prototype.hasOwnProperty,bT=function bT(e,t,n){var r=e[t];gT.call(e,t)&&mT(r,n)&&(void 0!==n||t in e)||hT(e,t,n)},xT=function xT(e){return e},vT=function vT(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},kT=Math.max,IT=function IT(e){return function(){return e}},NT=fT?function(e,t){return fT(e,"toString",{configurable:!0,enumerable:!1,value:IT(t),writable:!0})}:xT,TT=Date.now,CT=function(e){var t=0,n=0;return function(){var r=TT(),a=16-(r-n);if(n=r,a>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(NT),ET=function ET(e,t){return CT(function wT(e,t,n){return t=kT(void 0===t?e.length-1:t,0),function(){for(var r=arguments,a=-1,o=kT(r.length-t,0),s=Array(o);++a<o;)s[a]=r[t+a];a=-1;for(var i=Array(t+1);++a<t;)i[a]=r[a];return i[t]=n(s),vT(e,this,i)}}(e,t,xT),e+"")},ST=function ST(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},_T=function _T(e){return null!=e&&ST(e.length)&&!ZN(e)},$T=/^(?:0|[1-9]\d*)$/,RT=function RT(e,t){var n=_typeof(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&$T.test(e))&&e>-1&&e%1==0&&e<t},AT=function AT(e,t,n){if(!Me(n))return!1;var r=_typeof(t);return!!("number"==r?_T(n)&&RT(t,n.length):"string"==r&&t in n)&&mT(n[t],e)},MT=function MT(e){return Ye(e)&&"[object Arguments]"==Xe(e)},DT=Object.prototype,PT=DT.hasOwnProperty,LT=DT.propertyIsEnumerable,BT=MT(function(){return arguments}())?MT:function(e){return Ye(e)&&PT.call(e,"callee")&&!LT.call(e,"callee")},zT=Array.isArray,WT=function WT(){return!1},VT=U((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,a=r&&r.exports===n?Le.Buffer:void 0,o=(a?a.isBuffer:void 0)||WT;e.exports=o})),UT={};UT["[object Float32Array]"]=UT["[object Float64Array]"]=UT["[object Int8Array]"]=UT["[object Int16Array]"]=UT["[object Int32Array]"]=UT["[object Uint8Array]"]=UT["[object Uint8ClampedArray]"]=UT["[object Uint16Array]"]=UT["[object Uint32Array]"]=!0,UT["[object Arguments]"]=UT["[object Array]"]=UT["[object ArrayBuffer]"]=UT["[object Boolean]"]=UT["[object DataView]"]=UT["[object Date]"]=UT["[object Error]"]=UT["[object Function]"]=UT["[object Map]"]=UT["[object Number]"]=UT["[object Object]"]=UT["[object RegExp]"]=UT["[object Set]"]=UT["[object String]"]=UT["[object WeakMap]"]=!1;var GT=U((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,a=r&&r.exports===n&&De.process,o=function(){try{return r&&r.require&&r.require("util").types||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=o})),qT=GT&&GT.isTypedArray,KT=qT?function jT(e){return function(t){return e(t)}}(qT):function HT(e){return Ye(e)&&ST(e.length)&&!!UT[Xe(e)]},XT=Object.prototype.hasOwnProperty,YT=function YT(e,t){var n=zT(e),r=!n&&BT(e),a=!n&&!r&&VT(e),o=!n&&!r&&!a&&KT(e),s=n||r||a||o,i=s?function OT(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],u=i.length;for(var l in e)!t&&!XT.call(e,l)||s&&("length"==l||a&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||RT(l,u))||i.push(l);return i},QT=Object.prototype,ZT=function ZT(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||QT)},eC=Object.prototype.hasOwnProperty,tC=function tC(e){if(!Me(e))return function JT(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=ZT(e),n=[];for(var r in e)("constructor"!=r||!t&&eC.call(e,r))&&n.push(r);return n},rC=function FT(e){return ET((function(t,n){var r=-1,a=n.length,o=a>1?n[a-1]:void 0,s=a>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(a--,o):void 0,s&&AT(n[0],n[1],s)&&(o=a<3?void 0:o,a=1),t=Object(t);++r<a;){var i=n[r];i&&e(t,i,r,o)}return t}))}((function(e,t,n,r){!function yT(e,t,n,r){var a=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var i=t[o],u=r?r(n[i],e[i],i,n,e):void 0;void 0===u&&(u=e[i]),a?hT(n,i,u):bT(n,i,u)}}(t,function nC(e){return _T(e)?YT(e,!0):tC(e)}(t),e,r)})),aC=function aC(e,t){return function(n){return e(t(n))}},oC=aC(Object.getPrototypeOf,Object),sC=Function.prototype,iC=Object.prototype,uC=sC.toString,lC=iC.hasOwnProperty,cC=uC.call(Object),pC=function pC(e){if(!Ye(e))return!1;var t=Xe(e);return"[object Error]"==t||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!function dC(e){if(!Ye(e)||"[object Object]"!=Xe(e))return!1;var t=oC(e);if(null===t)return!0;var n=lC.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&uC.call(n)==cC}(e)},fC=ET((function(e,t){try{return vT(e,void 0,t)}catch(e){return pC(e)?e:new Error(e)}})),hC=function hC(e,t){for(var n=-1,r=null==e?0:e.length,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a},gC=Object.prototype,bC=gC.hasOwnProperty,yC=function yC(e,t,n,r){return void 0===e||mT(e,gC[n])&&!bC.call(r,n)?t:e},xC={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},vC=function vC(e){return"\\"+xC[e]},kC=aC(Object.keys,Object),wC=Object.prototype.hasOwnProperty,NC=function NC(e){return _T(e)?YT(e):function IC(e){if(!ZT(e))return kC(e);var t=[];for(var n in Object(e))wC.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)},TC=/<%=([\s\S]+?)%>/g,CC=function(e){return function(t){return null==e?void 0:e[t]}}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),EC=ze?ze.prototype:void 0,SC=EC?EC.toString:void 0,$C=function $C(e){return null==e?"":function e(t){if("string"==typeof t)return t;if(zT(t))return hC(t,e)+"";if(Qe(t))return SC?SC.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}(e)},RC=/[&<>"']/g,AC=RegExp(RC.source),FC={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:TC,variable:"",imports:{_:{escape:function escape(e){return(e=$C(e))&&AC.test(e)?e.replace(RC,CC):e}}}},OC=/\b__p \+= '';/g,MC=/\b(__p \+=) '' \+/g,DC=/(__e\(.*?\)|\b__t\)) \+\n'';/g,PC=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,LC=/($^)/,BC=/['\n\r\u2028\u2029\\]/g,zC=Object.prototype.hasOwnProperty,WC=function WC(e,t,n){var r=FC.imports._.templateSettings||FC;n&&AT(e,t,n)&&(t=void 0),e=$C(e),t=rC({},t,r,yC);var a,o,s=rC({},t.imports,r.imports,yC),i=NC(s),u=function mC(e,t){return hC(t,(function(t){return e[t]}))}(s,i),l=0,c=t.interpolate||LC,d="__p += '",p=RegExp((t.escape||LC).source+"|"+c.source+"|"+(c===TC?PC:LC).source+"|"+(t.evaluate||LC).source+"|$","g"),f=zC.call(t,"sourceURL")?"//# sourceURL="+(t.sourceURL+"").replace(/\s/g," ")+"\n":"";e.replace(p,(function(t,n,r,s,i,u){return r||(r=s),d+=e.slice(l,u).replace(BC,vC),n&&(a=!0,d+="' +\n__e("+n+") +\n'"),i&&(o=!0,d+="';\n"+i+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=u+t.length,t})),d+="';\n";var h=zC.call(t,"variable")&&t.variable;h||(d="with (obj) {\n"+d+"\n}\n"),d=(o?d.replace(OC,""):d).replace(MC,"$1").replace(DC,"$1;"),d="function("+(h||"obj")+") {\n"+(h?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var m=fC((function(){return Function(i,f+"return "+d).apply(void 0,u)}));if(m.source=d,pC(m))throw m;return m},VC=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,UC=/^\w*$/,jC=pT(Object,"create"),KC=Object.prototype.hasOwnProperty,YC=Object.prototype.hasOwnProperty;function JC(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}JC.prototype.clear=function GC(){this.__data__=jC?jC(null):{},this.size=0},JC.prototype.delete=function qC(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},JC.prototype.get=function XC(e){var t=this.__data__;if(jC){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return KC.call(t,e)?t[e]:void 0},JC.prototype.has=function QC(e){var t=this.__data__;return jC?void 0!==t[e]:YC.call(t,e)},JC.prototype.set=function ZC(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=jC&&void 0===t?"__lodash_hash_undefined__":t,this};var eE=JC,nE=function nE(e,t){for(var n=e.length;n--;)if(mT(e[n][0],t))return n;return-1},rE=Array.prototype.splice;function uE(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}uE.prototype.clear=function tE(){this.__data__=[],this.size=0},uE.prototype.delete=function aE(e){var t=this.__data__,n=nE(t,e);return!(n<0||(n==t.length-1?t.pop():rE.call(t,n,1),--this.size,0))},uE.prototype.get=function oE(e){var t=this.__data__,n=nE(t,e);return n<0?void 0:t[n][1]},uE.prototype.has=function sE(e){return nE(this.__data__,e)>-1},uE.prototype.set=function iE(e,t){var n=this.__data__,r=nE(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};var lE=uE,cE=pT(Le,"Map"),fE=function fE(e,t){var n=e.__data__;return function pE(e){var t=_typeof(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map};function yE(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}yE.prototype.clear=function dE(){this.size=0,this.__data__={hash:new eE,map:new(cE||lE),string:new eE}},yE.prototype.delete=function hE(e){var t=fE(this,e).delete(e);return this.size-=t?1:0,t},yE.prototype.get=function mE(e){return fE(this,e).get(e)},yE.prototype.has=function gE(e){return fE(this,e).has(e)},yE.prototype.set=function bE(e,t){var n=fE(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var xE=yE;function vE(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,a=t?t.apply(this,r):r[0],o=n.cache;if(o.has(a))return o.get(a);var s=e.apply(this,r);return n.cache=o.set(a,s)||o,s};return n.cache=new(vE.Cache||xE),n}vE.Cache=xE;var t,n,wE=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,IE=/\\(\\)?/g,NE=(t=vE((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(wE,(function(e,n,r,a){t.push(r?a.replace(IE,"$1"):n||e)})),t}),(function(e){return 500===n.size&&n.clear(),e})),n=t.cache,t),TE=function TE(e,t){return zT(e)?e:function HC(e,t){if(zT(e))return!1;var n=_typeof(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Qe(e))||UC.test(e)||!VC.test(e)||null!=t&&e in Object(t)}(e,t)?[e]:NE($C(e))},CE=function CE(e){if("string"==typeof e||Qe(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},SE=function SE(e,t,n){var r=null==e?void 0:function EE(e,t){for(var n=0,r=(t=TE(t,e)).length;null!=e&&n<r;)e=e[CE(t[n++])];return n&&n==r?e:void 0}(e,t);return void 0===r?n:r},_E=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.Errors;function $E(e){var n=e.livenessSettings,r=e.apiClient,o=e.apiCheck,s=e.onError,i=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)({face_tracking_setting:{enable:!1,web_terminate_threshold:.0030152991993743408,web_warning_threshold:.0017317430600108828,limit_for:"all_flow",max_warning_time:5},flow_interval_time_ms:3e3,limit_time_liveness_check:{enable:!1,limit_time_second:45},terminate_if_no_face:{enable:!1,max_invalid_frame:5,max_time_ms:1e3}}),2),u=i[0],l=i[1];return Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){n?SE(n,"face_tracking_setting.web_terminate_threshold")?l(n):s(_E.client_web_setting_not_found):o&&r.clientSettings().then((function(e){if(e&&e.data){var t=SE(e,"data.settings.sdk_settings.active_liveness_settings.face_tracking_setting.enable"),n=SE(e,"data.settings.sdk_settings.active_liveness_settings.face_tracking_setting.web_terminate_threshold");if(t&&n){var r=SE(e,"data.settings.sdk_settings.active_liveness_settings");l(r)}t&&!n&&s(_E.client_web_setting_not_found)}e&&e.errors&&s(_E.server_error)})).catch((function(e){s(e)}))}),[n,r,s,o]),u}function RE(e){var t,n=e.canvas,r=e.resultsOutput,a=void 0===r?[]:r,o=n.captureStream(25);try{t=new MediaRecorder(o);var s=function s(){return new Promise((function(e,n){t.ondataavailable=function(t){return function(e,t,n,r){if(e.data.size>0){var a=new Blob([e.data],{type:"video/webm"});t.push({id:null,blob:a}),n()}else console.error("No video have recored!"),r()}(t,a,e,n)},"inactive"!==t.state&&t.stop()}))},i=function(){var e=$(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t.stopVideoRecording=i}catch(e){}return t||(t={start:function start(){},stop:function stop(){},pause:function pause(){},resume:function resume(){},requestData:function requestData(){},stopVideoRecording:function stopVideoRecording(){}}),{mediaRecorder:t}}var AE,FE=function FE(e){var t=e.curStep,n=e.faceDirection,r=SE(t,"stepTimeConstraints.delayTime");return!!r&&(null===t.firstFrameSpottedAt?(t.name===n&&(t.firstFrameSpottedAt=(new Date).getTime()),!0):(new Date).getTime()-t.firstFrameSpottedAt<r)},OE=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.g.faceTracker(),ME=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.Mode,DE=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection,PE=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.Errors,LE=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.Messages;function BE(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=i.apiCheck,l=i.mode,c=i.bgCameraMask,d=i.bgCameraMaskRed,p=i.surroundStyle,f=i.cropAreaDimension,h=i.customInstructions,b=i.customIcon,I=i.customDirectionIcon,N=i.customStepTimeConstraints,T=void 0===N?(A(e={},_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.UP,{delayTime:1e3}),A(e,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.LEFT,{delayTime:1e3}),A(e,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.RIGHT,{delayTime:1e3}),A(e,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.FRONTAL,{delayTime:2e3}),e):N,C=i.onLivenessDetectionDone,E=i.onError,_=i.frontalMinSize,R=i.enableRecording,F=void 0!==R&&R,O=i.waitingTimeToGetBetterFrames,D=void 0===O?500:O,B=i.captureFrameData,z=void 0!==B&&B,W=i.livenessSettings,V=i.setRemainingTime,U=void 0===V?function(){}:V,H=i.onApiCheck,G=i.customErrors,q=i.framesIntervalTime,K=void 0===q?180:q,X=Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(!1),Y=P(X,2),Q=Y[0],Z=Y[1],J=Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(),ee=P(J,2),te=ee[0],ne=ee[1],re=Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(!1),ae=P(re,2),oe=ae[0],se=ae[1],ie=Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(!1),ue=P(ie,2),le=ue[0],ce=ue[1],de=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),pe=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.m.useSDKSettings(),fe=pe.lang,he=pe.assetRoot,me=pe.apiClient,ge=l===ME.ACTIVE,be=Object(react__WEBPACK_IMPORTED_MODULE_126__.useReducer)((function(e){return e+1}),0),ye=P(be,2),xe=(ye[0],ye[1]),ve=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),ke=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(!1),we=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null);null===we.current&&(we.current=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.g.initFaceVerificationData({assetRoot:he,customInstructions:h,customIcon:b,customDirectionIcon:I,customStepTimeConstraints:T}));var Ie=Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(""),Ne=P(Ie,2),Te=Ne[0],Ce=Ne[1],Ee=Object(react__WEBPACK_IMPORTED_MODULE_126__.useMemo)((function(){return YN(Ce,500)}),[Ce]),Se=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)([]),_e=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(),$e=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)([]),Re=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(-1),Ae=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(),Fe=$E({livenessSettings:W,apiClient:me,apiCheck:u,onError:E}),Oe=Fe.face_tracking_setting,Me=Fe.flow_interval_time_ms,De=Fe.limit_time_liveness_check,Pe=Fe.terminate_if_no_face,Le=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(0),Be=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(),ze=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){U(""),we.current.curStepIndex=we.current.steps.length,se(!1),setTimeout((function(){we.current=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.g.initFaceVerificationData({assetRoot:he,customInstructions:h,customIcon:b,customDirectionIcon:I}),Ae.current=Date.now(),Le.current=0,Be.current=null,$e.current=[],Re.current=0,ce(!1),xe()}),Me)}),[he,h,b,I,Me,U]),We=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),Ve=Object(react__WEBPACK_IMPORTED_MODULE_126__.useMemo)((function(){return M(M({},PE),G)}),[G]);Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){if(Q&&De.enable&&le){Ae.current=Date.now();var e=De.limit_time_second+1;We.current=setInterval((function(){var t=Math.round((1e3*e-(Date.now()-Ae.current))/1e3);if(we.current.curStepIndex<we.current.steps.length){if(t<=10&&t>=1){var n=WC(LE.REMAIN_TIME[fe]);U(n({x:t}))}if(Math.round((Date.now()-Ae.current)/1e3)===e){var r=WC(Ve.liveness_terminated_time_out.msg[fe]);Ce({error:r({x:De.limit_time_second}),duration:Me}),ze()}}}),1e3)}return function(){clearInterval(We.current)}}),[ze,U,Q,fe,Me,De.enable,De.limit_time_second,le,Ve.liveness_terminated_time_out]);var Ue=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(e){var t,n,r=e.clientWidth,a=e.clientHeight,o=e.videoAreaWidth,s=e.videoAreaHeight,i=e.lostX,u=e.lostY;j.isMobile?n=t=o:t=n=s-200;var l=Math.floor((o-t)/2)+i,d=5+u,h=c;ve.current={x:l,y:d,width:t,height:n,image:h,surroundStyle:p},"object"===S(f)?ve.current=M(M({},ve.current),f):"function"==typeof f&&(ve.current=M(M({},ve.current),f({clientWidth:r,clientHeight:a,videoAreaWidth:o,videoAreaHeight:s,lostX:i,lostY:u,isMobile:j.isMobile,width:t,height:n}))),xe(),Z(!0)}),[c,p,f]),He=Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(3),je=P(He,2),Ge=je[0],qe=je[1],Ke=Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(!1),Xe=P(Ke,2),Ye=Xe[0],Qe=Xe[1],Ze=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(!1),Je=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(e){Qe(e),Ze.current=e}),[]),et=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),tt=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)([]),nt=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){qe(3),clearInterval(et.current),Je(!0),et.current=setInterval((function(){qe((function(e){if(e-1==0){clearInterval(et.current);var t=tt.current,n=Se.current.map((function(e){return e.blob}));if(u){var r=t.map((function(e){return me.uploadImage({file:e.blob,label:"portrait",metadata:JSON.stringify({gesture_score:e.leftRightScore,gesture:DE.FRONTAL})})})).concat(n.map((function(e){return me.uploadFile({file:e,label:"video"})})));Promise.all(r).then((function(e){var n=e.filter((function(e,n){return n<t.length})),r=e.filter((function(e,n){return n>=t.length}));return me.verifyFaceLiveness({images:n.map((function(e){return{id:e.data.image_id}})),videos:r.map((function(e){return{id:e.data.file_id}}))})})).then((function(e){C({apiCheckPassed:e.data.is_live,verifyFaceLivenessResult:e.data})})).catch((function(e){E({error:e})}))}else C({frontalFaces:t,videoRecord:n})}return e-1}))}),1e3)}),[Je,u,C,me,E]);Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){Te&&(clearInterval(et.current),Je(!1))}),[Te,Je]),Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){var e=!1;(function(){var t=$(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return qt.set("WASM_HAS_SIMD_SUPPORT",!1),qt.set("WASM_HAS_MULTITHREAD_SUPPORT",!1),t.prev=2,t.next=5,ca("wasm");case 5:t.next=25;break;case 7:return t.prev=7,t.t0=t.catch(2),t.prev=9,t.next=12,ca("webgl");case 12:t.next=25;break;case 14:return t.prev=14,t.t1=t.catch(9),t.prev=16,t.next=19,ca("cpu");case 19:t.next=25;break;case 21:t.prev=21,t.t2=t.catch(16),console.error(t.t2),e=!0;case 25:case"end":return t.stop()}}),t,null,[[2,7],[9,14],[16,21]])})));return function(){return t.apply(this,arguments)}})()().then($(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=5;break}Ce(Ve.unable_to_load_model.msg[fe]),E(Ve.unable_to_load_model),t.next=9;break;case 5:return t.next=7,Gl();case 7:n=t.sent,ne(n);case 9:case"end":return t.stop()}}),t)}))))}),[fe,E,Ve.unable_to_load_model]),Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){var e,t=de.current,n=function(){var e=$(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=we.current.steps,n=[],t.forEach((function(e){var t=e.name,r=e.image,a=e.frontalFaceImage;t!==DE.FRONTAL?n.push(me.uploadImage({file:r.blob,label:"portrait",metadata:JSON.stringify({gesture_score:r.leftRightScore,gesture:t})})):n.push(Promise.resolve({data:{image_id:null}})),a.blob?n.push(me.uploadImage({file:a.blob,label:"portrait",metadata:JSON.stringify({gesture_score:a.leftRightScore,gesture:DE.FRONTAL})})):n.push(Promise.resolve({data:{image_id:null}}))})),e.next=5,Promise.all(n);case 5:r=e.sent,t.forEach((function(e,t){e.image.imageId=r[2*t].data.image_id,e.frontalFaceImage.imageId=r[2*t+1].data.image_id}));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r=function(){var e=$(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:t=we.current.steps,0===(r=t.filter((function(e){return e.frontalFaceImage.imageId}))).length?C({error:"wrong_face_movement"}):me.verifyFaceLiveness({images:r.map((function(e){return{id:e.frontalFaceImage.imageId}})),gesture_images:t.filter((function(e){return e.image.imageId&&e.name!==DE.FRONTAL})).map((function(e){return{gesture:e.name,images:[{id:e.image.imageId}]}})),videos:[{frames:$e.current}],metadata:z?{sdk_logs:{tracking_frames:$e.current.map((function(e){return{index:e.index,landmarks:e.landmarks,original_landmarks:e.original_landmarks,score:e.score,time:e.time,bbox:e.bbox,original_bbox:e.original_bbox}}))}}:void 0}).then((function(e){var t=!0===e.data.is_live;C({apiCheckPassed:t,verifyFaceLivenessResult:e.data})})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),E({error:e.t0});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),a=function(){var e=$(regeneratorRuntime.mark((function e(){var t,n,a,o,s,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=we.current.steps,we.current.curStepIndex++,Oe.enable&&"each_gesture"===Oe.limit_for&&(Le.current=0),we.current.curStepIndex!==t.length){e.next=28;break}if(!F){e.next=7;break}return e.next=7,_e.current.stopVideoRecording();case 7:if(De.enable&&U(""),!C){e.next=28;break}if(u){e.next=25;break}if(o=t.filter((function(e){return e.name!==DE.FRONTAL})).map((function(e){return{name:e.name,image:{blob:e.image.blob}}})),s=t.filter((function(e){return e.name!==DE.FRONTAL})).map((function(e){return e.frontalFaceImage.blob})).filter((function(e){return null!==e})),!(i=null===(n=t.find((function(e){return e.name===DE.FRONTAL})))||void 0===n||null===(a=n.image)||void 0===a?void 0:a.blob)||!_){e.next=19;break}return e.next=16,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.i.scaleImage(i,{minSize:_});case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=null;case 20:l=e.t0,i&&s.push(i),C({steps:o,frontalFaces:s,videoRecord:[],frontalScaledImage:l,capturedFrames:$e.current}),e.next=28;break;case 25:return H(),e.next=28,r();case 28:xe();case 29:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),o=st((function(){var e=we.current,t=e.curStepIndex,n=e.steps,r=n[t],o=null!==(null==r?void 0:r.image.blob),s=null!==(null==r?void 0:r.frontalFaceImage.blob),i=n.filter((function(e){return e.frontalFaceImage.blob})).length,u=!1;return o&&(s||![1].includes(t)||i>=1)?(ke.current=!1,a(),u=!0):ke.current=!(!o||s),se(!1),u}),D);function s(e,t,n,r){return i.apply(this,arguments)}function i(){return(i=$(regeneratorRuntime.mark((function e(t,n,r,s){var i,u,l,c,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=we.current,u=i.curStepIndex,l=i.steps,!(u<l.length)){e.next=24;break}if(c=l[u],!FE({faceDirection:t,curStep:c})){e.next=5;break}return e.abrupt("return");case 5:if(t!==DE.FRONTAL||null!==c.frontalFaceImage.blurScore&&!_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.c.hasBetterBlurScore(r,c.frontalFaceImage.blurScore)){e.next=13;break}return c.frontalFaceImage.blurScore=r,e.next=9,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.d.takePicture({canvas:n});case 9:d=e.sent,c.frontalFaceImage.blob=d,c.frontalFaceImage.leftRightScore=s,ke.current&&(ke.current=!1,a());case 13:if(c.name!==t||null!==c.image.blurScore&&!_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.c.hasBetterBlurScore(r,c.image.blurScore)){e.next=24;break}return se(!0),c.image.blurScore=r,e.next=18,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.d.takePicture({canvas:n});case 18:p=e.sent,c.image.blob=p,c.image.leftRightScore=s,c.image.objUrl&&URL.revokeObjectURL(c.image.objUrl),c.image.objUrl=URL.createObjectURL(p),o();case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e,t,n){return p.apply(this,arguments)}function p(){return(p=$(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:!0===Ze.current&&t===DE.FRONTAL&&tt.current.length<3&&(_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.d.takePicture({canvas:n}).then((function(e){tt.current.push({blob:e,leftRightScore:r})})),2===tt.current.length&&F&&_e.current.stopVideoRecording());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e,t,n,r){if($e.current.length&&Date.now()-$e.current[$e.current.length-1].time<K)return null;if(Re.current++,z&&!r){var a=e.topLeft,o=e.bottomRight,s=[].concat(L(a),L(o)),i=[];[a,o].forEach((function(e){i=[].concat(L(i),[e[0]/_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.l.SIZE*t.width,e[1]/_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.l.SIZE*t.height])}));var u=OE(e,0===$e.current.length),l=u.score,c=u.time,d=t.toDataURL("image/jpeg",.8);return $e.current.push({label:"portrait",base64:d.split(",")[1],landmarks:n,original_landmarks:n.map((function(e){return[e[0]/_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.l.SIZE*t.width,e[1]/_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.l.SIZE*t.height]})),score:l,time:c,index:$e.current.length,bbox:s,original_bbox:i}),l}return null}function h(e){if(!Oe.enable||null===e||!le)return!0;var t=Oe.web_warning_threshold,n=Oe.web_terminate_threshold,r=Oe.max_warning_time;return e<t||(e<n&&Le.current<r?(Le.current++,Le.current===r?Ce({error:Ve.liveness_terminated_face_tracking.msg[fe],duration:Me}):Ce({error:Ve.liveness_too_fast.msg[fe],duration:1500}),!0):(Ce({error:Ve.liveness_terminated.msg[fe],duration:Me}),ze(),!1))}function m(e){if(Pe.enable&&le){var t=Pe.max_time_ms;Be.current&&e||(Be.current={time:Date.now(),frame:0}),e&&Be.current.frame++;var n=Be.current.time;e&&Date.now()-n>=t&&(Ce({error:Ve.liveness_terminated_no_face.msg[fe],duration:Me}),ze())}}function g(e,t){return b.apply(this,arguments)}function b(){return(b=$(regeneratorRuntime.mark((function n(r,a){var o,i,u,p,b,y,v,I,N,T,C,E,S,_,$,R,A,F,O,M,D;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=r.cropX,i=r.cropY,u=r.cropWidth,p=r.cropHeight,a.getContext("2d").drawImage(t,o,i,u,p,0,0,u,p),n.next=5,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.c.calculateBlurScore(a);case 5:return b=n.sent,n.next=8,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.l.getModelPredictions({model:te,sCanvas:a});case 8:return y=n.sent,n.next=11,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.g.validatePredictions({predictions:y,width:_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.l.SIZE,height:_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.l.SIZE});case 11:if(v=n.sent,I=v.error,N=v.fullFace,T="",ve.current.image=c,C=null,E=null,S=null,_=we.current,$=_.curStepIndex,R=_.steps,!N){n.next=27;break}return A=R[$],S=N.landmarks,n.next=25,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.g.calculateFaceDirection({landmarks:S,getPerfectFrontal:A&&A.name===DE.FRONTAL});case 25:(F=n.sent)&&(C=F.gesture,E=F.leftRightScore);case 27:if(O="no_face"===(null==I?void 0:I.code)||"partial_face"===(null==I?void 0:I.code),M=$<R.length,m(O&&M),I&&("face_too_small"!==I.code||![DE.DOWN,DE.UP,DE.LEFT,DE.RIGHT].includes(C))){n.next=43;break}if(!ge){n.next=39;break}if(le||ce(!0),!h(f(y[0],a,S,$>=R.length))){n.next=37;break}return n.next=37,s(C,a,b,E);case 37:n.next=41;break;case 39:return n.next=41,l(C,a,E);case 41:n.next=44;break;case 43:$<R.length&&(T=null===(D=Ve[I.code])||void 0===D?void 0:D.msg[fe],ve.current.image=d);case 44:Ee(T),-1!==e&&(e=requestAnimationFrame((function(){return g(r,a)})));case 46:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function I(){return(I=$(regeneratorRuntime.mark((function e(){var n,r,a,o,s,i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:te&&(n=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.d.analyzeVideoAndWindowSizes(t,ve.current),r=n.cropWidth,a=n.cropHeight,(o=document.createElement("canvas")).width=r,o.height=a,(s=o.getContext("2d")).translate(r,0),s.scale(-1,1),i=F?RE({canvas:o,resultsOutput:Se.current}):{},u=i.mediaRecorder,_e.current=u,_e.current&&_e.current.start(),g(n,o));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Q&&setTimeout((function(){!function(){I.apply(this,arguments)}()}),2e3),function(){cancelAnimationFrame(e),e=-1}}),[Q,fe,ge,me,u,c,d,C,E,F,_,D,z,H,Oe,De.enable,U,Ee,Me,ze,Pe,te,le,Ve,K]);var rt=we.current,at=rt.curStepIndex,ot=rt.steps,it=Object(react__WEBPACK_IMPORTED_MODULE_126__.useMemo)((function(){return ot.find((function(e){return e.name===_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.FRONTAL}))}),[ot]),ut=ke.current?it:ot[at],lt=ut&&le?ut.instructions[fe]:null,ct=ut&&le?ut.directionIcon:"",dt=ut?ut.directionIconAnimation:"";return{countdownToTakePicture:Ge,cropArea:ve,curStepIndex:at,directionIcon:ct,directionIconAnimation:dt,faceDetectionError:Te,handleTriggerPassiveMode:nt,handleVideoPlayed:Ue,instructions:lt,isActiveMode:ge,refVideo:de,showCountdown:Ye,steps:ot,videoPlayed:Q,activeCapturing:oe,isFirstValidFrameFound:le}}function zE(){var e=D(["\n  animation-delay: 1s;\n"]);return zE=function zE(){return e},e}function WE(){var e=D(["\n  animation-delay: 0.5s;\n"]);return WE=function WE(){return e},e}function VE(){var e=D(["\n  animation-delay: 0s;\n"]);return VE=function VE(){return e},e}function UE(){var e=D(["\n  display: flex;\n  margin: 4px 0;\n  width: 100%;\n  height: 15px;\n  animation: "," 1s infinite;\n  animation-direction: alternate;\n\n  &::before,\n  &::after {\n    content: '';\n    height: 100%;\n    width: 50%;\n    background: rgba(255, 255, 255, 0.8);\n  }\n\n  &::before {\n    transform: skewY(32deg);\n  }\n\n  &::after {\n    width: 50%;\n    transform: skewY(-32deg);\n  }\n"]);return UE=function UE(){return e},e}function HE(){var e=D(["\n  width: 70px;\n  transform: rotate(","deg);\n"]);return HE=function HE(){return e},e}function jE(){var e=D(["\n  width: 200px;\n  height: 200px;\n  position: relative;\n  transform: scale(0.48);\n\n  .top,\n  .right,\n  .bottom,\n  .left {\n    position: absolute;\n  }\n\n  .top {\n    top: 0;\n    left: 50%;\n    transform: rotate(","deg) translateX(-50%);\n  }\n\n  .right {\n    right: 0;\n    top: 50%;\n    transform: rotate(","deg) translateX(-50%);\n  }\n\n  .bottom {\n    bottom: 0;\n    left: 50%;\n    transform: rotate(","deg) translateX(50%);\n  }\n\n  .left {\n    left: 0;\n    top: 50%;\n    transform: rotate(","deg) translateX(50%);\n  }\n"]);return jE=function jE(){return e},e}!function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(wh)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)vh=e;else{kh=e;var _t276=yh.filter((function(e){return null==kh[e]}));if(_t276.length>0)throw new Error("There were no entries found for the following binaries: ".concat(_t276.join(","),". Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found."))}Ih=t}("//cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@".concat("3.3.0","/dist/"));var GE=(A(AE={},_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.LEFT,90),A(AE,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.RIGHT,270),A(AE,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.UP,180),A(AE,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.DOWN,0),AE),qE=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.d)(["0%{opacity:0.15;}50%{opacity:0.3;}100%{opacity:1;}"]),KE=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(jE(),GE[_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.DOWN],GE[_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.LEFT],GE[_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.UP],GE[_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.RIGHT]),XE=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(HE(),(function(e){var t,n=e.direction;return null!==(t=GE[n])&&void 0!==t?t:0})),YE=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.span(UE(),qE),QE=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(YE)(VE()),ZE=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(YE)(WE()),JE=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(YE)(zE());function eS(t){var n=t.type;return n!==_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.FRONTAL?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(XE,{direction:n},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(QE,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ZE,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(JE,null)):react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(KE,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(XE,{className:"top"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(QE,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ZE,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(JE,null)),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(XE,{className:"right"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(QE,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ZE,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(JE,null)),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(XE,{className:"bottom"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(QE,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ZE,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(JE,null)),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(XE,{className:"left"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(QE,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ZE,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(JE,null)))}eS.propTypes={type:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.oneOf([_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.LEFT,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.RIGHT,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.UP,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.FRONTAL])},eS.defaultProps={type:_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.LEFT};var tS=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.ErrorDuration;function nS(t){var r=t.children,a=t.className,o=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(0),s=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(""),i=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(tS.SHORT),u="",l=0;if("string"==typeof r)u=r;else{var c=r.error;l=r.duration,u=c}return Date.now()-o.current>=i.current?(o.current=Date.now(),s.current=u,i.current=l,u?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("div",{className:a},u):null):s.current?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("div",{className:a},s.current):null}function rS(){var e=D(["\n  transition: stroke-dashoffset 0.4s;\n  transform: rotate(-90deg);\n  transform-origin: 50% 50%;\n"]);return rS=function rS(){return e},e}nS.propTypes={children:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.node.isRequired,className:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string},nS.defaultProps={className:""};var aS,oS,sS=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.circle(rS());function iS(t){var n=t.className,r=t.style,a=t.radius,o=t.strokeWidth,s=t.progress,i=t.hasError,u=t.activeColor,l=t.innerPadding,c=t.outsideRingColor,d=t.outsideRingOpacity,p=t.insideRingColor,f=t.insideRingWidth,h=t.insideRingStrokeDash,m=t.errorRingWidth,g=t.errorRingColor,b=t.dashedRingColor,y=t.dashedRingOpacity,x=t.dashedRingWidth,v=t.dashedRingLineThick,k=t.dashedRingLineSpacing,w=t.dashedInsideRingColor,I=t.dashedInsideRingWidth,N=t.showOutsideRing,T=t.showInsideRing,C=t.showDashedRing,E=2*a,S=2*a,_=a-2*o,$=2*Math.PI*_,R=$-s/100*$,A=_-x/2-o/2-l,F=2*Math.PI*A,O=F-s/100*F,M=A-I/2-x/2,D=2*Math.PI*M,P=D-s/100*D,L=M-f/2-I/2,B=M-m/2-I/2;return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("svg",{className:n,style:r,width:E,height:S,viewBox:"0 0 ".concat(E," ").concat(S),fill:"none",xmlns:"http://www.w3.org/2000/svg"},N?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_126___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("circle",{opacity:d,cx:a,cy:a,r:_,stroke:c}),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(sS,{cx:a,cy:a,r:_,stroke:u,strokeWidth:o,strokeLinecap:"round",strokeDasharray:"".concat($," ").concat($),style:{strokeDashoffset:R}})):null,C?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_126___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("circle",{opacity:y,cx:a,cy:a,r:A,stroke:b,strokeWidth:x,strokeDasharray:"".concat(v," ").concat(k)}),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("mask",{id:"mask0","mask-type":"alpha",maskUnits:"userSpaceOnUse"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("circle",{cx:a,cy:a,r:A,stroke:u,strokeWidth:x,strokeDasharray:"".concat(v," ").concat(k)})),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("g",{mask:"url(#mask0)"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(sS,{cx:a,cy:a,r:A,stroke:u,strokeWidth:x,strokeDasharray:"".concat(F," ").concat(F),style:{strokeDashoffset:O}})),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("circle",{opacity:y,cx:a,cy:a,r:M,stroke:w,strokeWidth:I}),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(sS,{cx:a,cy:a,r:M,stroke:u,strokeWidth:I,strokeLinecap:"round",strokeDasharray:"".concat(D," ").concat(D),style:{strokeDashoffset:P}})):null,T?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("circle",{strokeDasharray:h,cx:a,cy:a,r:L,stroke:p,strokeWidth:f}):null,i?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("circle",{strokeDasharray:h,cx:a,cy:a,r:B,stroke:g,strokeWidth:m}):null)}function uS(t){var n=t.className;return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("svg",{className:n,width:"320",height:"320",viewBox:"0 0 320 320",fill:"none",xmlns:"http://www.w3.org/2000/svg"},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M320 0H0V320H320V0ZM160 296C235.111 296 296 235.111 296 160C296 84.8893 235.111 24 160 24C84.8893 24 24 84.8893 24 160C24 235.111 84.8893 296 160 296Z",fill:"currentColor"}))}function lS(){var e=D(["\n  position: absolute;\n  width: 100%;\n  top: 0;\n  bottom: 0;\n  z-index: -1;\n  background: rgba(255, 255, 255, 0.3);\n  animation: "," 1s infinite;\n  border-radius: 50%;\n"]);return lS=function lS(){return e},e}function cS(){var e=D(["\n  position: absolute;\n  z-index: -1;\n  background: rgba(223, 0, 0, 0.2);\n  border-radius: 50%;\n  width: 86%;\n  height: 86%;\n  top: 7%;\n  left: 7%;\n"]);return cS=function cS(){return e},e}function dS(){var e=D(["\n  width: 100%;\n  height: 100%;\n  vertical-align: middle;\n  margin: 0;\n  color: ",";\n"]);return dS=function dS(){return e},e}function pS(){var e=D(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n"]);return pS=function pS(){return e},e}function fS(){var e=D(["\n  position: absolute;\n  width: 100%;\n  top: 0;\n  bottom: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]);return fS=function fS(){return e},e}function hS(){var e=D(["\n  position: absolute;\n  width: 100%;\n  top: 0;\n  bottom: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: #ffffff;\n  font-size: 140px;\n  opacity: 0.6;\n"]);return hS=function hS(){return e},e}function mS(){var e=D(["\n  cursor: pointer;\n  text-align: center;\n  width: 50px;\n\n  img {\n    width: 100%;\n  }\n"]);return mS=function mS(){return e},e}function gS(){var e=D(["\n  color: #ffffff;\n  height: 70px;\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: ",";\n"]);return gS=function gS(){return e},e}function bS(){var e=D(["\n  width: ",";\n  height: ",";\n  border-radius: 50%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border: 2px solid #ffffff;\n  font-size: 16px;\n  color: #fff;\n  font-weight: 700;\n\n  & + & {\n    margin-left: 10px;\n  }\n\n  ","\n  img {\n    width: 100%;\n    margin: 0;\n    border-radius: 50%;\n  }\n"]);return bS=function bS(){return e},e}function yS(){var e=D(["\n  height: ",";\n  position: absolute;\n  ","\n  ","\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: ",";\n"]);return yS=function yS(){return e},e}function xS(){var e=D(["\n  position: absolute;\n  ","\n  ","\n  font-size: ",";\n  text-shadow: 2px 2px 4px #000000;\n"]);return xS=function xS(){return e},e}function vS(){var e=D(["\n  ","\n  font-size: 18px;\n  background: #ea3223;\n  color: #fff;\n  padding: 5px 10px;\n  border-radius: 3px;\n  position: absolute;\n  left: 50%;\n  transform: translate(-50%, 0);\n  white-space: nowrap;\n"]);return vS=function vS(){return e},e}function kS(){var e=D(["\n  ","\n  ","\n  ","\n  ","\n  font-size: 18px;\n  background: #ea3223;\n  color: #fff;\n  padding: 5px 10px;\n  border-radius: 3px;\n  position: absolute;\n  white-space: pre-wrap;\n  text-align: center;\n  max-width: 80%;\n"]);return kS=function kS(){return e},e}function wS(){var e=D(["\n  ","\n"]);return wS=function wS(){return e},e}iS.propTypes={className:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,style:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.shape({}),radius:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,strokeWidth:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,progress:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,hasError:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,activeColor:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,innerPadding:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,outsideRingColor:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,outsideRingOpacity:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,insideRingColor:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,insideRingWidth:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,insideRingStrokeDash:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,errorRingColor:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,errorRingWidth:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,dashedRingColor:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,dashedRingOpacity:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,dashedRingWidth:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,dashedRingLineThick:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,dashedRingLineSpacing:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,dashedInsideRingColor:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,dashedInsideRingWidth:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,showOutsideRing:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,showDashedRing:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,showInsideRing:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool},iS.defaultProps={className:"",style:null,radius:160,strokeWidth:3,progress:0,hasError:!1,activeColor:"#0092ff",innerPadding:5,outsideRingColor:"#f2f6f9",outsideRingOpacity:.1,insideRingColor:"#f2f6f9",insideRingWidth:3,insideRingStrokeDash:"0",errorRingColor:"#df0000",errorRingWidth:3,dashedRingColor:"#ffffff",dashedRingOpacity:.3,dashedRingWidth:10,dashedRingLineThick:1,dashedRingLineSpacing:6,dashedInsideRingColor:"#ffffff",dashedInsideRingWidth:0,showOutsideRing:!0,showDashedRing:!0,showInsideRing:!0},uS.propTypes={className:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string},uS.defaultProps={className:""};var IS=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)(["z-index:",";color:#ffffff;"],1020),NS=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(wS(),IS),TS=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(nS)(kS(),IS,(function(e){var t=e.top;return t&&Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)(["top:","px;"],t)}),(function(e){var t=e.bottom;return t&&Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)(["bottom:","px;"],t)}),(function(e){return e.centerY&&Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)(["top:50%;transform:translateY(-50%);"])})),CS=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(NS)(vS(),(function(e){var t=e.top;return t&&Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)(["top:","px;"],t)})),ES=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(NS)(xS(),(function(e){var t=e.top;return t&&Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)(["top:","px;"],t)}),(function(e){var t=e.bottom;return t&&Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)(["bottom:","px;"],t)}),(function(){return j.isMobile?"20px":"22px"})),SS=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(yS(),(function(){return j.isMobile?"50px":"70px"}),(function(e){var t=e.top;return t&&Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)(["top:","px;"],t)}),(function(e){var t=e.bottom;return t&&Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)(["bottom:","px;"],t)}),1020),_S=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(bS(),(function(){return j.isMobile?"40px":"50px"}),(function(){return j.isMobile?"40px":"50px"}),(function(e){return!e.active&&Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)(["opacity:0.6;"])})),$S=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(gS(),1020),RS=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(mS()),AS=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(hS()),FS=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(fS()),OS=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(iS)(pS()),MS=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(uS)(dS(),(function(e){var t=e.color;return null!=t?t:"rgba(0, 0, 0, 0.6)"})),DS=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(cS()),PS=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.d)(["from{opacity:1;}to{opacity:0;}"]),LS=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(lS(),PS),BS=j.isMobile?{width:640}:null,zS={background:"#000000",opacity:.6};function WS(n){var a=n.apiCheck,o=n.mode,s=n.onLivenessDetectionDone,i=n.onClose,u=n.onError,l=n.captureFrameData,c=n.frontCamera,d=n.customDirectionIcon,p=n.customStepTimeConstraints,f=n.onApiCheck,h=n.customErrors,m=n.framesIntervalTime,g=n.livenessSettings,y=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.a.useAsset("bg_camera_mask.png"),x=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.a.useAsset("bg_camera_mask_red.png"),v=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)({}),2),k=v[0],w=v[1],I=k.yFaceDetectionError,N=k.yFaceVerificationStepsWrapper,T=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(""),2),C=T[0],E=T[1],S=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(e){var t=e.lostY,n=e.height,r=t+25,a=r+30;return w({yFaceDetectionError:r,yFaceVerificationStepsWrapper:a+n+20}),{y:Math.floor(a)}}),[]),_=BE({apiCheck:a,mode:o,bgCameraMask:y,bgCameraMaskRed:x,surroundStyle:zS,onLivenessDetectionDone:s,onError:u,cropAreaDimension:S,customDirectionIcon:d,captureFrameData:l,livenessSettings:g,setRemainingTime:E,customStepTimeConstraints:p,onApiCheck:f,customErrors:h,framesIntervalTime:m}),$=_.countdownToTakePicture,R=_.cropArea,A=_.curStepIndex,F=_.directionIcon,O=_.faceDetectionError,M=_.handleTriggerPassiveMode,D=_.handleVideoPlayed,L=_.instructions,B=_.isActiveMode,z=_.refVideo,W=_.showCountdown,V=_.steps,U=_.videoPlayed,H=_.activeCapturing,j=_.isFirstValidFrameFound;return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Ne,{frontCamera:c,onVideoPlayed:D,onClose:i,flipHorizontal:c,ref:z,videoSettings:BS,onError:u},U?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_126___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(TS,{top:I-15,className:"face-detection-error"},O),R.current?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Fe,{x:"".concat(R.current.x,"px"),y:"".concat(R.current.y,"px"),width:"".concat(R.current.width,"px"),height:"".concat(R.current.height,"px"),surroundStyle:R.current.surroundStyle},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(MS,null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(OS,{progress:A/V.length*100,hasError:!!O,showDashedRing:!1,showOutsideRing:!1,insideRingWidth:1,errorRingWidth:1,insideRingStrokeDash:"2"}),W?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(AS,null,$):null,B?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_126___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(FS,null,F),H&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(LS,null)):null,O&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(DS,null)):null,B?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_126___default.a.Fragment,null,C&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(CS,{top:N-30},C),L?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ES,{top:N+5,className:"instructions"},L):null,j&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(SS,{top:N+35},V.map((function(t,n){var r=t.name,a=t.image.objUrl;return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(_S,{key:r,active:A>=n,className:"step-item"},a?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("img",{src:a,alt:""}):react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("span",null,n+1))})))):react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_126___default.a.Fragment,null,O?null:react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement($S,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(RS,{onClick:M},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Oe,null))))):null)}WS.propTypes={apiCheck:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,mode:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,onLivenessDetectionDone:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,onClose:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,onError:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,captureFrameData:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,frontCamera:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,customDirectionIcon:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.shape({}),customStepTimeConstraints:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.shape({}),onApiCheck:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,customErrors:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.shape({}),framesIntervalTime:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,livenessSettings:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.shape({})},WS.defaultProps={apiCheck:!1,mode:null,onLivenessDetectionDone:null,onClose:null,onError:function onError(){},captureFrameData:!1,frontCamera:!0,customDirectionIcon:(aS={},A(aS,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.LEFT,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(eS,{type:_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.LEFT})),A(aS,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.RIGHT,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(eS,{type:_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.RIGHT})),A(aS,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.UP,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(eS,{type:_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.UP})),A(aS,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.FRONTAL,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(eS,{type:_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.FRONTAL})),aS),customStepTimeConstraints:(oS={},A(oS,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.UP,{delayTime:1e3}),A(oS,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.LEFT,{delayTime:1e3}),A(oS,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.RIGHT,{delayTime:1e3}),A(oS,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.FaceDirection.FRONTAL,{delayTime:2e3}),oS),onApiCheck:function onApiCheck(){},customErrors:null,framesIntervalTime:180,livenessSettings:null};var VS=Object.freeze({__proto__:null,Text:NS,FaceDetectionError:TS,CountdownTime:CS,FaceVerificationInstructions:ES,FaceVerificationStepsWrapper:SS,StepItem:_S,BottomButtonsOverlay:$S,Button:RS,CountDownOverlay:AS,InstructionsOverlay:FS,default:WS,useLivenessDetection:BE});function US(){return(US=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function HS(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}function jS(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function GS(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}var qS=Object.getOwnPropertySymbols,KS=Object.prototype.hasOwnProperty,XS=Object.prototype.propertyIsEnumerable;function YS(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var QS=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,r,a=YS(e),o=1;o<arguments.length;o++){for(var s in n=Object(arguments[o]))KS.call(n,s)&&(a[s]=n[s]);if(qS){r=qS(n);for(var i=0;i<r.length;i++)XS.call(n,r[i])&&(a[r[i]]=n[r[i]])}}return a},ZS=U((function(e,t){var n,r,a,o,s;if("undefined"==typeof window||"function"!=typeof MessageChannel){var i=null,u=null,l=function l(){if(null!==i)try{var e=t.unstable_now();i(!0,e),i=null}catch(e){throw setTimeout(l,0),e}},c=Date.now();t.unstable_now=function(){return Date.now()-c},n=function(_n188){function n(_x72){return _n188.apply(this,arguments)}return n.toString=function(){return _n188.toString()},n}((function(e){null!==i?setTimeout(n,0,e):(i=e,setTimeout(l,0))})),r=function r(e,t){u=setTimeout(e,t)},a=function a(){clearTimeout(u)},o=function o(){return!1},s=t.unstable_forceFrameRate=function(){}}else{var d=window.performance,p=window.Date,f=window.setTimeout,h=window.clearTimeout;if("undefined"!=typeof console){var m=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"==_typeof(d)&&"function"==typeof d.now)t.unstable_now=function(){return d.now()};else{var g=p.now();t.unstable_now=function(){return p.now()-g}}var b=!1,y=null,x=-1,v=5,k=0;o=function o(){return t.unstable_now()>=k},s=function s(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):v=0<e?Math.floor(1e3/e):5};var w=new MessageChannel,I=w.port2;w.port1.onmessage=function(){if(null!==y){var e=t.unstable_now();k=e+v;try{y(!0,e)?I.postMessage(null):(b=!1,y=null)}catch(e){throw I.postMessage(null),e}}else b=!1},n=function n(e){y=e,b||(b=!0,I.postMessage(null))},r=function r(e,n){x=f((function(){e(t.unstable_now())}),n)},a=function a(){h(x),x=-1}}function N(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,a=e[r];if(!(void 0!==a&&0<E(a,t)))break e;e[r]=t,e[n]=a,n=r}}function T(e){return void 0===(e=e[0])?null:e}function C(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length;r<a;){var o=2*(r+1)-1,s=e[o],i=o+1,u=e[i];if(void 0!==s&&0>E(s,n))void 0!==u&&0>E(u,s)?(e[r]=u,e[i]=n,r=i):(e[r]=s,e[o]=n,r=o);else{if(!(void 0!==u&&0>E(u,n)))break e;e[r]=u,e[i]=n,r=i}}}return t}return null}function E(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var S=[],_=[],$=1,R=null,A=3,F=!1,O=!1,M=!1;function D(e){for(var t=T(_);null!==t;){if(null===t.callback)C(_);else{if(!(t.startTime<=e))break;C(_),t.sortIndex=t.expirationTime,N(S,t)}t=T(_)}}function P(e){if(M=!1,D(e),!O)if(null!==T(S))O=!0,n(L);else{var t=T(_);null!==t&&r(P,t.startTime-e)}}function L(e,n){O=!1,M&&(M=!1,a()),F=!0;var s=A;try{for(D(n),R=T(S);null!==R&&(!(R.expirationTime>n)||e&&!o());){var i=R.callback;if(null!==i){R.callback=null,A=R.priorityLevel;var u=i(R.expirationTime<=n);n=t.unstable_now(),"function"==typeof u?R.callback=u:R===T(S)&&C(S),D(n)}else C(S);R=T(S)}if(null!==R)var l=!0;else{var c=T(_);null!==c&&r(P,c.startTime-n),l=!1}return l}finally{R=null,A=s,F=!1}}function B(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var z=s;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){O||F||(O=!0,n(L))},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return T(S)},t.unstable_next=function(e){switch(A){case 1:case 2:case 3:var t=3;break;default:t=A}var n=A;A=t;try{return e()}finally{A=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=z,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=A;A=e;try{return t()}finally{A=n}},t.unstable_scheduleCallback=function(e,o,s){var i=t.unstable_now();if("object"==_typeof(s)&&null!==s){var u=s.delay;u="number"==typeof u&&0<u?i+u:i,s="number"==typeof s.timeout?s.timeout:B(e)}else s=B(e),u=i;return e={id:$++,callback:o,priorityLevel:e,startTime:u,expirationTime:s=u+s,sortIndex:-1},u>i?(e.sortIndex=u,N(_,e),null===T(S)&&e===T(_)&&(M?a():M=!0,r(P,u-i))):(e.sortIndex=s,N(S,e),O||F||(O=!0,n(L))),e},t.unstable_shouldYield=function(){var e=t.unstable_now();D(e);var n=T(S);return n!==R&&null!==R&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<R.expirationTime||o()},t.unstable_wrapCallback=function(e){var t=A;return function(){var n=A;A=t;try{return e.apply(this,arguments)}finally{A=n}}}})),JS=(U((function(e,t){})),U((function(e){e.exports=ZS})));function e_(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!react__WEBPACK_IMPORTED_MODULE_126___default.a)throw Error(e_(227));function t_(e,t,n,r,a,o,s,i,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(e){this.onError(e)}}var n_=!1,r_=null,a_=!1,o_=null,s_={onError:function onError(e){n_=!0,r_=e}};function i_(e,t,n,r,a,o,s,i,u){n_=!1,r_=null,t_.apply(s_,arguments)}var u_=null,l_=null,c_=null;function d_(e,t,n){var r=e.type||"unknown-event";e.currentTarget=c_(n),function(e,t,n,r,a,o,s,i,u){if(i_.apply(this,arguments),n_){if(!n_)throw Error(e_(198));var l=r_;n_=!1,r_=null,a_||(a_=!0,o_=l)}}(r,t,void 0,e),e.currentTarget=null}var p_=null,f_={};function h_(){if(p_)for(var e in f_){var t=f_[e],n=p_.indexOf(e);if(!(-1<n))throw Error(e_(96,e));if(!g_[n]){if(!t.extractEvents)throw Error(e_(97,e));for(var r in g_[n]=t,n=t.eventTypes){var a=void 0,o=n[r],s=t,i=r;if(b_.hasOwnProperty(i))throw Error(e_(99,i));b_[i]=o;var u=o.phasedRegistrationNames;if(u){for(a in u)u.hasOwnProperty(a)&&m_(u[a],s,i);a=!0}else o.registrationName?(m_(o.registrationName,s,i),a=!0):a=!1;if(!a)throw Error(e_(98,r,e))}}}}function m_(e,t,n){if(y_[e])throw Error(e_(100,e));y_[e]=t,x_[e]=t.eventTypes[n].dependencies}var g_=[],b_={},y_={},x_={};function v_(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(!f_.hasOwnProperty(t)||f_[t]!==r){if(f_[t])throw Error(e_(102,t));f_[t]=r,n=!0}}n&&h_()}var k_=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),w_=null,I_=null,N_=null;function T_(e){if(e=l_(e)){if("function"!=typeof w_)throw Error(e_(280));var t=e.stateNode;t&&(t=u_(t),w_(e.stateNode,e.type,t))}}function C_(e){I_?N_?N_.push(e):N_=[e]:I_=e}function E_(){if(I_){var e=I_,t=N_;if(N_=I_=null,T_(e),t)for(e=0;e<t.length;e++)T_(t[e])}}function S_(e,t){return e(t)}function __(e,t,n,r,a){return e(t,n,r,a)}function $_(){}var R_=S_,A_=!1,F_=!1;function O_(){null===I_&&null===N_||($_(),E_())}function M_(e,t,n){if(F_)return e(t,n);F_=!0;try{return R_(e,t,n)}finally{F_=!1,O_()}}var D_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,P_=Object.prototype.hasOwnProperty,L_={},B_={};function z_(e,t,n,r,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o}var W_={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){W_[e]=new z_(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];W_[t]=new z_(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){W_[e]=new z_(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){W_[e]=new z_(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){W_[e]=new z_(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){W_[e]=new z_(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){W_[e]=new z_(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){W_[e]=new z_(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){W_[e]=new z_(e,5,!1,e.toLowerCase(),null,!1)}));var V_=/[\-:]([a-z])/g;function U_(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(V_,U_);W_[t]=new z_(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(V_,U_);W_[t]=new z_(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(V_,U_);W_[t]=new z_(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){W_[e]=new z_(e,1,!1,e.toLowerCase(),null,!1)})),W_.xlinkHref=new z_("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){W_[e]=new z_(e,1,!1,e.toLowerCase(),null,!0)}));var H_=react__WEBPACK_IMPORTED_MODULE_126___default.a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function j_(e,t,n,r){var a=W_.hasOwnProperty(t)?W_[t]:null;(null!==a?0===a.type:!r&&2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]))||(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(_typeof(t)){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!P_.call(B_,e)||!P_.call(L_,e)&&(D_.test(e)?B_[e]=!0:(L_[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}H_.hasOwnProperty("ReactCurrentDispatcher")||(H_.ReactCurrentDispatcher={current:null}),H_.hasOwnProperty("ReactCurrentBatchConfig")||(H_.ReactCurrentBatchConfig={suspense:null});var G_=/^(.*)[\\\/]/,q_="function"==typeof Symbol&&Symbol.for,K_=q_?Symbol.for("react.element"):60103,X_=q_?Symbol.for("react.portal"):60106,Y_=q_?Symbol.for("react.fragment"):60107,Q_=q_?Symbol.for("react.strict_mode"):60108,Z_=q_?Symbol.for("react.profiler"):60114,J_=q_?Symbol.for("react.provider"):60109,e$=q_?Symbol.for("react.context"):60110,t$=q_?Symbol.for("react.concurrent_mode"):60111,n$=q_?Symbol.for("react.forward_ref"):60112,r$=q_?Symbol.for("react.suspense"):60113,a$=q_?Symbol.for("react.suspense_list"):60120,o$=q_?Symbol.for("react.memo"):60115,s$=q_?Symbol.for("react.lazy"):60116,i$=q_?Symbol.for("react.block"):60121,u$="function"==typeof Symbol&&Symbol.iterator;function l$(e){return null===e||"object"!=_typeof(e)?null:"function"==typeof(e=u$&&e[u$]||e["@@iterator"])?e:null}function c$(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case Y_:return"Fragment";case X_:return"Portal";case Z_:return"Profiler";case Q_:return"StrictMode";case r$:return"Suspense";case a$:return"SuspenseList"}if("object"==_typeof(e))switch(e.$$typeof){case e$:return"Context.Consumer";case J_:return"Context.Provider";case n$:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case o$:return c$(e.type);case i$:return c$(e.render);case s$:if(e=1===e._status?e._result:null)return c$(e)}return null}function d$(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=e._debugOwner,a=e._debugSource,o=c$(e.type);n=null,r&&(n=c$(r.type)),r=o,o="",a?o=" (at "+a.fileName.replace(G_,"")+":"+a.lineNumber+")":n&&(o=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+o}t+=n,e=e.return}while(e);return t}function p$(e){switch(_typeof(e)){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function f$(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function h$(e){e._valueTracker||(e._valueTracker=function(e){var t=f$(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var a=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function get(){return a.call(this)},set:function set(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function getValue(){return r},setValue:function setValue(e){r=""+e},stopTracking:function stopTracking(){e._valueTracker=null,delete e[t]}}}}(e))}function m$(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=f$(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function g$(e,t){var n=t.checked;return QS({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function b$(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=p$(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function y$(e,t){null!=(t=t.checked)&&j_(e,"checked",t,!1)}function x$(e,t){y$(e,t);var n=p$(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?k$(e,t.type,n):t.hasOwnProperty("defaultValue")&&k$(e,t.type,p$(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function v$(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function k$(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function w$(t,n){return t=QS({children:void 0},n),(n=function(t){var n="";return react__WEBPACK_IMPORTED_MODULE_126___default.a.Children.forEach(t,(function(e){null!=e&&(n+=e)})),n}(n.children))&&(t.children=n),t}function I$(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+p$(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function N$(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(e_(91));return QS({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function T$(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(e_(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(e_(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:p$(n)}}function C$(e,t){var n=p$(t.value),r=p$(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function E$(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function $$(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function R$(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?$$(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var A$,F$,O$=(F$=function F$(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((A$=A$||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=A$.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return F$(e,t)}))}:F$);function M$(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function D$(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var P$={animationend:D$("Animation","AnimationEnd"),animationiteration:D$("Animation","AnimationIteration"),animationstart:D$("Animation","AnimationStart"),transitionend:D$("Transition","TransitionEnd")},L$={},B$={};function z$(e){if(L$[e])return L$[e];if(!P$[e])return e;var t,n=P$[e];for(t in n)if(n.hasOwnProperty(t)&&t in B$)return L$[e]=n[t];return e}k_&&(B$=document.createElement("div").style,"AnimationEvent"in window||(delete P$.animationend.animation,delete P$.animationiteration.animation,delete P$.animationstart.animation),"TransitionEvent"in window||delete P$.transitionend.transition);var W$=z$("animationend"),V$=z$("animationiteration"),U$=z$("animationstart"),H$=z$("transitionend"),j$="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),G$=new("function"==typeof WeakMap?WeakMap:Map);function q$(e){var t=G$.get(e);return void 0===t&&(t=new Map,G$.set(e,t)),t}function K$(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function X$(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Y$(e){if(K$(e)!==e)throw Error(e_(188))}function Q$(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=K$(e)))throw Error(e_(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return Y$(a),e;if(o===r)return Y$(a),t;o=o.sibling}throw Error(e_(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,i=a.child;i;){if(i===n){s=!0,n=a,r=o;break}if(i===r){s=!0,r=a,n=o;break}i=i.sibling}if(!s){for(i=o.child;i;){if(i===n){s=!0,n=o,r=a;break}if(i===r){s=!0,r=o,n=a;break}i=i.sibling}if(!s)throw Error(e_(189))}}if(n.alternate!==r)throw Error(e_(190))}if(3!==n.tag)throw Error(e_(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function Z$(e,t){if(null==t)throw Error(e_(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function J$(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var eR=null;function tR(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)d_(e,t[r],n[r]);else t&&d_(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function nR(e){if(null!==e&&(eR=Z$(eR,e)),e=eR,eR=null,e){if(J$(e,tR),eR)throw Error(e_(95));if(a_)throw e=o_,a_=!1,o_=null,e}}function rR(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function aR(e){if(!k_)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}var oR=[];function sR(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>oR.length&&oR.push(e)}function iR(e,t,n,r){if(oR.length){var a=oR.pop();return a.topLevelType=e,a.eventSystemFlags=r,a.nativeEvent=t,a.targetInst=n,a}return{topLevelType:e,eventSystemFlags:r,nativeEvent:t,targetInst:n,ancestors:[]}}function uR(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r=n;if(3===r.tag)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=3!==r.tag?null:r.stateNode.containerInfo}if(!r)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=wA(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var a=rR(e.nativeEvent);r=e.topLevelType;var o=e.nativeEvent,s=e.eventSystemFlags;0===n&&(s|=64);for(var i=null,u=0;u<g_.length;u++){var l=g_[u];l&&(l=l.extractEvents(r,t,o,a,s))&&(i=Z$(i,l))}nR(i)}}function lR(e,t,n){if(!n.has(e)){switch(e){case"scroll":UR(t,"scroll",!0);break;case"focus":case"blur":UR(t,"focus",!0),UR(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":aR(e)&&UR(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===j$.indexOf(e)&&VR(e,t)}n.set(e,null)}}var cR,dR,pR,fR=!1,hR=[],mR=null,gR=null,bR=null,yR=new Map,xR=new Map,vR=[],kR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),wR="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function IR(e,t,n,r,a){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:a,container:r}}function NR(e,t){switch(e){case"focus":case"blur":mR=null;break;case"dragenter":case"dragleave":gR=null;break;case"mouseover":case"mouseout":bR=null;break;case"pointerover":case"pointerout":yR.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":xR.delete(t.pointerId)}}function TR(e,t,n,r,a,o){return null===e||e.nativeEvent!==o?(e=IR(t,n,r,a,o),null!==t&&null!==(t=IA(t))&&dR(t),e):(e.eventSystemFlags|=r,e)}function CR(e){var t=wA(e.target);if(null!==t){var n=K$(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=X$(n)))return e.blockedOn=t,void JS.unstable_runWithPriority(e.priority,(function(){pR(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function ER(e){if(null!==e.blockedOn)return!1;var t=qR(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var n=IA(t);return null!==n&&dR(n),e.blockedOn=t,!1}return!0}function SR(e,t,n){ER(e)&&n.delete(t)}function _R(){for(fR=!1;0<hR.length;){var e=hR[0];if(null!==e.blockedOn){null!==(e=IA(e.blockedOn))&&cR(e);break}var t=qR(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:hR.shift()}null!==mR&&ER(mR)&&(mR=null),null!==gR&&ER(gR)&&(gR=null),null!==bR&&ER(bR)&&(bR=null),yR.forEach(SR),xR.forEach(SR)}function $R(e,t){e.blockedOn===t&&(e.blockedOn=null,fR||(fR=!0,JS.unstable_scheduleCallback(JS.unstable_NormalPriority,_R)))}function RR(e){function t(t){return $R(t,e)}if(0<hR.length){$R(hR[0],e);for(var n=1;n<hR.length;n++){var r=hR[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==mR&&$R(mR,e),null!==gR&&$R(gR,e),null!==bR&&$R(bR,e),yR.forEach(t),xR.forEach(t),n=0;n<vR.length;n++)(r=vR[n]).blockedOn===e&&(r.blockedOn=null);for(;0<vR.length&&null===(n=vR[0]).blockedOn;)CR(n),null===n.blockedOn&&vR.shift()}var AR={},FR=new Map,OR=new Map,MR=["abort","abort",W$,"animationEnd",V$,"animationIteration",U$,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",H$,"transitionEnd","waiting","waiting"];function DR(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],a=e[n+1],o="on"+(a[0].toUpperCase()+a.slice(1));o={phasedRegistrationNames:{bubbled:o,captured:o+"Capture"},dependencies:[r],eventPriority:t},OR.set(r,t),FR.set(r,o),AR[a]=o}}DR("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),DR("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),DR(MR,2);for(var PR="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),LR=0;LR<PR.length;LR++)OR.set(PR[LR],0);var BR=JS.unstable_UserBlockingPriority,zR=JS.unstable_runWithPriority,WR=!0;function VR(e,t){UR(t,e,!1)}function UR(e,t,n){var r=OR.get(t);switch(void 0===r?2:r){case 0:r=HR.bind(null,t,1,e);break;case 1:r=jR.bind(null,t,1,e);break;default:r=GR.bind(null,t,1,e)}n?e.addEventListener(t,r,!0):e.addEventListener(t,r,!1)}function HR(e,t,n,r){A_||$_();var a=GR,o=A_;A_=!0;try{__(a,e,t,n,r)}finally{(A_=o)||O_()}}function jR(e,t,n,r){zR(BR,GR.bind(null,e,t,n,r))}function GR(e,t,n,r){if(WR)if(0<hR.length&&-1<kR.indexOf(e))e=IR(null,e,t,n,r),hR.push(e);else{var a=qR(e,t,n,r);if(null===a)NR(e,r);else if(-1<kR.indexOf(e))e=IR(a,e,t,n,r),hR.push(e);else if(!function(e,t,n,r,a){switch(t){case"focus":return mR=TR(mR,e,t,n,r,a),!0;case"dragenter":return gR=TR(gR,e,t,n,r,a),!0;case"mouseover":return bR=TR(bR,e,t,n,r,a),!0;case"pointerover":var o=a.pointerId;return yR.set(o,TR(yR.get(o)||null,e,t,n,r,a)),!0;case"gotpointercapture":return o=a.pointerId,xR.set(o,TR(xR.get(o)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r)){NR(e,r),e=iR(e,r,null,t);try{M_(uR,e)}finally{sR(e)}}}}function qR(e,t,n,r){if(null!==(n=wA(n=rR(r)))){var a=K$(n);if(null===a)n=null;else{var o=a.tag;if(13===o){if(null!==(n=X$(a)))return n;n=null}else if(3===o){if(a.stateNode.hydrate)return 3===a.tag?a.stateNode.containerInfo:null;n=null}else a!==n&&(n=null)}}e=iR(e,r,n,t);try{M_(uR,e)}finally{sR(e)}return null}var KR={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},XR=["Webkit","ms","Moz","O"];function YR(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||KR.hasOwnProperty(e)&&KR[e]?(""+t).trim():t+"px"}function QR(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=YR(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(KR).forEach((function(e){XR.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),KR[t]=KR[e]}))}));var ZR=QS({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function JR(e,t){if(t){if(ZR[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(e_(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(e_(60));if("object"!=_typeof(t.dangerouslySetInnerHTML)||!("__html"in t.dangerouslySetInnerHTML))throw Error(e_(61))}if(null!=t.style&&"object"!=_typeof(t.style))throw Error(e_(62,""))}}function eA(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tA="http://www.w3.org/1999/xhtml";function nA(e,t){var n=q$(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=x_[t];for(var r=0;r<t.length;r++)lR(t[r],e,n)}function rA(){}function aA(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function oA(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function sA(e,t){var n,r=oA(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=oA(r)}}function uA(){for(var e=window,t=aA();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=aA((e=t.contentWindow).document)}return t}function lA(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var cA=null,dA=null;function pA(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function fA(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==_typeof(t.dangerouslySetInnerHTML)&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var hA="function"==typeof setTimeout?setTimeout:void 0,mA="function"==typeof clearTimeout?clearTimeout:void 0;function gA(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function bA(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var yA=Math.random().toString(36).slice(2),xA="__reactInternalInstance$"+yA,vA="__reactEventHandlers$"+yA,kA="__reactContainere$"+yA;function wA(e){var t=e[xA];if(t)return t;for(var n=e.parentNode;n;){if(t=n[kA]||n[xA]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=bA(e);null!==e;){if(n=e[xA])return n;e=bA(e)}return t}n=(e=n).parentNode}return null}function IA(e){return!(e=e[xA]||e[kA])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function NA(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(e_(33))}function TA(e){return e[vA]||null}function CA(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function EA(e,t){var n=e.stateNode;if(!n)return null;var r=u_(n);if(!r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(e_(231,t,_typeof(n)));return n}function SA(e,t,n){(t=EA(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=Z$(n._dispatchListeners,t),n._dispatchInstances=Z$(n._dispatchInstances,e))}function _A(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=CA(t);for(t=n.length;0<t--;)SA(n[t],"captured",e);for(t=0;t<n.length;t++)SA(n[t],"bubbled",e)}}function $A(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=EA(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=Z$(n._dispatchListeners,t),n._dispatchInstances=Z$(n._dispatchInstances,e))}function RA(e){e&&e.dispatchConfig.registrationName&&$A(e._targetInst,null,e)}function AA(e){J$(e,_A)}var FA=null,OA=null,MA=null;function DA(){if(MA)return MA;var e,t,n=OA,r=n.length,a="value"in FA?FA.value:FA.textContent,o=a.length;for(e=0;e<r&&n[e]===a[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===a[o-t];t++);return MA=a.slice(e,1<t?1-t:void 0)}function PA(){return!0}function LA(){return!1}function BA(e,t,n,r){for(var a in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(a)&&((t=e[a])?this[a]=t(n):"target"===a?this.target=r:this[a]=n[a]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?PA:LA,this.isPropagationStopped=LA,this}function zA(e,t,n,r){if(this.eventPool.length){var a=this.eventPool.pop();return this.call(a,e,t,n,r),a}return new this(e,t,n,r)}function WA(e){if(!(e instanceof this))throw Error(e_(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function VA(e){e.eventPool=[],e.getPooled=zA,e.release=WA}QS(BA.prototype,{preventDefault:function preventDefault(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=PA)},stopPropagation:function stopPropagation(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=PA)},persist:function persist(){this.isPersistent=PA},isPersistent:LA,destructor:function destructor(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=LA,this._dispatchInstances=this._dispatchListeners=null}}),BA.Interface={type:null,target:null,currentTarget:function currentTarget(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function timeStamp(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},BA.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var a=new t;return QS(a,n.prototype),n.prototype=a,n.prototype.constructor=n,n.Interface=QS({},r.Interface,e),n.extend=r.extend,VA(n),n},VA(BA);var UA=BA.extend({data:null}),HA=BA.extend({data:null}),jA=[9,13,27,32],GA=k_&&"CompositionEvent"in window,qA=null;k_&&"documentMode"in document&&(qA=document.documentMode);var KA=k_&&"TextEvent"in window&&!qA,XA=k_&&(!GA||qA&&8<qA&&11>=qA),YA=String.fromCharCode(32),QA={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},ZA=!1;function JA(e,t){switch(e){case"keyup":return-1!==jA.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function eF(e){return"object"==_typeof(e=e.detail)&&"data"in e?e.data:null}var tF=!1,nF={eventTypes:QA,extractEvents:function extractEvents(e,t,n,r){var a;if(GA)e:{switch(e){case"compositionstart":var o=QA.compositionStart;break e;case"compositionend":o=QA.compositionEnd;break e;case"compositionupdate":o=QA.compositionUpdate;break e}o=void 0}else tF?JA(e,n)&&(o=QA.compositionEnd):"keydown"===e&&229===n.keyCode&&(o=QA.compositionStart);return o?(XA&&"ko"!==n.locale&&(tF||o!==QA.compositionStart?o===QA.compositionEnd&&tF&&(a=DA()):(OA="value"in(FA=r)?FA.value:FA.textContent,tF=!0)),o=UA.getPooled(o,t,n,r),(a||null!==(a=eF(n)))&&(o.data=a),AA(o),a=o):a=null,(e=KA?function(e,t){switch(e){case"compositionend":return eF(t);case"keypress":return 32!==t.which?null:(ZA=!0,YA);case"textInput":return(e=t.data)===YA&&ZA?null:e;default:return null}}(e,n):function(e,t){if(tF)return"compositionend"===e||!GA&&JA(e,t)?(e=DA(),MA=OA=FA=null,tF=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return XA&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))?((t=HA.getPooled(QA.beforeInput,t,n,r)).data=e,AA(t)):t=null,null===a?t:null===t?a:[a,t]}},rF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function aF(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!rF[e.type]:"textarea"===t}var oF={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function sF(e,t,n){return(e=BA.getPooled(oF.change,e,t,n)).type="change",C_(n),AA(e),e}var iF=null,uF=null;function lF(e){nR(e)}function cF(e){if(m$(NA(e)))return e}function dF(e,t){if("change"===e)return t}var pF=!1;function fF(){iF&&(iF.detachEvent("onpropertychange",hF),uF=iF=null)}function hF(e){if("value"===e.propertyName&&cF(uF))if(e=sF(uF,e,rR(e)),A_)nR(e);else{A_=!0;try{S_(lF,e)}finally{A_=!1,O_()}}}function mF(e,t,n){"focus"===e?(fF(),uF=n,(iF=t).attachEvent("onpropertychange",hF)):"blur"===e&&fF()}function gF(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return cF(uF)}function bF(e,t){if("click"===e)return cF(t)}function yF(e,t){if("input"===e||"change"===e)return cF(t)}k_&&(pF=aR("input")&&(!document.documentMode||9<document.documentMode));var xF={eventTypes:oF,_isInputEventSupported:pF,extractEvents:function extractEvents(e,t,n,r){var a=t?NA(t):window,o=a.nodeName&&a.nodeName.toLowerCase();if("select"===o||"input"===o&&"file"===a.type)var s=dF;else if(aF(a))if(pF)s=yF;else{s=gF;var i=mF}else(o=a.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(s=bF);if(s&&(s=s(e,t)))return sF(s,n,r);i&&i(e,a,t),"blur"===e&&(e=a._wrapperState)&&e.controlled&&"number"===a.type&&k$(a,"number",a.value)}},vF=BA.extend({view:null,detail:null}),kF={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wF(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kF[e])&&!!t[e]}function IF(){return wF}var NF=0,TF=0,CF=!1,EF=!1,SF=vF.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:IF,button:null,buttons:null,relatedTarget:function relatedTarget(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function movementX(e){if("movementX"in e)return e.movementX;var t=NF;return NF=e.screenX,CF?"mousemove"===e.type?e.screenX-t:0:(CF=!0,0)},movementY:function movementY(e){if("movementY"in e)return e.movementY;var t=TF;return TF=e.screenY,EF?"mousemove"===e.type?e.screenY-t:0:(EF=!0,0)}}),_F=SF.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),$F={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},RF={eventTypes:$F,extractEvents:function extractEvents(e,t,n,r,a){var o="mouseover"===e||"pointerover"===e,s="mouseout"===e||"pointerout"===e;if(o&&0==(32&a)&&(n.relatedTarget||n.fromElement)||!s&&!o)return null;if(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,s?(s=t,null!==(t=(t=n.relatedTarget||n.toElement)?wA(t):null)&&(t!==K$(t)||5!==t.tag&&6!==t.tag)&&(t=null)):s=null,s===t)return null;if("mouseout"===e||"mouseover"===e)var i=SF,u=$F.mouseLeave,l=$F.mouseEnter,c="mouse";else"pointerout"!==e&&"pointerover"!==e||(i=_F,u=$F.pointerLeave,l=$F.pointerEnter,c="pointer");if(e=null==s?o:NA(s),o=null==t?o:NA(t),(u=i.getPooled(u,s,n,r)).type=c+"leave",u.target=e,u.relatedTarget=o,(n=i.getPooled(l,t,n,r)).type=c+"enter",n.target=o,n.relatedTarget=e,c=t,(r=s)&&c)e:{for(l=c,s=0,e=i=r;e;e=CA(e))s++;for(e=0,t=l;t;t=CA(t))e++;for(;0<s-e;)i=CA(i),s--;for(;0<e-s;)l=CA(l),e--;for(;s--;){if(i===l||i===l.alternate)break e;i=CA(i),l=CA(l)}i=null}else i=null;for(l=i,i=[];r&&r!==l&&(null===(s=r.alternate)||s!==l);)i.push(r),r=CA(r);for(r=[];c&&c!==l&&(null===(s=c.alternate)||s!==l);)r.push(c),c=CA(c);for(c=0;c<i.length;c++)$A(i[c],"bubbled",u);for(c=r.length;0<c--;)$A(r[c],"captured",n);return 0==(64&a)?[u]:[u,n]}},AF="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},FF=Object.prototype.hasOwnProperty;function OF(e,t){if(AF(e,t))return!0;if("object"!=_typeof(e)||null===e||"object"!=_typeof(t)||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!FF.call(t,n[r])||!AF(e[n[r]],t[n[r]]))return!1;return!0}var MF=k_&&"documentMode"in document&&11>=document.documentMode,DF={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},PF=null,LF=null,BF=null,zF=!1;function WF(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return zF||null==PF||PF!==aA(n)?null:(n="selectionStart"in(n=PF)&&lA(n)?{start:n.selectionStart,end:n.selectionEnd}:{anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},BF&&OF(BF,n)?null:(BF=n,(e=BA.getPooled(DF.select,LF,e,t)).type="select",e.target=PF,AA(e),e))}var VF={eventTypes:DF,extractEvents:function extractEvents(e,t,n,r,a,o){if(!(o=!(a=o||(r.window===r?r.document:9===r.nodeType?r:r.ownerDocument)))){e:{a=q$(a),o=x_.onSelect;for(var s=0;s<o.length;s++)if(!a.has(o[s])){a=!1;break e}a=!0}o=!a}if(o)return null;switch(a=t?NA(t):window,e){case"focus":(aF(a)||"true"===a.contentEditable)&&(PF=a,LF=t,BF=null);break;case"blur":BF=LF=PF=null;break;case"mousedown":zF=!0;break;case"contextmenu":case"mouseup":case"dragend":return zF=!1,WF(n,r);case"selectionchange":if(MF)break;case"keydown":case"keyup":return WF(n,r)}return null}},UF=BA.extend({animationName:null,elapsedTime:null,pseudoElement:null}),HF=BA.extend({clipboardData:function clipboardData(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),jF=vF.extend({relatedTarget:null});function GF(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var qF={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},KF={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},XF=vF.extend({key:function key(e){if(e.key){var t=qF[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=GF(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?KF[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:IF,charCode:function charCode(e){return"keypress"===e.type?GF(e):0},keyCode:function keyCode(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function which(e){return"keypress"===e.type?GF(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),YF=SF.extend({dataTransfer:null}),QF=vF.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:IF}),ZF=BA.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),JF=SF.extend({deltaX:function deltaX(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function deltaY(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),eO={eventTypes:AR,extractEvents:function extractEvents(e,t,n,r){var a=FR.get(e);if(!a)return null;switch(e){case"keypress":if(0===GF(n))return null;case"keydown":case"keyup":e=XF;break;case"blur":case"focus":e=jF;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=SF;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=YF;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=QF;break;case W$:case V$:case U$:e=UF;break;case H$:e=ZF;break;case"scroll":e=vF;break;case"wheel":e=JF;break;case"copy":case"cut":case"paste":e=HF;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=_F;break;default:e=BA}return AA(t=e.getPooled(a,t,n,r)),t}};if(p_)throw Error(e_(101));p_=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),h_(),u_=TA,l_=IA,c_=NA,v_({SimpleEventPlugin:eO,EnterLeaveEventPlugin:RF,ChangeEventPlugin:xF,SelectEventPlugin:VF,BeforeInputEventPlugin:nF});var tO=[],nO=-1;function rO(e){0>nO||(e.current=tO[nO],tO[nO]=null,nO--)}function aO(e,t){nO++,tO[nO]=e.current,e.current=t}var oO={},sO={current:oO},iO={current:!1},uO=oO;function lO(e,t){var n=e.type.contextTypes;if(!n)return oO;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,o={};for(a in n)o[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function cO(e){return null!=e.childContextTypes}function dO(){rO(iO),rO(sO)}function pO(e,t,n){if(sO.current!==oO)throw Error(e_(168));aO(sO,t),aO(iO,n)}function fO(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in e))throw Error(e_(108,c$(t)||"Unknown",a));return QS({},n,{},r)}function hO(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||oO,uO=sO.current,aO(sO,e),aO(iO,iO.current),!0}function mO(e,t,n){var r=e.stateNode;if(!r)throw Error(e_(169));n?(e=fO(e,t,uO),r.__reactInternalMemoizedMergedChildContext=e,rO(iO),rO(sO),aO(sO,e)):rO(iO),aO(iO,n)}var gO=JS.unstable_runWithPriority,bO=JS.unstable_scheduleCallback,yO=JS.unstable_cancelCallback,xO=JS.unstable_requestPaint,vO=JS.unstable_now,kO=JS.unstable_getCurrentPriorityLevel,wO=JS.unstable_ImmediatePriority,IO=JS.unstable_UserBlockingPriority,NO=JS.unstable_NormalPriority,TO=JS.unstable_LowPriority,CO=JS.unstable_IdlePriority,EO={},SO=JS.unstable_shouldYield,_O=void 0!==xO?xO:function(){},$O=null,RO=null,AO=!1,FO=vO(),OO=1e4>FO?vO:function(){return vO()-FO};function MO(){switch(kO()){case wO:return 99;case IO:return 98;case NO:return 97;case TO:return 96;case CO:return 95;default:throw Error(e_(332))}}function DO(e){switch(e){case 99:return wO;case 98:return IO;case 97:return NO;case 96:return TO;case 95:return CO;default:throw Error(e_(332))}}function PO(e,t){return e=DO(e),gO(e,t)}function LO(e,t,n){return e=DO(e),bO(e,t,n)}function BO(e){return null===$O?($O=[e],RO=bO(wO,WO)):$O.push(e),EO}function zO(){if(null!==RO){var e=RO;RO=null,yO(e)}WO()}function WO(){if(!AO&&null!==$O){AO=!0;var e=0;try{var t=$O;PO(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),$O=null}catch(t){throw null!==$O&&($O=$O.slice(e+1)),bO(wO,zO),t}finally{AO=!1}}}function VO(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function UO(e,t){if(e&&e.defaultProps)for(var n in t=QS({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var HO={current:null},jO=null,GO=null,qO=null;function KO(){qO=GO=jO=null}function XO(e){var t=HO.current;rO(HO),e.type._context._currentValue=t}function YO(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function QO(e,t){jO=e,qO=GO=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(ND=!0),e.firstContext=null)}function ZO(e,t){if(qO!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(qO=e,t=1073741823),t={context:e,observedBits:t,next:null},null===GO){if(null===jO)throw Error(e_(308));GO=t,jO.dependencies={expirationTime:0,firstContext:t,responders:null}}else GO=GO.next=t;return e._currentValue}var JO=!1;function eM(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function tM(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function nM(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function rM(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function aM(e,t){var n=e.alternate;null!==n&&tM(n,e),null===(n=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function oM(e,t,n,r){var a=e.updateQueue;JO=!1;var o=a.baseQueue,s=a.shared.pending;if(null!==s){if(null!==o){var i=o.next;o.next=s.next,s.next=i}o=s,a.shared.pending=null,null!==(i=e.alternate)&&null!==(i=i.updateQueue)&&(i.baseQueue=s)}if(null!==o){i=o.next;var u=a.baseState,l=0,c=null,d=null,p=null;if(null!==i)for(var f=i;;){if((s=f.expirationTime)<r){var h={expirationTime:f.expirationTime,suspenseConfig:f.suspenseConfig,tag:f.tag,payload:f.payload,callback:f.callback,next:null};null===p?(d=p=h,c=u):p=p.next=h,s>l&&(l=s)}else{null!==p&&(p=p.next={expirationTime:1073741823,suspenseConfig:f.suspenseConfig,tag:f.tag,payload:f.payload,callback:f.callback,next:null}),tL(s,f.suspenseConfig);e:{var m=e,g=f;switch(s=t,h=n,g.tag){case 1:if("function"==typeof(m=g.payload)){u=m.call(h,u,s);break e}u=m;break e;case 3:m.effectTag=-4097&m.effectTag|64;case 0:if(null==(s="function"==typeof(m=g.payload)?m.call(h,u,s):m))break e;u=QS({},u,s);break e;case 2:JO=!0}}null!==f.callback&&(e.effectTag|=32,null===(s=a.effects)?a.effects=[f]:s.push(f))}if(null===(f=f.next)||f===i){if(null===(s=a.shared.pending))break;f=o.next=s.next,s.next=i,a.baseQueue=o=s,a.shared.pending=null}}null===p?c=u:p.next=d,a.baseState=c,a.baseQueue=p,nL(l),e.expirationTime=l,e.memoizedState=u}}function sM(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=a,a=n,"function"!=typeof r)throw Error(e_(191,r));r.call(a)}}}var iM=H_.ReactCurrentBatchConfig,uM=(new react__WEBPACK_IMPORTED_MODULE_126___default.a.Component).refs;function lM(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:QS({},t,n),e.memoizedState=n,0===e.expirationTime&&(e.updateQueue.baseState=n)}var cM={isMounted:function isMounted(e){return!!(e=e._reactInternalFiber)&&K$(e)===e},enqueueSetState:function enqueueSetState(e,t,n){e=e._reactInternalFiber;var r=VP(),a=iM.suspense;(a=nM(r=UP(r,e,a),a)).payload=t,null!=n&&(a.callback=n),rM(e,a),HP(e,r)},enqueueReplaceState:function enqueueReplaceState(e,t,n){e=e._reactInternalFiber;var r=VP(),a=iM.suspense;(a=nM(r=UP(r,e,a),a)).tag=1,a.payload=t,null!=n&&(a.callback=n),rM(e,a),HP(e,r)},enqueueForceUpdate:function enqueueForceUpdate(e,t){e=e._reactInternalFiber;var n=VP(),r=iM.suspense;(r=nM(n=UP(n,e,r),r)).tag=2,null!=t&&(r.callback=t),rM(e,r),HP(e,n)}};function dM(e,t,n,r,a,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!(t.prototype&&t.prototype.isPureReactComponent&&OF(n,r)&&OF(a,o))}function pM(e,t,n){var r=!1,a=oO,o=t.contextType;return"object"==_typeof(o)&&null!==o?o=ZO(o):(a=cO(t)?uO:sO.current,o=(r=null!=(r=t.contextTypes))?lO(e,a):oO),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=cM,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=o),t}function fM(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&cM.enqueueReplaceState(t,t.state,null)}function hM(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=uM,eM(e);var o=t.contextType;"object"==_typeof(o)&&null!==o?a.context=ZO(o):(o=cO(t)?uO:sO.current,a.context=lO(e,o)),oM(e,n,a,r),a.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(lM(e,t,o,n),a.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(t=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&cM.enqueueReplaceState(a,a.state,null),oM(e,n,a,r),a.state=e.memoizedState),"function"==typeof a.componentDidMount&&(e.effectTag|=4)}var mM=Array.isArray;function gM(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=_typeof(e)){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(e_(309));var r=n.stateNode}if(!r)throw Error(e_(147,e));var a=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===a?t.ref:((t=function t(e){var t=r.refs;t===uM&&(t=r.refs={}),null===e?delete t[a]:t[a]=e})._stringRef=a,t)}if("string"!=typeof e)throw Error(e_(284));if(!n._owner)throw Error(e_(290,e))}return e}function bM(e,t){if("textarea"!==e.type)throw Error(e_(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function yM(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=wL(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function s(t){return e&&null===t.alternate&&(t.effectTag=2),t}function i(e,t,n,r){return null===t||6!==t.tag?((t=TL(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function u(e,t,n,r){return null!==t&&t.elementType===n.type?((r=a(t,n.props)).ref=gM(e,t,n),r.return=e,r):((r=IL(n.type,n.key,n.props,null,e.mode,r)).ref=gM(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=CL(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function c(e,t,n,r,o){return null===t||7!==t.tag?((t=NL(n,e.mode,r,o)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=TL(""+t,e.mode,n)).return=e,t;if("object"==_typeof(t)&&null!==t){switch(t.$$typeof){case K_:return(n=IL(t.type,t.key,t.props,null,e.mode,n)).ref=gM(e,null,t),n.return=e,n;case X_:return(t=CL(t,e.mode,n)).return=e,t}if(mM(t)||l$(t))return(t=NL(t,e.mode,n,null)).return=e,t;bM(e,t)}return null}function p(e,t,n,r){var a=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==a?null:i(e,t,""+n,r);if("object"==_typeof(n)&&null!==n){switch(n.$$typeof){case K_:return n.key===a?n.type===Y_?c(e,t,n.props.children,r,a):u(e,t,n,r):null;case X_:return n.key===a?l(e,t,n,r):null}if(mM(n)||l$(n))return null!==a?null:c(e,t,n,r,null);bM(e,n)}return null}function f(e,t,n,r,a){if("string"==typeof r||"number"==typeof r)return i(t,e=e.get(n)||null,""+r,a);if("object"==_typeof(r)&&null!==r){switch(r.$$typeof){case K_:return e=e.get(null===r.key?n:r.key)||null,r.type===Y_?c(t,e,r.props.children,a,r.key):u(t,e,r,a);case X_:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a)}if(mM(r)||l$(r))return c(t,e=e.get(n)||null,r,a,null);bM(t,r)}return null}function h(a,s,i,u){for(var l=null,c=null,h=s,m=s=0,g=null;null!==h&&m<i.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var b=p(a,h,i[m],u);if(null===b){null===h&&(h=g);break}e&&h&&null===b.alternate&&t(a,h),s=o(b,s,m),null===c?l=b:c.sibling=b,c=b,h=g}if(m===i.length)return n(a,h),l;if(null===h){for(;m<i.length;m++)null!==(h=d(a,i[m],u))&&(s=o(h,s,m),null===c?l=h:c.sibling=h,c=h);return l}for(h=r(a,h);m<i.length;m++)null!==(g=f(h,a,m,i[m],u))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),s=o(g,s,m),null===c?l=g:c.sibling=g,c=g);return e&&h.forEach((function(e){return t(a,e)})),l}function m(a,s,i,u){var l=l$(i);if("function"!=typeof l)throw Error(e_(150));if(null==(i=l.call(i)))throw Error(e_(151));for(var c=l=null,h=s,m=s=0,g=null,b=i.next();null!==h&&!b.done;m++,b=i.next()){h.index>m?(g=h,h=null):g=h.sibling;var y=p(a,h,b.value,u);if(null===y){null===h&&(h=g);break}e&&h&&null===y.alternate&&t(a,h),s=o(y,s,m),null===c?l=y:c.sibling=y,c=y,h=g}if(b.done)return n(a,h),l;if(null===h){for(;!b.done;m++,b=i.next())null!==(b=d(a,b.value,u))&&(s=o(b,s,m),null===c?l=b:c.sibling=b,c=b);return l}for(h=r(a,h);!b.done;m++,b=i.next())null!==(b=f(h,a,m,b.value,u))&&(e&&null!==b.alternate&&h.delete(null===b.key?m:b.key),s=o(b,s,m),null===c?l=b:c.sibling=b,c=b);return e&&h.forEach((function(e){return t(a,e)})),l}return function(e,r,o,i){var u="object"==_typeof(o)&&null!==o&&o.type===Y_&&null===o.key;u&&(o=o.props.children);var l="object"==_typeof(o)&&null!==o;if(l)switch(o.$$typeof){case K_:e:{for(l=o.key,u=r;null!==u;){if(u.key===l){switch(u.tag){case 7:if(o.type===Y_){n(e,u.sibling),(r=a(u,o.props.children)).return=e,e=r;break e}break;default:if(u.elementType===o.type){n(e,u.sibling),(r=a(u,o.props)).ref=gM(e,u,o),r.return=e,e=r;break e}}n(e,u);break}t(e,u),u=u.sibling}o.type===Y_?((r=NL(o.props.children,e.mode,i,o.key)).return=e,e=r):((i=IL(o.type,o.key,o.props,null,e.mode,i)).ref=gM(e,r,o),i.return=e,e=i)}return s(e);case X_:e:{for(u=o.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(e,r.sibling),(r=a(r,o.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=CL(o,e.mode,i)).return=e,e=r}return s(e)}if("string"==typeof o||"number"==typeof o)return o=""+o,null!==r&&6===r.tag?(n(e,r.sibling),(r=a(r,o)).return=e,e=r):(n(e,r),(r=TL(o,e.mode,i)).return=e,e=r),s(e);if(mM(o))return h(e,r,o,i);if(l$(o))return m(e,r,o,i);if(l&&bM(e,o),void 0===o&&!u)switch(e.tag){case 1:case 0:throw e=e.type,Error(e_(152,e.displayName||e.name||"Component"))}return n(e,r)}}var xM=yM(!0),vM=yM(!1),kM={},wM={current:kM},IM={current:kM},NM={current:kM};function TM(e){if(e===kM)throw Error(e_(174));return e}function CM(e,t){switch(aO(NM,t),aO(IM,e),aO(wM,kM),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:R$(null,"");break;default:t=R$(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}rO(wM),aO(wM,t)}function EM(){rO(wM),rO(IM),rO(NM)}function SM(e){TM(NM.current);var t=TM(wM.current),n=R$(t,e.type);t!==n&&(aO(IM,e),aO(wM,n))}function _M(e){IM.current===e&&(rO(wM),rO(IM))}var $M={current:0};function RM(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function AM(e,t){return{responder:e,props:t}}var FM=H_.ReactCurrentDispatcher,OM=H_.ReactCurrentBatchConfig,MM=0,DM=null,PM=null,LM=null,BM=!1;function zM(){throw Error(e_(321))}function WM(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!AF(e[n],t[n]))return!1;return!0}function VM(e,t,n,r,a,o){if(MM=o,DM=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,FM.current=null===e||null===e.memoizedState?dD:pD,e=n(r,a),t.expirationTime===MM){o=0;do{if(t.expirationTime=0,!(25>o))throw Error(e_(301));o+=1,LM=PM=null,t.updateQueue=null,FM.current=fD,e=n(r,a)}while(t.expirationTime===MM)}if(FM.current=cD,t=null!==PM&&null!==PM.next,MM=0,LM=PM=DM=null,BM=!1,t)throw Error(e_(300));return e}function UM(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===LM?DM.memoizedState=LM=e:LM=LM.next=e,LM}function HM(){if(null===PM){var e=DM.alternate;e=null!==e?e.memoizedState:null}else e=PM.next;var t=null===LM?DM.memoizedState:LM.next;if(null!==t)LM=t,PM=e;else{if(null===e)throw Error(e_(310));e={memoizedState:(PM=e).memoizedState,baseState:PM.baseState,baseQueue:PM.baseQueue,queue:PM.queue,next:null},null===LM?DM.memoizedState=LM=e:LM=LM.next=e}return LM}function jM(e,t){return"function"==typeof t?t(e):t}function GM(e){var t=HM(),n=t.queue;if(null===n)throw Error(e_(311));n.lastRenderedReducer=e;var r=PM,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){a=a.next,r=r.baseState;var i=s=o=null,u=a;do{var l=u.expirationTime;if(l<MM){var c={expirationTime:u.expirationTime,suspenseConfig:u.suspenseConfig,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null};null===i?(s=i=c,o=r):i=i.next=c,l>DM.expirationTime&&(DM.expirationTime=l,nL(l))}else null!==i&&(i=i.next={expirationTime:1073741823,suspenseConfig:u.suspenseConfig,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null}),tL(l,u.suspenseConfig),r=u.eagerReducer===e?u.eagerState:e(r,u.action);u=u.next}while(null!==u&&u!==a);null===i?o=r:i.next=s,AF(r,t.memoizedState)||(ND=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=i,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function qM(e){var t=HM(),n=t.queue;if(null===n)throw Error(e_(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);AF(o,t.memoizedState)||(ND=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function KM(e){var t=UM();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:jM,lastRenderedState:e}).dispatch=lD.bind(null,DM,e),[t.memoizedState,e]}function XM(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=DM.updateQueue)?(t={lastEffect:null},DM.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function YM(){return HM().memoizedState}function QM(e,t,n,r){var a=UM();DM.effectTag|=e,a.memoizedState=XM(1|t,n,void 0,void 0===r?null:r)}function ZM(e,t,n,r){var a=HM();r=void 0===r?null:r;var o=void 0;if(null!==PM){var s=PM.memoizedState;if(o=s.destroy,null!==r&&WM(r,s.deps))return void XM(t,n,o,r)}DM.effectTag|=e,a.memoizedState=XM(1|t,n,o,r)}function JM(e,t){return QM(516,4,e,t)}function eD(e,t){return ZM(516,4,e,t)}function tD(e,t){return ZM(4,2,e,t)}function nD(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function rD(e,t,n){return n=null!=n?n.concat([e]):null,ZM(4,2,nD.bind(null,t,e),n)}function aD(){}function oD(e,t){return UM().memoizedState=[e,void 0===t?null:t],e}function sD(e,t){var n=HM();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&WM(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function iD(e,t){var n=HM();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&WM(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function uD(e,t,n){var r=MO();PO(98>r?98:r,(function(){e(!0)})),PO(97<r?97:r,(function(){var r=OM.suspense;OM.suspense=void 0===t?null:t;try{e(!1),n()}finally{OM.suspense=r}}))}function lD(e,t,n){var r=VP(),a=iM.suspense;a={expirationTime:r=UP(r,e,a),suspenseConfig:a,action:n,eagerReducer:null,eagerState:null,next:null};var o=t.pending;if(null===o?a.next=a:(a.next=o.next,o.next=a),t.pending=a,o=e.alternate,e===DM||null!==o&&o===DM)BM=!0,a.expirationTime=MM,DM.expirationTime=MM;else{if(0===e.expirationTime&&(null===o||0===o.expirationTime)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,i=o(s,n);if(a.eagerReducer=o,a.eagerState=i,AF(i,s))return}catch(e){}HP(e,r)}}var cD={readContext:ZO,useCallback:zM,useContext:zM,useEffect:zM,useImperativeHandle:zM,useLayoutEffect:zM,useMemo:zM,useReducer:zM,useRef:zM,useState:zM,useDebugValue:zM,useResponder:zM,useDeferredValue:zM,useTransition:zM},dD={readContext:ZO,useCallback:oD,useContext:ZO,useEffect:JM,useImperativeHandle:function useImperativeHandle(e,t,n){return n=null!=n?n.concat([e]):null,QM(4,2,nD.bind(null,t,e),n)},useLayoutEffect:function useLayoutEffect(e,t){return QM(4,2,e,t)},useMemo:function useMemo(e,t){var n=UM();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function useReducer(e,t,n){var r=UM();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=lD.bind(null,DM,e),[r.memoizedState,e]},useRef:function useRef(e){return e={current:e},UM().memoizedState=e},useState:KM,useDebugValue:aD,useResponder:AM,useDeferredValue:function useDeferredValue(e,t){var n=KM(e),r=n[0],a=n[1];return JM((function(){var n=OM.suspense;OM.suspense=void 0===t?null:t;try{a(e)}finally{OM.suspense=n}}),[e,t]),r},useTransition:function useTransition(e){var t=KM(!1),n=t[0];return t=t[1],[oD(uD.bind(null,t,e),[t,e]),n]}},pD={readContext:ZO,useCallback:sD,useContext:ZO,useEffect:eD,useImperativeHandle:rD,useLayoutEffect:tD,useMemo:iD,useReducer:GM,useRef:YM,useState:function useState(){return GM(jM)},useDebugValue:aD,useResponder:AM,useDeferredValue:function useDeferredValue(e,t){var n=GM(jM),r=n[0],a=n[1];return eD((function(){var n=OM.suspense;OM.suspense=void 0===t?null:t;try{a(e)}finally{OM.suspense=n}}),[e,t]),r},useTransition:function useTransition(e){var t=GM(jM),n=t[0];return t=t[1],[sD(uD.bind(null,t,e),[t,e]),n]}},fD={readContext:ZO,useCallback:sD,useContext:ZO,useEffect:eD,useImperativeHandle:rD,useLayoutEffect:tD,useMemo:iD,useReducer:qM,useRef:YM,useState:function useState(){return qM(jM)},useDebugValue:aD,useResponder:AM,useDeferredValue:function useDeferredValue(e,t){var n=qM(jM),r=n[0],a=n[1];return eD((function(){var n=OM.suspense;OM.suspense=void 0===t?null:t;try{a(e)}finally{OM.suspense=n}}),[e,t]),r},useTransition:function useTransition(e){var t=qM(jM),n=t[0];return t=t[1],[sD(uD.bind(null,t,e),[t,e]),n]}},hD=null,mD=null,gD=!1;function bD(e,t){var n=vL(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function yD(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function xD(e){if(gD){var t=mD;if(t){var n=t;if(!yD(e,t)){if(!(t=gA(n.nextSibling))||!yD(e,t))return e.effectTag=-1025&e.effectTag|2,gD=!1,void(hD=e);bD(hD,n)}hD=e,mD=gA(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,gD=!1,hD=e}}function vD(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;hD=e}function kD(e){if(e!==hD)return!1;if(!gD)return vD(e),gD=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!fA(t,e.memoizedProps))for(t=mD;t;)bD(e,t),t=gA(t.nextSibling);if(vD(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(e_(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){mD=gA(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}mD=null}}else mD=hD?gA(e.stateNode.nextSibling):null;return!0}function wD(){mD=hD=null,gD=!1}var ID=H_.ReactCurrentOwner,ND=!1;function TD(e,t,n,r){t.child=null===e?vM(t,null,n,r):xM(t,e.child,n,r)}function CD(e,t,n,r,a){n=n.render;var o=t.ref;return QO(t,a),r=VM(e,t,n,r,o,a),null===e||ND?(t.effectTag|=1,TD(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=a&&(e.expirationTime=0),VD(e,t,a))}function ED(e,t,n,r,a,o){if(null===e){var s=n.type;return"function"!=typeof s||kL(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=IL(n.type,null,r,null,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,SD(e,t,s,r,a,o))}return s=e.child,a<o&&(a=s.memoizedProps,(n=null!==(n=n.compare)?n:OF)(a,r)&&e.ref===t.ref)?VD(e,t,o):(t.effectTag|=1,(e=wL(s,r)).ref=t.ref,e.return=t,t.child=e)}function SD(e,t,n,r,a,o){return null!==e&&OF(e.memoizedProps,r)&&e.ref===t.ref&&(ND=!1,a<o)?(t.expirationTime=e.expirationTime,VD(e,t,o)):$D(e,t,n,r,o)}function _D(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function $D(e,t,n,r,a){var o=cO(n)?uO:sO.current;return o=lO(t,o),QO(t,a),n=VM(e,t,n,r,o,a),null===e||ND?(t.effectTag|=1,TD(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=a&&(e.expirationTime=0),VD(e,t,a))}function RD(e,t,n,r,a){if(cO(n)){var o=!0;hO(t)}else o=!1;if(QO(t,a),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),pM(t,n,r),hM(t,n,r,a),r=!0;else if(null===e){var s=t.stateNode,i=t.memoizedProps;s.props=i;var u=s.context,l=n.contextType;l="object"==_typeof(l)&&null!==l?ZO(l):lO(t,l=cO(n)?uO:sO.current);var c=n.getDerivedStateFromProps,d="function"==typeof c||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(i!==r||u!==l)&&fM(t,s,r,l),JO=!1;var p=t.memoizedState;s.state=p,oM(t,r,s,a),u=t.memoizedState,i!==r||p!==u||iO.current||JO?("function"==typeof c&&(lM(t,n,c,r),u=t.memoizedState),(i=JO||dM(t,n,i,r,p,u,l))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.effectTag|=4)):("function"==typeof s.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=u),s.props=r,s.state=u,s.context=l,r=i):("function"==typeof s.componentDidMount&&(t.effectTag|=4),r=!1)}else s=t.stateNode,tM(e,t),i=t.memoizedProps,s.props=t.type===t.elementType?i:UO(t.type,i),u=s.context,l="object"==_typeof(l=n.contextType)&&null!==l?ZO(l):lO(t,l=cO(n)?uO:sO.current),(d="function"==typeof(c=n.getDerivedStateFromProps)||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(i!==r||u!==l)&&fM(t,s,r,l),JO=!1,u=t.memoizedState,s.state=u,oM(t,r,s,a),p=t.memoizedState,i!==r||u!==p||iO.current||JO?("function"==typeof c&&(lM(t,n,c,r),p=t.memoizedState),(c=JO||dM(t,n,i,r,u,p,l))?(d||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(r,p,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof s.componentDidUpdate&&(t.effectTag|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof s.componentDidUpdate||i===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!=typeof s.getSnapshotBeforeUpdate||i===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=p),s.props=r,s.state=p,s.context=l,r=c):("function"!=typeof s.componentDidUpdate||i===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!=typeof s.getSnapshotBeforeUpdate||i===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),r=!1);return AD(e,t,n,r,o,a)}function AD(e,t,n,r,a,o){_D(e,t);var s=0!=(64&t.effectTag);if(!r&&!s)return a&&mO(t,n,!1),VD(e,t,o);r=t.stateNode,ID.current=t;var i=s&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&s?(t.child=xM(t,e.child,null,o),t.child=xM(t,null,i,o)):TD(e,t,i,o),t.memoizedState=r.state,a&&mO(t,n,!0),t.child}function FD(e){var t=e.stateNode;t.pendingContext?pO(0,t.pendingContext,t.pendingContext!==t.context):t.context&&pO(0,t.context,!1),CM(e,t.containerInfo)}var OD,MD,DD,PD={dehydrated:null,retryTime:0};function LD(e,t,n){var r,a=t.mode,o=t.pendingProps,s=$M.current,i=!1;if((r=0!=(64&t.effectTag))||(r=0!=(2&s)&&(null===e||null!==e.memoizedState)),r?(i=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(s|=1),aO($M,1&s),null===e){if(void 0!==o.fallback&&xD(t),i){if(i=o.fallback,(o=NL(null,a,0,null)).return=t,0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(n=NL(i,a,n,null)).return=t,o.sibling=n,t.memoizedState=PD,t.child=o,n}return a=o.children,t.memoizedState=null,t.child=vM(t,null,a,n)}if(null!==e.memoizedState){if(a=(e=e.child).sibling,i){if(o=o.fallback,(n=wL(e,e.pendingProps)).return=t,0==(2&t.mode)&&(i=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=i;null!==i;)i.return=n,i=i.sibling;return(a=wL(a,o)).return=t,n.sibling=a,n.childExpirationTime=0,t.memoizedState=PD,t.child=n,a}return n=xM(t,e.child,o.children,n),t.memoizedState=null,t.child=n}if(e=e.child,i){if(i=o.fallback,(o=NL(null,a,0,null)).return=t,o.child=e,null!==e&&(e.return=o),0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(n=NL(i,a,n,null)).return=t,o.sibling=n,n.effectTag|=2,o.childExpirationTime=0,t.memoizedState=PD,t.child=o,n}return t.memoizedState=null,t.child=xM(t,e,o.children,n)}function BD(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),YO(e.return,t)}function zD(e,t,n,r,a,o){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailExpiration:0,tailMode:a,lastEffect:o}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailExpiration=0,s.tailMode=a,s.lastEffect=o)}function WD(e,t,n){var r=t.pendingProps,a=r.revealOrder,o=r.tail;if(TD(e,t,r.children,n),0!=(2&(r=$M.current)))r=1&r|2,t.effectTag|=64;else{if(null!==e&&0!=(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&BD(e,n);else if(19===e.tag)BD(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(aO($M,r),0==(2&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===RM(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),zD(t,!1,a,n,o,t.lastEffect);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===RM(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}zD(t,!0,n,null,o,t.lastEffect);break;case"together":zD(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function VD(e,t,n){null!==e&&(t.dependencies=e.dependencies);var r=t.expirationTime;if(0!==r&&nL(r),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(e_(153));if(null!==t.child){for(n=wL(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=wL(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function UD(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function HD(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return cO(t.type)&&dO(),null;case 3:return EM(),rO(iO),rO(sO),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||!kD(t)||(t.effectTag|=4),null;case 5:_M(t),n=TM(NM.current);var a=t.type;if(null!==e&&null!=t.stateNode)MD(e,t,a,r,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!r){if(null===t.stateNode)throw Error(e_(166));return null}if(e=TM(wM.current),kD(t)){r=t.stateNode,a=t.type;var o=t.memoizedProps;switch(r[xA]=t,r[vA]=o,a){case"iframe":case"object":case"embed":VR("load",r);break;case"video":case"audio":for(e=0;e<j$.length;e++)VR(j$[e],r);break;case"source":VR("error",r);break;case"img":case"image":case"link":VR("error",r),VR("load",r);break;case"form":VR("reset",r),VR("submit",r);break;case"details":VR("toggle",r);break;case"input":b$(r,o),VR("invalid",r),nA(n,"onChange");break;case"select":r._wrapperState={wasMultiple:!!o.multiple},VR("invalid",r),nA(n,"onChange");break;case"textarea":T$(r,o),VR("invalid",r),nA(n,"onChange")}for(var s in JR(a,o),e=null,o)if(o.hasOwnProperty(s)){var i=o[s];"children"===s?"string"==typeof i?r.textContent!==i&&(e=["children",i]):"number"==typeof i&&r.textContent!==""+i&&(e=["children",""+i]):y_.hasOwnProperty(s)&&null!=i&&nA(n,s)}switch(a){case"input":h$(r),v$(r,o,!0);break;case"textarea":h$(r),E$(r);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(r.onclick=rA)}n=e,t.updateQueue=n,null!==n&&(t.effectTag|=4)}else{switch(s=9===n.nodeType?n:n.ownerDocument,e===tA&&(e=$$(a)),e===tA?"script"===a?((e=s.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=s.createElement(a,{is:r.is}):(e=s.createElement(a),"select"===a&&(s=e,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):e=s.createElementNS(e,a),e[xA]=t,e[vA]=r,OD(e,t),t.stateNode=e,s=eA(a,r),a){case"iframe":case"object":case"embed":VR("load",e),i=r;break;case"video":case"audio":for(i=0;i<j$.length;i++)VR(j$[i],e);i=r;break;case"source":VR("error",e),i=r;break;case"img":case"image":case"link":VR("error",e),VR("load",e),i=r;break;case"form":VR("reset",e),VR("submit",e),i=r;break;case"details":VR("toggle",e),i=r;break;case"input":b$(e,r),i=g$(e,r),VR("invalid",e),nA(n,"onChange");break;case"option":i=w$(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=QS({},r,{value:void 0}),VR("invalid",e),nA(n,"onChange");break;case"textarea":T$(e,r),i=N$(e,r),VR("invalid",e),nA(n,"onChange");break;default:i=r}JR(a,i);var u=i;for(o in u)if(u.hasOwnProperty(o)){var l=u[o];"style"===o?QR(e,l):"dangerouslySetInnerHTML"===o?null!=(l=l?l.__html:void 0)&&O$(e,l):"children"===o?"string"==typeof l?("textarea"!==a||""!==l)&&M$(e,l):"number"==typeof l&&M$(e,""+l):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(y_.hasOwnProperty(o)?null!=l&&nA(n,o):null!=l&&j_(e,o,l,s))}switch(a){case"input":h$(e),v$(e,r,!1);break;case"textarea":h$(e),E$(e);break;case"option":null!=r.value&&e.setAttribute("value",""+p$(r.value));break;case"select":e.multiple=!!r.multiple,null!=(n=r.value)?I$(e,!!r.multiple,n,!1):null!=r.defaultValue&&I$(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof i.onClick&&(e.onclick=rA)}pA(a,r)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)DD(0,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(e_(166));n=TM(NM.current),TM(wM.current),kD(t)?(n=t.stateNode,r=t.memoizedProps,n[xA]=t,n.nodeValue!==r&&(t.effectTag|=4)):((n=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[xA]=t,t.stateNode=n)}return null;case 13:return rO($M),r=t.memoizedState,0!=(64&t.effectTag)?(t.expirationTime=n,t):(n=null!==r,r=!1,null===e?void 0!==t.memoizedProps.fallback&&kD(t):(r=null!==(a=e.memoizedState),n||null===a||null!==(a=e.child.sibling)&&(null!==(o=t.firstEffect)?(t.firstEffect=a,a.nextEffect=o):(t.firstEffect=t.lastEffect=a,a.nextEffect=null),a.effectTag=8)),n&&!r&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&$M.current)?IP===gP&&(IP=bP):(IP!==gP&&IP!==bP||(IP=yP),0!==SP&&null!==vP&&(_L(vP,wP),$L(vP,SP)))),(n||r)&&(t.effectTag|=4),null);case 4:return EM(),null;case 10:return XO(t),null;case 17:return cO(t.type)&&dO(),null;case 19:if(rO($M),null===(r=t.memoizedState))return null;if(a=0!=(64&t.effectTag),null===(o=r.rendering)){if(a)UD(r,!1);else if(IP!==gP||null!==e&&0!=(64&e.effectTag))for(o=t.child;null!==o;){if(null!==(e=RM(o))){for(t.effectTag|=64,UD(r,!1),null!==(a=e.updateQueue)&&(t.updateQueue=a,t.effectTag|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=t.child;null!==r;)o=n,(a=r).effectTag&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(e=a.alternate)?(a.childExpirationTime=0,a.expirationTime=o,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null):(a.childExpirationTime=e.childExpirationTime,a.expirationTime=e.expirationTime,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,o=e.dependencies,a.dependencies=null===o?null:{expirationTime:o.expirationTime,firstContext:o.firstContext,responders:o.responders}),r=r.sibling;return aO($M,1&$M.current|2),t.child}o=o.sibling}}else{if(!a)if(null!==(e=RM(o))){if(t.effectTag|=64,a=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),UD(r,!0),null===r.tail&&"hidden"===r.tailMode&&!o.alternate)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*OO()-r.renderingStartTime>r.tailExpiration&&1<n&&(t.effectTag|=64,a=!0,UD(r,!1),t.expirationTime=t.childExpirationTime=n-1);r.isBackwards?(o.sibling=t.child,t.child=o):(null!==(n=r.last)?n.sibling=o:t.child=o,r.last=o)}return null!==r.tail?(0===r.tailExpiration&&(r.tailExpiration=OO()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=OO(),n.sibling=null,t=$M.current,aO($M,a?1&t|2:1&t),n):null}throw Error(e_(156,t.tag))}function jD(e){switch(e.tag){case 1:cO(e.type)&&dO();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(EM(),rO(iO),rO(sO),0!=(64&(t=e.effectTag)))throw Error(e_(285));return e.effectTag=-4097&t|64,e;case 5:return _M(e),null;case 13:return rO($M),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return rO($M),null;case 4:return EM(),null;case 10:return XO(e),null;default:return null}}function GD(e,t){return{value:e,source:t,stack:d$(t)}}OD=function OD(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},MD=function MD(e,t,n,r,a){var o=e.memoizedProps;if(o!==r){var s,i,u=t.stateNode;switch(TM(wM.current),e=null,n){case"input":o=g$(u,o),r=g$(u,r),e=[];break;case"option":o=w$(u,o),r=w$(u,r),e=[];break;case"select":o=QS({},o,{value:void 0}),r=QS({},r,{value:void 0}),e=[];break;case"textarea":o=N$(u,o),r=N$(u,r),e=[];break;default:"function"!=typeof o.onClick&&"function"==typeof r.onClick&&(u.onclick=rA)}for(s in JR(n,r),n=null,o)if(!r.hasOwnProperty(s)&&o.hasOwnProperty(s)&&null!=o[s])if("style"===s)for(i in u=o[s])u.hasOwnProperty(i)&&(n||(n={}),n[i]="");else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(y_.hasOwnProperty(s)?e||(e=[]):(e=e||[]).push(s,null));for(s in r){var l=r[s];if(u=null!=o?o[s]:void 0,r.hasOwnProperty(s)&&l!==u&&(null!=l||null!=u))if("style"===s)if(u){for(i in u)!u.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in l)l.hasOwnProperty(i)&&u[i]!==l[i]&&(n||(n={}),n[i]=l[i])}else n||(e||(e=[]),e.push(s,n)),n=l;else"dangerouslySetInnerHTML"===s?(l=l?l.__html:void 0,u=u?u.__html:void 0,null!=l&&u!==l&&(e=e||[]).push(s,l)):"children"===s?u===l||"string"!=typeof l&&"number"!=typeof l||(e=e||[]).push(s,""+l):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(y_.hasOwnProperty(s)?(null!=l&&nA(a,s),e||u===l||(e=[])):(e=e||[]).push(s,l))}n&&(e=e||[]).push("style",n),a=e,(t.updateQueue=a)&&(t.effectTag|=4)}},DD=function DD(e,t,n,r){n!==r&&(t.effectTag|=4)};var qD="function"==typeof WeakSet?WeakSet:Set;function KD(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=d$(n)),null!==n&&c$(n.type),t=t.value,null!==e&&1===e.tag&&c$(e.type);try{console.error(t)}catch(e){setTimeout((function(){throw e}))}}function XD(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){hL(e,t)}else t.current=null}function YD(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:UO(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(e_(163))}function QD(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.destroy;n.destroy=void 0,void 0!==r&&r()}n=n.next}while(n!==t)}}function ZD(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function JD(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:return void ZD(3,n);case 1:if(e=n.stateNode,4&n.effectTag)if(null===t)e.componentDidMount();else{var r=n.elementType===n.type?t.memoizedProps:UO(n.type,t.memoizedProps);e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=n.updateQueue)&&sM(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}sM(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.effectTag&&pA(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&RR(n)))));case 19:case 17:case 20:case 21:return}throw Error(e_(163))}function eP(e,t,n){switch("function"==typeof yL&&yL(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e.next;PO(97<n?97:n,(function(){var e=r;do{var n=e.destroy;if(void 0!==n){var a=t;try{n()}catch(e){hL(a,e)}}e=e.next}while(e!==r)}))}break;case 1:XD(t),"function"==typeof(n=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){hL(e,t)}}(t,n);break;case 5:XD(t);break;case 4:sP(e,t,n)}}function tP(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&tP(t)}function nP(e){return 5===e.tag||3===e.tag||4===e.tag}function rP(e){e:{for(var t=e.return;null!==t;){if(nP(t)){var n=t;break e}t=t.return}throw Error(e_(160))}switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(e_(161))}16&n.effectTag&&(M$(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||nP(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}r?function aP(e,t,n){var r=e.tag,a=5===r||6===r;if(a)e=a?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=rA));else if(4!==r&&null!==(e=e.child))for(aP(e,t,n),e=e.sibling;null!==e;)aP(e,t,n),e=e.sibling}(e,n,t):function oP(e,t,n){var r=e.tag,a=5===r||6===r;if(a)e=a?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(oP(e,t,n),e=e.sibling;null!==e;)oP(e,t,n),e=e.sibling}(e,n,t)}function sP(e,t,n){for(var r,a,o=t,s=!1;;){if(!s){s=o.return;e:for(;;){if(null===s)throw Error(e_(160));switch(r=s.stateNode,s.tag){case 5:a=!1;break e;case 3:case 4:r=r.containerInfo,a=!0;break e}s=s.return}s=!0}if(5===o.tag||6===o.tag){e:for(var i=e,u=o,l=n,c=u;;)if(eP(i,c,l),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===u)break e;for(;null===c.sibling;){if(null===c.return||c.return===u)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}a?(i=r,u=o.stateNode,8===i.nodeType?i.parentNode.removeChild(u):i.removeChild(u)):r.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){r=o.stateNode.containerInfo,a=!0,o.child.return=o,o=o.child;continue}}else if(eP(e,o,n),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(s=!1)}o.sibling.return=o.return,o=o.sibling}}function iP(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void QD(3,t);case 1:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,a=null!==e?e.memoizedProps:r;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(n[vA]=r,"input"===e&&"radio"===r.type&&null!=r.name&&y$(n,r),eA(e,a),t=eA(e,r),a=0;a<o.length;a+=2){var s=o[a],i=o[a+1];"style"===s?QR(n,i):"dangerouslySetInnerHTML"===s?O$(n,i):"children"===s?M$(n,i):j_(n,s,i,t)}switch(e){case"input":x$(n,r);break;case"textarea":C$(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(e=r.value)?I$(n,!!r.multiple,e,!1):t!==!!r.multiple&&(null!=r.defaultValue?I$(n,!!r.multiple,r.defaultValue,!0):I$(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(e_(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,RR(t.containerInfo)));case 12:return;case 13:if(n=t,null===t.memoizedState?r=!1:(r=!0,n=t.child,$P=OO()),null!==n)e:for(e=n;;){if(5===e.tag)o=e.stateNode,r?"function"==typeof(o=o.style).setProperty?o.setProperty("display","none","important"):o.display="none":(o=e.stateNode,a=null!=(a=e.memoizedProps.style)&&a.hasOwnProperty("display")?a.display:null,o.style.display=YR("display",a));else if(6===e.tag)e.stateNode.nodeValue=r?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(o=e.child.sibling).return=e,e=o;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void uP(t);case 19:return void uP(t);case 17:return}throw Error(e_(163))}function uP(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new qD),t.forEach((function(t){var r=gL.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}var lP="function"==typeof WeakMap?WeakMap:Map;function cP(e,t,n){(n=nM(n,null)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){AP||(AP=!0,FP=r),KD(e,t)},n}function dP(e,t,n){(n=nM(n,null)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var a=t.value;n.payload=function(){return KD(e,t),r(a)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===OP?OP=new Set([this]):OP.add(this),KD(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var pP,fP=Math.ceil,hP=H_.ReactCurrentDispatcher,mP=H_.ReactCurrentOwner,gP=0,bP=3,yP=4,xP=0,vP=null,kP=null,wP=0,IP=gP,NP=null,TP=1073741823,CP=1073741823,EP=null,SP=0,_P=!1,$P=0,RP=null,AP=!1,FP=null,OP=null,MP=!1,DP=null,PP=90,LP=null,BP=0,zP=null,WP=0;function VP(){return 0!=(48&xP)?1073741821-(OO()/10|0):0!==WP?WP:WP=1073741821-(OO()/10|0)}function UP(e,t,n){if(0==(2&(t=t.mode)))return 1073741823;var r=MO();if(0==(4&t))return 99===r?1073741823:1073741822;if(0!=(16&xP))return wP;if(null!==n)e=VO(e,0|n.timeoutMs||5e3,250);else switch(r){case 99:e=1073741823;break;case 98:e=VO(e,150,100);break;case 97:case 96:e=VO(e,5e3,250);break;case 95:e=2;break;default:throw Error(e_(326))}return null!==vP&&e===wP&&--e,e}function HP(e,t){if(50<BP)throw BP=0,zP=null,Error(e_(185));if(null!==(e=jP(e,t))){var n=MO();1073741823===t?0!=(8&xP)&&0==(48&xP)?XP(e):(qP(e),0===xP&&zO()):qP(e),0==(4&xP)||98!==n&&99!==n||(null===LP?LP=new Map([[e,t]]):(void 0===(n=LP.get(e))||n>t)&&LP.set(e,t))}}function jP(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,a=null;if(null===r&&3===e.tag)a=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){a=r.stateNode;break}r=r.return}return null!==a&&(vP===a&&(nL(t),IP===yP&&_L(a,wP)),$L(a,t)),a}function GP(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!SL(e,t=e.firstPendingTime))return t;var n=e.lastPingedTime;return 2>=(e=n>(e=e.nextKnownPendingLevel)?n:e)&&t!==e?0:e}function qP(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=BO(XP.bind(null,e));else{var t=GP(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var r=VP();if(r=1073741823===t?99:1===t||2===t?95:0>=(r=10*(1073741821-t)-10*(1073741821-r))?99:250>=r?98:5250>=r?97:95,null!==n){var a=e.callbackPriority;if(e.callbackExpirationTime===t&&a>=r)return;n!==EO&&yO(n)}e.callbackExpirationTime=t,e.callbackPriority=r,t=1073741823===t?BO(XP.bind(null,e)):LO(r,KP.bind(null,e),{timeout:10*(1073741821-t)-OO()}),e.callbackNode=t}}}function KP(e,t){if(WP=0,t)return RL(e,t=VP()),qP(e),null;var n=GP(e);if(0!==n){if(t=e.callbackNode,0!=(48&xP))throw Error(e_(327));if(dL(),e===vP&&n===wP||ZP(e,n),null!==kP){var r=xP;xP|=16;for(var a=eL();;)try{aL();break}catch(t){JP(e,t)}if(KO(),xP=r,hP.current=a,1===IP)throw t=NP,ZP(e,n),_L(e,n),qP(e),t;if(null===kP)switch(a=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,r=IP,vP=null,r){case gP:case 1:throw Error(e_(345));case 2:RL(e,2<n?2:n);break;case bP:if(_L(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=iL(a)),1073741823===TP&&10<(a=$P+500-OO())){if(_P){var o=e.lastPingedTime;if(0===o||o>=n){e.lastPingedTime=n,ZP(e,n);break}}if(0!==(o=GP(e))&&o!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}e.timeoutHandle=hA(uL.bind(null,e),a);break}uL(e);break;case yP:if(_L(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=iL(a)),_P&&(0===(a=e.lastPingedTime)||a>=n)){e.lastPingedTime=n,ZP(e,n);break}if(0!==(a=GP(e))&&a!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}if(1073741823!==CP?r=10*(1073741821-CP)-OO():1073741823===TP?r=0:(r=10*(1073741821-TP)-5e3,0>(r=(a=OO())-r)&&(r=0),(n=10*(1073741821-n)-a)<(r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*fP(r/1960))-r)&&(r=n)),10<r){e.timeoutHandle=hA(uL.bind(null,e),r);break}uL(e);break;case 5:if(1073741823!==TP&&null!==EP){o=TP;var s=EP;if(0>=(r=0|s.busyMinDurationMs)?r=0:(a=0|s.busyDelayMs,r=(o=OO()-(10*(1073741821-o)-(0|s.timeoutMs||5e3)))<=a?0:a+r-o),10<r){_L(e,n),e.timeoutHandle=hA(uL.bind(null,e),r);break}}uL(e);break;default:throw Error(e_(329))}if(qP(e),e.callbackNode===t)return KP.bind(null,e)}}return null}function XP(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,0!=(48&xP))throw Error(e_(327));if(dL(),e===vP&&t===wP||ZP(e,t),null!==kP){var n=xP;xP|=16;for(var r=eL();;)try{rL();break}catch(t){JP(e,t)}if(KO(),xP=n,hP.current=r,1===IP)throw n=NP,ZP(e,t),_L(e,t),qP(e),n;if(null!==kP)throw Error(e_(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,vP=null,uL(e),qP(e)}return null}function YP(e,t){var n=xP;xP|=1;try{return e(t)}finally{0===(xP=n)&&zO()}}function QP(e,t){var n=xP;xP&=-2,xP|=8;try{return e(t)}finally{0===(xP=n)&&zO()}}function ZP(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,mA(n)),null!==kP)for(n=kP.return;null!==n;){var r=n;switch(r.tag){case 1:null!=(r=r.type.childContextTypes)&&dO();break;case 3:EM(),rO(iO),rO(sO);break;case 5:_M(r);break;case 4:EM();break;case 13:case 19:rO($M);break;case 10:XO(r)}n=n.return}vP=e,kP=wL(e.current,null),wP=t,IP=gP,NP=null,CP=TP=1073741823,EP=null,SP=0,_P=!1}function JP(e,t){for(;;){try{if(KO(),FM.current=cD,BM)for(var n=DM.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}if(MM=0,LM=PM=DM=null,BM=!1,null===kP||null===kP.return)return IP=1,NP=t,kP=null;e:{var a=e,o=kP.return,s=kP,i=t;if(t=wP,s.effectTag|=2048,s.firstEffect=s.lastEffect=null,null!==i&&"object"==_typeof(i)&&"function"==typeof i.then){var u=i;if(0==(2&s.mode)){var l=s.alternate;l?(s.updateQueue=l.updateQueue,s.memoizedState=l.memoizedState,s.expirationTime=l.expirationTime):(s.updateQueue=null,s.memoizedState=null)}var c=0!=(1&$M.current),d=o;do{var p;if(p=13===d.tag){var f=d.memoizedState;if(null!==f)p=null!==f.dehydrated;else{var h=d.memoizedProps;p=void 0!==h.fallback&&(!0!==h.unstable_avoidThisFallback||!c)}}if(p){var m=d.updateQueue;if(null===m){var g=new Set;g.add(u),d.updateQueue=g}else m.add(u);if(0==(2&d.mode)){if(d.effectTag|=64,s.effectTag&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var b=nM(1073741823,null);b.tag=2,rM(s,b)}s.expirationTime=1073741823;break e}i=void 0,s=t;var y=a.pingCache;if(null===y?(y=a.pingCache=new lP,i=new Set,y.set(u,i)):void 0===(i=y.get(u))&&(i=new Set,y.set(u,i)),!i.has(s)){i.add(s);var x=mL.bind(null,a,u,s);u.then(x,x)}d.effectTag|=4096,d.expirationTime=t;break e}d=d.return}while(null!==d);i=Error((c$(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+d$(s))}5!==IP&&(IP=2),i=GD(i,s),d=o;do{switch(d.tag){case 3:u=i,d.effectTag|=4096,d.expirationTime=t,aM(d,cP(d,u,t));break e;case 1:u=i;var v=d.type,k=d.stateNode;if(0==(64&d.effectTag)&&("function"==typeof v.getDerivedStateFromError||null!==k&&"function"==typeof k.componentDidCatch&&(null===OP||!OP.has(k)))){d.effectTag|=4096,d.expirationTime=t,aM(d,dP(d,u,t));break e}}d=d.return}while(null!==d)}kP=sL(kP)}catch(e){t=e;continue}break}}function eL(){var e=hP.current;return hP.current=cD,null===e?cD:e}function tL(e,t){e<TP&&2<e&&(TP=e),null!==t&&e<CP&&2<e&&(CP=e,EP=t)}function nL(e){e>SP&&(SP=e)}function rL(){for(;null!==kP;)kP=oL(kP)}function aL(){for(;null!==kP&&!SO();)kP=oL(kP)}function oL(e){var t=pP(e.alternate,e,wP);return e.memoizedProps=e.pendingProps,null===t&&(t=sL(e)),mP.current=null,t}function sL(e){kP=e;do{var t=kP.alternate;if(e=kP.return,0==(2048&kP.effectTag)){if(t=HD(t,kP,wP),1===wP||1!==kP.childExpirationTime){for(var n=0,r=kP.child;null!==r;){var a=r.expirationTime,o=r.childExpirationTime;a>n&&(n=a),o>n&&(n=o),r=r.sibling}kP.childExpirationTime=n}if(null!==t)return t;null!==e&&0==(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=kP.firstEffect),null!==kP.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=kP.firstEffect),e.lastEffect=kP.lastEffect),1<kP.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=kP:e.firstEffect=kP,e.lastEffect=kP))}else{if(null!==(t=jD(kP)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=kP.sibling))return t;kP=e}while(null!==kP);return IP===gP&&(IP=5),null}function iL(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function uL(e){var t=MO();return PO(99,lL.bind(null,e,t)),null}function lL(e,t){do{dL()}while(null!==DP);if(0!=(48&xP))throw Error(e_(327));var n=e.finishedWork,r=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(e_(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var a=iL(n);if(e.firstPendingTime=a,r<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:r<=e.firstSuspendedTime&&(e.firstSuspendedTime=r-1),r<=e.lastPingedTime&&(e.lastPingedTime=0),r<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===vP&&(kP=vP=null,wP=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,a=n.firstEffect):a=n:a=n.firstEffect,null!==a){var o=xP;xP|=32,mP.current=null,cA=WR;var s=uA();if(lA(s)){if("selectionStart"in s)var i={start:s.selectionStart,end:s.selectionEnd};else e:{var u=(i=(i=s.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(u&&0!==u.rangeCount){i=u.anchorNode;var l=u.anchorOffset,c=u.focusNode;u=u.focusOffset;try{i.nodeType,c.nodeType}catch(e){i=null;break e}var d=0,p=-1,f=-1,h=0,m=0,g=s,b=null;t:for(;;){for(var y;g!==i||0!==l&&3!==g.nodeType||(p=d+l),g!==c||0!==u&&3!==g.nodeType||(f=d+u),3===g.nodeType&&(d+=g.nodeValue.length),null!==(y=g.firstChild);)b=g,g=y;for(;;){if(g===s)break t;if(b===i&&++h===l&&(p=d),b===c&&++m===u&&(f=d),null!==(y=g.nextSibling))break;b=(g=b).parentNode}g=y}i=-1===p||-1===f?null:{start:p,end:f}}else i=null}i=i||{start:0,end:0}}else i=null;dA={activeElementDetached:null,focusedElem:s,selectionRange:i},WR=!1,RP=a;do{try{cL()}catch(e){if(null===RP)throw Error(e_(330));hL(RP,e),RP=RP.nextEffect}}while(null!==RP);RP=a;do{try{for(s=e,i=t;null!==RP;){var x=RP.effectTag;if(16&x&&M$(RP.stateNode,""),128&x){var v=RP.alternate;if(null!==v){var k=v.ref;null!==k&&("function"==typeof k?k(null):k.current=null)}}switch(1038&x){case 2:rP(RP),RP.effectTag&=-3;break;case 6:rP(RP),RP.effectTag&=-3,iP(RP.alternate,RP);break;case 1024:RP.effectTag&=-1025;break;case 1028:RP.effectTag&=-1025,iP(RP.alternate,RP);break;case 4:iP(RP.alternate,RP);break;case 8:sP(s,l=RP,i),tP(l)}RP=RP.nextEffect}}catch(e){if(null===RP)throw Error(e_(330));hL(RP,e),RP=RP.nextEffect}}while(null!==RP);if(k=dA,v=uA(),x=k.focusedElem,i=k.selectionRange,v!==x&&x&&x.ownerDocument&&function iA(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?iA(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}(x.ownerDocument.documentElement,x)){null!==i&&lA(x)&&(v=i.start,void 0===(k=i.end)&&(k=v),"selectionStart"in x?(x.selectionStart=v,x.selectionEnd=Math.min(k,x.value.length)):(k=(v=x.ownerDocument||document)&&v.defaultView||window).getSelection&&(k=k.getSelection(),l=x.textContent.length,s=Math.min(i.start,l),i=void 0===i.end?s:Math.min(i.end,l),!k.extend&&s>i&&(l=i,i=s,s=l),l=sA(x,s),c=sA(x,i),l&&c&&(1!==k.rangeCount||k.anchorNode!==l.node||k.anchorOffset!==l.offset||k.focusNode!==c.node||k.focusOffset!==c.offset)&&((v=v.createRange()).setStart(l.node,l.offset),k.removeAllRanges(),s>i?(k.addRange(v),k.extend(c.node,c.offset)):(v.setEnd(c.node,c.offset),k.addRange(v))))),v=[];for(k=x;k=k.parentNode;)1===k.nodeType&&v.push({element:k,left:k.scrollLeft,top:k.scrollTop});for("function"==typeof x.focus&&x.focus(),x=0;x<v.length;x++)(k=v[x]).element.scrollLeft=k.left,k.element.scrollTop=k.top}WR=!!cA,dA=cA=null,e.current=n,RP=a;do{try{for(x=e;null!==RP;){var w=RP.effectTag;if(36&w&&JD(x,RP.alternate,RP),128&w){v=void 0;var I=RP.ref;if(null!==I){var N=RP.stateNode;switch(RP.tag){case 5:v=N;break;default:v=N}"function"==typeof I?I(v):I.current=v}}RP=RP.nextEffect}}catch(e){if(null===RP)throw Error(e_(330));hL(RP,e),RP=RP.nextEffect}}while(null!==RP);RP=null,_O(),xP=o}else e.current=n;if(MP)MP=!1,DP=e,PP=t;else for(RP=a;null!==RP;)t=RP.nextEffect,RP.nextEffect=null,RP=t;if(0===(t=e.firstPendingTime)&&(OP=null),1073741823===t?e===zP?BP++:(BP=0,zP=e):BP=0,"function"==typeof bL&&bL(n.stateNode,r),qP(e),AP)throw AP=!1,e=FP,FP=null,e;return 0!=(8&xP)||zO(),null}function cL(){for(;null!==RP;){var e=RP.effectTag;0!=(256&e)&&YD(RP.alternate,RP),0==(512&e)||MP||(MP=!0,LO(97,(function(){return dL(),null}))),RP=RP.nextEffect}}function dL(){if(90!==PP){var e=97<PP?97:PP;return PP=90,PO(e,pL)}}function pL(){if(null===DP)return!1;var e=DP;if(DP=null,0!=(48&xP))throw Error(e_(331));var t=xP;for(xP|=32,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!=(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:QD(5,n),ZD(5,n)}}catch(t){if(null===e)throw Error(e_(330));hL(e,t)}n=e.nextEffect,e.nextEffect=null,e=n}return xP=t,zO(),!0}function fL(e,t,n){rM(e,t=cP(e,t=GD(n,t),1073741823)),null!==(e=jP(e,1073741823))&&qP(e)}function hL(e,t){if(3===e.tag)fL(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){fL(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===OP||!OP.has(r))){rM(n,e=dP(n,e=GD(t,e),1073741823)),null!==(n=jP(n,1073741823))&&qP(n);break}}n=n.return}}function mL(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),vP===e&&wP===n?IP===yP||IP===bP&&1073741823===TP&&OO()-$P<500?ZP(e,wP):_P=!0:SL(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,qP(e)))}function gL(e,t){var n=e.stateNode;null!==n&&n.delete(t),0==(t=0)&&(t=UP(t=VP(),e,null)),null!==(e=jP(e,t))&&qP(e)}pP=function pP(e,t,n){var r=t.expirationTime;if(null!==e){var a=t.pendingProps;if(e.memoizedProps!==a||iO.current)ND=!0;else{if(r<n){switch(ND=!1,t.tag){case 3:FD(t),wD();break;case 5:if(SM(t),4&t.mode&&1!==n&&a.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:cO(t.type)&&hO(t);break;case 4:CM(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value,a=t.type._context,aO(HO,a._currentValue),a._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?LD(e,t,n):(aO($M,1&$M.current),null!==(t=VD(e,t,n))?t.sibling:null);aO($M,1&$M.current);break;case 19:if(r=t.childExpirationTime>=n,0!=(64&e.effectTag)){if(r)return WD(e,t,n);t.effectTag|=64}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null),aO($M,$M.current),!r)return null}return VD(e,t,n)}ND=!1}}else ND=!1;switch(t.expirationTime=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,a=lO(t,sO.current),QO(t,n),a=VM(null,t,r,e,a,n),t.effectTag|=1,"object"==_typeof(a)&&null!==a&&"function"==typeof a.render&&void 0===a.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,cO(r)){var o=!0;hO(t)}else o=!1;t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,eM(t);var s=r.getDerivedStateFromProps;"function"==typeof s&&lM(t,r,s,e),a.updater=cM,t.stateNode=a,a._reactInternalFiber=t,hM(t,r,e,n),t=AD(null,t,r,!0,o,n)}else t.tag=0,TD(null,t,a,n),t=t.child;return t;case 16:e:{if(a=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(a),1!==a._status)throw a._result;switch(a=a._result,t.type=a,o=t.tag=function(e){if("function"==typeof e)return kL(e)?1:0;if(null!=e){if((e=e.$$typeof)===n$)return 11;if(e===o$)return 14}return 2}(a),e=UO(a,e),o){case 0:t=$D(null,t,a,e,n);break e;case 1:t=RD(null,t,a,e,n);break e;case 11:t=CD(null,t,a,e,n);break e;case 14:t=ED(null,t,a,UO(a.type,e),r,n);break e}throw Error(e_(306,a,""))}return t;case 0:return r=t.type,a=t.pendingProps,$D(e,t,r,a=t.elementType===r?a:UO(r,a),n);case 1:return r=t.type,a=t.pendingProps,RD(e,t,r,a=t.elementType===r?a:UO(r,a),n);case 3:if(FD(t),r=t.updateQueue,null===e||null===r)throw Error(e_(282));if(r=t.pendingProps,a=null!==(a=t.memoizedState)?a.element:null,tM(e,t),oM(t,r,null,n),(r=t.memoizedState.element)===a)wD(),t=VD(e,t,n);else{if((a=t.stateNode.hydrate)&&(mD=gA(t.stateNode.containerInfo.firstChild),hD=t,a=gD=!0),a)for(n=vM(t,null,r,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else TD(e,t,r,n),wD();t=t.child}return t;case 5:return SM(t),null===e&&xD(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,fA(r,a)?s=null:null!==o&&fA(r,o)&&(t.effectTag|=16),_D(e,t),4&t.mode&&1!==n&&a.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(TD(e,t,s,n),t=t.child),t;case 6:return null===e&&xD(t),null;case 13:return LD(e,t,n);case 4:return CM(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=xM(t,null,r,n):TD(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,CD(e,t,r,a=t.elementType===r?a:UO(r,a),n);case 7:return TD(e,t,t.pendingProps,n),t.child;case 8:case 12:return TD(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,a=t.pendingProps,s=t.memoizedProps,o=a.value;var i=t.type._context;if(aO(HO,i._currentValue),i._currentValue=o,null!==s)if(i=s.value,0==(o=AF(i,o)?0:0|("function"==typeof r._calculateChangedBits?r._calculateChangedBits(i,o):1073741823))){if(s.children===a.children&&!iO.current){t=VD(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var u=i.dependencies;if(null!==u){s=i.child;for(var l=u.firstContext;null!==l;){if(l.context===r&&0!=(l.observedBits&o)){1===i.tag&&((l=nM(n,null)).tag=2,rM(i,l)),i.expirationTime<n&&(i.expirationTime=n),null!==(l=i.alternate)&&l.expirationTime<n&&(l.expirationTime=n),YO(i.return,n),u.expirationTime<n&&(u.expirationTime=n);break}l=l.next}}else s=10===i.tag&&i.type===t.type?null:i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===t){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}TD(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=(o=t.pendingProps).children,QO(t,n),r=r(a=ZO(a,o.unstable_observedBits)),t.effectTag|=1,TD(e,t,r,n),t.child;case 14:return o=UO(a=t.type,t.pendingProps),ED(e,t,a,o=UO(a.type,o),r,n);case 15:return SD(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:UO(r,a),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,cO(r)?(e=!0,hO(t)):e=!1,QO(t,n),pM(t,r,a),hM(t,r,a,n),AD(null,t,r,!0,e,n);case 19:return WD(e,t,n)}throw Error(e_(156,t.tag))};var bL=null,yL=null;function xL(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function vL(e,t,n,r){return new xL(e,t,n,r)}function kL(e){return!(!(e=e.prototype)||!e.isReactComponent)}function wL(e,t){var n=e.alternate;return null===n?((n=vL(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function IL(e,t,n,r,a,o){var s=2;if(r=e,"function"==typeof e)kL(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case Y_:return NL(n.children,a,o,t);case t$:s=8,a|=7;break;case Q_:s=8,a|=1;break;case Z_:return(e=vL(12,n,t,8|a)).elementType=Z_,e.type=Z_,e.expirationTime=o,e;case r$:return(e=vL(13,n,t,a)).type=r$,e.elementType=r$,e.expirationTime=o,e;case a$:return(e=vL(19,n,t,a)).elementType=a$,e.expirationTime=o,e;default:if("object"==_typeof(e)&&null!==e)switch(e.$$typeof){case J_:s=10;break e;case e$:s=9;break e;case n$:s=11;break e;case o$:s=14;break e;case s$:s=16,r=null;break e;case i$:s=22;break e}throw Error(e_(130,null==e?e:_typeof(e),""))}return(t=vL(s,n,t,a)).elementType=e,t.type=r,t.expirationTime=o,t}function NL(e,t,n,r){return(e=vL(7,e,r,t)).expirationTime=n,e}function TL(e,t,n){return(e=vL(6,e,null,t)).expirationTime=n,e}function CL(e,t,n){return(t=vL(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function EL(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function SL(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function _L(e,t){var n=e.firstSuspendedTime,r=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(r>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function $L(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function RL(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function AL(e,t,n,r){var a=t.current,o=VP(),s=iM.suspense;o=UP(o,a,s);e:if(n){t:{if(K$(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(e_(170));var i=n;do{switch(i.tag){case 3:i=i.stateNode.context;break t;case 1:if(cO(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break t}}i=i.return}while(null!==i);throw Error(e_(171))}if(1===n.tag){var u=n.type;if(cO(u)){n=fO(n,u,i);break e}}n=i}else n=oO;return null===t.context?t.context=n:t.pendingContext=n,(t=nM(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),rM(a,t),HP(a,o),o}function FL(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function OL(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function ML(e,t){OL(e,t),(e=e.alternate)&&OL(e,t)}function DL(e,t,n){var r=new EL(e,t,n=null!=n&&!0===n.hydrate),a=vL(3,null,null,2===t?7:1===t?3:0);r.current=a,a.stateNode=r,eM(a),e[kA]=r.current,n&&0!==t&&function(e,t){var n=q$(t);kR.forEach((function(e){lR(e,t,n)})),wR.forEach((function(e){lR(e,t,n)}))}(0,9===e.nodeType?e:e.ownerDocument),this._internalRoot=r}function PL(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function LL(e,t,n,r,a){var o=n._reactRootContainer;if(o){var s=o._internalRoot;if("function"==typeof a){var i=a;a=function a(){var e=FL(s);i.call(e)}}AL(t,s,e,a)}else{if(o=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new DL(e,0,t?{hydrate:!0}:void 0)}(n,r),s=o._internalRoot,"function"==typeof a){var u=a;a=function a(){var e=FL(s);u.call(e)}}QP((function(){AL(t,s,e,a)}))}return FL(s)}function BL(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:X_,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function zL(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!PL(t))throw Error(e_(200));return BL(e,t,null,n)}DL.prototype.render=function(e){AL(e,this._internalRoot,null,null)},DL.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;AL(null,e,null,(function(){t[kA]=null}))},cR=function cR(e){if(13===e.tag){var t=VO(VP(),150,100);HP(e,t),ML(e,t)}},dR=function dR(e){13===e.tag&&(HP(e,3),ML(e,3))},pR=function pR(e){if(13===e.tag){var t=VP();HP(e,t=UP(t,e,null)),ML(e,t)}},w_=function w_(e,t,n){switch(t){case"input":if(x$(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=TA(r);if(!a)throw Error(e_(90));m$(r),x$(r,a)}}}break;case"textarea":C$(e,n);break;case"select":null!=(t=n.value)&&I$(e,!!n.multiple,t,!1)}},S_=YP,__=function __(e,t,n,r,a){var o=xP;xP|=4;try{return PO(98,e.bind(null,t,n,r,a))}finally{0===(xP=o)&&zO()}},$_=function $_(){0==(49&xP)&&(function(){if(null!==LP){var e=LP;LP=null,e.forEach((function(e,t){RL(t,e),qP(t)})),zO()}}(),dL())},R_=function R_(e,t){var n=xP;xP|=2;try{return e(t)}finally{0===(xP=n)&&zO()}};var WL={Events:[IA,NA,TA,v_,b_,AA,function(e){J$(e,RA)},C_,E_,GR,nR,dL,{current:!1}]};!function(e){var t=e.findFiberByHostInstance;!function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);bL=function bL(e){try{t.onCommitFiberRoot(n,e,void 0,64==(64&e.current.effectTag))}catch(e){}},yL=function yL(e){try{t.onCommitFiberUnmount(n,e)}catch(e){}}}catch(e){}}(QS({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:H_.ReactCurrentDispatcher,findHostInstanceByFiber:function findHostInstanceByFiber(e){return null===(e=Q$(e))?null:e.stateNode},findFiberByHostInstance:function findFiberByHostInstance(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:wA,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"});var VL={__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:WL,createPortal:zL,findDOMNode:function findDOMNode(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"==typeof e.render)throw Error(e_(188));throw Error(e_(268,Object.keys(e)))}return null===(e=Q$(t))?null:e.stateNode},flushSync:function flushSync(e,t){if(0!=(48&xP))throw Error(e_(187));var n=xP;xP|=1;try{return PO(99,e.bind(null,t))}finally{xP=n,zO()}},hydrate:function hydrate(e,t,n){if(!PL(t))throw Error(e_(200));return LL(null,e,t,!0,n)},render:function render(e,t,n){if(!PL(t))throw Error(e_(200));return LL(null,e,t,!1,n)},unmountComponentAtNode:function unmountComponentAtNode(e){if(!PL(e))throw Error(e_(40));return!!e._reactRootContainer&&(QP((function(){LL(null,null,e,!1,(function(){e._reactRootContainer=null,e[kA]=null}))})),!0)},unstable_batchedUpdates:YP,unstable_createPortal:function unstable_createPortal(e,t){return zL(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},unstable_renderSubtreeIntoContainer:function unstable_renderSubtreeIntoContainer(e,t,n,r){if(!PL(n))throw Error(e_(200));if(null==e||void 0===e._reactInternalFiber)throw Error(e_(38));return LL(e,t,n,!1,r)},version:"16.14.0"},UL=0,HL={__interactionsRef:null,__subscriberRef:null,unstable_clear:function unstable_clear(e){return e()},unstable_getCurrent:function unstable_getCurrent(){return null},unstable_getThreadID:function unstable_getThreadID(){return++UL},unstable_subscribe:function unstable_subscribe(){},unstable_trace:function unstable_trace(e,t,n){return n()},unstable_unsubscribe:function unstable_unsubscribe(){},unstable_wrap:function unstable_wrap(e){return e}},jL=(U((function(e,t){})),U((function(e){e.exports=HL})),U((function(e,t){})),U((function(e){!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=VL}))),qL=react__WEBPACK_IMPORTED_MODULE_126___default.a.createContext(null),KL="entering",XL="entered",YL=function(t){function n(e,n){var r;r=t.call(this,e,n)||this;var a,o=n&&!n.isMounting?e.enter:e.appear;return r.appearStatus=null,e.in?o?(a="exited",r.appearStatus=KL):a=XL:a=e.unmountOnExit||e.mountOnEnter?"unmounted":"exited",r.state={status:a},r.nextCallback=null,r}jS(n,t),n.getDerivedStateFromProps=function(e,t){return e.in&&"unmounted"===t.status?{status:"exited"}:null};var r=n.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==KL&&n!==XL&&(t=KL):n!==KL&&n!==XL||(t="exiting")}this.updateStatus(!1,t)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var e,t,n,r=this.props.timeout;return e=t=n=r,null!=r&&"number"!=typeof r&&(e=r.exit,t=r.enter,n=void 0!==r.appear?r.appear:t),{exit:e,enter:t,appear:n}},r.updateStatus=function(e,t){void 0===e&&(e=!1),null!==t?(this.cancelNextCallback(),t===KL?this.performEnter(e):this.performExit()):this.props.unmountOnExit&&"exited"===this.state.status&&this.setState({status:"unmounted"})},r.performEnter=function(e){var t=this,n=this.props.enter,r=this.context?this.context.isMounting:e,a=this.props.nodeRef?[r]:[jL.findDOMNode(this),r],o=a[0],s=a[1],i=this.getTimeouts(),u=r?i.appear:i.enter;e||n?(this.props.onEnter(o,s),this.safeSetState({status:KL},(function(){t.props.onEntering(o,s),t.onTransitionEnd(u,(function(){t.safeSetState({status:XL},(function(){t.props.onEntered(o,s)}))}))}))):this.safeSetState({status:XL},(function(){t.props.onEntered(o)}))},r.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),r=this.props.nodeRef?void 0:jL.findDOMNode(this);t?(this.props.onExit(r),this.safeSetState({status:"exiting"},(function(){e.props.onExiting(r),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:"exited"},(function(){e.props.onExited(r)}))}))}))):this.safeSetState({status:"exited"},(function(){e.props.onExited(r)}))},r.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},r.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(r){n&&(n=!1,t.nextCallback=null,e(r))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},r.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:jL.findDOMNode(this),r=null==e&&!this.props.addEndListener;if(n&&!r){if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],o=a[0],s=a[1];this.props.addEndListener(o,s)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},r.render=function(){var t=this.state.status;if("unmounted"===t)return null;var n=this.props,r=n.children,a=(n.in,n.mountOnEnter,n.unmountOnExit,n.appear,n.enter,n.exit,n.timeout,n.addEndListener,n.onEnter,n.onEntering,n.onEntered,n.onExit,n.onExiting,n.onExited,n.nodeRef,HS(n,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(qL.Provider,{value:null},"function"==typeof r?r(t,a):react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(react__WEBPACK_IMPORTED_MODULE_126___default.a.Children.only(r),a))},n}(react__WEBPACK_IMPORTED_MODULE_126___default.a.Component);function QL(){}YL.contextType=qL,YL.propTypes={},YL.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:QL,onEntering:QL,onEntered:QL,onExit:QL,onExiting:QL,onExited:QL},YL.UNMOUNTED="unmounted",YL.EXITED="exited",YL.ENTERING=KL,YL.ENTERED=XL,YL.EXITING="exiting";var ZL,JL,tB=function tB(e,t){return e&&t&&t.split(" ").forEach((function(t){return r=t,void((n=e).classList?n.classList.remove(r):"string"==typeof n.className?n.className=GS(n.className,r):n.setAttribute("class",GS(n.className&&n.className.baseVal||"",r)));var n,r}))},nB=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this).appliedClasses={appear:{},enter:{},exit:{}},e.onEnter=function(t,n){var r=e.resolveArguments(t,n),a=r[0],o=r[1];e.removeClasses(a,"exit"),e.addClass(a,o?"appear":"enter","base"),e.props.onEnter&&e.props.onEnter(t,n)},e.onEntering=function(t,n){var r=e.resolveArguments(t,n),a=r[0],o=r[1]?"appear":"enter";e.addClass(a,o,"active"),e.props.onEntering&&e.props.onEntering(t,n)},e.onEntered=function(t,n){var r=e.resolveArguments(t,n),a=r[0],o=r[1]?"appear":"enter";e.removeClasses(a,o),e.addClass(a,o,"done"),e.props.onEntered&&e.props.onEntered(t,n)},e.onExit=function(t){var n=e.resolveArguments(t)[0];e.removeClasses(n,"appear"),e.removeClasses(n,"enter"),e.addClass(n,"exit","base"),e.props.onExit&&e.props.onExit(t)},e.onExiting=function(t){var n=e.resolveArguments(t)[0];e.addClass(n,"exit","active"),e.props.onExiting&&e.props.onExiting(t)},e.onExited=function(t){var n=e.resolveArguments(t)[0];e.removeClasses(n,"exit"),e.addClass(n,"exit","done"),e.props.onExited&&e.props.onExited(t)},e.resolveArguments=function(t,n){return e.props.nodeRef?[e.props.nodeRef.current,t]:[t,n]},e.getClassNames=function(t){var n=e.props.classNames,r="string"==typeof n,a=r?(r&&n?n+"-":"")+t:n[t];return{baseClassName:a,activeClassName:r?a+"-active":n[t+"Active"],doneClassName:r?a+"-done":n[t+"Done"]}},e}jS(n,t);var r=n.prototype;return r.addClass=function(e,t,n){var r=this.getClassNames(t)[n+"ClassName"],a=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===n&&a&&(r+=" "+a),"active"===n&&e&&e.scrollTop,r&&(this.appliedClasses[t][n]=r,function eB(e,t){e&&t&&t.split(" ").forEach((function(t){return r=t,void((n=e).classList?n.classList.add(r):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(n,r)||("string"==typeof n.className?n.className=n.className+" "+r:n.setAttribute("class",(n.className&&n.className.baseVal||"")+" "+r)));var n,r}))}(e,r))},r.removeClasses=function(e,t){var n=this.appliedClasses[t],r=n.base,a=n.active,o=n.done;this.appliedClasses[t]={},r&&tB(e,r),a&&tB(e,a),o&&tB(e,o)},r.render=function(){var t=this.props,n=(t.classNames,HS(t,["classNames"]));return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(YL,US({},n,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},n}(react__WEBPACK_IMPORTED_MODULE_126___default.a.Component);nB.defaultProps={classNames:""},nB.propTypes={};var rB="out-in",aB="in-out",oB=function oB(e,t,n){return function(){var r;e.props[t]&&(r=e.props)[t].apply(r,arguments),n()}},sB=((ZL={})[rB]=function(t){var n=t.current,r=t.changeState;return react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(n,{in:!1,onExited:oB(n,"onExited",(function(){r(KL,null)}))})},ZL[aB]=function(t){var n=t.current,r=t.changeState,a=t.children;return[n,react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(a,{in:!0,onEntered:oB(a,"onEntered",(function(){r(KL)}))})]},ZL),iB=((JL={})[rB]=function(t){var n=t.children,r=t.changeState;return react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(n,{in:!0,onEntered:oB(n,"onEntered",(function(){r(XL,react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(n,{in:!0}))}))})},JL[aB]=function(t){var n=t.current,r=t.children,a=t.changeState;return[react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(n,{in:!1,onExited:oB(n,"onExited",(function(){a(XL,react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(r,{in:!0}))}))}),react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(r,{in:!0})]},JL),uB=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this).state={status:XL,current:null},e.appeared=!1,e.changeState=function(t,n){void 0===n&&(n=e.state.current),e.setState({status:t,current:n})},e}jS(n,t);var r=n.prototype;return r.componentDidMount=function(){this.appeared=!0},n.getDerivedStateFromProps=function(t,n){return null==t.children?{current:null}:n.status===KL&&t.mode===aB?{status:KL}:!n.current||((r=n.current)===(a=t.children)||react__WEBPACK_IMPORTED_MODULE_126___default.a.isValidElement(r)&&react__WEBPACK_IMPORTED_MODULE_126___default.a.isValidElement(a)&&null!=r.key&&r.key===a.key)?{current:react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(t.children,{in:!0})}:{status:"exiting"};var r,a},r.render=function(){var t,n=this.props,r=n.children,a=n.mode,o=this.state,s=o.status,i=o.current,u={children:r,current:i,changeState:this.changeState,status:s};switch(s){case KL:t=iB[a](u);break;case"exiting":t=sB[a](u);break;case XL:t=i}return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(qL.Provider,{value:{isMounting:!this.appeared}},t)},n}(react__WEBPACK_IMPORTED_MODULE_126___default.a.Component);uB.propTypes={},uB.defaultProps={mode:rB};var lB=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.IDCardSide,cB=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.Errors;function dB(e){return pB.apply(this,arguments)}function pB(){return(pB=$(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.image,r=t.cardType,a=t.cardSide,o=t.apiClient,e.abrupt("return",o.uploadImage({file:n,label:"id_card.".concat(r,".").concat(a)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fB(e){return hB.apply(this,arguments)}function hB(){return(hB=$(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.imageId,r=t.cardType,a=t.apiClient,e.abrupt("return",a.requestVerifyIDCard({card_type:r,image1:{id:n}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mB(e){return gB.apply(this,arguments)}function gB(){return(gB=$(regeneratorRuntime.mark((function e(t){var n,r,a,o,s,i,u,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.apiClient,r=t.cardType,a=t.frontCardId,o=t.isCapturingFrontSide,s=t.backCardId,i=t.recordedVideos,u=i.filter((function(e){return null!==e.id})),l=i.filter((function(e){return null===e.id&&e.frames.length>0})),e.next=5,Promise.all(l.map((function(e){return n.fileService.request({frames:e.frames})})));case 5:return c=e.sent,e.abrupt("return",n.detectIDTampering({card_type:r,image:{id:a},image2:o?void 0:{id:s},videos:[].concat(L(u.map((function(e){return{id:e.id}}))),L(c.map((function(e){return{id:e.data.file_id}}))))}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bB(e){return yB.apply(this,arguments)}function yB(){return(yB=$(regeneratorRuntime.mark((function e(t){var n,r,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.cardType,r=t.apiClient,a=t.frontCardId,o=t.backCardId,s=t.isCapturingFrontSide,e.abrupt("return",r.readIDCard({card_type:n,image1:s?{id:a}:{id:o}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xB(e){return vB.apply(this,arguments)}function vB(){return(vB=$(regeneratorRuntime.mark((function e(t){var n,r,a,o,s,i,u,l,c,d,p,f,h,m,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.image,r=t.frontCardId,a=t.onError,o=t.recordedVideos,s=t.apiClient,i=t.cardType,(u=t.cardSide)!==lB.BACK||r){e.next=4;break}return a(cB.missing_front_id_card),e.abrupt("return");case 4:return e.next=6,dB({image:n,cardType:i,cardSide:u,apiClient:s});case 6:if(!(l=e.sent).errors){e.next=10;break}return a(M(M({},cB.upload_error),{},{details:l.errors})),e.abrupt("return");case 10:return c=l.data.image_id,(f=u===lB.FRONT)?d=c:(d=r,p=c),e.next=15,fB({imageId:c,cardType:i,apiClient:s});case 15:if(!(h=e.sent).errors){e.next=19;break}return a(M(M({},cB.sanity_check_error),{},{details:h.errors})),e.abrupt("return");case 19:return e.next=21,bB({cardType:i,apiClient:s,frontCardId:d,backCardId:p,isCapturingFrontSide:f});case 21:if(!(m=e.sent).errors){e.next=25;break}return a(M(M({},cB.read_id_card_error),{},{details:m.errors})),e.abrupt("return");case 25:return e.next=27,mB({apiClient:s,cardType:i,frontCardId:d,isCapturingFrontSide:f,backCardId:p,recordedVideos:o});case 27:if(!(g=e.sent).errors){e.next=31;break}return a(M(M({},cB.detect_id_tampering_error),{},{details:g.errors})),e.abrupt("return");case 31:return e.abrupt("return",{sanityResult:h.data,tamperingInfo:g.data,cardInfo:m.data});case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var kB=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.Errors;function wB(e,t){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)}function IB(e,t){return Math.sqrt(wB(e,t))}function NB(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.canvas,n=e.imgMargin,r=void 0===n?.15:n,a=t.width,o=t.height,s=r;s<1&&(s=parseInt(.5*(o+a)*s,10));var i=a+2*s,u=o+2*s,l=s,c=s,d=document.createElement("canvas");d.width=i,d.height=u;var p=d.getContext("2d");return p.fillStyle="#000000",p.fillRect(0,0,d.width,d.height),p.drawImage(t,0,0,t.width,t.height,l,c,t.width,t.height),{canvas:d,margin:s}}function TB(e,t){var n=window.cv,r=P(t.map((function(e){return e.location})),4),a=r[0],o=r[1],s=r[2],i=r[3],u=IB(s,i),l=IB(o,a),c=Math.max(u,l),d=IB(o,s),p=IB(a,i),f=Math.max(d,p),h=[a.x,a.y,o.x,o.y,s.x,s.y,i.x,i.y],m=[0,0,c-1,0,c-1,f-1,0,f-1],g=n.imread(e),b=new n.Mat,y=new n.Size(c,f),x=n.matFromArray(4,1,n.CV_32FC2,h),v=n.matFromArray(4,1,n.CV_32FC2,m),k=n.getPerspectiveTransform(x,v);n.warpPerspective(g,b,k,y,n.INTER_LINEAR,n.BORDER_CONSTANT,new n.Scalar);var w=new ImageData(new Uint8ClampedArray(b.data),b.cols,b.rows);return g.delete(),b.delete(),x.delete(),v.delete(),w}function CB(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},a={x:n.x-e.x,y:n.y-e.y},o=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)),s=Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2));return 180*Math.acos((r.x*a.x+r.y*a.y)/(o*s))/Math.PI}function EB(e){var t=e.corners,n=e.width,r=e.height,a=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;t.forEach((function(e){var t=e.location,n=t.x,r=t.y;a=Math.min(a,n),o=Math.min(o,r),s=Math.max(s,n),i=Math.max(i,r)}));var u=.06;return!(a/n<u||o/r<u||(r-i)/r<u||(n-s)/n<u)}function SB(){return _B.apply(this,arguments)}function _B(){return(_B=$(regeneratorRuntime.mark((function e(){var t,n,r,a,o,s,i,u,l,c,d,p,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:{},n=t.canvas,r=t.paddingPercent,a=void 0===r?.04:r,o=n.width,s=n.height,i=Math.floor(o*a),u=Math.floor(s*a),l=o-2*i,c=s-2*u,d=document.createElement("canvas"),p=d.getContext("2d"),d.width=l,d.height=c,p.drawImage(n,i,u,l,c,0,0,l,c),e.abrupt("return",_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.h.isCardGlare(d));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $B(e){for(var t=e.length,n=0;n<t;n++){var r=(n+t-1)%t,a=(n+1)%t,o=CB(e[n].location,e[r].location,e[a].location);if(o<70||o>110)return!1}return!0}function RB(e){return AB.apply(this,arguments)}function AB(){return(AB=$(regeneratorRuntime.mark((function e(t){var n,r,a,o,s,i,u,l,c,d,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.blazefaceModel,r=t.predictedIdCardCanvas,a=t.frontSide,o=r.width,s=r.height,i=Math.floor(o/3),u=Math.floor(4*s/5),l=document.createElement("canvas"),c=l.getContext("2d"),l.width=i,l.height=u,c.drawImage(r,0,Math.floor(s/5),i,u,0,0,i,u),e.next=12,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.l.getModelPredictions({model:n,sCanvas:l});case 12:if(d=e.sent,p=d.filter((function(e){var t=e.topLeft,n=e.bottomRight,r=P(e.probability,1)[0],a=e.landmarks;return!(r<.9||a.length<4||_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.f.rectAreaRatio({small:{coords:[t,n]},big:{coords:[[0,0],[_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.l.SIZE,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.l.SIZE]]}})<.025)})),f=p.length,!a){e.next=22;break}if(0!==f){e.next=18;break}return e.abrupt("return",kB.id_detector_error_front_side_no_faces);case 18:if(!(f>1)){e.next=20;break}return e.abrupt("return",kB.id_detector_error_front_side_multiple_faces);case 20:e.next=24;break;case 22:if(!(f>0)){e.next=24;break}return e.abrupt("return",kB.id_detector_error_back_side_has_faces);case 24:return e.abrupt("return",null);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var OB=function OB(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=rt(n))==n?n:0),void 0!==t&&(t=(t=rt(t))==t?t:0),function FB(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e}(rt(e),t,n)},MB="https://unpkg.com/id-card-model@1.0.2/models/web_model/web_model_noquant/model.json",DB="https://unpkg.com/id-card-model-testing@1.0.5/libs/opencv.js",PB={0:"top-left",1:"top-right",2:"bottom-right",3:"bottom-left",4:"cccd.front",5:"passport",6:"cmnd_old.front",7:"cmnd_old.back",8:"cmnd_new.front",9:"cmnd_new.back",10:"cccd_new.front",11:"cccd_new.back"};function LB(e){var t,n,r,a,o,s=e.card,i=e.corners,u=s.box,l={x:(u[1]+u[3])/2,y:(u[0]+u[2])/2},c=u[2]-u[0],d=u[1]-u[3],p=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=B(e))){n&&(e=n);var r=0,a=function a(){};return{s:a,n:function n(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function e(_e378){throw _e378},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function s(){n=e[Symbol.iterator]()},n:function(_n189){function n(){return _n189.apply(this,arguments)}return n.toString=function(){return _n189.toString()},n}((function(){var e=n.next();return s=e.done,e})),e:function e(_e379){i=!0,o=_e379},f:function f(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}(i);try{for(p.s();!(o=p.n()).done;){var f=o.value;switch(f.label){case"top-left":t||(t=f.location);break;case"top-right":n||(n=f.location);break;case"bottom-right":r||(r=f.location);break;case"bottom-left":a||(a=f.location)}}}catch(e){p.e(e)}finally{p.f()}if(![t,n,r,a].every(Boolean))return console.debug("Not qualified, corners missing"),!1;var h={x:(t.x+r.x)/2,y:(t.y+r.y)/2},m={x:(n.x+a.x)/2,y:(n.y+a.y)/2},g=wB(l,h),b=wB(l,m);return Math.sqrt(g)>(c+d)/8||Math.sqrt(b)>(c+d)/8?(console.debug("Not qualified, not close enough"),!1):(console.debug("Qualified"),!0)}function BB(e){return zB.apply(this,arguments)}function zB(){return(zB=$(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.url,e.next=3,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.j.loadExternalScript({url:n});case 3:return e.abrupt("return",new Promise((function(e){window.cv.onRuntimeInitialized=e})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var WB=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a,o,s,i,u;return t=e,(n=[{key:"load",value:(u=$(regeneratorRuntime.mark((function e(){var t,n,r,a,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},n=t.opencvUrl,r=void 0===n?DB:n,a=t.modelUrl,e.next=3,Promise.all([BB({url:r}),this.loadModel({modelUrl:a})]);case 3:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"loadModel",value:(i=$(regeneratorRuntime.mark((function e(){var t,n,r,a,o,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=t.modelUrl,r=void 0===n?MB:n,e.next=3,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.k.initTensorFlow();case 3:return e.next=5,Dl(r);case 5:this.model=e.sent,a=this.model.inputs,o=this.model.outputs,this.boxesIndex=o.findIndex((function(e){return"Identity_3"===e.name})),this.classesIndex=o.findIndex((function(e){return"Identity_2"===e.name})),this.scoresIndex=o.findIndex((function(e){return"Identity_1"===e.name})),this.inputSize=[a[0].shape[1],a[0].shape[2]];case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"dispose",value:(s=$(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.model&&this.model.dispose();case 1:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"predict",value:(o=$(regeneratorRuntime.mark((function e(t){var n,r,a,o,s,i,u,l,c,d,p,f,h,m,g,b,y,x,v,k,w,I,N,T,C=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=C.length>1&&void 0!==C[1]?C[1]:{},r=n.imgMargin,a=void 0===r?.5:r,o=n.detectThreshold,s=void 0===o?.3:o,i=n.maxNumReturns,u=void 0===i?100:i,l={},c=t.width,d=t.height,l.originalWidth=c,l.originalHeight=d,p=NB({canvas:t,imgMargin:a}),f=p.canvas,h=p.margin,m=P(this.inputSize,2),g=m[0],b=m[1],y=f.width/g,x=f.height/b,(v=document.createElement("canvas")).width=g,v.height=b,v.getContext("2d").drawImage(f,0,0,f.width,f.height,0,0,v.width,v.height),l.canvas=v,l.margin=h,e.next=19,this.detect(v,{detectThreshold:s,maxNumReturns:u});case 19:if(k=e.sent,w={inputImage:l,card:null},I=[],N=[],k.forEach((function(e){var t=P(e.box,4),n=t[0],r=t[1],a=t[2],o=t[3];e.clazz<=3?I.push({clazz:e.clazz,label:e.label,score:e.score,location:{x:OB(Math.floor((o+r)/2*y-h),0,c),y:OB(Math.floor((n+a)/2*x-h),0,d)},scaledLocation:{x:OB(Math.floor((o+r)/2),0,v.width),y:OB(Math.floor((n+a)/2),0,v.height)}}):N.push({label:e.label,score:e.score,box:[OB(Math.floor(n*x-h),0,d),OB(Math.floor(r*y-h),0,c),OB(Math.floor(a*x-h),0,d),OB(Math.floor(o*y-h),0,c)]})})),I.sort((function(e,t){return t.score-e.score})),N.sort((function(e,t){return t.score-e.score})),!(N.length>0)){e.next=35;break}if(LB({card:T=N[0],corners:I})){e.next=31;break}return console.debug("Not qualified.",T,I),e.abrupt("return",w);case 31:return I.sort((function(e,t){return e.clazz-t.clazz})),T.corners=I,w.card=T,e.abrupt("return",w);case 35:return e.abrupt("return",w);case 36:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"detect",value:(a=$(regeneratorRuntime.mark((function e(t){var n,r,a,o,s,i,u,l,c,d,p,f,h,m,g,b,y,x,v,k,w,I,N=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=N.length>1&&void 0!==N[1]?N[1]:{},r=n.detectThreshold,a=n.maxNumReturns,o=t.width,s=t.height,i=ua((function(){var e=t;return e instanceof kn||(e=Br(e)),To(Er(e,"float32"),0)})),u=this.model.execute(i),i.dispose(),e.next=8,Promise.all([u[this.boxesIndex].array(),u[this.classesIndex].data(),u[this.scoresIndex].data()]);case 8:for(l=e.sent,c=P(l,3),d=P(c[0],1),p=d[0],f=c[1],h=c[2],console.log("boxxess",p,f,h),m=[],g=Math.min(h.length,a),b=0;b<g;b++)(y=h[b])>r&&(v=f[b],k=null!==(x=PB[Math.round(v)])&&void 0!==x?x:"NA",w=p[b],I=[w[0]*s,w[3]*o,w[2]*s,w[1]*o],m.push({score:y,clazz:v,box:I,label:k}));return e.abrupt("return",m);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})}])&&R(t.prototype,n),e}();function VB(){return UB.apply(this,arguments)}function UB(){return(UB=$(regeneratorRuntime.mark((function e(){var t,n,r,a,o,s,i,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=t.opencvUrl,r=t.modelUrl,a=new WB,e.next=4,Promise.all([Gl(),a.load({opencvUrl:n,modelUrl:r})]);case 4:return o=e.sent,s=P(o,1),i=s[0],e.abrupt("return",{idCardModel:a,blazefaceModel:i});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var HB=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.Errors;function jB(){return(jB=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var GB="undefined"!=typeof window?react__WEBPACK_IMPORTED_MODULE_126__.useLayoutEffect:react__WEBPACK_IMPORTED_MODULE_126__.useEffect,qB={popupContent:{tooltip:{position:"absolute",zIndex:999},modal:{position:"relative",margin:"auto"}},popupArrow:{height:"8px",width:"16px",position:"absolute",background:"transparent",color:"#FFF",zIndex:-1},overlay:{tooltip:{position:"fixed",top:"0",bottom:"0",left:"0",right:"0",zIndex:999},modal:{position:"fixed",top:"0",bottom:"0",left:"0",right:"0",display:"flex",zIndex:999}}},KB=["top left","top center","top right","right top","right center","right bottom","bottom left","bottom center","bottom right","left top","left center","left bottom"],XB=function XB(e,t,n,r,a){var o=a.offsetX,s=a.offsetY,i=r?8:0,u=n.split(" "),l=e.top+e.height/2,c=e.left+e.width/2,d=t.height,p=t.width,f=l-d/2,h=c-p/2,m="",g="0%",b="0%";switch(u[0]){case"top":f-=d/2+e.height/2+i,m="rotate(180deg)  translateX(50%)",g="100%",b="50%";break;case"bottom":f+=d/2+e.height/2+i,m="rotate(0deg) translateY(-100%) translateX(-50%)",b="50%";break;case"left":h-=p/2+e.width/2+i,m=" rotate(90deg)  translateY(50%) translateX(-25%)",b="100%",g="50%";break;case"right":h+=p/2+e.width/2+i,m="rotate(-90deg)  translateY(-150%) translateX(25%)",g="50%"}switch(u[1]){case"top":f=e.top,g=e.height/2+"px";break;case"bottom":f=e.top-d+e.height,g=d-e.height/2+"px";break;case"left":h=e.left,b=e.width/2+"px";break;case"right":h=e.left-p+e.width,b=p-e.width/2+"px"}return{top:f="top"===u[0]?f-s:f+s,left:h="left"===u[0]?h-o:h+o,transform:m,arrowLeft:b,arrowTop:g}},QB=0,ZB=Object(react__WEBPACK_IMPORTED_MODULE_126__.forwardRef)((function(r,o){var s=r.trigger,i=void 0===s?null:s,l=r.onOpen,c=void 0===l?function(){}:l,d=r.onClose,p=void 0===d?function(){}:d,f=r.defaultOpen,h=void 0!==f&&f,m=r.open,g=void 0===m?void 0:m,b=r.disabled,y=void 0!==b&&b,x=r.nested,v=void 0!==x&&x,k=r.closeOnDocumentClick,w=void 0===k||k,I=r.repositionOnResize,N=void 0===I||I,T=r.closeOnEscape,C=void 0===T||T,E=r.on,S=void 0===E?["click"]:E,_=r.contentStyle,$=void 0===_?{}:_,R=r.arrowStyle,A=void 0===R?{}:R,F=r.overlayStyle,O=void 0===F?{}:F,M=r.className,D=void 0===M?"":M,P=r.position,L=void 0===P?"bottom center":P,B=r.modal,z=void 0!==B&&B,W=r.lockScroll,V=void 0!==W&&W,U=r.arrow,H=void 0===U||U,j=r.offsetX,G=void 0===j?0:j,q=r.offsetY,K=void 0===q?0:q,X=r.mouseEnterDelay,Y=void 0===X?100:X,Q=r.mouseLeaveDelay,Z=void 0===Q?100:Q,J=r.keepTooltipInside,ee=void 0!==J&&J,te=r.children,ne=Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(g||h),re=ne[0],ae=ne[1],oe=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),se=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),ie=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),ue=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),le=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)("popup-"+ ++QB),ce=!!z||!i,de=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(0);GB((function(){return re?(ue.current=document.activeElement,ke(),ve(),ye()):xe(),function(){clearTimeout(de.current)}}),[re]),Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){"boolean"==typeof g&&(g?pe():fe())}),[g,y]);var pe=function pe(e){re||y||(ae(!0),setTimeout((function(){return c(e)}),0))},fe=function fe(e){var t;re&&!y&&(ae(!1),ce&&(null===(t=ue.current)||void 0===t||t.focus()),setTimeout((function(){return p(e)}),0))},he=function he(e){null==e||e.stopPropagation(),re?fe(e):pe(e)},me=function me(e){clearTimeout(de.current),de.current=setTimeout((function(){return pe(e)}),Y)},ge=function ge(e){null==e||e.preventDefault(),he()},be=function be(e){clearTimeout(de.current),de.current=setTimeout((function(){return fe(e)}),Z)},ye=function ye(){ce&&V&&(document.getElementsByTagName("body")[0].style.overflow="hidden")},xe=function xe(){ce&&V&&(document.getElementsByTagName("body")[0].style.overflow="auto")},ve=function ve(){var e,t=null==se||null===(e=se.current)||void 0===e?void 0:e.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]'),n=Array.prototype.slice.call(t)[0];null==n||n.focus()};Object(react__WEBPACK_IMPORTED_MODULE_126__.useImperativeHandle)(o,(function(){return{open:function open(){pe()},close:function close(){fe()},toggle:function toggle(){he()}}}));var ke=function ke(){if(!ce&&re&&(null==oe?void 0:oe.current)&&(null==oe?void 0:oe.current)&&(null==se?void 0:se.current)){var e,t,a=function YB(e,t,n,r,a,o){var s=a.offsetX,i=a.offsetY,u={arrowLeft:"0%",arrowTop:"0%",left:0,top:0,transform:"rotate(135deg)"},l=0,c=function(e){var t={top:0,left:0,width:window.innerWidth,height:window.innerHeight};if("string"==typeof e){var n=document.querySelector(e);null!==n&&(t=n.getBoundingClientRect())}return t}(o),d=Array.isArray(n)?n:[n];for((o||Array.isArray(n))&&(d=[].concat(d,KB));l<d.length;){var p={top:(u=XB(e,t,d[l],r,{offsetX:s,offsetY:i})).top,left:u.left,width:t.width,height:t.height};if(!(p.top<=c.top||p.left<=c.left||p.top+p.height>=c.top+c.height||p.left+p.width>=c.left+c.width))break;l++}return u}(oe.current.getBoundingClientRect(),se.current.getBoundingClientRect(),L,H,{offsetX:G,offsetY:K},ee);se.current.style.top=a.top+window.scrollY+"px",se.current.style.left=a.left+window.scrollX+"px",H&&ie.current&&(ie.current.style.transform=a.transform,ie.current.style.setProperty("-ms-transform",a.transform),ie.current.style.setProperty("-webkit-transform",a.transform),ie.current.style.top=(null===(e=A.top)||void 0===e?void 0:e.toString())||a.arrowTop,ie.current.style.left=(null===(t=A.left)||void 0===t?void 0:t.toString())||a.arrowLeft)}};!function(e,t){void 0===t&&(t=!0),Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){if(t){var n=function n(t){"Escape"===t.key&&e(t)};return document.addEventListener("keyup",n),function(){t&&document.removeEventListener("keyup",n)}}}),[e,t])}(fe,C),function(e,t){void 0===t&&(t=!0),Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){if(t){var n=function n(t){if(9===t.keyCode){var n,r=null==e||null===(n=e.current)||void 0===n?void 0:n.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]'),a=Array.prototype.slice.call(r);if(1===a.length)return void t.preventDefault();var o=a[0],s=a[a.length-1];t.shiftKey&&document.activeElement===o?(t.preventDefault(),s.focus()):document.activeElement===s&&(t.preventDefault(),o.focus())}};return document.addEventListener("keydown",n),function(){t&&document.removeEventListener("keydown",n)}}}),[e,t])}(se,re&&ce),function(e,t){void 0===t&&(t=!0),Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){if(t){var n=function n(){e()};return window.addEventListener("resize",n),function(){t&&window.removeEventListener("resize",n)}}}),[e,t])}(ke,N),function(e,t,n){void 0===n&&(n=!0),Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){if(n){var r=function r(n){var r=Array.isArray(e)?e:[e],a=!1;r.forEach((function(e){e.current&&!e.current.contains(n.target)||(a=!0)})),n.stopPropagation(),a||t(n)};return document.addEventListener("mousedown",r),document.addEventListener("touchstart",r),function(){n&&(document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r))}}}),[e,t,n])}(i?[se,oe]:[se],fe,w&&!v);var we,Ie=function Ie(){return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("div",Object.assign({},(t=ce?qB.popupContent.modal:qB.popupContent.tooltip,n={className:"popup-content "+(""!==D?D.split(" ").map((function(e){return e+"-content"})).join(" "):""),style:jB({},t,$,{pointerEvents:"auto"}),ref:se,onClick:function onClick(e){e.stopPropagation()}},!z&&S.indexOf("hover")>=0&&(n.onMouseEnter=me,n.onMouseLeave=be),n),{key:"C",role:ce?"dialog":"tooltip",id:le.current}),H&&!ce&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("div",{ref:ie,style:qB.popupArrow},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("svg",{"data-testid":"arrow",className:"popup-arrow "+(""!==D?D.split(" ").map((function(e){return e+"-arrow"})).join(" "):""),viewBox:"0 0 32 16",style:jB({position:"absolute"},A)},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("path",{d:"M16 0l16 16H0z",fill:"currentcolor"}))),te&&"function"==typeof te?te(fe,re):te);var t,n},Ne=!(S.indexOf("hover")>=0),Te=ce?qB.overlay.modal:qB.overlay.tooltip,Ce=[Ne&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("div",{key:"O","data-testid":"overlay","data-popup":ce?"modal":"tooltip",className:"popup-overlay "+(""!==D?D.split(" ").map((function(e){return e+"-overlay"})).join(" "):""),style:jB({},Te,O,{pointerEvents:w&&v||ce?"auto":"none"}),onClick:w&&v?fe:void 0,tabIndex:-1},ce&&Ie()),!ce&&Ie()];return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_126___default.a.Fragment,null,function(){for(var t={key:"T",ref:oe,"aria-describedby":le.current},n=Array.isArray(S)?S:[S],r=0,a=n.length;r<a;r++)switch(n[r]){case"click":t.onClick=he;break;case"right-click":t.onContextMenu=ge;break;case"hover":t.onMouseEnter=me,t.onMouseLeave=be;break;case"focus":t.onFocus=me,t.onBlur=be}if("function"==typeof i){var o=i(re);return!!i&&react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(o,t)}return!!i&&react__WEBPACK_IMPORTED_MODULE_126___default.a.cloneElement(i,t)}(),re&&jL.createPortal(Ce,(null===(we=document.getElementById("popup-root"))&&((we=document.createElement("div")).setAttribute("id","popup-root"),document.body.appendChild(we)),we)))}));function JB(){var e=D(["\n  .popup-content {\n    margin: auto;\n    background: #fff;\n    width: 100%;\n    padding: 5px;\n    border: 1px solid #d7d7d7;\n    max-width: 568px;\n    border-radius: 0.25rem;\n  }\n\n  [role=tooltip].popup-content {\n    width: 200px;\n    box-shadow: 0 0 3px rgba(0, 0, 0, .16);\n    border-radius: 5px\n  }\n\n  .popup-overlay {\n    background: rgba(0, 0, 0, .5);\n    padding: 10px;\n  }\n\n  [data-popup=tooltip].popup-overlay {\n    background: transparent\n  }\n\n  .popup-arrow {\n    -webkit-filter: drop-shadow(0 -3px 3px rgba(0, 0, 0, .16));\n    filter: drop-shadow(0 -3px 3px rgba(0, 0, 0, .16));\n    color: #fff;\n    stroke-width: 2px;\n    stroke: #d7d7d7;\n    stroke-dasharray: 30px;\n    stroke-dashoffset: -54px;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0\n  }\n"]);return JB=function JB(){return e},e}var ez,tz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.a)(JB()),nz=function nz(t){var n=t.open,r=t.children;return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_126___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(ZB,{overlayStyle:{zIndex:2e3},closeOnDocumentClick:!1,closeOnEscape:!1,modal:!0,open:n},r),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(tz,null))};nz.propTypes={open:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,children:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.node},nz.defaultProps={open:!1,children:null};var rz="default",az="error",oz=(A(ez={},rz,{fill:"none",strokeWidth:2,stroke:"#f4f4f4",strokeDasharray:"7, 4",opacity:.6}),A(ez,az,{fill:"rgba(234,50,35, 0.1)",strokeWidth:2,stroke:"#ea3223"}),ez),sz={fill:"rgba(0,0,0, 0.6)"};function iz(t){var n=t.className,r=t.width,a=t.height,o=t.type,s=oz[o];return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("svg",{width:r,height:a,className:n},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("rect",{x:2,y:2,rx:10,ry:10,width:r-4,height:a-4,style:s}),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("path",{d:"M0,".concat(12," Q0,0 ").concat(12,",0 L0,0 Z"),style:sz}),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("path",{d:"M0,".concat(a-12," Q0,").concat(a," ").concat(12,",").concat(a," L0,").concat(a," Z"),style:sz}),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("path",{d:"M".concat(r-12,",").concat(a," Q").concat(r,",").concat(a," ").concat(r,",").concat(a-12," L").concat(r,",").concat(a," Z"),style:sz}),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("path",{d:"M".concat(r-12,",0 Q").concat(r,",0 ").concat(r,",").concat(12," L").concat(r,",0 Z"),style:sz}))}iz.propTypes={className:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,width:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,height:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number,type:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.oneOf([rz,az])},iz.defaultProps={className:"",width:300,height:200,type:rz};var uz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.d)(["from{transform:perspective(400px);}to{transform:perspective(400px) rotateY(90deg);}"]),lz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.d)(["from{transform:perspective(400px) rotateY(-90deg);}to{transform:perspective(400px);}"]),cz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)([".flipY-exit{animation-name:",";animation-duration:","ms;animation-timing-function:ease-in;}.flipY-enter{animation-name:",";animation-duration:","ms;animation-timing-function:ease-out;}"],uz,500,lz,500),dz=Object.freeze({__proto__:null,animationDuration:500,default:cz}),pz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.d)(["from,to{transform:translate3d(-","px,0,0);}50%{transform:translate3d(","px,0,0);}"],20,20),fz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.d)(["from,to{transform:translate3d(0,-","px,0);}50%{transform:translate3d(0,","px,0);}"],20,20),hz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)([".slide-horizontal{animation-name:",";animation-iteration-count:infinite;animation-duration:2000ms;animation-timing-function:linear;}.slide-vertical{animation-name:",";animation-iteration-count:infinite;animation-duration:2000ms;animation-timing-function:linear;}"],pz,fz),mz=Object.freeze({__proto__:null,default:hz}),gz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.d)(["from,to{opacity:1;}50%{opacity:0;}"]),bz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)([".blink{animation-name:",";animation-iteration-count:infinite;animation-duration:2000ms;animation-timing-function:linear;}"],gz),yz=Object.freeze({__proto__:null,default:bz});function xz(){var e=D(["\n  ","\n"]);return xz=function xz(){return e},e}function vz(){var e=D(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: ","; // must be higher than BASE_Z_INDEX and lower than other layers\n"]);return vz=function vz(){return e},e}var kz=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(vz(),1001),wz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.d)(["from{background:#000;}to{}"]),Iz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)([".splash-enter{animation-name:",";animation-duration:","ms;animation-timing-function:ease-in;}"],wz,300),Nz=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(xz(),Iz),Tz=function Tz(t){var n=t.keyForTransition,r=void 0===n?0:n;return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Nz,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(uB,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(nB,{key:r,timeout:{enter:300,exit:0},classNames:"splash",unmountOnExit:!1},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(kz,null))))},Cz=Object.freeze({__proto__:null,default:Tz}),Ez=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.d)(["from{transform:rotate(0deg);}to{transform:rotate(360deg);}"]),Sz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.b)([".spin{animation-name:",";animation-iteration-count:infinite;animation-duration:1000ms;animation-timing-function:linear;}"],Ez),_z=Object.freeze({__proto__:null,default:Sz});Object.freeze({__proto__:null,flipY:dz,slide:mz,blink:yz,splash:Cz,spin:_z});function Rz(){var e=D(["\n  position: absolute;\n  top: 0;\n  left: 0;\n"]);return Rz=function Rz(){return e},e}function Az(){var e=D(["\n  font-size: 18px;\n  text-align: center;\n  padding: 10px;\n"]);return Az=function Az(){return e},e}function Fz(){var e=D(["\n  position: absolute;\n  font-size: 18px;\n  text-align: center;\n  border-radius: 3px;\n  padding: 5px 10px;\n  background: #ea3223;\n  color: #fff;\n  margin: 0 10px;\n  top: ",";\n  z-index: ",";\n"]);return Fz=function Fz(){return e},e}function Oz(){var e=D(["\n  background: #ea3223;\n  padding: 5px 10px;\n  border-radius: 3px;\n"]);return Oz=function Oz(){return e},e}function Mz(){var e=D(["\n  position: absolute;\n  font-size: 16px;\n  text-align: center;\n  color: #fff;\n  top: ",";\n  z-index: ",";\n"]);return Mz=function Mz(){return e},e}function Dz(){var e=D(["\n  font-size: 20px;\n  margin-left: 10px;\n  color: green;\n  position: absolute;\n  left: 0;\n  top: 10px;\n  background: white;\n  z-index: ",";\n"]);return Dz=function Dz(){return e},e}function Pz(){var e=D(["\n  font-size: 20px;\n  margin-left: 10px;\n  color: #fff;\n"]);return Pz=function Pz(){return e},e}function Lz(){var e=D(["\n  display: flex;\n  align-items: center;\n"]);return Lz=function Lz(){return e},e}function Bz(){var e=D(["\n  transform: translateZ(1000px); // to fix rotating bug on safari\n  transform-style: preserve-3d;\n  position: absolute;\n  top: ",";\n  z-index: ",";\n"]);return Bz=function Bz(){return e},e}function zz(){var e=D(["\n  color: #fff;\n  text-align: center;\n"]);return zz=function zz(){return e},e}function Wz(){var e=D(["\n  cursor: pointer;\n  text-align: center;\n  width: ","px;\n\n  img {\n    width: 100%;\n  }\n\n  z-index: ",";\n  position: fixed;\n  bottom: ","px;\n"]);return Wz=function Wz(){return e},e}function Vz(){var e=D(["\n  border-radius: 5px;\n  opacity: 0.7;\n  height: 38px;\n"]);return Vz=function Vz(){return e},e}function Uz(){var e=D(["\n  ","\n  ","\n"]);return Uz=function Uz(){return e},e}var Hz=Tz,jz=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(Uz(),cz,Sz),Gz=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.img(Vz()),qz=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(Wz(),60,1020,10),Kz=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(zz()),Xz=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(Bz(),(function(e){return e.y}),1020),Yz=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(Lz()),Qz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(Kz)(Pz()),Zz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(Kz)(Dz(),1030),Jz=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(Kz)(Mz(),(function(e){return e.y}),1020),eW=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(Jz)(Oz()),tW=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(Kz)(Fz(),(function(e){return e.y}),1020),nW=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(Az()),rW=Object(styled_components__WEBPACK_IMPORTED_MODULE_127__.c)(iz)(Rz()),aW={BTN_OK:{en:"OK",vi:"Tôi đã hiểu"},FRONT:{en:"front",vi:"trước"},BACK:{en:"back",vi:"sau"},BTN_USE_THIS_PICTURE:{en:"Use this picture",vi:"Dùng ảnh này"},BTN_TRY_AGAIN:{en:"Try again",vi:"Thử lại"}},oW={WARMUP_INTRO:{en:"Warming up... Please wait a moment",vi:"Đang khởi động, vui lòng chờ trong giây lát..."}};function sW(){var e=D(["\n  margin-top: 20px;\n  width: 100%;\n  max-width: 160px;\n  height: 50px;\n  background-color: #007bff;\n  border: 0;\n  outline: none;\n  border-radius: 0.25rem;\n  color: #fff;\n  font-weight: 400;\n  cursor: pointer;\n  font-size: 1rem;\n"]);return sW=function sW(){return e},e}function iW(){var e=D(["\n  text-align: center;\n  font-size: 1rem;\n"]);return iW=function iW(){return e},e}function uW(){var e=D(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  padding: 10px;\n"]);return uW=function uW(){return e},e}var lW=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.IDCardMessage,cW=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(uW()),dW=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(iW()),pW=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.button(sW()),fW=function fW(t){var n=t.onOk,r=t.maxSessionTime,a=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.m.useSDKSettings().lang;return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(cW,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(dW,{className:"popup-message"},WC(lW.TIMEOUT_INSTRUCTION[a])({x:r})),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(pW,{className:"popup-button",onClick:n},aW.BTN_OK[a]))};function hW(){var e=D(["\n  margin: 20px 0;\n  width: 100%;\n  display: flex;\n  justify-content: space-evenly;\n"]);return hW=function hW(){return e},e}function mW(){var e=D(["\n  width: 100%;\n  border-radius: 5px;\n"]);return mW=function mW(){return e},e}function gW(){var e=D(["\n  margin-top: 20px;\n  width: 100%;\n  max-width: 160px;\n  height: 50px;\n  background-color: #007bff;\n  border: 0;\n  outline: none;\n  border-radius: 0.25rem;\n  color: #fff;\n  font-weight: 400;\n  cursor: pointer;\n  font-size: 1rem;\n"]);return gW=function gW(){return e},e}function bW(){var e=D(["\n  text-align: center;\n  font-size: 1rem;\n  color: #ea3223;\n  margin-top: 10px;\n"]);return bW=function bW(){return e},e}function yW(){var e=D(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  padding: 10px;\n"]);return yW=function yW(){return e},e}fW.propTypes={onOk:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,maxSessionTime:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.number},fW.defaultProps={onOk:function onOk(){},maxSessionTime:30};var xW=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(yW()),vW=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(bW()),kW=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.button(gW()),wW=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.img(mW()),IW=styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(hW()),NW=function NW(n){var r=n.imageBlobTaken,o=n.onConfirm,s=n.onTryAgain,i=n.error,u=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(null),2),l=u[0],c=u[1],d=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.m.useSDKSettings().lang;return Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){var e;return r&&(e=URL.createObjectURL(r),c(e)),function(){URL.revokeObjectURL(e)}}),[r]),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(xW,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(wW,{src:l}),i&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(vW,{className:"confirm-popup-error-message"},i.msg[d]),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(IW,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(kW,{onClick:o},aW.BTN_USE_THIS_PICTURE[d]),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(kW,{onClick:s},aW.BTN_TRY_AGAIN[d])))};NW.propTypes={imageBlobTaken:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.shape({}),error:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.shape({msg:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.shape({})}),onConfirm:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,onTryAgain:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func},NW.defaultProps={imageBlobTaken:{},error:null,onConfirm:function onConfirm(){},onTryAgain:function onTryAgain(){}};var TW="SESSION_TIMEOUT",CW="CONFIRM",EW=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.IDCardMessage,SW=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.IDCardSide,_W=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.IDCardType,$W=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.Errors;function RW(o){var s=o.frontCamera,i=o.title,u=o.description,l=o.onClose,c=o.usePortraitMask,d=o.onError,p=o.cardType,f=o.cardSide,h=o.apiCheck,m=o.onSuccess,x=o.frontCardId,k=o.enableRecording,I=o.onApiCheck,T=o.resultWarmup,C=o.enableConfirmPopup,S=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(0),2),_=S[0],R=S[1],A=f===SW.FRONT,F=o.titleIcon||(A?"id_card_front.svg":"id_card_back.svg"),O=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.a.useAsset(F),D=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)({}),2),L=D[0],B=D[1],z=L.yTitle,W=L.yDescription,V=L.yMessage,U=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.a.useAsset("ic_camera.svg"),H=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(""),2),G=H[0],q=H[1],K=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.m.useSDKSettings(),X=K.apiClient,Y=K.debug,Q=K.lang,Z=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),J=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(null),2),ee=J[0],te=J[1],ne=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(""),2),re=ne[0],ae=ne[1],oe=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(!1),2),se=oe[0],ie=oe[1],ue=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(null),2),le=ue[0],ce=ue[1],de=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(!1),2),pe=de[0],fe=de[1],he=function(){var e=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(!1),2),n=e[0],a=e[1],o=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(null),2),s=o[0],i=o[1];return{showPopup:Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(e){var t=e.popupType;i(t),a(null!==t)}),[]),popupShown:n,popupType:s}}(),me=he.showPopup,ge=he.popupShown,be=he.popupType,ye=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),xe=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)((function(){})),ve=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(null),2),ke=ve[0],we=ve[1],Ie=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(!1),Te=function(e){var n=e.apiCheck,r=e.enableRecordingProp,o=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.m.useSDKSettings().apiClient,s=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(null),2),i=s[0],u=s[1];return Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){function e(){return(e=$(regeneratorRuntime.mark((function e(){var t,a,s,i,l,c,d,p,f,h,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},!n){e.next=5;break}return e.next=4,o.clientSettings();case 4:t=e.sent;case 5:a=SE(t,"data.settings.sdk_settings.id_detection_settings.save_frame_settings.enable",r),s=SE(t,"data.settings.sdk_settings.id_detection_settings.save_frame_settings.frames_interval_ms",190),i=SE(t,"data.settings.sdk_settings.id_detection_settings.save_frame_settings.quality_web",80),l=SE(t,"data.settings.sdk_settings.id_detection_settings.limit_time_settings.enable",!0),c=SE(t,"data.settings.sdk_settings.id_detection_settings.limit_time_settings.limit_time_second",30),d=SE(t,"data.settings.sdk_settings.id_detection_settings.limit_time_settings.video_partial_length_seconds",15),p=SE(t,"data.settings.sdk_settings.id_detection_settings.auto_capture.enable",!0),f=SE(t,"data.settings.sdk_settings.id_detection_settings.auto_capture.wait_for_best_image_time_ms",3e3),h=SE(t,"data.settings.sdk_settings.id_detection_settings.blur_check.enable",!0),m=SE(t,"data.settings.sdk_settings.id_detection_settings.blur_check.threshold",.29),u({enableRecording:a,frameCaptureIntervalMs:s,sessionTime:c,maxRecordingTimePerVideo:d,saveFrameQuality:i,enableTimers:l,enableAutoCapture:p,waitForBestImageTimeMs:f,enableBlurCheck:h,blurThreshold:m});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[o,n,r]),{apiSettings:i}}({apiCheck:h,enableRecordingProp:k}).apiSettings,Ce=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(e){ae(null===e?"":WC(e.msg[Q])({side:A?aW.FRONT[Q]:aW.BACK[Q]}))}),[Q,A]),Ee=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)(function(){var e=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe.current({imageBlobTaken:t.imageBlob});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),Se=function(e){var o=e.resultWarmup,s=e.refVideo,i=e.videoPlayed,u=e.cropArea,l=e.apiSettings,c=e.onError,d=e.frontSide,p=e.onAutoCaptureSuccess,f=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),h=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(!1),m=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),g=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),b=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),x=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(!1),2),v=x[0],k=x[1],I=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)({imageBlob:null,takenAt:null,blurScore:null}),T=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)({imageBlob:null,blurScore:null,error:null}),C=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(!1);Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){function e(){return(e=$(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v){e.next=9;break}if(t=o){e.next=6;break}return e.next=5,VB();case 5:t=e.sent;case 6:g.current=t.idCardModel,b.current=t.blazefaceModel,k(!0);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[o,v]);var S=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){!0===h.current&&(h.current=!1)}),[]),_=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)(function(){var e=$(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.blurScore,r=l.blurThreshold,a=I.current,!(n>r&&_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.c.hasBetterBlurScore(n,a.blurScore))){e.next=9;break}return e.next=6,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.d.takePicture({canvas:f.current});case 6:a.imageBlob=e.sent,a.takenAt=(new Date).getTime(),a.blurScore=n;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[l]),R=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)(function(){var e=$(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.blurScore,r=T.current,!_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.c.hasBetterBlurScore(n,r.blurScore)){e.next=7;break}return e.next=5,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.d.takePicture({canvas:f.current});case 5:r.imageBlob=e.sent,r.blurScore=n;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),A=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)($(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.waitForBestImageTimeMs,null===(n=I.current).imageBlob){e.next=8;break}if(!((new Date).getTime()-n.takenAt>t)){e.next=8;break}return e.next=7,p(n);case 7:S();case 8:case"end":return e.stop()}}),e)}))),[p,l,S]),F=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)($(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=l.enableBlurCheck,n=l.blurThreshold,r=T.current;t?(C.current=!0,setTimeout((function(){C.current=!1,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.c.hasBetterBlurScore(r.blurScore,n)||(r.error=HB.id_detector_error_blur),e(r)}),3e3)):_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.d.takePicture({canvas:f.current}).then((function(t){r.imageBlob=t,e(r)}))})));case 1:case"end":return e.stop()}}),e)}))),[l]),O=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)($(regeneratorRuntime.mark((function e(){var t,n,r,a,o,i,u,p,y,x,k,S,$,F,O,M,D,P,L;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l&&v){e.next=2;break}return e.abrupt("return");case 2:I.current={imageBlob:null,takenAt:null,blurScore:null},T.current={imageBlob:null,blurScore:null,error:null},t=l.enableAutoCapture,n=l.enableBlurCheck,r=g.current,a=b.current,o=m.current,i=s.current,h.current=!0,u=f.current,p=u.getContext("2d"),y=o.cropX,x=o.cropY,k=o.cropWidth,S=o.cropHeight,$=document.createElement("canvas"),F=$.getContext("2d");case 15:return p.drawImage(i,y,x,k,S,0,0,k,S),O=null,e.next=20,r.predict(u,{detectThreshold:.3});case 20:if(M=e.sent,console.log("result",M),!M.card){e.next=69;break}if(!EB({corners:M.card.corners,width:k,height:S})){e.next=66;break}if(!$B(M.card.corners)){e.next=63;break}if(D=TB(u,M.card.corners),!((P=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.f.rectAreaRatio({small:{area:D.width*D.height},big:{area:k*S}}))<.5)){e.next=33;break}O=HB.id_detector_card_too_small,e.next=61;break;case 33:if(!(P>.8)){e.next=37;break}O=HB.id_detector_error_incomplete,e.next=61;break;case 37:return $.width=D.width,$.height=D.height,F.putImageData(D,0,0),e.next=42,SB({canvas:$});case 42:if(!e.sent){e.next=47;break}O=HB.glare_detected,e.next=61;break;case 47:return e.next=49,RB({blazefaceModel:a,predictedIdCardCanvas:$,frontSide:d});case 49:if(O=e.sent){e.next=61;break}if(!n){e.next=61;break}return e.next=54,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.c.calculateBlurScore($);case 54:if(L=e.sent,!t){e.next=58;break}return e.next=58,_({blurScore:L});case 58:if(!C.current){e.next=61;break}return e.next=61,R({blurScore:L});case 61:e.next=64;break;case 63:O=HB.id_detector_validate_angle_error;case 64:e.next=67;break;case 66:O=HB.id_detector_error_incomplete;case 67:e.next=70;break;case 69:O=HB.id_detector_no_cards;case 70:return c(O),e.next=73,A();case 73:if(h.current){e.next=75;break}return e.abrupt("break",79);case 75:return e.next=77,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.b.sleep(15);case 77:e.next=15;break;case 79:case"end":return e.stop()}}),e)}))),[s,l,v,d,c,_,R,A]);return Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){var e=s.current;function t(){return(t=$(regeneratorRuntime.mark((function t(){var n,r,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.d.analyzeVideoAndWindowSizes(e,u,.05),r=n.cropWidth,a=n.cropHeight,m.current=n,(o=document.createElement("canvas")).width=r,o.height=a,f.current=o,t.next=9,O();case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return i&&u&&v&&function(){t.apply(this,arguments)}(),function(){S()}}),[i,u,s,S,O,v]),{refWorkingCanvas:f,stopCheckFrame:S,checkFrame:O,warmupDone:v,takePictureManually:F}}({resultWarmup:T,refVideo:Z,videoPlayed:se,cropArea:le,apiSettings:Te,onError:Ce,frontSide:A,onAutoCaptureSuccess:Ee}),_e=Se.refWorkingCanvas,$e=Se.stopCheckFrame,Re=Se.checkFrame,Ae=Se.warmupDone,Oe=Se.takePictureManually,Me=function(e){var t=e.refVideo,o=e.videoPlayed,s=e.cropArea,i=e.apiSettings,u=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),l=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(!1),c=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)([{id:null,frames:[]}]),d=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.i.createResizer({width:960,height:640})),p=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(null),f=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){!0===l.current&&(l.current=!1)}),[]),h=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){c.current=[{id:null,frames:[]}]}),[]),m=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){var e=c.current;e[e.length-1].frames.length>0&&e.push({id:null,frames:[]})}),[]),g=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)(function(){var e=$(regeneratorRuntime.mark((function e(t){var n,r,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.workingCanvas,r=d.current,a=c.current,o=r.resize({srcCanvas:n}),s=o.toDataURL("image/jpeg",i.saveFrameQuality/100).split(",")[1],a[a.length-1].frames.push({base64:s});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i]),b=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)($(regeneratorRuntime.mark((function e(){var n,r,a,o,s,c,d,f,h,m,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return");case 2:if(n=i.frameCaptureIntervalMs,i.enableRecording){e.next=5;break}return e.abrupt("return");case 5:r=p.current,a=t.current,l.current=!0,o=u.current,s=o.getContext("2d"),c=r.cropX,d=r.cropY,f=r.cropWidth,h=r.cropHeight,m=null;case 12:if(s.drawImage(a,c,d,f,h,0,0,f,h),!n){e.next=23;break}if(!((b=(new Date).getTime())-m>=n)){e.next=21;break}return e.next=20,g({workingCanvas:o});case 20:m=b;case 21:e.next=25;break;case 23:return e.next=25,g({workingCanvas:o});case 25:if(l.current){e.next=27;break}return e.abrupt("break",31);case 27:return e.next=29,_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.b.sleep(15);case 29:e.next=12;break;case 31:case"end":return e.stop()}}),e)}))),[t,g,i]);return Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){var e=t.current;function n(){return(n=$(regeneratorRuntime.mark((function t(){var n,r,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.d.analyzeVideoAndWindowSizes(e,s),r=n.cropWidth,a=n.cropHeight,p.current=n,(o=document.createElement("canvas")).width=r,o.height=a,u.current=o,t.next=9,b();case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return o&&s&&function(){n.apply(this,arguments)}(),function(){f()}}),[o,s,t,f,m,b]),{refWorkingCanvas:u,stopCheckFrame:f,refRecordedVideos:c,splitVideos:m,resetRecordedVideos:h,checkFrame:b}}({refVideo:Z,videoPlayed:se,cropArea:le,apiSettings:Te}),De=Me.stopCheckFrame,Pe=Me.refRecordedVideos,Le=Me.splitVideos,Be=Me.resetRecordedVideos,ze=Me.checkFrame;!function(e){var t=e.debug,n=e.refRecordedVideos,r=e.refWorkingCanvas,o=e.refVideo,s=e.onChange;Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){var e;return t&&(e=setInterval((function(){var e=o.current,t=n.current,a=r.current,i=t[t.length-1],u={videoWidth:e.videoWidth,videoHeight:e.videoHeight,framesCount:i.frames.length,"window.innerWidth":window.innerWidth,"window.innerHeight":window.innerHeight,"canvas.width":null==a?void 0:a.width,"canvas.height":null==a?void 0:a.height};s(JSON.stringify(u,null,2))}),1e3)),function(){return clearInterval(e)}}),[s,t,n,r,o])}({debug:Y,refRecordedVideos:Pe,refWorkingCanvas:_e,refVideo:Z,onChange:q});var We=_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.a.useAsset("ic_loading.png"),Ve=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){De(),$e(),Be(),te(""),me({popupType:TW})}),[Be,De,$e,me]),Ue=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){Le()}),[Le]),He=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(e){var t=e.curTimeLeft;te(WC(EW.REMAINING_TIME[Q])({x:t}))}),[Q]),je=function(e){var o=e.videoPlayed,s=e.lang,i=e.onAboutToTimeout,u=e.onSessionTimeout,l=e.onVideoTimeLimitReached,c=e.apiSettings,d=e.warmupDone,p=Object(react__WEBPACK_IMPORTED_MODULE_126__.useRef)(),f=P(Object(react__WEBPACK_IMPORTED_MODULE_126__.useState)(0),2),h=f[0],m=f[1],g=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){clearInterval(p.current)}),[]),b=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(){m((function(e){return e+1}))}),[]);return Object(react__WEBPACK_IMPORTED_MODULE_126__.useEffect)((function(){if(d&&o&&null!=c&&c.enableTimers){var e=c.sessionTime,t=c.maxRecordingTimePerVideo,n=0,r=e/3;p.current=setInterval((function(){var a=e-(n+=1);a<=r&&i({curTimeLeft:a}),n>0&&n%t==0&&l(),0===a&&(g(),u())}),1e3)}return function(){g()}}),[o,s,i,g,u,l,h,c,d]),{stopTimers:g,startTimers:b}}({videoPlayed:se,lang:Q,onAboutToTimeout:He,apiClient:X,apiCheck:h,onSessionTimeout:Ve,onVideoTimeLimitReached:Ue,apiSettings:Te,warmupDone:Ae}),Ge=je.stopTimers,qe=je.startTimers,Ke=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)($(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return me({popupType:null}),we(null),Ie.current=!1,qe(),e.next=6,Promise.all([ze(),Re()]);case 6:case"end":return e.stop()}}),e)}))),[ze,Re,qe,me]),Xe=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)((function(e){var t,n,r,a,o,s,i=e.videoAreaWidth,u=e.videoAreaHeight,l=e.lostX,d=e.lostY,p=e.clientHeight;c?(a=.7*(o=u-165),n=(s=(t=d+10)+45)+o+10,r=s+20):(a=j.isMobile?i-6:Math.floor(.7*i),n=(s=(t=d+10)+50)+(o=Math.floor(Math.min(a/1.5,p-2*d-80-100)))+10,r=s+20);var f=Math.floor((i-a)/2)+l;ce({x:f,y:s,width:a,height:o,surroundStyle:{opacity:.6,background:"#000"}}),B({yTitle:t,yDescription:n,yMessage:r}),ie(!0)}),[c]),Ye=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)($(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe(!0),me({popupType:null}),t=ye.current,n={image:t,recordedVideos:null!=Te&&Te.enableRecording?Pe.current:[]},!h){e.next=19;break}return r=null,e.prev=6,I(),e.next=10,xB({image:t,cardSide:f,frontCardId:x,onError:d,apiClient:X,cardType:p,recordedVideos:Pe.current});case 10:r=e.sent,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),d(M(M({},$W.api_call_error),{},{details:e.t0}));case 16:r&&m(M(M({},n),{},{apiResult:r})),e.next=20;break;case 19:m(n);case 20:fe(!1);case 21:case"end":return e.stop()}}),e,null,[[6,13]])}))),[h,X,Te,p,f,x,d,m,I,Pe,me]),Qe=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)($(regeneratorRuntime.mark((function e(){var t,n,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},n=t.imageBlobTaken,!Ie.current){e.next=3;break}return e.abrupt("return");case 3:Ie.current=!0,fe(!0),De(),$e(),Ge(),te(""),ae(""),R((function(e){return e+1})),ye.current=n,C?me({popupType:CW}):Ye(),fe(!1);case 14:case"end":return e.stop()}}),e)}))),[De,$e,Ge,me,C,Ye]);xe.current=Qe;var Ze=Object(react__WEBPACK_IMPORTED_MODULE_126__.useCallback)($(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe(!0),e.next=3,Oe();case 3:return t=e.sent,n=t.imageBlob,r=t.error,we(r),e.next=9,Qe({imageBlobTaken:n});case 9:fe(!1);case 10:case"end":return e.stop()}}),e)}))),[Oe,Qe]);return react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(jz,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Ne,{frontCamera:s,onVideoPlayed:Xe,onClose:l,flipHorizontal:s,ref:Z,onError:d},!Ae&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(nz,{open:!0},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(nW,{className:"warmup-message"},oW.WARMUP_INTRO[Q])),se?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_126___default.a.Fragment,null,Y&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Zz,null,G),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Hz,{keyForTransition:_}),le?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Fe,{x:"".concat(le.x,"px"),y:"".concat(le.y,"px"),width:"".concat(le.width,"px"),height:"".concat(le.height,"px"),surroundStyle:le.surroundStyle},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(rW,{width:le.width,height:le.height,type:re?az:rz})):null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Xz,{y:"".concat(z,"px")},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(uB,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(nB,{key:i,timeout:{enter:500,exit:500},classNames:"flipY",unmountOnExit:!0},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Yz,null,react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Gz,{src:O,alt:""}),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Qz,{className:"title"},i))))),!re&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(Jz,{y:"".concat(W,"px"),className:"description"},u),re&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(eW,{y:"".concat(W,"px")},re),pe?react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(qz,{onClick:null},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("img",{src:We,alt:"",className:"spin"})):re?null:react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(qz,{onClick:Ze},react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement("img",{src:U,alt:""})),ee&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(tW,{key:ee,className:"message",y:"".concat(V,"px")},ee)):null),react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(nz,{open:ge},be===TW&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(fW,{onOk:Ke,maxSessionTime:null==Te?void 0:Te.sessionTime}),be===CW&&react__WEBPACK_IMPORTED_MODULE_126___default.a.createElement(NW,{imageBlobTaken:ye.current,error:ke,onConfirm:Ye,onTryAgain:Ke})))}RW.propTypes={frontCamera:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,usePortraitMask:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,cardType:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,cardSide:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,title:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,titleIcon:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,description:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,onClose:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,apiCheck:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,onSuccess:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,onError:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,frontCardId:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.string,enableRecording:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool,onApiCheck:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.func,resultWarmup:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.shape({}),enableConfirmPopup:prop_types__WEBPACK_IMPORTED_MODULE_128___default.a.bool},RW.defaultProps={frontCamera:!0,usePortraitMask:!1,cardType:_W.VN,cardSide:SW.FRONT,title:"",titleIcon:null,description:"",onClose:function onClose(){},apiCheck:!1,onSuccess:function onSuccess(){},onError:function onError(){},frontCardId:null,enableRecording:!1,onApiCheck:function onApiCheck(){},resultWarmup:null,enableConfirmPopup:!0};var AW=Object.freeze({__proto__:null,Camera:Oe});function DW(){var e=D(["\n  text-align: center;\n  font-size: 20px;\n  font-weight: 600;\n"]);return DW=function DW(){return e},e}_tsocial_tvweb_core__WEBPACK_IMPORTED_MODULE_129__.e.Errors,styled_components__WEBPACK_IMPORTED_MODULE_127__.c.div(DW());var zW=BE,WW=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(VS,["useLivenessDetection"])}).call(this,__webpack_require__(57),__webpack_require__(56),__webpack_require__(75).Buffer,"/index.js","/")},590:function(module,exports){},8:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(global,process,Buffer,__filename,__dirname){__webpack_require__.d(__webpack_exports__,"a",(function(){return p})),__webpack_require__.d(__webpack_exports__,"b",(function(){return h})),__webpack_require__.d(__webpack_exports__,"c",(function(){return K})),__webpack_require__.d(__webpack_exports__,"d",(function(){return Z})),__webpack_require__.d(__webpack_exports__,"e",(function(){return o})),__webpack_require__.d(__webpack_exports__,"f",(function(){return oe})),__webpack_require__.d(__webpack_exports__,"g",(function(){return he})),__webpack_require__.d(__webpack_exports__,"h",(function(){return $t})),__webpack_require__.d(__webpack_exports__,"i",(function(){return At})),__webpack_require__.d(__webpack_exports__,"j",(function(){return Rt})),__webpack_require__.d(__webpack_exports__,"k",(function(){return jy})),__webpack_require__.d(__webpack_exports__,"l",(function(){return be})),__webpack_require__.d(__webpack_exports__,"m",(function(){return l}));__webpack_require__(18),__webpack_require__(25),__webpack_require__(468),__webpack_require__(42),__webpack_require__(35),__webpack_require__(748),__webpack_require__(192),__webpack_require__(750),__webpack_require__(72),__webpack_require__(63),__webpack_require__(52),__webpack_require__(38),__webpack_require__(29),__webpack_require__(24),__webpack_require__(96),__webpack_require__(751),__webpack_require__(32),__webpack_require__(124),__webpack_require__(753),__webpack_require__(21),__webpack_require__(528),__webpack_require__(334),__webpack_require__(520),__webpack_require__(754),__webpack_require__(543),__webpack_require__(368),__webpack_require__(36),__webpack_require__(285),__webpack_require__(757),__webpack_require__(19),__webpack_require__(346),__webpack_require__(758),__webpack_require__(760),__webpack_require__(761),__webpack_require__(762),__webpack_require__(763),__webpack_require__(764),__webpack_require__(765),__webpack_require__(766),__webpack_require__(767),__webpack_require__(768),__webpack_require__(769),__webpack_require__(770),__webpack_require__(243),__webpack_require__(771),__webpack_require__(504),__webpack_require__(518),__webpack_require__(544),__webpack_require__(545),__webpack_require__(1612),__webpack_require__(772),__webpack_require__(775),__webpack_require__(15),__webpack_require__(244),__webpack_require__(37),__webpack_require__(61),__webpack_require__(39),__webpack_require__(539),__webpack_require__(540),__webpack_require__(776),__webpack_require__(23),__webpack_require__(22),__webpack_require__(519),__webpack_require__(95),__webpack_require__(47),__webpack_require__(777),__webpack_require__(40),__webpack_require__(239),__webpack_require__(357),__webpack_require__(27),__webpack_require__(778),__webpack_require__(94),__webpack_require__(242),__webpack_require__(108),__webpack_require__(240),__webpack_require__(216),__webpack_require__(1613),__webpack_require__(708),__webpack_require__(779),__webpack_require__(783),__webpack_require__(784),__webpack_require__(785),__webpack_require__(786),__webpack_require__(787),__webpack_require__(546),__webpack_require__(788),__webpack_require__(789),__webpack_require__(547),__webpack_require__(548),__webpack_require__(549),__webpack_require__(550),__webpack_require__(551),__webpack_require__(552),__webpack_require__(553),__webpack_require__(790),__webpack_require__(554),__webpack_require__(555),__webpack_require__(556),__webpack_require__(557),__webpack_require__(558),__webpack_require__(559),__webpack_require__(560),__webpack_require__(561),__webpack_require__(562),__webpack_require__(563),__webpack_require__(564),__webpack_require__(565),__webpack_require__(566),__webpack_require__(567),__webpack_require__(568),__webpack_require__(569),__webpack_require__(481),__webpack_require__(791),__webpack_require__(64),__webpack_require__(30),__webpack_require__(196),__webpack_require__(194),__webpack_require__(792),__webpack_require__(99);var react__WEBPACK_IMPORTED_MODULE_119__=__webpack_require__(1),react__WEBPACK_IMPORTED_MODULE_119___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_119__),prop_types__WEBPACK_IMPORTED_MODULE_120__=__webpack_require__(4),prop_types__WEBPACK_IMPORTED_MODULE_120___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_120__);function _get(target,property,receiver){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e345){throw _e345},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e346){didErr=!0,err=_e346},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _construct(Parent,args,Class){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(instance,Class.prototype),instance}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var r={not_supported:{code:"not_supported",msg:{en:"Camera is not well-supported on this device/browser. Please try another one.",vi:"Camera không được hỗ trợ. Vui lòng thử trình duyệt hoặc thiết bị khác."}},wrong_orientation:{code:"wrong_orientation",msg:{en:"You are using landscape mode. Please rotate screen to portrait mode and retry.",vi:"Bạn đang sử dụng chế độ màn hình xoay ngang. Vui lòng quay màn hình theo chiều dọc và thực hiện lại."}},unable_to_load_model:{code:"unable_to_load_model",msg:{en:"Unable to load model on this device/browser. Please try another one.",vi:"Không thể load model. Vui lòng thử trình duyệt hoặc thiết bị khác."}},no_permission:{code:"no_permission",msg:{en:"Please grant the permission to access the camera.",vi:"Vui lòng cấp quyền để truy cập camera."}},no_face:{code:"no_face",msg:{en:"Face not found",vi:"Không tìm thấy khuôn mặt"}},partial_face:{code:"partial_face",msg:{en:"Face out of the box",vi:"Không tìm thấy toàn bộ khuôn mặt"}},multiple_faces:{code:"multiple_faces",msg:{en:"Too many faces",vi:"Quá nhiều khuôn mặt"}},face_too_small:{code:"face_too_small",msg:{en:"Face too small",vi:"Khuôn mặt quá nhỏ"}},face_too_large:{code:"face_too_large",msg:{en:"Face too large",vi:"Khuôn mặt quá to"}},face_out_of_box:{code:"face_out_of_box",msg:{en:"Face is out of box",vi:"Khuôn mặt không nằm trọn vẹn trong khung ảnh"}},liveness_too_fast:{code:"liveness_too_fast",msg:{en:"Please turn your face SLOWLY",vi:"Vui lòng quay CHẬM lại"}},liveness_terminated:{code:"liveness_terminated",msg:{en:"Please try again.",vi:"Vui lòng thực hiện lại."}},liveness_terminated_face_tracking:{code:"liveness_terminated_face_tracking",msg:{en:"You need to turn your face SLOWLY.\nPlease try again.",vi:"Bạn cần quay CHẬM lại.\nVui lòng thực hiện lại."}},liveness_terminated_no_face:{code:"liveness_terminated_no_face",msg:{en:"Your face was missing for too long.\nPlease try again.",vi:"Khuôn mặt không nằm trong khung hình.\nXin vui lòng thử lại."}},liveness_terminated_time_out:{code:"liveness_terminated_time_out",msg:{en:"You need to complete gestures as instructed within <%= x %> seconds.\nPlease try again.",vi:"Bạn cần hoàn thành động tác theo chỉ dẫn trong <%= x %> giây.\nXin vui lòng thử lại."}},card_sanity_not_good:{code:"card_sanity_not_good",msg:{en:"Card sanity not good",vi:"Card sanity chưa đạt"}},api_call_error:{code:"api_call_error",msg:{en:"Api call error",vi:"Lỗi call api"}},upload_error:{code:"upload_error",msg:{en:"Upload error",vi:"Lỗi upload"}},sanity_check_error:{code:"sanity_check_error",msg:{en:"Sanity check error",vi:"Lỗi check sanity"}},read_id_card_error:{code:"read_id_card_error",msg:{en:"Read id card error",vi:"Lỗi read id card"}},detect_id_tampering_error:{code:"detect_id_tampering_error",msg:{en:"Detect id tampering error",vi:"Lỗi detect id tampering"}},missing_front_id_card:{code:"missing_front_id_card",msg:{en:"Missing front id",vi:"Không tìm thấy front id"}},server_error:{code:"server_error",msg:"Server error"},client_web_setting_not_found:{code:"client_web_setting_not_found",msg:"Client Web Setting Not Found"},id_detector_validate_angle_error:{code:"id_detector_validate_angle_error",msg:{en:"Please place ID card straight, not tilted",vi:"Vui lòng đặt giấy tờ thẳng, không bị nghiêng khi chụp"}},id_detector_no_cards:{code:"id_detector_no_cards",msg:{en:"Please capture the <%= side %> side of ID card\n (occupy 50-80% of the frame)",vi:"Vui lòng chụp mặt <%= side %> của giấy tờ\n (chiếm 50-80% khung hình)"}},id_detector_card_too_small:{code:"id_detector_card_too_small",msg:{en:"Please move ID card CLOSER\n (occupy 50-80% of the frame)",vi:"Vui lòng đưa giấy tờ lại GẦN hơn\n (chiếm 50-80% khung hình)"}},id_detector_error_incomplete:{code:"id_detector_error_incomplete",msg:{en:"Please move ID card FARTHER\n (occupy 50-80% of the frame)",vi:"Vui lòng đưa giấy tờ ra XA hơn\n (chiếm 50-80% khung hình)"}},glare_detected:{code:"glare_detected",msg:{en:"Glare is detected. Please adjust the shooting angle",vi:"Ảnh bị chói / lóa. Vui lòng điều chỉnh góc chụp."}},id_detector_error_front_side_no_faces:{code:"id_detector_error_front_side_no_faces",msg:{en:"Please capture the front side of ID card",vi:"Vui lòng chụp mặt trước của giấy tờ"}},id_detector_error_front_side_multiple_faces:{code:"id_detector_error_front_side_multiple_faces",msg:{en:"Please capture the front side of one ID card only (remove other items out of the frame)",vi:"Vui lòng chụp mặt trước 1 giấy tờ duy nhất"}},id_detector_error_back_side_has_faces:{code:"id_detector_error_back_side_has_faces",msg:{en:"Please capture the back side of ID card",vi:"Vui lòng chụp mặt sau của giấy tờ"}},id_detector_error_blur:{code:"id_detector_error_blur",msg:{en:"Blurry photo detected. Please capture again for a clearer image",vi:"Ảnh bị mờ. Vui lòng chụp lại để có ảnh rõ nét hơn"}}},a={FRONTAL:"frontal",LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down"},o=Object.freeze({__proto__:null,ErrorDuration:{SHORT:500,LONG:1500,TERMINATE:3e3},Errors:r,FaceDirection:a,Mode:{ACTIVE:"active",PASSIVE:"passive"},Messages:{REMAIN_TIME:{en:"Remaining time: <%= x %> seconds",vi:"Thời gian còn lại: <%= x %> giây"}},IDCardSide:{FRONT:"front",BACK:"back"},IDCardType:{VN:"vn.national_id"},IDCardMessage:{REMAINING_TIME:{en:"Remaining time: <%= x %> seconds",vi:"Thời gian còn lại: <%= x %> giây"},TIMEOUT_INSTRUCTION:{en:"You need to take the picture within <%= x %> seconds.\nPlease try again.",vi:"Bạn cần hoàn thành việc chụp giấy tờ trong <%= x %> giây.\nVui lòng thử lại."}}}),s=react__WEBPACK_IMPORTED_MODULE_119___default.a.createContext();function i(t){var n=t.value,r=t.children;return react__WEBPACK_IMPORTED_MODULE_119___default.a.createElement(s.Provider,{value:n},r)}function u(){var e=Object(react__WEBPACK_IMPORTED_MODULE_119__.useContext)(s);if(void 0===e)throw new Error("useSDKSettings must be used within a SDKSettingsProvider");return e}i.propTypes={value:prop_types__WEBPACK_IMPORTED_MODULE_120___default.a.shape({lang:prop_types__WEBPACK_IMPORTED_MODULE_120___default.a.string,assetRoot:prop_types__WEBPACK_IMPORTED_MODULE_120___default.a.string,apiClient:prop_types__WEBPACK_IMPORTED_MODULE_120___default.a.shape({})}).isRequired,children:prop_types__WEBPACK_IMPORTED_MODULE_120___default.a.node.isRequired};var l=Object.freeze({__proto__:null,SDKSettingsProvider:i,useSDKSettings:u});function c(e,t){return e&&!e.endsWith("/")?[e,"/",t].join(""):[e,t].join("")}function d(){var e=u();return null==e?void 0:e.assetRoot}var p=Object.freeze({__proto__:null,getAsset:c,useAssetRoot:d,useAsset:function useAsset(e){return c(d(),e)}}),h=Object.freeze({__proto__:null,sleep:function sleep(e){return new Promise((function(t){return setTimeout(t,e)}))}});function f(e,t,n,r,a,o,s){try{var i=e[o](s),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){f(o,r,a,s,i,"next",e)}function i(e){f(o,r,a,s,i,"throw",e)}s(void 0)}))}}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e,t){var _n2;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(_n2=w(e))||t&&e&&"number"==typeof e.length){_n2&&(e=_n2);var r=0,a=function a(){};return{s:a,n:function n(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function e(_e2){throw _e2},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function s(){_n2=e[Symbol.iterator]()},n:function n(){var e=_n2.next();return s=e.done,e},e:function e(_e3){i=!0,o=_e3},f:function f(){try{s||null==_n2.return||_n2.return()}finally{if(i)throw o}}}}var C=Symbol("Comlink.proxy"),A=Symbol("Comlink.endpoint"),E=Symbol("Comlink.releaseProxy"),_=Symbol("Comlink.thrown"),$=function $(e){return"object"==_typeof(e)&&null!==e||"function"==typeof e},N=new Map([["proxy",{canHandle:function canHandle(e){return $(e)&&e[C]},serialize:function serialize(e){var _MessageChannel=new MessageChannel,t=_MessageChannel.port1,n=_MessageChannel.port2;return S(e,t),[n,[n]]},deserialize:function deserialize(e){return e.start(),T(e)}}],["throw",{canHandle:function canHandle(e){return $(e)&&_ in e},serialize:function serialize(_ref){var e=_ref.value;return[e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]]},deserialize:function deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self;t.addEventListener("message",(function n(r){if(r&&r.data){var u,_Object$assign=Object.assign({path:[]},r.data),a=_Object$assign.id,o=_Object$assign.type,s=_Object$assign.path,i=(r.data.argumentList||[]).map(L);try{var _t2=s.slice(0,-1).reduce((function(e,t){return e[t]}),e),_n3=s.reduce((function(e,t){return e[t]}),e);switch(o){case"GET":u=_n3;break;case"SET":_t2[s.slice(-1)[0]]=L(r.data.value),u=!0;break;case"APPLY":u=_n3.apply(_t2,i);break;case"CONSTRUCT":u=function(e){return Object.assign(e,_defineProperty({},C,!0))}(_construct(_n3,_toConsumableArray(i)));break;case"ENDPOINT":var _MessageChannel2=new MessageChannel,_t3=_MessageChannel2.port1,_n4=_MessageChannel2.port2;S(e,_n4),u=function(e,t){return D.set(e,t),e}(_t3,[_t3]);break;case"RELEASE":u=void 0;break;default:return}}catch(e){u=_defineProperty({value:e},_,0)}Promise.resolve(u).catch((function(e){return _defineProperty({value:e},_,0)})).then((function(e){var _B2=_slicedToArray(B(e),2),r=_B2[0],s=_B2[1];t.postMessage(Object.assign(Object.assign({},r),{id:a}),s),"RELEASE"===o&&(t.removeEventListener("message",n),R(t))}))}})),t.start&&t.start()}function R(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function T(e,t){return M(e,[],t)}function F(e){if(e)throw new Error("Proxy has been released and is not useable")}function M(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=!1,a=new Proxy(n,{get:function get(n,o){if(F(r),o===E)return function(){return P(e,{type:"RELEASE",path:t.map((function(e){return e.toString()}))}).then((function(){R(e),r=!0}))};if("then"===o){if(0===t.length)return{then:function then(){return a}};var _n5=P(e,{type:"GET",path:t.map((function(e){return e.toString()}))}).then(L);return _n5.then.bind(_n5)}return M(e,[].concat(_toConsumableArray(t),[o]))},set:function set(n,a,o){F(r);var _B4=_slicedToArray(B(o),2),s=_B4[0],i=_B4[1];return P(e,{type:"SET",path:[].concat(_toConsumableArray(t),[a]).map((function(e){return e.toString()})),value:s},i).then(L)},apply:function apply(n,a,o){F(r);var s=t[t.length-1];if(s===A)return P(e,{type:"ENDPOINT"}).then(L);if("bind"===s)return M(e,t.slice(0,-1));var _O2=_slicedToArray(O(o),2),i=_O2[0],u=_O2[1];return P(e,{type:"APPLY",path:t.map((function(e){return e.toString()})),argumentList:i},u).then(L)},construct:function construct(n,a){F(r);var _O4=_slicedToArray(O(a),2),o=_O4[0],s=_O4[1];return P(e,{type:"CONSTRUCT",path:t.map((function(e){return e.toString()})),argumentList:o},s).then(L)}});return a}function O(e){var n,t=e.map(B);return[t.map((function(e){return e[0]})),(n=t.map((function(e){return e[1]})),Array.prototype.concat.apply([],n))]}var D=new WeakMap;function B(e){var _step,_iterator=_createForOfIteratorHelper(N);try{for(_iterator.s();!(_step=_iterator.n()).done;){var _ref4=_slicedToArray(_step.value,2),_t4=_ref4[0],_n6=_ref4[1];if(_n6.canHandle(e)){var _n6$serialize2=_slicedToArray(_n6.serialize(e),2);return[{type:"HANDLER",name:_t4,value:_n6$serialize2[0]},_n6$serialize2[1]]}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return[{type:"RAW",value:e},D.get(e)||[]]}function L(e){switch(e.type){case"HANDLER":return N.get(e.name).deserialize(e.value);case"RAW":return e.value}}function P(e,t,n){return new Promise((function(r){var a=new Array(4).fill(0).map((function(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)})).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===a&&(e.removeEventListener("message",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:a},t),n)}))}var W=function(){if(!window.Worker)return null;var e=new Blob(['const t=Symbol("Comlink.proxy"),e=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),n=Symbol("Comlink.thrown"),a=t=>"object"==typeof t&&null!==t||"function"==typeof t,o=new Map([["proxy",{canHandle:e=>a(e)&&e[t],serialize(t){const{port1:e,port2:r}=new MessageChannel;return i(t,e),[r,[r]]},deserialize(t){return t.start(),s(t,[],e);var e}}],["throw",{canHandle:t=>a(t)&&n in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function i(e,r=self){r.addEventListener("message",(function a(o){if(!o||!o.data)return;const{id:c,type:s,path:l}=Object.assign({path:[]},o.data),p=(o.data.argumentList||[]).map(m);let g;try{const r=l.slice(0,-1).reduce(((t,e)=>t[e]),e),n=l.reduce(((t,e)=>t[e]),e);switch(s){case"GET":g=n;break;case"SET":r[l.slice(-1)[0]]=m(o.data.value),g=!0;break;case"APPLY":g=n.apply(r,p);break;case"CONSTRUCT":g=function(e){return Object.assign(e,{[t]:!0})}(new n(...p));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;i(e,r),g=function(t,e){return f.set(t,e),t}(t,[t])}break;case"RELEASE":g=void 0;break;default:return}}catch(t){g={value:t,[n]:0}}Promise.resolve(g).catch((t=>({value:t,[n]:0}))).then((t=>{const[e,n]=h(t);r.postMessage(Object.assign(Object.assign({},e),{id:c}),n),"RELEASE"===s&&(r.removeEventListener("message",a),u(r))}))})),r.start&&r.start()}function u(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function c(t){if(t)throw new Error("Proxy has been released and is not useable")}function s(t,n=[],a=function(){}){let o=!1;const i=new Proxy(a,{get(e,a){if(c(o),a===r)return()=>p(t,{type:"RELEASE",path:n.map((t=>t.toString()))}).then((()=>{u(t),o=!0}));if("then"===a){if(0===n.length)return{then:()=>i};const e=p(t,{type:"GET",path:n.map((t=>t.toString()))}).then(m);return e.then.bind(e)}return s(t,[...n,a])},set(e,r,a){c(o);const[i,u]=h(a);return p(t,{type:"SET",path:[...n,r].map((t=>t.toString())),value:i},u).then(m)},apply(r,a,i){c(o);const u=n[n.length-1];if(u===e)return p(t,{type:"ENDPOINT"}).then(m);if("bind"===u)return s(t,n.slice(0,-1));const[f,h]=l(i);return p(t,{type:"APPLY",path:n.map((t=>t.toString())),argumentList:f},h).then(m)},construct(e,r){c(o);const[a,i]=l(r);return p(t,{type:"CONSTRUCT",path:n.map((t=>t.toString())),argumentList:a},i).then(m)}});return i}function l(t){const e=t.map(h);return[e.map((t=>t[0])),(r=e.map((t=>t[1])),Array.prototype.concat.apply([],r))];var r}const f=new WeakMap;function h(t){for(const[e,r]of o)if(r.canHandle(t)){const[n,a]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},a]}return[{type:"RAW",value:t},f.get(t)||[]]}function m(t){switch(t.type){case"HANDLER":return o.get(t.name).deserialize(t.value);case"RAW":return t.value}}function p(t,e,r){return new Promise((n=>{const a=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(r){r.data&&r.data.id&&r.data.id===a&&(t.removeEventListener("message",e),n(r.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:a},e),r)}))}var g=[[0,1,0],[1,-4,1],[0,1,0]];function d(t,e,r,n){return t[4*(r*e+n)]}function v(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function b(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance. In order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var E="frontal",S="left",w="right",M="up",k="down",A=0,_=1,R=2;function L(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=b(t,2),a=n[0],o=n[1],i=b(e,2),u=i[0],c=i[1],s=[a[0],o[0]],l=[a[1],o[1]];return s[0]+r<=u[0]&&c[0]<=s[1]-r&&l[0]+r<=u[1]&&c[1]<=l[1]-.8*r?R:s[0]<=u[0]||c[0]<=s[1]||l[0]<=u[1]||c[1]<=l[1]?_:A}var N={code:"no_face",msg:{en:"Face not found",vi:"Không tìm thấy khuôn mặt"}},P={code:"partial_face",msg:{en:"Face out of the box",vi:"Không tìm thấy toàn bộ khuôn mặt"}},O={code:"multiple_faces",msg:{en:"Too many faces",vi:"Quá nhiều khuôn mặt"}},j={code:"face_too_small",msg:{en:"Face too small",vi:"Khuôn mặt quá nhỏ"}},T={code:"face_too_large",msg:{en:"Face too large",vi:"Khuôn mặt quá to"}},C={code:"face_out_of_box",msg:{en:"Face is out of box",vi:"Khuôn mặt không nằm trọn vẹn trong khung ảnh"}};function F(t){return Math.pow(Math.pow(t[0],2)+Math.pow(t[1],2),.5)}function x(t,e){return[t[0]-e[0],t[1]-e[1]]}function I(t,e,r,n){var a=r*(4*e)+4*n;return{r:t[a],g:t[a+1],b:t[a+2]}}i({calculateBlurScoreFunc:function(t){for(var e=t.data,r=t.reducedWidth,n=t.reducedHeight,a=0;a<e.length;a+=4){var o=(e[a]+e[a+1]+e[a+2])/3;e[a]=o}for(var i=0,u=0,c=n-1,s=r-1,l=1;l<c;l++)for(var f=1;f<s;f++){var h=g[0][0]*d(e,r,f-1,l-1)+g[0][1]*d(e,r,f,l-1)+g[0][2]*d(e,r,f+1,l-1)+g[1][0]*d(e,r,f-1,l)+g[1][1]*d(e,r,f,l)+g[1][2]*d(e,r,f+1,l)+g[2][0]*d(e,r,f-1,l+1)+g[2][1]*d(e,r,f,l+1)+g[2][2]*d(e,r,f+1,l+1);(h=Math.abs(h))>25&&i++,h>15&&h<25&&u++}var m=0;return i+u!==0&&(m=i/(i+u)),m},calculateFaceDirectionFunc:function(t){var e=t.landmarks,r=t.getPerfectFrontal,n=function(t){var e,r,n,a,o,i,u,c=b(t,4),s=c[0],l=c[1],f=c[2],h=c[3],m=x(l,s),p=F(m),g=(a=l,e=[(n=s)[0]+a[0],n[1]+a[1]],r=2,[e[0]/r,e[1]/r]),d=x(f,g),v=F(x(h,f)),y=x(h,g),E=F(y),S=(d[0]*y[0]+d[1]*y[1])/E,w=v/E;if(p>.5*E)o=(d[0]*m[0]+d[1]*m[1])/p/p;else{var M=F(x(d,function(t,e){return[t[0]*e,t[1]*e]}(y,S/E)));u=y,o=((i=d)[0]*u[1]-u[0]*i[1]>=0?1:-1)*M/p}return{left_right_score:o,up_down_score:w}}(e),a=n.left_right_score,o=n.up_down_score,i=b(e,3),u=i[0],c=i[1],s=i[2],l=c[0]-s[0],f=u[0]-s[0],h=r?.1:.3,m=o>.7,p=o<.42,g=a>=.35&&a<=.6,d=a<=-.35&&a>=-.6;return o>=.42&&o<=.7&&a>-h&&a<h&&l*f<0?{gesture:E,leftRightScore:a}:m&&!d&&!g?{gesture:M,leftRightScore:a}:p&&!d&&!g?{gesture:k,leftRightScore:a}:g&&!m&&!p?{gesture:w,leftRightScore:a}:d&&!m&&!p?{gesture:S,leftRightScore:a}:null},validatePredictionsFunc:function(t){var e,r,n,a,o,i,u,c,s,l,f,h,m,p,g,d,y,E,S,w,M,k,F,x,I,z,H,D,K,G,W,q,U=t.predictions,B=t.width,Y=[[0,0],[B,t.height]],Q=U.reduce((function(t,e){var r=e.topLeft,n=e.bottomRight,a=e.probability,o=e.landmarks;a<.9||o.length<6||function(t){var e=t.small,r=e.coords,n=e.area,a=t.big,o=a.coords,i=a.area,u=n;if(!u){var c=b(r,2),s=c[0],l=c[1];u=(l[0]-s[0])*(l[1]-s[1])}var f=i;if(!f){var h=b(o,2),m=h[0],p=h[1];f=(p[0]-m[0])*(p[1]-m[1])}return u/f}({small:{coords:[r,n]},big:{coords:Y}})<=.025?t[A].push(e):t[L(Y,[r,n])].push(e);return t}),(v(e={},_,[]),v(e,R,[]),v(e,A,[]),e)),X=Q[R].length,$=Q[_].length;if(0===X)r=$>0?P:N;else if(X+$>1)r=O;else{var J=n=Q[R][0],V=J.topLeft,Z=J.bottomRight,tt=(F=Y,x=b([V,Z],2),I=x[0],z=x[1],H=b(F,2),D=H[0],K=H[1],G=z[0]-I[0],W=z[1]-I[1],q=K[0]-D[0],G/q<W/q?G/q:W/q);tt<.4&&(r=j),tt>.61&&(r=T),L(Y,(a=n.landmarks,u=a[0],c=a[1],s=a[2],l=a[3],f=a[4],h=a[5],m=.5*(u[1]+c[1]),p=m+1.5*(m-l[1]),g=l[1]-1.2*(s[1]-l[1]),d=[u[0],c[0],s[0],l[0],f[0],h[0]],y=Math.min.apply(Math,d),E=Math.min(p,g),S=Math.max.apply(Math,d),w=Math.max(p,g),M=Math.abs(l[0]-f[0])/Math.abs(l[0]-h[0]),k=l[0]-f[0]<0&&h[0]-l[0]>.05*(S-y),l[0]-f[0]>0&&h[0]-l[0]<-.05*(S-y)?(o=.2,i=.1):k?(o=.1,i=.2):M>2||M<.5?(o=.15,i=.15):(o=.05,i=.05),[[y-o*(S-y),E],[S+i*(S-y),w]]),.05*B)!==R&&(r=C)}return{error:r,fullFace:n}},checkCardBlur:function(t){var e=t.data,r=t.width,n=t.height,a=function(t,e,r){for(var n=0,a=[],o=1;o<r-1;o++)for(var i=1;i<e-1;i++){var u=t[o-1][i-1],c=t[o][i-1],s=t[o+1][i-1],l=t[o-1][i],f=t[o][i],h=t[o+1][i],m=t[o-1][i+1],p=t[o][i+1],g=t[o+1][i+1],d=Number.parseInt(0*u+1*c+0*s,10),v=Number.parseInt(1*l+-4*f+1*h,10),b=Number.parseInt(0*m+1*p+0*g,10),y=Number.parseInt(Math.abs(d+v+b),10);a.push(y),n+=y}var E=a.length,S=n/E,w=0;a.forEach((function(t){w+=(t-S)*(t-S)}));var M=Math.sqrt(w/E);return{lapAvg:S,lapStd:M}}(function(t,e,r){for(var n=[],a=0;a<r+2;a++)for(var o=0;o<e+2;o++){n[a]||(n[a]=[]),0!==o&&0!==a&&o!==e+1&&a!==r+1||(n[a][o]=1);var i=I(t,e,a-1,o-1),u=i.r,c=i.g,s=i.b,l=Number.parseInt(Math.round(.299*u+.587*c+.114*s),10);n[a][o]=l}n[0]=n[2],n[r+1]=n[r-1];for(var f=0;f<r+2;f++)n[f][0]=n[f][2],n[f][e+1]=n[f][e-1];return n}(e,r,n),r+2,n+2);return function(t,e){return e<=18.553622245788574?e<=11.523502826690674?t<=-.05309182405471802?1:.5:t<=.2395537868142128?.29069767441860467:.8333333333333334:e<=23.69584369659424?e<=23.6335506439209?.10606060606060606:1:e<=33.88881301879883?.03896103896103896:0}(a.lapAvg,a.lapStd)},detectGlare:function(t,e,r){return function(t,e,r){for(var n=0,a=r[1],o=r[3],i=r[0],u=r[2],c=a;c<o;c++)for(var s=i;s<u;s++){var l=I(t,e,c,s),f=l.r,h=l.g,m=l.b;f>=245&&m>=245&&h>245&&(n+=1)}return n}(t,e,function(t,e){var r=Math.floor(.025*t),n=t-r,a=Math.floor(.025*e);return[r,a,n,e-a]}(e,r))/(e*r)>=.001}});']),t=URL.createObjectURL(e);return T(new Worker(t))}(),U=[[0,1,0],[1,-4,1],[0,1,0]];function V(e,t,n,r){return e[4*(n*t+r)]}function G(e){for(var t=e.data,n=e.reducedWidth,r=e.reducedHeight,a=0;a<t.length;a+=4){var o=(t[a]+t[a+1]+t[a+2])/3;t[a]=o}for(var s=0,i=0,u=r-1,l=n-1,c=1;c<u;c++)for(var d=1;d<l;d++){var p=U[0][0]*V(t,n,d-1,c-1)+U[0][1]*V(t,n,d,c-1)+U[0][2]*V(t,n,d+1,c-1)+U[1][0]*V(t,n,d-1,c)+U[1][1]*V(t,n,d,c)+U[1][2]*V(t,n,d+1,c)+U[2][0]*V(t,n,d-1,c+1)+U[2][1]*V(t,n,d,c+1)+U[2][2]*V(t,n,d+1,c+1);(p=Math.abs(p))>25&&s++,p>15&&p<25&&i++}var h=0;return s+i!==0&&(h=s/(s+i)),h}function z(e,t,n,r){var a=n*(4*t)+4*r;return{r:e[a],g:e[a+1],b:e[a+2]}}function H(e){var t=e.data,n=e.width,r=e.height,a=function(e,t,n){for(var r=0,a=[],o=1;o<n-1;o++)for(var s=1;s<t-1;s++){var i=e[o-1][s-1],u=e[o][s-1],l=e[o+1][s-1],c=e[o-1][s],d=e[o][s],p=e[o+1][s],h=e[o-1][s+1],f=e[o][s+1],m=e[o+1][s+1],g=Number.parseInt(0*i+1*u+0*l,10),b=Number.parseInt(1*c+-4*d+1*p,10),x=Number.parseInt(0*h+1*f+0*m,10),v=Number.parseInt(Math.abs(g+b+x),10);a.push(v),r+=v}var y=a.length,w=r/y,k=0;a.forEach((function(e){k+=(e-w)*(e-w)}));var I=Math.sqrt(k/y);return{lapAvg:w,lapStd:I}}(function(e,t,n){for(var r=[],a=0;a<n+2;a++)for(var o=0;o<t+2;o++){r[a]||(r[a]=[]),0!==o&&0!==a&&o!==t+1&&a!==n+1||(r[a][o]=1);var s=z(e,t,a-1,o-1),i=s.r,u=s.g,l=s.b,c=Number.parseInt(Math.round(.299*i+.587*u+.114*l),10);r[a][o]=c}r[0]=r[2],r[n+1]=r[n-1];for(var d=0;d<n+2;d++)r[d][0]=r[d][2],r[d][t+1]=r[d][t-1];return r}(t,n,r),n+2,r+2);return function(e,t){return t<=18.553622245788574?t<=11.523502826690674?e<=-.05309182405471802?1:.5:e<=.2395537868142128?.29069767441860467:.8333333333333334:t<=23.69584369659424?t<=23.6335506439209?.10606060606060606:1:t<=33.88881301879883?.03896103896103896:0}(a.lapAvg,a.lapStd)}function j(e){var t=e.width,n=e.height,r=e.getContext("2d"),a=Math.floor(t/2.8),o=Math.floor(n/2.8),s=t-a,i=n-o;return{data:r.getImageData(Math.floor(a/2),Math.floor(o/2),s,i).data,reducedWidth:s,reducedHeight:i}}function X(){return(X=m(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=j(t),W){e.next=3;break}return e.abrupt("return",G(n));case 3:return e.abrupt("return",W.calculateBlurScoreFunc(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){var t=document.createElement("canvas"),n=200,r=e.width*(n/e.width);t.width=r,t.height=n;var a=t.getContext("2d");return a.drawImage(e,0,0,r,n),{data:a.getImageData(0,0,r,n).data,width:r,height:n}}function Q(){return(Q=m(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=q(t),W){e.next=3;break}return e.abrupt("return",H(n));case 3:return e.abrupt("return",W.checkCardBlur(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=Object.freeze({__proto__:null,BLUR_CARD_THRESHOLD:.29069767441860467,calculateBlurScore:function calculateBlurScore(e){return X.apply(this,arguments)},hasBetterBlurScore:function hasBetterBlurScore(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01;return null===t||e-t>n},calculateCardBlurScore:function calculateCardBlurScore(e){return Q.apply(this,arguments)}});function Y(e){var t,n,r,a,o,s,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=i.x,c=i.y,d=i.width,p=i.height,h=e.videoWidth,f=e.videoHeight,m=window.innerWidth,g=window.innerHeight,b=m/g,x=h/f;b<x?(o=l*(r=h/m),s=(c-(t=(g-m/x)/2))*(a=f/(g-2*t))):(o=(l-(n=(m-g*x)/2))*(r=h/(m-2*n)),s=c*(a=f/g));var v=d*r,y=p*a,w=Math.max(v,y)*u;return{lostX:n,lostY:t,cropWidth:v=Math.floor(Math.min(h,v+2*w)),cropHeight:y=Math.floor(Math.min(f,y+2*w)),cropX:o=Math.floor(Math.max(0,o-w)),cropY:s=Math.floor(Math.max(0,s-w))}}var Z=Object.freeze({__proto__:null,analyzeVideoAndWindowSizes:Y,takePicture:function takePicture(e){var t,n=e.canvas,r=e.video,a=e.cropArea;if(n)t=n;else{var o=Y(r,a),s=o.cropWidth,i=o.cropHeight,u=o.cropX,l=o.cropY,c=(t=document.createElement("canvas")).getContext("2d");t.width=s,t.height=i,c.drawImage(r,u,l,s,i,0,0,s,i)}return new Promise((function(e){t.toBlob(e,"image/jpeg",1)}))}}),J=function J(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}return e},te=(Object.freeze({__proto__:null,shuffleArray:J}),{NONE:0,PARTIAL:1,FULL:2});function ne(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=v(e,2),a=r[0],o=r[1],s=v(t,2),i=s[0],u=s[1],l=[a[0],o[0]],c=[a[1],o[1]];return l[0]+n<=i[0]&&u[0]<=l[1]-n&&c[0]+n<=i[1]&&u[1]<=c[1]-.8*n?te.FULL:l[0]<=i[0]||u[0]<=l[1]||c[0]<=i[1]||u[1]<=c[1]?te.PARTIAL:te.NONE}function re(e){var t=e.small,n=t.coords,r=t.area,a=e.big,o=a.coords,s=a.area,i=r;if(!i){var u=v(n,2),l=u[0],c=u[1];i=(c[0]-l[0])*(c[1]-l[1])}var d=s;if(!d){var p=v(o,2),h=p[0],f=p[1];d=(f[0]-h[0])*(f[1]-h[1])}return i/d}function ae(e,t){var n=v(e,2),r=n[0],a=n[1],o=v(t,2),s=o[0],i=o[1],u=a[0]-r[0],l=a[1]-r[1],c=i[0]-s[0];return u/c<l/c?u/c:l/c}var oe=Object.freeze({__proto__:null,ContainMode:te,rectContains:ne,rectAreaRatio:re,rectEdgeRatio:ae,isFaceCenter:function isFaceCenter(e,t){var n=v(e,2),r=n[0],a=n[1],o=v(t,2),s=o[0],i=o[1],u=a[0]-r[0],l=a[1]-r[1],c=i[0]-s[0],d=Math.abs(r[0]-(c-u)/2)/c<.2,p=Math.abs(r[1]-(c-l)/2)/c<.2;return!(!d||!p)}});function se(e){return Math.pow(Math.pow(e[0],2)+Math.pow(e[1],2),.5)}function ie(e,t){return[e[0]-t[0],e[1]-t[1]]}function ue(e){var t=e.landmarks,n=e.getPerfectFrontal,r=function(e){var t,r,a,o,s,i,u=v(e,4),l=u[0],c=u[1],d=u[2],p=u[3],h=ie(c,l),f=se(h),m=(a=c,2,[(t=[(r=l)[0]+a[0],r[1]+a[1]])[0]/2,t[1]/2]),g=ie(d,m),b=se(ie(p,d)),x=ie(p,m),y=se(x),w=(g[0]*x[0]+g[1]*x[1])/y,k=b/y;if(f>.5*y)o=(g[0]*h[0]+g[1]*h[1])/f/f;else{var I=se(ie(g,function(e,t){return[e[0]*t,e[1]*t]}(x,w/y)));i=x,o=((s=g)[0]*i[1]-i[0]*s[1]>=0?1:-1)*I/f}return{left_right_score:o,up_down_score:k}}(t),o=r.left_right_score,s=r.up_down_score,i=v(t,3),u=i[0],l=i[1],c=i[2],d=l[0]-c[0],p=u[0]-c[0],h=n?.1:.3,f=s>.7,m=s<.42,g=o>=.35&&o<=.6,b=o<=-.35&&o>=-.6;return s>=.42&&s<=.7&&o>-h&&o<h&&d*p<0?{gesture:a.FRONTAL,leftRightScore:o}:!f||b||g?!m||b||g?!g||f||m?!b||f||m?null:{gesture:a.LEFT,leftRightScore:o}:{gesture:a.RIGHT,leftRightScore:o}:{gesture:a.DOWN,leftRightScore:o}:{gesture:a.UP,leftRightScore:o}}function le(e){var t,n,a,o,s,i,u,l,c,d,p,h,f,m,b,x,v,y,w,k,I,C,A=e.predictions,E=e.width,_=[[0,0],[E,e.height]],$=A.reduce((function(e,t){var n=t.topLeft,r=t.bottomRight,a=t.probability,o=t.landmarks;return a<.9||o.length<6||re({small:{coords:[n,r]},big:{coords:_}})<=.025?e[te.NONE].push(t):e[ne(_,[n,r])].push(t),e}),(g(t={},te.PARTIAL,[]),g(t,te.FULL,[]),g(t,te.NONE,[]),t)),N=$[te.FULL].length,S=$[te.PARTIAL].length;if(0===N)n=S>0?r.partial_face:r.no_face;else if(N+S>1)n=r.multiple_faces;else{var R=a=$[te.FULL][0],T=ae([R.topLeft,R.bottomRight],_);T<.4&&(n=r.face_too_small),T>.61&&(n=r.face_too_large),ne(_,(u=(o=a.landmarks)[0],l=o[1],c=o[2],d=o[3],p=o[4],h=o[5],m=(f=.5*(u[1]+l[1]))+1.5*(f-d[1]),b=d[1]-1.2*(c[1]-d[1]),x=[u[0],l[0],c[0],d[0],p[0],h[0]],v=Math.min.apply(Math,x),y=Math.min(m,b),w=Math.max.apply(Math,x),k=Math.max(m,b),I=Math.abs(d[0]-p[0])/Math.abs(d[0]-h[0]),C=d[0]-p[0]<0&&h[0]-d[0]>.05*(w-v),d[0]-p[0]>0&&h[0]-d[0]<-.05*(w-v)?(s=.2,i=.1):C?(s=.1,i=.2):I>2||I<.5?(s=.15,i=.15):(s=.05,i=.05),[[v-s*(w-v),y],[w+i*(w-v),k]]),.05*E)!==te.FULL&&(n=r.face_out_of_box)}return{error:n,fullFace:a}}function ce(e,t){var n=t.customInstructions,r=t.customIcon,a=t.customDirectionIcon,o=t.customStepTimeConstraints,s={};return null!=n&&n[e]&&(s.instructions=n[e]),null!=r&&r[e]&&(s.icon=r[e]),null!=a&&a[e]&&(s.directionIcon=a[e]),null!=o&&o[e]&&(s.stepTimeConstraints=o[e]),s}function de(){return(de=m(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(W){e.next=2;break}return e.abrupt("return",le(t));case 2:return e.abrupt("return",W.validatePredictionsFunc(t));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(){return(pe=m(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(W){e.next=2;break}return e.abrupt("return",ue(t));case 2:return e.abrupt("return",W.calculateFaceDirectionFunc(t));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var he=Object.freeze({__proto__:null,initFaceVerificationData:function initFaceVerificationData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.assetRoot,n=void 0===t?"/":t,r=e.customInstructions,o=e.customIcon,s=e.customDirectionIcon,i=e.customStepTimeConstraints;return{curStepIndex:0,steps:[].concat(y(J([x({name:a.LEFT,instructions:{en:"Turn your face to the left",vi:"Quay mặt chậm qua trái"},image:{blob:null,imageId:null,objUrl:null,blurScore:null,leftRightScore:null},frontalFaceImage:{blob:null,imageId:null,blurScore:null,leftRightScore:null},icon:c(n,"ic_face_left.svg"),directionIcon:c(n,"arrow_left.svg"),directionIconAnimation:"slide-horizontal",firstFrameSpottedAt:null,stepTimeConstraints:{delayTime:null}},ce(a.LEFT,{customInstructions:r,customIcon:o,customDirectionIcon:s,customStepTimeConstraints:i})),x({name:a.RIGHT,instructions:{en:"Turn your face to the right",vi:"Quay mặt chậm qua phải"},image:{blob:null,imageId:null,objUrl:null,blurScore:null,leftRightScore:null},frontalFaceImage:{blob:null,imageId:null,blurScore:null,leftRightScore:null},icon:c(n,"ic_face_right.svg"),directionIcon:c(n,"arrow_right.svg"),directionIconAnimation:"slide-horizontal",firstFrameSpottedAt:null,stepTimeConstraints:{delayTime:null}},ce(a.RIGHT,{customInstructions:r,customIcon:o,customDirectionIcon:s,customStepTimeConstraints:i})),x({name:a.UP,instructions:{en:"Turn your face up",vi:"Ngước mặt chậm lên trên"},image:{blob:null,imageId:null,objUrl:null,blurScore:null,leftRightScore:null},frontalFaceImage:{blob:null,imageId:null,blurScore:null,leftRightScore:null},icon:c(n,"ic_face_up.svg"),directionIcon:c(n,"arrow_up.svg"),directionIconAnimation:"slide-vertical",firstFrameSpottedAt:null,stepTimeConstraints:{delayTime:null}},ce(a.UP,{customInstructions:r,customIcon:o,customDirectionIcon:s,customStepTimeConstraints:i}))])),[x({name:a.FRONTAL,instructions:{en:"Look straight into the camera",vi:"Nhìn thẳng camera"},image:{blob:null,imageId:null,objUrl:null,blurScore:null,leftRightScore:null},frontalFaceImage:{blob:null,imageId:null,blurScore:null,leftRightScore:null},icon:c(n,"ic_face_frontal.svg"),directionIcon:c(n,"frontal.svg"),directionIconAnimation:"blink",firstFrameSpottedAt:null,stepTimeConstraints:{delayTime:null}},ce(a.FRONTAL,{customInstructions:r,customIcon:o,customDirectionIcon:s,customStepTimeConstraints:i}))])}},validatePredictions:function validatePredictions(e){return de.apply(this,arguments)},calculateFaceDirection:function calculateFaceDirection(e){return pe.apply(this,arguments)},faceTracker:function faceTracker(){var e=[],t=[],n=[],r=[],a=[],o=0,s=0;function i(){s=o,n=y(e),r=y(t)}return function(u,l){var c=u.topLeft,d=u.bottomRight,p=u.landmarks,h=[],f=v(c,2);h[0]=f[0],h[1]=f[1];var m=v(d,2);h[2]=m[0],h[3]=m[1];var g=[],b=[];p.forEach((function(e,t){var n=v(e,2);g[t]=n[0],b[t]=n[1]})),o=Date.now();var x=h[2]-h[0];if(e=[].concat(g),t=[].concat(b),!n.length&&!r.length||l)return i(),{score:0,time:o};for(var y=0;y<6;y++)a[y]=Math.sqrt((e[y]-n[y])*(e[y]-n[y])+(t[y]-r[y])*(t[y]-r[y]));for(var w=0;w<6;w++)a[w]/=(o-s)*x;for(var k=0,I=0;I<6;I++)k+=a[I];return k/=6,i(),{score:k,time:o}}}}),fe=document.createElement("canvas"),me=fe.getContext("2d");fe.width=128,fe.height=128;var e,ge=(e=m(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.model,a=t.sCanvas,me.drawImage(a,0,0,fe.width,fe.height),e.abrupt("return",n.estimateFaces(fe,!1,!1,!0));case 3:case"end":return e.stop()}var a}),e)}))),function(t){return e.apply(this,arguments)}),be=Object.freeze({__proto__:null,SIZE:128,getModelPredictions:ge}),xe=Object.getOwnPropertySymbols,ve=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;function we(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var ke=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,r,a=we(e),o=1;o<arguments.length;o++){for(var s in n=Object(arguments[o]))ve.call(n,s)&&(a[s]=n[s]);if(xe){r=xe(n);for(var i=0;i<r.length;i++)ye.call(n,r[i])&&(a[r[i]]=n[r[i]])}}return a},Ie=arguments[3],Ce=arguments[4],Ae=arguments[5],Ee=JSON.stringify,_e=function _e(e,t){for(var n,r=Object.keys(Ae),a=0,o=r.length;a<o;a++){var s=r[a],i=Ae[s].exports;if(i===e||i&&i.default===e){n=s;break}}if(!n){n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var u={};for(a=0,o=r.length;a<o;a++)u[s=r[a]]=s;Ce[n]=["function(require,module,exports){"+e+"(self); }",u]}var l=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={};c[n]=n,Ce[l]=["function(require,module,exports){var f = require("+Ee(n)+");(f.default ? f.default : f)(self);}",c];var d={};!function e(t){for(var n in d[t]=!0,Ce[t][1]){var r=Ce[t][1][n];d[r]||e(r)}}(l);var p="("+Ie+")({"+Object.keys(d).map((function(e){return Ee(e)+":["+Ce[e][0]+","+Ee(Ce[e][1])+"]"})).join(",")+"},{},["+Ee(l)+"])",h=window.URL||window.webkitURL||window.mozURL||window.msURL,f=new Blob([p],{type:"text/javascript"});if(t&&t.bare)return f;var m=h.createObjectURL(f),g=new Worker(m);return g.objectURL=m,g},$e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};function Ne(e,t,n){return e(n={path:t,exports:{},require:function require(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}function Se(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function get(){return e[n]}})})),t}var Re,Te=Ne((function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function n(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}})),Fe={js:!0,wasm:!0};function Me(e){if(!(this instanceof Me))return new Me(e);var t=ke({},Fe,e||{});if(this.options=t,this.__cache={},this.__init_promise=null,this.__modules=t.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}Me.prototype.has_wasm=function(){if(void 0!==Re)return Re;if(Re=!1,"undefined"==typeof WebAssembly)return Re;try{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)&&(Re=!0),Re}catch(e){}return Re},Me.prototype.use=function(e){return this.__modules[e.name]=e,this.options.wasm&&this.has_wasm()&&e.wasm_fn?this[e.name]=e.wasm_fn:this[e.name]=e.fn,this},Me.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var e=this;return this.__init_promise=Promise.all(Object.keys(e.__modules).map((function(t){var n=e.__modules[t];return e.options.wasm&&e.has_wasm()&&n.wasm_fn?e.__wasm[t]?null:WebAssembly.compile(e.__base64decode(n.wasm_src)).then((function(n){e.__wasm[t]=n})):null}))).then((function(){return e})),this.__init_promise},Me.prototype.__base64decode=function(e){for(var t=e.replace(/[\r\n=]/g,""),n=t.length,r=new Uint8Array(3*n>>2),a=0,o=0,s=0;s<n;s++)s%4==0&&s&&(r[o++]=a>>16&255,r[o++]=a>>8&255,r[o++]=255&a),a=a<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(t.charAt(s));var i=n%4*6;return 0===i?(r[o++]=a>>16&255,r[o++]=a>>8&255,r[o++]=255&a):18===i?(r[o++]=a>>10&255,r[o++]=a>>2&255):12===i&&(r[o++]=a>>4&255),r},Me.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/65536)}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/65536)),this.__memory},Me.prototype.__instance=function(e,t,n){if(t&&this.__reallocate(t),!this.__wasm[e]){var r=this.__modules[e];this.__wasm[e]=new WebAssembly.Module(this.__base64decode(r.wasm_src))}if(!this.__cache[e]){var a={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:ke(a,n||{})})}return this.__cache[e]},Me.prototype.__align=function(e,t){var n=e%(t=t||8);return e+(n?t-n:0)};var Oe,De,Be,Le,Pe,We,Ue=Me;function Ve(e,t,n,r,a,o){var s,i,u,l,c,d,p,h,f,m,g,b,x,v;for(f=0;f<o;f++){for(p=f,h=0,l=c=(s=e[d=f*a])*r[6],g=r[0],b=r[1],x=r[4],v=r[5],m=0;m<a;m++)u=(i=e[d])*g+s*b+l*x+c*v,c=l,l=u,s=i,n[h]=l,h++,d++;for(h--,p+=o*(a-1),l=c=(s=e[--d])*r[7],i=s,g=r[2],b=r[3],m=a-1;m>=0;m--)u=i*g+s*b+l*x+c*v,c=l,l=u,s=i,i=e[d],t[p]=n[h]+l,d--,h--,p-=o}}var Ge=function Ge(e,t,n,r){if(r){var a=new Uint16Array(e.length),o=new Float32Array(Math.max(t,n)),s=function(e){e<.5&&(e=.5);var t=Math.exp(.527076)/e,n=Math.exp(-t),r=Math.exp(-2*t),a=(1-n)*(1-n)/(1+2*t*n-r);return Oe=a,De=a*(t-1)*n,Be=a*(t+1)*n,Le=-a*r,Pe=2*n,We=-r,new Float32Array([Oe,De,Be,Le,Pe,We,(Oe+De)/(1-Pe-We),(Be+Le)/(1-Pe-We)])}(r);Ve(e,a,o,s,t,n),Ve(a,e,o,s,n,t)}},ze={name:"unsharp_mask",fn:function fn(e,t,n,r,a,o){var s,i,u,l,c,d,p,h,f,m,g,b,x;if(!(0===r||a<.5)){a>2&&(a=2);var v=function(e,t,n){for(var r,a,o,s,i,u=t*n,l=new Uint16Array(u),c=0;c<u;c++)r=e[4*c],a=e[4*c+1],o=e[4*c+2],i=r>=a&&r>=o?r:a>=o&&a>=r?a:o,s=r<=a&&r<=o?r:a<=o&&a<=r?a:o,l[c]=257*(i+s)>>1;return l}(e,t,n),y=new Uint16Array(v);Ge(y,t,n,a);for(var w=r/100*4096+.5|0,k=257*o|0,I=t*n,C=0;C<I;C++)b=2*(v[C]-y[C]),Math.abs(b)>=k&&(s=e[x=4*C],i=e[x+1],u=e[x+2],d=257*((h=s>=i&&s>=u?s:i>=s&&i>=u?i:u)+(p=s<=i&&s<=u?s:i<=s&&i<=u?i:u))>>1,p===h?l=c=0:(c=d<=32767?4095*(h-p)/(h+p)|0:4095*(h-p)/(510-h-p)|0,l=s===h?65535*(i-u)/(6*(h-p))|0:i===h?21845+(65535*(u-s)/(6*(h-p))|0):43690+(65535*(s-i)/(6*(h-p))|0)),(d+=w*b+2048>>12)>65535?d=65535:d<0&&(d=0),0===c?s=i=u=d>>8:(f=2*d-(m=d<=32767?d*(4096+c)+2048>>12:d+((65535-d)*c+2048>>12))>>8,m>>=8,s=(g=l+21845&65535)>=43690?f:g>=32767?f+(6*(m-f)*(43690-g)+32768>>16):g>=10922?m:f+(6*(m-f)*g+32768>>16),i=(g=65535&l)>=43690?f:g>=32767?f+(6*(m-f)*(43690-g)+32768>>16):g>=10922?m:f+(6*(m-f)*g+32768>>16),u=(g=l-21845&65535)>=43690?f:g>=32767?f+(6*(m-f)*(43690-g)+32768>>16):g>=10922?m:f+(6*(m-f)*g+32768>>16)),e[x]=s,e[x+1]=i,e[x+2]=u)}},wasm_fn:function wasm_fn(e,t,n,r,a,o){if(!(0===r||a<.5)){a>2&&(a=2);var s=t*n,i=4*s,u=2*s,l=2*s,c=4*Math.max(t,n),d=i,p=d+u,h=p+l,f=h+l,m=f+c,g=this.__instance("unsharp_mask",i+u+2*l+c+32,{exp:Math.exp}),b=new Uint32Array(e.buffer);new Uint32Array(this.__memory.buffer).set(b);var x=g.exports.hsl_l16||g.exports._hsl_l16;x(0,d,t,n),(x=g.exports.blurMono16||g.exports._blurMono16)(d,p,h,f,m,t,n,a),(x=g.exports.unsharp||g.exports._unsharp)(0,0,d,p,t,n,r,o),b.set(new Uint32Array(this.__memory.buffer,0,s))}},wasm_src:"AGFzbQEAAAABMQZgAXwBfGACfX8AYAZ/f39/f38AYAh/f39/f39/fQBgBH9/f38AYAh/f39/f39/fwACGQIDZW52A2V4cAAAA2VudgZtZW1vcnkCAAEDBgUBAgMEBQQEAXAAAAdMBRZfX2J1aWxkX2dhdXNzaWFuX2NvZWZzAAEOX19nYXVzczE2X2xpbmUAAgpibHVyTW9ubzE2AAMHaHNsX2wxNgAEB3Vuc2hhcnAABQkBAAqJEAXZAQEGfAJAIAFE24a6Q4Ia+z8gALujIgOaEAAiBCAEoCIGtjgCECABIANEAAAAAAAAAMCiEAAiBbaMOAIUIAFEAAAAAAAA8D8gBKEiAiACoiAEIAMgA6CiRAAAAAAAAPA/oCAFoaMiArY4AgAgASAEIANEAAAAAAAA8L+gIAKioiIHtjgCBCABIAQgA0QAAAAAAADwP6AgAqKiIgO2OAIIIAEgBSACoiIEtow4AgwgASACIAegIAVEAAAAAAAA8D8gBqGgIgKjtjgCGCABIAMgBKEgAqO2OAIcCwu3AwMDfwR9CHwCQCADKgIUIQkgAyoCECEKIAMqAgwhCyADKgIIIQwCQCAEQX9qIgdBAEgiCA0AIAIgAC8BALgiDSADKgIYu6IiDiAJuyIQoiAOIAq7IhGiIA0gAyoCBLsiEqIgAyoCALsiEyANoqCgoCIPtjgCACACQQRqIQIgAEECaiEAIAdFDQAgBCEGA0AgAiAOIBCiIA8iDiARoiANIBKiIBMgAC8BALgiDaKgoKAiD7Y4AgAgAkEEaiECIABBAmohACAGQX9qIgZBAUoNAAsLAkAgCA0AIAEgByAFbEEBdGogAEF+ai8BACIIuCINIAu7IhGiIA0gDLsiEqKgIA0gAyoCHLuiIg4gCrsiE6KgIA4gCbsiFKKgIg8gAkF8aioCALugqzsBACAHRQ0AIAJBeGohAiAAQXxqIQBBACAFQQF0ayEHIAEgBSAEQQF0QXxqbGohBgNAIAghAyAALwEAIQggBiANIBGiIAO4Ig0gEqKgIA8iECAToqAgDiAUoqAiDyACKgIAu6CrOwEAIAYgB2ohBiAAQX5qIQAgAkF8aiECIBAhDiAEQX9qIgRBAUoNAAsLCwvfAgIDfwZ8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIgyaEAAiDSANoCIPtjgCECAEIAxEAAAAAAAAAMCiEAAiDraMOAIUIAREAAAAAAAA8D8gDaEiCyALoiANIAwgDKCiRAAAAAAAAPA/oCAOoaMiC7Y4AgAgBCANIAxEAAAAAAAA8L+gIAuioiIQtjgCBCAEIA0gDEQAAAAAAADwP6AgC6KiIgy2OAIIIAQgDiALoiINtow4AgwgBCALIBCgIA5EAAAAAAAA8D8gD6GgIgujtjgCGCAEIAwgDaEgC6O2OAIcIAYEQCAFQQF0IQogBiEJIAIhCANAIAAgCCADIAQgBSAGEAIgACAKaiEAIAhBAmohCCAJQX9qIgkNAAsLIAVFDQAgBkEBdCEIIAUhAANAIAIgASADIAQgBiAFEAIgAiAIaiECIAFBAmohASAAQX9qIgANAAsLC7wBAQV/IAMgAmwiAwRAQQAgA2shBgNAIAAoAgAiBEEIdiIHQf8BcSECAn8gBEH/AXEiAyAEQRB2IgRB/wFxIgVPBEAgAyIIIAMgAk8NARoLIAQgBCAHIAIgA0kbIAIgBUkbQf8BcQshCAJAIAMgAk0EQCADIAVNDQELIAQgByAEIAMgAk8bIAIgBUsbQf8BcSEDCyAAQQRqIQAgASADIAhqQYECbEEBdjsBACABQQJqIQEgBkEBaiIGDQALCwvTBgEKfwJAIAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6CqIQ0gBSAEbCILBEAgB0GBAmwhDgNAQQAgAi8BACADLwEAayIGQQF0IgdrIAcgBkEASBsgDk8EQCAAQQJqLQAAIQUCfyAALQAAIgYgAEEBai0AACIESSIJRQRAIAYiCCAGIAVPDQEaCyAFIAUgBCAEIAVJGyAGIARLGwshCAJ/IAYgBE0EQCAGIgogBiAFTQ0BGgsgBSAFIAQgBCAFSxsgCRsLIgogCGoiD0GBAmwiEEEBdiERQQAhDAJ/QQAiCSAIIApGDQAaIAggCmsiCUH/H2wgD0H+AyAIayAKayAQQYCABEkbbSEMIAYgCEYEQCAEIAVrQf//A2wgCUEGbG0MAQsgBSAGayAGIARrIAQgCEYiBhtB//8DbCAJQQZsbUHVqgFBqtUCIAYbagshCSARIAcgDWxBgBBqQQx1aiIGQQAgBkEAShsiBkH//wMgBkH//wNIGyEGAkACfwJAIAxB//8DcSIFBEAgBkH//wFKDQEgBUGAIGogBmxBgBBqQQx2DAILIAZBCHYiBiEFIAYhBAwCCyAFIAZB//8Dc2xBgBBqQQx2IAZqCyIFQQh2IQcgBkEBdCAFa0EIdiIGIQQCQCAJQdWqAWpB//8DcSIFQanVAksNACAFQf//AU8EQEGq1QIgBWsgByAGa2xBBmxBgIACakEQdiAGaiEEDAELIAchBCAFQanVAEsNACAFIAcgBmtsQQZsQYCAAmpBEHYgBmohBAsCfyAGIgUgCUH//wNxIghBqdUCSw0AGkGq1QIgCGsgByAGa2xBBmxBgIACakEQdiAGaiAIQf//AU8NABogByIFIAhBqdUASw0AGiAIIAcgBmtsQQZsQYCAAmpBEHYgBmoLIQUgCUGr1QJqQf//A3EiCEGp1QJLDQAgCEH//wFPBEBBqtUCIAhrIAcgBmtsQQZsQYCAAmpBEHYgBmohBgwBCyAIQanVAEsEQCAHIQYMAQsgCCAHIAZrbEEGbEGAgAJqQRB2IAZqIQYLIAEgBDoAACABQQFqIAU6AAAgAUECaiAGOgAACyADQQJqIQMgAkECaiECIABBBGohACABQQRqIQEgC0F/aiILDQALCwsL"},He=[{win:.5,filter:function filter(e){return e>=-.5&&e<.5?1:0}},{win:1,filter:function filter(e){if(e<=-1||e>=1)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*(.54+.46*Math.cos(t/1))}},{win:2,filter:function filter(e){if(e<=-2||e>=2)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/2)/(t/2)}},{win:3,filter:function filter(e){if(e<=-3||e>=3)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/3)/(t/3)}}];function je(e){return Math.round(16383*e)}var Xe=function Xe(e,t,n,r,a){var o,s,i,u,l,c,d,p,h,f,m,g,b,x,v,y,w,k=He[e].filter,I=1/r,C=Math.min(1,r),A=He[e].win/C,E=Math.floor(2*(A+1)),_=new Int16Array((E+2)*n),$=0,N=!_.subarray||!_.set;for(o=0;o<n;o++){for(s=(o+.5)*I+a,i=Math.max(0,Math.floor(s-A)),l=(u=Math.min(t-1,Math.ceil(s+A)))-i+1,c=new Float32Array(l),d=new Int16Array(l),p=0,h=i,f=0;h<=u;h++,f++)p+=m=k((h+.5-s)*C),c[f]=m;for(g=0,f=0;f<c.length;f++)g+=b=c[f]/p,d[f]=je(b);for(d[n>>1]+=je(1-g),x=0;x<d.length&&0===d[x];)x++;if(x<d.length){for(v=d.length-1;v>0&&0===d[v];)v--;if(y=i+x,w=v-x+1,_[$++]=y,_[$++]=w,N)for(f=x;f<=v;f++)_[$++]=d[f];else _.set(d.subarray(x,v+1),$),$+=w}else _[$++]=0,_[$++]=0}return _};function qe(e){return e<0?0:e>255?255:e}var Qe=function Qe(e,t,n,r,a,o){var s,i,u,l,c,d,p,h,f,m,g,b=0,x=0;for(f=0;f<r;f++){for(c=0,m=0;m<a;m++){for(d=o[c++],p=o[c++],h=b+4*d|0,s=i=u=l=0;p>0;p--)l=l+(g=o[c++])*e[h+3]|0,u=u+g*e[h+2]|0,i=i+g*e[h+1]|0,s=s+g*e[h]|0,h=h+4|0;t[x+3]=qe(l+8192>>14),t[x+2]=qe(u+8192>>14),t[x+1]=qe(i+8192>>14),t[x]=qe(s+8192>>14),x=x+4*r|0}x=4*(f+1)|0,b=(f+1)*n*4|0}},Ke=function Ke(e,t,n,r,a,o){var s,i,u,l,c,d,p,h,f,m,g,b=0,x=0;for(f=0;f<r;f++){for(c=0,m=0;m<a;m++){for(d=o[c++],p=o[c++],h=b+4*d|0,s=i=u=l=0;p>0;p--)l=l+(g=o[c++])*e[h+3]|0,u=u+g*e[h+2]|0,i=i+g*e[h+1]|0,s=s+g*e[h]|0,h=h+4|0;t[x+3]=qe(l+8192>>14),t[x+2]=qe(u+8192>>14),t[x+1]=qe(i+8192>>14),t[x]=qe(s+8192>>14),x=x+4*r|0}x=4*(f+1)|0,b=(f+1)*n*4|0}},Ye=!0;try{Ye=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(e){}function Ze(e,t,n){if(Ye)t.set(function(e){return new Uint8Array(e.buffer,0,e.byteLength)}(e),n);else for(var _r3=n,_a3=0;_a3<e.length;_a3++){var _n7=e[_a3];t[_r3++]=255&_n7,t[_r3++]=_n7>>8&255}}var Je={name:"resize",fn:function fn(e){var t=e.src,n=e.width,r=e.height,a=e.toWidth,o=e.toHeight,s=e.scaleX||e.toWidth/e.width,i=e.scaleY||e.toHeight/e.height,u=e.offsetX||0,l=e.offsetY||0,c=e.dest||new Uint8Array(a*o*4),d=void 0===e.quality?3:e.quality,p=e.alpha||!1,h=Xe(d,n,a,s,u),f=Xe(d,r,o,i,l),m=new Uint8Array(a*r*4);return Qe(t,m,n,r,a,h),Ke(m,c,r,a,o,f),p||function(e,t,n){for(var r=3,a=t*n*4|0;r<a;)e[r]=255,r=r+4|0}(c,a,o),c},wasm_fn:function wasm_fn(e){var t=e.src,n=e.width,r=e.height,a=e.toWidth,o=e.toHeight,s=e.scaleX||e.toWidth/e.width,i=e.scaleY||e.toHeight/e.height,u=e.offsetX||0,l=e.offsetY||0,c=e.dest||new Uint8Array(a*o*4),d=void 0===e.quality?3:e.quality,p=e.alpha||!1,h=Xe(d,n,a,s,u),f=Xe(d,r,o,i,l),m=this.__align(0+Math.max(t.byteLength,c.byteLength)),g=this.__align(m+r*a*4),b=this.__align(g+h.byteLength),x=b+f.byteLength,v=this.__instance("resize",x),y=new Uint8Array(this.__memory.buffer),w=new Uint32Array(this.__memory.buffer),k=new Uint32Array(t.buffer);return w.set(k),Ze(h,y,g),Ze(f,y,b),(v.exports.convolveHV||v.exports._convolveHV)(g,b,m,n,r,a,o),new Uint32Array(c.buffer).set(new Uint32Array(this.__memory.buffer,0,o*a)),p||function(e,t,n){for(var r=3,a=t*n*4|0;r<a;)e[r]=255,r=r+4|0}(c,a,o),c},wasm_src:"AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw=="};function et(e){var t=e||[],n={js:t.indexOf("js")>=0,wasm:t.indexOf("wasm")>=0};Ue.call(this,n),this.features={js:n.js,wasm:n.wasm&&this.has_wasm()},this.use(ze),this.use(Je)}Te(et,Ue),et.prototype.resizeAndUnsharp=function(e,t){var n=this.resize(e,t);return e.unsharpAmount&&this.unsharp_mask(n,e.toWidth,e.toHeight,e.unsharpAmount,e.unsharpRadius,e.unsharpThreshold),n};var tt=et;function nt(e,t){this.create=e,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=t||2e3}nt.prototype.acquire=function(){var e,_this=this;return 0!==this.available.length?e=this.available.pop():((e=this.create()).id=this.lastId++,e.release=function(){return _this.release(e)}),this.acquired[e.id]=e,e},nt.prototype.release=function(e){var _this2=this;delete this.acquired[e.id],e.lastUsed=Date.now(),this.available.push(e),0===this.timeoutId&&(this.timeoutId=setTimeout((function(){return _this2.gc()}),100))},nt.prototype.gc=function(){var _this3=this,e=Date.now();this.available=this.available.filter((function(t){return!(e-t.lastUsed>_this3.idle&&(t.destroy(),1))})),0!==this.available.length?this.timeoutId=setTimeout((function(){return _this3.gc()}),100):this.timeoutId=0};var rt=nt;function at(e){return Object.prototype.toString.call(e)}var ot=function ot(e){var t=at(e);return"[object HTMLCanvasElement]"===t||"[object OffscreenCanvas]"===t||"[object Canvas]"===t},st=function st(e){return"[object HTMLImageElement]"===at(e)},it=function it(e){return"[object ImageBitmap]"===at(e)},ut=function ut(e){var t=0,n=[];function r(){t<e&&n.length&&(t++,n.shift()())}return function(e){return new Promise((function(a,o){n.push((function(){e().then((function(e){a(e),t--,r()}),(function(e){o(e),t--,r()}))})),r()}))}},lt=function lt(e){switch(e){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},ct=function ct(e){return Promise.resolve().then((function(){if("undefined"==typeof createImageBitmap)return!1;var t=e(100,100);return createImageBitmap(t,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then((function(e){var n=10===e.width;return e.close(),t=null,n}))})).catch((function(){return!1}))},dt=function dt(){var t,e=tt;onmessage=function onmessage(n){var r=n.data.opts;t||(t=new e(n.data.features));var a=t.resizeAndUnsharp(r);postMessage({result:a},[a.buffer])}};function pt(e){var t=Math.round(e);return Math.abs(e-t)<1e-5?t:Math.floor(e)}function ht(e){var t=Math.round(e);return Math.abs(e-t)<1e-5?t:Math.ceil(e)}var ft={},mt=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(mt=navigator.userAgent.indexOf("Safari")>=0)}catch(e){}var gt=1;"undefined"!=typeof navigator&&(gt=Math.min(navigator.hardwareConcurrency||1,4));var vt,yt,bt={tile:1024,concurrency:gt,features:["js","wasm","ww"],idle:2e3,createCanvas:function createCanvas(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n}},xt={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};function wt(){return{value:_e(dt),destroy:function destroy(){if(this.value.terminate(),"undefined"!=typeof window){var _e4=window.URL||window.webkitURL||window.mozURL||window.msURL;_e4&&_e4.revokeObjectURL&&this.value.objectURL&&_e4.revokeObjectURL(this.value.objectURL)}}}}function kt(e){if(!(this instanceof kt))return new kt(e);this.options=ke({},bt,e||{});var t="lk_".concat(this.options.concurrency);this.__limit=ft[t]||ut(this.options.concurrency),ft[t]||(ft[t]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}kt.prototype.init=function(){var _this4=this;if(this.__initPromise)return this.__initPromise;if(!1!==vt&&!0!==vt&&(vt=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),vt=!0}catch(e){}!1!==yt&&!0!==yt&&(yt=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?yt=!0:this.debug("ImageBitmap does not support .close(), disabled")));var e=this.options.features.slice();if(e.indexOf("all")>=0&&(e=["cib","wasm","js","ww"]),this.__requested_features=e,this.__mathlib=new tt(e),e.indexOf("ww")>=0&&"undefined"!=typeof window&&"Worker"in window)try{_e((function(){})).terminate(),this.features.ww=!0;var _e5="wp_".concat(JSON.stringify(this.options));ft[_e5]?this.__workersPool=ft[_e5]:(this.__workersPool=new rt(wt,this.options.idle),ft[_e5]=this.__workersPool)}catch(e){}var t,n=this.__mathlib.init().then((function(e){ke(_this4.features,e.features)}));return t=yt?ct(this.options.createCanvas).then((function(t){_this4.features.cib&&e.indexOf("cib")<0?_this4.debug("createImageBitmap() resize supported, but disabled by config"):e.indexOf("cib")>=0&&(_this4.features.cib=t)})):Promise.resolve(!1),this.__initPromise=Promise.all([n,t]).then((function(){return _this4})),this.__initPromise},kt.prototype.resize=function(e,t,n){var _this5=this;this.debug("Start resize...");var r=ke({},xt);if(isNaN(n)?n&&(r=ke(r,n)):r=ke(r,{quality:n}),r.toWidth=t.width,r.toHeight=t.height,r.width=e.naturalWidth||e.width,r.height=e.naturalHeight||e.height,0===t.width||0===t.height)return Promise.reject(new Error("Invalid output size: ".concat(t.width,"x").concat(t.height)));r.unsharpRadius>2&&(r.unsharpRadius=2);var a=!1,o=null;r.cancelToken&&(o=r.cancelToken.then((function(e){throw a=!0,e}),(function(e){throw a=!0,e})));var s=Math.ceil(Math.max(3,2.5*r.unsharpRadius|0));return this.init().then((function(){if(a)return o;if(_this5.features.cib){var _n8=t.getContext("2d",{alpha:Boolean(r.alpha)});return _this5.debug("Resize via createImageBitmap()"),createImageBitmap(e,{resizeWidth:r.toWidth,resizeHeight:r.toHeight,resizeQuality:lt(r.quality)}).then((function(e){if(a)return o;if(!r.unsharpAmount)return _n8.drawImage(e,0,0),e.close(),_n8=null,_this5.debug("Finished!"),t;_this5.debug("Unsharp result");var s=_this5.options.createCanvas(r.toWidth,r.toHeight),i=s.getContext("2d",{alpha:Boolean(r.alpha)});i.drawImage(e,0,0),e.close();var u=i.getImageData(0,0,r.toWidth,r.toHeight);return _this5.__mathlib.unsharp_mask(u.data,r.toWidth,r.toHeight,r.unsharpAmount,r.unsharpRadius,r.unsharpThreshold),_n8.putImageData(u,0,0),s.width=s.height=0,u=i=s=_n8=null,_this5.debug("Finished!"),t}))}var n={},i=function i(e){return Promise.resolve().then((function(){return _this5.features.ww?new Promise((function(t,n){var r=_this5.__workersPool.acquire();o&&o.catch((function(e){return n(e)})),r.value.onmessage=function(e){r.release(),e.data.err?n(e.data.err):t(e.data.result)},r.value.postMessage({opts:e,features:_this5.__requested_features,preload:{wasm_nodule:_this5.__mathlib.__}},[e.src.buffer])})):_this5.__mathlib.resizeAndUnsharp(e,n)}))},u=function u(e,t,n){var r,u,l,c=!1,d=function d(t){return _this5.__limit((function(){if(a)return o;var s;if(ot(e))_this5.debug("Get tile pixel data"),s=r.getImageData(t.x,t.y,t.width,t.height);else{_this5.debug("Draw tile imageBitmap/image to temporary canvas");var _r4=_this5.options.createCanvas(t.width,t.height),_a4=_r4.getContext("2d",{alpha:Boolean(n.alpha)});_a4.globalCompositeOperation="copy",_a4.drawImage(u||e,t.x,t.y,t.width,t.height,0,0,t.width,t.height),_this5.debug("Get tile pixel data"),s=_a4.getImageData(0,0,t.width,t.height),_r4.width=_r4.height=0,_a4=_r4=null}var c={src:s.data,width:t.width,height:t.height,toWidth:t.toWidth,toHeight:t.toHeight,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:t.offsetX,offsetY:t.offsetY,quality:n.quality,alpha:n.alpha,unsharpAmount:n.unsharpAmount,unsharpRadius:n.unsharpRadius,unsharpThreshold:n.unsharpThreshold};return _this5.debug("Invoke resize math"),Promise.resolve().then((function(){return i(c)})).then((function(e){if(a)return o;var n;if(s=null,_this5.debug("Convert raw rgba tile result to ImageData"),vt)n=new ImageData(new Uint8ClampedArray(e),t.toWidth,t.toHeight);else if((n=l.createImageData(t.toWidth,t.toHeight)).data.set)n.data.set(e);else for(var _t5=n.data.length-1;_t5>=0;_t5--)n.data[_t5]=e[_t5];return _this5.debug("Draw tile"),mt?l.putImageData(n,t.toX,t.toY,t.toInnerX-t.toX,t.toInnerY-t.toY,t.toInnerWidth+1e-5,t.toInnerHeight+1e-5):l.putImageData(n,t.toX,t.toY,t.toInnerX-t.toX,t.toInnerY-t.toY,t.toInnerWidth,t.toInnerHeight),null}))}))};return Promise.resolve().then((function(){if(l=t.getContext("2d",{alpha:Boolean(n.alpha)}),ot(e))return r=e.getContext("2d",{alpha:Boolean(n.alpha)}),null;if(it(e))return u=e,c=!0,null;if(st(e))return yt?(_this5.debug("Decode image via createImageBitmap"),createImageBitmap(e).then((function(e){u=e})).catch((function(e){return null}))):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')})).then((function(){if(a)return o;_this5.debug("Calculate tiles");var e=function(e){var t,n,r,a,o,s,i=e.toWidth/e.width,u=e.toHeight/e.height,l=pt(e.srcTileSize*i)-2*e.destTileBorder,c=pt(e.srcTileSize*u)-2*e.destTileBorder;if(l<1||c<1)throw new Error("Internal error in pica: target tile width/height is too small.");var d,p=[];for(a=0;a<e.toHeight;a+=c)for(r=0;r<e.toWidth;r+=l)(t=r-e.destTileBorder)<0&&(t=0),t+(o=r+l+e.destTileBorder-t)>=e.toWidth&&(o=e.toWidth-t),(n=a-e.destTileBorder)<0&&(n=0),n+(s=a+c+e.destTileBorder-n)>=e.toHeight&&(s=e.toHeight-n),d={toX:t,toY:n,toWidth:o,toHeight:s,toInnerX:r,toInnerY:a,toInnerWidth:l,toInnerHeight:c,offsetX:t/i-pt(t/i),offsetY:n/u-pt(n/u),scaleX:i,scaleY:u,x:pt(t/i),y:pt(n/u),width:ht(o/i),height:ht(s/u)},p.push(d);return p}({width:n.width,height:n.height,srcTileSize:_this5.options.tile,toWidth:n.toWidth,toHeight:n.toHeight,destTileBorder:s}).map((function(e){return d(e)}));function r(){u&&(c||u.close(),u=null)}return _this5.debug("Process tiles"),Promise.all(e).then((function(){return _this5.debug("Finished!"),r(),t}),(function(e){throw r(),e}))}))};return function l(e,t,n,r){if(a)return o;var s,_e$shift2=_slicedToArray(e.shift(),2),i=_e$shift2[0],c=_e$shift2[1],d=0===e.length;return r=ke({},r,{toWidth:i,toHeight:c,quality:d?r.quality:Math.min(1,r.quality)}),d||(s=_this5.options.createCanvas(i,c)),u(t,d?n:s,r).then((function(){return d?n:(r.width=i,r.height=c,l(e,s,n,r))})).then((function(e){return s&&(s.width=s.height=0),e}))}(function(e,t,n,r,a,o){var s=n/e,i=r/t,u=(2*o+2+1)/a;if(u>.5)return[[n,r]];var l=Math.ceil(Math.log(Math.min(s,i))/Math.log(u));if(l<=1)return[[n,r]];for(var c=[],_a5=0;_a5<l;_a5++){var _o2=Math.round(Math.pow(Math.pow(e,l-_a5-1)*Math.pow(n,_a5+1),1/l)),_s2=Math.round(Math.pow(Math.pow(t,l-_a5-1)*Math.pow(r,_a5+1),1/l));c.push([_o2,_s2])}return c}(r.width,r.height,r.toWidth,r.toHeight,_this5.options.tile,s),e,t,r)}))},kt.prototype.resizeBuffer=function(e){var _this6=this,t=ke({},xt,e);return this.init().then((function(){return _this6.__mathlib.resizeAndUnsharp(t)}))},kt.prototype.toBlob=function(e,t,n){return t=t||"image/png",new Promise((function(r){if(e.toBlob)e.toBlob((function(e){return r(e)}),t,n);else if(e.convertToBlob)r(e.convertToBlob({type:t,quality:n}));else{for(var a=atob(e.toDataURL(t,n).split(",")[1]),o=a.length,s=new Uint8Array(o),_e6=0;_e6<o;_e6++)s[_e6]=a.charCodeAt(_e6);r(new Blob([s],{type:t}))}}))},kt.prototype.debug=function(){};var It=new kt,Ct=function Ct(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.minSize,a=void 0===r?720:r,o=e/t;return e>t?{desW:Math.floor(a*o),desH:a}:{desW:a,desH:Math.floor(a/o)}},At=Object.freeze({__proto__:null,scaleImage:function scaleImage(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minSize,r=void 0===n?720:n;return new Promise((function(t){var n=URL.createObjectURL(e),a=new Image;a.src=n;var o=document.createElement("canvas");a.onload=function(){if(a.width&&a.height&&(a.width<r||a.height<r)){var e=Ct(a.width,a.height,{minSize:r}),n=e.desW,s=e.desH;o.width=n,o.height=s,It.resize(a,o).then((function(e){return It.toBlob(e,"image/jpeg",1)})).then((function(e){return t(e)}))}else t(null)}}))},createResizer:function createResizer(e){var t=e.width,n=e.height,r=document.createElement("canvas"),a=r.getContext("2d");return r.width=t,r.height=n,{resize:function resize(e){var t=e.srcCanvas;return a.drawImage(t,0,0,r.width,r.height),r}}}});function Et(e,t,n){return function(e,t,n){for(var r=0,a=n[1],o=n[3],s=n[0],i=n[2],u=a;u<o;u++)for(var l=s;l<i;l++){var c=z(e,t,u,l),d=c.r,p=c.g,h=c.b;d>=245&&h>=245&&p>245&&(r+=1)}return r}(e,t,function(e,t){var n=Math.floor(.025*e),r=e-n,a=Math.floor(.025*t);return[n,a,r,t-a]}(t,n))/(t*n)>=.001}function _t(){return(_t=m(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),a=r.data,W){e.next=5;break}return e.abrupt("return",Et(a,r.width,r.height));case 5:return e.abrupt("return",W.detectGlare(a,r.width,r.height));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $t=Object.freeze({__proto__:null,isCardGlare:function isCardGlare(e){return _t.apply(this,arguments)}}),Nt=Ne((function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){e.exports={BROWSER_TYPES:{CHROME:"Chrome",FIREFOX:"Firefox",OPERA:"Opera",YANDEX:"Yandex",SAFARI:"Safari",INTERNET_EXPLORER:"Internet Explorer",EDGE:"Edge",CHROMIUM:"Chromium",IE:"IE",MOBILE_SAFARI:"Mobile Safari",EDGE_CHROMIUM:"Edge Chromium"},DEVICE_TYPES:{MOBILE:"mobile",TABLET:"tablet",SMART_TV:"smarttv",CONSOLE:"console",WEARABLE:"wearable",BROWSER:void 0},OS_TYPES:{IOS:"iOS",ANDROID:"Android",WINDOWS_PHONE:"Windows Phone",WINDOWS:"Windows",MAC_OS:"Mac OS"},defaultData:{isMobile:!1,isTablet:!1,isBrowser:!1,isSmartTV:!1,isConsole:!1,isWearable:!1}}},function(e,t,n){var r,a=n(2),o=n(0),s=o.BROWSER_TYPES,i=o.OS_TYPES,u=o.DEVICE_TYPES,l=n(4),c=l.checkType,d=l.broPayload,p=l.mobilePayload,h=l.wearPayload,f=l.consolePayload,m=l.stvPayload,g=l.getNavigatorInstance,b=l.isIOS13Check,x=new a,v=x.getBrowser(),y=x.getDevice(),w=x.getEngine(),k=x.getOS(),I=x.getUA(),C=s.CHROME,A=s.CHROMIUM,E=s.IE,_=s.INTERNET_EXPLORER,$=s.OPERA,N=s.FIREFOX,S=s.SAFARI,R=s.EDGE,T=s.YANDEX,F=s.MOBILE_SAFARI,M=u.MOBILE,O=u.TABLET,D=u.SMART_TV,B=u.BROWSER,L=u.WEARABLE,P=u.CONSOLE,W=i.ANDROID,U=i.WINDOWS_PHONE,V=i.IOS,G=i.WINDOWS,z=i.MAC_OS,H=function H(){return k.name===i.WINDOWS&&"10"===k.version&&"string"==typeof I&&-1!==I.indexOf("Edg/")},j=function j(){return v.name===R},X=function X(){return b("iPad")},q=y.type===D,Q=y.type===P,K=y.type===L,Y=v.name===F||X(),Z=v.name===A,J=function(){switch(y.type){case M:case O:return!0;default:return!1}}()||X(),ee=y.type===M,te=y.type===O||X(),ne=y.type===B,re=k.name===W,ae=k.name===U,oe=k.name===V||X(),se=v.name===C,ie=v.name===N,ue=v.name===S||v.name===F,le=v.name===$,ce=v.name===_||v.name===E,de=k.version?k.version:"none",pe=k.name?k.name:"none",he=v.major,fe=v.version,me=v.name,ge=y.vendor?y.vendor:"none",be=y.model?y.model:"none",xe=w.name,ve=w.version,ye=I,we=j()||H(),ke=v.name===T,Ie=y.type,Ce=(r=g())&&(/iPad|iPhone|iPod/.test(r.platform)||"MacIntel"===r.platform&&r.maxTouchPoints>1)&&!window.MSStream,Ae=X(),Ee=b("iPhone"),_e=b("iPod"),$e=function(){var e=g(),t=e&&e.userAgent.toLowerCase();return"string"==typeof t&&/electron/.test(t)}(),Ne=H(),Se=j(),Re=k.name===G,Te=k.name===z,Fe=c(y.type);e.exports={deviceDetect:function deviceDetect(){var e=Fe.isBrowser,t=Fe.isMobile,n=Fe.isTablet,r=Fe.isSmartTV,a=Fe.isConsole,o=Fe.isWearable;return e?d(e,v,w,k,I):r?m(r,w,k,I):a?f(a,w,k,I):t||n?p(Fe,y,k,I):o?h(o,w,k,I):void 0},isSmartTV:q,isConsole:Q,isWearable:K,isMobileSafari:Y,isChromium:Z,isMobile:J,isMobileOnly:ee,isTablet:te,isBrowser:ne,isAndroid:re,isWinPhone:ae,isIOS:oe,isChrome:se,isFirefox:ie,isSafari:ue,isOpera:le,isIE:ce,osVersion:de,osName:pe,fullBrowserVersion:he,browserVersion:fe,browserName:me,mobileVendor:ge,mobileModel:be,engineName:xe,engineVersion:ve,getUA:ye,isEdge:we,isYandex:ke,deviceType:Ie,isIOS13:Ce,isIPad13:Ae,isIPhone13:Ee,isIPod13:_e,isElectron:$e,isEdgeChromium:Ne,isLegacyEdge:Se,isWindows:Re,isMacOs:Te}},function(e,t,n){var r;!function(a,o){var s="function",i="undefined",u="object",l="model",c="name",d="type",p="vendor",h="version",f="architecture",m="console",g="mobile",b="tablet",x="smarttv",v="wearable",y={extend:function extend(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},has:function has(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function lowerize(e){return e.toLowerCase()},major:function major(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:o},trim:function trim(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},w={rgx:function rgx(e,t){for(var n,r,a,i,l,c,d=0;d<t.length&&!l;){var p=t[d],h=t[d+1];for(n=r=0;n<p.length&&!l;)if(l=p[n++].exec(e))for(a=0;a<h.length;a++)c=l[++r],_typeof(i=h[a])===u&&i.length>0?2==i.length?_typeof(i[1])==s?this[i[0]]=i[1].call(this,c):this[i[0]]=i[1]:3==i.length?_typeof(i[1])!==s||i[1].exec&&i[1].test?this[i[0]]=c?c.replace(i[1],i[2]):o:this[i[0]]=c?i[1].call(this,c,i[2]):o:4==i.length&&(this[i[0]]=c?i[3].call(this,c.replace(i[1],i[2])):o):this[i]=c||o;d+=2}},str:function str(e,t){for(var n in t)if(_typeof(t[n])===u&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(y.has(t[n][r],e))return"?"===n?o:n}else if(y.has(t[n],e))return"?"===n?o:n;return e}},k={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},I={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[c,h],[/(opios)[\/\s]+([\w\.]+)/i],[[c,"Opera Mini"],h],[/\s(opr)\/([\w\.]+)/i],[[c,"Opera"],h],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[c,h],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[c,"IE"],h],[/(edge|edgios|edgea)\/((\d+)?[\w\.]+)/i],[[c,"Edge"],h],[/(yabrowser)\/([\w\.]+)/i],[[c,"Yandex"],h],[/(puffin)\/([\w\.]+)/i],[[c,"Puffin"],h],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[c,"UCBrowser"],h],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],h],[/(micromessenger)\/([\w\.]+)/i],[[c,"WeChat"],h],[/(qqbrowserlite)\/([\w\.]+)/i],[c,h],[/(QQ)\/([\d\.]+)/i],[c,h],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[c,h],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[c,h],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[c,h],[/(MetaSr)[\/\s]?([\w\.]+)/i],[c],[/(LBBROWSER)/i],[c],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[h,[c,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[h,[c,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[h,[c,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[c,/(.+)/,"$1 WebView"],h],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[c,/(.+(?:g|us))(.+)/,"$1 $2"],h],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[h,[c,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[c,h],[/(dolfin)\/([\w\.]+)/i],[[c,"Dolphin"],h],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[c,"Chrome"],h],[/(coast)\/([\w\.]+)/i],[[c,"Opera Coast"],h],[/fxios\/([\w\.-]+)/i],[h,[c,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[h,[c,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[h,c],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[c,"GSA"],h],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[c,[h,w.str,k.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[c,h],[/(navigator|netscape)\/([\w\.-]+)/i],[[c,"Netscape"],h],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[c,h]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,y.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[f,/ower/,"",y.lowerize]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[f,y.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[l,p,[d,b]],[/applecoremedia\/[\w\.]+ \((ipad)/],[l,[p,"Apple"],[d,b]],[/(apple\s{0,1}tv)/i],[[l,"Apple TV"],[p,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[p,l,[d,b]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[l,[p,"Amazon"],[d,b]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[l,w.str,k.device.amazon.model],[p,"Amazon"],[d,g]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[l,p,[d,g]],[/\((ip[honed|\s\w*]+);/i],[l,[p,"Apple"],[d,g]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[p,l,[d,g]],[/\(bb10;\s(\w+)/i],[l,[p,"BlackBerry"],[d,g]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[l,[p,"Asus"],[d,b]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[p,"Sony"],[l,"Xperia Tablet"],[d,b]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[l,[p,"Sony"],[d,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[p,l,[d,m]],[/android.+;\s(shield)\sbuild/i],[l,[p,"Nvidia"],[d,m]],[/(playstation\s[34portablevi]+)/i],[l,[p,"Sony"],[d,m]],[/(sprint\s(\w+))/i],[[p,w.str,k.device.sprint.vendor],[l,w.str,k.device.sprint.model],[d,g]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[p,l,[d,b]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[p,[l,/_/g," "],[d,g]],[/(nexus\s9)/i],[l,[p,"HTC"],[d,b]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[l,[p,"Huawei"],[d,g]],[/(microsoft);\s(lumia[\s\w]+)/i],[p,l,[d,g]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[l,[p,"Microsoft"],[d,m]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[p,"Microsoft"],[d,g]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[l,[p,"Motorola"],[d,g]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[l,[p,"Motorola"],[d,b]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[p,y.trim],[l,y.trim],[d,x]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[p,"Samsung"],[d,x]],[/\(dtv[\);].+(aquos)/i],[l,[p,"Sharp"],[d,x]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[p,"Samsung"],l,[d,b]],[/smart-tv.+(samsung)/i],[p,[d,x],l],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[p,"Samsung"],l,[d,g]],[/sie-(\w*)/i],[l,[p,"Siemens"],[d,g]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[p,"Nokia"],l,[d,g]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[l,[p,"Acer"],[d,b]],[/android.+([vl]k\-?\d{3})\s+build/i],[l,[p,"LG"],[d,b]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[p,"LG"],l,[d,b]],[/(lg) netcast\.tv/i],[p,l,[d,x]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[l,[p,"LG"],[d,g]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[l,[p,"Lenovo"],[d,b]],[/linux;.+((jolla));/i],[p,l,[d,g]],[/((pebble))app\/[\d\.]+\s/i],[p,l,[d,v]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[p,l,[d,g]],[/crkey/i],[[l,"Chromecast"],[p,"Google"]],[/android.+;\s(glass)\s\d/i],[l,[p,"Google"],[d,v]],[/android.+;\s(pixel c)\s/i],[l,[p,"Google"],[d,b]],[/android.+;\s(pixel xl|pixel)\s/i],[l,[p,"Google"],[d,g]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[l,/_/g," "],[p,"Xiaomi"],[d,g]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[l,/_/g," "],[p,"Xiaomi"],[d,b]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[l,[p,"Meizu"],[d,b]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[l,[p,"OnePlus"],[d,g]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[l,[p,"RCA"],[d,b]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[l,[p,"Dell"],[d,b]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[l,[p,"Verizon"],[d,b]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[p,"Barnes & Noble"],l,[d,b]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[l,[p,"NuVision"],[d,b]],[/android.+;\s(k88)\sbuild/i],[l,[p,"ZTE"],[d,b]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[l,[p,"Swiss"],[d,g]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[l,[p,"Swiss"],[d,b]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[l,[p,"Zeki"],[d,b]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[p,"Dragon Touch"],l,[d,b]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[l,[p,"Insignia"],[d,b]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[l,[p,"NextBook"],[d,b]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[p,"Voice"],l,[d,g]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[p,"LvTel"],l,[d,g]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[l,[p,"Envizen"],[d,b]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[p,l,[d,b]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[l,[p,"MachSpeed"],[d,b]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[p,l,[d,b]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[l,[p,"Rotor"],[d,b]],[/android.+(KS(.+))\s+build/i],[l,[p,"Amazon"],[d,b]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[p,l,[d,b]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[d,y.lowerize],p,l],[/(android[\w\.\s\-]{0,9});.+build/i],[l,[p,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[h,[c,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[c,h],[/rv\:([\w\.]{1,9}).+(gecko)/i],[h,c]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[c,h],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[c,[h,w.str,k.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[c,"Windows"],[h,w.str,k.os.windows.version]],[/\((bb)(10);/i],[[c,"BlackBerry"],h],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[c,h],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[c,"Symbian"],h],[/\((series40);/i],[c],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[c,"Firefox OS"],h],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[c,h],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[c,"Chromium OS"],h],[/(sunos)\s?([\w\.\d]*)/i],[[c,"Solaris"],h],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[c,h],[/(haiku)\s(\w+)/i],[c,h],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[h,/_/g,"."],[c,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[c,"Mac OS"],[h,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]*)/i],[c,h]]},C=function C(e,t){if("object"==_typeof(e)&&(t=e,e=o),!(this instanceof C))return new C(e,t).getResult();var n=e||(a&&a.navigator&&a.navigator.userAgent?a.navigator.userAgent:""),r=t?y.extend(I,t):I;return this.getBrowser=function(){var e={name:o,version:o};return w.rgx.call(e,n,r.browser),e.major=y.major(e.version),e},this.getCPU=function(){var e={architecture:o};return w.rgx.call(e,n,r.cpu),e},this.getDevice=function(){var e={vendor:o,model:o,type:o};return w.rgx.call(e,n,r.device),e},this.getEngine=function(){var e={name:o,version:o};return w.rgx.call(e,n,r.engine),e},this.getOS=function(){var e={name:o,version:o};return w.rgx.call(e,n,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this};C.VERSION="0.7.18",C.BROWSER={NAME:c,MAJOR:"major",VERSION:h},C.CPU={ARCHITECTURE:f},C.DEVICE={MODEL:l,VENDOR:p,TYPE:d,CONSOLE:m,MOBILE:g,SMARTTV:x,TABLET:b,WEARABLE:v,EMBEDDED:"embedded"},C.ENGINE={NAME:c,VERSION:h},C.OS={NAME:c,VERSION:h},_typeof(t)!==i?(_typeof(e)!==i&&e.exports&&(t=e.exports=C),t.UAParser=C):n(3)?(r=function(){return C}.call(t,n,t,e))===o||(e.exports=r):a&&(a.UAParser=C);var A=a&&(a.jQuery||a.Zepto);if(_typeof(A)!==i){var E=new C;A.ua=E.getResult(),A.ua.get=function(){return E.getUA()},A.ua.set=function(e){E.setUA(e);var t=E.getResult();for(var n in t)A.ua[n]=t[n]}}}("object"==("undefined"==typeof window?"undefined":_typeof(window))?window:this)},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=n(0),o=a.DEVICE_TYPES,s=a.defaultData,i=t.getNavigatorInstance=function(){return!("undefined"==typeof window||!window.navigator&&!navigator)&&(window.navigator||navigator)},u=t.isIOS13Check=function(e){var t=i();return t&&t.platform&&(-1!==t.platform.indexOf(e)||"MacIntel"===t.platform&&t.maxTouchPoints>1&&!window.MSStream)};e.exports={checkType:function checkType(e){switch(e){case o.MOBILE:return{isMobile:!0};case o.TABLET:return{isTablet:!0};case o.SMART_TV:return{isSmartTV:!0};case o.CONSOLE:return{isConsole:!0};case o.WEARABLE:return{isWearable:!0};case o.BROWSER:return{isBrowser:!0};default:return s}},broPayload:function broPayload(e,t,n,r,a){return{isBrowser:e,browserMajorVersion:t.major,browserFullVersion:t.version,browserName:t.name,engineName:n.name||!1,engineVersion:n.version,osName:r.name,osVersion:r.version,userAgent:a}},mobilePayload:function mobilePayload(e,t,n,a){return r({},e,{vendor:t.vendor,model:t.model,os:n.name,osVersion:n.version,ua:a})},stvPayload:function stvPayload(e,t,n,r){return{isSmartTV:e,engineName:t.name,engineVersion:t.version,osName:n.name,osVersion:n.version,userAgent:r}},consolePayload:function consolePayload(e,t,n,r){return{isConsole:e,engineName:t.name,engineVersion:t.version,osName:n.name,osVersion:n.version,userAgent:r}},wearPayload:function wearPayload(e,t,n,r){return{isWearable:e,engineName:t.name,engineVersion:t.version,osName:n.name,osVersion:n.version,userAgent:r}},getNavigatorInstance:i,isIOS13Check:u}}])})),Rt=(Object.freeze({__proto__:null,getUAMetadata:function getUAMetadata(){return{"X-TV-Device-Model":"".concat(Nt.browserName," ").concat(Nt.browserVersion),"X-TV-OS-Version":"".concat(Nt.osName," ").concat(Nt.osVersion),"X-TV-OS-Platform":Nt.isMobile?"".concat(Nt.osName.toLowerCase(),"_web"):"web"}}}),Object.freeze({__proto__:null,loadExternalScript:function loadExternalScript(e){var t=e.url;return new Promise((function(e){var n=document.createElement("script");n.onload=e,n.src=t,document.head.appendChild(n)}))}})),Tt=function(){function Tt(e,t){_classCallCheck(this,Tt),this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return _createClass(Tt,[{key:"get",value:function get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function set(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function has(e){return this.data.has(e)}},{key:"delete",value:function _delete(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function numDataIds(){return this.dataIdsCount}}]),Tt}(),Ft=function(){function Ft(){_classCallCheck(this,Ft)}return _createClass(Ft,[{key:"refCount",value:function refCount(e){return Mt("refCount")}},{key:"incRef",value:function incRef(e){return Mt("incRef")}},{key:"timerAvailable",value:function timerAvailable(){return!0}},{key:"time",value:function time(e){return Mt("time")}},{key:"read",value:function read(e){return Mt("read")}},{key:"readSync",value:function readSync(e){return Mt("readSync")}},{key:"numDataIds",value:function numDataIds(){return Mt("numDataIds")}},{key:"disposeData",value:function disposeData(e,t){return Mt("disposeData")}},{key:"write",value:function write(e,t,n){return Mt("write")}},{key:"move",value:function move(e,t,n,r,a){return Mt("move")}},{key:"memory",value:function memory(){return Mt("memory")}},{key:"floatPrecision",value:function floatPrecision(){return Mt("floatPrecision")}},{key:"epsilon",value:function epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function dispose(){return Mt("dispose")}}]),Ft}();function Mt(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function Ot(e,t,n){return Math.max(e,Math.min(t,n))}function Dt(e){return e%2==0?e:e+1}function Bt(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Lt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Bt(Ut(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function Pt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||Zt(e)&&!n)for(var _r5=0;_r5<e.length;++_r5)Pt(e[_r5],t,n);else t.push(e);return t}function Wt(e){if(0===e.length)return 1;for(var t=e[0],_n9=1;_n9<e.length;_n9++)t*=e[_n9];return t}function Ut(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var _n10=0;_n10<e.length;_n10++)if(e[_n10]!==t[_n10])return!1;return!0}function Vt(e){return e%1==0}function Gt(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function zt(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Ht(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var o=0;!function s(){if(e())r();else{o++;var i=t(o);null!=n&&o>=n?a():setTimeout(s,i)}}()}))}function jt(e,t){for(var n=1,r=-1,_t6=0;_t6<e.length;++_t6)if(e[_t6]>=0)n*=e[_t6];else if(-1===e[_t6]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(_t6));r=_t6}else if(e[_t6]<0)throw Error("Shapes can not be < 0. Found ".concat(e[_t6]," at dim ").concat(_t6));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var a=e.slice();return a[r]=t/n,a}function Xt(e,t){var n=t.length;return Bt((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e)})),Bt(e.every((function(e){return Vt(e)})),(function(){return"All values in axis param must be integers but got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function qt(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,o=null==t||a?null:Xt(t,e).sort(),s=0,_t7=0;_t7<e.length;++_t7){if(null!=o){if(o[s]===_t7&&1!==e[_t7])throw new Error("Can't squeeze axis ".concat(_t7," since its dim '").concat(e[_t7],"' is not 1"));(null==o[s]||o[s]>_t7)&&1===e[_t7]&&(n.push(e[_t7]),r.push(_t7)),o[s]<=_t7&&s++}1!==e[_t7]&&(n.push(e[_t7]),r.push(_t7))}return{newShape:n,keptDims:r}}function Qt(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function Kt(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function Yt(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Zt(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Jt(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function en(e){return"string"==typeof e||e instanceof String}function tn(e){return Array.isArray(e)?tn(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":"number"==typeof e?"float32":en(e)?"string":function(e){return"boolean"==typeof e}(e)?"bool":"float32"}function nn(e){return!!(e&&e.constructor&&e.call&&e.apply)}function rn(e,t){for(var _n11=t;_n11<e;++_n11)if(e%_n11==0)return _n11;return e}function an(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var _r6=t-3;_r6>=0;--_r6)n[_r6]=n[_r6+1]*e[_r6+1];return n}function on(e,t,n){var r=new Array;if(1===t.length)for(var _a6=t[0],_t8=0;_t8<_a6;_t8++)r[_t8]=n[e+_t8];else for(var _a7=t[0],_o3=t.slice(1),_s3=_o3.reduce((function(e,t){return e*t})),_t9=0;_t9<_a7;_t9++)r[_t9]=on(e+_t9*_s3,_o3,n);return r}function sn(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length,"."));return on(0,e,t)}function un(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function ln(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return sn(e,new Float32Array(n));if("int32"===t)return sn(e,new Int32Array(n));if("bool"===t)return sn(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function cn(e){e.forEach((function(t){Bt(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function dn(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],_t10=0;_t10<e.length-1;++_t10)r+=n[_t10]*e[_t10];return r}function pn(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),_t11=0;_t11<r.length-1;++_t11)r[_t11]=Math.floor(e/n[_t11]),e-=r[_t11]*n[_t11];return r[r.length-1]=e,r}function hn(e){return e&&e.then&&"function"==typeof e.then}var fn=function(){function fn(e){_classCallCheck(this,fn),this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}var _getAsync;return _createClass(fn,[{key:"setPlatform",value:function setPlatform(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(t,".")),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var _t12=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(_t12,".")),this.set(e,_t12)}}},{key:"getAsync",value:(_getAsync=_asyncToGenerator(regeneratorRuntime.mark((function _callee(e){return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_context.t0=e in this.flags,_context.t0){_context.next=5;break}return _context.next=4,this.evaluateFlag(e);case 4:this.flags[e]=_context.sent;case 5:return _context.abrupt("return",this.flags[e]);case 6:case"end":return _context.stop()}}),_callee,this)}))),function getAsync(_x2){return _getAsync.apply(this,arguments)})},{key:"get",value:function get(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(hn(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function getNumber(e){return this.get(e)}},{key:"getBool",value:function getBool(e){return this.get(e)}},{key:"getFlags",value:function getFlags(){return this.flags}},{key:"set",value:function set(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function setFlags(e){this.flags=Object.assign({},e)}},{key:"reset",value:function reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function populateURLFlags(){var _this7=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e=function(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var _len=arguments.length,n=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)n[_key-1]=arguments[_key];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")})),t}(this.global.location.search);"tfjsflags"in e&&e.tfjsflags.split(",").forEach((function(e){var _e$split2=_slicedToArray(e.split(":"),2),t=_e$split2[0],n=_e$split2[1];_this7.urlFlags[t]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(t,n)}))}}},{key:"features",get:function get(){return this.flags}}]),fn}();function mn(){return bn}var gn,bn=null;function xn(){if(null==gn){var _e7;if("undefined"!=typeof window)_e7=window;else if(void 0!==global)_e7=global;else if(void 0!==process)_e7=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");_e7=self}gn=_e7}return gn}function vn(e,t){var n=function(){var e=xn();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var _r7=t();return n.set(e,_r7),n.get(e)}var yn=vn("kernelRegistry",(function(){return new Map})),wn=vn("gradRegistry",(function(){return new Map}));function kn(e,t){var n=En(e,t);return yn.get(n)}function In(e){return wn.get(e)}function Cn(e){for(var t=yn.entries(),n=[];;){var _t$next=t.next(),_r8=_t$next.done,_a8=_t$next.value;if(_r8)break;var _a9=_slicedToArray(_a8,2),_o4=_a9[0],_s4=_a9[1];_slicedToArray(_o4.split("_"),1)[0]===e&&n.push(_s4)}return n}function An(e){var t=e.kernelName,n=e.backendName,r=En(t,n);yn.has(r)&&console.warn("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),yn.set(r,e)}function En(e,t){return"".concat(t,"_").concat(e)}function _n(e,t){return"string"===t?Sn(e):$n([e],t)}function $n(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Pt(e)),mn().getBool("DEBUG")&&function(e,t){for(var _n12=0;_n12<e.length;_n12++){var _r9=e[_n12];if(isNaN(_r9)||!isFinite(_r9))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(_r9,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var _t13=new Uint8Array(e.length),_n13=0;_n13<_t13.length;++_n13)0!==Math.round(e[_n13])&&(_t13[_n13]=1);return _t13}throw new Error("Unknown data type ".concat(t))}function Nn(){return mn().platform.now()}function Sn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",mn().platform.encode(e,t)}function Rn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",mn().platform.decode(e,t)}var Tn=function(){function Tn(e,t){_classCallCheck(this,Tn),this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Mn)}return _createClass(Tn,[{key:"profileKernel",value:function profileKernel(e,t,n){var r,o,a=function a(){r=n()},s=Nn();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(a);else{a();var _step2,_iterator2=_createForOfIteratorHelper(r);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){_step2.value.dataSync()}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}o=Promise.resolve({kernelMs:Nn()-s})}if(mn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var _loop=function _loop(_t14){var n=r[_t14];n.data().then((function(t){Fn(t,n.dtype,e)}))},_t14=0;_t14<r.length;_t14++)_loop(_t14);return{kernelName:e,outputs:r,inputs:t,timeMs:o.then((function(e){return e.kernelMs})),extraInfo:o.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function logKernelProfile(e){var _this8=this,t=e.kernelName,n=e.outputs,r=e.timeMs,a=e.inputs,o=e.extraInfo;n.forEach((function(e){Promise.all([e.data(),r,o]).then((function(n){_this8.logger.logKernelProfile(t,e,n[0],n[1],a,n[2])}))}))}}]),Tn}();function Fn(e,t,n){if("float32"!==t)return!1;for(var _t15=0;_t15<e.length;_t15++){var _r10=e[_t15];if(isNaN(_r10)||!isFinite(_r10))return console.warn("Found ".concat(_r10," in the result of '").concat(n,"'")),!0}return!1}var Mn=function(){function Mn(){_classCallCheck(this,Mn)}return _createClass(Mn,[{key:"logKernelProfile",value:function logKernelProfile(e,t,n,r,a,o){var s="number"==typeof r?zt("".concat(r,"ms"),9):r.error,i=zt(e,25),u=t.rank,l=t.size,c=zt(t.shape.toString(),14),d="";for(var _e9 in a){var _n14=a[_e9];if(null!=_n14){var _r11=_n14.shape||t.shape,_a10=_r11.length;d+="".concat(_e9,": ").concat(_a10,"D ").concat(_a10>0?_r11:""," ")}}console.log("%c".concat(i,"\t%c").concat(s,"\t%c").concat(u,"D ").concat(c,"\t%c").concat(l,"\t%c").concat(d,"\t%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),Mn}();function On(e,t,n,r){var a=an(t),o=function(e,t,n,r){var a=Wt(t),o=r[r.length-1],s=new Array(o).fill(0),i=t.length,u="complex64"===n?Pn(e):e;if(i>1)for(var _e10=0;_e10<a/o;_e10++)for(var _t16=_e10*o,_e11=0;_e11<o;_e11++)s[_e11]=Math.max(s[_e11],Dn(u[_t16+_e11],0,n).length);return s}(e,t,n,a),s=t.length,i=Ln(e,t,n,a,o),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(s)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(i.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function Dn(e,t,n){return zt(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ").concat(parseFloat(e[1].toFixed(7)),"j"):en(e)?"'".concat(e,"'"):"bool"===n?Bn(e):parseFloat(e.toFixed(7)).toString(),t)}function Bn(e){return 0===e?"false":"true"}function Ln(e,t,n,r,a){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s="complex64"===n?2:1,i=t[0],u=t.length;if(0===u)return"complex64"===n?[Dn(Pn(e)[0],0,n)]:"bool"===n?[Bn(e[0])]:[e[0].toString()];if(1===u){if(i>20){var _t17=3*s,_r12=Array.from(e.slice(0,_t17)),_o5=Array.from(e.slice((i-3)*s,i*s));return"complex64"===n&&(_r12=Pn(_r12),_o5=Pn(_o5)),["["+_r12.map((function(e,t){return Dn(e,a[t],n)})).join(", ")+", ..., "+_o5.map((function(e,t){return Dn(e,a[i-3+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?Pn(e):Array.from(e)).map((function(e,t){return Dn(e,a[t],n)})).join(", ")+"]"]}var l=t.slice(1),c=r.slice(1),d=r[0]*s,p=[];if(i>20){for(var _t18=0;_t18<3;_t18++){var _r13=_t18*d,_o6=_r13+d;p.push.apply(p,_toConsumableArray(Ln(e.slice(_r13,_o6),l,n,c,a,!1)))}p.push("...");for(var _t19=i-3;_t19<i;_t19++){var _r14=_t19*d,_o7=_r14+d;p.push.apply(p,_toConsumableArray(Ln(e.slice(_r14,_o7),l,n,c,a,_t19===i-1)))}}else for(var _t20=0;_t20<i;_t20++){var _r15=_t20*d,_o8=_r15+d;p.push.apply(p,_toConsumableArray(Ln(e.slice(_r15,_o8),l,n,c,a,_t20===i-1)))}var h=2===u?",":"";p[0]="["+p[0]+h;for(var _e12=1;_e12<p.length-1;_e12++)p[_e12]=" "+p[_e12]+h;for(var f=",\n",_e13=2;_e13<u;_e13++)f+="\n";return p[p.length-1]=" "+p[p.length-1]+"]"+(o?"":f),p}function Pn(e){for(var t=[],_n15=0;_n15<e.length;_n15+=2)t.push([e[_n15],e[_n15+1]]);return t}var Wn=function(){function Wn(e,t,n){var _this9=this;if(_classCallCheck(this,Wn),this.dtype=t,this.shape=e.slice(),this.size=Wt(e),null!=n){var _e14=n.length;Bt(_e14===this.size,(function(){return"Length of values '".concat(_e14,"' does not match the size inferred by the shape '").concat(_this9.size,"'.")}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Kt(t,this.size),this.strides=an(e)}return _createClass(Wn,[{key:"set",value:function set(e){for(var _this10=this,_len2=arguments.length,t=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)t[_key2-1]=arguments[_key2];0===t.length&&(t=[0]),Bt(t.length===this.rank,(function(){return"The number of provided coordinates (".concat(t.length,") must match the rank (").concat(_this10.rank,")")}));var n=this.locToIndex(t);this.values[n]=e}},{key:"get",value:function get(){for(var _len3=arguments.length,e=new Array(_len3),_key3=0;_key3<_len3;_key3++)e[_key3]=arguments[_key3];0===e.length&&(e=[0]);for(var t=0,_i3=0,_e15=e;_i3<_e15.length;_i3++){var _n16=_e15[_i3];if(_n16<0||_n16>=this.shape[t]){var _t21="Requested out of range element at ".concat(e,".   Buffer shape=").concat(this.shape);throw new Error(_t21)}t++}for(var n=e[e.length-1],_t22=0;_t22<e.length-1;++_t22)n+=this.strides[_t22]*e[_t22];return this.values[n]}},{key:"locToIndex",value:function locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],_n17=0;_n17<e.length-1;++_n17)t+=this.strides[_n17]*e[_n17];return t}},{key:"indexToLoc",value:function indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),_n18=0;_n18<t.length-1;++_n18)t[_n18]=Math.floor(e/this.strides[_n18]),e-=t[_n18]*this.strides[_n18];return t[t.length-1]=e,t}},{key:"toTensor",value:function toTensor(){return Un().makeTensor(this.values,this.shape,this.dtype)}},{key:"rank",get:function get(){return this.shape.length}}]),Wn}(),Un=null,Vn=null,Gn=function(){function Gn(e,t,n,r){_classCallCheck(this,Gn),this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Wt(e),this.strides=an(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}var _bytes,_data,_array,_buffer;return _createClass(Gn,[{key:"buffer",value:(_buffer=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var e;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.data();case 2:return e=_context2.sent,_context2.abrupt("return",Vn.buffer(this.shape,this.dtype,e));case 4:case"end":return _context2.stop()}}),_callee2,this)}))),function buffer(){return _buffer.apply(this,arguments)})},{key:"bufferSync",value:function bufferSync(){return Vn.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:(_array=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var e;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.data();case 2:return e=_context3.sent,_context3.abrupt("return",sn(this.shape,e));case 4:case"end":return _context3.stop()}}),_callee3,this)}))),function array(){return _array.apply(this,arguments)})},{key:"arraySync",value:function arraySync(){return sn(this.shape,this.dataSync())}},{key:"data",value:(_data=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){var e,_t23;return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(this.throwIfDisposed(),e=Un().read(this.dataId),"string"!==this.dtype){_context4.next=13;break}return _context4.next=5,e;case 5:return _t23=_context4.sent,_context4.prev=6,_context4.abrupt("return",_t23.map((function(e){return Rn(e)})));case 10:throw _context4.prev=10,_context4.t0=_context4.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return _context4.abrupt("return",e);case 14:case"end":return _context4.stop()}}),_callee4,this,[[6,10]])}))),function data(){return _data.apply(this,arguments)})},{key:"dataSync",value:function dataSync(){this.throwIfDisposed();var e=Un().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return Rn(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:(_bytes=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(){var e;return regeneratorRuntime.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return this.throwIfDisposed(),_context5.next=3,Un().read(this.dataId);case 3:return e=_context5.sent,_context5.abrupt("return","string"===this.dtype?e:new Uint8Array(e.buffer));case 5:case"end":return _context5.stop()}}),_callee5,this)}))),function bytes(){return _bytes.apply(this,arguments)})},{key:"dispose",value:function dispose(){this.isDisposed||(Un().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"throwIfDisposed",value:function throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function print(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Vn.print(this,e)}},{key:"clone",value:function clone(){return this.throwIfDisposed(),Vn.clone(this)}},{key:"toString",value:function toString(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return On(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function cast(e){return this.throwIfDisposed(),Vn.cast(this,e)}},{key:"variable",value:function variable(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),Un().makeVariable(this,e,t,n)}},{key:"rank",get:function get(){return this.shape.length}},{key:"isDisposed",get:function get(){return this.isDisposedInternal}}]),Gn}();Object.defineProperty(Gn,Symbol.hasInstance,{value:function value(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),vn("Tensor",(function(){return Gn}));var Hn,jn,Xn,qn,Qn,zn=function(_Gn){_inherits(zn,_Gn);var _super=_createSuper(zn);function zn(e,t,n,r){var _this11;return _classCallCheck(this,zn),(_this11=_super.call(this,e.shape,e.dtype,e.dataId,r)).trainable=t,_this11.name=n,_this11}return _createClass(zn,[{key:"assign",value:function assign(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!Ut(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));Un().disposeTensor(this),this.dataId=e.dataId,Un().incRef(this,null)}},{key:"dispose",value:function dispose(){Un().disposeVariable(this),this.isDisposedInternal=!0}}]),zn}(Gn);Object.defineProperty(zn,Symbol.hasInstance,{value:function value(e){return e instanceof Gn&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Hn||(Hn={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(jn||(jn={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Xn||(Xn={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(qn||(qn={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Qn||(Qn={}));var Kn={float32:qn,int32:jn,bool:Xn,complex64:Qn};function Yn(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Kn[e][t]}function Zn(e){return Yn(e,"int32")}function Jn(e){var t=[];return er(e,t,new Set),t}function er(e,t,n){if(null!=e)if(e instanceof Gn)t.push(e);else if(r=e,Array.isArray(r)||"object"==_typeof(r)){var r,a=e;for(var _e16 in a){var _r16=a[_e16];n.has(_r16)||(n.add(_r16),er(_r16,t,n))}}}function tr(e){return null!=e.kernelName}var nr=function(){function nr(){_classCallCheck(this,nr),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return _createClass(nr,[{key:"dispose",value:function dispose(){for(var _e17 in this.registeredVariables)this.registeredVariables[_e17].dispose()}}]),nr}(),rr=function(){function rr(e){_classCallCheck(this,rr),this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new nr}var _time,_profile,_setBackend,_ready;return _createClass(rr,[{key:"ready",value:(_ready=_asyncToGenerator(regeneratorRuntime.mark((function _callee6(){var e,_t24,_n19;return regeneratorRuntime.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(null==this.pendingBackendInit){_context6.next=2;break}return _context6.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){_context6.next=4;break}return _context6.abrupt("return");case 4:e=this.getSortedBackends(),_t24=0;case 6:if(!(_t24<e.length)){_context6.next=17;break}return _n19=e[_t24],_context6.next=10,this.initializeBackend(_n19).success;case 10:if(!_context6.sent){_context6.next=14;break}return _context6.next=13,this.setBackend(_n19);case 13:return _context6.abrupt("return",void _context6.sent);case 14:_t24++,_context6.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return _context6.stop()}}),_callee6,this)}))),function ready(){return _ready.apply(this,arguments)})},{key:"backendNames",value:function backendNames(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function registerBackend(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:(_setBackend=_asyncToGenerator(regeneratorRuntime.mark((function _callee7(e){var _this$initializeBacke2,_t26;return regeneratorRuntime.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(null!=this.registryFactory[e]){_context7.next=2;break}throw new Error("Backend name '".concat(e,"' not found in registry"));case 2:if(this.backendName=e,null!=this.registry[e]){_context7.next=14;break}if(this.backendInstance=null,_this$initializeBacke2=this.initializeBackend(e),_t26=_this$initializeBacke2.success,!_this$initializeBacke2.asyncInit){_context7.next=11;break}return _context7.next=8,_t26;case 8:_context7.t0=_context7.sent,_context7.next=12;break;case 11:_context7.t0=_t26;case 12:if(_context7.t0){_context7.next=14;break}return _context7.abrupt("return",!1);case 14:return _context7.abrupt("return",(this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Tn(this.backendInstance),!0));case 15:case"end":return _context7.stop()}}),_callee7,this)}))),function setBackend(_x3){return _setBackend.apply(this,arguments)})},{key:"setupRegisteredKernels",value:function setupRegisteredKernels(){var _this12=this;Cn(this.backendName).forEach((function(e){null!=e.setupFunc&&e.setupFunc(_this12.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function disposeRegisteredKernels(e){var _this13=this;Cn(e).forEach((function(t){null!=t.disposeFunc&&t.disposeFunc(_this13.registry[e])}))}},{key:"initializeBackend",value:function initializeBackend(e){var _this14=this,t=this.registryFactory[e];if(null==t)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var _n21=t.factory();if(!_n21||_n21 instanceof Ft||"function"!=typeof _n21.then)return this.registry[e]=_n21,{success:!0,asyncInit:!1};var _t27=++this.pendingBackendInitId,_r17=_n21.then((function(n){return!(_t27<_this14.pendingBackendInitId||(_this14.registry[e]=n,_this14.pendingBackendInit=null,0))})).catch((function(n){return _t27<_this14.pendingBackendInitId||(_this14.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1}));return this.pendingBackendInit=_r17,{success:_r17,asyncInit:!0}}catch(t){return console.warn("Initialization of backend ".concat(e," failed")),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function removeBackend(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function getSortedBackends(){var _this15=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(e,t){return _this15.registryFactory[t].priority-_this15.registryFactory[e].priority}))}},{key:"initializeBackendsAndReturnBest",value:function initializeBackendsAndReturnBest(){for(var e=this.getSortedBackends(),_t28=0;_t28<e.length;_t28++){var _n22=e[_t28],_this$initializeBacke3=this.initializeBackend(_n22),_r18=_this$initializeBacke3.success,_a11=_this$initializeBacke3.asyncInit;if(_a11||_r18)return{name:_n22,asyncInit:_a11}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function moveData(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function tidy(e,t){var n,_this16=this,r=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun((function(){return _this16.startScope(r)}),(function(){return _this16.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function scopedRun(e,t,n){e();try{var _e18=n();return t(),_e18}catch(e){throw t(),e}}},{key:"nextTensorId",value:function nextTensorId(){return rr.nextTensorId++}},{key:"nextVariableId",value:function nextVariableId(){return rr.nextVariableId++}},{key:"clone",value:function clone(e){var t=or.runKernel("Identity",{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function x(){var t={x:e};return or.runKernel("Cast",t,{dtype:"float32"})}}}),[],{}),t}},{key:"runKernel",value:function runKernel(e,t,n){if(null==kn(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function checkKernelForMemLeak(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=r-t-a-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(s," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function runKernelFunc(e){var t,s,i,_this17=this,n=[],r=this.isTapeOn(),a=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var u=tr(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(tr(e)){var _t29=e.kernelName,_a12=e.inputs,_o9=e.attrs;null==this.backendName&&this.backend;var _u3=kn(_t29,this.backendName);Bt(null!=_u3,(function(){return"Cannot find registered kernel '".concat(_t29,"' for backend '").concat(_this17.backendName,"'")})),s=function s(){var e=_this17.backend.numDataIds();i=_u3.kernelFunc({inputs:_a12,attrs:_o9,backend:_this17.backend});var s=Array.isArray(i)?i:[i];_this17.shouldCheckForMemLeaks()&&_this17.checkKernelForMemLeak(_t29,e,s);var l=s.map((function(e){if(null!=e.rank)return e;var t=e.dataId,n=e.shape,r=e.dtype;return _this17.makeTensorFromDataId(t,n,r)}));if(r){var _e19=_this17.getTensorsForGradient(_t29,_a12,l);n=_this17.saveTensorsForBackwardMode(_e19)}return l}}else{var _t30=e.forwardFunc,_a13=function _a13(e){r&&(n=e.map((function(e){return _this17.keep(_this17.clone(e))})))};s=function s(){var e=_this17.backend.numDataIds();i=_this17.tidy((function(){return _t30(_this17.backend,_a13)}));var n=Array.isArray(i)?i:[i];return _this17.shouldCheckForMemLeaks()&&_this17.checkKernelForMemLeak(u,e,n),n}}var p,l=e.inputs,c=e.attrs,d=tr(e)?null:e.backwardsFunc;return this.scopedRun((function(){return _this17.state.kernelDepth++}),(function(){return _this17.state.kernelDepth--}),(function(){_this17.ENV.getBool("DEBUG")||_this17.state.profiling?(p=_this17.profiler.profileKernel(u,l,(function(){return s()})),_this17.ENV.getBool("DEBUG")&&_this17.profiler.logKernelProfile(p),t=p.outputs):t=s()})),r&&this.addTapeNode(u,l,t,d,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map((function(e){return null!=l[e]?l[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(i)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function saveTensorsForBackwardMode(e){var _this18=this;return e.map((function(e){return _this18.keep(_this18.clone(e))}))}},{key:"getTensorsForGradient",value:function getTensorsForGradient(e,t,n){var r=In(e);if(null!=r){var _o10,_e20=r.inputsToSave||[],_a14=r.outputsToSave||[];r.saveAllInputs?(Bt(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),_o10=Object.keys(t).map((function(e){return t[e]}))):_o10=_e20.map((function(e){return t[e]}));var _s5=n.filter((function(e,t){return _a14[t]}));return _o10.concat(_s5)}return[]}},{key:"makeTensor",value:function makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&en(e[0])&&(a=e.map((function(e){return Sn(e)})));var o=r.write(a,t,n),s=new Gn(t,n,o,this.nextTensorId());if(this.trackTensor(s,r),"string"===n){var _e21=this.state.tensorInfo.get(o),_t31=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=_t31-_e21.bytes,_e21.bytes=_t31}return s}},{key:"makeTensorFromDataId",value:function makeTensorFromDataId(e,t,n,r){var a=new Gn(t,n=n||"float32",e,this.nextTensorId());return this.trackTensor(a,r),a}},{key:"makeVariable",value:function makeVariable(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new zn(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Jt(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof zn||this.track(e)}},{key:"incRef",value:function incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function disposeTensor(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var _t32=e.size*Jt(e.dtype);this.state.numBytes-=_t32}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function disposeVariables(){for(var _e22 in this.state.registeredVariables){var _t33=this.state.registeredVariables[_e22];this.disposeVariable(_t33)}}},{key:"disposeVariable",value:function disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function memory(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:(_profile=_asyncToGenerator(regeneratorRuntime.mark((function _callee8(e){var t,n,_iterator3,_step3,_e23;return regeneratorRuntime.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],_context8.next=5,e();case 5:this.state.activeProfile.result=_context8.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,_toConsumableArray(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,_iterator3=_createForOfIteratorHelper(this.state.activeProfile.kernels),_context8.prev=11,_iterator3.s();case 13:if((_step3=_iterator3.n()).done){_context8.next=23;break}return _e23=_step3.value,_context8.next=17,_e23.kernelTimeMs;case 17:return _e23.kernelTimeMs=_context8.sent,_context8.next=20,_e23.extraInfo;case 20:_e23.extraInfo=_context8.sent;case 21:_context8.next=13;break;case 23:_context8.next=28;break;case 25:_context8.prev=25,_context8.t0=_context8.catch(11),_iterator3.e(_context8.t0);case 28:return _context8.prev=28,_iterator3.f(),_context8.finish(28);case 31:return _context8.abrupt("return",this.state.activeProfile);case 32:case"end":return _context8.stop()}}),_callee8,this,[[11,25,28,31]])}))),function profile(_x4){return _profile.apply(this,arguments)})},{key:"isTapeOn",value:function isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function addTapeNode(e,t,n,r,a,o){var _this19=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},i=In(e);null!=i&&(r=i.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var _e24=n[t],_r19=un(_e24.size,_e24.dtype);return _this19.makeTensor(_r19,_e24.shape,_e24.dtype)}return e})),r(e.length>1?e:e[0],a,o)}),this.state.activeTape.push(s)}},{key:"keep",value:function keep(e){return e.kept=!0,e}},{key:"startTape",value:function startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function endTape(){this.state.gradientDepth--}},{key:"startScope",value:function startScope(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function endScope(e){for(var _this20=this,t=Jn(e),n=new Set(t.map((function(e){return e.id}))),_e25=0;_e25<this.state.activeScope.track.length;_e25++){var _t34=this.state.activeScope.track[_e25];_t34.kept||n.has(_t34.id)||_t34.dispose()}var r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach((function(e){e.kept||e.scopeId!==r.id||_this20.track(e)}))}},{key:"gradients",value:function gradients(e,t,n){var _this21=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Bt(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var a=this.scopedRun((function(){return _this21.startTape()}),(function(){return _this21.endTape()}),(function(){return _this21.tidy("forward",e)}));Bt(a instanceof Gn,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},_e26=0;_e26<t.length;_e26++)r[t[_e26].id]=!0;for(var _n23=0;_n23<e.length;_n23++){var _o11=e[_n23],_s6=_o11.inputs;for(var _e27 in _s6){for(var _n24=_s6[_e27],_i4=!1,_e28=0;_e28<t.length;_e28++)if(r[_n24.id]){_o11.outputs.forEach((function(e){return r[e.id]=!0})),_i4=!0,a[_o11.id]=!0;break}if(_i4)break}}var o={};o[n.id]=!0;for(var s={},_t35=e.length-1;_t35>=0;_t35--)for(var _n25=e[_t35],_r20=_n25.inputs,_e29=0;_e29<_n25.outputs.length;_e29++)if(o[_n25.outputs[_e29].id]){for(var _e30 in _r20)o[_r20[_e30].id]=!0,s[_n25.id]=!0;break}for(var i=[],_t36=0;_t36<e.length;_t36++){var _n26=e[_t36];if(a[_n26.id]&&s[_n26.id]){var _e31={};for(var _t38 in _n26.inputs){var _a15=_n26.inputs[_t38];r[_a15.id]&&(_e31[_t38]=_a15)}var _t37=Object.assign({},_n26);_t37.inputs=_e31,_t37.outputs=_n26.outputs,i.push(_t37)}}return i}(this.state.activeTape,t,a);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[a.id]=null==n?function(e){var t=function(e,t){for(var n=un(e,"float32"),_e32=0;_e32<n.length;_e32++)n[_e32]=1;return n}(Wt(e));return or.makeTensor(t,e,"float32")}(a.shape):n,function(e,t,n,r){for(var _loop2=function _loop2(_a16){var o=t[_a16],s=[];if(o.outputs.forEach((function(t){var n=e[t.id];null!=n?s.push(n):s.push(null)})),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(o.kernelName,"."));var i=o.gradient(s),_loop3=function _loop3(_t39){if(!(_t39 in i))throw new Error("Cannot backprop through input ".concat(_t39,". Available gradients found: ").concat(Object.keys(i),"."));var a=function(e){return _this21.tidy(e)}((function(){return i[_t39]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(o.kernelName,". The gradient of input ").concat(_t39," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var s=o.inputs[_t39];if(!Ut(a.shape,s.shape))throw new Error("Error in gradient for op ".concat(o.kernelName,". The gradient of input '").concat(_t39,"' has shape '").concat(a.shape,"', which does not match the shape of the input '").concat(s.shape,"'"));if(null==e[s.id])e[s.id]=a;else{var _t40=e[s.id];e[s.id]=r(_t40,a),_t40.dispose()}};for(var _t39 in o.inputs)_loop3(_t39)},_a16=t.length-1;_a16>=0;_a16--)_loop2(_a16)}(e,o,0,sr);var r=t.map((function(t){return e[t.id]}));return 0===_this21.state.gradientDepth&&(_this21.state.activeTape.forEach((function(e){var _step4,_iterator4=_createForOfIteratorHelper(e.saved);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){_step4.value.dispose()}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}})),_this21.state.activeTape=null),{value:a,grads:r}}))}},{key:"customGrad",value:function customGrad(e){var _this22=this;return Bt(nn(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var _len4=arguments.length,t=new Array(_len4),_key4=0;_key4<_len4;_key4++)t[_key4]=arguments[_key4];var n;Bt(t.every((function(e){return e instanceof Gn})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var r={};return t.forEach((function(e,t){r[t]=e})),_this22.runKernelFunc({forwardFunc:function forwardFunc(r,a){return Bt((n=e.apply(void 0,t.concat([a]))).value instanceof Gn,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),Bt(nn(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value},backwardsFunc:function backwardsFunc(e,r){var a=n.gradFunc(e,r),o=Array.isArray(a)?a:[a];Bt(o.length===t.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),Bt(o.every((function(e){return e instanceof Gn})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var s={};return o.forEach((function(e,t){s[t]=function(){return e}})),s},inputs:r})}}},{key:"readSync",value:function readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function read(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"time",value:(_time=_asyncToGenerator(regeneratorRuntime.mark((function _callee9(e){var t,n;return regeneratorRuntime.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return t=Nn(),_context9.next=3,this.backend.time(e);case 3:return n=_context9.sent,_context9.abrupt("return",(n.wallMs=Nn()-t,n));case 5:case"end":return _context9.stop()}}),_callee9,this)}))),function time(_x5){return _time.apply(this,arguments)})},{key:"track",value:function track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"reset",value:function reset(){for(var _e33 in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new nr,this.registry)this.disposeRegisteredKernels(_e33),this.registry[_e33].dispose(),delete this.registry[_e33];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}},{key:"backend",get:function get(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var _this$initializeBacke4=this.initializeBackendsAndReturnBest(),_e34=_this$initializeBacke4.name;if(_this$initializeBacke4.asyncInit)throw new Error("The highest priority backend '".concat(_e34,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(_e34)}return this.backendInstance}},{key:"registeredVariables",get:function get(){return this.state.registeredVariables}}]),rr}();function ar(){var t,e=xn();if(null==e._tfengine){var _t43=new fn(e);e._tfengine=new rr(_t43)}return t=e._tfengine.ENV,bn=t,Un=function Un(){return e._tfengine},e._tfengine}rr.nextTensorId=0,rr.nextVariableId=0;var or=ar();function sr(e,t){var n={a:e,b:t};return or.runKernel("Add",n)}function ir(){if("undefined"!=typeof navigator&&null!=navigator){var _e35=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(_e35)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(_e35.substr(0,4))}return!1}function ur(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var lr=mn();function cr(e,t){var n=e;if(Zt(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Zt(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&mn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&dr(e,r,[]),r}function dr(e,t,n){if(n=n||[],Array.isArray(e)||Zt(e)){Bt(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, but is an array of ").concat(e.length," elements")})),Bt(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," elements, but has ").concat(e.length," elements")}));for(var r=t.slice(1),_t44=0;_t44<e.length;++_t44)dr(e[_t44],r,n.concat(_t44))}else Bt(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(t[0]," elements")}))}function pr(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function hr(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof Gn)return pr(r,e.dtype,t,n),e;var a=tn(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),pr(r,a,t,n),null==e||!Zt(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var _r21=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(_r21,"'"))}var o=cr(e,a);Zt(e)||Array.isArray(e)||(e=[e]);var s="string"!==a?$n(e,a):Pt(e,[],!0);return or.makeTensor(s,o,a)}function fr(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function a(){or.startScope(n);try{var _t45=r.apply(void 0,arguments);return hn(_t45)&&console.error("Cannot return a Promise inside of tidy."),or.endScope(_t45),_t45}catch(e){throw or.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}lr.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),lr.registerFlag("IS_BROWSER",(function(){return ur()})),lr.registerFlag("IS_NODE",(function(){return void 0!==process&&void 0!==process.versions&&void 0!==process.versions.node})),lr.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),lr.registerFlag("PROD",(function(){return!1})),lr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return lr.getBool("DEBUG")})),lr.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),lr.registerFlag("IS_TEST",(function(){return!1})),lr.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),lr.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1}));var mr=fr({complex_:function complex_(e,t){var n=hr(e,"real","complex"),r=hr(t,"imag","complex");Lt(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex()."));var a={real:n,imag:r};return or.runKernel("Complex",a)}}),gr=void 0!==Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function br(e){return gr?Buffer.byteLength(e):new Blob([e]).size}function xr(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:br(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:br(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var vr=function(){function vr(){_classCallCheck(this,vr),this.saveRouters=[],this.loadRouters=[]}return _createClass(vr,null,[{key:"getInstance",value:function getInstance(){return null==vr.instance&&(vr.instance=new vr),vr.instance}},{key:"registerSaveRouter",value:function registerSaveRouter(e){vr.getInstance().saveRouters.push(e)}},{key:"registerLoadRouter",value:function registerLoadRouter(e){vr.getInstance().loadRouters.push(e)}},{key:"getSaveHandlers",value:function getSaveHandlers(e){return vr.getHandlers(e,"save")}},{key:"getLoadHandlers",value:function getLoadHandlers(e,t){return vr.getHandlers(e,"load",t)}},{key:"getHandlers",value:function getHandlers(e,t,n){var r=[];return("load"===t?vr.getInstance().loadRouters:vr.getInstance().saveRouters).forEach((function(t){var a=t(e,n);null!==a&&r.push(a)})),r}}]),vr}();function yr(){if(!mn().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function wr(e){var t=e.result;t.createObjectStore("models_store",{keyPath:"modelPath"}),t.createObjectStore("model_info_store",{keyPath:"modelPath"})}var kr=function(){function kr(e){if(_classCallCheck(this,kr),this.indexedDB=yr(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}var _load,_save;return _createClass(kr,[{key:"save",value:(_save=_asyncToGenerator(regeneratorRuntime.mark((function _callee10(e){return regeneratorRuntime.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(!(e.modelTopology instanceof ArrayBuffer)){_context10.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return _context10.abrupt("return",this.databaseAction(this.modelPath,e));case 3:case"end":return _context10.stop()}}),_callee10,this)}))),function save(_x6){return _save.apply(this,arguments)})},{key:"load",value:(_load=_asyncToGenerator(regeneratorRuntime.mark((function _callee11(){return regeneratorRuntime.wrap((function _callee11$(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return _context11.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return _context11.stop()}}),_callee11,this)}))),function load(){return _load.apply(this,arguments)})},{key:"databaseAction",value:function databaseAction(e,t){var _this23=this;return new Promise((function(e,n){var r=_this23.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return wr(r)},r.onsuccess=function(){var a=r.result;if(null==t){var _t46=a.transaction("models_store","readonly"),_r22=_t46.objectStore("models_store").get(_this23.modelPath);_r22.onsuccess=function(){if(null==_r22.result)return a.close(),n(new Error("Cannot find model with path '".concat(_this23.modelPath,"' in IndexedDB.")));e(_r22.result.modelArtifacts)},_r22.onerror=function(e){return a.close(),n(_r22.error)},_t46.oncomplete=function(){return a.close()}}else{var _u4,_r23=xr(t),_o12=a.transaction("model_info_store","readwrite"),_s7=_o12.objectStore("model_info_store"),_i5=_s7.put({modelPath:_this23.modelPath,modelArtifactsInfo:_r23});_i5.onsuccess=function(){var i=(_u4=a.transaction("models_store","readwrite")).objectStore("models_store").put({modelPath:_this23.modelPath,modelArtifacts:t,modelArtifactsInfo:_r23});i.onsuccess=function(){return e({modelArtifactsInfo:_r23})},i.onerror=function(e){var t=(_s7=_o12.objectStore("model_info_store")).delete(_this23.modelPath);t.onsuccess=function(){return a.close(),n(i.error)},t.onerror=function(e){return a.close(),n(i.error)}}},_i5.onerror=function(e){return a.close(),n(_i5.error)},_o12.oncomplete=function(){null==_u4?a.close():_u4.oncomplete=function(){return a.close()}}}},r.onerror=function(e){return n(r.error)}}))}}]),kr}();kr.URL_SCHEME="indexeddb://";var Ir=function Ir(e){return mn().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(kr.URL_SCHEME)?(t=e.slice(kr.URL_SCHEME.length),new kr(t)):null;var t};vr.registerSaveRouter(Ir),vr.registerLoadRouter(Ir);var Cr=function(){function Cr(){_classCallCheck(this,Cr),this.indexedDB=yr()}var _removeModel,_listModels;return _createClass(Cr,[{key:"listModels",value:(_listModels=_asyncToGenerator(regeneratorRuntime.mark((function _callee12(){var _this24=this;return regeneratorRuntime.wrap((function _callee12$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return _context12.abrupt("return",new Promise((function(e,t){var n=_this24.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=function(){return wr(n)},n.onsuccess=function(){var r=n.result,a=r.transaction("model_info_store","readonly"),o=a.objectStore("model_info_store").getAll();o.onsuccess=function(){var _step5,t={},_iterator5=_createForOfIteratorHelper(o.result);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _e36=_step5.value;t[_e36.modelPath]=_e36.modelArtifactsInfo}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}e(t)},o.onerror=function(e){return r.close(),t(o.error)},a.oncomplete=function(){return r.close()}},n.onerror=function(e){return t(n.error)}})));case 1:case"end":return _context12.stop()}}),_callee12)}))),function listModels(){return _listModels.apply(this,arguments)})},{key:"removeModel",value:(_removeModel=_asyncToGenerator(regeneratorRuntime.mark((function _callee13(e){var t,_this25=this;return regeneratorRuntime.wrap((function _callee13$(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return _context13.abrupt("return",(e=(t=e).startsWith(kr.URL_SCHEME)?t.slice(kr.URL_SCHEME.length):t,new Promise((function(t,n){var r=_this25.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return wr(r)},r.onsuccess=function(){var u,a=r.result,o=a.transaction("model_info_store","readwrite"),s=o.objectStore("model_info_store"),i=s.get(e);i.onsuccess=function(){if(null==i.result)return a.close(),n(new Error("Cannot find model with path '".concat(e,"' in IndexedDB.")));var _r24=s.delete(e),_o13=function _o13(){var r=(u=a.transaction("models_store","readwrite")).objectStore("models_store").delete(e);r.onsuccess=function(){return t(i.result.modelArtifactsInfo)},r.onerror=function(e){return n(i.error)}};_r24.onsuccess=_o13,_r24.onerror=function(e){return _o13(),a.close(),n(i.error)}},i.onerror=function(e){return a.close(),n(i.error)},o.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}},r.onerror=function(e){return n(r.error)}}))));case 1:case"end":return _context13.stop()}}),_callee13)}))),function removeModel(_x7){return _removeModel.apply(this,arguments)})}]),Cr}(),Ar="tensorflowjs_models",Er="info",_r="model_topology",$r="weight_specs",Nr="weight_data",Sr="model_metadata";function Rr(e){return{info:[Ar,e,Er].join("/"),topology:[Ar,e,_r].join("/"),weightSpecs:[Ar,e,$r].join("/"),weightData:[Ar,e,Nr].join("/"),modelMetadata:[Ar,e,Sr].join("/")}}function Tr(e){var t=e.split("/");if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join("/")}var Fr=function(){function Fr(e){if(_classCallCheck(this,Fr),!mn().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Rr(this.modelPath)}var _load2,_save2;return _createClass(Fr,[{key:"save",value:(_save2=_asyncToGenerator(regeneratorRuntime.mark((function _callee14(e){var t,_n27,_r25,_a17;return regeneratorRuntime.wrap((function _callee14$(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(!(e.modelTopology instanceof ArrayBuffer)){_context14.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return t=JSON.stringify(e.modelTopology),_n27=JSON.stringify(e.weightSpecs),_r25=xr(e),_context14.prev=3,this.LS.setItem(this.keys.info,JSON.stringify(_r25)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,_n27),this.LS.setItem(this.keys.weightData,function(e){if(gr)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",_e37=0,_r26=t.length;_e37<_r26;_e37++)n+=String.fromCharCode(t[_e37]);return btoa(n)}(e.weightData)),_a17={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy},_context14.abrupt("return",(null!=e.signature&&(_a17.signature=e.signature),null!=e.userDefinedMetadata&&(_a17.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(_a17.modelInitializer=e.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(_a17)),{modelArtifactsInfo:_r25}));case 9:throw _context14.prev=9,_context14.t0=_context14.catch(3),this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(_r25.modelTopologyBytes,", weightSpecsBytes=").concat(_r25.weightSpecsBytes,", weightDataBytes=").concat(_r25.weightDataBytes,"."));case 12:case"end":return _context14.stop()}}),_callee14,this,[[3,9]])}))),function save(_x8){return _save2.apply(this,arguments)})},{key:"load",value:(_load2=_asyncToGenerator(regeneratorRuntime.mark((function _callee15(){var e,t,n,r,a,_e38,o;return regeneratorRuntime.wrap((function _callee15$(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:if(null!=(e=JSON.parse(this.LS.getItem(this.keys.info)))){_context15.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===e.modelTopologyType){_context15.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(t={},null!=(n=JSON.parse(this.LS.getItem(this.keys.topology)))){_context15.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(t.modelTopology=n,null!=(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){_context15.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(t.weightSpecs=r,null!=(a=this.LS.getItem(this.keys.modelMetadata))&&(_e38=JSON.parse(a),t.format=_e38.format,t.generatedBy=_e38.generatedBy,t.convertedBy=_e38.convertedBy,null!=_e38.signature&&(t.signature=_e38.signature),null!=_e38.userDefinedMetadata&&(t.userDefinedMetadata=_e38.userDefinedMetadata),null!=_e38.modelInitializer&&(t.modelInitializer=_e38.modelInitializer)),null!=(o=this.LS.getItem(this.keys.weightData))){_context15.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return _context15.abrupt("return",(t.weightData=function(e){if(gr){var _t47=Buffer.from(e,"base64");return _t47.buffer.slice(_t47.byteOffset,_t47.byteOffset+_t47.byteLength)}for(var t=atob(e),n=new Uint8Array(t.length),_e39=0;_e39<t.length;++_e39)n.set([t.charCodeAt(_e39)],_e39);return n.buffer}(o),t));case 19:case"end":return _context15.stop()}}),_callee15,this)}))),function load(){return _load2.apply(this,arguments)})}]),Fr}();Fr.URL_SCHEME="localstorage://";var Mr=function Mr(e){return mn().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Fr.URL_SCHEME)?(t=e.slice(Fr.URL_SCHEME.length),new Fr(t)):null;var t};vr.registerSaveRouter(Mr),vr.registerLoadRouter(Mr);var Or=function(){function Or(){_classCallCheck(this,Or),Bt(mn().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),Bt("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}var _removeModel2,_listModels2;return _createClass(Or,[{key:"listModels",value:(_listModels2=_asyncToGenerator(regeneratorRuntime.mark((function _callee16(){var e,t,n,_r27,_a18;return regeneratorRuntime.wrap((function _callee16$(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:for(e={},t=Ar+"/",n="/"+Er,_r27=0;_r27<this.LS.length;++_r27)(_a18=this.LS.key(_r27)).startsWith(t)&&_a18.endsWith(n)&&(e[Tr(_a18)]=JSON.parse(this.LS.getItem(_a18)));return _context16.abrupt("return",e);case 3:case"end":return _context16.stop()}}),_callee16,this)}))),function listModels(){return _listModels2.apply(this,arguments)})},{key:"removeModel",value:(_removeModel2=_asyncToGenerator(regeneratorRuntime.mark((function _callee17(e){var t,n,r;return regeneratorRuntime.wrap((function _callee17$(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(n=Rr(e=(t=e).startsWith(Fr.URL_SCHEME)?t.slice(Fr.URL_SCHEME.length):t),null!=this.LS.getItem(n.info)){_context17.next=3;break}throw new Error("Cannot find model at path '".concat(e,"'"));case 3:return r=JSON.parse(this.LS.getItem(n.info)),_context17.abrupt("return",(this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),r));case 5:case"end":return _context17.stop()}}),_callee17,this)}))),function removeModel(_x9){return _removeModel2.apply(this,arguments)})}]),Or}(),Dr=function(){function Dr(){_classCallCheck(this,Dr),this.managers={}}return _createClass(Dr,null,[{key:"getInstance",value:function getInstance(){return null==Dr.instance&&(Dr.instance=new Dr),Dr.instance}},{key:"registerManager",value:function registerManager(e,t){Bt(null!=e,(function(){return"scheme must not be undefined or null."})),e.endsWith("://")&&(e=e.slice(0,e.indexOf("://"))),Bt(e.length>0,(function(){return"scheme must not be an empty string."}));var n=Dr.getInstance();Bt(null==n.managers[e],(function(){return"A model store manager is already registered for scheme '".concat(e,"'.")})),n.managers[e]=t}},{key:"getManager",value:function getManager(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function getSchemes(){return Object.keys(this.getInstance().managers)}}]),Dr}(),Br=function(){function Br(){_classCallCheck(this,Br)}return _createClass(Br,[{key:"fetch",value:function(_fetch){function fetch(_x10,_x11){return _fetch.apply(this,arguments)}return fetch.toString=function(){return _fetch.toString()},fetch}((function(e,t){return fetch(e,t)}))},{key:"now",value:function now(){return performance.now()}},{key:"encode",value:function encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function decode(e,t){return new TextDecoder(t).decode(e)}}]),Br}();if(mn().get("IS_BROWSER")){mn().setPlatform("browser",new Br);try{Dr.registerManager(Fr.URL_SCHEME,new Or)}catch(e){}try{Dr.registerManager(kr.URL_SCHEME,new Cr)}catch(e){}}var Pr,Lr=function Lr(){return __webpack_require__(793)},Wr=function(){function Wr(){_classCallCheck(this,Wr),this.util=__webpack_require__(530),this.textEncoder=new this.util.TextEncoder}return _createClass(Wr,[{key:"fetch",value:function fetch(e,t){return null!=mn().global.fetch?mn().global.fetch(e,t):(null==Pr&&(Pr=Lr()),Pr(e,t))}},{key:"now",value:function now(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),Wr}();function Ur(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",cn(e),new Wn(e,t,n)}mn().get("IS_NODE")&&mn().setPlatform("node",new Wr);var Vr=fr({cast_:function cast_(e,t){var n=hr(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return or.runKernel("Cast",r,a)}}),Gr=fr({clone_:function clone_(e){var t={x:hr(e,"x","clone","string_or_numeric")};return or.runKernel("Identity",t)}});function zr(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===Wt(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,o=a[a.length-1],s=1,_e40=0;_e40<a.length-1;++_e40)s*=a[_e40];var i=e.shape,u=a.slice();u.pop();for(var l=1,_e41=o;_e41<n;++_e41)l*=i[_e41],u.push(i[_e41]);var c=[].concat(_toConsumableArray(an(e.shape).map((function(e){return e/l}))),[1]).slice(0,o);return[u,s,l,c]}function Hr(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(o+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(o+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(o+" update.rank != "+(a+e.length-r));for(var _e42=0;_e42<a;++_e42)if(n.shape[_e42]!==t.shape[_e42])throw new Error(o+" updates.shape[".concat(_e42,"] (").concat(n.shape[_e42],") != indices.shape[").concat(_e42,"] (").concat(t.shape[_e42],")."));for(var _t48=0;_t48<n.rank-a;++_t48)if(n.shape[_t48+a]!==e[_t48+r])throw new Error(o+" updates.shape[".concat(_t48+a,"] (").concat(n.shape[_t48+a],") != shape[").concat(_t48+a,"] (").concat(e[_t48+a],")"))}function jr(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,o=n.length,s=1,_e43=a;_e43<o;++_e43)s*=n[_e43];var i=a<1?1:a;return{sliceRank:a,numUpdates:Wt(t.shape)/i,sliceSize:s,strides:[].concat(_toConsumableArray(an(n.slice(0,a))),[1]),outputSize:Wt(n)}}function Xr(e,t,n){var r=e.shape.length;Bt(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),Bt(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var _loop4=function _loop4(_a19){Bt(t[_a19]+n[_a19]<=e.shape[_a19],(function(){return"Error in slice".concat(r,"D: begin[").concat(_a19,"] + size[").concat(_a19,"] (").concat(t[_a19]+n[_a19],") would overflow input.shape[").concat(_a19,"] (").concat(e.shape[_a19],")")}))},_a19=0;_a19<r;++_a19)_loop4(_a19)}function qr(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Qr(e,t,n){for(var r=[],_a20=0;_a20<e.length;_a20++)r[_a20]=Math.ceil((t[_a20]-e[_a20])/n[_a20]);return r}function Kr(e,t,n,r){for(var a=_toConsumableArray(e),_e44=a.length;_e44<r.length;_e44++)a.push(1);for(var _e45=0;_e45<n;_e45++)0===_e45?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Yr(e,t,n){return n<=e?n:n-(t-1)}function Zr(e,t){for(var n=[],_r28=0;_r28<e;_r28++)n.push(t+_r28);return n}function Jr(e,t,n,r,a,o,s,i,u){var l=e.length,c=new Array(l),d=new Array(l),p=new Array(l);if(t.length&&n>0){var _u5=t[0],_l2=n+1;c=ea(s,_u5,_l2,r,e),d=ta(i,_u5,_l2,a,e),p=Kr(o,_u5,_l2,e)}else for(var _t49=0;_t49<l;_t49++)c[_t49]=ra(s,r,o,e,_t49,u),d[_t49]=aa(i,a,o,e,_t49,u),p[_t49]=na(o,_t49,u);return{begin:c,end:d,strides:p}}function ea(e,t,n,r,a){for(var o=_toConsumableArray(a),s=Zr(n,t),_a21=0;_a21<o.length;_a21++)if(s.indexOf(_a21)>-1)o[_a21]=0;else{var _s8=Yr(t,n,_a21),_i6=r[_s8];e&1<<_s8&&(_i6=0),o[_a21]=_i6}return o}function ta(e,t,n,r,a){for(var o=_toConsumableArray(a),s=Zr(n,t),_a22=0;_a22<o.length;_a22++)if(s.indexOf(_a22)>-1)o[_a22]=Number.MAX_SAFE_INTEGER;else{var _s9=Yr(t,n,_a22),_i7=r[_s9];e&1<<_s9&&(_i7=Number.MAX_SAFE_INTEGER),o[_a22]=_i7}for(var _e46=0;_e46<o.length;_e46++){var _t50=a[_e46];o[_e46]<0&&(o[_e46]+=_t50),o[_e46]=Ot(0,o[_e46],a[_e46])}return o}function na(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function ra(e,t,n,r,a,o){var s=t[a],i=n[a]||1;(e&1<<a||o&1<<a||null==s)&&(s=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return s<0&&(s+=u),s=Ot(0,s,u-1)}function aa(e,t,n,r,a,o){var s=t[a],i=n[a]||1;(e&1<<a||o&1<<a||null==s)&&(s=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return s<0&&(s+=u),s=i>0?Ot(0,s,u):Ot(-1,s,u-1)}function oa(e,t,n){for(var r=n.length,_e47=0;_e47<n.length;_e47++)if(n[_e47]>1){r=_e47;break}for(var _a23=r+1;_a23<n.length;_a23++)if(t[_a23]>0||n[_a23]!==e[_a23])return!1;return!0}function sa(e,t){for(var n=e.length>0?e[e.length-1]:1,_r29=0;_r29<e.length-1;_r29++)n+=e[_r29]*t[_r29];return n}function ia(e,t,n){var r,o,a=e.shape.length;return(r="number"==typeof t?[t].concat(_toConsumableArray(new Array(a-1).fill(0))):t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice()).forEach((function(e){Bt(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=null==n?new Array(a).fill(-1):"number"==typeof n?[n].concat(_toConsumableArray(new Array(a-1).fill(-1))):n.length<a?n.concat(new Array(a-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(Bt(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,o]}function ua(e,t,n,r,a,o,s,i,u){var l=t.slice(),c=n.slice(),d=r;null==r&&(d=new Array(l.length));var p=qr(s);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==s&&0!==i)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==s&&0!==u)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var h=e.length-l.length,f=qr(i),m=e.slice();f.forEach((function(e){l[e]=0,c[e]=1,m.splice(e,0,1)}));var _Jr=Jr(m,p,h,l,c,d,a,o,s),g=_Jr.begin,b=_Jr.end,x=_Jr.strides;l=g,c=b,d=x;var v=qr(u);v.forEach((function(e){c[e]=l[e]+1,d[e]=1}));var y=Qr(l,c,d),w=y.filter((function(e,t){return-1===v.indexOf(t)}));return{nonStrided:d.every((function(e){return 1===e})),$begin:l,$end:c,$strides:d,size:y,newShape:m,outShape:w}}ar(),Vn={buffer:Ur,cast:Vr,clone:Gr,print:function print(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};var la=Object.freeze({__proto__:null,assertParamsValid:Xr,maskToAxes:qr,computeOutShape:Qr,stridesWithElidedDims:Kr,getNormalizedAxes:Jr,startIndicesWithElidedDims:ea,stopIndicesWithElidedDims:ta,stridesForAxis:na,startForAxis:ra,stopForAxis:aa,isSliceContinous:oa,computeFlatOffset:sa,parseSliceParams:ia,sliceInfo:ua});function ca(){mn().set("PROD",!0)}function da(){return or}function pa(e){return or.setBackend(e)}function ha(){return or.ready()}function fa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return or.registerBackend(e,t,n)}var ma=fr({mul_:function mul_(e,t){var n=hr(e,"a","mul"),r=hr(t,"b","mul"),_ref6=_slicedToArray(function(e,t){if(e.dtype===t.dtype)return[e,t];var n=Yn(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}(n,r),2),a={a:n=_ref6[0],b:r=_ref6[1]};return or.runKernel("Multiply",a)}});function ga(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",o=arguments.length>5?arguments[5]:void 0;return va(e,[].concat(_toConsumableArray(t),[e[3]]),n,o,r,null,null,$a(a))}function ba(e,t,n,r,a,o){var l,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",_ka=ka(t),_ka2=_slicedToArray(_ka,2),i=_ka2[0],u=_ka2[1];if("channelsLast"===s)l=[i,u,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));l=[i,u,e[1],e[1]]}return va(e,l,n,r,a,o,!1,s)}function xa(e,t,n,r,a,o){var c,d,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",_Ia=Ia(t),_Ia2=_slicedToArray(_Ia,3),i=_Ia2[0],u=_Ia2[1],l=_Ia2[2];if("NDHWC"===s)d="channelsLast",c=[i,u,l,e[4],e[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat ".concat(s));d="channelsFirst",c=[i,u,l,e[1],e[1]]}return ya(e,c,n,r,a,!1,d,o)}function va(e,t,n,r,a,o){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,l=-1,c=-1,d=-1;if("channelsLast"===i){var _e48=_slicedToArray(e,4);u=_e48[0],l=_e48[1],c=_e48[2],d=_e48[3]}else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat ".concat(i));var _e49=_slicedToArray(e,4);u=_e49[0],d=_e49[1],l=_e49[2],c=_e49[3]}var A,_t51=_slicedToArray(t,4),p=_t51[0],h=_t51[1],f=_t51[3],_ka3=ka(n),_ka4=_slicedToArray(_ka3,2),m=_ka4[0],g=_ka4[1],_ka5=ka(r),_ka6=_slicedToArray(_ka5,2),b=_ka6[0],x=_ka6[1],v=Ca(p,b),y=Ca(h,x),_ref7=function(e,t,n,r,a,o,s,i,u){var l,c,d;if("number"==typeof e){l={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var _a24=function(e,t,n,r,a){null==r&&(r=wa(e,t,n));var s=e[1];return[Aa((e[0]-t+2*r)/n+1,a),Aa((s-t+2*r)/n+1,a)]}([t,n],o,r,e,i);c=_a24[0],d=_a24[1]}else if("same"===e){c=Math.ceil(t/r),d=Math.ceil(n/a);var _e50=Math.max(0,(c-1)*r+o-t),_i8=Math.max(0,(d-1)*a+s-n),_u6=Math.floor(_e50/2),_p2=_e50-_u6,_h2=Math.floor(_i8/2);l={top:_u6,bottom:_p2,left:_h2,right:_i8-_h2,type:"SAME"}}else if("valid"===e)l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-o+1)/r),d=Math.ceil((n-s+1)/a);else{if("object"!=_typeof(e))throw Error("Unknown padding parameter: ".concat(e));var _p3="channelsLast"===u?e[1][0]:e[2][0],_h3="channelsLast"===u?e[1][1]:e[2][1],_f2="channelsLast"===u?e[2][0]:e[3][0],_m2="channelsLast"===u?e[2][1]:e[3][1];l={top:_p3,bottom:_h3,left:_f2,right:_m2,type:0===_p3&&0===_h3&&0===_f2&&0===_m2?"VALID":"EXPLICIT"},c=Aa((t-o+_p3+_h3)/r+1,i),d=Aa((n-s+_f2+_m2)/a+1,i)}return{padInfo:l,outHeight:c,outWidth:d}}(a,l,c,m,g,v,y,o,i),w=_ref7.padInfo,k=_ref7.outHeight,I=_ref7.outWidth,C=s?f*d:f;return"channelsFirst"===i?A=[u,C,k,I]:"channelsLast"===i&&(A=[u,k,I,C]),{batchSize:u,dataFormat:i,inHeight:l,inWidth:c,inChannels:d,outHeight:k,outWidth:I,outChannels:C,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:p,filterWidth:h,effectiveFilterHeight:v,effectiveFilterWidth:y,dilationHeight:b,dilationWidth:x,inShape:e,outShape:A,filterShape:t}}function ya(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",i=arguments.length>7?arguments[7]:void 0,u=-1,l=-1,c=-1,d=-1,p=-1;if("channelsLast"===s){var _e51=_slicedToArray(e,5);u=_e51[0],l=_e51[1],c=_e51[2],d=_e51[3],p=_e51[4]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var _e52=_slicedToArray(e,5);u=_e52[0],p=_e52[1],l=_e52[2],c=_e52[3],d=_e52[4]}var R,_t52=_slicedToArray(t,5),h=_t52[0],f=_t52[1],m=_t52[2],g=_t52[4],_Ia3=Ia(n),_Ia4=_slicedToArray(_Ia3,3),b=_Ia4[0],x=_Ia4[1],v=_Ia4[2],_Ia5=Ia(r),_Ia6=_slicedToArray(_Ia5,3),y=_Ia6[0],w=_Ia6[1],k=_Ia6[2],I=Ca(h,y),C=Ca(f,w),A=Ca(m,k),_ref8=function(e,t,n,r,a,o,s,i,u,l,c){var d,p,h,f;if("number"==typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var _o14=function(e,t,n,r,a,o){null==a&&(a=wa(e,t,r));var i=e[1],u=e[2];return[Aa((e[0]-t+2*a)/r+1,o),Aa((i-t+2*a)/r+1,o),Aa((u-t+2*a)/r+1,o),1]}([t,n,r,1],i,0,a,e,c);p=_o14[0],h=_o14[1],f=_o14[2]}else if("same"===e){var _e53=((p=Math.ceil(t/a))-1)*a+i-t,_c2=((h=Math.ceil(n/o))-1)*o+u-n,_m3=((f=Math.ceil(r/s))-1)*s+l-r,_g2=Math.floor(_e53/2),_b2=_e53-_g2,_x12=Math.floor(_c2/2),_v2=_c2-_x12,_y2=Math.floor(_m3/2);d={top:_x12,bottom:_v2,left:_y2,right:_m3-_y2,front:_g2,back:_b2,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-i+1)/a),h=Math.ceil((n-u+1)/o),f=Math.ceil((r-l+1)/s)}return{padInfo:d,outDepth:p,outHeight:h,outWidth:f}}(a,l,c,d,b,x,v,I,C,A,i),E=_ref8.padInfo,_=_ref8.outDepth,$=_ref8.outHeight,N=_ref8.outWidth,S=o?g*p:g;return"channelsFirst"===s?R=[u,S,_,$,N]:"channelsLast"===s&&(R=[u,_,$,N,S]),{batchSize:u,dataFormat:s,inDepth:l,inHeight:c,inWidth:d,inChannels:p,outDepth:_,outHeight:$,outWidth:N,outChannels:S,padInfo:E,strideDepth:b,strideHeight:x,strideWidth:v,filterDepth:h,filterHeight:f,filterWidth:m,effectiveFilterDepth:I,effectiveFilterHeight:C,effectiveFilterWidth:A,dilationDepth:y,dilationHeight:w,dilationWidth:k,inShape:e,outShape:R,filterShape:t}}function wa(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Ca(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function ka(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Ia(e){return"number"==typeof e?[e,e,e]:e}function Ca(e,t){return t<=1?e:e+(e-1)*(t-1)}function Aa(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function Ea(e){var _ka8=_slicedToArray(ka(e),3),t=_ka8[0],n=_ka8[1],r=_ka8[2];return 1===t&&1===n&&1===r}function _a(e,t){return Ea(e)||Ea(t)}function $a(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}var Na=fr({reshape_:function reshape_(e,t){var n={x:hr(e,"x","reshape","string_or_numeric")},r={shape:t};return or.runKernel("Reshape",n,r)}});function Sa(e,t){for(var n=e.length,r=[],_a25=0;_a25<n;_a25++){var _o15=n-1-_a25,_s10=e[_o15]||1;(t[t.length-1-_a25]||1)>1&&1===_s10&&r.unshift(_o15)}return r}function Ra(e,t){for(var n=[],_r30=0;_r30<t.length;_r30++){var _a26=e[e.length-_r30-1],_o16=t.length-_r30-1,_s11=t[_o16];(null==_a26||1===_a26&&_s11>1)&&n.unshift(_o16)}return n}function Ta(e,t){for(var n=[],r=Math.max(e.length,t.length),_a27=0;_a27<r;_a27++){var _r31=e[e.length-_a27-1];null==_r31&&(_r31=1);var _o17=t[t.length-_a27-1];if(null==_o17&&(_o17=1),1===_r31)n.unshift(_o17);else if(1===_o17)n.unshift(_r31);else{if(_r31!==_o17)throw Error("Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,"."));n.unshift(_r31)}}return n}var Fa=fr({elu_:function elu_(e){var t={x:hr(e,"x","elu")};return or.runKernel("Elu",t)}}),Ma=fr({leakyRelu_:function leakyRelu_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:hr(e,"x","leakyRelu")},r={alpha:t};return or.runKernel("LeakyRelu",n,r)}}),Oa=fr({sum_:function sum_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=hr(e,"x","sum");"bool"===r.dtype&&(r=Vr(r,"int32"));var a={x:r},o={axis:t,keepDims:n};return or.runKernel("Sum",a,o)}});function Da(e,t){for(var _n28=0;_n28<e.length;++_n28)if(e[e.length-_n28-1]!==t-1-_n28)return!1;return!0}function Ba(e,t,n){for(var r=e.length+t.length,a=[],o=0,s=0,_i9=0;_i9<r;_i9++)-1===n.indexOf(_i9)?a.push(e[o++]):a.push(t[s++]);return a}function La(e,t){for(var n=[],r=e.length,_a28=0;_a28<r;_a28++)-1===t.indexOf(_a28)&&n.push(e[_a28]);return[n,t.map((function(t){return e[t]}))]}function Pa(e,t){return Ba(e,t.map((function(e){return 1})),t)}function Wa(e,t,n){Bt(Da(t,n),(function(){return"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")}))}function Ua(e,t){if(Da(e,t))return null;for(var n=[],_r32=0;_r32<t;++_r32)-1===e.indexOf(_r32)&&n.push(_r32);return e.forEach((function(e){return n.push(e)})),n}function Va(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Ga(e,t){for(var n=[],_r33=t-e;_r33<t;++_r33)n.push(_r33);return n}function za(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var _t53=za(e,"float32"),_n29=za(e,"float32");return mr(_t53,_n29)}var n=un(Wt(e),t);return or.makeTensor(n,e,t)}var Ha=fr({prelu_:function prelu_(e,t){var n={x:hr(e,"x","prelu"),alpha:hr(t,"alpha","prelu")};return or.runKernel("Prelu",n)}}),ja=Ne((function(e){!function(e,t,n){function r(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new r(e),o=t&&t.state,s=n.next;return s.int32=function(){return 4294967296*n.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,o&&("object"==_typeof(o)&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.alea=o}(0,e)})),Xa=Ne((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new r(e),o=t&&t.state,s=function s(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&("object"==_typeof(o)&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xor128=o}(0,e)})),qa=Ne((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,s=function s(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&("object"==_typeof(o)&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xorwow=o}(0,e)})),Qa=Ne((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,s=function s(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&(o.x&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xorshift7=o}(0,e)})),Ka=Ne((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,o=t.i;return t.w=r=r+1640531527|0,n=a[o+34&127],e=a[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[o]=n^e,t.i=o,n+(r^r>>>16)|0},function(e,t){var n,r,a,o,s,i=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,o=-32;o<u;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(s=s+1640531527|0,a=0==(n=i[127&o]^=r+s)?a+1:0);for(a>=128&&(i[127&(t&&t.length||0)]=-1),a=127,o=512;o>0;--o)r=i[a+34&127],n=i[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,i[a]=r^n;e.w=s,e.X=i,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,s=function s(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&(o.X&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xor4096=o}(0,e)})),Ya=Ne((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,s=function s(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&("object"==_typeof(o)&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.tychei=o}(0,e)})),Za=Se(Object.freeze({__proto__:null,default:{}})),Ja=Ne((function(e){!function(t,n){var r,a=this,o=256,s=n.pow(o,6),i=n.pow(2,52),u=2*i,l=255;function c(e,l,c){var g=[],b=f(function h(e,t){var n,r=[],a=_typeof(e);if(t&&"object"==a)for(n in e)try{r.push(h(e[n],t-1))}catch(e){}return r.length?r:"string"==a?e:e+"\0"}((l=1==l?{entropy:!0}:l||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=a.navigator,s=n&&n.plugins;return[+new Date,a,s,a.screen,m(t)]}}():e,3),g),x=new d(g),v=function v(){for(var e=x.g(6),t=s,n=0;e<i;)e=(e+n)*o,t*=o,n=x.g(1);for(;e>=u;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|x.g(4)},v.quick=function(){return x.g(4)/4294967296},v.double=v,f(m(x.S),t),(l.pass||c||function(e,t,r,a){return a&&(a.S&&p(a,x),e.state=function(){return p(x,{})}),r?(n.random=e,t):e})(v,b,"global"in l?l.global:this==n,l.state)}function d(e){var t,n=e.length,r=this,a=0,s=r.i=r.j=0,i=r.S=[];for(n||(e=[n++]);a<o;)i[a]=a++;for(a=0;a<o;a++)i[a]=i[s=l&s+e[a%n]+(t=i[a])],i[s]=t;(r.g=function(e){for(var t,n=0,a=r.i,s=r.j,i=r.S;e--;)t=i[a=l&a+1],n=n*o+i[l&(i[a]=i[s=l&s+t])+(i[s]=t)];return r.i=a,r.j=s,n})(o)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){for(var n,r=e+"",a=0;a<r.length;)t[l&a]=l&(n^=19*t[l&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(n.seedrandom=c,f(n.random(),t),e.exports){e.exports=c;try{r=Za}catch(e){}}}([],Math)}));Ja.alea=ja,Ja.xor128=Xa,Ja.xorwow=qa,Ja.xorshift7=Qa,Ja.xor4096=Ka,Ja.tychei=Ya;var eo=Ja,to=fr({relu_:function relu_(e){var t={x:hr(e,"x","relu")};return or.runKernel("Relu",t)}}),no=fr({relu6_:function relu6_(e){var t={x:hr(e,"x","relu6")};return or.runKernel("Relu6",t)}});function ro(e,t){if((Zt(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Zt(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return function(e,t,n,r){if(null==r&&(r=tn(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Zt(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){cn(t);var _e54=Wt(t),_r34=Wt(n);Bt(_e54===_r34,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(_e54," values but has ").concat(_r34)}));for(var _e55=0;_e55<n.length;++_e55){var _a29=_e55!==n.length-1||n[_e55]!==Wt(t.slice(_e55));Bt(n[_e55]===t[_e55]||!_a29,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return Zt(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?$n(e,r):Pt(e,[],!0),or.makeTensor(e,t,r)}(e,[],[],t)}var ao=fr({step_:function step_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:hr(e,"x","step")},r={alpha:t};return or.runKernel("Step",n,r)}});function oo(e,t){for(var n=[],_e56=0;_e56<t.length;_e56++)t[_e56]&&n.push(_e56);for(var r=Ur(e,"int32"),a=Ur([n.length,e.length],"int32"),_t54=0;_t54<n.length;_t54++){var _o18=r.indexToLoc(n[_t54]),_s12=_t54*e.length;a.values.set(_o18,_s12)}return a.toTensor()}function so(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,o=0,s=!1;r<a;){var _i10=n(t,e[o=r+(a-r>>>1)]);_i10>0?r=o+1:(a=o,s=!_i10)}return s?r:-r-1}(e,t,n||io)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function io(e,t){return e>t?1:e<t?-1:0}function uo(e,t,n,r,a){return po(e,t,n,r,a,0)}function lo(e,t,n,r,a,o){return po(e,t,n,r,a,0,!1,o,!0)}function co(e,t,n,r,a,o){return po(e,t,n,r,a,o,!0)}function po(e,t,n,r,a,o){for(var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=[],_e57=0;_e57<t.length;_e57++)t[_e57]>a&&l.push({score:t[_e57],boxIndex:_e57,suppressBeginIndex:0});l.sort(mo);for(var c=o>0?-.5/o:0,d=[],p=[];d.length<n&&l.length>0;){var _t55=l.pop(),_n30=_t55.score,_o19=_t55.boxIndex,_s13=_t55.suppressBeginIndex;if(_n30<a)break;for(var _i11=!1,_n31=d.length-1;_n31>=_s13;--_n31){var _s14=ho(e,_o19,d[_n31]);if(_s14>=r){_i11=!0;break}if(_t55.score=_t55.score*fo(r,c,_s14),_t55.score<=a)break}_t55.suppressBeginIndex=d.length,_i11||(_t55.score===_n30?(d.push(_o19),p.push(_t55.score)):_t55.score>a&&so(l,_t55,mo))}var h=d.length,f=n-h;i&&f>0&&(d.push.apply(d,_toConsumableArray(new Array(f).fill(0))),p.push.apply(p,_toConsumableArray(new Array(f).fill(0))));var m={selectedIndices:d};return s&&(m.selectedScores=p),u&&(m.validOutputs=h),m}function ho(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),i=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),d=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),h=(i-o)*(u-s),f=(d-l)*(p-c);if(h<=0||f<=0)return 0;var m=Math.max(o,l),g=Math.max(s,c),b=Math.min(i,d),x=Math.min(u,p),v=Math.max(b-m,0)*Math.max(x-g,0);return v/(h+f-v)}function fo(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function mo(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function go(e,t){var n=e[0].length;e.forEach((function(e,t){Bt(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),Bt(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var _o20=0;_o20<n;_o20++)Bt(_o20===t||e[_o20]===r[_o20],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function bo(e,t){for(var n=e[0].slice(),_r36=1;_r36<e.length;_r36++)n[t]+=e[_r36][t];return n}function xo(e){return e<=30?e:rn(e,Math.floor(Math.sqrt(e)))}function vo(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function yo(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var _n32=t.length,_r37=0;_r37<_n32;++_r37)a=a.concat([e[_r37+1]/t[_r37],t[_r37]]);a=a.concat(e.slice(_n32+1))}return a}function wo(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var _n33=t+1;_n33<e;++_n33)_n33<=2*t?(r.push(_n33),r.push(_n33-(t+1))):r.push(_n33)}else{for(var _n34=[],_a30=[],_r38=1;_r38<e;++_r38)_r38>=2*t+1||_r38%2==1?_a30.push(_r38):_n34.push(_r38);r.push.apply(r,_n34),r.push(0),r.push.apply(r,_a30)}return r}function ko(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var _n35=1;_n35<e.length;++_n35)_n35<=t.length?r?a.push(t[_n35-1]*e[_n35]):a.push(e[_n35]/t[_n35-1]):a.push(e[_n35]);return a}function Io(e,t){for(var n=[0],_r39=0;_r39<t;++_r39)n.push(e[_r39][0]);return n}function Co(e,t,n){for(var r=e.slice(0,1),_a31=0;_a31<n;++_a31)r.push(e[_a31+1]-t[_a31][0]-t[_a31][1]);return r}function Ao(){var _console;mn().getBool("IS_TEST")||(_console=console).warn.apply(_console,arguments)}function Eo(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),_r40=0;_r40<n.length;_r40+=2)n[_r40]=e[_r40/2],n[_r40+1]=t[_r40/2];return n}function _o(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),_r41=0;_r41<e.length;_r41+=2)t[_r41/2]=e[_r41],n[_r41/2]=e[_r41+1];return{real:t,imag:n}}function $o(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),_t56=0;_t56<e.length;_t56+=4)n[Math.floor(_t56/4)]=e[_t56],r[Math.floor(_t56/4)]=e[_t56+1];return{real:n,imag:r}}function No(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),_t57=2;_t57<e.length;_t57+=4)n[Math.floor(_t57/4)]=e[_t57],r[Math.floor(_t57/4)]=e[_t57+1];return{real:n,imag:r}}function So(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Ro(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function To(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),_a32=0;_a32<Math.ceil(e/2);_a32++){var _o21=(t?2:-2)*Math.PI*(_a32/e);n[_a32]=Math.cos(_o21),r[_a32]=Math.sin(_o21)}return{real:n,imag:r}}function Fo(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Mo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)Bt(e.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{Bt(t.reduce((function(e,t){return-1===t&&(e+=1),e}),0)<=1,(function(){return"There should be only one negative value in split array."}));var _a33=t.indexOf(-1);if(-1!==_a33){var _r42=t.reduce((function(e,t){return t>0?e+t:e}));t[_a33]=e.shape[n]-_r42}Bt(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function Oo(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=rn(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=rn(e,n+1);return n}function Do(e,t,n){for(var r=[],a=e.length,_o22=0;_o22<a;_o22++)_o22!==t?r.push(e[_o22]):r.push(n);return r}function Bo(e,t,n,r){var a=t.shape.length,o=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>o)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(o,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var _n36=0;_n36<r;++_n36)if(e.shape[_n36]!==t.shape[_n36])throw new Error("x.shape[".concat(_n36,"]: ").concat(e.shape[_n36]," should be equal to indices.shape[").concat(_n36,"]: ").concat(t.shape[_n36],"."));for(var s=e.shape[n],i=[],u=1,l=1,c=1,_t58=0;_t58<r;++_t58)i.push(e.shape[_t58]),u*=e.shape[_t58];for(var _t59=r;_t59<n;_t59++)i.push(e.shape[_t59]),l*=e.shape[_t59];for(var _e58=r;_e58<a;_e58++)i.push(t.shape[_e58]);for(var _t60=n+1;_t60<o;_t60++)i.push(e.shape[_t60]),c*=e.shape[_t60];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:s,outputShape:i}}var Lo=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:Oo,computeOutShape:Do,collectGatherOpShapeInfo:Bo});function Po(e){try{return e.map((function(e){return Rn(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(e))}}function Wo(e){return e.map((function(e){return Sn(e)}))}var Ho,jo,Xo,Uo=Object.freeze({__proto__:null,slice_util:la,segment_util:Lo,fromUint8ToStringArray:Po,fromStringArrayToUint8:Wo,upcastType:Yn,axesAreInnerMostDims:Da,combineLocations:Ba,computeOutAndReduceShapes:La,expandShapeToKeepDim:Pa,assertAxesAreInnerMostDims:Wa,getAxesPermutation:Ua,getUndoAxesPermutation:Va,getInnerMostAxes:Ga,getBroadcastDims:Sa,getReductionAxes:Ra,assertAndGetBroadcastShape:Ta,assertParamsConsistent:go,computeOutShape:bo,computeDilation2DInfo:ga,computePool2DInfo:ba,computePool3DInfo:xa,computeConv2DInfo:va,computeConv3DInfo:ya,computeDefaultPad:wa,tupleValuesAreOne:Ea,eitherStridesOrDilationsAreOne:_a,convertConv2DDataFormat:$a,getFusedDyActivation:function getFusedDyActivation(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return ma(e,ao(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))},getFusedBiasGradient:function getFusedBiasGradient(e,t){var n=t,r=Ra(e.shape,t.shape);return r.length>0&&(n=Oa(n,r)),Na(n,e.shape)},applyActivation:function applyActivation(e,t,n,r){if("linear"===t)return e;if("relu"===t)return to(e);if("elu"===t)return Fa(e);if("relu6"===t)return no(e);if("prelu"===t)return Ha(e,n);if("leakyrelu"===t)return Ma(e,r);throw new Error("Unknown fused activation ".concat(t,"."))},shouldFuse:function shouldFuse(e,t){return!(e>0)||"linear"===t},PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:xo,getImageCenter:vo,getReshaped:yo,getPermuted:wo,getReshapedPermuted:ko,getSliceBeginCoords:Io,getSliceSize:Co,prepareAndValidate:zr,validateUpdateShape:Hr,validateInput:function validateInput(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}Hr(n,t,e)},calculateShapes:jr,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:Ao,log:function log(){var _console2;mn().getBool("IS_TEST")||(_console2=console).log.apply(_console2,arguments)},mergeRealAndImagArrays:Eo,splitRealAndImagArrays:_o,complexWithEvenIndex:$o,complexWithOddIndex:No,getComplexWithIndex:So,assignToTypedArray:Ro,exponents:To,exponent:Fo,prepareSplitSize:Mo}),Vo={},Go={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function zo(e){if(!(e in Vo)){var _t61=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Vo[e]}),!1),1===e?t.getContext("webgl",Go)||t.getContext("experimental-webgl",Go):t.getContext("webgl2",Go)}(e);if(null===_t61)return console.log("Could not get context for WebGL version",e),null;Vo[e]=_t61}var t=Vo[e];return t.isContextLost()?(delete Vo[e],zo(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Vo[e])}function qo(e,t){return[t,e]}function Qo(e){var t=Wt(e);return Gt(Math.ceil(t/4))}function Ko(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Yo(e,t){var r,a,o,s,i,l,c,d,p,n=e;return 2===mn().getNumber("WEBGL_VERSION")?(r=n.R32F,a=n.R16F,o=n.RGBA16F,s=n.RGBA32F,i=n.RED,l=4,c=1,d=n.HALF_FLOAT,p=n.FLOAT):(r=e.RGBA,a=e.RGBA,o=e.RGBA,s=n.RGBA,i=e.RGBA,l=4,c=4,d=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:s,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:d,textureTypeFloat:p}}function Zo(e,t){var n=t();return mn().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}function Jo(e){return!!(mn().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function es(e,t){return ls(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function ts(e,t){var n=ls(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Zo(e,(function(){return e.shaderSource(n,t)})),Zo(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){var n=ns.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),o=a.length.toString().length+2,s=a.map((function(e,t){return zt((t+1).toString(),o)+e})),i=0,_e59=0;_e59<s.length;_e59++)i=Math.max(s[_e59].length,i);var u=s.slice(0,r-1),l=s.slice(r-1,r),c=s.slice(r);console.log(u.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(zt(l[0],i)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Ho||(Ho={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(jo||(jo={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Xo||(Xo={}));var ms,gs,ns=/ERROR: [0-9]+:([0-9]+):/g;function rs(e,t){if(Zo(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function as(e,t,n,r,a,o,s){var i=e.getAttribLocation(t,n);return-1!==i&&(Zo(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Zo(e,(function(){return e.vertexAttribPointer(i,a,e.FLOAT,!1,o,s)})),Zo(e,(function(){return e.enableVertexAttribArray(i)})),!0)}function os(e,t,n){!function(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in ".concat("[gl.TEXTURE0, gl.TEXTURE".concat(n,"]"),"."))}(e,n),Zo(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),Zo(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}function ss(e,t,n){Zo(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Zo(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function is(e,t){Zo(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),Zo(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function us(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function ls(e,t,n){var r=Zo(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function cs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Wt(e.slice(0,e.length-t))}function ds(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function ps(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[cs(e)].concat(_toConsumableArray(ds(e)))),t}function hs(e){return e%2==0}function fs(e,t){if(Ut(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var _n37=e.slice(-1)[0],_r43=t.slice(-1)[0];if(_n37===_r43)return!0;if(hs(_n37)&&hs(_r43)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&hs(e[0])&&hs(t[0])}function bs(e,t){return null!=e.getExtension(t)}function xs(e){try{if(null!=zo(e))return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function vs(e){if(0===e)return!1;var t=zo(e);if(1!==e){if(bs(t,"EXT_color_buffer_float"))return ys(t);var _e60="EXT_color_buffer_half_float";if(bs(t,_e60)){var _n38=t.getExtension(_e60);return function(e,t){var n=Yo(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(s),i}(t,_n38)}return!1}return!!bs(t,"OES_texture_float")&&(!!bs(t,"WEBGL_color_buffer_float")&&ys(t))}function ys(e){var t=Yo(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function ws(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Bt("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the WebGL backend.")}))}))}var ks=mn();function Is(){var e,t,n,r,a,o,s,i,u,l;return 2===mn().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",o="outputColor",s="out vec4 outputColor;",i="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",o="gl_FragColor",s="",i="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:o,defineOutput:s,defineSpecialNaN:i,defineSpecialInf:u,defineRound:l}}function Cs(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=an(t);return r.map((function(t,a){return"".concat("int ".concat(e[a]," = ").concat(n," / ").concat(t),"; ",a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t),";")})).join("")}function As(e){var t=an(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}ks.registerFlag("HAS_WEBGL",(function(){return ks.getNumber("WEBGL_VERSION")>0})),ks.registerFlag("WEBGL_VERSION",(function(){return xs(2)?2:xs(1)?1:0})),ks.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),ks.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===ks.get("WEBGL_VERSION")})),ks.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),ks.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),ks.registerFlag("WEBGL_PACK",(function(){return ks.getBool("HAS_WEBGL")})),ks.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return ks.getBool("WEBGL_PACK")})),ks.registerFlag("WEBGL_PACK_CLIP",(function(){return ks.getBool("WEBGL_PACK")})),ks.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),ks.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return ks.getBool("WEBGL_PACK")})),ks.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return ks.getBool("WEBGL_PACK")})),ks.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return ks.getBool("WEBGL_PACK")})),ks.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return ks.getBool("WEBGL_PACK")})),ks.registerFlag("WEBGL_PACK_REDUCE",(function(){return ks.getBool("WEBGL_PACK")})),ks.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return ks.getBool("WEBGL_PACK")})),ks.registerFlag("WEBGL_CONV_IM2COL",(function(){return ks.getBool("WEBGL_PACK")})),ks.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==ms){var t=zo(e);ms=t.getParameter(t.MAX_TEXTURE_SIZE)}return ms}(ks.getNumber("WEBGL_VERSION"))})),ks.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==gs){var t=zo(e);gs=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,gs)}(ks.getNumber("WEBGL_VERSION"))})),ks.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=ks.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var n=zo(e);return bs(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:bs(n,"EXT_disjoint_timer_query")?1:0}(e)})),ks.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return ks.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!ir()})),ks.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=zo(e);if(1===e){if(!bs(t,"OES_texture_float"))return!1}else if(!bs(t,"EXT_color_buffer_float"))return!1;return ys(t)}(ks.getNumber("WEBGL_VERSION"))})),ks.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!ks.getBool("WEBGL_FORCE_F16_TEXTURES")&&ks.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),ks.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return vs(ks.getNumber("WEBGL_VERSION"))})),ks.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=ks.getNumber("WEBGL_VERSION"))&&null!=zo(e).fenceSync;var e})),ks.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return ks.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),ks.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))})),ks.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return ir()&&ks.getBool("IS_CHROME")?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))}));var Es="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",_s=function _s(e){_classCallCheck(this,_s),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ho.DENSE;var t=Qo(e),n=Is();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(Cs(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(t[0],", ").concat(t[1],"));\n        int index = 4 * (resTexRC.x * ").concat(t[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},$s=function $s(e){_classCallCheck(this,$s),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ho.DENSE;var t=Qo(e),n=Is();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(Cs(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(t[0],", ").concat(t[1],"));\n        int index = 4 * (resTexRC.x * ").concat(t[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},Ns=function Ns(e){_classCallCheck(this,Ns),this.variableNames=["A"],this.outTexUsage=jo.DOWNLOAD;var t=Is();this.outputShape=e,this.userCode="\n      ".concat(Es,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(t.output," = encode_float(x);\n      }\n    ")},Ss=function Ss(e){_classCallCheck(this,Ss),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=jo.DOWNLOAD;var t=Is();this.outputShape=e,this.userCode="\n      ".concat(Es,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(t.output," = encode_float(x);\n      }\n    ")},Rs=function Rs(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,Rs),this.variableNames=["A"];var r=Is(),_t62=_slicedToArray(t,2),a=_t62[0],o=_t62[1];this.outputShape=e;var s="result";n&&(s="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(As(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ").concat(o,";\n        int c = imod(flatIndex, ").concat(o,");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(").concat(o,".0, ").concat(a,".0);\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(r.output," = vec4(").concat(s,", 0., 0., 0.);\n      }\n    ")},Ts=function Ts(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,Ts),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Is(),_t63=_slicedToArray(t,2),a=_t63[0],o=_t63[1];this.outputShape=e;var s="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var _t64=0;_t64<=1;_t64++)for(var _n39=0;_n39<=1;_n39++){var _i12=2*_t64+_n39;s+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(_n39," < ").concat(e[2],") {\n            localCoords[2] += ").concat(_n39,";\n            if(localCoords[1] + ").concat(_t64," < ").concat(e[1],") {\n              localCoords[1] += ").concat(_t64,";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ").concat(o,";\n              c = imod(flatIndex, ").concat(o,");\n              uv = (vec2(c, r) + halfCR) / vec2(").concat(o,".0, ").concat(a,".0);\n              values = ").concat(r.texture2D,"(A, uv);\n\n              if(offset == 0) {\n                result[").concat(_i12,"] = values[0];\n              } else if(offset == 1) {\n                result[").concat(_i12,"] = values[1];\n              } else if(offset == 2) {\n                result[").concat(_i12,"] = values[2];\n              } else {\n                result[").concat(_i12,"] = values[3];\n              }\n            }\n          }\n        ")}this.userCode="\n      ".concat(As(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ").concat(s,"\n\n        ").concat(r.output," = ").concat(i,";\n      }\n    ")};function Fs(e){var t=Is();return function(e,t){var n=ls(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Zo(e,(function(){return e.shaderSource(n,t)})),Zo(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function Ms(e){return function(e,t){var n=ls(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Zo(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),Zo(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Os(e){return function(e,t){var n=ls(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Zo(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),Zo(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function Ds(e,t,n,r,a,o){!function(e,t){var n=mn().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] is invalid."));if(e>n||t>n)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] greater than WebGL maximum on this browser / GPU [").concat(n,"x").concat(n,"]."))}(t,n);var s=function(e){return ls(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),i=e.TEXTURE_2D;return Zo(e,(function(){return e.bindTexture(i,s)})),Zo(e,(function(){return e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Zo(e,(function(){return e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Zo(e,(function(){return e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Zo(e,(function(){return e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST)})),Zo(e,(function(){return e.texImage2D(i,0,r,t,n,0,a,o,null)})),Zo(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function Bs(e){return e.internalFormatFloat}function Ls(e){return e.internalFormatHalfFloat}function Ps(e){return e.downloadTextureFormat}function Ws(e){return e.internalFormatPackedFloat}function Us(e){return e.internalFormatPackedHalfFloat}function Vs(e,t,n,r,a,o,s,i){var u=e,l=new Float32Array(function(e,t){var _Ko2=_slicedToArray(Ko(e,t),2);return _Ko2[0]*_Ko2[1]*4}(o,s));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}var Gs=function(){function Gs(e){_classCallCheck(this,Gs),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=mn().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){Vo[e]=t}(t,e)):this.gl=zo(t);var n="WEBGL_color_buffer_float",r="EXT_color_buffer_half_float";if(1===mn().getNumber("WEBGL_VERSION")){var _t65="OES_texture_half_float";if(this.textureFloatExtension=es(this.gl,"OES_texture_float"),bs(this.gl,_t65))this.textureHalfFloatExtension=es(this.gl,_t65);else if(mn().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),bs(this.gl,r))this.colorBufferHalfFloatExtension=es(this.gl,r);else if(mn().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",bs(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!bs(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=Ms(this.gl),this.indexBuffer=Os(this.gl),this.framebuffer=function(e){return ls(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=Yo(this.gl,this.textureHalfFloatExtension)}var _waitForQueryAndGetTime;return _createClass(Gs,[{key:"dispose",value:function dispose(){var _this26=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Zo(e,(function(){return e.finish()})),Zo(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),Zo(e,(function(){return e.deleteFramebuffer(_this26.framebuffer)})),Zo(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,null)})),Zo(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)})),Zo(e,(function(){return e.deleteBuffer(_this26.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){var _qo2=_slicedToArray(qo(t,n),2);return Ds(e,_qo2[0],_qo2[1],Bs(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){var _qo4=_slicedToArray(qo(t,n),2);return Ds(e,_qo4[0],_qo4[1],Ls(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){var _qo6=_slicedToArray(qo(t,n),2);return Ds(e,_qo6[0],_qo6[1],Ps(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){Zo(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?Zo(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):Zo(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),Zo(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,o){var s,i,u;Zo(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(s=new Uint8Array(n*r*4),i=e.UNSIGNED_BYTE,u=e.RGBA):(s=new Float32Array(n*r*4),i=e.FLOAT,u=o.internalFormatPackedFloat),s.set(a),Zo(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,i,s)})),Zo(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){var _Ko4=_slicedToArray(Ko(t,n),2);return Ds(e,_Ko4[0],_Ko4[1],Us(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){var _Ko6=_slicedToArray(Ko(t,n),2);return Ds(e,_Ko6[0],_Ko6[1],Ws(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function deleteMatrixTexture(e){var _this27=this;this.throwIfDisposed(),this.outputTexture===e&&(is(this.gl,this.framebuffer),this.outputTexture=null),Zo(this.gl,(function(){return _this27.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){var _this28=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var _qo8=_slicedToArray(qo(t,n),2),a=_qo8[0],o=_qo8[1],s=new Uint8Array(t*n*4);return Zo(e,(function(){return e.readPixels(0,0,a,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}(_this28.gl,t,n,_this28.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function downloadPackedMatrixFromBuffer(e,t,n,r,a,o){return Vs(this.gl,e,0,0,0,a,o,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();Zo(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var o=16*t*n;return Zo(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),Zo(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),Zo(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function createAndWaitForFence(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function createFence(e){var t,n,_this29=this;if(mn().getBool("WEBGL_FENCE_API_ENABLED")){var _r44=e,_a34=_r44.fenceSync(_r44.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function n(){var e=_r44.clientWaitSync(_a34,0,0);return e===_r44.ALREADY_SIGNALED||e===_r44.CONDITION_SATISFIED},t=_a34}else mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function n(){return _this29.isQueryAvailable(t,mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function n(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function downloadMatrixFromPackedTexture(e,t,n){var _this30=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return Zo(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(_this30.gl,t,n)}))}},{key:"createProgram",value:function createProgram(e){this.throwIfDisposed();var t=this.gl,n=ts(t,e),r=Fs(t),a=function(e){return ls(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(t);return Zo(t,(function(){return t.attachShader(a,r)})),Zo(t,(function(){return t.attachShader(a,n)})),function(e,t){if(Zo(e,(function(){return e.linkProgram(t)})),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,a),this.debug&&rs(t,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=function(e,t,n){return Zo(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),as(e,t,"clipSpacePos",n,3,20,0)&&as(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),a}},{key:"deleteProgram",value:function deleteProgram(e){var _this31=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Zo(this.gl,(function(){return _this31.gl.deleteProgram(e)}))}},{key:"setProgram",value:function setProgram(e){var _this32=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&rs(this.gl,this.program),Zo(this.gl,(function(){return _this32.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function getUniformLocation(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return ls(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function getAttributeLocation(e,t){var _this33=this;return this.throwIfDisposed(),Zo(this.gl,(function(){return _this33.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){Zo(e,(function(){return os(e,t,r)})),Zo(e,(function(){return e.uniform1i(n,r)}))}(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();var _Ko8=_slicedToArray(Ko(t,n),2),r=_Ko8[0],a=_Ko8[1];this.setOutputMatrixTextureDriver(e,r,a)}},{key:"setOutputMatrixWriteRegion",value:function setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function debugValidate(){null!=this.program&&rs(this.gl,this.program),us(this.gl)}},{key:"executeProgram",value:function executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Zo(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function blockUntilAllProgramsCompleted(){var _this34=this;this.throwIfDisposed(),Zo(this.gl,(function(){return _this34.gl.finish()}))}},{key:"getQueryTimerExtension",value:function getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=es(this.gl,2===mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function beginQuery(){if(2===mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var _e62=this.gl,_t66=this.getQueryTimerExtensionWebGL2(),_n40=_e62.createQuery();return _e62.beginQuery(_t66.TIME_ELAPSED_EXT,_n40),_n40}var e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}},{key:"endQuery",value:function endQuery(){if(2!==mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var _e63=this.gl,t=this.getQueryTimerExtensionWebGL2();_e63.endQuery(t.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:(_waitForQueryAndGetTime=_asyncToGenerator(regeneratorRuntime.mark((function _callee18(e){var _this35=this;return regeneratorRuntime.wrap((function _callee18$(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return _context18.next=2,Ht((function(){return _this35.disposed||_this35.isQueryAvailable(e,mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return _context18.abrupt("return",this.getQueryTime(e,mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return _context18.stop()}}),_callee18,this)}))),function waitForQueryAndGetTime(_x13){return _waitForQueryAndGetTime.apply(this,arguments)})},{key:"getQueryTime",value:function getQueryTime(e,t){if(0===t)return null;if(2===t){var _t67=this.gl;return _t67.getQueryParameter(e,_t67.QUERY_RESULT)/1e6}var _t68=this.getQueryTimerExtensionWebGL1();return _t68.getQueryObjectEXT(e,_t68.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function isQueryAvailable(e,t){if(0===t)return!0;if(2===t){var _t69=this.gl,_n41=this.getQueryTimerExtensionWebGL2(),_r45=_t69.getQueryParameter(e,_t69.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(_n41.GPU_DISJOINT_EXT)),_r45&&!this.disjoint}var _t70=this.getQueryTimerExtensionWebGL1(),_n42=_t70.getQueryObjectEXT(e,_t70.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(_t70.GPU_DISJOINT_EXT)),_n42&&!this.disjoint}},{key:"pollFence",value:function pollFence(e){var _this36=this;return new Promise((function(t){_this36.addItemToPoll((function(){return e.isFencePassed()}),(function(){return t()}))}))}},{key:"pollItems",value:function pollItems(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function addItemToPoll(e,t){var _this37=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Ht((function(){return _this37.pollItems(),0===_this37.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function bindTextureToFrameBuffer(e){this.throwIfDisposed(),ss(this.gl,e,this.framebuffer),this.debug&&us(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function unbindTextureToFrameBuffer(){null!=this.outputTexture?(ss(this.gl,this.outputTexture,this.framebuffer),this.debug&&us(this.gl)):is(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();var r=this.gl;ss(r,e,this.framebuffer),this.debug&&us(r),this.outputTexture=e,Zo(r,(function(){return r.viewport(0,0,t,n)})),Zo(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function setOutputMatrixWriteRegionDriver(e,t,n,r){var _this38=this;this.throwIfDisposed(),Zo(this.gl,(function(){return _this38.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}},{key:"debug",get:function get(){return mn().getBool("DEBUG")}}]),Gs}(),zs=Uo.getBroadcastDims;function Hs(e,t,n,r){var a=[];e.forEach((function(e){var t=Wt(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(a.push("uniform sampler2D ".concat(e.name,";")),a.push("uniform int offset".concat(e.name,";")))}));var c,d,o=a.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="";r+=n?Xs(e):js(e);var a=e.shapeInfo.logicalShape,o=t.logicalShape;return a.length<=o.length&&(r+=n?function(e,t){var c,n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,i=zs(e.shapeInfo.logicalShape,t.logicalShape),u=ti(s),l=s-o,d=["x","y","z","w","u","v"];c=0===o?"":s<2&&i.length>=1?"coords = 0;":i.map((function(e){return"coords.".concat(d[e+l]," = 0;")})).join("\n");var p;p=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+l])})).join(", ");var h="return outputValue;",f=1===Wt(e.shapeInfo.logicalShape),m=1===Wt(t.logicalShape);if(1!==o||f||m){if(f&&!m)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(i.length){var _e65=o-2,_t71=o-1;i.indexOf(_e65)>-1&&i.indexOf(_t71)>-1?h="return vec4(outputValue.x);":i.indexOf(_e65)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":i.indexOf(_t71)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(a,"() {\n      ").concat(u," coords = getOutputCoords();\n      ").concat(c,"\n      vec4 outputValue = get").concat(r,"(").concat(p,");\n      ").concat(h,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",o=t.texShape,s=e.shapeInfo.texShape,i=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&i===u&&null==e.shapeInfo.flatOffset&&Ut(s,o))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var p,l=ti(u),c=zs(e.shapeInfo.logicalShape,t.logicalShape),d=u-i,h=["x","y","z","w","u","v"];p=0===i?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords.".concat(h[e+d]," = 0;")})).join("\n");var f;return f=u<2&&i>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(h[t+d])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(p,"\n      return get").concat(r,"(").concat(f,");\n    }\n  ")}(e,t)),r}(e,t,r)})).join("\n"),i=t.texShape,u=Is(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(u),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(qs,"\n    ").concat(Qs,"\n    ").concat(Ks,"\n  ")}(u);return t.isPacked?(c=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(n[1],".0);\n      }\n    "):1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(n[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return 2 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n    }\n  ")}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Ut(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(n[0],", ").concat(n[1],"));\n      }\n    ");var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),a=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),o=a,s="",i="b, r, c",_t72=2;_t72<e.length-1;_t72++)o*=e[e.length-_t72-1],s="\n      int b".concat(_t72," = index / ").concat(o,";\n      index -= b").concat(_t72," * ").concat(o,";\n    ")+s,i="b".concat(_t72,", ")+i;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(i,");\n    }\n  ")}(e,t)}}(t.logicalShape,i),d=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(u)):(c=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t);case 2:return function(e,t){return Ut(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=Cs(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t);case 4:return function(e,t){var n=Cs(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t);case 5:return function(e,t){var n=Cs(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=Cs(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,i),d=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(u)),r&&(p+=Ys),[p,l,d,o,c,s,n].join("\n")}function js(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var _e$shapeInfo$texShape=_slicedToArray(e.shapeInfo.texShape,2),r=_e$shapeInfo$texShape[0],a=_e$shapeInfo$texShape[1];if(1===r&&1===a)return"\n      float ".concat(n,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var _e$shapeInfo$texShape2=_slicedToArray(e.shapeInfo.texShape,2),o=_e$shapeInfo$texShape2[0],s=_e$shapeInfo$texShape2[1],i=Js(t);return"\n    float ".concat(n,"() {\n      vec2 uv = uvFromFlat(").concat(o,", ").concat(s,", ").concat(i,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(n,"(int index) {\n        ").concat(ei(e),"\n      }\n    ");var r=e.shapeInfo.texShape,a=r[0],o=r[1];if(1===o&&1===a)return"\n      float ".concat(n,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var s=Js(t);return 1===o?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(a,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):1===a?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):"\n    float ".concat(n,"(int index) {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&Ut(t,a)){var _e66=a[0];return"\n    float ".concat(r,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(a[1],".0, ").concat(_e66,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}var _qt=qt(t),o=_qt.newShape,s=_qt.keptDims,i=o;if(i.length<t.length){return"\n      ".concat(js(ni(e,i)),"\n      float ").concat(r,"(int row, int col) {\n        return ").concat(r,"(").concat(ri(["row","col"],s),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(t[1],", 1)));\n        ").concat(ei(e),"\n      }\n    ");var u=a[0],l=a[1],c=Js(n);return 1===l?"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(c,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(u,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):1===u?"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(c,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(l,".0, 0.5);\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n  float ".concat(r,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(t[1]," + col + ").concat(c,";\n    vec2 uv = uvFromFlat(").concat(u,", ").concat(l,", index);\n    return sampleTexture(").concat(n,", uv);\n  }\n")}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[1]*t[2],o=t[2],_qt2=qt(t),s=_qt2.newShape,i=_qt2.keptDims,u=s;if(u.length<t.length){return"\n        ".concat(js(ni(e,u)),"\n        float ").concat(r,"(int row, int col, int depth) {\n          return ").concat(r,"(").concat(ri(["row","col","depth"],i),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(a,", ").concat(o,", 1)));\n        ").concat(ei(e),"\n      }\n    ");var l=e.shapeInfo.texShape,c=l[0],d=l[1],p=e.shapeInfo.flatOffset;if(d===a&&null==p)return"\n        float ".concat(r,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(d,".0, ").concat(c,".0);\n          return sampleTexture(").concat(n,", uv);\n        }\n      ");if(d===o&&null==p)return"\n    float ".concat(r,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(t[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(d,".0, ").concat(c,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var h=Js(n);return"\n      float ".concat(r,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(a," + col * ").concat(o," + depth + ").concat(h,";\n        vec2 uv = uvFromFlat(").concat(c,", ").concat(d,", index);\n        return sampleTexture(").concat(n,", uv);\n      }\n  ")}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[3],o=t[2]*a,s=t[1]*o,_qt3=qt(t),i=_qt3.newShape,u=_qt3.keptDims;if(i.length<t.length){return"\n      ".concat(js(ni(e,i)),"\n      float ").concat(r,"(int row, int col, int depth, int depth2) {\n        return ").concat(r,"(").concat(ri(["row","col","depth","depth2"],u),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(a,", 1)));\n        ").concat(ei(e),"\n      }\n    ");var l=e.shapeInfo.flatOffset,c=e.shapeInfo.texShape,d=c[0],p=c[1];if(p===s&&null==l)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(p,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(p===a&&null==l)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(t[1]*t[2],", ").concat(t[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(p,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var h=Js(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(a," + depth2;\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index + ").concat(h,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],o=t[3]*a,s=t[2]*o,i=t[1]*s,_qt4=qt(t),u=_qt4.newShape,l=_qt4.keptDims;if(u.length<t.length){return"\n      ".concat(js(ni(e,u)),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(ri(["row","col","depth","depth2","depth3"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(i,", ").concat(s,", ").concat(o,", ").concat(a,")) +\n          depth3;\n        ").concat(ei(e),"\n      }\n    ");var c=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],h=d[1];if(h===i&&null==c)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(s,", ").concat(o,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(h,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(h===a&&null==c)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(h,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var f=Js(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(i," + col * ").concat(s," + depth * ").concat(o," +\n          depth2 * ").concat(a," + depth3 + ").concat(f,";\n      vec2 uv = uvFromFlat(").concat(p,", ").concat(h,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),_qt5=qt(t),a=_qt5.newShape,o=_qt5.keptDims;if(a.length<t.length){return"\n      ".concat(js(ni(e,a)),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(ri(["row","col","depth","depth2","depth3","depth4"],o),");\n      }\n    ")}var s=t[5],i=t[4]*s,u=t[3]*i,l=t[2]*u,c=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(c,", ").concat(l,", ").concat(u,", ").concat(i,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(s,", 1)));\n        ").concat(ei(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,h=p[0],f=p[1];if(f===c&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(l,", ").concat(u,", ").concat(i,", ").concat(s,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(f,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(f===s&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(f,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var m=Js(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(c," + col * ").concat(l," + depth * ").concat(u," +\n          depth2 * ").concat(i," + depth3 * ").concat(s," + depth4 + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(h,", ").concat(f,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(t.length,"-D input sampling is not yet supported"))}}function Xs(e){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Is();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=Is();return"\n    vec4 ".concat(n,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(a[0],", ").concat(a[1],", index);\n      return ").concat(o.texture2D,"(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,o=a[0],s=a[1],i=Is();if(null!=a&&Ut(t,a))return"\n      vec4 ".concat(r,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(i.texture2D,"(").concat(n,", uv);\n      }\n    ");var u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=Math.ceil(t[1]/2);return"\n    vec4 ".concat(r,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(u[0],", ").concat(u[1],", row, col);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===t[0]){return"\n        ".concat(Xs(ni(e,t.slice(1))),"\n        vec4 ").concat(r,"(int b, int row, int col) {\n          return ").concat(r,"(").concat(ri(["b","row","col"],[1,2]),");\n        }\n      ")}var s=o[0],i=o[1],u=Math.ceil(t[2]/2),l=u*Math.ceil(t[1]/2),c=Is();return"\n    vec4 ".concat(r,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(s,", ").concat(i,", ").concat(l,", ").concat(u,", b, row, col);\n      return ").concat(c.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape,s=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],i=s[0],u=s[1],l=Math.ceil(t[n-1]/2),c=l*Math.ceil(t[n-2]/2),d="int b, int row, int col",p="b * ".concat(c," + (row / 2) * ").concat(l," + (col / 2)"),_e67=2;_e67<n-1;_e67++)d="int b".concat(_e67,", ")+d,c*=t[n-_e67-1],p="b".concat(_e67," * ").concat(c," + ")+p;var h=Is();return"\n    vec4 ".concat(a,"(").concat(d,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(i,");\n      return ").concat(h.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e)}}var qs="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Qs="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ks="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ys="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Js(e){return"offset".concat(e)}function ei(e){var t=e.name,n=Wt(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function ti(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function ni(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function ri(e,t){return t.map((function(t){return e[t]})).join(", ")}function ai(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],o=a.shape;if(!Ut(r,o))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(o," must match"));if(!e.isUniform||!a.isUniform){var s=e.texShape,i=a.isUniform?null:a.texData.texShape;if(!Ut(s,i))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(s," and ").concat(i," must match"))}}))}function oi(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Bt("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}function si(e){for(var t=new Float32Array(e.length),_n44=0;_n44<e.length;++_n44)t[_n44]=Math.abs(e[_n44]);return t}var ii={kernelName:"Abs",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs.x,n=e.backend;oi(t,"abs");var r=new Float32Array(Wt(t.shape));return r=si(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,"float32")}};function ui(e){return function(t,n,r,a,o){var s=Ta(t,n),i=s.length,u=an(s),l=Qt(o,Wt(s)),c=t.length,d=n.length,p=an(t),h=an(n),f=Sa(t,s),m=Sa(n,s);if(f.length+m.length===0)for(var _t78=0;_t78<l.length;++_t78)l[_t78]=e(r[_t78%r.length],a[_t78%a.length]);else for(var _loop5=function _loop5(_t79){var n=pn(_t79,i,u),o=n.slice(-c);f.forEach((function(e){return o[e]=0}));var s=dn(o,c,p),g=n.slice(-d);m.forEach((function(e){return g[e]=0}));var b=dn(g,d,h);l[_t79]=e(r[s],a[b])},_t79=0;_t79<l.length;++_t79)_loop5(_t79);return[l,s]}}function li(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,i=n.makeTensorInfo(r.shape,"complex64");return n.data.get(i.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",o),imag:n.makeTensorInfo(a.shape,"float32",s)},i}var ci={kernelName:"Complex",backendName:"cpu",kernelFunc:li};function di(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return li({inputs:{real:di(e,t,"float32"),imag:di(e,t,"float32")},backend:e});var r=un(Wt(t),n);return e.makeTensorInfo(t,n,r)}function pi(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var hi={kernelName:"Identity",backendName:"cpu",kernelFunc:pi};function fi(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,o=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,o)}var mi={kernelName:"Real",backendName:"cpu",kernelFunc:fi};function gi(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.dtype;if("complex64"===o){if("complex64"===a.dtype)return pi({inputs:{x:a},backend:n});var _e68=di(n,a.shape,a.dtype),_t80=gi({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),_r46=li({inputs:{real:_t80,imag:_e68},backend:n});return n.disposeIntermediateTensorInfo(_e68),n.disposeIntermediateTensorInfo(_t80),_r46}if("complex64"===a.dtype){var _e69=fi({inputs:{input:a},backend:n}),_t81=gi({inputs:{x:_e69},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(_e69),_t81}if(!Yt(a.dtype,o)){var _e70=pi({inputs:{x:a},backend:n});return{dataId:_e70.dataId,shape:_e70.shape,dtype:o}}if("int32"===o){var _e71=n.data.get(a.dataId).values,_t82=Int32Array.from(_e71);return n.makeTensorInfo(a.shape,"int32",_t82)}if("bool"===o){var _e72=n.data.get(a.dataId).values,_t83=$n([0],a.dtype),_ui2=_slicedToArray(ui((function(e,t){return e!==t?1:0}))(a.shape,[],_e72,_t83,"bool"),2),_r47=_ui2[0],_o23=_ui2[1];return n.makeTensorInfo(_o23,"bool",_r47)}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(o))}var bi={kernelName:"Cast",backendName:"cpu",kernelFunc:gi};function xi(e,t,n,r){return null==n?function(_ref9){var n=_ref9.inputs,a=_ref9.backend,o=n.a,s=n.b,i=a;oi([o,s],e);var u=i.data.get(o.dataId).values,l=i.data.get(s.dataId).values,c=r||o.dtype,_t85=_slicedToArray(t(o.shape,s.shape,u,l,c),2),d=_t85[0],p=_t85[1];return i.makeTensorInfo(p,c,d)}:function(_ref10){var e=_ref10.inputs,a=_ref10.backend,o=e.a,s=e.b,i=a;if("complex64"===o.dtype||"complex64"===s.dtype){var _e73=gi({inputs:{x:o},backend:i,attrs:{dtype:"complex64"}}),_t86=i.data.get(_e73.dataId),_r48=_t86.complexTensorInfos.real,_a36=_t86.complexTensorInfos.imag,_u7=i.data.get(_r48.dataId).values,_l3=i.data.get(_a36.dataId).values,_c3=gi({inputs:{x:s},backend:i,attrs:{dtype:"complex64"}}),_d2=i.data.get(_c3.dataId),_p4=_d2.complexTensorInfos.real,_h4=_d2.complexTensorInfos.imag,_f3=i.data.get(_p4.dataId).values,_m4=i.data.get(_h4.dataId).values,_n46=_slicedToArray(n(o.shape,s.shape,_u7,_l3,_f3,_m4),3),_g3=_n46[0],_b3=_n46[1],_x14=_n46[2],_v3=i.makeTensorInfo(_x14,"float32",_g3),_y3=i.makeTensorInfo(_x14,"float32",_b3),_w=li({inputs:{real:_v3,imag:_y3},backend:i});return i.disposeIntermediateTensorInfo(_e73),i.disposeIntermediateTensorInfo(_c3),i.disposeIntermediateTensorInfo(_v3),i.disposeIntermediateTensorInfo(_y3),_w}var _e74=i.data.get(o.dataId).values,_n47=i.data.get(s.dataId).values,_a37=r||o.dtype,_t88=_slicedToArray(t(o.shape,s.shape,_e74,_n47,_a37),2),_u8=_t88[0],_l4=_t88[1];return i.makeTensorInfo(_l4,_a37,_u8)}}function vi(e){return function(t,n,r,a,o,s){var i=Ta(t,n),u=Wt(i),l=i.length,c=an(i),d=Qt("float32",u),p=Qt("float32",u),h=Sa(t,i),f=Sa(n,i),m=Eo(r,a),g=Eo(o,s),b=t.length,x=an(t),v=n.length,y=an(n);if(h.length+f.length===0)for(var _t89=0;_t89<d.length;_t89++){var _n48=_t89%m.length,_r49=_t89%g.length,_a38=e(m[2*_n48],m[2*_n48+1],g[2*_r49],g[2*_r49+1]);d[_t89]=_a38.real,p[_t89]=_a38.imag}else for(var _loop6=function _loop6(_t90){var n=pn(_t90,l,c),r=n.slice(-b);h.forEach((function(e){return r[e]=0}));var a=dn(r,b,x),o=n.slice(-v);f.forEach((function(e){return o[e]=0}));var s=dn(o,v,y),i=e(m[2*a],m[2*a+1],g[2*s],g[2*s+1]);d[_t90]=i.real,p[_t90]=i.imag},_t90=0;_t90<d.length;_t90++)_loop6(_t90);return[d,p,i]}}var yi=ui((function(e,t){return e+t})),wi=xi("Add",yi,vi((function(e,t,n,r){return{real:e+n,imag:t+r}}))),ki={kernelName:"Add",backendName:"cpu",kernelFunc:wi};function Ii(e,t,n,r,a){for(var o=Wt(r),s=un(a,n),_n49=0;_n49<e.length;_n49++){var _r50=e[_n49];if(_r50<0)throw new Error("Input x must be non-negative!");_r50>=a||(s[_r50]+=o>0?t[_n49]:1)}return s}function Ci(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],o=e.shape[1],s=Ur([a,n],t.dtype),_i13=0;_i13<a;_i13++)for(var _a39=0;_a39<o;_a39++){var _o24=e.get(_i13,_a39);if(_o24<0)throw new Error("Input x must be non-negative!");_o24>=n||(r?s.set(1,_i13,_o24):t.size>0?s.set(s.get(_i13,_o24)+t.get(_i13,_a39),_i13,_o24):s.set(s.get(_i13,_o24)+1,_i13,_o24))}return s}function Ai(e){return function(t,n,r){for(var a=Qt(n,t.length),_n50=0;_n50<t.length;++_n50)a[_n50]=e(t[_n50],r);return a}}function Ei(e,t,n){return function(_ref11){var r=_ref11.inputs,a=_ref11.attrs,o=_ref11.backend,s=r.x;if(oi(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var i=o,u=i.data.get(s.dataId).values,l=Wt(s.shape),c=n||s.dtype,d=Kt(c,l),_e75=0;_e75<l;++_e75)d[_e75]=t(u[_e75],a);return i.makeTensorInfo(s.shape,c,d)}}function _i(e,t,n){return function(_ref12){var r=_ref12.inputs,a=_ref12.attrs,o=_ref12.backend,s=r.x;if(oi(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var i=o,u=i.data.get(s.dataId).values,l=n||s.dtype,c=t(u,l,a);return i.makeTensorInfo(s.shape,l,c)}}var $i=Ai((function(e){return Math.ceil(e)})),Ni={kernelName:"Ceil",backendName:"cpu",kernelFunc:_i("Ceil",$i)};function Si(e,t,n,r){var a=Kt(n,Wt(t));if(r&&"string"!==n){var _t91=0;e.forEach((function(e){var n=Wt(e.shape);a.set(e.vals,_t91),_t91+=n}))}else{var _r51=0;e.forEach((function(e){for(var o="string"===n?Po(e.vals):e.vals,s=0,_n51=0;_n51<e.shape[0];++_n51)for(var _i14=_n51*t[1]+_r51,_t92=0;_t92<e.shape[1];++_t92)a[_i14+_t92]=o[s++];_r51+=e.shape[1]}))}return a}var Ri=Ai((function(e){return Math.exp(e)})),Ti=_i("Exp",Ri),Fi={kernelName:"Exp",backendName:"cpu",kernelFunc:Ti},Mi=Ai((function(e){return Math.expm1(e)})),Oi={kernelName:"Expm1",backendName:"cpu",kernelFunc:_i("Expm1",Mi)},Di=Ai((function(e){return Math.floor(e)})),Bi={kernelName:"Floor",backendName:"cpu",kernelFunc:_i("Floor",Di)};function Li(e,t,n){for(var r=Ur(n,e.dtype),_n52=0;_n52<r.size;++_n52){var _a40=r.indexToLoc(_n52).slice(),_o25=_a40[0],_s15=_a40[2],_i15=t.locToIndex([_o25,_s15]);_a40[2]=t.values[_i15];var _u9=e.locToIndex(_a40);r.values[_n52]=e.values[_u9]}return r}var Pi=ui((function(e,t){return e>t?1:0})),Wi={kernelName:"Greater",backendName:"cpu",kernelFunc:xi("Greater",Pi,null,"bool")},Ui=ui((function(e,t){return e<t?1:0})),Vi={kernelName:"Less",backendName:"cpu",kernelFunc:xi("Less",Ui,null,"bool")};function Gi(e,t,n){var r=(t-e)/(n-1),a=un(n,"float32");a[0]=e;for(var _e76=1;_e76<a.length;_e76++)a[_e76]=a[_e76-1]+r;return a}var zi=Ai((function(e){return Math.log(e)})),Hi={kernelName:"Log",backendName:"cpu",kernelFunc:_i("Log",zi)};function ji(e,t,n,r){for(var a=Qt(r,Wt(n)),_n53=0;_n53<a.length;++_n53){for(var _r52=_n53*t,_o26=e[_r52],_n54=0;_n54<t;++_n54){var _t93=e[_r52+_n54];_t93>_o26&&(_o26=_t93)}a[_n53]=_o26}return a}var Xi=ui((function(e,t){return Math.max(e,t)})),qi={kernelName:"Maximum",backendName:"cpu",kernelFunc:xi("Maximum",Xi)},Qi=ui((function(e,t){return Math.min(e,t)})),Ki={kernelName:"Minimum",backendName:"cpu",kernelFunc:xi("Minimum",Qi)},Yi=ui((function(e,t){return e*t})),Zi=vi((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),Ji=xi("Multiply",Yi,Zi),eu={kernelName:"Multiply",backendName:"cpu",kernelFunc:Ji};function tu(e,t,n){var r=_n(-1,n);return Yi([],t,r,e,n)}var nu={kernelName:"Neg",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.x;oi(r,"neg");var _tu2=_slicedToArray(tu(n.data.get(r.dataId).values,r.shape,r.dtype),2),o=_tu2[0],s=_tu2[1];return n.makeTensorInfo(s,r.dtype,o)}},ru=ui((function(e,t){return e!==t?1:0})),au={kernelName:"NotEqual",backendName:"cpu",kernelFunc:xi("NotEqual",ru,null,"bool")};function ou(e,t,n,r,a){for(var o=t.length,s=Wt(t),i=an(t),u=an(a),l=Qt(n,Wt(a)),_t94=0;_t94<s;++_t94){for(var _n55=pn(_t94,o,i),_a41=new Array(_n55.length),_e77=0;_e77<_a41.length;_e77++)_a41[_e77]=_n55[r[_e77]];l[dn(_a41,o,u)]=e[_t94]}return l}function su(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=n.perm;oi(a,"transpose");for(var s=a.shape.length,i=new Array(s),_e78=0;_e78<i.length;_e78++)i[_e78]=a.shape[o[_e78]];var u=ou(r.data.get(a.dataId).values,a.shape,a.dtype,o,i);return{dataId:r.write(u,i,a.dtype),shape:i,dtype:a.dtype}}var iu={kernelName:"Transpose",backendName:"cpu",kernelFunc:su};function uu(e,t,n,r){for(var _La2=_slicedToArray(La(e,r),2),a=_La2[0],o=_La2[1],s=Yn(t,"int32"),i=un(Wt(a),s),u=Wt(o),_e79=0;_e79<i.length;++_e79){for(var _t95=_e79*u,_r53=1,_e80=0;_e80<u;++_e80)_r53*=n[_t95+_e80];i[_e79]=_r53}return{outVals:i,outShape:a,outDtype:s}}var lu={kernelName:"Prod",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;oi(a,"prod");var i=a.shape.length,u=Xt(o,a.shape),l=Ua(u,i),c=u,d=a,p=[];null!=l&&(d=su({inputs:{x:a},backend:n,attrs:{perm:l}}),p.push(d),c=Ga(c.length,i));var h=n.data.get(d.dataId).values,_uu=uu(d.shape,d.dtype,h,c),f=_uu.outVals,m=_uu.outShape,g=_uu.outDtype,b=m;return s&&(b=Pa(m,u)),p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(b,g,f)}};function cu(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return un(0,r);var a=un(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var _e81=1;_e81<a.length;_e81++)a[_e81]=a[_e81-1]+n;return a}var du=Ai((function(e){return 1/Math.sqrt(e)})),pu={kernelName:"Rsqrt",backendName:"cpu",kernelFunc:_i("Rsqrt",du)};function hu(e,t,n,r,a){var o=oa(r,t,n),s=Wt(n),i=an(r);if(o){var _n56=sa(t,i);return"string"===a?e.slice(_n56,_n56+s):e.subarray(_n56,_n56+s)}for(var u=Ur(r,a,"string"===a?Po(e):e),l=Ur(n,a),_e82=0;_e82<l.size;++_e82){var _n57=l.indexToLoc(_e82),_r54=_n57.map((function(e,n){return e+t[n]}));l.set.apply(l,[u.get.apply(u,_toConsumableArray(_r54))].concat(_toConsumableArray(_n57)))}return"string"===a?Wo(l.values):l.values}function fu(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.begin,s=r.size;oi(a,"slice");var _ia2=_slicedToArray(ia(a,o,s),2),i=_ia2[0],u=_ia2[1];Xr(a,i,u);var l=hu(n.data.get(a.dataId).values,i,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,l)}var mu={kernelName:"Slice",backendName:"cpu",kernelFunc:fu},gu=ui((function(e,t){var n=e-t;return n*n})),bu={kernelName:"SquaredDifference",backendName:"cpu",kernelFunc:xi("SquaredDifference",gu)};function xu(e,t,n,r){for(var a=Ur(e,t.dtype),_e83=0;_e83<a.size;_e83++){for(var _o27=a.indexToLoc(_e83),_s16=new Array(_o27.length),_e84=0;_e84<_s16.length;_e84++)_s16[_e84]=_o27[_e84]*n[_e84]+r[_e84];a.set.apply(a,[t.get.apply(t,_s16)].concat(_toConsumableArray(_o27)))}return a}var vu=ui((function(e,t){return e-t})),yu=xi("Sub",vu,vi((function(e,t,n,r){return{real:e-n,imag:t-r}}))),wu={kernelName:"Sub",backendName:"cpu",kernelFunc:yu};function ku(e,t){for(var n=new Array(e.rank),_r55=0;_r55<n.length;_r55++)n[_r55]=e.shape[_r55]*t[_r55];for(var r=Ur(n,e.dtype),_t96=0;_t96<r.values.length;++_t96){for(var _n58=r.indexToLoc(_t96),_a42=new Array(e.rank),_t97=0;_t97<_a42.length;_t97++)_a42[_t97]=_n58[_t97]%e.shape[_t97];var _o28=e.locToIndex(_a42);r.values[_t96]=e.values[_o28]}return r}function Iu(e,t,n,r,a){for(var o=t[t.length-1],s=e.length/o,i=o,u=Qt(n,s*r),l=Qt("int32",s*r),_t98=0;_t98<s;_t98++){for(var _n59=_t98*i,_a43=e.subarray(_n59,_n59+i),_o29=[],_e85=0;_e85<_a43.length;_e85++)_o29.push({value:_a43[_e85],index:_e85});_o29.sort((function(e,t){return t.value-e.value}));for(var _s17=_t98*r,_c4=u.subarray(_s17,_s17+r),_d3=l.subarray(_s17,_s17+r),_e86=0;_e86<r;_e86++)_c4[_e86]=_o29[_e86].value,_d3[_e86]=_o29[_e86].index}var c=t.slice();return c[c.length-1]=r,[Ur(c,n,u),Ur(c,"int32",l)]}function Cu(e,t,n,r){for(var a=Xt(t,n)[0],o=[1,n[0],1],_e87=0;_e87<a;_e87++)o[0]*=n[_e87];o[1]=n[a];for(var _e88=a+1;_e88<n.length;_e88++)o[2]*=n[_e88];for(var s={},i=new Int32Array(n[a]),u=new Wn(o,r,e),l=[],c=1===o[0]&&1===o[2],_t99=0;_t99<n[a];_t99++){var _n60=void 0;if(c)_n60=e[_t99].toString();else{for(var _e89=[],_n61=0;_n61<o[0];_n61++)for(var _r56=0;_r56<o[2];_r56++)_e89.push(u.get(_n61,_t99,_r56));_n60=_e89.join(",")}if(void 0!==s[_n60])i[_t99]=s[_n60];else{var _e90=Object.keys(s).length;s[_n60]=_e90,i[_t99]=_e90,l.push(_t99)}}var d=o.slice();d[1]=Object.keys(s).length;var p=new Wn(d,r);l.forEach((function(e,t){for(var _n62=0;_n62<o[0];_n62++)for(var _r57=0;_r57<o[2];_r57++)p.set(u.get(_n62,e,_r57),_n62,t,_r57)}));var h=n.slice();return h[a]=d[1],{outputValues:p.values,outputShape:h,indices:i}}var Au=Object.freeze({__proto__:null,simpleAbsImpl:si,addImpl:yi,bincountImpl:Ii,bincountReduceImpl:Ci,ceilImpl:$i,concatImpl:Si,expImpl:Ri,expm1Impl:Mi,floorImpl:Di,gatherV2Impl:Li,greaterImpl:Pi,lessImpl:Ui,linSpaceImpl:Gi,logImpl:zi,maxImpl:ji,maximumImpl:Xi,minimumImpl:Qi,multiplyImpl:Yi,negImpl:tu,notEqualImpl:ru,prodImpl:uu,rangeImpl:cu,rsqrtImpl:du,sliceImpl:hu,squaredDifferenceImpl:gu,stridedSliceImpl:xu,subImpl:vu,tileImpl:ku,topKImpl:Iu,transposeImpl:ou,uniqueImpl:Cu}),Eu=Au.addImpl,_u=Au.bincountImpl,$u=Au.bincountReduceImpl,Nu=Au.ceilImpl,Su=Au.concatImpl,Ru=Au.expImpl,Tu=Au.expm1Impl,Fu=Au.floorImpl,Mu=Au.gatherV2Impl,Ou=Au.greaterImpl,Du=Au.lessImpl,Bu=Au.linSpaceImpl,Lu=Au.logImpl,Pu=Au.maxImpl,Wu=Au.maximumImpl,Uu=Au.minimumImpl,Vu=Au.multiplyImpl,Gu=Au.negImpl,zu=Au.prodImpl,Hu=Au.rangeImpl,ju=Au.rsqrtImpl,Xu=Au.simpleAbsImpl,qu=Au.sliceImpl,Qu=Au.stridedSliceImpl,Ku=Au.subImpl,Yu=Au.tileImpl,Zu=Au.topKImpl,Ju=Au.transposeImpl,el=Au.uniqueImpl;function tl(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function nl(e,t){return 1===t?[e]:tl(e,t)}var rl=function rl(e){_classCallCheck(this,rl),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var _n63=nl("rc",t),_r58=ti(t),_a44=function(e,t,n){if(1===e)return"rc > ".concat(t[0]);for(var r="",_a45=e-2;_a45<e;_a45++)r+="".concat(n[_a45]," >= ").concat(t[_a45]),_a45<e-1&&(r+="||");return r}(t,e,_n63),_o30=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = ".concat(a[0],";\n    int c = ").concat(a[1],";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ").concat(t,";\n    bool rEdge = rp1 >= ").concat(n,";\n  ")}(t,e[e.length-1],e[e.length-2],_n63),_s18=function(e,t){var n=e.length,r=function(e,t){for(var n=[],_r59=0;_r59<=1;_r59++)for(var _a46=0;_a46<=1;_a46++){for(var _o31="".concat(0===_r59?"r":"rp1",", ").concat(0===_a46?"c":"cp1"),_n64=2;_n64<e;_n64++)_o31="".concat(t[t.length-1-_n64],",")+_o31;n.push(_o31)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= ".concat(e[0]," ? 0. : getA(rc + 1),\n            0, 0"):"getA(".concat(r[0],"),\n          cEdge ? 0. : getA(").concat(r[1],"),\n          rEdge ? 0. : getA(").concat(r[2],"),\n          rEdge || cEdge ? 0. : getA(").concat(r[3],")")}(e,_n63);this.userCode="\n        void main() {\n          ".concat(_r58," rc = getOutputCoords();\n\n          if(").concat(_a44,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(_o30,"\n\n            setOutput(vec4(").concat(_s18,"));\n          }\n        }\n      ")}},al=function al(e,t){_classCallCheck(this,al),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r,n="",_e91=0;_e91<4;_e91++){var _t100="thisRC = rc;";_e91%2==1&&(_t100+="thisRC.z += 1;"),_e91>1&&(_t100+="thisRC.y += 1;"),n+="\n        ".concat(_t100,"\n        ").concat(_e91>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(_e91,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(_e91>0?"}":"","\n      ")}this.userCode="\n      ".concat((r=t,"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(Cs(["r","c","d"],r),"\n      return ivec3(r, c, d);\n    }\n  ")),"\n      ").concat(As(e),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(e[1],";\n        int cols = ").concat(e[2],";\n\n        ").concat(n,"\n\n        setOutput(result);\n      }\n    ")},ol=function(){function ol(e){_classCallCheck(this,ol),this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return _createClass(ol,[{key:"acquireTexture",value:function acquireTexture(e,t,n){var r=il(t,n),a=ul(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var s,o=sl(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var _e92=this.freeTextures[a].shift();return this.usedTextures[a].push(_e92),_e92}return r===Xo.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Xo.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Xo.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Xo.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Xo.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(s),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),s}},{key:"releaseTexture",value:function releaseTexture(e,t,n,r){if(null!=this.freeTextures){var a=il(n,r),o=ul(t,a,r);o in this.freeTextures||(this.freeTextures[o]=[]);var s=sl(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),i=mn().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==i&&this._numBytesAllocated>i?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var u=this.usedTextures[o],l=u.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(l,1),this.log()}}},{key:"log",value:function log(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"getNumUsedTextures",value:function getNumUsedTextures(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function getNumFreeTextures(){return this.numFreeTextures}},{key:"dispose",value:function dispose(){var _this39=this;if(null!=this.freeTextures){for(var _e93 in this.freeTextures)this.freeTextures[_e93].forEach((function(e){_this39.gpgpu.deleteMatrixTexture(e)}));for(var _e94 in this.usedTextures)this.usedTextures[_e94].forEach((function(e){_this39.gpgpu.deleteMatrixTexture(e)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}},{key:"numBytesAllocated",get:function get(){return this._numBytesAllocated}},{key:"numBytesFree",get:function get(){return this._numBytesFree}}]),ol}();function sl(e,t,n,r,a){var s,o=function(e,t){switch(e){case Xo.PACKED_2X2_FLOAT32:return Ws(t);case Xo.PACKED_2X2_FLOAT16:return Us(t);case Xo.UNPACKED_FLOAT32:return Bs(t);case Xo.UNPACKED_FLOAT16:return Ls(t);case Xo.PACKED_4X1_UNSIGNED_BYTE:return Ps(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var _Ko10=_slicedToArray(Ko(e[0],e[1]),2);s=_Ko10[0]*_Ko10[1]}else{var _qo10=_slicedToArray(qo(e[0],e[1]),2);s=_qo10[0]*_qo10[1]}return s*function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;throw new Error("Unknown internal format ".concat(t))}(n,o)}function il(e,t){if(e===jo.UPLOAD)return Xo.PACKED_2X2_FLOAT32;if(e===jo.RENDER||null==e)return function(e){return mn().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Xo.PACKED_2X2_FLOAT32:Xo.UNPACKED_FLOAT32:e?Xo.PACKED_2X2_FLOAT16:Xo.UNPACKED_FLOAT16}(t);if(e===jo.DOWNLOAD||e===jo.PIXELS)return Xo.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function ul(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var ll=function ll(e,t){_classCallCheck(this,ll),this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},cl="return abs(x);",dl="return x;",pl=function pl(e,t){_classCallCheck(this,pl),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},hl=function hl(e){_classCallCheck(this,hl),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=nl("rc",t),r=ti(t),a=function(e,t){if(1===e)return"rc";for(var n="",_r60=0;_r60<e;_r60++)n+=t[_r60],_r60<e-1&&(n+=",");return n}(t,n),o=n.slice(-2),s=t<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(r," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(a,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")},fl=oo,ml={},gl=function(_Ft){_inherits(gl,_Ft);var _getQueryTime,_time2,_read,_super2=_createSuper(gl);function gl(e){var _this40,t;if(_classCallCheck(this,gl),(_this40=_super2.call(this)).pendingRead=new WeakMap,_this40.pendingDisposal=new WeakSet,_this40.dataRefCount=new WeakMap,_this40.numBytesInGPU=0,_this40.uploadWaitMs=0,_this40.downloadWaitMs=0,_this40.lastGlFlushTime=0,_this40.warnedAboutMemory=!1,_this40.warnedAboutCPUBackend=!1,_this40.pendingDeletes=0,_this40.disposed=!1,!mn().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var _e95=zo(mn().getNumber("WEBGL_VERSION"));_this40.binaryCache=((t=mn().getNumber("WEBGL_VERSION"))in ml||(ml[t]={}),ml[t]),_this40.gpgpu=new Gs(_e95),_this40.canvas=_e95.canvas,_this40.gpgpuCreatedLocally=!0}else _this40.gpgpu=e,_this40.binaryCache={},_this40.gpgpuCreatedLocally=!1,_this40.canvas=e.gl.canvas;return _this40.textureManager=new ol(_this40.gpgpu),_this40.numMBBeforeWarning=null==mn().global.screen?1024:mn().global.screen.height*mn().global.screen.width*window.devicePixelRatio*600/1024/1024,_this40.texData=new Tt(_assertThisInitialized(_this40),da()),_possibleConstructorReturn(_this40)}return _createClass(gl,[{key:"nextDataId",value:function nextDataId(){return gl.nextDataId++}},{key:"numDataIds",value:function numDataIds(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}},{key:"write",value:function write(e,t,n){if((mn().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||mn().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:jo.UPLOAD,refCount:1}),r}},{key:"refCount",value:function refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function incRef(e){this.texData.get(e).refCount++}},{key:"decRef",value:function decRef(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function move(e,t,n,r,a){if(mn().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:jo.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}},{key:"readSync",value:function readSync(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,o=t.slice,s=t.shape,i=t.isPacked;if(null!=o){var _t103;_t103=i?new pl(s,dl):new ll(s,dl);var _n67=this.runWebGLProgram(_t103,[{dataId:e,shape:s,dtype:r}],r),_a47=this.readSync(_n67.dataId);return this.disposeIntermediateTensorInfo(_n67),_a47}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var l,c,u=null!=this.activeTimers;return u&&(l=Nn()),c="complex64"===r?Eo(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.getValuesFromTexture(e),u&&(this.downloadWaitMs+=Nn()-l),this.convertAndCacheOnCPU(e,c)}},{key:"read",value:(_read=_asyncToGenerator(regeneratorRuntime.mark((function _callee19(e){var _t104,t,n,r,a,o,s,i,_t105,_n68,_a48,u,l,c,_this$gpgpu,_t106,_e96,_e97,d,p;return regeneratorRuntime.wrap((function _callee19$(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:if(!this.pendingRead.has(e)){_context19.next=3;break}return _t104=this.pendingRead.get(e),_context19.abrupt("return",new Promise((function(e){return _t104.push(e)})));case 3:if(t=this.texData.get(e),n=t.values,r=t.shape,a=t.slice,o=t.dtype,s=t.complexTensorInfos,i=t.isPacked,null==a){_context19.next=8;break}return _t105=i?new pl(r,dl):new ll(r,dl),_n68=this.runWebGLProgram(_t105,[{dataId:e,shape:r,dtype:o}],o),_a48=this.read(_n68.dataId),_context19.abrupt("return",(this.disposeIntermediateTensorInfo(_n68),_a48));case 8:if(null==n){_context19.next=10;break}return _context19.abrupt("return",this.convertAndCacheOnCPU(e));case 10:if(mn().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==mn().getNumber("WEBGL_VERSION")){_context19.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(c=null,"complex64"!==o&&mn().get("WEBGL_BUFFER_SUPPORTED")&&(u=this.decode(e),_t106=this.texData.get(u.dataId),c=(_this$gpgpu=this.gpgpu).createBufferFromTexture.apply(_this$gpgpu,[_t106.texture].concat(_toConsumableArray(Qo(r))))),this.pendingRead.set(e,[]),_context19.t0="complex64"!==o,!_context19.t0){_context19.next=19;break}return _context19.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==o){_context19.next=26;break}return _context19.next=22,Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]);case 22:_e96=_context19.sent,l=Eo(_e96[0],_e96[1]),_context19.next=27;break;case 26:null==c?l=this.getValuesFromTexture(e):(_e97=Wt(r),l=this.gpgpu.downloadFloat32MatrixFromBuffer(c,_e97));case 27:return null!=u&&this.disposeIntermediateTensorInfo(u),d=this.convertAndCacheOnCPU(e,l),p=this.pendingRead.get(e),_context19.abrupt("return",(this.pendingRead.delete(e),p.forEach((function(e){return e(d)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&da().removeDataId(e,this),this.pendingDeletes--),d));case 30:case"end":return _context19.stop()}}),_callee19,this)}))),function read(_x15){return _read.apply(this,arguments)})},{key:"bufferSync",value:function bufferSync(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return Rn(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ur(e.shape,e.dtype,n)}},{key:"checkNumericalProblems",value:function checkNumericalProblems(e){if(null!=e)for(var t=0;t<e.length;t++){var _n69=e[t];if(!Jo(_n69)){if(mn().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(_n69," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"));throw Error("The value ".concat(_n69," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function getValuesFromTexture(e){var _this$texData$get=this.texData.get(e),t=_this$texData$get.shape,n=_this$texData$get.dtype,r=_this$texData$get.isPacked,a=Wt(t);if(mn().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var _this$gpgpu2,_n70=this.decode(e),_r61=this.texData.get(_n70.dataId),_o32=(_this$gpgpu2=this.gpgpu).downloadMatrixFromPackedTexture.apply(_this$gpgpu2,[_r61.texture].concat(_toConsumableArray(Qo(t)))).subarray(0,a);return this.disposeIntermediateTensorInfo(_n70),_o32}var o=mn().getBool("WEBGL_PACK")&&!0===r,s=o?ps(t):t,i=o?new Ss(s):new Ns(s),u=this.runWebGLProgram(i,[{shape:s,dtype:n,dataId:e}],"float32"),l=this.texData.get(u.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(l.texture,l.texShape[0],l.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(u),c}},{key:"timerAvailable",value:function timerAvailable(){return mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:(_time2=_asyncToGenerator(regeneratorRuntime.mark((function _callee20(e){var t,n,r,a,o,s,_e98;return regeneratorRuntime.wrap((function _callee20$(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:if(t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),a=Pt(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=Pt(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},!(mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){_context20.next=13;break}return _context20.next=9,Promise.all(a);case 9:_e98=_context20.sent,s.kernelMs=function(e){for(var t=0,_n71=0;_n71<e.length;_n71++)t+=e[_n71];return t}(_e98),s.getExtraProfileInfo=function(){return _e98.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},_context20.next=14;break;case 13:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 14:return _context20.abrupt("return",(this.uploadWaitMs=0,this.downloadWaitMs=0,s));case 15:case"end":return _context20.stop()}}),_callee20,this)}))),function time(_x16){return _time2.apply(this,arguments)})},{key:"memory",value:function memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function startTimer(){return mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Nn(),endMs:null}}},{key:"endTimer",value:function endTimer(e){return mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Nn(),e)}},{key:"getQueryTime",value:(_getQueryTime=_asyncToGenerator(regeneratorRuntime.mark((function _callee21(e){var t;return regeneratorRuntime.wrap((function _callee21$(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:if(!(mn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){_context21.next=2;break}return _context21.abrupt("return",this.gpgpu.waitForQueryAndGetTime(e));case 2:return t=e,_context21.abrupt("return",t.endMs-t.startMs);case 4:case"end":return _context21.stop()}}),_callee21,this)}))),function getQueryTime(_x17){return _getQueryTime.apply(this,arguments)})},{key:"disposeData",value:function disposeData(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var _this$texData$get2=this.texData.get(e),n=_this$texData$get2.complexTensorInfos;return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function releaseGPUData(e){var _this$texData$get3=this.texData.get(e),t=_this$texData$get3.texture,n=_this$texData$get3.dtype,r=_this$texData$get3.texShape,a=_this$texData$get3.usage,o=_this$texData$get3.isPacked,s=_this$texData$get3.slice,i=s&&s.origDataId||e,u=this.dataRefCount.get(i);u>1?this.dataRefCount.set(i,u-1):(this.dataRefCount.delete(i),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,a,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}},{key:"getDataInfo",value:function getDataInfo(e){return this.texData.get(e)}},{key:"getCPUBackend",value:function getCPUBackend(){return mn().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=da().findBackend("cpu")),this.cpuBackend):null}},{key:"shouldExecuteOnCPU",value:function shouldExecuteOnCPU(e){var _this41=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128,n=this.getCPUBackend();return mn().getBool("IS_TEST")||this.warnedAboutCPUBackend||null!=n||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=n&&e.every((function(e){return null==_this41.texData.get(e.dataId).texture&&Wt(e.shape)<t}))}},{key:"getGPGPUContext",value:function getGPGPUContext(){return this.gpgpu}},{key:"where",value:function where(e){Ao("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return fl(e.shape,t)}},{key:"packedUnaryOp",value:function packedUnaryOp(e,t,n){var r=new pl(e.shape,t),a=this.compileAndRun(r,[e],n);return da().makeTensorFromDataId(a.dataId,a.shape,a.dtype)}},{key:"abs",value:function abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var _t107=Xu(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,_t107)}if(mn().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,cl,e.dtype);var t=new ll(e.shape,cl),n=this.compileAndRun(t,[e]);return da().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}},{key:"makeTensorInfo",value:function makeTensorInfo(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&en(n[0])){var _a49=n.map((function(e){return Sn(e)}));r=this.write(_a49,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function makeOutput(e,t,n){var r=this.makeTensorInfo(e,t,n).dataId;return da().makeTensorFromDataId(r,e,t,this)}},{key:"unpackTensor",value:function unpackTensor(e){var t=new hl(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function packTensor(e){var t=new rl(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function packedReshape(e,t){var n=[cs(e.shape)].concat(_toConsumableArray(ds(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[cs(t)].concat(_toConsumableArray(ds(t))),o=new al(a,n),s=this.runWebGLProgram(o,[r],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function decode(e){var s,t=this.texData.get(e),n=t.isPacked,r=t.shape,a=t.dtype,o=ps(r);return s=n?new $s(o):new _s(o),{dtype:a,shape:r,dataId:this.runWebGLProgram(s,[{shape:o,dtype:a,dataId:e}],a,null,!0).dataId}}},{key:"runWebGLProgram",value:function runWebGLProgram(e,t,n,r){var _this42=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Ho.DENSE){var _t108=Qo(e.outputShape);s.texShape=_t108.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===Wt(o.shape))return s.values=Qt(o.dtype,0),o;var i=[],u=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=_this42.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Wt(t.shape)<=mn().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?_this42.unpackTensor(t):_this42.packTensor(t),i.push(t),n=_this42.texData.get(t.dataId);else if(n.isPacked&&!fs(n.shape,t.shape)){var _e99=t,_r62=t.shape;t.shape=n.shape,t=_this42.packedReshape(t,_r62),i.push(t),n=_this42.texData.get(t.dataId),_e99.shape=_r62}return _this42.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var h,l={shape:o.shape,texData:s,isUniform:!1},c=function(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+="".concat(e.shape,"_").concat(n,"_").concat(t)}));var a=e.userCode,o=e.constructor.name;return o+="_"+r+"_"+a}(e,u,l),d=this.getAndSaveBinary(c,(function(){return function(e,t,n,r){var a=t.userCode,o=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),s=o.map((function(e){return e.shapeInfo})),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Hs(o,i,a,t.packedInputs),l=e.createProgram(u),c=null,d=e.getUniformLocation(l,"NAN",!1);1===mn().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1));for(var p={},_n72=0;_n72<t.variableNames.length;_n72++){var _r63=t.variableNames[_n72];p[_r63]=e.getUniformLocation(l,_r63,!1),p["offset".concat(_r63)]=e.getUniformLocation(l,"offset".concat(_r63),!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:p,inShapeInfos:s,outShapeInfo:i,infLoc:c,nanLoc:d}}(_this42.gpgpu,e,u,l)})),p=null!=this.activeTimers;p&&(h=this.startTimer()),function(e,t,n,r,a){ai(t.inShapeInfos,n),ai([t.outShapeInfo],[r]);var o=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(o,s[0],s[1]):e.setOutputMatrixTexture(o,s[0],s[1]),e.setProgram(t.webGLProgram),1===mn().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],o=t.uniformLocations[a],s=t.uniformLocations["offset".concat(a)];if(null!=o)if(n.isUniform)if(Wt(n.shape)<2)e.gl.uniform1f(o,n.uniformValues[0]);else{var _t109=n.uniformValues;_t109 instanceof Float32Array||(_t109=new Float32Array(_t109)),e.gl.uniform1fv(o,_t109)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,o,r)})),null!=a&&a(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,d,u,l,r),i.forEach((function(e){return _this42.disposeIntermediateTensorInfo(e)})),p&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));var f=mn().get("WEBGL_FLUSH_THRESHOLD");if(f>0){var _e100=Nn();_e100-this.lastGlFlushTime>f&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=_e100)}if(!mn().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===a){var _e101=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),_e101}return o}},{key:"compileAndRun",value:function compileAndRun(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function getTextureManager(){return this.textureManager}},{key:"dispose",value:function dispose(){var _this43=this;this.disposed||(mn().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(e){_this43.gpgpu.deleteProgram(_this43.binaryCache[e].webGLProgram),delete _this43.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function floatPrecision(){var e,_this44=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=(e=function e(){if(!mn().get("WEBGL_RENDER_FLOAT32_ENABLED")){var _e102=mn().getBool("DEBUG");mn().set("DEBUG",!1);var _t110=_this44.abs(ro(1e-8)).dataSync()[0];if(mn().set("DEBUG",_e102),_t110>0)return 32}return 16},or.tidy(e,void 0))),this.floatPrecisionValue}},{key:"epsilon",value:function epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function uploadToGPU(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,o=t.texture,s=t.usage,i=t.isPacked;if(null==o){var l,u=null!=this.activeTimers;u&&(l=Nn());var c=t.texShape;if(null==c&&(c=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=mn().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((function(t,n){return n>=e.length-2?Dt(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var _t111=qt(e);e=_t111.newShape}var r=Wt(e);if(e.length<=1&&r<=n)return[1,r];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var _ds2,_t112=cs(e),_n73=2,_a51=2;return e.length&&(_n73=(_ds2=_slicedToArray(ds(e),2))[0],_a51=_ds2[1]),Gt(r=_t112*(_n73/2)*(_a51/2)).map((function(e){return 2*e}))}return Gt(r)}(n,i),t.texShape=c),null!=a){var _Ko12,_o33,_e103=ps(n),_s19=c[1],_d4=c[0],_p5=a instanceof Uint8Array;i?(_s19=(_Ko12=_slicedToArray(Ko(c[0],c[1]),2))[0],_d4=_Ko12[1],_o33=new Ts(_e103,[_d4,_s19],_p5)):_o33=new Rs(_e103,[_d4,_s19],_p5);var _h5=this.makeTensorInfo([_d4,_s19],r);this.texData.get(_h5.dataId).usage=_p5?jo.PIXELS:jo.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(_h5.dataId),_s19,_d4,a);var _m5=this.runWebGLProgram(_o33,[_h5],r,null,!0),_g4=this.texData.get(_m5.dataId);t.texture=_g4.texture,t.texShape=_g4.texShape,t.isPacked=_g4.isPacked,t.usage=_g4.usage,this.disposeIntermediateTensorInfo(_h5),this.texData.delete(_m5.dataId),t.values=null,u&&(this.uploadWaitMs+=Nn()-l)}else{var _e104=this.acquireTexture(c,s,r,i);t.texture=_e104}}}},{key:"convertAndCacheOnCPU",value:function convertAndCacheOnCPU(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var _n74="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),_t113=0;_t113<_n74.length;++_t113)_n74[_t113]=Math.round(e[_t113]);return _n74}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var _e105=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(_e105," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function computeBytes(e,t){return e[0]*e[1]*Jt(t)}}]),gl}(Ft);gl.nextDataId=0,ur()&&fa("webgl",(function(){return new gl}),2);var bl=function bl(e,t,n){_classCallCheck(this,bl),this.variableNames=["A","B"],this.outputShape=Ta(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")},xl=function xl(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck(this,xl),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ta(t,n);var a=this.outputShape.length,o="";if(r)if(0===a||1===Wt(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          ".concat(ti(a)," coords = getOutputCoords();\n        "),1===a)o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var _e106=nl("coords",a);o+="\n            bool nextRowOutOfBounds =\n              (".concat(_e106[a-2]," + 1) >= ").concat(this.outputShape[a-2],";\n            bool nextColOutOfBounds =\n              (").concat(_e106[a-1]," + 1) >= ").concat(this.outputShape[a-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")};function vl(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var yl={kernelName:"Identity",backendName:"webgl",kernelFunc:vl};function wl(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,o=n.makeTensorInfo(r.shape,"complex64"),s=n.texData.get(o.dataId),i=vl({inputs:{x:r},backend:n}),u=vl({inputs:{x:a},backend:n});return s.complexTensorInfos={real:i,imag:u},o}var kl={kernelName:"Complex",backendName:"webgl",kernelFunc:wl},Il="return (a < 0.) ? b * a : a;",Cl="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Al={kernelName:"LeakyRelu",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.alpha,s=n.makeTensorInfo([],"float32",_n(o,"float32")),i=mn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl(Cl,a.shape,s.shape):new bl(Il,a.shape,s.shape),u=n.runWebGLProgram(i,[a,s],a.dtype);return n.disposeIntermediateTensorInfo(s),u}},El="return (a < 0.) ? b * a : a;",_l="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",$l={kernelName:"Prelu",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,o=mn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl(_l,r.shape,a.shape):new bl(El,r.shape,a.shape);return n.runWebGLProgram(o,[r,a],r.dtype)}};function Nl(_ref13){var e=_ref13.opSnippet,t=_ref13.packedOpSnippet,n=_ref13.cpuKernelImpl,r=_ref13.dtype;return function(_ref14){var l,a=_ref14.inputs,o=_ref14.backend,s=a.x,i=o,u=r||s.dtype;if(i.shouldExecuteOnCPU([s])&&null!=n){var _e107=i.texData.get(s.dataId),_t114=n(_e107.values,u);return i.makeTensorInfo(s.shape,u,_t114)}return l=mn().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new pl(s.shape,t):new ll(s.shape,e),i.runWebGLProgram(l,[s],u)}}function Sl(_ref15){var e=_ref15.opSnippet,t=_ref15.packedOpSnippet,_ref15$checkOutOfBoun=_ref15.checkOutOfBounds,n=void 0!==_ref15$checkOutOfBoun&&_ref15$checkOutOfBoun,_ref15$supportsComple=_ref15.supportsComplex,r=void 0!==_ref15$supportsComple&&_ref15$supportsComple,a=_ref15.cpuKernelImpl,o=_ref15.dtype;return function(_ref16){var s=_ref16.inputs,i=_ref16.backend,u=s.a,l=s.b,c=i;if(r&&"complex64"===u.dtype){var _t115=c.texData.get(u.dataId),_n75=c.texData.get(l.dataId),_map=[[_t115.complexTensorInfos.real,_n75.complexTensorInfos.real],[_t115.complexTensorInfos.imag,_n75.complexTensorInfos.imag]].map((function(t){var _t116=_slicedToArray(t,2),n=_t116[0],r=_t116[1],a={dataId:n.dataId,dtype:n.dtype,shape:u.shape},o={dataId:r.dataId,dtype:r.dtype,shape:l.shape},s=new bl(e,u.shape,l.shape);return c.runWebGLProgram(s,[a,o],Yn(n.dtype,r.dtype))})),_map2=_slicedToArray(_map,2),_r64=_map2[0],_a52=_map2[1],_o34=wl({inputs:{real:_r64,imag:_a52},backend:c});return c.disposeIntermediateTensorInfo(_r64),c.disposeIntermediateTensorInfo(_a52),_o34}var p,d=o||Yn(u.dtype,l.dtype);if(c.shouldExecuteOnCPU([u,l])&&null!=a){var _e108=c.texData.get(u.dataId),_t117=c.texData.get(l.dataId),_a54=_slicedToArray(a(u.shape,l.shape,_e108.values,_t117.values,d),2),_n76=_a54[0],_r65=_a54[1],_o35=c.makeTensorInfo(_r65,d);return c.texData.get(_o35.dataId).values=_n76,_o35}return p=mn().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new xl(t,u.shape,l.shape,n):new bl(e,u.shape,l.shape),c.runWebGLProgram(p,[u,l],d)}}function Rl(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===e)return t?_l:El;if("leakyrelu"===e)return t?Cl:Il;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var Tl=function Tl(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8];_classCallCheck(this,Tl),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var l=r?e[1]:e[2],c=Math.ceil(l/2),d=r?"i * 2, rc.y":"rc.y, i * 2",p=a?"rc.z, i * 2":"i * 2, rc.z",h=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";s&&(m=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):u?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");var x="rc.x",v="rc.x";e[0]<t[0]?x="int(min(float(rc.x), ".concat(e[0]-1,".))"):t[0]<e[0]&&(v="int(min(float(rc.x), ".concat(t[0]-1,".))")),this.userCode="\n      ".concat(m,"\n\n      const float sharedDimension = ").concat(c,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(c,"; i++) {\n          int batchA = ").concat(x,";\n          int batchB = ").concat(v,";\n          vec4 a = getMatrixA(batchA, ").concat(d,");\n          vec4 b = getMatrixB(batchB, ").concat(p,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(h[0]," * ").concat(f[0],");\n          result += (").concat(h[1]," * ").concat(f[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(b,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")},Fl="return areal * breal - aimag * bimag;",Ml="return areal * bimag + aimag * breal;",Ol=function Ol(e,t,n){_classCallCheck(this,Ol),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ta(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")},Dl="return a * b;";function Bl(e){var s,t=e.inputs,n=e.backend,r=t.a,a=t.b,o=Yn(r.dtype,a.dtype);if("complex64"===r.dtype){var _e109=n.texData.get(r.dataId),_t118=n.texData.get(a.dataId),_o36=new Ol(Fl,r.shape,a.shape),_s20=new Ol(Ml,r.shape,a.shape),_i16=[{dataId:_e109.complexTensorInfos.real.dataId,dtype:_e109.complexTensorInfos.real.dtype,shape:r.shape},{dataId:_e109.complexTensorInfos.imag.dataId,dtype:_e109.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:_t118.complexTensorInfos.real.dataId,dtype:_t118.complexTensorInfos.real.dtype,shape:a.shape},{dataId:_t118.complexTensorInfos.imag.dataId,dtype:_t118.complexTensorInfos.imag.dtype,shape:a.shape}],_u10=n.runWebGLProgram(_o36,_i16,"float32"),_l5=n.runWebGLProgram(_s20,_i16,"float32"),_c5=wl({inputs:{real:_u10,imag:_l5},backend:n});return n.disposeIntermediateTensorInfo(_u10),n.disposeIntermediateTensorInfo(_l5),_c5}if(n.shouldExecuteOnCPU([r,a])){var _e110=n.texData.get(r.dataId),_t119=n.texData.get(a.dataId),_Vu2=_slicedToArray(Vu(r.shape,a.shape,_e110.values,_t119.values,o),2),_s21=_Vu2[0],_i17=_Vu2[1],_u11=n.makeTensorInfo(_i17,o);return n.texData.get(_u11.dataId).values=_s21,_u11}return s=mn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl(Dl,r.shape,a.shape):new bl(Dl,r.shape,a.shape),n.runWebGLProgram(s,[r,a],o)}var Ll={kernelName:"Multiply",backendName:"webgl",kernelFunc:Bl};function Pl(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.shape,s=n,i=Wt(a.shape),u=jt(o,i),l=Wt(u);Bt(i===l,(function(){return"The new shape (".concat(u,") has ").concat(l," elements and the old shape (").concat(a.shape,") has ").concat(i," elements. The new shape and old shape must have the same number of elements.")}));var c=s.texData.get(a.dataId);return!c.isPacked||fs(a.shape,u)||null!==c.texture&&fs(c.shape,u)?(s.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[cs(e.shape)].concat(_toConsumableArray(ds(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},o=[cs(t)].concat(_toConsumableArray(ds(t))),s=new al(o,r),i=n.runWebGLProgram(s,[a],e.dtype,null,!0);return{dataId:i.dataId,shape:t,dtype:i.dtype}}(a,u,s)}var Wl={kernelName:"Reshape",backendName:"webgl",kernelFunc:Pl},Ul=function Ul(e,t){_classCallCheck(this,Ul),this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,a=e.inSize,o=e.outSize;this.outputShape=[r,o];var s=4*Math.floor(n/4),i=n%4,u="sumValue += dot(values, ones);";if(null!=t){var _e111=1/t;u="sumValue += dot(values * ".concat(Vt(_e111)?_e111.toPrecision(2):_e111,", ones);")}var l="";a%n>0&&(l="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(l,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(u,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===i,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(u,"\n        } else if (").concat(2===i,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(u,"\n        } else if (").concat(3===i,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(u,"\n        }\n        setOutput(sumValue);\n      }\n    ")},Vl=function Vl(e,t){_classCallCheck(this,Vl),this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,a=e.inSize,o=e.outSize;this.outputShape=[r,o];var s="0.0",i="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",i="min"):"max"===t&&(s="-1.0 / 1e-20",i="max");var u="".concat(t,"(").concat(t,"(").concat(t,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,d="\n      if (".concat("sum"===t,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===t,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(i,"(values, minMaxValue);\n      }\n    "),p="vec4";"all"===t?(s="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===t&&(s="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var h="";a%n>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(d,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===c,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(2===c,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(3===c,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(d,"\n        }\n        setOutput(").concat(u,");\n      }\n    ")};function Gl(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var _n77=t.length?t[t.length-1].outSize:e[1],_r66=xo(_n77);t.push({inSize:_n77,windowSize:_r66,outSize:Math.ceil(_n77/_r66)})}return t}(e.shape),o=e,_s22=0;_s22<a.length;_s22++){var _c6,_d5,_a$_s=a[_s22],_i18=_a$_s.inSize,_u12=_a$_s.windowSize,_l6=_a$_s.outSize;_c6="mean"===n?0===_s22?new Ul({windowSize:_u12,inSize:_i18,batchSize:e.shape[0],outSize:_l6},_i18):new Ul({windowSize:_u12,inSize:_i18,batchSize:e.shape[0],outSize:_l6}):new Vl({windowSize:_u12,inSize:_i18,batchSize:e.shape[0],outSize:_l6},n),_d5=o,o=r.runWebGLProgram(_c6,[o],t),_d5.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(_d5)}return o}var zl=function zl(e,t){_classCallCheck(this,zl),this.variableNames=["A"];for(var n=new Array(e.length),_r67=0;_r67<n.length;_r67++)n[_r67]=e[t[_r67]];this.outputShape=n,this.rank=n.length;var r=ti(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),_t120=0;_t120<e.length;_t120++)r[e[_t120]]=n[_t120];return r.join()}(t);this.userCode="\n    void main() {\n      ".concat(r," resRC = getOutputCoords();\n      setOutput(getA(").concat(a,"));\n    }\n    ")},Hl=function Hl(e,t){_classCallCheck(this,Hl),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),_r68=0;_r68<n.length;_r68++)n[_r68]=e[t[_r68]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var r=ti(this.rank),a=tl("rc",this.rank),o=new Array(this.rank),_e112=0;_e112<t.length;_e112++)o[t[_e112]]=a[_e112];var s="vec2(".concat(o.slice(-2).join(),")"),i="++".concat(a[this.rank-1]," < ").concat(n[this.rank-1]),u="getChannel(getA(".concat(o.join(),"), ").concat(s,")");this.userCode="\n    void main() {\n      ".concat(r," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(u,";\n      if(").concat(i,") {\n        result[1] = ").concat(u,";\n      }\n      --").concat(a[this.rank-1],";\n      if(++").concat(a[this.rank-2]," < ").concat(n[this.rank-2],") {\n        result[2] = ").concat(u,";\n        if(").concat(i,") {\n          result[3] = ").concat(u,";\n        }\n      }\n      setOutput(result);\n    }\n    ")};function jl(e,t,n){var r=mn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Hl(e.shape,t):new zl(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function Xl(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,o=e.shape.length,s=Xt(a,e.shape),i=s,u=Ua(i,o),l=null!=u,c=e;l&&(c=jl(e,u,r),i=Ga(i.length,o)),Wa("sum",i,o);var _La4=_slicedToArray(La(c.shape,i),2),d=_La4[0],p=_La4[1],h=d;n&&(h=Pa(d,s));var f=Wt(p),m=Pl({inputs:{x:c},attrs:{shape:[Wt(e.shape)/f,f]},backend:r}),g=Gl(m,Zn(e.dtype),"sum",r),b=Pl({inputs:{x:g},attrs:{shape:h},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),l&&r.disposeIntermediateTensorInfo(c),b}(t.x,r.axis,r.keepDims,n)}var ql={kernelName:"Sum",backendName:"webgl",kernelFunc:Xl};function Ql(e){for(var l,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.perm,s=n,i=a.shape.length,u=new Array(i),_e113=0;_e113<u.length;_e113++)u[_e113]=a.shape[o[_e113]];if(s.shouldExecuteOnCPU([a])){var _e114=s.texData.get(a.dataId).values,_t121=Ju(_e114,a.shape,a.dtype,o,u);l=s.makeTensorInfo(u,a.dtype),s.texData.get(l.dataId).values=_t121}else l=jl(a,o,s);return l}var Kl={kernelName:"Transpose",backendName:"webgl",kernelFunc:Ql};function Yl(_ref17){var e=_ref17.a,t=_ref17.b,n=_ref17.transposeA,r=_ref17.transposeB,a=_ref17.backend,_ref17$bias=_ref17.bias,o=void 0===_ref17$bias?null:_ref17$bias,_ref17$preluActivatio=_ref17.preluActivationWeights,s=void 0===_ref17$preluActivatio?null:_ref17$preluActivatio,_ref17$leakyreluAlpha=_ref17.leakyreluAlpha,i=void 0===_ref17$leakyreluAlpha?0:_ref17$leakyreluAlpha,_ref17$activation=_ref17.activation,u=void 0===_ref17$activation?null:_ref17$activation,l=e.shape.length,c=t.shape.length,d=n?e.shape[l-2]:e.shape[l-1],p=r?t.shape[c-1]:t.shape[c-2],h=n?e.shape[l-1]:e.shape[l-2],f=r?t.shape[c-2]:t.shape[c-1],m=e.shape.slice(0,-2),g=t.shape.slice(0,-2),b=Wt(m),x=Wt(g);Bt(l>=2&&c>=2&&(b===x||1===b||1===x),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(m,") and (").concat(g,").")}));var v=(b>x?e.shape.slice(0,-2):t.shape.slice(0,-2)).concat([h,f]);Bt(d===p,(function(){return"Error in matMul: inner shapes (".concat(d,") and (").concat(p,") of Tensors with shapes ").concat(e.shape," and ").concat(t.shape," and transposeA=").concat(n," and transposeB=").concat(r," must match.")}));var R,y=n?[b,d,h]:[b,h,d],w=r?[x,f,p]:[x,p,f],k=Pl({inputs:{x:e},backend:a,attrs:{shape:y}}),I=Pl({inputs:{x:t},backend:a,attrs:{shape:w}}),C=[k,I],A=Math.max(b,x),E=n?k.shape[1]:k.shape[2],_=null!=o,$=null!=s,N="leakyrelu"===u,S=null!=u?Rl(u,!0):null;if((1===h||1===f)&&E>1e3&&!1===(_||$||N||null!=S)){var _e115=k,_t122=I;n&&(_e115=Ql({inputs:{x:k},backend:a,attrs:{perm:[0,2,1]}}),C.push(_e115)),r&&(_t122=Ql({inputs:{x:I},backend:a,attrs:{perm:[0,2,1]}}),C.push(_t122));var _o37=1===f,_s23=_e115;1!==f&&(_s23=Pl({inputs:{x:_e115},backend:a,attrs:{shape:[A,E,1]}}),C.push(_s23));var _i19=1===f?2:1,_u13=_t122;_o37&&(_u13=Pl({inputs:{x:_t122},backend:a,attrs:{shape:[A,1,E]}}),C.push(_u13));var _l7=Bl({inputs:{a:_s23,b:_u13},backend:a});R=Xl({inputs:{x:_l7},backend:a,attrs:{axis:_i19,keepDims:!0}}),C.push(_l7)}else{var _u14=Yn(e.dtype,t.dtype),_l8=new Tl(y,w,[A,h,f],n,r,_,S,$,N),_c7=[k,I];if(null!=o&&_c7.push(o),$&&_c7.push(s),N){var _e116=a.makeTensorInfo([],"float32",_n(i,"float32"));_c7.push(_e116),C.push(_e116)}R=a.runWebGLProgram(_l8,_c7,_u14)}var T=Pl({inputs:{x:R},backend:a,attrs:{shape:v}});C.push(R);for(var _i20=0,_C=C;_i20<_C.length;_i20++){var _e117=_C[_i20];a.disposeIntermediateTensorInfo(_e117)}return T}var Zl={kernelName:"_FusedMatMul",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=t.bias,i=t.preluActivationWeights,u=r.transposeA,l=r.transposeB,c=r.activation;return Yl({a:a,b:o,transposeA:u,transposeB:l,backend:n,bias:s,preluActivationWeights:i,leakyreluAlpha:r.leakyreluAlpha,activation:c})}},Jl={kernelName:"Abs",backendName:"webgl",kernelFunc:function kernelFunc(e){var a,t=e.inputs,n=e.backend,r=t.x;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){var _e118=n.texData.get(r.dataId),_t123=Xu(_e118.values);return n.makeTensorInfo(r.shape,r.dtype,_t123)}return a=mn().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new pl(r.shape,"return abs(x);"):new ll(r.shape,"return abs(x);"),n.runWebGLProgram(a,[r],r.dtype)}},ec={kernelName:"Acos",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"})},tc={kernelName:"Acosh",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"})},nc="return a + b;",rc={kernelName:"Add",backendName:"webgl",kernelFunc:Sl({opSnippet:nc,packedOpSnippet:nc,supportsComplex:!0,cpuKernelImpl:Eu})},ac=function ac(e,t){_classCallCheck(this,ac),this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=[];this.variableNames.forEach((function(e){n.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var r=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        float result = ").concat(r,";\n        setOutput(result);\n      }\n    ")},oc=function oc(e,t){_classCallCheck(this,oc),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var r=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        vec4 result = ").concat(r,";\n        setOutput(result);\n      }\n    ")},sc={kernelName:"AddN",backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return vl({inputs:{x:a[0]},backend:r});if(a.length>mn().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var _t124=Math.floor(a.length/2),_n78=e({inputs:a.slice(0,_t124),backend:r}),_o38=e({inputs:a.slice(_t124),backend:r});return e({inputs:[_n78,_o38],backend:r})}var o=a.map((function(e){return e.dtype})).reduce((function(e,t){return Yn(e,t)})),s=a.map((function(e){return e.shape})),i=mn().getBool("WEBGL_PACK")?new oc(a[0].shape,s):new ac(a[0].shape,s);return r.runWebGLProgram(i,a,o)}},ic={kernelName:"All",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,i=a.shape.length,u=Xt(o,a.shape),l=u,c=Ua(l,i),d=a;null!=c&&(d=Ql({inputs:{x:a},backend:n,attrs:{perm:c}}),l=Ga(l.length,i)),Wa("all",l,i);var g,_La6=_slicedToArray(La(d.shape,l),2),p=_La6[0],f=Pl({inputs:{x:d},backend:n,attrs:{shape:[-1,Wt(_La6[1])]}}),m=Gl(f,f.dtype,"all",n);return g=Pl(s?{inputs:{x:m},backend:n,attrs:{shape:Pa(p,u)}}:{inputs:{x:m},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),g}},uc={kernelName:"Any",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,i=a.shape.length,u=Xt(o,a.shape),l=u,c=Ua(l,i),d=a;null!=c&&(d=Ql({inputs:{x:a},backend:n,attrs:{perm:c}}),l=Ga(l.length,i)),Wa("any",l,i);var g,_La8=_slicedToArray(La(d.shape,l),2),p=_La8[0],f=Pl({inputs:{x:d},backend:n,attrs:{shape:[-1,Wt(_La8[1])]}}),m=Gl(f,f.dtype,"any",n);return g=Pl(s?{inputs:{x:m},backend:n,attrs:{shape:Pa(p,u)}}:{inputs:{x:m},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),g}},lc=function lc(e,t,n){_classCallCheck(this,lc),this.variableNames=["A"];var r=e.windowSize,a=e.batchSize,o=e.outSize;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var s="max"===t?">":"<",i=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(r,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          int inIdx = ").concat(i,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")},cc=function cc(e,t,n,r){_classCallCheck(this,cc),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Bt(e.length>2,(function(){return"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2.")}));var a=e[e.length-1],o=Math.ceil(a/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var c,d,s=this.outputShape,i=s.length,u=ti(i),l=nl("coords",i);if(1===o){var _e119=ti(d=i+1);c="\n        ".concat(_e119," sourceLocR = ").concat(_e119,"(").concat(l.join(),", 0);\n        ++").concat(l[i-1],";\n        ").concat(_e119," sourceLocG = ").concat(_e119,"(").concat(l.join(),", 0);\n        ++").concat(l[i-2],";\n        ").concat(_e119," sourceLocA = ").concat(_e119,"(").concat(l.join(),", 0);\n        --").concat(l[i-1],";\n        ").concat(_e119," sourceLocB = ").concat(_e119,"(").concat(l.join(),", 0);\n        --").concat(l[i-2],";")}else d=i,c="\n        ".concat(u," sourceLocR = coords;\n        ++").concat(l[i-1],";\n        ").concat(u," sourceLocG = coords;\n        ++").concat(l[i-2],";\n        ").concat(u," sourceLocA = coords;\n        --").concat(l[i-1],";\n        ").concat(u," sourceLocB = coords;\n        --").concat(l[i-2],";");var p=["x","y","z","w","u","v"].slice(0,d),h="."+p[d-1],f=p.map((function(e){return"int "+e})),m=nl("sourceLocR",d-1).concat("inIdx.r"),g=nl("sourceLocG",d-1).concat("inIdx.g"),b=nl("sourceLocB",d-1).concat("inIdx.b"),x=nl("sourceLocA",d-1).concat("inIdx.a"),v="max"===n?"greaterThan":"lessThan",y=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(m.join(),"),\n                             getBestIndicesAChannel(").concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),")));"),w="vec4(\n            getAChannel(".concat(m.join(),"),\n            hasNextCol ? getAChannel(").concat(g.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(x.join(),") : 0.)"),k=r?"":"\n      float getBestIndicesAChannel(".concat(f.join(),") {\n        return getChannel(getBestIndicesA(").concat(p.join(),"),\n                                          vec2(").concat(p.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(f.join(),") {\n        return getChannel(getA(").concat(p.join(),"),\n                               vec2(").concat(p.slice(-2).join(),"));\n      }\n      ").concat(k,"\n      void main() {\n        ").concat(u," coords = getOutputCoords();\n        bool hasNextCol = ").concat(l[i-1]," < ").concat(s[i-1]-1,";\n        bool hasNextRow = ").concat(l[i-2]," < ").concat(s[i-2]-1,";\n        ").concat(c,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(h,", sourceLocG").concat(h,",\n          sourceLocB").concat(h,", sourceLocA").concat(h,") * ").concat(t,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(w,";\n\n        for (int i = 0; i < ").concat(t,"; i++) {\n          inIdx = srcIdx;\n          ").concat(y,"\n          vec4 candidate = ").concat(w,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(v,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")};function dc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],o=t.shape[1];null!=r&&(a=r.shape[0],o=r.shape[1]);var s=xo(o),i={windowSize:s,inSize:o,batchSize:a,outSize:Math.ceil(o/s)},u=new lc(i,n,null==r),l=[t];null!=r&&l.push(r);var c=e.runWebGLProgram(u,l,"int32");if(1===c.shape[1])return c;var d=dc(e,t,n,c);return e.disposeIntermediateTensorInfo(c),d}function pc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,o=xo(a[a.length-1]),s=new cc(a,o,n,null==r),i=null==r?[t]:[t,r],u=e.runWebGLProgram(s,i,"int32");if(u.shape.length===t.shape.length){var _r69=pc(e,t,n,u);return e.disposeIntermediateTensorInfo(u),_r69}return u}function hc(e,t,n,r){var a=[n];if(Wa("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!mn().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var _n79=[],_La10=_slicedToArray(La(t.shape,a),2),_o39=_La10[0],_i21=Wt(_La10[1]),_u15=Pl({inputs:{x:t},backend:e,attrs:{shape:[-1,_i21]}});_n79.push(_u15);var _l9=dc(e,_u15,r);_n79.push(_l9);var _c8=Pl({inputs:{x:_l9},backend:e,attrs:{shape:_o39}});return _n79.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),_c8}return pc(e,t,r)}var fc={kernelName:"ArgMax",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,s=Xt(r.axis,a.shape),i=Ua(s,a.shape.length),u=a,l=[];null!=i&&(u=Ql({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),s=Ga(s.length,u.shape.length)),Wa("argMax",[s[0]],u.shape.length);var c=hc(n,u,s[0],"max");return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},mc={kernelName:"ArgMin",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,s=Xt(r.axis,a.shape),i=Ua(s,a.shape.length),u=a,l=[];null!=i&&(u=Ql({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),s=Ga(s.length,u.shape.length)),Wa("argMin",[s[0]],u.shape.length);var c=hc(n,u,s[0],"min");return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},gc={kernelName:"Asin",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"})},bc={kernelName:"Asinh",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"})},xc={kernelName:"Atan",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"})},vc={kernelName:"Atan2",backendName:"webgl",kernelFunc:Sl({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},yc={kernelName:"Atanh",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"})},wc=function wc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck(this,wc),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,i=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var f="avg"===t,m="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),b="0.0";if(f||(b="-1.0 / 1e-20"),n){var _t125=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(i,");\n        const ivec2 pads = ivec2(").concat(p,", ").concat(h,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(u,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(_t125," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(r?a?m:g:"wR * ".concat(d," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var x="".concat(t,"(").concat(t,"(").concat(t,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===t&&(x="avgValue / count");var v=4*Math.floor(o/4),y=o%4,w="\n      if (".concat(f,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(i,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(h,");\n      const float initializationValue = ").concat(b,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(b,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(c,";\n            wR += ").concat(u,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(v,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(w,"\n          }\n\n          int xC = xCCorner + ").concat(v,";\n          if (").concat(1===y,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(2===y,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(3===y,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(w,"\n          }\n        }\n        setOutput(").concat(x,");\n      }\n    ")}},kc=function kc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck(this,kc),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,i=e.strideHeight,u=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;var x="avg"===t,v="0.0";if(x||(v="-1.0 / 1e-20"),n){var _t126=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(i,", ").concat(u,");\n        const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(b,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(p,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(h,";\n                wR += ").concat(c,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(f,";\n                  wC += ").concat(d,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(_t126," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(r?a?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(h," * ").concat(f," +\n                      wR * ").concat(f," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var y="".concat(t,"(").concat(t,"(").concat(t,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===t&&(y="avgValue / count");var w=4*Math.floor(o/4),k=o%4,I="\n      if (".concat(x,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(i,", ").concat(u,");\n      const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(b,");\n      const float initializationValue = ").concat(v,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(v,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(d,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(d,", ch)\n              );\n\n              ").concat(I,"\n            }\n\n            int xC = xCCorner + ").concat(w,";\n            if (").concat(1===k,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(I,"\n            } else if (").concat(2===k,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(I,"\n            } else if (").concat(3===k,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                initializationValue\n              );\n\n              ").concat(I,"\n            }\n          }\n          setOutput(").concat(y,");\n        }\n      }\n    ")}},Ic={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;ws(a,"avgPool");var o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode;Bt(_a(s,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l=ba(a.shape,o,s,1,i,u);if(1===l.filterWidth&&1===l.filterHeight&&Ut(l.inShape,l.outShape))return vl({inputs:{x:a},backend:n});var c=new wc(l,"avg",!1);return n.runWebGLProgram(c,[a],"float32")}},Cc={kernelName:"AvgPool3D",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode,l=r.dataFormat,c=xa(a.shape,o,s,[1,1,1],i,u,l),d=new kc(c,"avg",!1);return n.runWebGLProgram(d,[a],"float32")}},Ac=function Ac(e){_classCallCheck(this,Ac),this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,i=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=i-1-e.padInfo.top,c=u-1-e.padInfo.left,d=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(c,");\n      const float avgMultiplier = float(").concat(d,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(u,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Ec=function Ec(e){_classCallCheck(this,Ec),this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,o=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,h=c-1-e.padInfo.front,f=d-1-e.padInfo.top,m=p-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(f,", ").concat(m,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(c,";\n            wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(a,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(u,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(p,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},_c={kernelName:"AvgPool3DGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,s=t.input,i=r.filterSize,u=r.strides,l=r.pad,c=r.dimRoundingMode,d=xa(s.shape,i,u,[1,1,1],l,c),p=new Ec(d);return n.runWebGLProgram(p,[a],s.dtype)}},$c={kernelName:"AvgPoolGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,s=o;ws([a,o],"avgPoolGrad");var i=r.filterSize,u=r.strides,l=r.pad,c=ba(s.shape,i,u,1,l),d=new Ac(c);return n.runWebGLProgram(d,[a],s.dtype)}},Nc={kernelName:"BatchMatMul",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs;return Yl({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},Sc=function Sc(e,t,n,r,a,o){_classCallCheck(this,Sc),this.outputShape=[],this.variableNames=["x","mean","variance"],Ta(e,t),Ta(e,n);var s="0.0";null!=r&&(Ta(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var i="1.0";null!=a&&(Ta(e,a),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(i,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")},Rc=function Rc(e,t,n,r,a,o){_classCallCheck(this,Rc),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ta(e,t),Ta(e,n);var s="vec4(0.0)";null!=r&&(Ta(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var i="vec4(1.0)";null!=a&&(Ta(e,a),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(i,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")},Tc={kernelName:"FusedBatchNorm",backendName:"webgl",kernelFunc:function kernelFunc(_ref18){var e=_ref18.inputs,t=_ref18.backend,n=_ref18.attrs,r=e.x,a=e.mean,o=e.variance,s=e.offset,i=e.scale;Bt(a.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Bt(null==s||a.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Bt(null==i||a.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var u=n.varianceEpsilon;null==u&&(u=.001);var l=[r,a,o],c=null;null!=s&&(c=s.shape,l.push(s));var d=null;null!=i&&(d=i.shape,l.push(i));var p=mn().getBool("WEBGL_PACK_NORMALIZATION")?new Rc(r.shape,a.shape,o.shape,c,d,u):new Sc(r.shape,a.shape,o.shape,c,d,u);return t.runWebGLProgram(p,l,l[0].dtype)}},Fc=function(){function Fc(e){_classCallCheck(this,Fc),this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var a,t=ti(this.rank),n="uniform int start[".concat(this.rank,"];"),r=function(e){if(1===e)return"sourceLoc";if(e<=6)return Mc.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);a="\n        ".concat(t," sourceLoc;\n        ").concat(t," coords = getOutputCoords();\n        ").concat(e.map((function(e,t){return"sourceLoc.".concat(Mc[t]," = start[").concat(t,"] + coords.").concat(Mc[t],";")})).join("\n"),"\n      "),this.userCode="\n      ".concat(n,"\n      void main() {\n        ").concat(a,"\n        setOutput(getSource(").concat(r,"));\n      }\n    ")}return _createClass(Fc,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this45=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(t,n){null==_this45.startLoc&&(_this45.startLoc=t.getUniformLocationNoThrow(n,"start"),null==_this45.startLoc)||t.gl.uniform1iv(_this45.startLoc,e)}}}]),Fc}(),Mc=["x","y","z","w","u","v"],Oc=function(){function Oc(e){_classCallCheck(this,Oc),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=ti(this.rank),n=nl("coords",this.rank),r=nl("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":"vec2(".concat(r.slice(-2).join(),")"),o="getChannel(getSource(".concat(r.join(),"), ").concat(a,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n        ++").concat(r[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(r[this.rank-1],";\n      }\n    "),i=1===this.rank?"":"\n      --".concat(n[this.rank-1],";\n      if (++").concat(n[this.rank-2]," < ").concat(e[this.rank-2],") {\n        ++").concat(r[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n          ++").concat(r[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),u=this.rank<=4?"sourceLoc = coords +\n            ".concat(t,"(").concat(e.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):e.map((function(e,t){return"".concat(r[t]," = ").concat(n[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      uniform int start[".concat(this.rank,"];\n      void main() {\n        ").concat(t," coords = getOutputCoords();\n        ").concat(t," sourceLoc;\n        ").concat(u,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(i,"\n        setOutput(result);\n      }\n    ")}return _createClass(Oc,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this46=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(t,n){null==_this46.startLoc&&(_this46.startLoc=t.getUniformLocationNoThrow(n,"start"),null==_this46.startLoc)||t.gl.uniform1iv(_this46.startLoc,e)}}}]),Oc}();function Dc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,_ia4=_slicedToArray(ia(a,r.begin,r.size),2),i=_ia4[0],u=_ia4[1];if(Xr(a,i,u),0===Wt(u))return n.makeTensorInfo(u,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var _e120=n.texData.get(a.dataId),_t127=qu(_e120.values,i,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,_t127)}var l=n.texData.get(a.dataId).isPacked,c=oa(a.shape,i,u);if(l||!c){var _e121=mn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Oc(u):new Fc(u),_t128=_e121.getCustomSetupFunc(i);return n.runWebGLProgram(_e121,[a],a.dtype,_t128)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),o=r.makeTensorInfo(n,e.dtype),s=r.texData.get(o.dataId);Object.assign(s,a),s.refCount=1,s.shape=n,s.dtype=e.dtype;var i=sa(t,an(e.shape));a.slice&&(i+=a.slice.flatOffset),s.slice={flatOffset:i,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,u+1),o}(a,i,u,n)}var Bc={kernelName:"Slice",backendName:"webgl",kernelFunc:Dc},Lc={kernelName:"BatchToSpaceND",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,s=r.crops;Bt(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var i=o.reduce((function(e,t){return e*t})),u=yo(a.shape,o,i),l=wo(u.length,o.length),c=ko(a.shape,o,i),d=Io(s,o.length),p=Co(c,s,o.length),h=[],f=Pl({inputs:{x:a},backend:n,attrs:{shape:u}}),m=Ql({inputs:{x:f},backend:n,attrs:{perm:l}}),g=Pl({inputs:{x:m},backend:n,attrs:{shape:c}}),b=Dc({inputs:{x:g},backend:n,attrs:{begin:d,size:p}});return h.push(f),h.push(m),h.push(g),h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}},Pc={kernelName:"Bincount",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.weights,s=r.size,i=n.readSync(a.dataId),u=n.readSync(o.dataId),l=_u(i,u,o.dtype,o.shape,s);return n.makeTensorInfo([s],o.dtype,l)}},Wc=Sl({opSnippet:"return float(a != b);",dtype:"bool"}),Uc={kernelName:"NotEqual",backendName:"webgl",kernelFunc:Wc};function Vc(e){var t=e.inputs,n=e.backend,r=t.input;return vl({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var Gc={kernelName:"Real",backendName:"webgl",kernelFunc:Vc},zc={kernelName:"Cast",backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,o=n.x,s=a.dtype;if("complex64"===s){if("complex64"===o.dtype)return vl({inputs:{x:o},backend:r});var _t129=za(o.shape),_n80=e({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),_a55=wl({inputs:{real:_n80,imag:_t129},backend:r});return _t129.dispose(),r.disposeIntermediateTensorInfo(_n80),_a55}if("complex64"===o.dtype){var _t130=Vc({inputs:{input:o},backend:r}),_n81=e({inputs:{x:_t130},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(_t130),_n81}if(!Yt(o.dtype,s)){var _e122=vl({inputs:{x:o},backend:r});return{dataId:_e122.dataId,shape:_e122.shape,dtype:s}}if("int32"===s)return function(e,t){var n=new ll(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(o,r);if("bool"===s){var _e123=r.makeTensorInfo([],"bool",Qt("bool",1)),_t131=Wc({inputs:{a:o,b:_e123},backend:r});return r.disposeIntermediateTensorInfo(_e123),_t131}throw new Error("Error in Cast: failed to cast ".concat(o.dtype," to ").concat(s))}},Hc="return ceil(x);",jc={kernelName:"Ceil",backendName:"webgl",kernelFunc:Nl({opSnippet:Hc,packedOpSnippet:Hc,cpuKernelImpl:Nu})},Xc=function(){function Xc(e){_classCallCheck(this,Xc),this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return _createClass(Xc,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e,t){var _this47=this;return function(n,r){null==_this47.minLoc&&(_this47.minLoc=n.getUniformLocationNoThrow(r,"minVal"),_this47.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(_this47.minLoc,e),n.gl.uniform1f(_this47.maxLoc,t)}}}]),Xc}(),qc=function(){function qc(e){_classCallCheck(this,qc),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return _createClass(qc,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e,t){var _this48=this;return function(n,r){null==_this48.minLoc&&(_this48.minLoc=n.getUniformLocationNoThrow(r,"minVal"),_this48.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(_this48.minLoc,e),n.gl.uniform1f(_this48.maxLoc,t)}}}]),qc}(),Qc={kernelName:"ClipByValue",backendName:"webgl",kernelFunc:function kernelFunc(e){var i,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.clipValueMin,s=r.clipValueMax,u=(i=mn().getBool("WEBGL_PACK_CLIP")?new qc(a.shape):new Xc(a.shape)).getCustomSetupFunc(o,s);return n.runWebGLProgram(i,[a],a.dtype,u)}},Kc=function Kc(e){_classCallCheck(this,Kc),this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "};function Yc(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var Zc={kernelName:"ComplexAbs",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),o=new Kc(r.shape),s=[Yc(r,a.complexTensorInfos.real),Yc(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(o,s,s[0].dtype)}},Jc=function Jc(e){_classCallCheck(this,Jc),this.outputShape=[],this.outputShape=bo(e,1),this.variableNames=e.map((function(e,t){return"T".concat(t)}));var t=new Array(e.length-1);t[0]=e[0][1];for(var _n82=1;_n82<t.length;_n82++)t[_n82]=t[_n82-1]+e[_n82][1];for(var n=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")],_e124=1;_e124<t.length;_e124++){var _r70=t[_e124-1];n.push("else if (yC < ".concat(t[_e124],") setOutput(getT").concat(_e124,"(yR, yC-").concat(_r70,"));"))}var r=t.length,a=t[t.length-1];n.push("else setOutput(getT".concat(r,"(yR, yC-").concat(a,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(n.join("\n        "),"\n      }\n    ")},ed=function ed(e,t){_classCallCheck(this,ed),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=bo(e,t);var n=this.outputShape,r=n.length,a=ti(r),o=nl("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T".concat(t)}));var i=new Array(e.length-1);i[0]=e[0][t];for(var _n83=1;_n83<i.length;_n83++)i[_n83]=i[_n83-1]+e[_n83][t];for(var u=s[t],l=s.slice(-2),c=s.join(),d="if (".concat(u," < ").concat(i[0],") {\n        return getChannel(\n            getT0(").concat(c,"), vec2(").concat(l.join(),"));\n        }"),_e125=1;_e125<i.length;_e125++){var _t132=i[_e125-1];d+="\n        if (".concat(u," < ").concat(i[_e125],"  && ").concat(u," >= ").concat(i[_e125-1],") {\n          return getChannel(\n            getT").concat(_e125,"(").concat(td(s,u,_t132),"),\n            vec2(").concat(td(l,u,_t132),"));\n        }")}var p=i.length,h=i[i.length-1];d+="\n        return getChannel(\n          getT".concat(p,"(").concat(td(s,u,h),"),\n          vec2(").concat(td(l,u,h),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(a," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[r-1]," = ").concat(o[r-1]," + 1;\n        if (").concat(o[r-1]," < ").concat(n[r-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[r-2]," = ").concat(o[r-2]," + 1;\n        if (").concat(o[r-2]," < ").concat(n[r-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[r-1]," = ").concat(o[r-1]," - 1;\n        if (").concat(o[r-2]," < ").concat(n[r-2]," &&\n            ").concat(o[r-1]," < ").concat(n[r-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")};function td(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function nd(e){var t=e.inputs,n=e.backend,r=t.input;return vl({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var rd={kernelName:"Imag",backendName:"webgl",kernelFunc:nd};function ad(e,t,n){var r=e[0].dtype;if("complex64"===r){var _r71=e.map((function(e){return Vc({inputs:{input:e},backend:n})})),_a56=e.map((function(e){return nd({inputs:{input:e},backend:n})})),_o40=ad(_r71,t,n),_s25=ad(_a56,t,n),_i22=wl({inputs:{real:_o40,imag:_s25},backend:n});return _r71.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),_a56.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(_o40),n.disposeIntermediateTensorInfo(_s25),_i22}if("string"===r){var _od=od(e,t,n),_a57=_od.tensors2D,_o41=_od.outShape,_s26=_a57.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),_i23=1===_a57[0].shape[0],_u16=Su(_s26,_o41,r,_i23),_l10=bo(e.map((function(e){return e.shape})),t),_c9=n.makeTensorInfo(_l10,r,_u16);return _a57.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),_c9}if(e.length>mn().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var _r72=Math.floor(e.length/2),_a58=ad(e.slice(0,_r72),t,n),_o42=ad(e.slice(_r72),t,n),_s27=ad([_a58,_o42],t,n);return n.disposeIntermediateTensorInfo(_a58),n.disposeIntermediateTensorInfo(_o42),_s27}if(mn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var _a59=new ed(e.map((function(e){return e.shape})),t);return n.runWebGLProgram(_a59,e,r)}var _od2=od(e,t,n),a=_od2.tensors2D,o=_od2.outShape,s=new Jc(a.map((function(e){return e.shape}))),i=n.runWebGLProgram(s,a,r);a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var u=Pl({inputs:{x:i},attrs:{shape:o},backend:n});return n.disposeIntermediateTensorInfo(i),u}function od(e,t,n){var r=bo(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return Pl({inputs:{x:e},attrs:{shape:[-1,Wt(e.shape.slice(t))]},backend:n})})),outShape:r}}function sd(e){var t=e.inputs,n=e.backend,o=Xt(e.attrs.axis,t[0].shape)[0],s=bo(t.map((function(e){return e.shape})),o);if(0===Wt(s))return n.makeTensorInfo(s,t[0].dtype,[]);var i=t.filter((function(e){return Wt(e.shape)>0}));return 1===i.length?vl({inputs:{x:i[0]},backend:n}):(go(i.map((function(e){return e.shape})),o),ad(i,o,n))}var id={kernelName:"Concat",backendName:"webgl",kernelFunc:sd},ud=function ud(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,ud),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,i=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,h=4*Math.floor(e.inChannels/4),f=e.inChannels%4,m="channelsLast"===e.dataFormat,g=m?1:2,b=m?2:3,x=m?3:1,v="",y="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),y="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(v,"\n\n      const ivec2 strides = ivec2(").concat(i,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(x,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(b,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(p,"; wC++) {\n            int xC = xCCorner + wC * ").concat(c,";\n\n            if (xC < 0 || xC >= ").concat(e.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===f,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(h,") *\n                    getW(wR, wC, ").concat(h,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(h,", xR, xC) *\n                    getW(wR, wC, ").concat(h,", d2);\n              }\n\n            } else if (").concat(2===f,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===f,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2),\n                getW(wR, wC, ").concat(h," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1),\n                  getX(batch, xR, xC, ").concat(h," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC),\n                  getX(batch, ").concat(h," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(y,"\n        setOutput(result);\n      }\n    ")},ld=function ld(e){_classCallCheck(this,ld),this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,o=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,d=e.filterHeight,p=e.filterWidth,h=4*Math.floor(e.inChannels/4),f=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(a,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(t,", ").concat(n,", ").concat(r,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(c,"; wF++) {\n          int xF = xFCorner + wF * ").concat(i,";\n\n          if (xF < 0 || xF >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(d,"; wR++) {\n            int xR = xRCorner + wR * ").concat(u,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(p,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===f,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(h,") *\n                  getW(wF, wR, wC, ").concat(h,", d2);\n              } else if (").concat(2===f,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===f,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1),\n                  getX(batch, xF, xR, xC, ").concat(h," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2),\n                  getW(wF, wR, wC, ").concat(h," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},cd=function cd(e,t,n){_classCallCheck(this,cd),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,a=n.inChannels,o=n.strideWidth,s=n.strideHeight,i=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,d=n.dataFormat,p=i.left,h=i.top,f=a*r,m=Is(),g="channelsLast"===d,b=g?0:1,x=g?1:2,v="",_n84=0;_n84<=1;_n84++)for(var _r73=0;_r73<=1;_r73++)v+="\n          blockIndex = rc.y + ".concat(_r73,";\n          pos = rc.x + ").concat(_n84,";\n\n          if(blockIndex < ").concat(e[1]," && pos < ").concat(e[0],") {\n            offsetY = int(blockIndex / (").concat(u,")) * ").concat(s," - ").concat(h,";\n            d0 = offsetY + ").concat(c," * (pos / ").concat(f,");\n\n            if(d0 < ").concat(t[b]," && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ").concat(u,".) * ").concat(o,". - ").concat(p,".);\n              d1 = offsetX + ").concat(l," * (int(mod(float(pos), ").concat(f,".) / ").concat(a,".));\n\n              if(d1 < ").concat(t[x]," && d1 >= 0) {\n\n                ch = int(mod(float(pos), ").concat(a,".));\n\n                if (").concat(g,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*_n84+_r73,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*_n84+_r73,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(v,"\n\n        ").concat(m.output," = result;\n      }\n    ")};function dd(_ref19){var f,e=_ref19.x,t=_ref19.filter,n=_ref19.convInfo,r=_ref19.backend,_ref19$bias=_ref19.bias,a=void 0===_ref19$bias?null:_ref19$bias,_ref19$preluActivatio=_ref19.preluActivationWeights,o=void 0===_ref19$preluActivatio?null:_ref19$preluActivatio,_ref19$leakyreluAlpha=_ref19.leakyreluAlpha,s=void 0===_ref19$leakyreluAlpha?0:_ref19$leakyreluAlpha,_ref19$activation=_ref19.activation,i=void 0===_ref19$activation?null:_ref19$activation,u=e.shape,l=r.texData.get(e.dataId),c=n.inChannels,d=u[0]*u[1]*u[2],p=n.outChannels,h="channelsLast"===n.dataFormat,m=[],g=(1===d||1===p)&&c>1e3,b=u[2]%2!=0&&!!l.isPacked;if(!g&&mn().getBool("WEBGL_LAZILY_UNPACK")&&mn().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&b){var _c10=h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),_d6={dataId:e.dataId,shape:[1,_c10,n.inChannels],dtype:e.dtype},_p6=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,Bt(fs(l.shape,_d6.shape),(function(){return"packed reshape ".concat(l.shape," to ").concat(_d6.shape," isn't free")}));var _g5=Pl({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(_g5);var _b4=Yl({a:_d6,b:_g5,backend:r,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:o,leakyreluAlpha:s}),_x18=r.texData.get(_b4.dataId);Bt(_x18.isPacked,(function(){return"batchMatMul result is expected to be packed"})),l.shape=_p6,_x18.shape=n.outShape,(f=vl({inputs:{x:_b4},backend:r})).shape=n.outShape,m.push(_b4)}else{var _l11=Pl({inputs:{x:e},backend:r,attrs:{shape:[1,h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],n.inChannels]}}),_c11=Pl({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),_d7=Yl({a:_l11,b:_c11,transposeA:!1,transposeB:!1,backend:r,bias:a,activation:i,preluActivationWeights:o,leakyreluAlpha:s});f=Pl({inputs:{x:_d7},backend:r,attrs:{shape:n.outShape}}),m.push(_l11),m.push(_c11),m.push(_d7)}for(var _i24=0,_m6=m;_i24<_m6.length;_i24++){var _e126=_m6[_i24];r.disposeIntermediateTensorInfo(_e126)}return f}function pd(_ref20){var e=_ref20.x,t=_ref20.filter,n=_ref20.convInfo,r=_ref20.backend,_ref20$bias=_ref20.bias,a=void 0===_ref20$bias?null:_ref20$bias,_ref20$preluActivatio=_ref20.preluActivationWeights,o=void 0===_ref20$preluActivatio?null:_ref20$preluActivatio,_ref20$leakyreluAlpha=_ref20.leakyreluAlpha,s=void 0===_ref20$leakyreluAlpha?0:_ref20$leakyreluAlpha,_ref20$activation=_ref20.activation,i=void 0===_ref20$activation?null:_ref20$activation,u=n.filterWidth,l=n.filterHeight,c=n.inChannels,d=n.outWidth,p=n.outHeight,f="channelsLast"===n.dataFormat,m=u*l*c,g=p*d,b=[m,g],x=[],v=Pl({inputs:{x:e},backend:r,attrs:{shape:e.shape.slice(1)}}),y=Pl({inputs:{x:t},backend:r,attrs:{shape:[1,m,Wt(t.shape)/m]}});x.push(v),x.push(y);var w=new cd(b,v.shape,n),k=r.runWebGLProgram(w,[v],"float32"),I=Pl({inputs:{x:k},backend:r,attrs:{shape:[1,b[0],b[1]]}});x.push(k),x.push(I);var C=null!=a,A=null!=o,E="leakyrelu"===i,_=i?Rl(i,!0):null,$=new Tl(I.shape,y.shape,[1,g,n.outChannels],!0,!1,C,_,A,E),N=[I,y];if(a&&N.push(a),A&&N.push(o),E){var _e127=r.makeTensorInfo([],"float32",_n(s,"float32"));N.push(_e127),x.push(_e127)}var S=r.runWebGLProgram($,N,"float32"),R=Pl({inputs:{x:S},backend:r,attrs:{shape:f?[1,p,d,n.outChannels]:[1,n.outChannels,p,d]}});x.push(S);for(var _i25=0,_x19=x;_i25<_x19.length;_i25++){var _e128=_x19[_i25];r.disposeIntermediateTensorInfo(_e128)}return R}var hd={kernelName:"Conv2D",backendName:"webgl",kernelFunc:function kernelFunc(e){var h,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dilations,c=r.dimRoundingMode,d=$a(u),p=va(a.shape,o.shape,s,l,i,c,!1,d);if(1!==p.filterHeight||1!==p.filterWidth||1!==p.dilationHeight||1!==p.dilationWidth||1!==p.strideHeight||1!==p.strideWidth||"SAME"!==p.padInfo.type&&"VALID"!==p.padInfo.type)if(mn().getBool("WEBGL_CONV_IM2COL")&&1===a.shape[0])h=pd({x:a,filter:o,convInfo:p,backend:n});else{var _e129=new ud(p);h=n.runWebGLProgram(_e129,[a,o],"float32")}else h=dd({x:a,filter:o,convInfo:p,backend:n});var f=Pl({inputs:{x:h},backend:n,attrs:{shape:p.outShape}});return n.disposeIntermediateTensorInfo(h),f}},fd=function fd(e){_classCallCheck(this,fd),this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,o="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(a,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},md=function md(e){_classCallCheck(this,md),this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,o="channelsLast"===e.dataFormat,s=t-1-e.padInfo.top,i=n-1-e.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(c,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(u,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},gd=function gd(e){_classCallCheck(this,gd),this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(e.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t," - ").concat(a,";\n\n            if (xF < 0 || xF >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(n," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(r," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},bd=function bd(e){_classCallCheck(this,bd),this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,o=e.strideHeight,s=e.strideWidth,i=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(i,", ").concat(u,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(t,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(a,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(e.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(t," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(n,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(n," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(r,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(r," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},xd={kernelName:"Conv2DBackpropFilter",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=r.filterShape,d=$a(u),p=va(a.shape,c,s,1,i,l,!1,d),h=new fd(p);return n.runWebGLProgram(h,[a,o],"float32")}},vd={kernelName:"Conv2DBackpropInput",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.inputShape,i=r.strides,u=r.pad,l=r.dataFormat,c=r.dimRoundingMode,d=$a(l),p=va(s,o.shape,i,1,u,c,!1,d),h=new md(p);return n.runWebGLProgram(h,[a,o],"float32")}},yd={kernelName:"Conv3D",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dilations,l=ya(a.shape,o.shape,s,u,i),c=new ld(l);return n.runWebGLProgram(c,[a,o],"float32")}},wd={kernelName:"Conv3DBackpropFilterV2",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.pad,u=r.filterShape,l=ya(a.shape,u,s,1,i),c=new gd(l);return n.runWebGLProgram(c,[a,o],"float32")}},kd={kernelName:"Conv3DBackpropInputV2",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.pad,i=r.strides,l=ya(r.inputShape,o.shape,i,1,s),c=new bd(l);return n.runWebGLProgram(c,[a,o],"float32")}},Id={kernelName:"Cos",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"})},Cd={kernelName:"Cosh",backendName:"webgl",kernelFunc:Nl({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"})},Ad=function Ad(e,t,n,r,a){_classCallCheck(this,Ad),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var _e130=_slicedToArray(e,4),o=_e130[0],s=_e130[1],i=_e130[2],u=_e130[3],l=_slicedToArray(t,1)[0],_n85=_slicedToArray(n,2),c=_n85[0],d=_n85[1];this.outputShape=[l,c,d,u];var p="bilinear"===r?1:0,h=s-1+".0",f=i-1+".0",_ref22=_slicedToArray(c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio","y1*".concat(h," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(h)],3),m=_ref22[0],g=_ref22[1],b=_ref22[2],_ref24=_slicedToArray(d>1?[""+(i-1)/(d-1),"(x2-x1) * width_ratio","x1*".concat(f," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(f)],3),x=_ref24[0],v=_ref24[1],y=_ref24[2];this.userCode="\n      const float height_ratio = float(".concat(m,");\n      const float width_ratio = float(").concat(x,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(o,") {\n          return;\n        }\n\n        float height_scale = ").concat(g,";\n        float width_scale = ").concat(v,";\n\n        float in_y = ").concat(b,";\n        if( in_y < 0.0 || in_y > ").concat(h," ) {\n          setOutput(float(").concat(a,"));\n          return;\n        }\n        float in_x = ").concat(y,";\n        if( in_x < 0.0 || in_x > ").concat(f," ) {\n          setOutput(float(").concat(a,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(p," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")},Ed={kernelName:"CropAndResize",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.boxes,s=t.boxInd,i=r.cropSize,u=r.method,l=r.extrapolationValue,c=new Ad(a.shape,o.shape,i,u,l);return n.runWebGLProgram(c,[a,o,s],"float32")}},_d=function(){function _d(e,t,n){_classCallCheck(this,_d),this.variableNames=["x"],this.outputShape=e;var r=e.length,a=t?"0.0":"getX(".concat($d(r,"coords"),")"),o=e[e.length-1],s="",i="";t?(s=n?"end != "+(o-1):"end != 0",i=n?"end + 1":"end - 1"):(s=n?"end + pow2 < ".concat(o):"end >= pow2",i=n?"end + pow2":"end - pow2"),this.userCode="\n      uniform float index;\n      void main() {\n        ".concat(ti(r)," coords = getOutputCoords();\n        int end = ").concat(Nd(r,"coords"),";\n        float val = ").concat(a,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(i,";\n          ").concat(Nd(r,"coords")," = idx;\n          val += getX(").concat($d(r,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}return _createClass(_d,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this49=this;return function(t,n){null==_this49.index&&(_this49.index=t.getUniformLocation(n,"index")),t.gl.uniform1f(_this49.index,e)}}}]),_d}();function $d(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}function Nd(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}var Sd={kernelName:"Cumsum",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.exclusive,i=r.reverse,u=a.shape.length,l=Ua([o],u),c=a;null!=l&&(c=Ql({inputs:{x:a},backend:n,attrs:{perm:l}}));var d=Ga(1,u)[0];if(d!==u-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(a.shape.length-1," but got axis=").concat(o));for(var p=c.shape[d],h=vl({inputs:{x:c},backend:n}),_e131=0;_e131<=Math.ceil(Math.log2(p))-1;_e131++){var _t134=new _d(c.shape,!1,i),_r74=_t134.getCustomSetupFunc(_e131),_a60=h;h=n.runWebGLProgram(_t134,[h],h.dtype,_r74),n.disposeIntermediateTensorInfo(_a60)}if(s){var _e132=new _d(c.shape,s,i),_t135=h;h=n.runWebGLProgram(_e132,[h],h.dtype),n.disposeIntermediateTensorInfo(_t135)}if(null!=l){var _e133=Ql({inputs:{x:h},backend:n,attrs:{perm:Va(l)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(c),_e133}return h}},Rd={kernelName:"DenseBincount",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.weights,s=r.size,i=r.binaryOutput;if(1===a.shape.length){var _e134=n.readSync(a.dataId),_t136=n.readSync(o.dataId),_r75=_u(_e134,_t136,o.dtype,o.shape,s);return n.makeTensorInfo([s],o.dtype,_r75)}if(2===a.shape.length){var _e135=n.bufferSync(a),_t137=n.bufferSync(o),_r76=$u(_e135,_t137,s,i);return n.makeTensorInfo(_r76.shape,o.dtype,_r76.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},Td=function(){function Td(e,t,n){_classCallCheck(this,Td),this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(t,";\n      int offset_h = imod(h, ").concat(t,");\n      int in_w = w / ").concat(t,";\n      int offset_w = imod(w, ").concat(t,");\n      int offset_d = (offset_h * ").concat(t," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return _createClass(Td,[{key:"getHeightCoordString",value:function getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),Td}(),Fd={kernelName:"DepthToSpace",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockSize,s=r.dataFormat;Bt(o>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(o)}));var i=a.shape[0],u="NHWC"===s?a.shape[1]:a.shape[2],l="NHWC"===s?a.shape[2]:a.shape[3],c="NHWC"===s?a.shape[3]:a.shape[1],d=u*o,p=l*o,h=c/(o*o),f=new Td("NHWC"===s?[i,d,p,h]:[i,h,d,p],o,s);return n.runWebGLProgram(f,[a],a.dtype)}},Md=function Md(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,Md),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,s=e.inWidth,i=e.padInfo.top,u=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,p=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,m=e.outChannels/e.inChannels,g="",b="";n&&(g=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),b="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(g,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(m,";\n        int q = d2 - d1 * ").concat(m,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(d,";\n\n          if (xR < 0 || xR >= ").concat(o,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(p,";\n\n            if (xC < 0 || xC >= ").concat(s,") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(x,"\n        ").concat(b,"\n        setOutput(result);\n      }\n    ")},Od=function Od(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,Od),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,s=e.inWidth,i=e.padInfo.top,u=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,p=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,m=f,g="int xR; int xC; int xCOffset;",_e136=0;_e136<h;_e136++)for(var _t138=0;_t138<f;_t138++)g+="\n          vec4 xTexelR".concat(_e136,"C").concat(2*_t138," = vec4(0.);\n          vec4 wR").concat(_e136,"C").concat(_t138," = vec4(0.);\n          vec4 xR").concat(_e136,"C").concat(_t138," = vec4(0.);");for(var _e137=0;_e137<h;_e137++)for(var _t139=0;_t139<m;_t139++){var _n86=2*_t139;if(g+="\n          xR = xRCorner + ".concat(_e137*d,";\n          xC = xCCorner + ").concat(_n86*p,";\n        "),1===c){if(_n86<f&&(g+=u%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ".concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(_e137,"C").concat(_n86," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    xTexelR").concat(_e137,"C").concat(_n86,".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR").concat(_e137,"C").concat(_n86," = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ").concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR").concat(_e137,"C").concat(_n86," = vec4(previous.zw, xTexelR").concat(_e137,"C").concat(_n86,".xy);\n                } else {\n                  xR").concat(_e137,"C").concat(_n86," = vec4(0, 0, xTexelR").concat(_e137,"C").concat(_n86,".xy);\n                }\n              "):"\n                if(xR >= 0 && xR < ".concat(o," && xC >= 0 && xC < ").concat(s,") {\n                  xTexelR").concat(_e137,"C").concat(_n86," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(_e137,"C").concat(_n86," = vec4(0.);\n                }\n\n                xR").concat(_e137,"C").concat(_n86," = xTexelR").concat(_e137,"C").concat(_n86,";\n              "),_n86+1<f)){var _t140=u%2==0?Dt(p):p;p%2==0&&u%2==1||p%2!=0&&u%2!=1?(g+="\n                  xCOffset = xC + ".concat(u%2," + ").concat(_t140,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(_e137,"C").concat(_n86+2," = getX(batch, xR, xCOffset, d1);\n                  }\n                "),p>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ".concat(o," &&\n                      xCOffset >= 0 && xCOffset < ").concat(s,") {\n                      xTexelR").concat(_e137,"C").concat(_n86," = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR").concat(_e137,"C").concat(_n86," = vec4(0.);\n                    }\n                  ")),g+="\n                  xR".concat(_e137,"C").concat(_n86+1," = vec4(\n                    xTexelR").concat(_e137,"C").concat(_n86,".zw, xTexelR").concat(_e137,"C").concat(_n86+2,".xy);\n                ")):g+="\n                  xCOffset = xC + ".concat(_t140,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(_e137,"C").concat(_n86+2," = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR").concat(_e137,"C").concat(_n86+1," = xTexelR").concat(_e137,"C").concat(_n86+2,";\n                ")}}else _n86<f&&(g+="\n              if(xR >= 0 && xR < ".concat(o,") {\n            "),u%2==1?(g+="\n                xCOffset = xC + 1 - ".concat(c,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(_e137,"C").concat(_n86," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(_e137,"C").concat(_n86," = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ").concat(s,") {\n                  xTexelR").concat(_e137,"C").concat(_n86+2," = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR").concat(_e137,"C").concat(_n86+2," = vec4(0.);\n                }\n\n                xR").concat(_e137,"C").concat(_n86," = vec4(\n                  xTexelR").concat(_e137,"C").concat(_n86,".zw, xTexelR").concat(_e137,"C").concat(_n86+2,".zw);\n              "),_n86+1<f&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ".concat(c,";\n                  if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR").concat(_e137,"C").concat(_n86+1," = vec4(xTexelR").concat(_e137,"C").concat(_n86+2,".xy, final.xy);\n                "))):(g+="\n                if(xC >= 0 && xC < ".concat(s,") {\n                  xTexelR").concat(_e137,"C").concat(_n86," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(_e137,"C").concat(_n86," = vec4(0.);\n                }\n\n                xCOffset = xC + ").concat(c,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(_e137,"C").concat(_n86+2," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(_e137,"C").concat(_n86+2," = vec4(0.);\n                }\n\n                xR").concat(_e137,"C").concat(_n86," = vec4(\n                  xTexelR").concat(_e137,"C").concat(_n86,".xy, xTexelR").concat(_e137,"C").concat(_n86+2,".xy);\n              "),_n86+1<f&&(g+="\n                  xR".concat(_e137,"C").concat(_n86+1," = vec4(\n                    xTexelR").concat(_e137,"C").concat(_n86,".zw, xTexelR").concat(_e137,"C").concat(_n86+2,".zw);\n                "))),g+="}");_n86<f&&(g+="\n            vec4 wTexelR".concat(_e137,"C").concat(_n86," = getW(").concat(_e137,", ").concat(_n86,", d1, q);\n            wR").concat(_e137,"C").concat(_n86," = vec4(wTexelR").concat(_e137,"C").concat(_n86,".xz, wTexelR").concat(_e137,"C").concat(_n86,".xz);\n          "),_n86+1<f&&(g+="\n              vec4 wTexelR".concat(_e137,"C").concat(_n86+1," = getW(").concat(_e137,", ").concat(_n86+1,", d1, q);\n              wR").concat(_e137,"C").concat(_n86+1," =\n                vec4(wTexelR").concat(_e137,"C").concat(_n86+1,".xz, wTexelR").concat(_e137,"C").concat(_n86+1,".xz);")))}for(var _e138=0;_e138<h;_e138++)for(var _t141=0;_t141<f;_t141++)g+="dotProd += xR".concat(_e138,"C").concat(_t141," * wR").concat(_e138,"C").concat(_t141,";");var b="",x="";n&&(b=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(n,"\n        }"),x="result = activation(result);");var v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(b,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(u,");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ").concat(g,"\n\n        vec4 result = dotProd;\n        ").concat(v,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")},Dd={kernelName:"DepthwiseConv2dNative",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dilations,l=r.dimRoundingMode,c=u;null==c&&(c=[1,1]),Bt(_a(s,c),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(c,"'")}));var p,d=va(a.shape,o.shape,s,c,i,l,!0);return p=mn().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels==1?new Od(d):new Md(d),n.runWebGLProgram(p,[a,o],"float32")}},Bd=function Bd(e){_classCallCheck(this,Bd),this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(a,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Ld=function Ld(e){_classCallCheck(this,Ld),this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(i,"; dm++) {\n              int d2 = d1 * ").concat(i," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Pd={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.dilations,u=r.pad,l=r.dimRoundingMode,c=r.filterShape,d=va(a.shape,c,s,i,u,l,!0),p=new Bd(d);return n.runWebGLProgram(p,[a,o],"float32")}},Wd={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.strides,i=r.dilations,u=r.pad,l=r.dimRoundingMode,d=va(r.inputShape,o.shape,s,i,u,l,!0),p=new Ld(d);return n.runWebGLProgram(p,[a,o],"float32")}},Ud=function Ud(e){_classCallCheck(this,Ud),this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},Vd={kernelName:"Diag",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(_toConsumableArray(r.shape),_toConsumableArray(r.shape)),o=Wt(r.shape),s=Pl({inputs:{x:r},backend:n,attrs:{shape:[o]}}),i=new Ud(o),u=n.runWebGLProgram(i,[s],s.dtype),l=Pl({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),l}},Gd=function Gd(e){_classCallCheck(this,Gd),this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,r=e.padInfo,a=e.strideHeight,o=e.strideWidth,s=e.filterHeight,i=e.filterWidth,u=e.dilationHeight,l=e.dilationWidth,c=r.top,d=r.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(a,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(c,", ").concat(d,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(u,";\n\n          if (hIn >= 0 && hIn < ").concat(t,") {\n            for (int w = 0; w < ").concat(i,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(n,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")},zd={kernelName:"Dilation2D",backendName:"webgl",kernelFunc:function kernelFunc(e){var c,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dilations,l=ga(a.shape,o.shape,s,i,"NHWC",u),d=new Gd(l),p=Pl({inputs:{x:c=n.runWebGLProgram(d,[a,o],"float32")},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(c),p}},Hd={kernelName:"Elu",backendName:"webgl",kernelFunc:Nl({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"})},jd={kernelName:"EluGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,o=mn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xl("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new bl("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(o,[r,a],r.dtype)}},Xd={kernelName:"Equal",backendName:"webgl",kernelFunc:Sl({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool"})},qd={kernelName:"Erf",backendName:"webgl",kernelFunc:Nl({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n'})},Qd="return exp(x);",Kd=Nl({opSnippet:Qd,packedOpSnippet:Qd,cpuKernelImpl:Ru}),Yd={kernelName:"Exp",backendName:"webgl",kernelFunc:Kd};function Zd(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,o=t.input,s=o.shape.length,i=o.shape.slice(),u=a;return a<0&&(Bt(-(s+1)<=a,(function(){return"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")})),u=s+a+1),i.splice(u,0,1),Pl({inputs:{x:o},backend:r,attrs:{shape:i}})}var Jd={kernelName:"ExpandDims",backendName:"webgl",kernelFunc:Zd},ep="return exp(x) - 1.0;",tp={kernelName:"Expm1",backendName:"webgl",kernelFunc:Nl({opSnippet:ep,packedOpSnippet:ep,cpuKernelImpl:Tu})},np=function np(e,t,n){_classCallCheck(this,np),this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var s,a=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),o=n?"".concat(r,".0"):"1.0";if("real"===e)s="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));s="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(a,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(s,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(r,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(o,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")};function rp(e,t,n){var r=n.texData.get(e.dataId),a=Wt(e.shape),o=e.shape[e.shape.length-1],s=Pl({inputs:{x:e},backend:n,attrs:{shape:[a/o,o]}}),i=s.shape,u=new np("real",i,t),l=new np("imag",i,t),c=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:i},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:i}],d=n.runWebGLProgram(u,c,"float32"),p=n.runWebGLProgram(l,c,"float32"),h=wl({inputs:{real:d,imag:p},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p);var f=Pl({inputs:{x:h},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(h),f}var ap={kernelName:"FFT",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend;return rp(t.input,!1,n)}},op=function(){function op(e,t){_classCallCheck(this,op),this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return _createClass(op,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this50=this;return function(t,n){null==_this50.valueLoc&&(_this50.valueLoc=t.getUniformLocationNoThrow(n,"value")),t.gl.uniform1f(_this50.valueLoc,e)}}}]),op}();function sp(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,o=n.dtype;if("string"===(o=o||tn(a))){var _e139=Kt(o,Wt(r));return _e139.fill(a),t.makeTensorInfo(r,o,_e139)}var _e140=new op(r,a),_n87=_e140.getCustomSetupFunc(a);return t.runWebGLProgram(_e140,[],o,_n87)}var gp,ip={kernelName:"Fill",backendName:"webgl",kernelFunc:sp},up=function up(e){_classCallCheck(this,up),this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(t," - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(t,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},lp={kernelName:"FlipLeftRight",backendName:"webgl",kernelFunc:function kernelFunc(_ref25){var e=_ref25.inputs,t=_ref25.backend,n=e.image,r=t,a=new up(n.shape);return r.runWebGLProgram(a,[n],n.dtype)}},cp="return floor(x);",dp={kernelName:"Floor",backendName:"webgl",kernelFunc:Nl({opSnippet:cp,packedOpSnippet:cp,cpuKernelImpl:Fu})},pp={kernelName:"FloorDiv",backendName:"webgl",kernelFunc:Sl({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"})},hp=function hp(e){_classCallCheck(this,hp),this.variableNames=["A"];var t=Is(),_e141=_slicedToArray(e,2),n=_e141[0],r=_e141[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(r,".0, ").concat(n,".0);\n\n        vec4 values = ").concat(t.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")},fp=function fp(e){_classCallCheck(this,fp),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Is(),_e142=_slicedToArray(e,2),n=_e142[0],r=_e142[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(r,".0, ").concat(n,".0);\n            vec4 values = ").concat(t.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")},mp={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,o=r.numChannels,s="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,i="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,_ref27=_slicedToArray(s?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),u=_ref27[0],l=_ref27[1],c=[l,u],d=[l,u,o];(i||s)&&(null==gp&&(gp=document.createElement("canvas").getContext("2d")),gp.canvas.width=u,gp.canvas.height=l,gp.drawImage(a,0,0,u,l),a=gp.canvas);var p=n.makeTensorInfo(c,"int32");n.texData.get(p.dataId).usage=jo.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),a);var h=mn().getBool("WEBGL_PACK")?new fp(d):new hp(d),f=n.runWebGLProgram(h,[p],"int32");return n.disposeData(p.dataId),f}},bp={kernelName:"FusedConv2D",backendName:"webgl",kernelFunc:function kernelFunc(e){var b,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dataFormat,d=r.dilations,p=r.dimRoundingMode,h=r.activation,f=r.leakyreluAlpha,m=$a(c),g=va(a.shape,o.shape,u,d,l,p,!1,m),x=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(mn().getBool("WEBGL_CONV_IM2COL")&&1===a.shape[0])b=pd({x:a,filter:o,convInfo:g,backend:n,bias:s,activation:h,preluActivationWeights:i,leakyreluAlpha:f});else{var _e143=null!=s,_t142=null!=i,_r77="leakyrelu"===h,_u17=h?Rl(h,!1):null,_l12=new ud(g,_e143,_u17,_t142,_r77),_c12=[a,o];if(s&&_c12.push(s),i&&_c12.push(i),_r77){var _e144=n.makeTensorInfo([],"float32",_n(f,"float32"));_c12.push(_e144),x.push(_e144)}b=n.runWebGLProgram(_l12,_c12,"float32")}else b=dd({x:a,filter:o,convInfo:g,backend:n,bias:s,activation:h,preluActivationWeights:i,leakyreluAlpha:f});var v=Pl({inputs:{x:b},backend:n,attrs:{shape:g.outShape}});return x.push(b),x.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}},xp={kernelName:"FusedDepthwiseConv2D",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dilations,d=r.dimRoundingMode,p=r.activation,h=r.leakyreluAlpha,f=[],m=c;null==m&&(m=[1,1]),Bt(_a(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var I,g=va(a.shape,o.shape,u,m,l,d,!0),b=mn().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1,x=p?Rl(p,b):null,v=[a,o],y=null!=s,w=null!=i,k="leakyrelu"===p;if(y&&v.push(s),w&&v.push(i),k){var _e145=n.makeTensorInfo([],"float32",_n(h,"float32"));v.push(_e145),f.push(_e145)}I=b?new Od(g,y,x,w,k):new Md(g,y,x,w,k);var C=n.runWebGLProgram(I,v,"float32");return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),C}},vp=function vp(e,t,n){_classCallCheck(this,vp),this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=ti(t.length),a=ti(n.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        ".concat(r," strides = ").concat(r,"(").concat(this.strides,");\n         void main() {\n          ").concat(a," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(o,";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")},yp={kernelName:"GatherNd",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,o=a.shape,s=o[o.length-1],_zr2=_slicedToArray(zr(r,a),4),i=_zr2[0],u=_zr2[1],l=_zr2[2],c=_zr2[3],d=Pl({inputs:{x:a},backend:n,attrs:{shape:[u,s]}}),p=Pl({inputs:{x:r},backend:n,attrs:{shape:[Wt(r.shape)/l,l]}}),h=new vp(s,c,[u,l]),f=n.runWebGLProgram(h,[p,d],p.dtype),m=Pl({inputs:{x:f},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}},wp=function wp(e,t){_classCallCheck(this,wp),this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var n=ti(this.rank),r=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],_t143=0;_t143<e.length;_t143++)2===_t143?r.push("int(getIndices(resRC.x, resRC.z))"):r.push("".concat(n[_t143]));return r.join()}(e);this.userCode="\n      void main() {\n        ".concat(n," resRC = getOutputCoords();\n        setOutput(getA(").concat(r,"));\n      }\n    ")},kp={kernelName:"GatherV2",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.indices,s=r.axis,i=r.batchDims,u=Bo(a,o,Xt(s,a.shape)[0],i),l=Wt(o.shape),c=[],d=Pl({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=Pl({inputs:{x:o},backend:n,attrs:{shape:[u.batchSize,l/u.batchSize]}});c.push(d),c.push(p);var h=[u.batchSize,u.outerSize,l/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([a,o])||"string"===a.dtype){var _e146=n.bufferSync(p),_t144=n.bufferSync(d),_r78=Mu(_t144,_e146,h);return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(u.outputShape,_r78.dtype,_r78.values)}var f=new wp(d.shape,h),m=n.runWebGLProgram(f,[d,p],d.dtype);c.push(m);var g=Pl({inputs:{x:m},backend:n,attrs:{shape:u.outputShape}});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},Ip={kernelName:"Greater",backendName:"webgl",kernelFunc:Sl({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:Ou,dtype:"bool"})},Cp={kernelName:"GreaterEqual",backendName:"webgl",kernelFunc:Sl({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool"})},Ap={kernelName:"IFFT",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend;return rp(t.input,!0,n)}},Ep={kernelName:"IsFinite",backendName:"webgl",kernelFunc:Nl({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"})},_p={kernelName:"IsInf",backendName:"webgl",kernelFunc:Nl({opSnippet:"return float(isinf(x));",dtype:"bool"})},$p={kernelName:"IsNan",backendName:"webgl",kernelFunc:Nl({opSnippet:"return float(isnan(x));",dtype:"bool"})},Np={kernelName:"Less",backendName:"webgl",kernelFunc:Sl({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:Du,dtype:"bool"})},Sp={kernelName:"LessEqual",backendName:"webgl",kernelFunc:Sl({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",dtype:"bool"})},Rp={kernelName:"LinSpace",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.num,s=Bu(r,a,o);return t.makeTensorInfo([s.length],"float32",s)}},Tp={kernelName:"Log",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (x < 0.0) return NAN;\n  return log(x);",packedOpSnippet:"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Lu})},Fp={kernelName:"Log1p",backendName:"webgl",kernelFunc:Nl({opSnippet:"return log(1.0 + x);"})},Mp={kernelName:"LogicalAnd",backendName:"webgl",kernelFunc:Sl({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"})},Op={kernelName:"LogicalNot",backendName:"webgl",kernelFunc:Nl({opSnippet:"return float(!(x >= 1.0));"})},Dp={kernelName:"LogicalOr",backendName:"webgl",kernelFunc:Sl({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"})},Bp=function Bp(e,t,n,r,a){_classCallCheck(this,Bp),this.variableNames=["x"],this.outputShape=[];var i,o=t,s=e[3]-1;this.outputShape=e;var u="float(".concat(n,") + float(").concat(r,") * sum");i=.5===a?"inversesqrt(".concat(u,")"):1===a?"1.0/(".concat(u,")"):"exp(log(".concat(u,") * float(-").concat(a,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(o,"; j <= ").concat(o,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(s,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(i,";\n        setOutput(val);\n      }\n    ")},Lp=function Lp(e,t,n,r,a){_classCallCheck(this,Lp),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,o=t,s=e[3]-1;this.outputShape=e;var u="float(".concat(n,") + float(").concat(r,") * sum");i=.5===a?"inversesqrt(".concat(u,")"):1===a?"1.0/(".concat(u,")"):"exp(log(".concat(u,") * float(-").concat(a,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(o,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(o,"; j <= ").concat(o,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(s,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(i,";\n        setOutput(result);\n      }\n    ")},Pp={kernelName:"LRN",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.depthRadius,s=r.bias,i=r.alpha,u=r.beta,l=mn().getBool("WEBGL_PACK_NORMALIZATION")?new Lp(a.shape,o,s,i,u):new Bp(a.shape,o,s,i,u);return n.runWebGLProgram(l,[a],a.dtype)}},Wp=function Wp(e,t,n,r,a){_classCallCheck(this,Wp),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(t,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(t," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(r,") * norm + float(").concat(n,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(r,")\n                * float(").concat(a,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(a,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")},Up={kernelName:"LRNGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.y,s=t.dy,i=r.depthRadius,u=r.bias,l=r.alpha,c=r.beta,d=new Wp(a.shape,i,u,l,c);return n.runWebGLProgram(d,[a,o,s],a.dtype)}};function Vp(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reductionIndices,s=r.keepDims,i=a.shape.length,u=Xt(o,a.shape),l=u,c=Ua(l,i),d=null!=c,p=n.shouldExecuteOnCPU([a]),h=a;if(d){if(p){for(var _e147=n.texData.get(h.dataId).values,_t145=new Array(i),_e148=0;_e148<_t145.length;_e148++)_t145[_e148]=a.shape[c[_e148]];var _r79=Ju(_e147,a.shape,a.dtype,c,_t145);h=n.makeTensorInfo(_t145,a.dtype),n.texData.get(h.dataId).values=_r79}else h=jl(a,c,n);l=Ga(l.length,i)}Wa("max",l,i);var g,_La12=_slicedToArray(La(h.shape,l),2),f=_La12[0],m=_La12[1],b=f;if(s&&(b=Pa(f,u)),p){var _e149=n.texData.get(h.dataId).values,_t146=Pu(_e149,Wt(m),b,a.dtype);g=n.makeTensorInfo(b,a.dtype),n.texData.get(g.dataId).values=_t146}else g=function(e,t,n,r){var a=Wt(t),o=Pl({inputs:{x:e},attrs:{shape:[Wt(e.shape)/a,a]},backend:r}),s=Gl(o,e.dtype,"max",r),i=Pl({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),i}(h,m,b,n);return d&&n.disposeIntermediateTensorInfo(h),g}var Gp={kernelName:"Max",backendName:"webgl",kernelFunc:Vp},zp={kernelName:"Maximum",backendName:"webgl",kernelFunc:Sl({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Wu})},Hp={kernelName:"MaxPool",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;ws(a,"maxPool");var o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode;Bt(_a(s,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l=ba(a.shape,o,s,1,i,u);if(1===l.filterWidth&&1===l.filterHeight&&Ut(l.inShape,l.outShape))return vl({inputs:{x:a},backend:n});var c=new wc(l,"max",!1);return n.runWebGLProgram(c,[a],a.dtype)}},jp={kernelName:"MaxPool3D",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.filterSize,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=xa(a.shape,o,s,[1,1,1],i,l,u),d=new kc(c,"max",!1);return n.runWebGLProgram(d,[a],a.dtype)}},Xp=function Xp(e){_classCallCheck(this,Xp),this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=a-1-e.padInfo.top,i=o-1-e.padInfo.left,u=a*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(a,";\n          wR += ").concat(r,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(n,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(u," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},qp=function qp(e){_classCallCheck(this,qp),this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,i=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=i-1-e.padInfo.front,d=u-1-e.padInfo.top,p=l-1-e.padInfo.left,h=i*u*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(c,", ").concat(d,", ").concat(p,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(i,";\n           wD += ").concat(a,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(u,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(h," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(u," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Qp={kernelName:"MaxPool3DGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,s=t.input,i=r.filterSize,u=r.strides,l=r.pad,c=r.dimRoundingMode,d=xa(s.shape,i,u,[1,1,1],l,c),p=new kc(d,"max",!0),h=n.runWebGLProgram(p,[s],s.dtype),f=new qp(d),m=n.runWebGLProgram(f,[a,h],s.dtype);return n.disposeIntermediateTensorInfo(h),m}},Kp={kernelName:"MaxPoolGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,i=o;ws([o,t.output],"maxPoolGrad");var u=r.filterSize,l=r.strides,c=r.pad,d=r.dimRoundingMode,p=ba(i.shape,u,l,1,c,d),h=new wc(p,"max",!0),f=n.runWebGLProgram(h,[i],i.dtype),m=new Xp(p),g=n.runWebGLProgram(m,[a,f],i.dtype);return n.disposeIntermediateTensorInfo(f),g}},Yp={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function kernelFunc(_ref28){var e=_ref28.inputs,t=_ref28.attrs,n=_ref28.backend,r=e.x,a=t.filterSize,o=t.strides,s=t.pad,i=t.includeBatchInIndex,u=n;Bt(4===r.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(r.shape.length,".")}));var l=[1,1];Bt(_a(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var c=ba(r.shape,a,o,l,s),_ref30=_slicedToArray(function(e,t,n,r){var a=new wc(n,"max",!1),o=r.runWebGLProgram(a,[e],"float32");return a=new wc(n,"max",!0,!0,t),[o,r.runWebGLProgram(a,[e],"float32")]}(r,i,c,u),2);return[_ref30[0],_ref30[1]]}},Zp={kernelName:"Mean",backendName:"webgl",kernelFunc:function kernelFunc(_ref31){var e=_ref31.inputs,t=_ref31.attrs,n=_ref31.backend,r=e.x,a=t.keepDims,o=t.axis,s=n,i=r.shape.length,u=Xt(o,r.shape),l=u,c=Ua(l,i),d=null!=c,p=s.shouldExecuteOnCPU([r]),h=[],f=r;if(d){if(p){for(var _e150=s.texData.get(f.dataId).values,_t147=new Array(i),_e151=0;_e151<_t147.length;_e151++)_t147[_e151]=r.shape[c[_e151]];var _n88=Ju(_e150,r.shape,r.dtype,c,_t147);f=s.makeTensorInfo(_t147,r.dtype),s.texData.get(f.dataId).values=_n88}else f=jl(r,c,s);h.push(f),l=Ga(l.length,i)}Wa("sum",l,i);var _La14=_slicedToArray(La(f.shape,l),2),m=_La14[0],g=_La14[1],b=m;a&&(b=Pa(m,u));for(var x=function(e,t,n,r){var a=Wt(t),o=Pl({inputs:{x:e},attrs:{shape:[Wt(e.shape)/a,a]},backend:r}),s=Gl(o,"float32","mean",r),i=Pl({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),i}(f,g,b,s),_i26=0,_h6=h;_i26<_h6.length;_i26++){var _e152=_h6[_i26];s.disposeIntermediateTensorInfo(_e152)}return x}},Jp={kernelName:"Min",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,i=a.shape.length,u=Xt(o,a.shape),l=u,c=Ua(l,i),d=a;null!=c&&(d=Ql({inputs:{x:a},backend:n,attrs:{perm:c}}),l=Ga(l.length,a.shape.length)),Wa("min",l,i);var g,_La16=_slicedToArray(La(d.shape,l),2),p=_La16[0],f=Pl({inputs:{x:d},backend:n,attrs:{shape:[-1,Wt(_La16[1])]}}),m=Gl(f,f.dtype,"min",n);return g=Pl(s?{inputs:{x:m},backend:n,attrs:{shape:Pa(p,u)}}:{inputs:{x:m},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(d),g}},eh={kernelName:"Minimum",backendName:"webgl",kernelFunc:Sl({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Uu})},th=function th(e,t,n){_classCallCheck(this,th),this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,a=ti(r),o=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u="reflect"===n?0:1;this.userCode=1!==r?"\n      ".concat(a," start = ").concat(a,"(").concat(o,");\n      ").concat(a," end = ").concat(a,"(").concat(s,");\n\n      void main() {\n        ").concat(a," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(r,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(u,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(u,";\n          }\n        }\n        ").concat(a," coords = outC - start;\n        setOutput(getX(").concat(i,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(u,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(u,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")},nh=function nh(e,t,n){_classCallCheck(this,nh),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,a=ti(r),o=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),i=nl("rc",r),u=nl("source",r),l="".concat(i[r-1]," < ").concat(this.outputShape[r-1]),c=1===r?"source":"vec2(".concat(u.slice(-2).join(),")"),d="reflect"===n?0:1,p="";if(1===r){var _e153="\n        ".concat(a," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(d,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(d,";\n        }\n        source -= start;\n      ");p="\n        ".concat(a," rc = outputLoc;\n        ").concat(_e153,"\n        result[0] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n        ").concat(i[r-1]," += 1;\n        if(").concat(l,") {\n          ").concat(_e153,"\n          result[1] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n        }\n      ")}else{var _e154="\n        ".concat(a," source = rc;\n        ").concat(a," lt = ").concat(a,"(lessThan(source, start));\n        ").concat(a," gte = ").concat(a,"(greaterThanEqual(source, end));\n        ").concat(a," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(d,") +\n                gte * ((end - 1) * 2 - source + ").concat(d,");\n        source -= start;\n      ");p="\n        ".concat(a," rc = outputLoc;\n        ").concat(_e154,"\n        result[0] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n        ").concat(i[r-1]," += 1;\n        if(").concat(l,") {\n          ").concat(_e154,"\n          result[1] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n        }\n        rc = outputLoc;\n        ").concat(i[r-2]," += 1;\n        if(").concat(i[r-2]," < ").concat(this.outputShape[r-2],") {\n          ").concat(_e154,"\n          result[2] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n          ").concat(i[r-1]," += 1;\n          if(").concat(l,") {\n            ").concat(_e154,"\n            result[3] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(a," start = ").concat(a,"(").concat(o,");\n      const ").concat(a," end = ").concat(a,"(").concat(s,");\n\n      void main() {\n        ").concat(a," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")},rh={kernelName:"MirrorPad",backendName:"webgl",kernelFunc:function kernelFunc(_ref32){var e=_ref32.inputs,t=_ref32.backend,n=_ref32.attrs,r=e.x,a=n.paddings,o=n.mode,s=mn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nh(r.shape,a,o):new th(r.shape,a,o);return t.runWebGLProgram(s,[r],r.dtype)}},ah={kernelName:"Mod",backendName:"webgl",kernelFunc:Sl({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},oh=function(){function oh(e,t,n){_classCallCheck(this,oh),this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(t-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(t-1,"));\n      }\n    ")}return _createClass(oh,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this51=this;return function(t,n){null==_this51.seedLoc&&(_this51.seedLoc=t.getUniformLocation(n,"seed")),t.gl.uniform1f(_this51.seedLoc,e)}}}]),oh}(),sh=Sl({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),ih={kernelName:"RealDiv",backendName:"webgl",kernelFunc:sh},uh="return a - b;",lh=Sl({opSnippet:uh,packedOpSnippet:uh,supportsComplex:!0,cpuKernelImpl:Ku}),ch={kernelName:"Sub",backendName:"webgl",kernelFunc:lh};function dh(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,s=Xt([r.dim],a.shape),i=Vp({inputs:{x:a},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),u=Pa(i.shape,s),l=Pl({inputs:{x:i},backend:n,attrs:{shape:u}}),c=lh({inputs:{a:a,b:l},backend:n}),d=Kd({inputs:{x:c},backend:n}),p=Xl({inputs:{x:d},backend:n,attrs:{axis:s,keepDims:!1}}),h=Pl({inputs:{x:p},backend:n,attrs:{shape:u}}),f=sh({inputs:{a:d,b:h},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),f}var ph={kernelName:"Softmax",backendName:"webgl",kernelFunc:dh},hh={kernelName:"Multinomial",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,o=r.numSamples,s=r.seed,i=r.normalized,u=i?a:dh({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),l=u.shape[0],c=u.shape[1],d=new oh(l,c,o),p=d.getCustomSetupFunc(s),h=n.runWebGLProgram(d,[u],"int32",p);return i||n.disposeIntermediateTensorInfo(u),h}},fh="return -x;",mh={kernelName:"Neg",backendName:"webgl",kernelFunc:function kernelFunc(e){var a,t=e.inputs,n=e.backend,r=t.x;if(n.shouldExecuteOnCPU([r])){var _e155=n.texData.get(r.dataId),_Gu2=_slicedToArray(Gu(_e155.values,r.shape,r.dtype),2),_t148=_Gu2[0],_a61=_Gu2[1];return n.makeTensorInfo(_a61,r.dtype,_t148)}return a=mn().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new pl(r.shape,fh):new ll(r.shape,fh),n.runWebGLProgram(a,[r],r.dtype)}},gh=uo,bh={kernelName:"NonMaxSuppressionV3",backendName:"webgl",kernelFunc:function kernelFunc(e){Ao("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold,l=n.readSync(a.dataId),c=n.readSync(o.dataId),d=gh(l,c,s,i,u).selectedIndices;return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},xh=lo,vh={kernelName:"NonMaxSuppressionV4",backendName:"webgl",kernelFunc:function kernelFunc(e){Ao("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold,l=r.padToMaxOutputSize,c=n.readSync(a.dataId),d=n.readSync(o.dataId),_xh=xh(c,d,s,i,u,l),p=_xh.selectedIndices,h=_xh.validOutputs;return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},yh=co,wh={kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function kernelFunc(e){Ao("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold,l=r.softNmsSigma,c=n.readSync(a.dataId),d=n.readSync(o.dataId),_yh=yh(c,d,s,i,u,l),g=_yh.selectedIndices,b=_yh.selectedScores;return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([b.length],"float32",new Float32Array(b))]}},kh=function kh(e,t,n,r){_classCallCheck(this,kh),this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(r,"), float(").concat(n,"),\n                      float(index == coords.y)));\n      }\n    ")},Ih={kernelName:"OneHot",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=r.depth,s=r.onValue,i=r.offValue,u=Wt(a.shape),l=new kh(u,o,s,i),c=Pl({inputs:{x:a},backend:n,attrs:{shape:[u]}}),d=n.runWebGLProgram(l,[c],a.dtype);n.disposeIntermediateTensorInfo(c);var p=Pl({inputs:{x:d},backend:n,attrs:{shape:[].concat(_toConsumableArray(a.shape),[o])}});return n.disposeIntermediateTensorInfo(d),p}};function Ch(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var _e156=Vc({inputs:{input:r},backend:n}),_t149=Ch({inputs:{x:_e156},backend:n}),_a62=nd({inputs:{input:r},backend:n}),_o43=Ch({inputs:{x:_a62},backend:n}),_s28=wl({inputs:{real:_t149,imag:_o43},backend:n});return n.disposeIntermediateTensorInfo(_e156),n.disposeIntermediateTensorInfo(_t149),n.disposeIntermediateTensorInfo(_a62),n.disposeIntermediateTensorInfo(_o43),_s28}return sp({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var Ah={kernelName:"ZerosLike",backendName:"webgl",kernelFunc:Ch},Eh={kernelName:"OnesLike",backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var _t150=Vc({inputs:{input:a},backend:r}),_n89=e({inputs:{x:_t150},backend:r}),_o44=nd({inputs:{input:a},backend:r}),_s29=Ch({inputs:{x:_o44},backend:r}),_i27=wl({inputs:{real:_n89,imag:_s29},backend:r});return r.disposeIntermediateTensorInfo(_t150),r.disposeIntermediateTensorInfo(_n89),r.disposeIntermediateTensorInfo(_o44),r.disposeIntermediateTensorInfo(_s29),_i27}return sp({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}},_h={kernelName:"Pack",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,a=e.attrs.axis;if(1===t.length)return Zd({inputs:{input:t[0]},backend:n,attrs:{dim:a}});var o=t[0].shape,s=t[0].dtype;t.forEach((function(e){Lt(o,e.shape,"All tensors passed to stack must have matching shapes"),Bt(s===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=[],u=sd({inputs:t.map((function(e){var t=Zd({inputs:{input:e},backend:n,attrs:{dim:a}});return i.push(t),t})),backend:n,attrs:{axis:a}});return i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}},$h=function(){function $h(e,t,n){_classCallCheck(this,$h),this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,a=ti(r),o=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      ".concat(a," start = ").concat(a,"(").concat(o,");\n      ").concat(a," end = ").concat(a,"(").concat(s,");\n      uniform float value;\n\n      void main() {\n        ").concat(a," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(a," coords = outC - start;\n          setOutput(getX(").concat(i,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n        uniform float value;\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")}return _createClass($h,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this52=this;return function(t,n){null==_this52.valueLoc&&(_this52.valueLoc=t.getUniformLocationNoThrow(n,"value")),t.gl.uniform1f(_this52.valueLoc,e)}}}]),$h}(),Nh=function(){function Nh(e,t,n){_classCallCheck(this,Nh),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,a=ti(r),o=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),i=nl("rc",r),u=nl("source",r),l="".concat(i[r-1]," < ").concat(this.outputShape[r-1]),c=1===r?"source":"vec2(".concat(u.slice(-2).join(),")"),d=["".concat(a," rc = outputLoc;"),"".concat(i[r-1]," += 1;\n       if(").concat(l,") {\n      "),1===r?"":"}\n       rc = outputLoc;\n       ".concat(i[r-2]," += 1;\n       if(").concat(i[r-2]," < ").concat(this.outputShape[r-2],") {"),1===r?"":"  ".concat(i[r-1]," += 1;\n         if(").concat(l,") {")],p=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",_e157=0,_t151=1===r?2:4;_e157<_t151;_e157++)h+="\n        ".concat(d[_e157],"\n        if (").concat(p,") {\n          result[").concat(_e157,"] = float(value);\n        } else {\n          ").concat(a," source = rc - start;\n          result[").concat(_e157,"] = getChannel(getX(").concat(u.join(),"), ").concat(c,");\n        }\n      ");h+=1===r?"} ":"}}",this.userCode="\n      const ".concat(a," start = ").concat(a,"(").concat(o,");\n      const ").concat(a," end = ").concat(a,"(").concat(s,");\n      uniform float value;\n\n      void main() {\n        ").concat(a," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(h,"\n        setOutput(result);\n      }\n    ")}return _createClass(Nh,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e){var _this53=this;return function(t,n){null==_this53.valueLoc&&(_this53.valueLoc=t.getUniformLocationNoThrow(n,"value")),t.gl.uniform1f(_this53.valueLoc,e)}}}]),Nh}(),Sh=function Sh(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.paddings,s=r.constantValue,i=mn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Nh(a.shape,o,s):new $h(a.shape,o,s),u=i.getCustomSetupFunc(s);return n.runWebGLProgram(i,[a],a.dtype,u)},Rh={kernelName:"PadV2",backendName:"webgl",kernelFunc:Sh},Th={kernelName:"Pow",backendName:"webgl",kernelFunc:Sl({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},Fh={kernelName:"Prod",backendName:"webgl",kernelFunc:function kernelFunc(e){var p,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,i=a.shape.length,u=[],l=Xt(o,a.shape),c=l,d=Ua(c,i),h=a;if(null!=d&&(h=Ql({inputs:{x:a},backend:n,attrs:{perm:d}}),c=Ga(c.length,i),u.push(h)),Wa("prod",c,i),n.shouldExecuteOnCPU([h])){var _e158=n.texData.get(h.dataId).values,_zu=zu(h.shape,h.dtype,_e158,c),_t152=_zu.outVals,_r80=_zu.outShape,_a63=_zu.outDtype;p=n.makeTensorInfo(_r80,_a63,_t152)}else{var _La18=_slicedToArray(La(h.shape,c),2),_e159=_La18[0],_r81=Wt(_La18[1]),_o45=Pl({inputs:{x:h},backend:n,attrs:{shape:[-1,_r81]}}),_s30=Gl(_o45,Zn(a.dtype),"prod",n);p=Pl({inputs:{x:_s30},backend:n,attrs:{shape:_e159}}),u.push(_o45),u.push(_s30)}if(s){u.push(p);var _e160=Pa(p.shape,l);p=Pl({inputs:{x:p},backend:n,attrs:{shape:_e160}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),p}},Mh=function Mh(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.step,s=n.dtype,i=Hu(r,a,o,s);return t.makeTensorInfo([i.length],s,i)},Oh={kernelName:"Range",backendName:"webgl",kernelFunc:Mh},Dh={kernelName:"Reciprocal",backendName:"webgl",kernelFunc:Nl({opSnippet:"return 1.0 / x;"})},Bh={kernelName:"Relu",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},Lh={kernelName:"Relu6",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},Ph=function Ph(e,t,n,r,a){_classCallCheck(this,Ph),this.variableNames=["A"],this.outputShape=[];var _e161=_slicedToArray(e,4),o=_e161[0],s=_e161[1],i=_e161[2],u=_e161[3];this.outputShape=[o,t,n,u];var d,l=[r&&t>1?s-1:s,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];d=a?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/c[0],",\n          ").concat(l[1]/c[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(i,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")},Wh=function Wh(e,t,n,r,a){_classCallCheck(this,Wh),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var _e162=_slicedToArray(e,4),o=_e162[0],s=_e162[1],i=_e162[2],u=_e162[3];this.outputShape=[o,t,n,u];var d,l=[r&&t>1?s-1:s,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];d=a?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(l[0]/c[0],",\n          ").concat(l[1]/c[1],",\n          ").concat(l[1]/c[1],");\n      const vec3 inputShapeRC = vec3(").concat(s,".0, ").concat(i,".0,\n                                     ").concat(i,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(u-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")},Uh={kernelName:"ResizeBilinear",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,_i28=_slicedToArray(r.size,2),u=_i28[0],l=_i28[1],c=mn().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Wh(a.shape,u,l,o,s):new Ph(a.shape,u,l,o,s);return n.runWebGLProgram(c,[a],"float32")}},Vh=function Vh(e,t,n){_classCallCheck(this,Vh),this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var _t154=_slicedToArray(t,3),r=_t154[1],a=_t154[2],_e163=_slicedToArray(e,3),o=_e163[1],s=_e163[2],i=[n&&o>1?r-1:r,n&&s>1?a-1:a],u=[n&&o>1?o-1:o,n&&s>1?s-1:s],l=i[0]/u[0],c=i[1]/u[1],d=1/l,p=1/c,h=2*Math.ceil(d)+2,f=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(l,");\n        const float widthScale = float(").concat(c,");\n\n        const float invHeightScale = float(").concat(d,");\n        const float invWidthScale = float(").concat(p,");\n\n        const int winHeight = int(").concat(h,");\n        const int winWidth = int(").concat(f,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(o,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(s,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(r-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(a-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},Gh={kernelName:"ResizeBilinearGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,s=r.alignCorners,i=new Vh(o.shape,a.shape,s);return n.runWebGLProgram(i,[o],o.dtype)}},zh=function zh(e,t,n,r,a){_classCallCheck(this,zh),this.variableNames=["A"],this.outputShape=[];var _e164=_slicedToArray(e,4),o=_e164[0],s=_e164[1],i=_e164[2],u=_e164[3];this.outputShape=[o,t,n,u];var p,l=[r&&t>1?s-1:s,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=r?"0.5":"0.0";p=a?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/c[0],",\n          ").concat(l[1]/c[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(i,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(d,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")},Hh={kernelName:"ResizeNearestNeighbor",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,_i29=_slicedToArray(r.size,2),u=_i29[0],l=_i29[1],c=new zh(a.shape,u,l,o,s);return n.runWebGLProgram(c,[a],a.dtype)}},jh=function jh(e,t,n){_classCallCheck(this,jh),this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var _t155=_slicedToArray(t,3),r=_t155[1],a=_t155[2],_e165=_slicedToArray(e,3),o=_e165[1],s=_e165[2],i=[n&&o>1?r-1:r,n&&s>1?a-1:a],u=[n&&o>1?o-1:o,n&&s>1?s-1:s],l=i[0]/u[0],c=i[1]/u[1],d=1/l,p=1/c,h=2*Math.ceil(d)+2,f=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(l,");\n        const float widthScale = float(").concat(c,");\n\n        const float invHeightScale = float(").concat(d,");\n        const float invWidthScale = float(").concat(p,");\n\n        const int winHeight = int(").concat(h,");\n        const int winWidth = int(").concat(f,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(o,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(s,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(i[0],") *\n                (float(dyR) / float(").concat(u[0],"));\n\n            float sourceFracCol =\n                float(").concat(i[1],") *\n                  (float(dyC) / float(").concat(u[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(r,") - 1),\n                ").concat(n," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(a,") - 1),\n                ").concat(n," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},Xh={kernelName:"ResizeNearestNeighborGrad",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,s=r.alignCorners,i=new jh(o.shape,a.shape,s);return n.runWebGLProgram(i,[o],o.dtype)}},qh=function qh(e,t){_classCallCheck(this,qh),this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - coords[").concat(n,"] - 1"):"coords[".concat(n,"]")}(r)})).join(","),a=ti(n);this.userCode="\n      void main() {\n        ".concat(a," coords = getOutputCoords();\n        setOutput(getX(").concat(r,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(e[0]," - coord - 1));\n        }\n      ")},Qh=function Qh(e,t){_classCallCheck(this,Qh),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;var r=nl("rc",n),a="".concat(r[n-1]," + 1 < ").concat(this.outputShape[n-1]),o="".concat(r[n-2]," + 1 < ").concat(this.outputShape[n-2]),s=ti(n);function i(n){var r=e.map((function(r,a){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - ").concat(r[n]," - 1"):"".concat(r[n])}(a,n)}));return"getChannel(getX(".concat(r.join(","),"), vec2(").concat(r.slice(-2).join(","),"))")}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(e[0]," - rc - 1),\n            ").concat(e[0]," - rc - 1);\n          if(").concat(a,"){\n              result.g = getChannel(getX(").concat(e[0]," - (rc  + 1) - 1),\n                ").concat(e[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return i(e)}(r.slice()),";\n          if(").concat(a,"){\n            result.g = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",i(e)}(r.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[n-2]="("+e[n-2]+" + 1)",i(e)}(r.slice()),";\n            if(").concat(a,") {\n              result.a = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",i(e)}(r.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")},Kh={kernelName:"Reverse",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.dims,s=a.shape.length,i=Xt(o,a.shape);if(0===s)return vl({inputs:{x:a},backend:n});var u=mn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Qh(a.shape,i):new qh(a.shape,i);return n.runWebGLProgram(u,[a],a.dtype)}},Yh=function(){function Yh(e,t){_classCallCheck(this,Yh),this.variableNames=["Image"],this.outputShape=[];var n=e[1],r=e[2];this.outputShape=e;var a;a="number"==typeof t?"float outputValue = ".concat(t.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(t.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        uniform vec4 params;\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(a,"\n          if(coordX >= 0 && coordX < ").concat(r," && coordY >= 0 && coordY < ").concat(n,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}return _createClass(Yh,[{key:"getCustomSetupFunc",value:function getCustomSetupFunc(e,t,n,r){var _this54=this;return function(a,o){null==_this54.paramsLoc&&(_this54.paramsLoc=a.getUniformLocationNoThrow(o,"params")),a.gl.uniform4f(_this54.paramsLoc,e,t,n,r)}}}]),Yh}(),Zh={kernelName:"RotateWithOffset",backendName:"webgl",kernelFunc:function kernelFunc(_ref33){var e=_ref33.inputs,t=_ref33.attrs,n=_ref33.backend,r=e.image,a=t.radians,o=t.fillValue,s=t.center,i=n,u=new Yh(r.shape,o),_vo2=_slicedToArray(vo(s,r.shape[1],r.shape[2]),2),l=_vo2[0],c=_vo2[1],d=u.getCustomSetupFunc(l,c,Math.sin(a),Math.cos(a));return i.runWebGLProgram(u,[r],r.dtype,d)}},Jh={kernelName:"Round",backendName:"webgl",kernelFunc:Nl({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"})},ef={kernelName:"Rsqrt",backendName:"webgl",kernelFunc:Nl({opSnippet:"return inversesqrt(x);",cpuKernelImpl:ju})},tf=function tf(e,t,n,r,a,o){_classCallCheck(this,tf),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var i=ti(a.length),u=ti(o.length),l="";1===n?l="i":2===n&&(l="i, j");var c="getIndices(".concat(l,")"),d="";1===r?d="i":2===r&&(d="i, coords[1]");var p="getUpdates(".concat(d,")"),h=t>1?"strides[j]":"strides";this.userCode="\n        ".concat(i," strides = ").concat(i,"(").concat(a,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(e,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(t,"; j++) {\n              int index = round(").concat(c,");\n              flattenedIndex += index * ").concat(h,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(p,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")},nf={kernelName:"ScatterNd",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=t.updates,s=r.shape,_jr=jr(0,a,s),i=_jr.sliceRank,u=_jr.numUpdates,l=_jr.sliceSize,c=_jr.strides,d=_jr.outputSize,p=[d/l,l];if(0===d)return n.makeTensorInfo(s,a.dtype);var h=Pl({inputs:{x:a},backend:n,attrs:{shape:[u,i]}}),f=Pl({inputs:{x:o},backend:n,attrs:{shape:[u,l]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new tf(u,i,h.shape.length,f.shape.length,c,p),b=n.runWebGLProgram(g,[f,h,m],f.dtype),x=Pl({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(m),x}},rf=function rf(e,t,n){var r,a;if(_classCallCheck(this,rf),this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(1===n)a="resRC",r="resRC";else{for(var _n90=["resRC.x","resRC.y","resRC.z","resRC.w"],_o46=[],_s31=[],_r82=0;_r82<t.length;_r82++)_s31.push("".concat(_n90[_r82])),_r82<e&&_o46.push("".concat(_n90[_r82]));r=_o46.join(),a=_s31.join()}var o=ti(n);this.userCode="\n      void main() {\n        ".concat(o," resRC = getOutputCoords();\n        float cVal = getC(").concat(r,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(a,"));\n        } else {\n          setOutput(getB(").concat(a,"));\n        }\n      }\n    ")},af={kernelName:"Select",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,o=t.e,s=new rf(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(s,[r,a,o],Yn(a.dtype,o.dtype))}},of={kernelName:"Selu",backendName:"webgl",kernelFunc:Nl({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n"})},sf={kernelName:"Sigmoid",backendName:"webgl",kernelFunc:Nl({opSnippet:"return 1.0 / (1.0 + exp(-1.0 * x));"})},uf={kernelName:"Sign",backendName:"webgl",kernelFunc:Nl({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"})},lf={kernelName:"Sin",backendName:"webgl",kernelFunc:Nl({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"})},cf={kernelName:"Sinh",backendName:"webgl",kernelFunc:Nl({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"})},df={kernelName:"Softplus",backendName:"webgl",kernelFunc:Nl({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"})},pf={kernelName:"SpaceToBatchND",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,s=r.paddings;Bt(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var i=o.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,_toConsumableArray(s));for(var _e166=1+o.length;_e166<a.shape.length;++_e166)u.push([0,0]);var l=[],c=Sh({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),d=yo(c.shape,o,i,!1),p=wo(d.length,o.length,!1),h=ko(c.shape,o,i,!1),f=Pl({inputs:{x:c},backend:n,attrs:{shape:d}}),m=Ql({inputs:{x:f},backend:n,attrs:{perm:p}}),g=Pl({inputs:{x:m},backend:n,attrs:{shape:h}});return l.push(c),l.push(f),l.push(m),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},hf={kernelName:"SparseToDense",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,o=t.sparseValues,s=t.defaultValue,i=r.outputShape,_jr2=jr(0,a,i),u=_jr2.sliceRank,l=_jr2.numUpdates,c=_jr2.strides,d=_jr2.outputSize,p=new tf(l,u,a.shape.length,o.shape.length,c,[d,1],!1),h=n.runWebGLProgram(p,[o,a,s],o.dtype),f=Pl({inputs:{x:h},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(h),f}},ff={kernelName:"SplitV",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.numOrSizeSplits,i=Xt(r.axis,a.shape)[0],u=Mo(a,o,i),l=a.shape.length,c=new Array(l).fill(0),d=a.shape.slice();return u.map((function(e){var t=_toConsumableArray(d);t[i]=e;var r=Dc({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[i]+=e,r}))}},mf={kernelName:"Sqrt",backendName:"webgl",kernelFunc:Nl({opSnippet:"return sqrt(x);"})},gf={kernelName:"Square",backendName:"webgl",kernelFunc:Nl({opSnippet:"return x * x;"})},bf={kernelName:"SquaredDifference",backendName:"webgl",kernelFunc:Sl({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"})},xf={kernelName:"Step",backendName:"webgl",kernelFunc:function kernelFunc(_ref34){var e=_ref34.inputs,t=_ref34.attrs,n=_ref34.backend,r=e.x,a="if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(".concat(t.alpha,");\n  "),o=new ll(r.shape,a);return n.runWebGLProgram(o,[r],r.dtype)}},vf=function vf(e,t,n){_classCallCheck(this,vf),this.variableNames=["x"],this.outputShape=n;var r=n.length,a=ti(n.length),o=ti(n.length),s="";if(1===r)s="coords * strides + begin";else{var _e167=0;s=n.map((function(t,r){return _e167++,1===n.length?"coords * strides[".concat(r,"] + begin[").concat(r,"]"):"coords[".concat(_e167-1,"] * strides[").concat(r,"] + begin[").concat(r,"]")})).join(",")}this.userCode="\n      ".concat(a," begin = ").concat(a,"(").concat(e,");\n      ").concat(a," strides = ").concat(a,"(").concat(t,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")},yf={kernelName:"StridedSlice",backendName:"webgl",kernelFunc:function kernelFunc(e){var y,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.begin,s=r.end,i=r.strides,u=r.beginMask,l=r.endMask,c=r.ellipsisMask,d=r.newAxisMask,p=r.shrinkAxisMask,_ua=ua(a.shape,o,s,i,u,l,c,d,p),h=_ua.nonStrided,f=_ua.$begin,m=_ua.$strides,g=_ua.size,b=_ua.newShape,x=_ua.outShape,v=Pl({inputs:{x:a},backend:n,attrs:{shape:b}});if(h){var _e168=Dc({inputs:{x:v},backend:n,attrs:{begin:f,size:g}});y=Pl({inputs:{x:_e168},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(_e168)}else if(x.some((function(e){return 0===e})))y=n.makeTensorInfo(x,a.dtype,[]);else if(n.shouldExecuteOnCPU([v])){var _e169=n.texData.get(v.dataId).values,_t156=Ur(v.shape,v.dtype,_e169),_r83=Qu(x,_t156,m,f);y=n.makeTensorInfo(x,v.dtype,_r83.values)}else{var _e170=new vf(f,m,x);y=n.runWebGLProgram(_e170,[v],v.dtype)}var w=Pl({inputs:{x:y},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),w}},wf={kernelName:"Tan",backendName:"webgl",kernelFunc:Nl({opSnippet:"return tan(x);"})},kf={kernelName:"Tanh",backendName:"webgl",kernelFunc:Nl({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"})},If=function If(e,t){_classCallCheck(this,If),this.variableNames=["A"];for(var n=new Array(e.length),_r84=0;_r84<n.length;_r84++)n[_r84]=e[_r84]*t[_r84];this.outputShape=n,this.rank=n.length;var r=ti(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],_t157=0;_t157<e.length;_t157++)r.push("imod(".concat(n[_t157],", ").concat(e[_t157],")"));return r.join()}(e);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(a,"));\n      }\n    ")};function Cf(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reps;if("string"===a.dtype){var _e171=n.readSync(a.dataId).map((function(e){return Rn(e)})),_t158=Ur(a.shape,a.dtype,_e171),_r85=Yu(_t158,o);return n.makeTensorInfo(_r85.shape,_r85.dtype,_r85.values)}var s=new If(a.shape,o);return n.runWebGLProgram(s,[a],a.dtype)}for(var Af={kernelName:"Tile",backendName:"webgl",kernelFunc:Cf},Ef={kernelName:"TopK",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.k,s=r.sorted,i=n.readSync(a.dataId),_Zu2=_slicedToArray(Zu(i,a.shape,a.dtype,o,s),2),u=_Zu2[0],l=_Zu2[1];return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}},_f=function _f(e,t,n,r,a,o){_classCallCheck(this,_f),this.variableNames=["Image","Transforms"],this.outputShape=o;var i,s="nearest"===n?1:2;switch(r){case"constant":i=1;break;case"reflect":i=2;break;case"wrap":i=3;break;case"nearest":i=4;break;default:i=1}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(i," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(i," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(i," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(e," && 0 <= coordX && coordX < ").concat(t,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(a,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(a,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(t,"));\n                float mapY = mapCoord(inY, float(").concat(e,"));\n\n                if (").concat(s," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")},$f={kernelName:"Transform",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.transforms,s=r.interpolation,i=r.fillMode,u=r.fillValue,l=r.outputShape,_a$shape=_slicedToArray(a.shape,4),c=_a$shape[0],d=_a$shape[1],p=_a$shape[2],h=_a$shape[3],_ref36=_slicedToArray(null!=l?l:[d,p],2),f=_ref36[0],m=_ref36[1],g=new _f(d,p,s,i,u,[c,f,m,h]);return n.runWebGLProgram(g,[a,o],"float32")}},Nf={kernelName:"Unique",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,o=t.x;ws(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var s=r.readSync(o.dataId),_el=el(s,a,o.shape,o.dtype),i=_el.outputValues,u=_el.outputShape,l=_el.indices;return[r.makeTensorInfo(u,o.dtype,i),r.makeTensorInfo([l.length],"int32",l)]}},Sf={kernelName:"Unpack",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,o=r.axis;o<0&&(o+=a.shape.length);for(var s=a,i=s.shape.length,u=a.shape[o],l=new Array(i-1),c=0,_e172=0;_e172<i;_e172++)_e172!==o&&(l[c++]=s.shape[_e172]);var d=[],p=new Array(i).fill(0),h=s.shape.slice();h[o]=1;for(var f=new Array(u),_e173=0;_e173<f.length;_e173++){p[o]=_e173;var _t159=Dc({inputs:{x:s},backend:n,attrs:{begin:p,size:h}}),_r86=Pl({inputs:{x:_t159},backend:n,attrs:{shape:l}});f[_e173]=_r86,d.push(_t159)}return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),f}},Rf=function Rf(e,t){_classCallCheck(this,Rf),this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,a=e.inSize,o=e.numSegments,s=o*Math.ceil(a/n);this.outputShape=[r,s];var i=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";a%n>0&&(c="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return initializationValue;\n        }\n      "));var d="";a%n>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ".concat(c,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(d,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(n,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(i,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(i,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")},Tf=[Pp,Up,Zl,Jl,ec,tc,rc,sc,ic,uc,fc,mc,gc,bc,vc,xc,yc,Cc,Ic,_c,$c,Nc,Tc,Lc,Pc,zc,jc,Qc,Zc,kl,id,xd,vd,hd,wd,kd,yd,Id,Cd,Ed,Sd,Rd,Fd,Pd,Wd,Dd,Vd,zd,Hd,jd,Xd,qd,Yd,Jd,tp,ap,ip,lp,dp,pp,mp,bp,xp,yp,kp,Ip,Cp,yl,Ap,rd,Ep,_p,$p,Al,Np,Sp,Rp,Fp,Tp,Mp,Op,Dp,Gp,jp,Hp,Qp,Kp,Yp,zp,Zp,Jp,eh,rh,ah,hh,Ll,mh,bh,vh,wh,Uc,Ih,Eh,_h,Rh,Th,$l,Fh,Oh,Gc,ih,Dh,Lh,Bh,Wl,Uh,Gh,Hh,Xh,Kh,Zh,Jh,ef,nf,af,of,sf,uf,lf,cf,Bc,ph,df,pf,hf,ff,mf,gf,bf,xf,yf,ch,ql,wf,kf,Af,Ef,$f,Kl,Nf,Sf,{kernelName:"UnsortedSegmentSum",backendName:"webgl",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.segmentIds,s=r.numSegments,i=a.shape.length,u=[],l=0,c=Ua([l],i),d=a;null!=c&&(d=Ql({inputs:{x:a},backend:n,attrs:{perm:c}}),u.push(d),l=Ga(1,i)[0]);var p=Do(d.shape,l,s),h=Wt([d.shape[l]]),f=Pl({inputs:{x:d},backend:n,attrs:{shape:[-1,h]}});u.push(f);var b=Pl({inputs:{x:function g(e,t,r,a,o){var s=e.shape[0],i=e.shape[1],l=Oo(i,o),c=new Rf({windowSize:l,inSize:i,batchSize:s,numSegments:o},t),d=n.compileAndRun(c,[e,r],a);if(u.push(d),d.shape[1]===o)return d;var p=Mh({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),h=Cf({inputs:{x:p},backend:n,attrs:{reps:[i/l]}});return u.push(p),u.push(h),g(d,t,h,a,o)}(f,"unsortedSegmentSum",o,Zn(a.dtype),s)},backend:n,attrs:{shape:p}}),x=b;if(null!=c){u.push(b);var _e174=Va(c);x=Ql({inputs:{x:x},backend:n,attrs:{perm:_e174}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},Ah],_i30=0,_Tf=Tf;_i30<_Tf.length;_i30++){var _e175=_Tf[_i30];An(_e175)}var Ff=oo,Mf=function(_Ft2){_inherits(Mf,_Ft2);var _time3,_read2,_super3=_createSuper(Mf);function Mf(){var _this55;return _classCallCheck(this,Mf),(_this55=_super3.call(this)).blockSize=48,_this55.firstUse=!0,_this55.data=new Tt(_assertThisInitialized(_this55),da()),_this55}return _createClass(Mf,[{key:"nextDataId",value:function nextDataId(){return Mf.nextDataId++}},{key:"write",value:function write(e,t,n){this.firstUse&&(this.firstUse=!1,mn().get("IS_NODE")&&Ao("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function makeTensorInfo(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&en(n[0])){var _a64=n.map((function(e){return Sn(e)}));r=this.write(_a64,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function incRef(e){this.data.get(e).refCount++}},{key:"decRef",value:function decRef(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function move(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function numDataIds(){return this.data.numDataIds()}},{key:"read",value:(_read2=_asyncToGenerator(regeneratorRuntime.mark((function _callee22(e){return regeneratorRuntime.wrap((function _callee22$(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:return _context22.abrupt("return",this.readSync(e));case 1:case"end":return _context22.stop()}}),_callee22,this)}))),function read(_x20){return _read2.apply(this,arguments)})},{key:"readSync",value:function readSync(e){var _this$data$get=this.data.get(e),t=_this$data$get.dtype,n=_this$data$get.complexTensorInfos;return"complex64"===t?Eo(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):this.data.get(e).values}},{key:"bufferSync",value:function bufferSync(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return Rn(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ur(e.shape,e.dtype,n)}},{key:"makeOutput",value:function makeOutput(e,t,n){var r=this.write(e,t,n);return da().makeTensorFromDataId(r,t,n,this)}},{key:"disposeData",value:function disposeData(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var _this$data$get2=this.data.get(e),_n91=_this$data$get2.complexTensorInfos;null!=_n91&&(this.disposeData(_n91.real.dataId,!0),this.disposeData(_n91.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}},{key:"time",value:(_time3=_asyncToGenerator(regeneratorRuntime.mark((function _callee23(e){var t;return regeneratorRuntime.wrap((function _callee23$(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:return t=Nn(),e(),_context23.abrupt("return",{kernelMs:Nn()-t});case 3:case"end":return _context23.stop()}}),_callee23)}))),function time(_x21){return _time3.apply(this,arguments)})},{key:"memory",value:function memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function where(e){oi([e],"where");var t=this.readSync(e.dataId);return Ff(e.shape,t)}},{key:"dispose",value:function dispose(){}},{key:"floatPrecision",value:function floatPrecision(){return 32}},{key:"epsilon",value:function epsilon(){return _get(_getPrototypeOf(Mf.prototype),"epsilon",this).call(this)}}]),Mf}(Ft);Mf.nextDataId=0,fa("cpu",(function(){return new Mf}),1);var Of=Ei("Elu",(function(e){return e>=0?e:Math.exp(e)-1})),Df={kernelName:"Elu",backendName:"cpu",kernelFunc:Of};function Bf(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.alpha;oi([a],"leakyRelu");for(var s=Wt(a.shape),i=n.data.get(a.dataId).values,u=Qt("float32",s),_e176=0;_e176<i.length;_e176++)u[_e176]=i[_e176]<0?o*i[_e176]:i[_e176];return n.makeTensorInfo(a.shape,"float32",u)}var Lf={kernelName:"LeakyRelu",backendName:"cpu",kernelFunc:Bf},Pf=ui((function(e,t){return e<0?t*e:e}));function Wf(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;oi([r,a],"prelu");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,_Pf2=_slicedToArray(Pf(r.shape,a.shape,o,s,r.dtype),2),i=_Pf2[0],u=_Pf2[1];return n.makeTensorInfo(u,r.dtype,i)}var Uf={kernelName:"Prelu",backendName:"cpu",kernelFunc:Wf},Vf=Ei("Relu",(function(e){return Math.max(0,e)})),Gf={kernelName:"Relu",backendName:"cpu",kernelFunc:Vf},zf=Ei("Relu6",(function(e){return Math.min(Math.max(0,e),6)})),Hf={kernelName:"Relu6",backendName:"cpu",kernelFunc:zf};function jf(e,t,n,r,a){if("linear"===n)return pi({inputs:{x:t},backend:e});if("relu"===n)return Vf({inputs:{x:t},backend:e});if("elu"===n)return Of({inputs:{x:t},backend:e});if("relu6"===n)return zf({inputs:{x:t},backend:e});if("prelu"===n)return Wf({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return Bf({inputs:{x:t},backend:e,attrs:{alpha:a}});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function Xf(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.shape,s=Wt(a.shape),i=jt(o,s),u=Wt(i);Bt(s===u,(function(){return"The new shape (".concat(i,") has ").concat(u," elements and the old shape (").concat(a.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")})),n.incRef(a.dataId);var l=n.data.get(a.dataId);if(null!=l.complexTensorInfos){var _e177=l.complexTensorInfos.real,_t160=l.complexTensorInfos.imag;_e177.shape=i,_t160.shape=i}return{dataId:a.dataId,shape:i,dtype:a.dtype}}var qf={kernelName:"Reshape",backendName:"cpu",kernelFunc:Xf};function Qf(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=r.transposeA,i=r.transposeB;oi([a,o],"matMul");var u=a.shape.length,l=o.shape.length,c=s?a.shape[u-2]:a.shape[u-1],d=i?o.shape[l-1]:o.shape[l-2],p=s?a.shape[u-1]:a.shape[u-2],h=i?o.shape[l-2]:o.shape[l-1],f=a.shape.slice(0,-2),m=o.shape.slice(0,-2),g=Wt(f),b=Wt(m);Bt(u>=2&&l>=2&&(g===b||1===g||1===b),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(f,") and (").concat(m,").")}));var x=(g>b?a.shape.slice(0,-2):o.shape.slice(0,-2)).concat([p,h]);Bt(c===d,(function(){return"Error in matMul: inner shapes (".concat(c,") and (").concat(d,") of Tensors with shapes ").concat(a.shape," and ").concat(o.shape," and transposeA=").concat(s," and transposeB=").concat(i," must match.")}));for(var v=i?[b,h,d]:[b,d,h],y=Xf({inputs:{x:a},backend:n,attrs:{shape:s?[g,c,p]:[g,p,c]}}),w=Xf({inputs:{x:o},backend:n,attrs:{shape:v}}),k=s?y.shape[1]:y.shape[2],I=s?y.shape[2]:y.shape[1],C=i?w.shape[1]:w.shape[2],A=Math.max(g,b),E=n.data.get(y.dataId).values,_=n.data.get(w.dataId).values,$=an(y.shape),N=an(w.shape),_ref38=_slicedToArray(s?[$[0],1,$[1]]:[$[0],$[1],1],3),S=_ref38[0],R=_ref38[1],T=_ref38[2],_ref40=_slicedToArray(i?[1,N[1],N[0]]:[N[1],1,N[0]],3),F=_ref40[0],M=_ref40[1],O=_ref40[2],D=I*C,B=Ur([A,I,C],y.dtype),L=B.values,P=n.blockSize,_e178=0;_e178<A;_e178++)for(var _t161=0;_t161<I;_t161+=P)for(var _n92=0;_n92<C;_n92+=P)for(var _r87=0;_r87<k;_r87+=P)for(var _a65=Math.min(_t161+P,I),_o47=Math.min(_n92+P,C),_s32=Math.min(_r87+P,k),_i31=_t161;_i31<_a65;_i31++)for(var _t162=_n92;_t162<_o47;_t162++){for(var _n93=0,_a66=_r87;_a66<_s32;_a66++){var _r88=Math.min(_e178,g-1)*S,_o48=Math.min(_e178,b-1)*O;_n93+=E[_r88+_i31*R+_a66*T]*_[_a66*F+_t162*M+_o48]}L[_e178*D+(_i31*C+_t162)]+=_n93}return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(x,B.dtype,B.values)}var Kf={kernelName:"BatchMatMul",backendName:"cpu",kernelFunc:Qf},Yf={kernelName:"_FusedMatMul",backendName:"cpu",kernelFunc:function kernelFunc(e){var p,h,f,t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=t.bias,i=t.preluActivationWeights,u=r.transposeA,l=r.transposeB,c=r.activation,d=r.leakyreluAlpha,m=[];p=Qf({inputs:{a:a,b:o},attrs:{transposeA:u,transposeB:l},backend:n}),s&&(h=wi({inputs:{a:p,b:s},backend:n}),m.push(p),p=h),c&&(f=jf(n,p,c,i,d),m.push(p),p=f);for(var _i32=0,_m7=m;_i32<_m7.length;_i32++){var _e179=_m7[_i32];n.disposeIntermediateTensorInfo(_e179)}return p}},Zf={kernelName:"Acos",backendName:"cpu",kernelFunc:Ei("Acos",(function(e){return Math.acos(e)}))},Jf={kernelName:"Acosh",backendName:"cpu",kernelFunc:Ei("Acosh",(function(e){return Math.acosh(e)}))},em={kernelName:"AddN",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t;oi(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),o=Ur(r[0].shape,r[0].dtype),s=o.values,_e180=0;_e180<r.length;_e180++)for(var _t163=a[_e180],_e181=0;_e181<s.length;_e181++)s[_e181]+=_t163[_e181];return n.makeTensorInfo(o.shape,o.dtype,o.values)}},tm={kernelName:"All",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;oi(a,"all");var i=Xt(o,a.shape),u=i,l=Ua(u,a.shape.length),c=a;null!=l&&(c=su({inputs:{x:a},backend:n,attrs:{perm:l}}),u=Ga(u.length,a.shape.length)),Wa("all",u,c.shape.length);for(var _La20=_slicedToArray(La(c.shape,u),2),d=_La20[0],h=Wt(_La20[1]),f=un(Wt(d),c.dtype),m=n.data.get(c.dataId).values,_e182=0;_e182<f.length;++_e182){for(var _t164=_e182*h,_n94=m[_t164],_e183=0;_e183<h;++_e183){var _r89=m[_t164+_e183];_n94=_n94&&_r89}f[_e182]=_n94}null!=l&&n.disposeIntermediateTensorInfo(c);var g=n.makeTensorInfo(d,c.dtype,f);if(s){var _e184=Xf({inputs:{x:g},backend:n,attrs:{shape:Pa(d,i)}});return n.disposeIntermediateTensorInfo(g),_e184}return g}},nm={kernelName:"Any",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;oi(a,"any");var i=Xt(o,a.shape),u=i,l=Ua(u,a.shape.length),c=a;null!=l&&(c=su({inputs:{x:a},backend:n,attrs:{perm:l}}),u=Ga(u.length,a.shape.length)),Wa("any",u,c.shape.length);for(var _La22=_slicedToArray(La(c.shape,u),2),d=_La22[0],h=Wt(_La22[1]),f=un(Wt(d),c.dtype),m=n.data.get(c.dataId).values,_e185=0;_e185<f.length;++_e185){for(var _t165=_e185*h,_n95=m[_t165],_e186=0;_e186<h;++_e186){var _r90=m[_t165+_e186];_n95=_n95||_r90}f[_e185]=_n95}null!=l&&n.disposeIntermediateTensorInfo(c);var g=n.makeTensorInfo(d,c.dtype,f);if(s){var _e187=Xf({inputs:{x:g},backend:n,attrs:{shape:Pa(d,i)}});return n.disposeIntermediateTensorInfo(g),_e187}return g}},rm={kernelName:"ArgMax",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis;oi(a,"argMax");var s=Xt(o,a.shape),i=Ua(s,a.shape.length),u=a,l=[];null!=i&&(u=su({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),s=Ga(s.length,u.shape.length)),Wa("argMax",s=[s[0]],u.shape.length);for(var _La24=_slicedToArray(La(u.shape,s),2),c=_La24[0],d=_La24[1],p=un(Wt(c),"int32"),h=Wt(d),f=n.data.get(u.dataId).values,_e188=0;_e188<p.length;++_e188){for(var _t166=_e188*h,_n96=f[_t166],_r91=0,_e189=0;_e189<h;++_e189){var _a67=f[_t166+_e189];_a67>_n96&&(_n96=_a67,_r91=_e189)}p[_e188]=_r91}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(c,"int32",p)}},am={kernelName:"ArgMin",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis;oi(a,"argMin");var s=Xt(o,a.shape),i=Ua(s,a.shape.length),u=a,l=[];null!=i&&(u=su({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),s=Ga(s.length,u.shape.length)),Wa("argMin",s=[s[0]],u.shape.length);for(var _La26=_slicedToArray(La(u.shape,s),2),c=_La26[0],d=_La26[1],p=un(Wt(c),"int32"),h=Wt(d),f=n.data.get(u.dataId).values,_e190=0;_e190<p.length;++_e190){for(var _t167=_e190*h,_n97=f[_t167],_r92=0,_e191=0;_e191<h;++_e191){var _a68=f[_t167+_e191];_a68<_n97&&(_n97=_a68,_r92=_e191)}p[_e190]=_r92}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(c,"int32",p)}},om={kernelName:"Asin",backendName:"cpu",kernelFunc:Ei("Asin",(function(e){return Math.asin(e)}))},sm={kernelName:"Asinh",backendName:"cpu",kernelFunc:Ei("Asinh",(function(e){return Math.asinh(e)}))},im={kernelName:"Atan",backendName:"cpu",kernelFunc:Ei("Atan",(function(e){return Math.atan(e)}))},um={kernelName:"Atan2",backendName:"cpu",kernelFunc:xi("Atan2",ui((function(e,t){return Math.atan2(e,t)})))},lm={kernelName:"Atanh",backendName:"cpu",kernelFunc:Ei("Atanh",(function(e){return Math.atanh(e)}))};function cm(e,t,n,r,a,o){for(var s=a.strideHeight,i=a.strideWidth,u=a.dilationHeight,l=a.dilationWidth,c=a.effectiveFilterHeight,d=a.effectiveFilterWidth,p=a.padInfo.top,h=a.padInfo.left,f="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Ur(a.outShape,n),g=m.values,b=a.outShape[1]*a.outShape[2]*a.outShape[3],x=a.outShape[2]*a.outShape[3],v=a.outShape[3],_t168=0;_t168<a.batchSize;++_t168)for(var _n98=_t168*b,_m8=_t168*r[0],_t169=0;_t169<a.inChannels;++_t169)for(var _b5=0;_b5<a.outHeight;++_b5)for(var _y4=_b5*s-p,_w2=Math.max(0,_y4),_k=Math.min(a.inHeight,c+_y4),_I=_n98+_b5*x,_n99=0;_n99<a.outWidth;++_n99){for(var _s33=_n99*i-h,_c13=Math.max(0,_s33),_p7=Math.min(a.inWidth,d+_s33),_b6=f,_x22=0,_y5=0,_n100=_w2;_n100<_k;_n100+=u){for(var _a69=_m8+_n100*r[1],_n101=_c13;_n101<_p7;_n101+=l){var _s34=e[_a69+_n101*r[2]+_t169];"max"===o&&_s34>_b6?_b6=_s34:"avg"===o&&(_x22+=_s34,_y5++)}if(isNaN(_b6))break}g[_I+_n99*v+_t169]="avg"===o?_x22/_y5:_b6}return m}function dm(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=Ur(r.outShape,"int32"),i=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,m=Ur(t,n,e),_e192=0;_e192<r.batchSize;++_e192)for(var _t170=0;_t170<r.inChannels;++_t170)for(var _n102=0;_n102<r.outHeight;++_n102){for(var _g6=_n102*i-h,_b7=_g6;_b7<0;)_b7+=l;for(var _x23=Math.min(r.inHeight,d+_g6),_i33=0;_i33<r.outWidth;++_i33){for(var _d8=_i33*u-f,_h7=_d8;_h7<0;)_h7+=c;for(var _v4=Math.min(r.inWidth,p+_d8),_y6=Number.NEGATIVE_INFINITY,_w3=-1,_n103=_b7;_n103<_x23;_n103+=l)for(var _s35=_n103-_g6,_i34=_h7;_i34<_v4;_i34+=c){var _u18=_i34-_d8,_l13=m.get(_e192,_n103,_i34,_t170);_l13>_y6&&(_y6=_l13,_w3=a?o?((_e192*r.inHeight+_n103)*r.inWidth+_i34)*r.inChannels+_t170:(_n103*r.inWidth+_i34)*r.inChannels+_t170:_s35*p+_u18)}s.set(_w3,_e192,_n102,_i33,_t170)}}return s}function pm(e,t,n,r,a,o){for(var s=a.strideDepth,i=a.strideHeight,u=a.strideWidth,l=a.dilationDepth,c=a.dilationHeight,d=a.dilationWidth,p=a.effectiveFilterDepth,h=a.effectiveFilterHeight,f=a.effectiveFilterWidth,m=a.padInfo.front,g=a.padInfo.top,b=a.padInfo.left,x="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Ur(a.outShape,n),y=v.values,w=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],k=a.outShape[2]*a.outShape[3]*a.outShape[4],I=a.outShape[3]*a.outShape[4],C=a.outShape[4],_t171=0;_t171<a.batchSize;++_t171)for(var _n104=_t171*w,_v5=_t171*r[0],_t172=0;_t172<a.inChannels;++_t172)for(var _w4=0;_w4<a.outDepth;++_w4){for(var _A=_w4*s-m,_E=_A;_E<0;)_E+=l;for(var _2=Math.min(a.inDepth,p+_A),_$=_n104+_w4*k,_n105=0;_n105<a.outHeight;++_n105){for(var _s36=_n105*i-g,_p8=_s36;_p8<0;)_p8+=c;for(var _m9=Math.min(a.inHeight,h+_s36),_w5=_$+_n105*I,_n106=0;_n106<a.outWidth;++_n106){for(var _s37=_n106*u-b,_i35=_s37;_i35<0;)_i35+=d;for(var _h8=Math.min(a.inWidth,f+_s37),_g7=_w5+_n106*C,_k2=x,_I2=0,_A2=0,_n107=_E;_n107<_2;_n107+=l){for(var _a70=_v5+_n107*r[1],_n108=_p8;_n108<_m9;_n108+=c){for(var _s38=_a70+_n108*r[2],_n109=_i35;_n109<_h8;_n109+=d){var _a71=e[_s38+_n109*r[3]+_t172];if("max"===o&&_a71>_k2?_k2=_a71:"avg"===o&&(_I2+=_a71,_A2++),isNaN(_k2))break}if(isNaN(_k2))break}if(isNaN(_k2))break}y[_g7+_t172]="avg"===o?_I2/_A2:_k2}}}return v}var hm={kernelName:"AvgPool",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;oi(a,"avgPool");var o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode;Bt(_a(s,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var c,l=ba(a.shape,o,s,1,i,u);if(1===l.filterWidth&&1===l.filterHeight&&Ut(l.inShape,l.outShape))c=pi({inputs:{x:a},backend:n});else{var _e193=n.data.get(a.dataId).values,_t173=an(a.shape),_r93=cm(_e193,a.shape,a.dtype,_t173,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,_r93.values)}return c}},fm={kernelName:"AvgPool3D",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode,l=r.dataFormat;oi(a,"avgPool3d");var c=xa(a.shape,o,s,1,i,u,l),d=pm(n.data.get(a.dataId).values,a.shape,a.dtype,an(a.shape),c,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}},mm={kernelName:"AvgPool3DGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,s=r.filterSize,i=r.strides,u=r.pad,l=r.dimRoundingMode;oi([a,o],"avgPool3DGrad");for(var c=xa(o.shape,s,i,1,u,l),d=c.strideDepth,p=c.strideHeight,h=c.strideWidth,f=c.filterDepth,m=c.filterHeight,g=c.filterWidth,b=c.dilationDepth,x=c.dilationHeight,v=c.dilationWidth,y=c.effectiveFilterDepth,w=c.effectiveFilterHeight,k=c.effectiveFilterWidth,I=y-1-c.padInfo.front,C=k-1-c.padInfo.left,A=w-1-c.padInfo.top,E=Ur(o.shape,"float32"),_=1/(f*m*g),$=n.bufferSync(a),_e194=0;_e194<c.batchSize;++_e194)for(var _t174=0;_t174<c.inChannels;++_t174)for(var _n110=0;_n110<c.inDepth;++_n110)for(var _r94=0;_r94<c.inHeight;++_r94)for(var _a72=0;_a72<c.inWidth;++_a72){for(var _o49=_n110-I,_s39=_r94-A,_i36=_a72-C,_u19=0,_n111=0;_n111<y;_n111+=b){var _r95=(_o49+_n111)/d;if(!(_r95<0||_r95>=c.outDepth||Math.floor(_r95)!==_r95))for(var _n112=0;_n112<w;_n112+=x){var _a73=(_s39+_n112)/p;if(!(_a73<0||_a73>=c.outHeight||Math.floor(_a73)!==_a73))for(var _n113=0;_n113<k;_n113+=v){var _o50=(_i36+_n113)/h;_o50<0||_o50>=c.outWidth||Math.floor(_o50)!==_o50||(_u19+=$.get(_e194,_r95,_a73,_o50,_t174))}}}E.set(_u19*_,_e194,_n110,_r94,_a72,_t174)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}},gm={kernelName:"AvgPoolGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,s=o;oi([a,o],"avgPoolGrad");for(var i=r.filterSize,u=r.strides,l=r.pad,c=ba(s.shape,i,u,1,l),d=c.strideHeight,p=c.strideWidth,h=c.filterHeight,f=c.filterWidth,m=c.dilationHeight,g=c.dilationWidth,b=c.effectiveFilterHeight,x=c.effectiveFilterWidth,v=x-1-c.padInfo.left,y=b-1-c.padInfo.top,w=Ur(s.shape,"float32"),k=1/(h*f),I=n.data.get(a.dataId).values,C=Ur(a.shape,"float32",I),_e195=0;_e195<c.batchSize;++_e195)for(var _t175=0;_t175<c.inChannels;++_t175)for(var _n114=0;_n114<c.inHeight;++_n114)for(var _r96=0;_r96<c.inWidth;++_r96){for(var _a74=_n114-y,_o51=_r96-v,_s40=0,_n115=0;_n115<b;_n115+=m){var _r97=(_a74+_n115)/d;if(!(_r97<0||_r97>=c.outHeight||Math.floor(_r97)!==_r97))for(var _n116=0;_n116<x;_n116+=g){var _a75=(_o51+_n116)/p;_a75<0||_a75>=c.outWidth||Math.floor(_a75)!==_a75||(_s40+=C.get(_e195,_r97,_a75,_t175))}}w.set(_s40*k,_e195,_n114,_r96,_t175)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}},bm={kernelName:"FusedBatchNorm",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.scale,s=t.offset,i=t.mean,u=t.variance;Bt(i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Bt(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Bt(null==o||i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),oi([a,i,u,o,s],"batchNorm");var l=r.varianceEpsilon;null==l&&(l=.001);for(var c=n.data.get(a.dataId).values,d=n.data.get(i.dataId).values,p=n.data.get(u.dataId).values,h=o?n.data.get(o.dataId).values:new Float32Array([1]),f=s?n.data.get(s.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),g=f.length,b=h.length,x=p.length,v=d.length,y=0,w=0,k=0,I=0,_e196=0;_e196<c.length;++_e196)m[_e196]=f[y++]+(c[_e196]-d[w++])*h[k++]/Math.sqrt(p[I++]+l),y>=g&&(y=0),w>=v&&(w=0),k>=b&&(k=0),I>=x&&(I=0);return n.makeTensorInfo(a.shape,a.dtype,m)}},xm={kernelName:"BatchToSpaceND",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,s=r.crops;oi([a],"batchToSpaceND");var i=o.reduce((function(e,t){return e*t})),u=yo(a.shape,o,i),l=wo(u.length,o.length),c=ko(a.shape,o,i),d=Io(s,o.length),p=Co(c,s,o.length),h=Xf({inputs:{x:a},backend:n,attrs:{shape:u}}),f=su({inputs:{x:h},backend:n,attrs:{perm:l}}),m=Xf({inputs:{x:f},backend:n,attrs:{shape:c}}),g=fu({inputs:{x:m},backend:n,attrs:{begin:d,size:p}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}},vm={kernelName:"Bincount",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.weights,s=r.size,i=Ii(n.data.get(a.dataId).values,n.data.get(o.dataId).values,o.dtype,o.shape,s);return n.makeTensorInfo([s],o.dtype,i)}},ym={kernelName:"ClipByValue",backendName:"cpu",kernelFunc:Ei("ClipByValue",(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}))},wm={kernelName:"ComplexAbs",backendName:"cpu",kernelFunc:function kernelFunc(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(Wt(t.shape)),a=n.data.get(t.dataId),o=a.complexTensorInfos.real,s=a.complexTensorInfos.imag,i=n.data.get(o.dataId).values,u=n.data.get(s.dataId).values,_e197=0;_e197<i.length;_e197++){var _t176=i[_e197],_n117=u[_e197];r[_e197]=Math.hypot(_t176,_n117)}return n.makeOutput(r,t.shape,"float32")}};function km(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,o=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,o)}var Im={kernelName:"Imag",backendName:"cpu",kernelFunc:km};function Cm(e){var t=e.inputs,n=e.backend,o=Xt(e.attrs.axis,t[0].shape)[0],s=bo(t.map((function(e){return e.shape})),o);if(0===Wt(s))return n.makeTensorInfo(s,t[0].dtype,[]);var i=t.filter((function(e){return Wt(e.shape)>0}));if(1===i.length)return pi({inputs:{x:i[0]},backend:n});if(go(i.map((function(e){return e.shape})),o),"complex64"===i[0].dtype){var _e198=i.map((function(e){return fi({inputs:{input:e},backend:n})})),_t177=i.map((function(e){return km({inputs:{input:e},backend:n})})),_r98=Cm({inputs:_e198,backend:n,attrs:{axis:o}}),_a76=Cm({inputs:_t177,backend:n,attrs:{axis:o}}),_s41=li({inputs:{real:_r98,imag:_a76},backend:n});return _e198.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),_t177.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(_r98),n.disposeIntermediateTensorInfo(_a76),_s41}var u=i.map((function(e){var t=Wt(e.shape.slice(o));return Xf({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),l=u.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));s=bo(u.map((function(e){return e.shape})),1);var c=1===u[0].shape[0],d=Si(l,s,t[0].dtype,c),p=bo(i.map((function(e){return e.shape})),o),h=n.makeTensorInfo(p,t[0].dtype,d);return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),h}var Am={kernelName:"Concat",backendName:"cpu",kernelFunc:Cm};function Em(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dilations,c=r.dimRoundingMode;oi([a,o],"conv2d");for(var d=$a(u),p=va(a.shape,o.shape,s,l,i,c,!1,d),h=p.filterHeight,f=p.filterWidth,m=p.dilationHeight,g=p.dilationWidth,b=p.padInfo.left,x=p.padInfo.top,v="channelsLast"===p.dataFormat,y=new Wn(p.outShape,a.dtype),w=an(a.shape),k=an(o.shape),I=w[0],C=v?w[1]:w[2],A=v?w[2]:1,E=v?1:w[1],_=y.strides[0],$=v?y.strides[1]:y.strides[2],N=v?y.strides[2]:1,S=v?1:y.strides[1],R=n.data.get(a.dataId).values,T=n.data.get(o.dataId).values,F=y.values,_e199=0;_e199<p.batchSize;++_e199)for(var _t178=_e199*I,_n118=_e199*_,_e200=0;_e200<p.outHeight;++_e200)for(var _r99=_n118+_e200*$,_a77=_e200*p.strideHeight-x,_e201=0;_e201<h;++_e201){var _n119=_a77+_e201*m;if(!(_n119<0||_n119>=p.inHeight))for(var _o52=_e201*k[0],_s42=_t178+_n119*C,_e202=0;_e202<p.outWidth;++_e202)for(var _t179=_r99+_e202*N,_n120=_e202*p.strideWidth-b,_e203=0;_e203<f;++_e203){var _r100=_n120+_e203*g;if(!(_r100<0||_r100>=p.inWidth))for(var _a78=_s42+_r100*A,_i37=_o52+_e203*k[1],_e204=0;_e204<p.inChannels;++_e204){for(var _n121=R[_a78+_e204*E],_e205=0;_e205<p.outChannels;++_e205)F[_t179+_e205*S]+=_n121*T[_i37+_e205];_i37+=p.outChannels}}}return n.makeTensorInfo(y.shape,y.dtype,F)}var _m={kernelName:"Conv2D",backendName:"cpu",kernelFunc:Em},$m={kernelName:"Conv2DBackpropFilter",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=r.filterShape;oi([a,o],"conv2dBackpropFilter");for(var d=$a(u),p=va(a.shape,c,s,1,i,l,!1,d),h=p.strideHeight,f=p.strideWidth,m=p.filterHeight,g=p.filterWidth,b="channelsLast"===p.dataFormat,x=new Wn(p.filterShape,"float32"),v=p.padInfo.left,y=p.padInfo.top,w=n.data.get(a.dataId).values,k=n.data.get(o.dataId).values,I=new Wn(a.shape,a.dtype,w),C=new Wn(o.shape,o.dtype,k),_e206=0;_e206<m;++_e206)for(var _t180=Math.max(0,Math.ceil((y-_e206)/h)),_n122=Math.min(p.outHeight,(p.inHeight+y-_e206)/h),_r101=0;_r101<g;++_r101)for(var _a79=Math.max(0,Math.ceil((v-_r101)/f)),_o53=Math.min(p.outWidth,(p.inWidth+v-_r101)/f),_s43=0;_s43<p.inChannels;++_s43)for(var _i38=0;_i38<p.outChannels;++_i38){for(var _u20=0,_l14=0;_l14<p.batchSize;++_l14)for(var _c14=_t180;_c14<_n122;++_c14)for(var _t181=_e206+_c14*h-y,_e207=_a79;_e207<_o53;++_e207){var _n123=_r101+_e207*f-v;_u20+=b?I.get(_l14,_t181,_n123,_s43)*C.get(_l14,_c14,_e207,_i38):I.get(_l14,_s43,_t181,_n123)*C.get(_l14,_i38,_c14,_e207)}x.set(_u20,_e206,_r101,_s43,_i38)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}},Nm={kernelName:"Conv2DBackpropInput",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.inputShape,i=r.strides,u=r.pad,l=r.dataFormat,c=r.dimRoundingMode;oi([a,o],"conv2dBackpropInput");var d=an(o.shape),p=an(a.shape),h=$a(l),f=va(s,o.shape,i,1,u,c,!1,h),m=new Wn(f.inShape,"float32"),g=m.values,b=n.data.get(a.dataId).values,x=n.data.get(o.dataId).values,_d9=_slicedToArray(d,3),v=_d9[0],y=_d9[1],w=_d9[2],k=f.batchSize,I=f.filterHeight,C=f.filterWidth,A=f.inChannels,E=f.inHeight,_=f.inWidth,$=f.outChannels,N=f.outHeight,S=f.outWidth,R=f.strideHeight,T=f.strideWidth;h=f.dataFormat;for(var F=I-1-f.padInfo.top,M=C-1-f.padInfo.left,O="channelsLast"===h,D=m.strides[0],B=O?m.strides[1]:m.strides[2],L=O?m.strides[2]:1,P=O?1:m.strides[1],W=p[0],U=O?p[1]:p[2],V=O?p[2]:1,G=O?1:p[1],_e208=0;_e208<k;++_e208)for(var _t182=0;_t182<A;++_t182)for(var _n124=0;_n124<E;++_n124)for(var _r102=_n124-F,_a80=Math.max(0,Math.ceil(_r102/R)),_o54=Math.min(N,(I+_r102)/R),_s44=0;_s44<_;++_s44){for(var _i39=_s44-M,_u21=Math.max(0,Math.ceil(_i39/T)),_l15=Math.min(S,(C+_i39)/T),_c15=0,_n125=_a80;_n125<_o54;++_n125)for(var _a81=_n125*R-_r102,_r103=_u21;_r103<_l15;++_r103)for(var _o55=W*_e208+U*_n125+V*_r103,_s45=v*(I-1-_a81)+y*(C-1-(_r103*T-_i39))+w*_t182,_e209=0;_e209<$;++_e209)_c15+=b[_o55+G*_e209]*x[_s45+_e209];g[D*_e208+B*_n124+L*_s44+P*_t182]=_c15}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},Sm={kernelName:"Conv3D",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dilations;oi([a,o],"conv3d");for(var l=ya(a.shape,o.shape,s,u,i),c=l.filterDepth,d=l.filterHeight,p=l.filterWidth,h=l.dilationDepth,f=l.dilationHeight,m=l.dilationWidth,g=l.padInfo,b=g.front,x=g.left,v=g.top,y=new Wn(l.outShape,a.dtype),w=n.data.get(a.dataId).values,k=n.data.get(o.dataId).values,I=y.values,C=an(a.shape),A=an(o.shape),_e210=0;_e210<l.batchSize;++_e210)for(var _t183=_e210*C[0],_n126=_e210*y.strides[0],_e211=0;_e211<l.outDepth;++_e211)for(var _r104=_n126+_e211*y.strides[1],_a82=_e211*l.strideDepth-b,_e212=0;_e212<c;++_e212){var _n127=_a82+_e212*h;if(!(_n127<0||_n127>=l.inDepth))for(var _o56=_e212*A[0],_s46=_t183+_n127*C[1],_e213=0;_e213<l.outHeight;++_e213)for(var _t184=_r104+_e213*y.strides[2],_n128=_e213*l.strideHeight-v,_e214=0;_e214<d;++_e214){var _r105=_n128+_e214*f;if(!(_r105<0||_r105>=l.inHeight))for(var _a83=_o56+_e214*A[1],_i40=_s46+_r105*C[2],_e215=0;_e215<l.outWidth;++_e215)for(var _n129=_t184+_e215*l.outChannels,_r106=_e215*l.strideWidth-x,_e216=0;_e216<p;++_e216){var _t185=_r106+_e216*m;if(!(_t185<0||_t185>=l.inWidth))for(var _o57=_a83+_e216*A[2],_s47=_i40+_t185*l.inChannels,_u22=_o57,_e217=0;_e217<l.inChannels;++_e217){for(var _t186=w[_s47+_e217],_e218=0;_e218<l.outChannels;++_e218)I[_n129+_e218]+=_t186*k[_u22+_e218];_u22+=l.outChannels}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},Rm={kernelName:"Conv3DBackpropFilterV2",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.pad,u=r.filterShape;oi([a,o],"conv3dBackpropFilterV2");for(var l=an(a.shape),c=an(o.shape),d=ya(a.shape,u,s,1,i),p=d.strideDepth,h=d.strideHeight,f=d.strideWidth,m=d.filterDepth,g=d.filterHeight,b=d.filterWidth,x=new Wn(d.filterShape,"float32"),v=x.values,_x$strides=_slicedToArray(x.strides,4),y=_x$strides[0],w=_x$strides[1],k=_x$strides[2],I=_x$strides[3],C=n.data.get(o.dataId).values,_c16=_slicedToArray(c,4),A=_c16[0],E=_c16[1],_=_c16[2],$=_c16[3],N=n.data.get(a.dataId).values,_l16=_slicedToArray(l,4),S=_l16[0],R=_l16[1],T=_l16[2],F=_l16[3],M=d.padInfo.front,O=d.padInfo.left,D=d.padInfo.top,_e219=0;_e219<m;++_e219)for(var _t187=Math.max(0,Math.ceil((M-_e219)/p)),_n130=Math.min(d.outDepth,(d.inDepth+M-_e219)/p),_r107=_e219*y,_a84=0;_a84<g;++_a84)for(var _o58=Math.max(0,Math.ceil((D-_a84)/h)),_s48=Math.min(d.outHeight,(d.inHeight+D-_a84)/h),_i41=_a84*w+_r107,_r108=0;_r108<b;++_r108)for(var _u23=Math.max(0,Math.ceil((O-_r108)/f)),_l17=Math.min(d.outWidth,(d.inWidth+O-_r108)/f),_c17=_r108*k+_i41,_i42=0;_i42<d.inChannels;++_i42)for(var _m10=_i42*I+_c17,_c18=0;_c18<d.outChannels;++_c18){for(var _g8=0,_m11=0;_m11<d.batchSize;++_m11)for(var _d10=_m11*S,_b8=_m11*A,_m12=_t187;_m12<_n130;++_m12)for(var _t188=(_e219+_m12*p-M)*R+_d10,_n131=_m12*E+_b8,_e220=_o58;_e220<_s48;++_e220)for(var _o59=(_a84+_e220*h-D)*T+_t188,_s49=_e220*_+_n131,_e221=_u23;_e221<_l17;++_e221){var _t189=_e221*$+_s49;_g8+=N[(_r108+_e221*f-O)*F+_o59+_i42]*C[_t189+_c18]}v[_m10+_c18]=_g8}return n.makeTensorInfo(x.shape,x.dtype,x.values)}},Tm={kernelName:"Conv3DBackpropInputV2",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.pad,i=r.strides,u=r.inputShape;oi([a],"conv3dBackpropInputV2");for(var l=an(a.shape),c=an(o.shape),d=ya(u,o.shape,i,1,s),p=new Wn(d.inShape,"float32"),h=p.values,_p$strides=_slicedToArray(p.strides,4),f=_p$strides[0],m=_p$strides[1],g=_p$strides[2],b=_p$strides[3],x=n.data.get(a.dataId).values,_l18=_slicedToArray(l,4),v=_l18[0],y=_l18[1],w=_l18[2],k=_l18[3],I=n.data.get(o.dataId).values,_c19=_slicedToArray(c,4),C=_c19[0],A=_c19[1],E=_c19[2],_=_c19[3],$=d.batchSize,N=d.filterDepth,S=d.filterHeight,R=d.filterWidth,T=d.inChannels,F=d.inDepth,M=d.inHeight,O=d.inWidth,D=d.outChannels,B=d.outDepth,L=d.outHeight,P=d.outWidth,W=d.strideDepth,U=d.strideHeight,V=d.strideWidth,G=N-1-d.padInfo.front,z=S-1-d.padInfo.top,H=R-1-d.padInfo.left,_e222=0;_e222<$;++_e222)for(var _t190=0;_t190<T;++_t190)for(var _n132=0;_n132<F;++_n132)for(var _r109=_n132-G,_a85=Math.max(0,Math.ceil(_r109/W)),_o60=Math.min(B,(N+_r109)/W),_s50=0;_s50<M;++_s50)for(var _i43=_s50-z,_u24=Math.max(0,Math.ceil(_i43/U)),_l19=Math.min(L,(S+_i43)/U),_c20=0;_c20<O;++_c20){for(var _d11=_c20-H,_p9=Math.max(0,Math.ceil(_d11/V)),_$2=Math.min(P,(R+_d11)/V),_T=0,_n133=_a85;_n133<_o60;++_n133)for(var _a86=_n133*W-_r109,_r110=_u24;_r110<_l19;++_r110)for(var _o61=_r110*U-_i43,_s51=_p9;_s51<_$2;++_s51)for(var _i44=v*_e222+y*_n133+w*_r110+k*_s51,_u25=C*(N-1-_a86)+A*(S-1-_o61)+E*(R-1-(_s51*V-_d11))+_*_t190,_e223=0;_e223<D;++_e223)_T+=x[_i44+_e223]*I[_u25+_e223];h[f*_e222+m*_n132+g*_s50+b*_c20+_t190]=_T}return n.makeTensorInfo(p.shape,p.dtype,p.values)}},Fm={kernelName:"Cos",backendName:"cpu",kernelFunc:Ei("Cos",(function(e){return Math.cos(e)}))},Mm={kernelName:"Cosh",backendName:"cpu",kernelFunc:Ei("Cosh",(function(e){return Math.cosh(e)}))},Om={kernelName:"CropAndResize",backendName:"cpu",kernelFunc:function kernelFunc(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.boxes,s=t.boxInd,i=r.cropSize,u=r.method,l=r.extrapolationValue,_a$shape2=_slicedToArray(a.shape,4),c=_a$shape2[0],d=_a$shape2[1],p=_a$shape2[2],h=_a$shape2[3],f=o.shape[0],_i45=_slicedToArray(i,2),m=_i45[0],g=_i45[1],b=Ur([f,m,g,h],"float32"),x=n.data.get(o.dataId).values,v=n.data.get(s.dataId).values,y=n.data.get(a.dataId).values,w=an(a.shape),k=an(b.shape),_e224=0;_e224<f;_e224++){var _t191=4*_e224,_n134=x[_t191],_r111=x[_t191+1],_a87=x[_t191+2],_o62=x[_t191+3],_s52=v[_e224];if(!(_s52>=c))for(var _i46=m>1?(_a87-_n134)*(d-1)/(m-1):0,_f5=g>1?(_o62-_r111)*(p-1)/(g-1):0,_t192=0;_t192<m;_t192++){var _c21=m>1?_n134*(d-1)+_t192*_i46:.5*(_n134+_a87)*(d-1);if(_c21<0||_c21>d-1)for(var _n135=0;_n135<g;_n135++)for(var _r112=0;_r112<h;_r112++){var _a88=_r112+_n135*k[2]+_t192*k[1]+_e224*k[0];b.values[_a88]=l}else if("bilinear"===u)for(var _n136=Math.floor(_c21),_a89=Math.ceil(_c21),_i47=_c21-_n136,_u26=0;_u26<g;_u26++){var _c22=g>1?_r111*(p-1)+_u26*_f5:.5*(_r111+_o62)*(p-1);if(_c22<0||_c22>p-1)for(var _n137=0;_n137<h;_n137++){var _r113=_n137+_u26*k[2]+_t192*k[1]+_e224*k[0];b.values[_r113]=l}else for(var _d12=Math.floor(_c22),_m13=Math.ceil(_c22),_x24=_c22-_d12,_r114=0;_r114<h;_r114++){var _o63=_r114+_d12*w[2]+_n136*w[1]+_s52*w[0],_l20=y[_o63],_c23=y[_o63=_r114+_m13*w[2]+_n136*w[1]+_s52*w[0]],_p10=y[_o63=_r114+_d12*w[2]+_a89*w[1]+_s52*w[0]],_h9=_l20+(_c23-_l20)*_x24,_f6=_p10+(y[_o63=_r114+_m13*w[2]+_a89*w[1]+_s52*w[0]]-_p10)*_x24;_o63=_r114+_u26*k[2]+_t192*k[1]+_e224*k[0],b.values[_o63]=_h9+(_f6-_h9)*_i47}}else for(var _n138=0;_n138<g;++_n138){var _a90=g>1?_r111*(p-1)+_n138*_f5:.5*(_r111+_o62)*(p-1);if(_a90<0||_a90>p-1)for(var _r115=0;_r115<h;_r115++){var _a91=_r115+_n138*k[2]+_t192*k[1]+_e224*k[0];b.values[_a91]=l}else for(var _i48=Math.round(_a90),_u27=Math.round(_c21),_r116=0;_r116<h;_r116++){var _a92=_r116+_i48*w[2]+_u27*w[1]+_s52*w[0],_o64=_r116+_n138*k[2]+_t192*k[1]+_e224*k[0];b.values[_o64]=y[_a92]}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}},Dm={kernelName:"Cumsum",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.exclusive,i=r.reverse;oi(a,"cumsum");var u=Ua([o],a.shape.length),l=a;null!=u&&(l=su({inputs:{x:a},backend:n,attrs:{perm:u}}));var c=Ga(1,a.shape.length)[0];if(c!==l.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(l.shape.length-1," but got axis=").concat(c));for(var d=Yn(l.dtype,"int32"),p=un(Wt(l.shape),d),h=n.data.get(l.dataId).values,f=l.shape[l.shape.length-1],m=i?function(e,t){return e+f-t-1}:function(e,t){return e+t},_e225=0;_e225<h.length;_e225+=f)for(var _t193=0;_t193<f;_t193++){var _n139=m(_e225,_t193);if(0===_t193)p[_n139]=s?0:h[_n139];else{var _r117=m(_e225,_t193-1);p[_n139]=s?h[_r117]+p[_r117]:h[_n139]+p[_r117]}}var g=n.makeTensorInfo(l.shape,d,p);if(null!=u){var _e226=su({inputs:{x:g},backend:n,attrs:{perm:Va(u)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(l),_e226}return g}},Bm={kernelName:"DenseBincount",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.weights,s=r.size,i=r.binaryOutput;if(1===a.shape.length){var _e227=Ii(n.data.get(a.dataId).values,n.data.get(o.dataId).values,o.dtype,o.shape,s);return n.makeTensorInfo([s],o.dtype,_e227)}if(2===a.shape.length){var _e228=Ci(n.bufferSync(a),n.bufferSync(o),s,i);return n.makeTensorInfo(_e228.shape,o.dtype,_e228.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},Lm={kernelName:"DepthToSpace",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockSize,s=r.dataFormat;Bt("NHWC"===s,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(s)})),Bt(o>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(o)}));for(var i=a.shape[0],u=a.shape[1],l=a.shape[2],c=a.shape[3],d=u*o,p=l*o,h=c/(o*o),f=n.data.get(a.dataId).values,m=new Float32Array(i*d*p*h),g=0,_e229=0;_e229<i;++_e229)for(var _t194=0;_t194<d;++_t194)for(var _n140=Math.floor(_t194/o),_r118=_t194%o,_t195=0;_t195<p;++_t195)for(var _a93=Math.floor(_t195/o),_s53=(_r118*o+_t195%o)*h,_t196=0;_t196<h;++_t196){var _r119=_t196+_s53+c*(_a93+l*(_n140+u*_e229));m[g++]=f[_r119]}return n.makeTensorInfo([i,d,p,h],a.dtype,m)}};function Pm(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=r.strides,i=r.pad,u=r.dilations,l=r.dimRoundingMode;oi([a,o],"depthwiseConv2DNative");var c=an(a.shape),d=an(o.shape),p=u;null==p&&(p=[1,1]),Bt(_a(s,p),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(p,"'")}));for(var h=va(a.shape,o.shape,s,p,i,l,!0),f=h.filterHeight,m=h.filterWidth,g=h.dilationHeight,b=h.dilationWidth,x=h.padInfo,v=x.left,y=x.top,w=h.outChannels/h.inChannels,k=new Wn(h.outShape,a.dtype),I=n.data.get(a.dataId).values,C=n.data.get(o.dataId).values,A=k.values,_e230=0;_e230<h.batchSize;++_e230)for(var _t197=_e230*c[0],_n141=_e230*k.strides[0],_e231=0;_e231<h.outHeight;++_e231)for(var _r120=_n141+_e231*k.strides[1],_a94=_e231*h.strideHeight-v,_e232=0;_e232<f;++_e232){var _n142=_a94+_e232*g;if(!(_n142<0||_n142>=h.inHeight))for(var _o65=_e232*d[0],_s54=_t197+_n142*c[1],_e233=0;_e233<h.outWidth;++_e233)for(var _t198=_r120+_e233*k.strides[2],_n143=_e233*h.strideWidth-y,_e234=0;_e234<m;++_e234){var _r121=_n143+_e234*b;if(!(_r121<0||_r121>=h.inWidth))for(var _a95=_o65+_e234*d[1],_i49=_s54+_r121*h.inChannels,_u28=_t198,_l21=_a95,_e235=0;_e235<h.inChannels;++_e235){for(var _t199=I[_i49+_e235],_e236=0;_e236<w;++_e236)A[_u28+_e236]+=_t199*C[_l21+_e236];_u28+=w,_l21+=w}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}var Wm={kernelName:"DepthwiseConv2dNative",backendName:"cpu",kernelFunc:Pm},Um={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,i=r.dilations,u=r.pad,l=r.dimRoundingMode,c=r.filterShape;oi([a,o],"depthwiseConv2dNativeBackpropFilter");for(var d=va(a.shape,c,s,i,u,l,!0),p=d.strideHeight,h=d.strideWidth,f=d.filterHeight,m=d.filterWidth,g=new Wn(d.filterShape,"float32"),b=d.padInfo.left,x=d.padInfo.top,v=d.outChannels/d.inChannels,y=n.data.get(a.dataId).values,w=new Wn(a.shape,a.dtype,y),k=n.data.get(o.dataId).values,I=new Wn(o.shape,o.dtype,k),_e237=0;_e237<f;++_e237)for(var _t200=Math.max(0,Math.ceil((x-_e237)/p)),_n144=Math.min(d.outHeight,(d.inHeight+x-_e237)/p),_r122=0;_r122<m;++_r122)for(var _a96=Math.max(0,Math.ceil((b-_r122)/h)),_o66=Math.min(d.outWidth,(d.inWidth+b-_r122)/h),_s55=0;_s55<d.outChannels;++_s55){for(var _i50=Math.trunc(_s55/v),_u29=_s55%v,_l22=0,_u30=0;_u30<d.batchSize;++_u30)for(var _c24=_t200;_c24<_n144;++_c24)for(var _t201=_e237+_c24*p-x,_e238=_a96;_e238<_o66;++_e238){var _n145=_r122+_e238*h-b;_l22+=w.get(_u30,_t201,_n145,_i50)*I.get(_u30,_c24,_e238,_s55)}g.set(_l22,_e237,_r122,_i50,_u29)}return n.makeTensorInfo(g.shape,g.dtype,g.values)}},Vm={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.strides,i=r.dilations,u=r.pad,l=r.dimRoundingMode,c=r.inputShape;oi([a,o],"depthwiseConv2DNativeBackpropInput");for(var d=an(a.shape),p=an(o.shape),h=va(c,o.shape,s,i,u,l,!0),f=new Wn(h.inShape,"float32"),m=f.values,_f$strides=_slicedToArray(f.strides,3),g=_f$strides[0],b=_f$strides[1],x=_f$strides[2],v=n.data.get(a.dataId).values,_d13=_slicedToArray(d,3),y=_d13[0],w=_d13[1],k=_d13[2],I=n.data.get(o.dataId).values,_p11=_slicedToArray(p,3),C=_p11[0],A=_p11[1],E=_p11[2],_=h.batchSize,$=h.filterHeight,N=h.filterWidth,S=h.inChannels,R=h.inHeight,T=h.inWidth,F=h.outChannels,M=h.outHeight,O=h.outWidth,D=h.strideHeight,B=h.strideWidth,L=$-1-h.padInfo.top,P=N-1-h.padInfo.left,W=F/S,_e239=0;_e239<_;++_e239)for(var _t202=0;_t202<S;++_t202)for(var _n146=0;_n146<R;++_n146)for(var _r123=_n146-L,_a97=Math.max(0,Math.ceil(_r123/D)),_o67=Math.min(M,($+_r123)/D),_s56=0;_s56<T;++_s56){for(var _i51=_s56-P,_u31=Math.max(0,Math.ceil(_i51/B)),_l23=Math.min(O,(N+_i51)/B),_c25=0,_n147=_a97;_n147<_o67;++_n147)for(var _a98=_n147*D-_r123,_r124=_u31;_r124<_l23;++_r124)for(var _o68=y*_e239+w*_n147+k*_r124,_s57=C*($-1-_a98)+A*(N-1-(_r124*B-_i51))+E*_t202,_e240=0;_e240<W;++_e240)_c25+=v[_o68+(_t202*W+_e240)]*I[_s57+_e240];m[g*_e239+b*_n146+x*_s56+_t202]=_c25}return n.makeTensorInfo(f.shape,f.dtype,f.values)}},Gm={kernelName:"Diag",backendName:"cpu",kernelFunc:function kernelFunc(e){for(var t=e.inputs,n=e.backend,r=t.x,a=Wt(r.shape),o=n.data.get(r.dataId).values,s=Ur([a,a],r.dtype),i=s.values,_e241=0;_e241<o.length;_e241++)i[_e241*a+_e241]=o[_e241];var u=[].concat(_toConsumableArray(r.shape),_toConsumableArray(r.shape));return n.makeTensorInfo(u,s.dtype,s.values)}},zm={kernelName:"Dilation2D",backendName:"cpu",kernelFunc:function kernelFunc(_ref41){for(var e=_ref41.inputs,t=_ref41.backend,n=_ref41.attrs,r=e.x,a=e.filter,o=n.strides,s=n.pad,i=n.dilations,u=t,l=u.data.get(r.dataId).values,c=r.shape.length,d=u.data.get(a.dataId).values,p=a.shape.length,_ga=ga(r.shape,a.shape,o,s,"NHWC",i),h=_ga.batchSize,f=_ga.inHeight,m=_ga.inWidth,g=_ga.inChannels,b=_ga.outHeight,x=_ga.outWidth,v=_ga.padInfo,y=_ga.strideHeight,w=_ga.strideWidth,k=_ga.filterHeight,I=_ga.filterWidth,C=_ga.dilationHeight,A=_ga.dilationWidth,E=_ga.outShape,_=Wt(E),$=E.length,N=Kt(r.dtype,_),_e242=0;_e242<h;++_e242)for(var _t203=0;_t203<b;++_t203)for(var _n148=_t203*y-v.top,_o69=0;_o69<x;++_o69)for(var _s58=_o69*w-v.left,_i52=0;_i52<g;++_i52){for(var _u32=Number.MIN_SAFE_INTEGER,_t204=0;_t204<k;++_t204){var _o70=_n148+_t204*C;if(_o70>=0&&_o70<f)for(var _n149=0;_n149<I;++_n149){var _h10=_s58+_n149*A;if(_h10>=0&&_h10<m){var _s59=dn([_e242,_o70,_h10,_i52],c,an(r.shape)),_f7=dn([_t204,_n149,_i52],p,an(a.shape)),_m14=l[_s59]+d[_f7];_m14>_u32&&(_u32=_m14)}}}N[dn([_e242,_t203,_o69,_i52],$,an(E))]=_u32}return{dataId:u.write($n(N,r.dtype),E,r.dtype),shape:E,dtype:r.dtype}}},Hm={kernelName:"Dilation2DBackpropFilter",backendName:"cpu",kernelFunc:function kernelFunc(_ref42){var e=_ref42.inputs,t=_ref42.backend,n=_ref42.attrs,r=e.x,a=e.filter,o=e.dy,s=n.strides,i=n.pad,u=n.dilations,l=t,c=sn(r.shape,l.data.get(r.dataId).values),d=sn(a.shape,l.data.get(a.dataId).values),_ga2=ga(r.shape,a.shape,s,i,"NHWC",u),p=_ga2.batchSize,h=_ga2.inHeight,f=_ga2.inWidth,m=_ga2.inChannels,g=_ga2.outHeight,b=_ga2.outWidth,x=_ga2.padInfo,v=_ga2.strideHeight,y=_ga2.strideWidth,w=_ga2.filterHeight,k=_ga2.filterWidth,I=_ga2.dilationHeight,C=_ga2.dilationWidth,A=_ga2.outShape;Bt(o.rank===A.length,(function(){return"Error in Dilation2DBackpropFilter, dy must have the same rank as output ".concat(A.length,", but got ").concat(o.rank)}));for(var E=sn(A,l.data.get(o.dataId).values),_=ln(a.shape,a.dtype),_e243=0;_e243<p;++_e243)for(var _t205=0;_t205<g;++_t205)for(var _n150=_t205*v-x.top,_r125=0;_r125<b;++_r125)for(var _a99=_r125*y-x.left,_o71=0;_o71<m;++_o71){for(var _s60=Number.MIN_SAFE_INTEGER,_i53=0,_u33=0,_t206=0;_t206<w;++_t206){var _r126=_n150+_t206*I;if(_r126>=0&&_r126<h)for(var _n151=0;_n151<k;++_n151){var _l24=_a99+_n151*C;if(_l24>=0&&_l24<f){var _a100=c[_e243][_r126][_l24][_o71]+d[_t206][_n151][_o71];_a100>_s60&&(_s60=_a100,_i53=_t206,_u33=_n151)}}}_[_i53][_u33][_o71]+=E[_e243][_t205][_r125][_o71]}return{dataId:l.write($n(_,r.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},jm={kernelName:"Dilation2DBackpropInput",backendName:"cpu",kernelFunc:function kernelFunc(_ref43){var e=_ref43.inputs,t=_ref43.backend,n=_ref43.attrs,r=e.x,a=e.filter,o=e.dy,s=n.strides,i=n.pad,u=n.dilations,l=t,c=sn(r.shape,l.data.get(r.dataId).values),d=sn(a.shape,l.data.get(a.dataId).values),_ga3=ga(r.shape,a.shape,s,i,"NHWC",u),p=_ga3.batchSize,h=_ga3.inHeight,f=_ga3.inWidth,m=_ga3.inChannels,g=_ga3.outHeight,b=_ga3.outWidth,x=_ga3.padInfo,v=_ga3.strideHeight,y=_ga3.strideWidth,w=_ga3.filterHeight,k=_ga3.filterWidth,I=_ga3.dilationHeight,C=_ga3.dilationWidth,A=_ga3.outShape;Bt(o.rank===A.length,(function(){return"Error in Dilation2DBackpropInput, dy must have the same rank as output ".concat(A.length,", but got ").concat(o.rank)}));for(var E=sn(A,l.data.get(o.dataId).values),_=ln(r.shape,r.dtype),_e244=0;_e244<p;++_e244)for(var _t207=0;_t207<g;++_t207)for(var _n152=_t207*v-x.top,_r127=0;_r127<b;++_r127)for(var _a101=_r127*y-x.left,_o72=0;_o72<m;++_o72){for(var _s61=Number.MIN_SAFE_INTEGER,_i54=_n152<0?0:_n152,_u34=_a101<0?0:_a101,_t208=0;_t208<w;++_t208){var _r128=_n152+_t208*I;if(_r128>=0&&_r128<h)for(var _n153=0;_n153<k;++_n153){var _l25=_a101+_n153*C;if(_l25>=0&&_l25<f){var _a102=c[_e244][_r128][_l25][_o72]+d[_t208][_n153][_o72];_a102>_s61&&(_s61=_a102,_i54=_r128,_u34=_l25)}}}_[_e244][_i54][_u34][_o72]+=E[_e244][_t207][_r127][_o72]}return{dataId:l.write($n(_,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Xm={kernelName:"EluGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;oi([r,a],"eluGrad");for(var o=new Float32Array(Wt(a.shape)),s=n.data.get(a.dataId).values,i=n.data.get(r.dataId).values,_e245=0;_e245<s.length;++_e245){var _t209=s[_e245];o[_e245]=_t209>=1?i[_e245]:i[_e245]*(_t209+1)}return n.makeTensorInfo(a.shape,"float32",o)}},qm=xi("Equal",ui((function(e,t){return e===t?1:0})),null,"bool"),Qm={kernelName:"Equal",backendName:"cpu",kernelFunc:qm},Km={kernelName:"Erf",backendName:"cpu",kernelFunc:Ei("Erf",(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+.3275911*n);return t*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))}))};function Ym(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,o=r.dim,s=a.shape.length,i=a.shape.slice(),u=o;return o<0&&(Bt(-(s+1)<=o,(function(){return"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")})),u=s+o+1),i.splice(u,0,1),Xf({inputs:{x:a},backend:n,attrs:{shape:i}})}var Zm={kernelName:"ExpandDims",backendName:"cpu",kernelFunc:Ym},Jm=xi("RealDiv",ui((function(e,t){return e/t}))),eg={kernelName:"RealDiv",backendName:"cpu",kernelFunc:Jm};function tg(e,t,n){for(var r=e.shape,a=r[0],o=r[1],s=n.data.get(e.dataId),i=s.complexTensorInfos.real,u=s.complexTensorInfos.imag,l=[a,o],c=Wt(l),d=Qt("float32",c),p=Qt("float32",c),_e246=0;_e246<a;_e246++){for(var _r129=fu({inputs:{x:i},backend:n,attrs:{begin:[_e246,0],size:[1,o]}}),_a103=fu({inputs:{x:u},backend:n,attrs:{begin:[_e246,0],size:[1,o]}}),_s62=li({inputs:{real:_r129,imag:_a103},backend:n}),_ng=ng(_s62,t,n),_h11=Eo(_ng.real,_ng.imag),_t210=0;_t210<o;_t210++){var _n154=So(_h11,_t210);d[_e246*o+_t210]=_n154.real,p[_e246*o+_t210]=_n154.imag}n.disposeIntermediateTensorInfo(_r129),n.disposeIntermediateTensorInfo(_a103),n.disposeIntermediateTensorInfo(_s62)}var h=n.makeTensorInfo(l,"float32",d),f=n.makeTensorInfo(l,"float32",p),m=li({inputs:{real:h,imag:f},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),m}function ng(e,t,n){var i,r=Wt(e.shape),a=n.data.get(e.dataId),o=n.data.get(a.complexTensorInfos.real.dataId).values,s=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0==((i=r)&i-1)){var _a104=rg(o,s,r,t,n),_i55=[e.shape[0],e.shape[1]];if(t){var _e247=n.makeTensorInfo(_i55,"float32",_a104.real),_t211=n.makeTensorInfo(_i55,"float32",_a104.imag),_o73=n.makeTensorInfo([],"float32",_n(r,"float32")),_s63=pi({inputs:{x:_o73},backend:n}),_u35=eg.kernelFunc({inputs:{a:_e247,b:_o73},backend:n}),_l27=eg.kernelFunc({inputs:{a:_t211,b:_s63},backend:n}),_c27=n.data.get(_u35.dataId).values,_d14=n.data.get(_l27.dataId).values;return n.disposeIntermediateTensorInfo(_e247),n.disposeIntermediateTensorInfo(_t211),n.disposeIntermediateTensorInfo(_o73),n.disposeIntermediateTensorInfo(_s63),n.disposeIntermediateTensorInfo(_u35),n.disposeIntermediateTensorInfo(_l27),{real:_c27,imag:_d14}}return _a104}return _o(function(e,t,n){for(var r=new Float32Array(2*t),_a105=0;_a105<t;_a105++){for(var _o74=0,_s64=0,_r130=0;_r130<t;_r130++){var _i56=Fo(_a105*_r130,t,n),_u36=So(e,_r130);_o74+=_u36.real*_i56.real-_u36.imag*_i56.imag,_s64+=_u36.real*_i56.imag+_u36.imag*_i56.real}n&&(_o74/=t,_s64/=t),Ro(r,_o74,_s64,_a105)}return r}(Eo(o,s),r,t))}function rg(e,t,n,r,a){if(1===n)return{real:e,imag:t};var o=Eo(e,t),s=n/2,i=$o(o),u=i.real,l=i.imag,c=[u.length],d=a.makeTensorInfo(c,"float32",u),p=a.makeTensorInfo(c,"float32",l),h=li({inputs:{real:d,imag:p},backend:a}),f=No(o),m=f.real,g=f.imag,b=[m.length],x=a.makeTensorInfo(b,"float32",m),v=a.makeTensorInfo(b,"float32",g),y=li({inputs:{real:x,imag:v},backend:a}),w=rg(u,l,s,r,a),k=w.real,I=w.imag,C=[k.length],A=a.makeTensorInfo(C,"float32",k),E=a.makeTensorInfo(C,"float32",I),_=li({inputs:{real:A,imag:E},backend:a}),$=rg(m,g,s,r,a),N=$.real,S=$.imag,R=[N.length],T=a.makeTensorInfo(R,"float32",N),F=a.makeTensorInfo(R,"float32",S),M=li({inputs:{real:T,imag:F},backend:a}),O=To(n,r),D=[O.real.length],B=a.makeTensorInfo(D,"float32",O.real),L=a.makeTensorInfo(D,"float32",O.imag),P=li({inputs:{real:B,imag:L},backend:a}),W=Ji({inputs:{a:P,b:M},backend:a}),U=wi({inputs:{a:_,b:W},backend:a}),V=yu({inputs:{a:_,b:W},backend:a}),G=fi({inputs:{input:U},backend:a}),z=fi({inputs:{input:V},backend:a}),H=km({inputs:{input:U},backend:a}),j=km({inputs:{input:V},backend:a}),X=Cm({inputs:[G,z],backend:a,attrs:{axis:0}}),q=Cm({inputs:[H,j],backend:a,attrs:{axis:0}}),Q=a.data.get(X.dataId).values,K=a.data.get(q.dataId).values;return a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(v),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(A),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(q),{real:Q,imag:K}}var ag={kernelName:"FFT",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.input,a=Wt(r.shape),o=r.shape[r.shape.length-1],s=Xf({inputs:{x:r},backend:n,attrs:{shape:[a/o,o]}}),i=tg(s,!1,n),u=Xf({inputs:{x:i},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),u}};function og(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,s=n.dtype||tn(a),i=Kt(s,Wt(r));return function(e,t,n){e.fill(t)}(i,a),t.makeTensorInfo(r,s,i)}var sg={kernelName:"Fill",backendName:"cpu",kernelFunc:og},ig={kernelName:"FlipLeftRight",backendName:"cpu",kernelFunc:function kernelFunc(_ref44){for(var e=_ref44.inputs,n=(_ref44.attrs,_ref44.backend),r=e.image,a=n,o=Qt(r.dtype,Wt(r.shape)),_r$shape=_slicedToArray(r.shape,4),s=_r$shape[0],i=_r$shape[1],u=_r$shape[2],l=_r$shape[3],c=a.data.get(r.dataId).values,_e248=0;_e248<s;_e248++)for(var _t212=_e248*u*i*l,_e249=0;_e249<i;_e249++)for(var _n155=_e249*(u*l),_r131=0;_r131<u;_r131++)for(var _a106=_r131*l,_i57=0;_i57<l;_i57++){var _d15=[s,_e249,_r131,_i57][2],_p12=Math.round(u-_d15),_h12=_t212+_n155+_a106+_i57,_f8=c[_h12];_p12>=0&&_p12<u&&(_f8=c[_t212+_n155+_p12*l+_i57]),o[_h12]=_f8}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},ug={kernelName:"FloorDiv",backendName:"cpu",kernelFunc:xi("FloorDiv",ui((function(e,t){return Math.floor(e/t)})),null,"int32")},lg={kernelName:"FusedConv2D",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dataFormat,d=r.dilations,p=r.dimRoundingMode,h=r.activation,f=r.leakyreluAlpha,m=Em({inputs:{x:a,filter:o},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:p}});if(s){var _e250=m;m=wi({inputs:{a:m,b:s},backend:n}),n.disposeIntermediateTensorInfo(_e250)}if(h){var _e251=m;m=jf(n,m,h,i,f),n.disposeIntermediateTensorInfo(_e251)}return m}},cg={kernelName:"FusedDepthwiseConv2D",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dataFormat,d=r.dilations,p=r.dimRoundingMode,h=r.activation,f=r.leakyreluAlpha,m=Pm({inputs:{x:a,filter:o},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:p}});if(s){var _e252=m;m=wi({inputs:{a:m,b:s},backend:n}),n.disposeIntermediateTensorInfo(_e252)}if(h){var _e253=m;m=jf(n,m,h,i,f),n.disposeIntermediateTensorInfo(_e253)}return m}},dg={kernelName:"GatherNd",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,o=Wt(r.shape),s=a.shape,i=s[s.length-1],_zr4=_slicedToArray(zr(r,a),4),u=_zr4[0],l=_zr4[1],c=_zr4[2],d=_zr4[3];if(0===l)return n.makeTensorInfo(u,r.dtype,[]);for(var p=Ur([l,c],r.dtype),h=n.data.get(a.dataId).values,f=n.data.get(r.dataId).values,_e254=0;_e254<l;_e254++){for(var _t213=[],_n156=0,_r132=0;_r132<i;_r132++){var _a107=h[_e254*i+_r132];_n156+=_a107*d[_r132],_t213.push(_a107)}if(_n156<0||_n156>=o/c)throw new Error("Invalid indices: ".concat(_t213," does not index into ").concat(r.shape));for(var _t214=0;_t214<c;_t214++)p.values[_e254*c+_t214]=f[_n156*c+_t214]}return n.makeTensorInfo(u,p.dtype,p.values)}},pg={kernelName:"GatherV2",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.indices,s=r.axis,i=r.batchDims;oi([a,o],"gatherV2");var u=i;null==i&&(u=0);var l=Wt(o.shape),c=Bo(a,o,Xt(s,a.shape)[0],u),d=Xf({inputs:{x:a},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=Xf({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}}),h=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize],f=n.bufferSync(p),m=Li(n.bufferSync(d),f,h);return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.makeTensorInfo(c.outputShape,m.dtype,m.values)}},hg={kernelName:"GreaterEqual",backendName:"cpu",kernelFunc:xi("GreaterEqual",ui((function(e,t){return e>=t?1:0})),null,"bool")},fg={kernelName:"IFFT",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.input,a=Wt(r.shape),o=r.shape[r.shape.length-1],s=Xf({inputs:{x:r},backend:n,attrs:{shape:[a/o,o]}}),i=tg(s,!0,n),u=Xf({inputs:{x:i},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),u}},mg={kernelName:"IsFinite",backendName:"cpu",kernelFunc:Ei("IsFinite",(function(e){return Number.isFinite(e)?1:0}),"bool")},gg={kernelName:"IsInf",backendName:"cpu",kernelFunc:Ei("IsInf",(function(e){return Math.abs(e)===1/0?1:0}),"bool")},bg={kernelName:"IsNan",backendName:"cpu",kernelFunc:Ei("IsNan",(function(e){return Number.isNaN(e)?1:0}),"bool")},xg={kernelName:"LessEqual",backendName:"cpu",kernelFunc:xi("LessEqual",ui((function(e,t){return e<=t?1:0})),null,"bool")},vg={kernelName:"LinSpace",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.backend,n=e.attrs,s=Gi(n.start,n.stop,n.num);return t.makeTensorInfo([s.length],"float32",s)}},yg={kernelName:"Log1p",backendName:"cpu",kernelFunc:Ei("Log1p",(function(e){return Math.log1p(e)}))},wg={kernelName:"LogicalAnd",backendName:"cpu",kernelFunc:xi("LogicalAnd",ui((function(e,t){return e&&t})),null,"bool")},kg={kernelName:"LogicalNot",backendName:"cpu",kernelFunc:Ei("LogicalNot",(function(e){return e?0:1}),"bool")},Ig={kernelName:"LogicalOr",backendName:"cpu",kernelFunc:xi("LogicalOr",ui((function(e,t){return e||t})),null,"bool")},Cg={kernelName:"LRN",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.depthRadius,s=r.bias,i=r.alpha,u=r.beta;oi(a,"LRN");var l=a.shape[3],c=l-1,d=n.data.get(a.dataId).values,p=Wt(a.shape),h=new Float32Array(p);function f(e){for(var t=e%l,n=e-t+Math.max(0,t-o),r=e-t+Math.min(t+o,c),a=0;n<=r;n++){var _e255=d[n];a+=_e255*_e255}return a}for(var _e256=0;_e256<p;_e256++){var _t215=f(_e256),_n157=d[_e256]*Math.pow(s+i*_t215,-u);h[_e256]=_n157}return n.makeTensorInfo(a.shape,a.dtype,h)}},Ag={kernelName:"LRNGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.y,s=t.dy,i=r.depthRadius,u=r.bias,l=r.alpha,c=r.beta;oi(s,"LRNGrad");for(var d=Wt(s.shape),p=s.shape[3],h=n.data.get(s.dataId).values,f=n.data.get(a.dataId).values,m=n.data.get(o.dataId).values,g=new Float32Array(d),b=d,_e257=0;_e257<b;_e257++){for(var _t216=_e257%p,_n158=_e257-_t216+Math.max(0,_t216-i),_r133=_e257-_t216+Math.min(p,_t216+i+1),_a108=0,_e258=_n158;_e258<_r133;_e258++)_a108+=Math.pow(f[_e258],2);_a108=l*_a108+u;for(var _t217=_n158;_t217<_r133;_t217++){var _n159=-2*l*c*f[_t217]*m[_e257]/_a108;_e257===_t217&&(_n159+=Math.pow(_a108,-c)),_n159*=h[_e257],g[_t217]+=_n159}}return n.makeTensorInfo(s.shape,a.dtype,g)}};function Eg(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reductionIndices,s=r.keepDims,i=n,u=a.shape,l=u.length,c=Xt(o,u),d=c,p=Ua(d,l),h=i.data.get(a.dataId).values;if(null!=p){for(var _e259=new Array(l),_t218=0;_t218<_e259.length;_t218++)_e259[_t218]=u[p[_t218]];h=ou(h,u,a.dtype,p,_e259),d=Ga(d.length,l),u=_e259}oi(a,"max"),Wa("max",d,l);var _La28=_slicedToArray(La(u,d),2),f=_La28[0],g=ji(h,Wt(_La28[1]),f,a.dtype),b=i.write(g,f,a.dtype),x=f;return s&&(x=Pa(f,c)),{dataId:b,shape:x,dtype:a.dtype}}var _g={kernelName:"Max",backendName:"cpu",kernelFunc:Eg},$g={kernelName:"MaxPool",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;oi(a,"maxPool");var o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode;Bt(_a(s,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var c,l=ba(a.shape,o,s,1,i,u);if(1===l.filterWidth&&1===l.filterHeight&&Ut(l.inShape,l.outShape))c=pi({inputs:{x:a},backend:n});else{var _e260=n.data.get(a.dataId).values,_t219=an(a.shape),_r134=cm(_e260,a.shape,a.dtype,_t219,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,_r134.values)}return c}},Ng={kernelName:"MaxPool3D",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.filterSize,s=r.strides,i=r.pad,u=r.dimRoundingMode,l=r.dataFormat;oi(a,"maxPool3d");var c=xa(a.shape,o,s,1,i,u,l),d=pm(n.data.get(a.dataId).values,a.shape,a.dtype,an(a.shape),c,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}},Sg={kernelName:"MaxPool3DGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,s=r.filterSize,i=r.strides,u=r.pad,l=r.dimRoundingMode;oi([a,o],"maxPool3DGrad");for(var c=xa(o.shape,s,i,1,u,l),d=function(e,t){for(var n=Ur(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,o=t.strideWidth,s=t.dilationDepth,i=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=t.padInfo.front,h=t.padInfo.top,f=t.padInfo.left,_m15=0;_m15<t.batchSize;++_m15)for(var _g9=0;_g9<t.inChannels;++_g9)for(var _b9=0;_b9<t.outDepth;++_b9){for(var _x25=_b9*r-p,_v6=_x25;_v6<0;)_v6+=s;for(var _y7=Math.min(t.inDepth,l+_x25),_r135=0;_r135<t.outHeight;++_r135){for(var _l28=_r135*a-h,_p13=_l28;_p13<0;)_p13+=i;for(var _w6=Math.min(t.inHeight,c+_l28),_a109=0;_a109<t.outWidth;++_a109){for(var _h13=_a109*o-f,_k3=_h13;_k3<0;)_k3+=u;for(var _I3=Math.min(t.inWidth,d+_h13),_C2=Number.NEGATIVE_INFINITY,_A3=-1,_t220=_v6;_t220<_y7;_t220+=s)for(var _n160=_t220-_x25,_r136=_p13;_r136<_w6;_r136+=i)for(var _a110=_r136-_l28,_o75=_k3;_o75<_I3;_o75+=u){var _s65=_o75-_h13,_i58=e.get(_m15,_t220,_r136,_o75,_g9);_i58>=_C2&&(_C2=_i58,_A3=_n160*c*d+_a110*c+_s65)}n.set(_A3,_m15,_b9,_r135,_a109,_g9)}}}return n}(n.bufferSync(o),c),p=c.strideDepth,h=c.strideHeight,f=c.strideWidth,m=c.dilationDepth,g=c.dilationHeight,b=c.dilationWidth,x=c.effectiveFilterDepth,v=c.effectiveFilterHeight,y=c.effectiveFilterWidth,w=x-1-c.padInfo.front,k=y-1-c.padInfo.left,I=v-1-c.padInfo.top,C=Ur(o.shape,"float32"),A=n.bufferSync(a),_e261=0;_e261<c.batchSize;++_e261)for(var _t221=0;_t221<c.inChannels;++_t221)for(var _n161=0;_n161<c.inDepth;++_n161)for(var _r137=0;_r137<c.inHeight;++_r137)for(var _a111=0;_a111<c.inWidth;++_a111){for(var _o76=_n161-w,_s66=_r137-I,_i59=_a111-k,_u37=0,_n162=0;_n162<x;_n162+=m){var _r138=(_o76+_n162)/p;if(!(_r138<0||_r138>=c.outDepth||Math.floor(_r138)!==_r138))for(var _a112=0;_a112<v;_a112+=g){var _o77=(_s66+_a112)/h;if(!(_o77<0||_o77>=c.outHeight||Math.floor(_o77)!==_o77))for(var _s67=0;_s67<y;_s67+=b){var _l29=(_i59+_s67)/f;if(!(_l29<0||_l29>=c.outWidth||Math.floor(_l29)!==_l29)){var _p14=x*v*y-1-d.get(_e261,_r138,_o77,_l29,_t221)===_n162*v*y+_a112*y+_s67?1:0;0!==_p14&&(_u37+=A.get(_e261,_r138,_o77,_l29,_t221)*_p14)}}}}C.set(_u37,_e261,_n161,_r137,_a111,_t221)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}},Rg={kernelName:"MaxPoolGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,i=o;oi([o,t.output],"maxPoolGrad");for(var u=r.filterSize,l=r.strides,c=r.pad,d=r.dimRoundingMode,p=ba(i.shape,u,l,1,c,d),h=n.data.get(i.dataId).values,f=Ur(p.outShape,i.dtype,dm(h,i.shape,i.dtype,p).values),m=p.strideHeight,g=p.strideWidth,b=p.dilationHeight,x=p.dilationWidth,v=p.effectiveFilterHeight,y=p.effectiveFilterWidth,w=y-1-p.padInfo.left,k=v-1-p.padInfo.top,I=Ur(i.shape,"float32"),C=n.data.get(a.dataId).values,A=Ur(a.shape,"float32",C),_e262=0;_e262<p.batchSize;++_e262)for(var _t222=0;_t222<p.inChannels;++_t222)for(var _n163=0;_n163<p.inHeight;++_n163)for(var _r139=0;_r139<p.inWidth;++_r139){for(var _a113=_n163-k,_o78=_r139-w,_s68=0,_n164=0;_n164<v;_n164+=b){var _r140=(_a113+_n164)/m;if(!(_r140<0||_r140>=p.outHeight||Math.floor(_r140)!==_r140))for(var _a114=0;_a114<y;_a114+=x){var _i60=(_o78+_a114)/g;if(!(_i60<0||_i60>=p.outWidth||Math.floor(_i60)!==_i60)){var _u38=v*y-1-f.get(_e262,_r140,_i60,_t222)===_n164*y+_a114?1:0;0!==_u38&&(_s68+=A.get(_e262,_r140,_i60,_t222)*_u38)}}}I.set(_s68,_e262,_n163,_r139,_t222)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}},Tg={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function kernelFunc(_ref45){var e=_ref45.inputs,t=_ref45.attrs,n=_ref45.backend,r=e.x,a=t.filterSize,o=t.strides,s=t.pad,i=t.includeBatchInIndex,u=n;oi(r,"MaxPoolWithArgmax");var l=u.data.get(r.dataId).values,c=ba(r.shape,a,o,[1,1],s),_ref47=_slicedToArray(function(e,t,n,r,a){var o=cm(e,0,n,an(t),a,"max"),s=dm(e,t,n,a,!0,r);return[o.values,s.values]}(l,r.shape,r.dtype,i,c),2),d=_ref47[0],p=_ref47[1],h=u.write(d,c.outShape,r.dtype),f=u.write(p,c.outShape,r.dtype);return[{dataId:h,shape:c.outShape,dtype:r.dtype},{dataId:f,shape:c.outShape,dtype:"int32"}]}};function Fg(e){var i,t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;oi(a,"sum");var u=(i="bool"===a.dtype?gi({inputs:{x:a},backend:n,attrs:{dtype:"int32"}}):pi({inputs:{x:a},backend:n})).shape.length,l=Xt(o,i.shape),c=Ua(l,u),d=l,p=i;null!=c&&(p=su({inputs:{x:i},backend:n,attrs:{perm:c}}),d=Ga(d.length,u)),Wa("sum",d,p.shape.length);for(var _La30=_slicedToArray(La(p.shape,d),2),h=_La30[0],f=_La30[1],m=di(n,h,Yn(p.dtype,"int32")),g=Wt(f),b=n.data.get(m.dataId).values,x=n.data.get(p.dataId).values,_e263=0;_e263<b.length;++_e263){for(var _t223=_e263*g,_n165=0,_e264=0;_e264<g;++_e264)_n165+=x[_t223+_e264];b[_e263]=_n165}if(s){var _e265=m;m=Xf({inputs:{x:m},backend:n,attrs:{shape:Pa(m.shape,l)}}),n.disposeIntermediateTensorInfo(_e265)}return n.disposeIntermediateTensorInfo(i),null!=c&&n.disposeIntermediateTensorInfo(p),m}var Mg={kernelName:"Sum",backendName:"cpu",kernelFunc:Fg},Og={kernelName:"Mean",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,i=Xt(o,a.shape),u=Wt(La(a.shape,i)[1]),l=[],c=n.makeTensorInfo([],"float32",new Float32Array([u]));l.push(c);var d=gi({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});l.push(d);var p=Jm({inputs:{a:d,b:c},backend:n});l.push(p);var h=Fg({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:s}});return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),h}},Dg={kernelName:"Min",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;oi(a,"min");var i=Xt(o,a.shape),u=i,l=Ua(u,a.shape.length),c=a;null!=l&&(c=su({inputs:{x:a},backend:n,attrs:{perm:l}}),u=Ga(u.length,a.shape.length)),Wa("min",u,c.shape.length);for(var _La32=_slicedToArray(La(c.shape,u),2),d=_La32[0],h=Wt(_La32[1]),f=un(Wt(d),c.dtype),m=n.data.get(c.dataId).values,_e266=0;_e266<f.length;++_e266){for(var _t224=_e266*h,_n166=m[_t224],_e267=0;_e267<h;++_e267){var _r141=m[_t224+_e267];_r141<_n166&&(_n166=_r141)}f[_e266]=_n166}null!=l&&n.disposeIntermediateTensorInfo(c);var g=n.makeTensorInfo(d,c.dtype,f);if(s){var _e268=Xf({inputs:{x:g},backend:n,attrs:{shape:Pa(d,i)}});return n.disposeIntermediateTensorInfo(g),_e268}return g}},Bg={kernelName:"MirrorPad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.paddings,s=r.mode;oi(a,"mirrorPad");for(var i=o.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=o.map((function(e){return e[0]})),l=o.map((function(e,t){return e[0]+a.shape[t]})),c="reflect"===s?0:1,d=n.data.get(a.dataId).values,p=a.shape.length,h=an(a.shape),f=Wt(i),m=i.length,g=an(i),b=Qt(a.dtype,f),_e269=0;_e269<f;_e269++){for(var _t225=pn(_e269,m,g),_e270=0;_e270<m;_e270++)_t225[_e270]<u[_e270]?_t225[_e270]=2*u[_e270]-_t225[_e270]-c:_t225[_e270]>=l[_e270]&&(_t225[_e270]=2*(l[_e270]-1)-_t225[_e270]+c);var _n167=dn(_t225=_t225.map((function(e,t){return e-u[t]})),p,h);b[_e269]=d[_n167]}return{dataId:n.write(b,i,a.dtype),shape:i,dtype:a.dtype}}},Lg={kernelName:"Mod",backendName:"cpu",kernelFunc:xi("Mod",ui((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})))};function Pg(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,o=r.dim,s=a.shape.length,i=o;if(-1===i&&(i=s-1),i!==s-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(s," and dim was ").concat(i));var u=Xt([i],a.shape),l=Eg({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),c=Pa(l.shape,u),d=Xf({inputs:{x:l},backend:n,attrs:{shape:c}}),p=yu({inputs:{a:a,b:d},backend:n}),h=Ti({inputs:{x:p},backend:n}),f=Fg({inputs:{x:h},backend:n,attrs:{axis:u,keepDims:!1}}),m=Xf({inputs:{x:f},backend:n,attrs:{shape:c}}),g=Jm({inputs:{a:h,b:m},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}var Wg={kernelName:"Softmax",backendName:"cpu",kernelFunc:Pg},Ug={kernelName:"Multinomial",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,o=r.numSamples,s=r.seed,i=r.normalized;oi(a,"multinomial");for(var u=i?a:Pg({inputs:{logits:a},backend:n,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],d=n.data.get(u.dataId).values,p=[l,o],h=un(Wt(p),"int32"),_e271=0;_e271<l;++_e271){var _t226=_e271*c,_n168=new Float32Array(c-1);_n168[0]=d[_t226];for(var _e272=1;_e272<_n168.length;++_e272)_n168[_e272]=_n168[_e272-1]+d[_t226+_e272];for(var _r142=eo.alea(s.toString()),_a115=_e271*o,_e273=0;_e273<o;++_e273){var _t227=_r142();h[_a115+_e273]=_n168.length;for(var _r143=0;_r143<_n168.length;_r143++)if(_t227<_n168[_r143]){h[_a115+_e273]=_r143;break}}}return i||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(p,"int32",h)}},Vg=uo,Gg={kernelName:"NonMaxSuppressionV3",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold;oi(a,"NonMaxSuppression");var l=n.data.get(a.dataId).values,c=n.data.get(o.dataId).values,d=Vg(l,c,s,i,u).selectedIndices;return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},zg=lo,Hg={kernelName:"NonMaxSuppressionV4",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold,l=r.padToMaxOutputSize;oi(a,"NonMaxSuppressionPadded");var c=n.data.get(a.dataId).values,d=n.data.get(o.dataId).values,_zg=zg(c,d,s,i,u,l),p=_zg.selectedIndices,h=_zg.validOutputs;return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},jg=co,Xg={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,s=r.maxOutputSize,i=r.iouThreshold,u=r.scoreThreshold,l=r.softNmsSigma;oi(a,"NonMaxSuppressionWithScore");var c=n.data.get(a.dataId).values,d=n.data.get(o.dataId).values,_jg=jg(c,d,s,i,u,l),g=_jg.selectedIndices,b=_jg.selectedScores;return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([b.length],"float32",new Float32Array(b))]}},qg={kernelName:"OneHot",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=r.depth,s=r.onValue,i=r.offValue;oi(a,"oneHot");var u=Wt(a.shape),l=new Float32Array(u*o);l.fill(i);for(var c=n.data.get(a.dataId).values,_e274=0;_e274<u;++_e274)c[_e274]>=0&&c[_e274]<o&&(l[_e274*o+c[_e274]]=s);return n.makeTensorInfo([].concat(_toConsumableArray(a.shape),[o]),"int32",l)}};function Qg(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var _e275=fi({inputs:{input:r},backend:n}),_t228=Qg({inputs:{x:_e275},backend:n}),_a116=km({inputs:{input:r},backend:n}),_o79=Qg({inputs:{x:_a116},backend:n}),_s69=li({inputs:{real:_t228,imag:_o79},backend:n});return n.disposeIntermediateTensorInfo(_e275),n.disposeIntermediateTensorInfo(_t228),n.disposeIntermediateTensorInfo(_a116),n.disposeIntermediateTensorInfo(_o79),_s69}return og({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var Kg={kernelName:"ZerosLike",backendName:"cpu",kernelFunc:Qg},Yg={kernelName:"OnesLike",backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var _t229=fi({inputs:{input:a},backend:r}),_n169=e({inputs:{x:_t229},backend:r}),_o80=km({inputs:{input:a},backend:r}),_s70=Qg({inputs:{x:_o80},backend:r}),_i61=li({inputs:{real:_n169,imag:_s70},backend:r});return r.disposeIntermediateTensorInfo(_t229),r.disposeIntermediateTensorInfo(_n169),r.disposeIntermediateTensorInfo(_o80),r.disposeIntermediateTensorInfo(_s70),_i61}return og({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function Zg(e){var t=e.inputs,n=e.backend,a=e.attrs.axis;if(1===t.length)return Ym({inputs:{input:t[0]},backend:n,attrs:{dim:a}});var o=t[0].shape,s=t[0].dtype;t.forEach((function(e){Lt(o,e.shape,"All tensors passed to stack must have matching shapes"),Bt(s===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=[],u=Cm({inputs:t.map((function(e){var t=Ym({inputs:{input:e},backend:n,attrs:{dim:a}});return i.push(t),t})),backend:n,attrs:{axis:a}});return i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}var Jg={kernelName:"Pack",backendName:"cpu",kernelFunc:Zg},eb={kernelName:"PadV2",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.paddings,s=r.constantValue;oi(a,"pad");var i=o.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=o.map((function(e){return e[0]})),l=n.data.get(a.dataId).values,c=Wt(a.shape),d=a.shape.length,p=an(a.shape),h=Wt(i),f=i.length,m=an(i),g=Qt(a.dtype,h);0!==s&&g.fill(s);for(var _e276=0;_e276<c;_e276++)g[dn(pn(_e276,d,p).map((function(e,t){return e+u[t]})),f,m)]=l[_e276];return{dataId:n.write(g,i,a.dtype),shape:i,dtype:a.dtype}}},tb={kernelName:"Pow",backendName:"cpu",kernelFunc:xi("Pow",ui((function(e,t){return Math.pow(e,t)})))},nb={kernelName:"Range",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.dtype,i=cu(r,a,n.step,o);return t.makeTensorInfo([i.length],o,i)}},rb={kernelName:"Reciprocal",backendName:"cpu",kernelFunc:Ei("Reciprocal",(function(e){return 1/e}))},ab={kernelName:"ResizeBilinear",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,i=r.size;oi(a,"resizeBilinear");for(var u=an(a.shape),_i62=_slicedToArray(i,2),l=_i62[0],c=_i62[1],_a$shape3=_slicedToArray(a.shape,4),d=_a$shape3[0],p=_a$shape3[1],h=_a$shape3[2],f=_a$shape3[3],m=n.data.get(a.dataId).values,g=new Float32Array(Wt([d,l,c,f])),b=[o&&l>1?p-1:p,o&&c>1?h-1:h],x=[o&&l>1?l-1:l,o&&c>1?c-1:c],v=0,y=b[0]/x[0],w=b[1]/x[1],_e277=0;_e277<d;_e277++)for(var _t230=0;_t230<l;_t230++){var _n170;_n170=s?y*(_t230+.5)-.5:y*_t230;for(var _r144=Math.max(0,Math.floor(_n170)),_a117=_n170-_r144,_o81=Math.min(p-1,Math.ceil(_n170)),_i63=_e277*u[0]+_r144*u[1],_l30=_e277*u[0]+_o81*u[1],_e278=0;_e278<c;_e278++){var _t231;_t231=s?w*(_e278+.5)-.5:w*_e278;for(var _n171=Math.max(0,Math.floor(_t231)),_r145=_t231-_n171,_o82=Math.min(h-1,Math.ceil(_t231)),_c28=_i63+_n171*u[2],_d16=_l30+_n171*u[2],_p15=_i63+_o82*u[2],_b10=_l30+_o82*u[2],_e279=0;_e279<f;_e279++){var _t232=m[_c28+_e279],_n172=m[_d16+_e279],_o83=_t232+(m[_p15+_e279]-_t232)*_r145,_s71=_o83+(_n172+(m[_b10+_e279]-_n172)*_r145-_o83)*_a117;g[v++]=_s71}}}return n.makeTensorInfo([d,l,c,f],"float32",g)}},ob={kernelName:"ResizeBilinearGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,s=r.alignCorners;oi([o,a],"resizeBilinearGrad");for(var i=an(a.shape),_a$shape4=_slicedToArray(a.shape,4),u=_a$shape4[0],l=_a$shape4[1],c=_a$shape4[2],d=_a$shape4[3],_o$shape=_slicedToArray(o.shape,3),p=_o$shape[1],h=_o$shape[2],f=new Float32Array(u*l*c*d),m=[s&&p>1?l-1:l,s&&h>1?c-1:c],g=[s&&p>1?p-1:p,s&&h>1?h-1:h],b=m[0]/g[0],x=m[1]/g[1],v=n.data.get(o.dataId).values,y=0,_e280=0;_e280<u;_e280++)for(var _t233=_e280*i[0],_e281=0;_e281<p;_e281++)for(var _n173=_e281*b,_r146=Math.floor(_n173),_a118=Math.min(Math.ceil(_n173),l-1),_o84=_t233+_r146*i[1],_s72=_t233+_a118*i[1],_u39=_n173-_r146,_p16=1-_u39,_e282=0;_e282<h;_e282++)for(var _t234=_e282*x,_n174=Math.floor(_t234),_r147=Math.min(Math.ceil(_t234),c-1),_a119=_t234-_n174,_l31=1-_a119,_h14=_o84+_n174*i[2],_m16=_o84+_r147*i[2],_g10=_s72+_n174*i[2],_b11=_s72+_r147*i[2],_w7=_p16*_l31,_k4=_p16*_a119,_I4=_u39*_l31,_C3=_u39*_a119,_e283=0;_e283<d;_e283++){var _t235=v[y++];f[_h14+_e283]+=_t235*_w7,f[_m16+_e283]+=_t235*_k4,f[_g10+_e283]+=_t235*_I4,f[_b11+_e283]+=_t235*_C3}return n.makeTensorInfo([u,c,l,d],"float32",f)}},sb={kernelName:"ResizeNearestNeighbor",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,i=r.size;oi(a,"resizeNearestNeighbor");for(var u=an(a.shape),_i64=_slicedToArray(i,2),l=_i64[0],c=_i64[1],_a$shape5=_slicedToArray(a.shape,4),d=_a$shape5[0],p=_a$shape5[1],h=_a$shape5[2],f=_a$shape5[3],m=n.data.get(a.dataId).values,g=new Float32Array(d*l*c*f),b=[o&&l>1?p-1:p,o&&c>1?h-1:h],x=[o&&l>1?l-1:l,o&&c>1?c-1:c],v=b[0]/x[0],y=b[1]/x[1],w=0,_e284=0;_e284<d;_e284++)for(var _t236=_e284*u[0],_e285=0;_e285<l;_e285++){var _n175=s?v*(_e285+.5):v*_e285,_r148=Math.min(p-1,o?Math.round(_n175):Math.floor(_n175));s&&(_r148=Math.max(0,_r148));for(var _a120=_t236+_r148*u[1],_e286=0;_e286<c;_e286++){var _t237=s?y*(_e286+.5):y*_e286,_n176=Math.min(h-1,o?Math.round(_t237):Math.floor(_t237));s&&(_n176=Math.max(0,_n176));for(var _r149=_a120+_n176*u[2],_e287=0;_e287<f;_e287++){var _t238=m[_r149+_e287];g[w++]=_t238}}}return n.makeTensorInfo([d,l,c,f],a.dtype,g)}},ib={kernelName:"ResizeNearestNeighborGrad",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,s=r.alignCorners;oi([o,a],"resizeNearestNeighborGrad");for(var i=an(a.shape),u=an(o.shape),_a$shape6=_slicedToArray(a.shape,4),l=_a$shape6[0],c=_a$shape6[1],d=_a$shape6[2],p=_a$shape6[3],_o$shape2=_slicedToArray(o.shape,3),h=_o$shape2[1],f=_o$shape2[2],m=new Float32Array(l*c*d*p),g=n.data.get(o.dataId).values,b=[s&&h>1?c-1:c,s&&f>1?d-1:d],x=[s&&h>1?h-1:h,s&&f>1?f-1:f],v=b[0]/x[0],y=b[1]/x[1],w=1/v,k=1/y,I=2*Math.ceil(w)+2,C=2*Math.ceil(k)+2,_e288=0;_e288<l;_e288++)for(var _t239=_e288*i[0],_e289=0;_e289<c;_e289++)for(var _n177=_t239+_e289*i[1],_r150=Math.floor(_e289*w),_a121=Math.floor(_r150-I/2),_r151=0;_r151<d;_r151++)for(var _o85=_n177+_r151*i[2],_l32=Math.floor(_r151*k),_b12=Math.floor(_l32-C/2),_n178=0;_n178<p;_n178++){for(var _i65=0,_o86=0;_o86<I;_o86++){var _l33=_o86+_a121;if(!(_l33<0||_l33>=h)){var _p17=_t239+_l33*u[1],_m17=_l33*v;if(_e289===Math.min(c-1,s?Math.round(_m17):Math.floor(_m17)))for(var _e290=0;_e290<C;_e290++){var _t240=_e290+_b12;if(!(_t240<0||_t240>=f)){var _a122=_p17+_t240*u[2],_o87=_t240*y;_r151===Math.min(d-1,s?Math.round(_o87):Math.floor(_o87))&&(_i65+=g[_a122+_n178])}}}}m[_o85+_n178]=_i65}return n.makeTensorInfo(a.shape,a.dtype,m)}},ub={kernelName:"Reverse",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.dims;oi(a,"reverse");var s=a.shape.length,i=Xt(o,a.shape);if(0===s)return pi({inputs:{x:a},backend:n});for(var u=new Wn(a.shape,a.dtype),l=n.bufferSync(a),_loop7=function _loop7(_e291){var t=u.indexToLoc(_e291),n=t.slice();i.forEach((function(e){return n[e]=a.shape[e]-1-n[e]})),u.set.apply(u,[l.get.apply(l,_toConsumableArray(n))].concat(_toConsumableArray(t)))},_e291=0;_e291<u.size;_e291++)_loop7(_e291);return n.makeTensorInfo(u.shape,u.dtype,u.values)}},lb={kernelName:"RotateWithOffset",backendName:"cpu",kernelFunc:function kernelFunc(_ref48){for(var e=_ref48.inputs,t=_ref48.attrs,n=_ref48.backend,r=e.image,a=t.radians,o=t.fillValue,s=t.center,i=n,u=Qt(r.dtype,Wt(r.shape)),_r$shape2=_slicedToArray(r.shape,4),l=_r$shape2[0],c=_r$shape2[1],d=_r$shape2[2],p=_r$shape2[3],_vo4=_slicedToArray(vo(s,c,d),2),h=_vo4[0],f=_vo4[1],m=Math.sin(a),g=Math.cos(a),b=i.data.get(r.dataId).values,_e292=0;_e292<l;_e292++)for(var _t241=_e292*d*c*p,_e293=0;_e293<c;_e293++)for(var _n179=_e293*(d*p),_r152=0;_r152<d;_r152++)for(var _a123=_r152*p,_s73=0;_s73<p;_s73++){var _i66=[l,_e293,_r152,_s73],_x26=_i66[2],_v7=_i66[1],_y8=(_x26-h)*g-(_v7-f)*m,_w8=(_x26-h)*m+(_v7-f)*g;_y8=Math.round(_y8+h),_w8=Math.round(_w8+f);var _k5=o;"number"!=typeof o&&(_k5=3===_s73?255:o[_s73]),_y8>=0&&_y8<d&&_w8>=0&&_w8<c&&(_k5=b[_t241+_w8*(d*p)+_y8*p+_s73]),u[_t241+_n179+_a123+_s73]=_k5}return{dataId:i.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},cb={kernelName:"Round",backendName:"cpu",kernelFunc:Ei("Round",(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1}))};function db(e,t,n,r,a,o,s,i,u,l){var c=[r/a,a],d=e.values,p=t.values;if(0===r)return Ur(n,t.dtype);var h=Ur(c,t.dtype);h.values.fill(u);for(var _e294=0;_e294<o;_e294++){for(var _o88=[],_u40=0,_t242=0;_t242<s;_t242++){var _n180=d[_e294*s+_t242];_o88.push(_n180),_u40+=_n180*i[_t242]}if(_u40<0||_u40>=r/a)throw new Error("Invalid indices: ".concat(_o88," does not index into ").concat(n));for(var _n181=0;_n181<a;_n181++)l?h.values[_u40*a+_n181]+=p[_e294*a+_n181]:h.values[_u40*a+_n181]=0===t.rank?p[0]:p[_e294*a+_n181]}return h}var pb={kernelName:"ScatterNd",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=t.updates,s=r.shape,_jr3=jr(0,a,s),i=_jr3.sliceRank,u=_jr3.numUpdates,l=_jr3.sliceSize,c=_jr3.strides,d=_jr3.outputSize,p=db(n.bufferSync(a),n.bufferSync(o),s,d,l,u,i,c,0,!0);return n.makeTensorInfo(s,p.dtype,p.values)}},hb={kernelName:"Select",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,o=t.e;oi([r,a,o],"select");for(var s=r.shape.length,i=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,l=n.data.get(o.dataId).values,c=Yn(a.dtype,o.dtype),d=un(Wt(a.shape),c),p=0,h=0===s||s>1||1===a.shape.length?1:Wt(a.shape.slice(1)),_e295=0;_e295<i.length;_e295++)for(var _t243=0;_t243<h;_t243++)1===i[_e295]?d[p++]=u[_e295]:d[p++]=l[_e295];return n.makeTensorInfo(a.shape,c,d)}},fb={kernelName:"Selu",backendName:"cpu",kernelFunc:Ei("Selu",(function(e){return e>=0?1.0507009873554805*e:1.7580993408473768*(Math.exp(e)-1)}))},mb={kernelName:"Sigmoid",backendName:"cpu",kernelFunc:Ei("Sigmoid",(function(e){return 1/(1+Math.exp(-e))}))},gb={kernelName:"Sign",backendName:"cpu",kernelFunc:Ei("Sign",(function(e){return e<0?-1:e>0?1:0}))},bb={kernelName:"Sin",backendName:"cpu",kernelFunc:Ei("Sin",(function(e){return Math.sin(e)}))},xb={kernelName:"Sinh",backendName:"cpu",kernelFunc:Ei("Sinh",(function(e){return Math.sinh(e)}))},vb=Math.log(1.1920928955078125e-7)+2,yb={kernelName:"Softplus",backendName:"cpu",kernelFunc:Ei("Softplus",(function(e){var t=e>-vb,n=e<vb,r=Math.exp(e);return n?r:t?e:Math.log(1+r)}))},wb={kernelName:"SpaceToBatchND",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,s=r.paddings;oi([a],"spaceToBatchND");var i=Wt(o),u=[[0,0]];u.push.apply(u,_toConsumableArray(s));for(var _e296=1+o.length;_e296<a.shape.length;++_e296)u.push([0,0]);var l=eb.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),c=yo(l.shape,o,i,!1),d=wo(c.length,o.length,!1),p=ko(l.shape,o,i,!1),h=Xf({inputs:{x:l},backend:n,attrs:{shape:c}}),f=su({inputs:{x:h},backend:n,attrs:{perm:d}}),m=Xf({inputs:{x:f},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),m}},kb={kernelName:"SparseToDense",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,o=t.sparseValues,s=t.defaultValue,i=r.outputShape,_jr4=jr(0,a,i),u=_jr4.sliceRank,l=_jr4.numUpdates,c=_jr4.sliceSize,d=_jr4.strides,p=_jr4.outputSize,h=db(n.bufferSync(a),n.bufferSync(o),i,p,c,l,u,d,n.data.get(s.dataId).values[0],!1);return n.makeTensorInfo(i,h.dtype,h.values)}},Ib={kernelName:"SplitV",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.numOrSizeSplits,i=Xt(r.axis,a.shape)[0],u=Mo(a,o,i),l=new Array(a.shape.length).fill(0),c=a.shape.slice();return u.map((function(e){var t=_toConsumableArray(c);t[i]=e;var r=fu({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[i]+=e,r}))}},Cb={kernelName:"Sqrt",backendName:"cpu",kernelFunc:Ei("Sqrt",(function(e){return Math.sqrt(e)}))},Ab={kernelName:"Square",backendName:"cpu",kernelFunc:function kernelFunc(_ref49){var e=_ref49.inputs,t=_ref49.backend,n=e.x,r=t;oi(n,"square");for(var a=r.data.get(n.dataId).values,o=new Float32Array(a.length),_e297=0;_e297<a.length;++_e297){var _t244=a[_e297];o[_e297]=_t244*_t244}return{dataId:r.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},Eb={kernelName:"Step",backendName:"cpu",kernelFunc:Ei("Step",(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha}))},_b={kernelName:"StridedSlice",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.begin,s=r.end,i=r.strides,u=r.beginMask,l=r.endMask,c=r.ellipsisMask,d=r.newAxisMask,p=r.shrinkAxisMask;oi(a,"stridedSlice");var y,_ua2=ua(a.shape,o,s,i,u,l,c,d,p),h=_ua2.nonStrided,f=_ua2.$begin,m=_ua2.$strides,g=_ua2.size,b=_ua2.newShape,x=_ua2.outShape,v=Xf({inputs:{x:a},backend:n,attrs:{shape:b}});if(h){var _e298=fu({inputs:{x:v},backend:n,attrs:{begin:f,size:g}});y=Xf({inputs:{x:_e298},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(_e298)}else if(x.some((function(e){return 0===e})))y=n.makeTensorInfo(x,a.dtype,[]);else{var _e299=xu(x,n.bufferSync(v),m,f);y=n.makeTensorInfo(_e299.shape,_e299.dtype,_e299.values)}var w=Xf({inputs:{x:y},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),w}},$b={kernelName:"Tan",backendName:"cpu",kernelFunc:Ei("Tan",(function(e){return Math.tan(e)}))},Nb=Ei("Tanh",(function(e){return Math.tanh(e)}));function Sb(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var _e300=2*t;n<_e300&&(n=_e300*Math.trunc(-n/_e300)+n),n=n<-t?n+_e300:-n-1}else if(n>t-1)if(t<=1)n=0;else{var _e301=2*t;(n-=_e301*Math.trunc(n/_e301))>=t&&(n=_e301-n-1)}return Ot(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var _e302=t-1;n+=t*(Math.trunc(-n/_e302)+1)}else if(n>t-1)if(t<=1)n=0;else{var _e303=t-1;n-=t*Math.trunc(n/_e303)}return Ot(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Ot(0,e,t-1)}(e,t);case"constant":default:return function(e,t){return e}(e)}}function Rb(e,t,n,r,a,o,s,i,u,l,c){return 0<=i&&i<t&&0<=u&&u<n?e[s*r+i*a+u*o+l]:c}function Tb(e,t,n,r,a,o,s,i,u,l,c){return Rb(e,t,n,r,a,o,s,Math.round(i),Math.round(u),l,c)}function Fb(e,t,n,r,a,o,s,i,u,l,c){var d=Math.floor(i),p=Math.floor(u),h=d+1,f=p+1;return(h-i)*((f-u)*Rb(e,t,n,r,a,o,s,d,p,l,c)+(u-p)*Rb(e,t,n,r,a,o,s,d,f,l,c))+(i-d)*((f-u)*Rb(e,t,n,r,a,o,s,h,p,l,c)+(u-p)*Rb(e,t,n,r,a,o,s,h,f,l,c))}for(var Ob,Db,Bb,Mb=[Yf,ii,Zf,Jf,ki,em,tm,nm,rm,am,om,sm,im,um,lm,hm,fm,mm,gm,Kf,bm,xm,vm,bi,Ni,ym,ci,wm,Am,$m,Nm,_m,Rm,Tm,Sm,Fm,Mm,Om,Dm,Bm,Lm,Wm,Um,Vm,Gm,zm,jm,Hm,eg,Df,Xm,Qm,Km,Fi,Zm,Oi,ag,sg,ig,Bi,ug,lg,cg,dg,pg,Wi,hg,hi,fg,Im,mg,gg,bg,Lf,Vi,xg,vg,Hi,yg,wg,kg,Ig,Cg,Ag,qi,$g,Ng,Sg,Rg,Tg,_g,Og,Dg,Ki,Bg,Lg,Ug,eu,nu,Gg,Hg,Xg,au,qg,Yg,Jg,eb,tb,Uf,lu,nb,mi,rb,Gf,Hf,qf,ab,ob,sb,ib,ub,lb,cb,pu,pb,hb,fb,mb,gb,bb,xb,mu,Wg,yb,wb,kb,Ib,Cb,Ab,bu,Eb,_b,wu,Mg,$b,{kernelName:"Tanh",backendName:"cpu",kernelFunc:Nb},{kernelName:"Tile",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reps;oi(a,"tile");var s=ku(n.bufferSync(a),o);return n.makeTensorInfo(s.shape,s.dtype,s.values)}},{kernelName:"TopK",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.k;r.sorted;oi(a,"topk");var _Iu2=_slicedToArray(Iu(n.data.get(a.dataId).values,a.shape,a.dtype,o),2),u=_Iu2[0],l=_Iu2[1];return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}},iu,{kernelName:"Transform",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,o=t.transforms,s=n.interpolation,i=n.fillMode,u=n.fillValue,l=n.outputShape,_a$shape7=_slicedToArray(a.shape,4),c=_a$shape7[0],d=_a$shape7[1],p=_a$shape7[2],h=_a$shape7[3],_ref51=_slicedToArray(null!=l?l:[d,p],2),f=_ref51[0],m=_ref51[1],g=[c,f,m,h],b=an(a.shape),x=b[0],v=b[1],y=b[2],w=Qt(a.dtype,Wt(g));w.fill(u);for(var k=r.data.get(a.dataId).values,I=r.data.get(o.dataId).values,_e304=0;_e304<c;++_e304){for(var _t245=1===o.shape[0]?I:I.subarray(8*_e304,8*_e304+8),_n182=0;_n182<f;++_n182)for(var _r153=0;_r153<m;++_r153)for(var _a124=0;_a124<h;++_a124){var _o89=void 0,_l34=_t245[6]*_r153+_t245[7]*_n182+1;if(0!==_l34){var _c29=(_t245[0]*_r153+_t245[1]*_n182+_t245[2])/_l34,_h15=(_t245[3]*_r153+_t245[4]*_n182+_t245[5])/_l34,_f9=Sb(_c29,p,i),_m18=Sb(_h15,d,i);switch(s){case"nearest":_o89=Tb(k,d,p,x,v,y,_e304,_m18,_f9,_a124,u);break;case"bilinear":_o89=Fb(k,d,p,x,v,y,_e304,_m18,_f9,_a124,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or 'bilinear', but got ".concat(s))}w[_e304*x+_n182*v+_r153*y+_a124]=_o89}}return r.makeTensorInfo(g,a.dtype,w)}return{dataId:r.write(w,g,a.dtype),shape:a.shape,dtype:a.dtype}}},{kernelName:"Unique",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,o=t.x;oi(o,"unique");var _Cu=Cu(r.data.get(o.dataId).values,a,o.shape,o.dtype),i=_Cu.outputValues,u=_Cu.outputShape,l=_Cu.indices;return[r.makeTensorInfo(u,o.dtype,i),r.makeTensorInfo([l.length],"int32",l)]}},{kernelName:"Unpack",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,o=r.axis;o<0&&(o+=a.shape.length);for(var s=a.shape.length,i=a.shape[o],u=new Array(s-1),l=0,_e305=0;_e305<s;_e305++)_e305!==o&&(u[l++]=a.shape[_e305]);var c=new Array(s).fill(0),d=a.shape.slice();d[o]=1;for(var p=new Array(i),_e306=0;_e306<p.length;_e306++){c[o]=_e306;var _t246=fu({inputs:{x:a},backend:n,attrs:{begin:c,size:d}});p[_e306]=Xf({inputs:{x:_t246},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(_t246)}return p}},{kernelName:"UnsortedSegmentSum",backendName:"cpu",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.segmentIds,s=r.numSegments;oi(a,"unsortedSegmentSum");for(var i=[],u=[],l=a.shape.length-o.shape.length,c=o,_e307=0;_e307<l;++_e307){var _t247=Ym({inputs:{input:c},backend:n,attrs:{dim:_e307+1}});c=_t247,u.push(_t247)}for(var _e308=0;_e308<s;++_e308){var _t248=_n(_e308,"int32"),_r154=n.makeTensorInfo([],"int32",_t248),_o90=qm({inputs:{a:_r154,b:c},backend:n}),_s74=gi({inputs:{x:_o90},backend:n,attrs:{dtype:"float32"}}),_l35=Ji({inputs:{a:_s74,b:a},backend:n}),_d17=Fg({inputs:{x:_l35},backend:n,attrs:{axis:0,keepDims:!1}});i.push(_d17),u.push(_r154),u.push(_o90),u.push(_s74),u.push(_l35),u.push(_d17)}var d=Zg({inputs:i,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),d}},Kg],_i67=0,_Mb=Mb;_i67<_Mb.length;_i67++){var _e309=_Mb[_i67];An(_e309)}!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(Ob||(Ob={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu"}(Db||(Db={}));var Lb={kernelName:"_FusedMatMul",backendName:"wasm",setupFunc:function setupFunc(e){Bb=e.wasm.cwrap("_FusedMatMul",null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=t.bias,i=t.preluActivationWeights;if("float32"!==a.dtype||"float32"!==o.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");var u=r.transposeA,l=r.transposeB,c=r.activation,d=r.leakyreluAlpha,p=n.dataIdMap.get(a.dataId).id,h=n.dataIdMap.get(o.dataId).id,f=0;if(null!=s){var _e310=n.dataIdMap.get(s.dataId);if(1!==_e310.shape.length)throw new Error("_FusedMatMul only supports rank-1 bias but got rank ".concat(_e310.shape.length,"."));f=_e310.id}var m=null==i?0:n.dataIdMap.get(i.dataId).id,g=Db[c];if(null==g)throw new Error("".concat(c," activation not yet supported for FusedConv2D in the wasm backend."));var b=u?a.shape[2]:a.shape[1],x=l?o.shape[1]:o.shape[2],v=a.shape[0],y=n.makeOutput([v,b,x],a.dtype),w=n.dataIdMap.get(y.dataId).id,k=new Uint8Array(new Int32Array(a.shape).buffer),I=new Uint8Array(new Int32Array(o.shape).buffer);return Bb(p,k,a.shape.length,h,I,o.shape.length,u,l,g,f,m,d||0,w),y}};function Pb(e){var t;return{kernelName:e,backendName:"wasm",setupFunc:function setupFunc(n){t=n.wasm.cwrap(e,null,["number","number"])},kernelFunc:function kernelFunc(e){var n=e.backend,r=e.inputs.x,a=n.dataIdMap.get(r.dataId).id,o=n.makeOutput(r.shape,r.dtype),s=n.dataIdMap.get(o.dataId).id;return 0===Wt(o.shape)||t(a,s),o}}}var Wb=Pb("Abs");function Ub(e,t,n){var r;return{kernelName:e,backendName:"wasm",setupFunc:function setupFunc(t){r=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function kernelFunc(a){var o=a.backend,s=a.inputs,i=s.a,u=s.b,l=o.dataIdMap.get(i.dataId).id,c=o.dataIdMap.get(u.dataId).id,d=null!=n?n:i.dtype,p=Ta(i.shape,u.shape),h=o.makeOutput(p,d);if(0===Wt(p))return h;var f=new Uint8Array(new Int32Array(i.shape).buffer),m=new Uint8Array(new Int32Array(u.shape).buffer),g=o.dataIdMap.get(h.dataId).id,b=function b(){return r(l,f,i.shape.length,c,m,u.shape.length,Ob[i.dtype],g)};if(t&&"float32"===i.dtype)return b(),h;var x=Sa(i.shape,p),v=Sa(u.shape,p),y=x.every((function(e,t){return e===t})),w=v.every((function(e,t){return e===t}));if(y&&w)return b(),h;throw new Error("Broadcasting along outer dims is not yet supported for ".concat(i.dtype," ").concat(e,"."))}}}var Gb,Vb=Ub("Add",!0),zb={kernelName:"AddN",backendName:"wasm",setupFunc:function setupFunc(e){Gb=e.wasm.cwrap("AddN",null,["array","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=n.makeOutput(t[0].shape,t[0].dtype);if(0===Wt(r.shape))return r;var a=t.map((function(e){return n.dataIdMap.get(e.dataId).id})),o=new Uint8Array(new Int32Array(a).buffer),s=n.dataIdMap.get(r.dataId).id;return Gb(o,a.length,Ob[r.dtype],s),r}};function Hb(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var Xb,jb={kernelName:"Identity",backendName:"wasm",kernelFunc:Hb};function qb(e){for(var t=e.inputs,n=e.backend,r=e.attrs,_ref53=_slicedToArray(function(e,t){for(var n=[],r=[],_a125=0;_a125<e.length;++_a125)1!==e[_a125]&&n.push(e[_a125]),1!==e[t[_a125]]&&r.push(t[_a125]);for(var _e311=0;_e311<r.length;++_e311){for(var _t249=-1,_n183=0;_n183<r.length;++_n183)r[_n183]>=_e311&&(-1===_t249||r[_t249]>r[_n183])&&(_t249=_n183);r[_t249]=_e311}return[n,r]}(t.x.shape,r.perm),2),a=_ref53[0],o=_ref53[1],s=!0,_e312=0;_e312<o.length;_e312++)o[_e312]!==_e312&&(s=!1);var i=function(e,t){for(var n=new Array(e.length),_r155=0;_r155<n.length;_r155++)n[_r155]=e[t[_r155]];return n}(t.x.shape,r.perm),u={dataId:t.x.dataId,shape:a,dtype:t.x.dtype};if(s){var _e313=Hb({inputs:t,backend:n});return _e313.shape=i,_e313}var l=n.makeOutput(i,u.dtype),c=n.dataIdMap.get(u.dataId).id,d=n.dataIdMap.get(l.dataId).id,p=new Uint8Array(new Int32Array(o).buffer),h=new Uint8Array(new Int32Array(u.shape).buffer);return Xb(c,h,u.shape.length,Ob[u.dtype],d,p,o.length),l}var Yb,Qb={kernelName:"Transpose",backendName:"wasm",kernelFunc:qb,setupFunc:function setupFunc(e){Xb=e.wasm.cwrap("Transpose",null,["number","array","number","number","number","array","number"])}};function Kb(e,t,n){var r=e.shape,a=e.shape.length,o=Xt(t,r),s=o,i=Ua(s,a),u=null,l=!1;if(null!=i){for(var _t250=new Array(a),_e314=0;_e314<_t250.length;_e314++)_t250[_e314]=r[i[_e314]];s=Ga(s.length,a),u=qb({inputs:{x:e},attrs:{perm:i},backend:n});var _o91=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==_o91&&(l=!0)}return{transposed:u,originalAxes:o,axes:s,inputWasTransposed:l}}var Jb,Zb={kernelName:"ArgMax",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,a=e.attrs.axis,o=n.x,s=t.dataIdMap.get(o.dataId).id,i=s,u=o,_Kb=Kb(o,a,t),l=_Kb.transposed,c=_Kb.axes,d=_Kb.inputWasTransposed;if(d){var _e315=t.dataIdMap.get(l.dataId).id;_e315!==s&&(u=l,i=_e315)}var p=u.shape.slice(0,-1),h=t.makeOutput(p,"int32"),f=t.dataIdMap.get(h.dataId).id,m=Wt(h.shape),g=u.shape[c[0]];return Yb(i,Ob[u.dtype],m,g,f),d&&t.disposeData(l.dataId),h},setupFunc:function setupFunc(e){Yb=e.wasm.cwrap("ArgMax",null,["number","number","number","number","number"])}},ex={kernelName:"AvgPool",backendName:"wasm",setupFunc:function setupFunc(e){Jb=e.wasm.cwrap("AvgPool",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=r.dataIdMap.get(a.dataId).id,s=n.filterSize,i=n.strides,u=n.pad,l=n.dimRoundingMode,c=ba(a.shape,s,i,1,u,l),d=c.filterHeight,p=c.filterWidth,h=c.padInfo.top,f=c.padInfo.right,m=c.padInfo.bottom,g=c.padInfo.left,b=c.strideHeight,x=c.strideWidth,v=c.inChannels;if("channelsLast"!==c.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(c.dataFormat,"'. Please use 'channelsLast'."));if(1!==c.dilationWidth||1!==c.dilationHeight)throw new Error("was backend only supports average pooling with dilation = [1, 1], got [".concat(c.dilationHeight,", ").concat(c.dilationWidth,"]."));var y=r.makeOutput(c.outShape,"float32"),w=r.dataIdMap.get(y.dataId).id;return Jb(o,a.shape[0],a.shape[1],a.shape[2],d,p,h,f,m,g,b,x,v,w),y}};function tx(e){var t=e.inputs,n=e.attrs,r=t.x,a=n.shape,o=Wt(r.shape),s=jt(a,o);return Bt(o===Wt(s),(function(){return"new shape: ".concat(s,", old shape: ").concat(r.shape,". New shape and old shape must have the same number of elements.")})),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:s,dtype:r.dtype}}var rx,nx={kernelName:"Reshape",backendName:"wasm",kernelFunc:tx},ax={kernelName:"BatchMatMul",backendName:"wasm",setupFunc:function setupFunc(e){rx=e.wasm.cwrap("BatchMatMul",null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=r.transposeA,i=r.transposeB;if("float32"!==a.dtype||"float32"!==o.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");var u=a.shape.length,l=o.shape.length,c=s?a.shape[u-2]:a.shape[u-1],d=i?o.shape[l-1]:o.shape[l-2],p=s?a.shape[u-1]:a.shape[u-2],h=i?o.shape[l-2]:o.shape[l-1],f=a.shape.slice(0,-2),m=o.shape.slice(0,-2),g=Wt(f),b=Wt(m);Bt(u>=2&&l>=2&&(g===b||1===g||1===b),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(f,") and (").concat(m,").")}));var x=(g>b?a.shape.slice(0,-2):o.shape.slice(0,-2)).concat([p,h]);Bt(c===d,(function(){return"Error in matMul: inner shapes (".concat(c,") and (").concat(d,") of Tensors with shapes ").concat(a.shape," and ").concat(o.shape," and transposeA=").concat(s," and transposeB=").concat(i," must match.")}));var v=i?[b,h,d]:[b,d,h],y=tx({inputs:{x:a},backend:n,attrs:{shape:s?[g,c,p]:[g,p,c]}}),w=tx({inputs:{x:o},backend:n,attrs:{shape:v}}),k=n.dataIdMap.get(y.dataId).id,I=n.dataIdMap.get(w.dataId).id,C=s?y.shape[2]:y.shape[1],A=i?w.shape[1]:w.shape[2],E=Math.max(g,b),_=n.makeOutput([E,C,A],y.dtype),$=n.dataIdMap.get(_.dataId).id,N=new Uint8Array(new Int32Array(y.shape).buffer),S=new Uint8Array(new Int32Array(w.shape).buffer);return rx(k,N,y.shape.length,I,S,w.shape.length,s,i,$),n.disposeData(y.dataId),n.disposeData(w.dataId),_.shape=x,_}};function ox(e){var t=e.inputs.x,n=e.attrs.dtype,r=e.backend,a=r.makeOutput(t.shape,n),o=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(o),a}var ux,sx={kernelName:"Cast",backendName:"wasm",kernelFunc:ox},ix=Pb("Ceil"),lx={kernelName:"ClipByValue",backendName:"wasm",setupFunc:function setupFunc(e){ux=e.wasm.cwrap("ClipByValue",null,["number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.clipValueMin,s=r.clipValueMax,i=n.dataIdMap.get(a.dataId).id,u=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(u.dataId).id;return ux(i,o,s,l),u}};function cx(e){var t=e.inputs,n=e.backend,r=Xt(e.attrs.axis,t[0].shape)[0],a=bo(t.map((function(e){return e.shape})),r),o=t.filter((function(e){return Wt(e.shape)>0}));if(1===o.length)return Hb({inputs:{x:o[0]},backend:n});var s=n.makeOutput(a,t[0].dtype);if(0===Wt(a))return s;if(go(o.map((function(e){return e.shape})),r),"string"===o[0].dtype){var _e316=o.map((function(e){var t=Wt(e.shape.slice(r));return tx({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),_i68=_e316.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}}));a=bo(_e316.map((function(e){return e.shape})),1);var _u41=1===_e316[0].shape[0],_l36=Si(_i68,a,t[0].dtype,_u41),_c30=bo(o.map((function(e){return e.shape})),r);return s.shape=_c30,n.dataIdMap.get(s.dataId).stringBytes=Wo(_l36),_e316.forEach((function(e){return n.disposeData(e.dataId)})),s}for(var i=Wt(o[0].shape.slice(0,r)),u=0,l=o.map((function(e){var t=Wt(e.shape.slice(r));return u+=t,t})),c=o.map((function(e){return n.typedArrayFromHeap(e)})),d=n.typedArrayFromHeap(s),_e317=0;_e317<i;_e317++)for(var _t251=_e317*u,_n184=0;_n184<c.length;_n184++){var _r156=l[_n184],_a126=_e317*_r156,_o92=c[_n184].subarray(_a126,_a126+_r156);d.set(_o92,_t251),_t251+=_r156}return s}var px,fx,bx,xx,dx={kernelName:"Concat",backendName:"wasm",kernelFunc:cx},hx={kernelName:"Conv2D",backendName:"wasm",setupFunc:function setupFunc(e){px=e.wasm.cwrap("Conv2D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,s=r.dataIdMap.get(a.dataId).id,i=r.dataIdMap.get(o.dataId).id,u=n.strides,l=n.dilations,c=n.pad,d=n.dimRoundingMode,h=$a(n.dataFormat),f=va(a.shape,o.shape,u,l,c,d,!1,h),m=f.filterHeight,g=f.filterWidth,b=f.padInfo.top,x=f.padInfo.right,v=f.padInfo.bottom,y=f.padInfo.left,w=f.dilationHeight,k=f.dilationWidth,I=f.strideHeight,C=f.strideWidth,A=f.inChannels,E=f.outChannels,_="SAME"===f.padInfo.type?1:0;if("channelsLast"!==f.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'".concat(f.dataFormat,"'. Please use 'channelsLast'."));var $=r.makeOutput(f.outShape,"float32"),N=r.dataIdMap.get($.dataId).id;return px(s,a.shape[0],a.shape[1],a.shape[2],i,m,g,b,x,v,y,_,w,k,I,C,A,E,N),$}},mx={kernelName:"Conv2DBackpropInput",backendName:"wasm",setupFunc:function setupFunc(e){fx=e.wasm.cwrap("Conv2DBackpropInput",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.dy,o=n.filter,s=r.strides,i=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=r.inputShape,d=$a(u),p=va(c,o.shape,s,1,i,l,!1,d),h=p.batchSize,f=p.filterHeight,m=p.filterWidth,g=p.inChannels,b=p.inHeight,x=p.inWidth,v=p.outChannels,y=p.outHeight,w=p.outWidth,k=p.strideHeight,I=p.strideWidth,C=f-1-p.padInfo.top,A=m-1-p.padInfo.left,E="channelsLast"===p.dataFormat,_=an(p.inShape),$=an(a.shape),_an2=_slicedToArray(an(o.shape),3),N=_an2[0],S=_an2[1],R=_an2[2],T=_[0],F=E?_[1]:_[2],M=E?_[2]:1,O=E?1:_[1],D=$[0],B=E?$[1]:$[2],L=E?$[2]:1,P=E?1:$[1],W=t.makeOutput(p.inShape,"float32"),U=t.dataIdMap.get(W.dataId).id,V=t.dataIdMap.get(a.dataId).id,G=t.dataIdMap.get(o.dataId).id;return fx(V,G,h,f,m,b,x,g,y,w,v,k,I,C,A,N,S,R,T,F,M,O,D,B,L,P,U),W}},gx=Pb("Cos");!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(bx||(bx={}));var yx,kx,Cx,vx={kernelName:"CropAndResize",backendName:"wasm",setupFunc:function setupFunc(e){xx=e.wasm.cwrap("CropAndResize",null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var f,t=e.backend,n=e.inputs,r=e.attrs,a=r.method,o=r.extrapolationValue,s=r.cropSize,i=n.image,u=n.boxes,l=n.boxInd,c=u.shape[0],_s75=_slicedToArray(s,2),d=_s75[0],p=_s75[1],h=[c,d,p,i.shape[3]],m=t.dataIdMap.get(i.dataId);"float32"!==i.dtype&&(f=ox({backend:t,inputs:{x:i},attrs:{dtype:"float32"}}),m=t.dataIdMap.get(f.dataId));var g=m.id,b=t.dataIdMap.get(u.dataId).id,x=t.dataIdMap.get(l.dataId).id,v=t.makeOutput(h,"float32"),y=t.dataIdMap.get(v.dataId).id,w=new Uint8Array(new Int32Array(i.shape).buffer);return xx(g,b,x,c,w,d,p,bx[a],o,y),null!=f&&t.disposeData(f.dataId),v}},wx={kernelName:"Cumsum",backendName:"wasm",setupFunc:function setupFunc(e){yx=e.wasm.cwrap("Cumsum",null,["number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.exclusive,i=r.reverse,u=a.shape.length;Bt("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumsum does not support ".concat(a.dtype," tensors in the WASM backend")}));var l=Ua([o],u),c=a;null!==l&&(c=qb({inputs:{x:a},attrs:{perm:l},backend:n}));var d=Ga(1,u)[0];Wa("cumsum",[d],u);var p=n.makeOutput(c.shape,c.dtype),h=c.shape[d],f=n.dataIdMap.get(c.dataId).id,m=n.dataIdMap.get(p.dataId).id;yx(f,s?1:0,i?1:0,h,m,Ob[a.dtype]);var g=p;return null!==l&&(g=qb({inputs:{x:p},attrs:{perm:Va(l)},backend:n}),n.disposeData(c.dataId),n.disposeData(p.dataId)),g}},Ix={kernelName:"DepthToSpace",backendName:"wasm",setupFunc:function setupFunc(e){kx=e.wasm.cwrap("DepthToSpace",null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,o=r.blockSize,s=r.dataFormat;Bt(o>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(o)}));var i=a.shape[0],u="NHWC"===s?a.shape[1]:a.shape[2],l="NHWC"===s?a.shape[2]:a.shape[3],c="NHWC"===s?a.shape[3]:a.shape[1],d=u*o,p=l*o,h=c/(o*o),f="NHWC"===s?[i,d,p,h]:[i,h,d,p],m=t.makeOutput(f,"float32"),g=t.dataIdMap.get(a.dataId).id,b=new Uint8Array(new Int32Array(an(a.shape)).buffer),x=new Uint8Array(new Int32Array(f).buffer),v=new Uint8Array(new Int32Array(an(f)).buffer),y=t.dataIdMap.get(m.dataId).id;return kx(g,o,"NHWC"===s?1:0,b,a.shape.length-1,x,v,f.length,y),m}},Ax={kernelName:"DepthwiseConv2dNative",backendName:"wasm",setupFunc:function setupFunc(e){Cx=e.wasm.cwrap("DepthwiseConv2dNative",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,s=r.dataIdMap.get(a.dataId).id,i=r.dataIdMap.get(o.dataId).id,u=n.strides,l=n.dilations,c=n.pad,d=n.dimRoundingMode,p=null==l?[1,1]:l,h=va(a.shape,o.shape,u,p,c,d,!0),f=h.filterHeight,m=h.filterWidth,g=h.padInfo.top,b=h.padInfo.right,x=h.padInfo.bottom,v=h.padInfo.left,y=h.dilationHeight,w=h.dilationWidth,k=h.strideHeight,I=h.strideWidth,C=h.inChannels,A=h.outChannels,E="SAME"===h.padInfo.type?1:0;if("channelsLast"!==h.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'".concat(h.dataFormat,"'. Please use 'channelsLast'."));var _=r.makeOutput(h.outShape,"float32"),$=r.dataIdMap.get(_.dataId).id;return Cx(s,a.shape[0],a.shape[1],a.shape[2],i,f,m,g,b,x,v,E,y,w,k,I,C,A,$),_}},Ex=Ub("Equal",!1,"bool"),_x=Pb("Exp");function $x(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.input,o=n.dim,s=a.shape.length,i=a.shape.slice(),u=o;return o<0&&(Bt(-(s+1)<=o,(function(){return"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")})),u=s+o+1),i.splice(u,0,1),tx({inputs:{x:a},backend:r,attrs:{shape:i}})}var Rx,Ox,Bx,Px,Ux,Gx,Xx,Jx,nv,av,sv,pv,Nx={kernelName:"ExpandDims",backendName:"wasm",kernelFunc:$x},Sx={kernelName:"Fill",backendName:"wasm",kernelFunc:function kernelFunc(e){var _e$attrs=e.attrs,t=_e$attrs.shape,n=_e$attrs.value,r=_e$attrs.dtype,a=e.backend,o=a.makeOutput(t,r);return a.typedArrayFromHeap(o).fill(n),o}},Tx={kernelName:"FlipLeftRight",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.image,a=n.makeOutput(r.shape,r.dtype),o=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,_r$shape3=_slicedToArray(r.shape,4),i=_r$shape3[0],u=_r$shape3[1],l=_r$shape3[2],c=_r$shape3[3];return Rx(o,i,u,l,c,s),a},setupFunc:function setupFunc(e){Rx=e.wasm.cwrap("FlipLeftRight",null,["number","number","number","number","number","number"])}},Fx=Pb("Floor"),Mx=Ub("FloorDiv",!1),Dx={kernelName:"FusedBatchNorm",backendName:"wasm",setupFunc:function setupFunc(e){Ox=e.wasm.cwrap("FusedBatchNorm",null,["number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,a=e.attrs.varianceEpsilon,o=n.x,s=n.mean,i=n.variance,u=n.offset,l=n.scale,c=t.dataIdMap.get(o.dataId).id,d=t.dataIdMap.get(s.dataId).id,p=t.dataIdMap.get(i.dataId).id,h=null!=u?t.dataIdMap.get(u.dataId).id:0,f=null!=l?t.dataIdMap.get(l.dataId).id:0,m=t.makeOutput(o.shape,o.dtype);if(0===Wt(o.shape))return m;var g=t.dataIdMap.get(m.dataId).id;return Ox(c,d,p,h,f,a,g),m}},Lx={kernelName:"FusedConv2D",backendName:"wasm",setupFunc:function setupFunc(e){Bx=e.wasm.cwrap("FusedConv2D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=n.strides,l=n.pad,c=n.dilations,d=n.dataFormat,p=n.dimRoundingMode,h=n.activation,f=n.leakyreluAlpha,m=va(a.shape,o.shape,u,c,l,p),g=Db[h];if(null==g)throw new Error("".concat(h," activation not yet supported for FusedConv2D in the wasm backend."));var b=r.dataIdMap.get(a.dataId).id,x=r.dataIdMap.get(o.dataId).id,v=m.outChannels,y=0;if(null!=s){var _e318=r.dataIdMap.get(s.dataId);if(1!==_e318.shape.length)throw new Error("FusedConv2D only supports rank-1 bias but got rank ".concat(_e318.shape.length,"."));if(_e318.shape[0]!==v)throw new Error("FusedConv2D bias shape (".concat(_e318.shape,") does not match the number of output channels (").concat(v,")"));y=_e318.id}var w=m.filterHeight,k=m.filterWidth,I=m.padInfo.top,C=m.padInfo.right,A=m.padInfo.bottom,E=m.padInfo.left,_=m.dilationHeight,$=m.dilationWidth,N=m.strideHeight,S=m.strideWidth,R=m.inChannels,T="SAME"===m.padInfo.type?1:0,F=m.batchSize,M=m.inHeight,O=m.inWidth;if("NHWC"!==d)throw new Error("wasm backend FusedConv2D does not support dataFormat:'".concat(d,"'. Please use 'NHWC'."));var D=r.makeOutput(m.outShape,"float32"),B=r.dataIdMap.get(D.dataId).id,L=null==i?0:r.dataIdMap.get(i.dataId).id;return Bx(b,F,M,O,x,w,k,y,I,C,A,E,T,_,$,N,S,R,v,g,L,f||0,B),D}},Wx={kernelName:"FusedDepthwiseConv2D",backendName:"wasm",setupFunc:function setupFunc(e){Px=e.wasm.cwrap("FusedDepthwiseConv2D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,s=t.bias,i=t.preluActivationWeights,u=n.strides,l=n.pad,c=n.dilations,d=n.dataFormat,p=n.dimRoundingMode,h=n.activation,f=n.leakyreluAlpha,m=va(a.shape,o.shape,u,c,l,p,!0),g=Db[h];if(null==g)throw new Error("".concat(h," activation not yet supported for FusedDepthwiseConv2D in the wasm backend."));var b=r.dataIdMap.get(a.dataId).id,x=r.dataIdMap.get(o.dataId).id,v=m.outChannels,y=0;if(null!=s){var _e319=r.dataIdMap.get(s.dataId);if(1!==_e319.shape.length)throw new Error("FusedDepthwiseConv2D only supports rank-1 bias but got rank ".concat(_e319.shape.length,"."));if(_e319.shape[0]!==v)throw new Error("FusedDepthwiseConv2D bias shape (".concat(_e319.shape,") does not match the number of output channels (").concat(v,")"));y=_e319.id}var w=m.filterHeight,k=m.filterWidth,I=m.padInfo.top,C=m.padInfo.right,A=m.padInfo.bottom,E=m.padInfo.left,_=m.dilationHeight,$=m.dilationWidth,N=m.strideHeight,S=m.strideWidth,R=m.inChannels,T="SAME"===m.padInfo.type?1:0,F=m.batchSize,M=m.inHeight,O=m.inWidth;if("NHWC"!==d)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'".concat(d,"'. Please use 'NHWC'."));var D=r.makeOutput(m.outShape,"float32"),B=r.dataIdMap.get(D.dataId).id,L=null==i?0:r.dataIdMap.get(i.dataId).id;return Px(b,F,M,O,x,w,k,y,I,C,A,E,T,_,$,N,S,R,v,g,L,f||0,B),D}},Vx={kernelName:"GatherNd",backendName:"wasm",setupFunc:function setupFunc(e){Ux=e.wasm.cwrap("GatherNd",null,["number","number","number","number","number","number","array","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=n.params,a=n.indices,_zr6=_slicedToArray(zr(r,a),4),o=_zr6[0],s=_zr6[1],i=_zr6[2],u=_zr6[3],l=t.makeOutput(o,r.dtype);if(0===s)return l;var c=a.shape,d=c[c.length-1],p=t.dataIdMap.get(r.dataId).id,h=t.dataIdMap.get(a.dataId).id,f=new Uint8Array(new Int32Array(u).buffer),m=t.dataIdMap.get(l.dataId).id;return Ux(p,Ob[r.dtype],h,s,d,i,f,m),l}},zx={kernelName:"GatherV2",backendName:"wasm",setupFunc:function setupFunc(e){Gx=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,o=n.indices,s=r.axis,i=r.batchDims,u=Bo(a,o,Xt(s,a.shape)[0],i),l=tx({inputs:{x:a},attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]},backend:t}),c=Wt(o.shape),d=tx({inputs:{x:o},attrs:{shape:[u.batchSize,c/u.batchSize]},backend:t}),p=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize],h=t.makeOutput(p,a.dtype);if(0===Wt(a.shape))return h;var f=l.shape.length-1,m=t.dataIdMap.get(l.dataId).id,g=t.dataIdMap.get(d.dataId).id,b=t.dataIdMap.get(h.dataId).id,x=new Uint8Array(new Int32Array(an(l.shape)).buffer),v=new Uint8Array(new Int32Array(an(p)).buffer);return Gx(m,Ob[a.dtype],x,f,g,u.batchSize,v,b),t.disposeData(l.dataId),t.disposeData(d.dataId),h.shape=u.outputShape,h}},Hx=Ub("Greater",!1,"bool"),jx=Ub("GreaterEqual",!1,"bool"),qx={kernelName:"LeakyRelu",backendName:"wasm",setupFunc:function setupFunc(e){Xx=e.wasm.cwrap("LeakyRelu",null,["number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs.x,n=e.attrs.alpha,r=e.backend,a=r.dataIdMap.get(t.dataId).id,o=r.makeOutput(t.shape,t.dtype);if(0!==Wt(t.shape)){var _e320=r.dataIdMap.get(o.dataId).id;Xx(a,n,_e320)}return o}},Qx=Ub("Less",!1,"bool"),Kx=Ub("LessEqual",!1,"bool"),Yx=Pb("Log"),Zx=Ub("LogicalAnd",!1,"bool"),ev={kernelName:"Max",backendName:"wasm",setupFunc:function setupFunc(e){Jx=e.wasm.cwrap("Max",null,["number, number, number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.reductionIndices,o=r.keepDims,s=n.x,i=t.dataIdMap.get(s.dataId).id,u=s,_Kb2=Kb(s,a,t),l=_Kb2.transposed,c=_Kb2.axes,d=_Kb2.originalAxes,p=_Kb2.inputWasTransposed;p&&(u=l,i=t.dataIdMap.get(l.dataId).id),Wa("max",c,u.shape.length);var _La34=_slicedToArray(La(u.shape,c),2),h=_La34[0],m=Wt(_La34[1]),g=t.makeOutput(h,s.dtype);if(0!==Wt(u.shape)){var _e321=t.dataIdMap.get(g.dataId).id;Jx(i,m,_e321)}if(p&&t.disposeData(l.dataId),o){var _e322=Pa(g.shape,d);g.shape=_e322}return g}},tv=Ub("Maximum",!1),rv={kernelName:"MaxPool",backendName:"wasm",setupFunc:function setupFunc(e){nv=e.wasm.cwrap("MaxPool",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=r.dataIdMap.get(a.dataId).id,s=n.filterSize,i=n.strides,u=n.pad,l=n.dimRoundingMode,c=ba(a.shape,s,i,1,u,l),d=c.filterHeight,p=c.filterWidth,h=c.padInfo.top,f=c.padInfo.right,m=c.padInfo.bottom,g=c.padInfo.left,b=c.dilationHeight,x=c.dilationWidth,v=c.strideHeight,y=c.strideWidth,w=c.inChannels,k=c.outChannels;if("channelsLast"!==c.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(c.dataFormat,"'. Please use 'channelsLast'."));var I=r.makeOutput(c.outShape,"float32"),C=r.dataIdMap.get(I.dataId).id;return nv(o,a.shape[0],a.shape[1],a.shape[2],d,p,h,f,m,g,b,x,v,y,w,k,C),I}},ov={kernelName:"Mean",backendName:"wasm",setupFunc:function setupFunc(e){av=e.wasm.cwrap("Mean",null,["number, number, number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,s=n.x,i=t.dataIdMap.get(s.dataId).id,u=i,l=s,_Kb3=Kb(s,a,t),c=_Kb3.transposed,d=_Kb3.axes,p=_Kb3.originalAxes,h=_Kb3.inputWasTransposed,f=d;if(h){var _e323=t.dataIdMap.get(c.dataId).id;_e323!==i&&(l=c,u=_e323,f=Ga(f.length,l.shape.length))}Wa("mean",f,l.shape.length);var _La36=_slicedToArray(La(l.shape,f),2),m=_La36[0],b=Wt(_La36[1]),x=l;"float32"!==l.dtype&&(x=ox({backend:t,inputs:{x:l},attrs:{dtype:"float32"}}),u=t.dataIdMap.get(x.dataId).id);var v=t.makeOutput(m,"float32");if(0!==Wt(l.shape)){var _e324=t.dataIdMap.get(v.dataId).id;av(u,b,_e324)}if(h&&t.disposeData(c.dataId),o){var _e325=Pa(v.shape,p);v.shape=_e325}return"float32"!==l.dtype&&t.disposeData(x.dataId),v}},iv={kernelName:"Min",backendName:"wasm",setupFunc:function setupFunc(e){sv=e.wasm.cwrap("Min",null,["number, number, number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,s=n.x,i=t.dataIdMap.get(s.dataId).id,u=i,l=s,_Kb4=Kb(s,a,t),c=_Kb4.transposed,d=_Kb4.axes,p=_Kb4.originalAxes,h=_Kb4.inputWasTransposed;if(h){var _e326=t.dataIdMap.get(c.dataId).id;_e326!==i&&(l=c,u=_e326)}Wa("min",d,l.shape.length);var _La38=_slicedToArray(La(l.shape,d),2),f=_La38[0],g=Wt(_La38[1]),b=t.makeOutput(f,l.dtype);if(0!==Wt(l.shape)){var _e327=t.dataIdMap.get(b.dataId).id;sv(u,g,_e327)}if(h&&t.disposeData(c.dataId),o){var _e328=Pa(b.shape,p);b.shape=_e328}return b}},uv=Ub("Minimum",!1),lv=Ub("Multiply",!0),cv=Pb("Neg");function dv(e,t){var n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],o=n[2],s=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:o,pValidOutputs:s}}var fv,gv,vv,Iv,Ev,$v,Mv,Dv,Lv,Uv,Vv,Gv,Hv,jv,Xv,qv,Qv,Kv,hv={kernelName:"NonMaxSuppressionV3",backendName:"wasm",setupFunc:function setupFunc(e){pv=e.wasm.cwrap("NonMaxSuppressionV3","number",["number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,o=r.maxOutputSize,s=r.scoreThreshold,i=n.boxes,u=n.scores,l=t.dataIdMap.get(i.dataId).id,c=t.dataIdMap.get(u.dataId).id,_dv=dv(t,pv(l,c,o,a,s)),p=_dv.pSelectedIndices,h=_dv.selectedSize,f=_dv.pSelectedScores,m=_dv.pValidOutputs;return t.wasm._free(f),t.wasm._free(m),t.makeOutput([h],"int32",p)}},mv={kernelName:"NonMaxSuppressionV4",backendName:"wasm",setupFunc:function setupFunc(e){fv=e.wasm.cwrap("NonMaxSuppressionV4","number",["number","number","number","number","number","bool"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,o=r.maxOutputSize,s=r.scoreThreshold,i=r.padToMaxOutputSize,u=n.boxes,l=n.scores,c=t.dataIdMap.get(u.dataId).id,d=t.dataIdMap.get(l.dataId).id,_dv2=dv(t,fv(c,d,o,a,s,i)),h=_dv2.pSelectedIndices,f=_dv2.selectedSize,m=_dv2.pSelectedScores,g=_dv2.pValidOutputs;return t.wasm._free(m),[t.makeOutput([f],"int32",h),t.makeOutput([],"int32",g)]}},bv={kernelName:"NonMaxSuppressionV5",backendName:"wasm",setupFunc:function setupFunc(e){gv=e.wasm.cwrap("NonMaxSuppressionV5","number",["number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,o=r.maxOutputSize,s=r.scoreThreshold,i=r.softNmsSigma,u=n.boxes,l=n.scores,c=t.dataIdMap.get(u.dataId).id,d=t.dataIdMap.get(l.dataId).id,_dv3=dv(t,gv(c,d,o,a,s,i)),h=_dv3.pSelectedIndices,f=_dv3.selectedSize,m=_dv3.pSelectedScores,g=_dv3.pValidOutputs;return t.wasm._free(g),[t.makeOutput([f],"int32",h),t.makeOutput([f],"float32",m)]}},xv=Ub("NotEqual",!1,"bool"),yv={kernelName:"OneHot",backendName:"wasm",setupFunc:function setupFunc(e){vv=e.wasm.cwrap("OneHot",null,["number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=r.depth,s=r.onValue,i=r.offValue,u=n.makeOutput([].concat(_toConsumableArray(a.shape),[o]),"int32"),l=n.dataIdMap.get(u.dataId).id,c=n.dataIdMap.get(a.dataId).id;return vv(c,o,s,i,l),u}},wv={kernelName:"OnesLike",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}},kv={kernelName:"Pack",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,a=e.attrs.axis;if(1===t.length)return $x({inputs:{input:t[0]},backend:n,attrs:{dim:a}});var o=t[0].shape,s=t[0].dtype;t.forEach((function(e){Lt(o,e.shape,"All tensors passed to stack must have matching shapes"),Bt(s===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=[],u=cx({inputs:t.map((function(e){var t=$x({inputs:{input:e},backend:n,attrs:{dim:a}});return i.push(t),t})),backend:n,attrs:{axis:a}});return i.forEach((function(e){return n.disposeData(e.dataId)})),u}},Cv={kernelName:"PadV2",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs.x,n=e.backend,_e$attrs2=e.attrs,r=_e$attrs2.paddings,a=_e$attrs2.constantValue,o=r.map((function(e,n){return e[0]+t.shape[n]+e[1]})),s=n.dataIdMap.get(t.dataId).id,i=n.makeOutput(o,t.dtype),u=n.dataIdMap.get(i.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),c=r.map((function(e){return e[0]})),d=r.map((function(e){return e[1]})),p=new Uint8Array(new Int32Array(c).buffer),h=new Uint8Array(new Int32Array(d).buffer);return Iv(s,l,t.shape.length,Ob[t.dtype],p,h,a,u),i},setupFunc:function setupFunc(e){Iv=e.wasm.cwrap("PadV2",null,["number","array","number","number","array","array","number","number"])}},Av=Ub("Pow",!1),_v={kernelName:"Prelu",backendName:"wasm",setupFunc:function setupFunc(e){Ev=e.wasm.cwrap("Prelu",null,["number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,o=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,i=n.makeOutput(r.shape,"float32"),u=n.dataIdMap.get(i.dataId).id;return Ev(o,s,u),i}},Nv={kernelName:"Prod",backendName:"wasm",setupFunc:function setupFunc(e){$v=e.wasm.cwrap("Prod",null,["number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,s=n.x,i=t.dataIdMap.get(s.dataId).id,u=i,l=s,_Kb5=Kb(s,a,t),c=_Kb5.transposed,d=_Kb5.axes,p=_Kb5.originalAxes,h=_Kb5.inputWasTransposed,f=d;if(h){var _e329=t.dataIdMap.get(c.dataId).id;_e329!==i&&(l=c,u=_e329,f=Ga(f.length,l.shape.length))}Wa("prod",f,l.shape.length);var _La40=_slicedToArray(La(l.shape,f),2),m=_La40[0],b=Wt(_La40[1]),x=t.makeOutput(m,l.dtype);if(0!==Wt(l.shape)){var _e330=t.dataIdMap.get(x.dataId).id;$v(u,b,Ob[x.dtype],_e330)}if(h&&t.disposeData(c.dataId),o){var _e331=Pa(x.shape,p);x.shape=_e331}return x}},Sv={kernelName:"Range",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.step,s=n.dtype,i=cu(r,a,o,s),u=t.makeOutput([i.length],s);return t.typedArrayFromHeap(u).set(i),u}},Rv=Ub("RealDiv",!0),Tv=Pb("Relu"),Fv=Pb("Relu6"),Ov={kernelName:"ResizeBilinear",backendName:"wasm",setupFunc:function setupFunc(e){Mv=e.wasm.cwrap("ResizeBilinear",null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function kernelFunc(e){var m,t=e.backend,n=e.inputs,r=e.attrs,a=n.images,o=r.alignCorners,s=r.halfPixelCenters,_i69=_slicedToArray(r.size,2),u=_i69[0],l=_i69[1],_a$shape8=_slicedToArray(a.shape,4),c=_a$shape8[0],d=_a$shape8[1],p=_a$shape8[2],h=_a$shape8[3],f=[c,u,l,h],g=t.dataIdMap.get(a.dataId);"float32"!==g.dtype&&(m=ox({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),g=t.dataIdMap.get(m.dataId));var b=g.id,x=t.makeOutput(f,"float32");if(0===Wt(a.shape))return x;var v=t.dataIdMap.get(x.dataId).id;return Mv(b,c,d,p,h,u,l,o?1:0,s?1:0,v),null!=m&&t.disposeData(m.dataId),x}},Bv={kernelName:"Reverse",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,s=Xt(r.dims,a.shape);if(0===a.shape.length)return Hb({inputs:{x:a},backend:n});var i=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(a.dataId).id,l=n.dataIdMap.get(i.dataId).id,c=new Uint8Array(new Int32Array(s).buffer),d=new Uint8Array(new Int32Array(a.shape).buffer);Dv(u,c,s.length,d,a.shape.length,l);var p=tx({inputs:{x:i},attrs:{shape:a.shape},backend:n});return n.disposeData(i.dataId),p},setupFunc:function setupFunc(e){Dv=e.wasm.cwrap("Reverse",null,["number","array","number","array","number","number"])}},Pv={kernelName:"RotateWithOffset",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=r.radians,s=r.fillValue,i=r.center,u=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(u.dataId).id,_a$shape9=_slicedToArray(a.shape,4),d=_a$shape9[0],p=_a$shape9[1],h=_a$shape9[2],f=_a$shape9[3],_vo6=_slicedToArray(vo(i,p,h),2),m=_vo6[0],g=_vo6[1],b="number"==typeof s?[s,s,s,0===s?0:255]:[].concat(_toConsumableArray(s),[255]),x=new Uint8Array(new Int32Array(b).buffer);return Lv(l,d,p,h,f,o,m,g,x,b.length,c),u},setupFunc:function setupFunc(e){Lv=e.wasm.cwrap("RotateWithOffset",null,["number","number","number","number","number","number","number","number","array","number","number"])}},Wv=Pb("Round");function zv(e){var t=e.inputs.x,_e$attrs3=e.attrs,n=_e$attrs3.begin,r=_e$attrs3.size,a=e.backend,_ia6=_slicedToArray(ia(t,n,r),2),o=_ia6[0],s=_ia6[1],i=oa(t.shape,o,s),u=a.readSync(t.dataId),l=a.makeOutput(s,t.dtype),c=an(t.shape),d=a.dataIdMap.get(l.dataId);if(i){var _e332=sa(o,c);return"string"===t.dtype?d.stringBytes=u.slice(_e332,_e332+Wt(s)):a.typedArrayFromHeap(l).set(u.subarray(_e332,_e332+Wt(s))),l}if("string"===t.dtype){var _e333=hu(u,o,s,t.shape,t.dtype);return d.stringBytes=_e333,l}var p=a.typedArrayFromHeap(l),h=t.shape.length;if(2===h)!function(e,t,n,r,a){for(var o=0,s=r[0],i=r[1],u=s+a[0],_r157=s;_r157<u;_r157++){var _s76=_r157*t+i;n.set(e.subarray(_s76,_s76+a[1]),o),o+=a[1]}}(u,c[0],p,o,s);else if(3===h)!function(e,t,n,r,a,o){for(var s=0,i=a[0],u=a[1],l=a[2],c=i+o[0],d=u+o[1],_a127=i;_a127<c;_a127++)for(var _i70=u;_i70<d;_i70++){var _u42=_a127*t+_i70*n+l;r.set(e.subarray(_u42,_u42+o[2]),s),s+=o[2]}}(u,c[0],c[1],p,o,s);else if(4===h)!function(e,t,n,r,a,o,s){for(var i=0,u=o[0],l=o[1],c=o[2],d=u+s[0],p=l+s[1],h=c+s[2],f=o[3],_o93=u;_o93<d;_o93++)for(var _u43=l;_u43<p;_u43++)for(var _l37=c;_l37<h;_l37++){var _c31=_o93*t+_u43*n+_l37*r+f;a.set(e.subarray(_c31,_c31+s[3]),i),i+=s[3]}}(u,c[0],c[1],c[2],p,o,s);else{var _e334=hu(u,o,s,t.shape,t.dtype);p.set(_e334)}return l}for(var Yv=[Wb,Vb,zb,Zb,ex,ax,sx,ix,lx,dx,hx,mx,gx,vx,wx,Ix,Ax,Ex,_x,Nx,Sx,Tx,Fx,Mx,Lb,Dx,Lx,Wx,Vx,zx,Hx,jx,jb,qx,Qx,Kx,Yx,Zx,ev,tv,rv,ov,iv,uv,lv,cv,hv,mv,bv,xv,yv,wv,kv,Cv,Av,_v,Nv,Sv,Rv,Tv,Fv,nx,Ov,Bv,Pv,Pb("Rsqrt"),Wv,{kernelName:"ScatterNd",backendName:"wasm",setupFunc:function setupFunc(e){Uv=e.wasm.cwrap("ScatterNd",null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.indices,o=n.updates,s=r.shape,i=t.makeOutput(s,o.dtype);if(0===Wt(s))return i;var _jr5=jr(0,a,s),u=_jr5.sliceRank,l=_jr5.numUpdates,c=_jr5.sliceSize,d=_jr5.strides,p=_jr5.outputSize,h=t.dataIdMap.get(a.dataId).id,f=t.dataIdMap.get(o.dataId).id,m=new Uint8Array(new Int32Array(d).buffer),g=t.dataIdMap.get(i.dataId).id;return Uv(h,f,Ob[o.dtype],u,l,c,m,p,g),i}},{kernelName:"Select",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,o=t.e,s=n.dataIdMap.get(r.dataId).id,i=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(o.dataId).id,l=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(l.dataId).id,d=r.shape.length,p=a.shape.length,h=0===d||d>1||1===p?1:Wt(a.shape.slice(1));return Vv(s,i,u,h,c),l},setupFunc:function setupFunc(e){Vv=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}},{kernelName:"Sigmoid",backendName:"wasm",setupFunc:function setupFunc(e){Gv=e.wasm.cwrap("Sigmoid",null,["number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs.x,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(a.dataId).id;return 0===Wt(a.shape)||Gv(r,o),a}},Pb("Sin"),{kernelName:"Slice",backendName:"wasm",kernelFunc:zv},{kernelName:"Softmax",backendName:"wasm",setupFunc:function setupFunc(e){Hv=e.wasm.cwrap("Softmax",null,["number","number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs.logits,r=e.attrs.dim,a=t.dataIdMap.get(n.dataId).id,o=t.makeOutput(n.shape,n.dtype),s=t.dataIdMap.get(o.dataId).id,i=n.shape[r],u=Wt(n.shape)/i;return 0===Wt(o.shape)||Hv(a,s,i,u),o}},{kernelName:"SplitV",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=n.numOrSizeSplits,i=Xt(n.axis,a.shape)[0],u=Mo(a,o,i),l=new Array(a.shape.length).fill(0),c=a.shape.slice();return u.map((function(e){var t=_toConsumableArray(c);t[i]=e;var n=zv({inputs:{x:a},attrs:{begin:l,size:t},backend:r});return l[i]+=e,n}))}},Pb("Sqrt"),Pb("Square"),Ub("SquaredDifference",!0),{kernelName:"Step",backendName:"wasm",setupFunc:function setupFunc(e){jv=e.wasm.cwrap("Step",null,["number","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,a=e.attrs.alpha,o=n.x,s=t.dataIdMap.get(o.dataId).id,i=t.makeOutput(o.shape,o.dtype),u=t.dataIdMap.get(i.dataId).id;return jv(s,a,u),i}},{kernelName:"StridedSlice",backendName:"wasm",setupFunc:function setupFunc(e){Xv=e.wasm.cwrap("StridedSlice",null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,o=r.begin,s=r.end,i=r.strides;null==i&&(i=new Array(o.length));var u=r.beginMask,l=r.endMask,c=r.ellipsisMask,d=r.newAxisMask,p=r.shrinkAxisMask,h=qr(c);if(h.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==c&&0!==d)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==c&&0!==p)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var f=a.shape.length-o.length,m=qr(d),g=a.shape.slice();m.forEach((function(e){o[e]=0,s[e]=1,g.splice(e,0,1)}));var b=tx({inputs:{x:a},attrs:{shape:g},backend:t}),_Jr2=Jr(b.shape,h,f,o,s,i,u,l,c),x=_Jr2.begin,v=_Jr2.end,y=_Jr2.strides;o=x,s=v,i=y;var w=qr(p);w.forEach((function(e){s[e]=o[e]+1,i[e]=1}));var k=Qr(o,s,i),I=k.filter((function(e,t){return-1===w.indexOf(t)}));if(i.every((function(e){return 1===e}))){var _e335=zv({inputs:{x:b},attrs:{begin:o,size:k},backend:t});t.disposeData(b.dataId);var _n185=tx({inputs:{x:_e335},attrs:{shape:I},backend:t});return t.disposeData(_e335.dataId),_n185}var C=t.makeOutput(I,"float32");if(!I.some((function(e){return 0===e}))){var _e336=t.dataIdMap.get(b.dataId).id,_n186=new Uint8Array(new Int32Array(an(b.shape)).buffer),_r158=new Uint8Array(new Int32Array(o).buffer),_a128=new Uint8Array(new Int32Array(s).buffer),_u44=new Uint8Array(new Int32Array(i).buffer),_l38=new Uint8Array(new Int32Array(I).buffer),_c32=new Uint8Array(new Int32Array(an(I)).buffer),_d18=t.dataIdMap.get(C.dataId).id;Xv(_e336,_n186,b.shape.length,_r158,_a128,_u44,_l38,_c32,I.length,_d18)}t.disposeData(b.dataId);var A=tx({inputs:{x:C},attrs:{shape:I},backend:t});return t.disposeData(C.dataId),A}},Ub("Sub",!0),{kernelName:"Sum",backendName:"wasm",setupFunc:function setupFunc(e){qv=e.wasm.cwrap("Sum",null,["number, number, number"])},kernelFunc:function kernelFunc(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,s=n.x,i=t.dataIdMap.get(s.dataId).id,u=i,l=s,_Kb6=Kb(s,a,t),c=_Kb6.transposed,d=_Kb6.axes,p=_Kb6.originalAxes,h=_Kb6.inputWasTransposed,f=d;if(h){var _e337=t.dataIdMap.get(c.dataId).id;_e337!==i&&(l=c,u=_e337,f=Ga(f.length,l.shape.length))}Wa("sum",f,l.shape.length);var _La42=_slicedToArray(La(l.shape,f),2),m=_La42[0],b=Wt(_La42[1]),x=t.makeOutput(m,l.dtype);if(0!==Wt(l.shape)){var _e338=t.dataIdMap.get(x.dataId).id;qv(u,b,_e338)}if(h&&t.disposeData(c.dataId),o){var _e339=Pa(x.shape,p);x.shape=_e339}return x}},Pb("Tanh"),{kernelName:"Tile",backendName:"wasm",setupFunc:function setupFunc(e){Qv=e.wasm.cwrap("Tile",null,["number","array","number","array","number","number"])},kernelFunc:function kernelFunc(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=n.dataIdMap.get(a.dataId).id,s=r.reps,i=new Array(a.shape.length),_e340=0;_e340<i.length;_e340++)i[_e340]=a.shape[_e340]*s[_e340];var u=new Uint8Array(new Int32Array(a.shape).buffer),l=new Uint8Array(new Int32Array(i).buffer),c=n.makeOutput(i,a.dtype),d=n.dataIdMap.get(c.dataId).id;return Qv(o,u,a.shape.length,l,i.length,Ob[c.dtype],d),c}},{kernelName:"TopK",backendName:"wasm",setupFunc:function setupFunc(e){Kv=e.wasm.cwrap("TopK",null,["number","array","number","number","number","bool","number","number"])},kernelFunc:function kernelFunc(_ref54){var e=_ref54.inputs,t=_ref54.backend,n=_ref54.attrs,r=e.x,a=n.k,o=n.sorted,s=t.dataIdMap.get(r.dataId).id,i=new Uint8Array(new Int32Array(r.shape).buffer),u=r.shape.slice();u[u.length-1]=a;var l=t.makeOutput(u,r.dtype),c=t.dataIdMap.get(l.dataId).id,d=t.makeOutput(u,"int32"),p=t.dataIdMap.get(d.dataId).id;return Kv(s,i,r.shape.length,Ob[r.dtype],a,o,c,p),[l,d]}},Qb,{kernelName:"Unpack",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,o=r.axis;o<0&&(o+=a.shape.length);for(var s=a.shape[o],i=a.shape.length,u=new Array(i-1),l=0,_e341=0;_e341<i;_e341++)_e341!==o&&(u[l++]=a.shape[_e341]);var c=new Array(s),d=new Array(i).fill(0),p=a.shape.slice();p[o]=1;for(var _e342=0;_e342<c.length;_e342++)d[o]=_e342,c[_e342]=zv({inputs:{x:a},attrs:{begin:d,size:p},backend:n});return c.map((function(_ref55){return{dataId:_ref55.dataId,dtype:_ref55.dtype,shape:u}}))}},{kernelName:"ZerosLike",backendName:"wasm",kernelFunc:function kernelFunc(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}}],_i71=0,_Yv=Yv;_i71<_Yv.length;_i71++){var _e343=_Yv[_i71];An(_e343)}var Zv=mn();function Jv(e,t){for(var n=0,r=e.length-1;r>=0;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}Zv.registerFlag("WASM_HAS_SIMD_SUPPORT",_asyncToGenerator(regeneratorRuntime.mark((function _callee24(){return regeneratorRuntime.wrap((function _callee24$(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:return _context24.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 1:case"end":return _context24.stop()}}),_callee24)})))),Zv.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",_asyncToGenerator(regeneratorRuntime.mark((function _callee25(){return regeneratorRuntime.wrap((function _callee25$(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:if(!Zv.get("IS_NODE")){_context25.next=2;break}return _context25.abrupt("return",!1);case 2:return _context25.prev=2,_context25.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))));case 6:return _context25.prev=6,_context25.t0=_context25.catch(2),_context25.abrupt("return",!1);case 9:case"end":return _context25.stop()}}),_callee25,null,[[2,6]])}))));var ey=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,ty=function ty(e){return ey.exec(e).slice(1)};function ny(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var r=n>=0?arguments[n]:"/";if("string"!=typeof r)throw new TypeError("Arguments to path.resolve must be strings");r&&(e=r+"/"+e,t="/"===r.charAt(0))}return(t?"/":"")+(e=Jv(dy(e.split("/"),(function(e){return!!e})),!t).join("/"))||"."}function ry(e){var t=ay(e),n="/"===hy(e,-1);return(e=Jv(dy(e.split("/"),(function(e){return!!e})),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function ay(e){return"/"===e.charAt(0)}function oy(){var e=Array.prototype.slice.call(arguments,0);return ry(dy(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))}function sy(e,t){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=ny(e).substr(1),t=ny(t).substr(1);for(var r=n(e.split("/")),a=n(t.split("/")),o=Math.min(r.length,a.length),s=o,i=0;i<o;i++)if(r[i]!==a[i]){s=i;break}var u=[];for(i=s;i<r.length;i++)u.push("..");return(u=u.concat(a.slice(s))).join("/")}function iy(e){var t=ty(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."}function uy(e,t){var n=ty(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n}function ly(e){return ty(e)[3]}var cy={extname:ly,basename:uy,dirname:iy,sep:"/",delimiter:":",relative:sy,join:oy,isAbsolute:ay,normalize:ry,resolve:ny};function dy(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}var py,hy="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)},fy=Object.freeze({__proto__:null,resolve:ny,normalize:ry,isAbsolute:ay,join:oy,relative:sy,sep:"/",delimiter:":",dirname:iy,basename:uy,extname:ly,default:cy}),my=Object.freeze({__proto__:null,default:{}});function gy(){if(void 0===py){var e=new ArrayBuffer(2),t=new Uint8Array(e),n=new Uint16Array(e);if(t[0]=1,t[1]=2,258===n[0])py="BE";else{if(513!==n[0])throw new Error("unable to figure out endianess");py="LE"}}return py}function by(){return void 0!==global.location?global.location.hostname:""}function xy(){return[]}function vy(){return 0}function yy(){return Number.MAX_VALUE}function wy(){return Number.MAX_VALUE}function ky(){return[]}function Iy(){return"Browser"}function Cy(){return void 0!==global.navigator?global.navigator.appVersion:""}function Ay(){}function Ey(){}function _y(){return"/tmp"}var $y=_y,Ny={EOL:"\n",tmpdir:$y,tmpDir:_y,networkInterfaces:Ay,getNetworkInterfaces:Ey,release:Cy,type:Iy,cpus:ky,totalmem:wy,freemem:yy,uptime:vy,loadavg:xy,hostname:by,endianness:gy},Sy=Object.freeze({__proto__:null,endianness:gy,hostname:by,loadavg:xy,uptime:vy,freemem:yy,totalmem:wy,cpus:ky,type:Iy,release:Cy,networkInterfaces:Ay,getNetworkInterfaces:Ey,arch:function arch(){return"javascript"},platform:function platform(){return"browser"},tmpDir:_y,tmpdir:$y,EOL:"\n",default:Ny}),Ry=Se(fy),Ty=Se(my),Fy=Se(Sy),My=Ne((function(e,t){var n,r=(n=(n="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||__filename,function(e){function t(){return N.buffer!=T&&K(N.buffer),F}function r(){return N.buffer!=T&&K(N.buffer),M}function a(){return N.buffer!=T&&K(N.buffer),O}function o(){return N.buffer!=T&&K(N.buffer),D}function s(){return N.buffer!=T&&K(N.buffer),B}var i,u,l=void 0!==(e=e||{})?e:{};l.ready=new Promise((function(e,t){i=e,u=t}));var c,d={};for(c in l)l.hasOwnProperty(c)&&(d[c]=l[c]);var h,f,m,g,p=function p(e,t){throw t};h="object"==("undefined"==typeof window?"undefined":_typeof(window)),f="function"==typeof importScripts,m="object"==(void 0===process?"undefined":_typeof(process))&&"object"==_typeof(process.versions)&&"string"==typeof process.versions.node,g=!h&&!m&&!f;var b=l.ENVIRONMENT_IS_PTHREAD||!1;b&&(T=l.buffer);var x,v,y,w,k,I="";function C(e){return l.locateFile?l.locateFile(e,I):I+e}if(m){var A;I=f?Ry.dirname(I)+"/":__dirname+"/",x=function x(e,t){return w||(w=Za),k||(k=Ry),e=k.normalize(e),w.readFileSync(e,t?null:"utf8")},y=function y(e){var t=x(e,!0);return t.buffer||(t=new Uint8Array(t)),P(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof nn))throw e})),process.on("unhandledRejection",he),p=function p(e){process.exit(e)},l.inspect=function(){return"[Emscripten Module object]"};try{A=Ty}catch(e){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),e}$e.Worker=A.Worker}else g?("undefined"!=typeof read&&(x=function x(e){return read(e)}),y=function y(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(P("object"==_typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs&&scriptArgs,"function"==typeof quit&&(p=function p(e){quit(e)}),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(h||f)&&(f?I=self.location.href:"undefined"!=typeof document&&document.currentScript&&(I=document.currentScript.src),void 0!==n&&n&&(I=n),I=0!==I.indexOf("blob:")?I.substr(0,I.lastIndexOf("/")+1):"",m?(x=function x(e,t){return w||(w=Za),k||(k=Ry),e=k.normalize(e),w.readFileSync(e,t?null:"utf8")},y=function y(e){var t=x(e,!0);return t.buffer||(t=new Uint8Array(t)),P(t.buffer),t}):(x=function x(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},f&&(y=function y(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),v=function v(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}));m&&"undefined"==typeof performance&&($e.performance=Ty.performance);var E,_=l.print||console.log.bind(console),$=l.printErr||console.warn.bind(console);for(c in d)d.hasOwnProperty(c)&&(l[c]=d[c]);d=null,l.arguments&&l.arguments,l.thisProgram&&l.thisProgram,l.quit&&(p=l.quit),l.wasmBinary&&(E=l.wasmBinary);var N,S,R=l.noExitRuntime||!0;"object"!=("undefined"==typeof WebAssembly?"undefined":_typeof(WebAssembly))&&he("no native wasm support detected");var T,F,M,O,D,B,L=!1;function P(e,t){e||he("Assertion failed: "+t)}function W(e){var t=l["_"+e];return P(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function U(e,t,n,r,a){var o={string:function string(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);j(e,t=Yt(n),n)}return t},array:function array(e){var t=Yt(e.length);return q(e,t),t}},s=W(e),i=[],u=0;if(r)for(var l=0;l<r.length;l++){var c=o[n[l]];c?(0===u&&(u=Qt()),i[l]=c(r[l])):i[l]=r[l]}var d=s.apply(null,i);return d=function(e){return"string"===t?z(e):"boolean"===t?Boolean(e):e}(d),0!==u&&Kt(u),d}function G(e,t,n){for(var r=t+n,a="";!(t>=r);){var o=e[t++];if(!o)return a;if(128&o){var s=63&e[t++];if(192!=(224&o)){var i=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|i:(7&o)<<18|s<<12|i<<6|63&e[t++])<65536)a+=String.fromCharCode(o);else{var u=o-65536;a+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}function z(e,t){return e?G(r(),e,t):""}function j(e,t,n){return function H(e,t,n,r){if(!(r>0))return 0;for(var a=n,o=n+r-1,s=0;s<e.length;++s){var i=e.charCodeAt(s);if(i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++s)),i<=127){if(n>=o)break;t[n++]=i}else if(i<=2047){if(n+1>=o)break;t[n++]=192|i>>6,t[n++]=128|63&i}else if(i<=65535){if(n+2>=o)break;t[n++]=224|i>>12,t[n++]=128|i>>6&63,t[n++]=128|63&i}else{if(n+3>=o)break;t[n++]=240|i>>18,t[n++]=128|i>>12&63,t[n++]=128|i>>6&63,t[n++]=128|63&i}}return t[n]=0,n-a}(e,r(),t,n)}function q(e,n){t().set(e,n)}function Q(e,t){return e%t>0&&(e+=t-e%t),e}function K(e){T=e,l.HEAP8=F=new Int8Array(e),l.HEAP16=new Int16Array(e),l.HEAP32=O=new Int32Array(e),l.HEAPU8=M=new Uint8Array(e),l.HEAPU16=new Uint16Array(e),l.HEAPU32=D=new Uint32Array(e),l.HEAPF32=new Float32Array(e),l.HEAPF64=B=new Float64Array(e)}var Y,Z=l.INITIAL_MEMORY||16777216;if(b)N=l.wasmMemory,T=l.buffer;else if(l.wasmMemory)N=l.wasmMemory;else if(!((N=new WebAssembly.Memory({initial:Z/65536,maximum:32768,shared:!0})).buffer instanceof SharedArrayBuffer))throw $("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),m&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");N&&(T=N.buffer),Z=T.byteLength,K(T);var J=[],ee=[],te=[],ne=[];function ie(e){J.unshift(e)}function ue(e){ne.unshift(e)}b||ee.push({func:function func(){Ot()}});var le=0,ce=null;function he(e){l.onAbort&&l.onAbort(e),b&&console.error("Pthread aborting at "+(new Error).stack),$(e+=""),L=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw u(t),t}function fe(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}l.preloadedImages={},l.preloadedAudios={};function ge(e){return fe(e,"data:application/octet-stream;base64,")}function xe(e){return fe(e,"file://")}var ve="tfjs-backend-wasm-threaded-simd.wasm";function ye(e){try{if(e==ve&&E)return new Uint8Array(E);if(y)return y(e);throw"both async and sync fetching of the wasm failed"}catch(e){he(e)}}ge(ve)||(ve=C(ve));var Ie={8991:function _(e,t){setTimeout((function(){zt(e,t)}),0)}};function Ae(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?Y.get(n)():Y.get(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(l)}}function Ee(e,n){if(e<=0||e>t().length||!0&e||n<0)return-28;if(0==n)return 0;n>=2147483647&&(n=1/0);var r=Atomics.load(a(),tn>>2),o=0;if(r==e&&Atomics.compareExchange(a(),tn>>2,r,0)==r&&(o=1,--n<=0))return 1;var s=Atomics.notify(a(),e>>2,n);if(s>=0)return s+o;throw"Atomics.notify returned an unexpected value "+s}function _e(e){if(b)throw"Internal Error! killThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in killThread!";a()[e+12>>2]=0;var t=Te.pthreads[e];t.worker.terminate(),Te.freeThreadData(t),Te.runningWorkers.splice(Te.runningWorkers.indexOf(t.worker),1),t.worker.pthread=void 0}function Se(e){if(b)throw"Internal Error! cleanupThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in cleanupThread!";a()[e+12>>2]=0;var t=Te.pthreads[e];if(t){var n=t.worker;Te.returnWorkerToPool(n)}}l._emscripten_futex_wake=Ee;var Re,Te={unusedWorkers:[],runningWorkers:[],initMainThreadBlock:function initMainThreadBlock(){for(var e=0;e<8;++e)Te.allocateUnusedWorker()},initRuntime:function initRuntime(){for(var e=Dt(228),t=0;t<57;++t)o()[e/4+t]=0;a()[e+12>>2]=e;var n=e+152;a()[n>>2]=n;var r=Dt(512);for(t=0;t<128;++t)o()[r/4+t]=0;Atomics.store(o(),e+100>>2,r),Atomics.store(o(),e+40>>2,e),qt(e,!f,1),Gt(e)},initWorker:function initWorker(){},pthreads:{},threadExitHandlers:[],setThreadStatus:function setThreadStatus(){},runExitHandlers:function runExitHandlers(){for(;Te.threadExitHandlers.length>0;)Te.threadExitHandlers.pop()();b&&Wt()&&Ut()},threadExit:function threadExit(e){var t=Wt();t&&(Atomics.store(o(),t+4>>2,e),Atomics.store(o(),t+0>>2,1),Atomics.store(o(),t+56>>2,1),Atomics.store(o(),t+60>>2,0),Te.runExitHandlers(),Ee(t+0,2147483647),qt(0,0,0),b&&postMessage({cmd:"exit"}))},threadCancel:function threadCancel(){Te.runExitHandlers();var e=Wt();Atomics.store(o(),e+4>>2,-1),Atomics.store(o(),e+0>>2,1),Ee(e+0,2147483647),qt(0,0,0),postMessage({cmd:"cancelDone"})},terminateAllThreads:function terminateAllThreads(){for(var e in Te.pthreads)(r=Te.pthreads[e])&&r.worker&&Te.returnWorkerToPool(r.worker);Te.pthreads={};for(var t=0;t<Te.unusedWorkers.length;++t)(n=Te.unusedWorkers[t]).terminate();for(Te.unusedWorkers=[],t=0;t<Te.runningWorkers.length;++t){var n,r=(n=Te.runningWorkers[t]).pthread;Te.freeThreadData(r),n.terminate()}Te.runningWorkers=[]},freeThreadData:function freeThreadData(e){if(e){if(e.threadInfoStruct){var t=a()[e.threadInfoStruct+100>>2];a()[e.threadInfoStruct+100>>2]=0,Bt(t),Bt(e.threadInfoStruct)}e.threadInfoStruct=0,e.allocatedOwnStack&&e.stackBase&&Bt(e.stackBase),e.stackBase=0,e.worker&&(e.worker.pthread=null)}},returnWorkerToPool:function returnWorkerToPool(e){Te.runWithoutMainThreadQueuedCalls((function(){delete Te.pthreads[e.pthread.threadInfoStruct],Te.unusedWorkers.push(e),Te.runningWorkers.splice(Te.runningWorkers.indexOf(e),1),Te.freeThreadData(e.pthread),e.pthread=void 0}))},runWithoutMainThreadQueuedCalls:function runWithoutMainThreadQueuedCalls(e){a()[en>>2]=0;try{e()}finally{a()[en>>2]=1}},receiveObjectTransfer:function receiveObjectTransfer(e){},loadWasmModuleToWorker:function loadWasmModuleToWorker(e,t){e.onmessage=function(n){var r=n.data,a=r.cmd;if(e.pthread&&(Te.currentProxiedOperationCallerThread=e.pthread.threadInfoStruct),r.targetThread&&r.targetThread!=Wt()){var s=Te.pthreads[r.targetThread];return s?s.worker.postMessage(n.data,r.transferList):console.error('Internal error! Worker sent a message "'+a+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(Te.currentProxiedOperationCallerThread=void 0)}if("processQueuedMainThreadWork"===a)Vt();else if("spawnThread"===a)Nt(n.data);else if("cleanupThread"===a)Se(r.thread);else if("killThread"===a)_e(r.thread);else if("cancelThread"===a)!function Ne(e){if(b)throw"Internal Error! cancelThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in cancelThread!";Te.pthreads[e].worker.postMessage({cmd:"cancel"})}(r.thread);else if("loaded"===a)e.loaded=!0,t&&t(e),e.runPthread&&(e.runPthread(),delete e.runPthread);else if("print"===a)_("Thread "+r.threadId+": "+r.text);else if("printErr"===a)$("Thread "+r.threadId+": "+r.text);else if("alert"===a)alert("Thread "+r.threadId+": "+r.text);else if("exit"===a)e.pthread&&Atomics.load(o(),e.pthread.threadInfoStruct+64>>2)&&Te.returnWorkerToPool(e);else if("exitProcess"===a)try{!function an(e,t){if(!t||!R||0!==e){if(!t&&b)throw postMessage({cmd:"exitProcess",returnCode:e}),new nn(e);R||(Te.terminateAllThreads(),l.onExit&&l.onExit(e),L=!0),p(e,new nn(e))}}(r.returnCode)}catch(n){if(n instanceof nn)return;throw n}else"cancelDone"===a?Te.returnWorkerToPool(e):"objectTransfer"===a?Te.receiveObjectTransfer(n.data):"setimmediate"===n.data.target?e.postMessage(n.data):$("worker sent an unknown command "+a);Te.currentProxiedOperationCallerThread=void 0},e.onerror=function(e){$("pthread sent an error! "+e.filename+":"+e.lineno+": "+e.message)},m&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("exit",(function(e){}))),e.postMessage({cmd:"load",urlOrBlob:l.mainScriptUrlOrBlob||n,wasmMemory:N,wasmModule:S})},allocateUnusedWorker:function allocateUnusedWorker(){var e=C("tfjs-backend-wasm-threaded-simd.worker.js");Te.unusedWorkers.push(new Worker(e))},getNewWorker:function getNewWorker(){return 0==Te.unusedWorkers.length&&(Te.allocateUnusedWorker(),Te.loadWasmModuleToWorker(Te.unusedWorkers[0])),Te.unusedWorkers.length>0?Te.unusedWorkers.pop():null},busySpinWait:function busySpinWait(e){for(var t=performance.now()+e;performance.now()<t;);}};function Xe(e,t){for(var n=arguments.length-2,r=Qt(),a=n,o=Yt(8*a),i=o>>3,u=0;u<n;u++){var l=arguments[2+u];s()[i+u]=l}var c=jt(e,a,o,t);return Kt(r),c}l.establishStackSpace=function Fe(e,t){Zt(e,t),Kt(e)},l.getNoExitRuntime=function Me(){return R},l.invokeEntryPoint=function Oe(e,t){return Y.get(e)(t)},Re=m?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:b?function(){return performance.now()-l.__performance_now_clock_drift}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var qe=[],Qe=[];function Ke(e,t){var n;for(Qe.length=0,t>>=2;n=r()[e++];){var o=n<105;o&&1&t&&t++,Qe.push(o?s()[t++>>1]:a()[t]),++t}return Qe}function Ze(){return r().length}function Je(e){try{return N.grow(e-T.byteLength+65535>>>16),K(N.buffer),1}catch(e){}}var tt={inEventHandler:0,removeAllEventListeners:function removeAllEventListeners(){for(var e=tt.eventHandlers.length-1;e>=0;--e)tt._removeHandler(e);tt.eventHandlers=[],tt.deferredCalls=[]},registerRemoveEventListeners:function registerRemoveEventListeners(){tt.removeEventListenersRegistered||(tt.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function deferCall(e,t,n){function r(e,t){if(e.length!=t.length)return!1;for(var n in e)if(e[n]!=t[n])return!1;return!0}for(var a in tt.deferredCalls){var o=tt.deferredCalls[a];if(o.targetFunction==e&&r(o.argsList,n))return}tt.deferredCalls.push({targetFunction:e,precedence:t,argsList:n}),tt.deferredCalls.sort((function(e,t){return e.precedence<t.precedence}))},removeDeferredCalls:function removeDeferredCalls(e){for(var t=0;t<tt.deferredCalls.length;++t)tt.deferredCalls[t].targetFunction==e&&(tt.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function canPerformEventHandlerRequests(){return tt.inEventHandler&&tt.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function runDeferredCalls(){if(tt.canPerformEventHandlerRequests())for(var e=0;e<tt.deferredCalls.length;++e){var t=tt.deferredCalls[e];tt.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:function removeAllHandlersOnTarget(e,t){for(var n=0;n<tt.eventHandlers.length;++n)tt.eventHandlers[n].target!=e||t&&t!=tt.eventHandlers[n].eventTypeString||tt._removeHandler(n--)},_removeHandler:function _removeHandler(e){var t=tt.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),tt.eventHandlers.splice(e,1)},registerOrRemoveHandler:function registerOrRemoveHandler(e){var t=function(_t252){function t(_x27){return _t252.apply(this,arguments)}return t.toString=function(){return _t252.toString()},t}((function(t){++tt.inEventHandler,tt.currentEventHandler=e,tt.runDeferredCalls(),e.handlerFunc(t),tt.runDeferredCalls(),--tt.inEventHandler}));if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),tt.eventHandlers.push(e),tt.registerRemoveEventListeners();else for(var n=0;n<tt.eventHandlers.length;++n)tt.eventHandlers[n].target==e.target&&tt.eventHandlers[n].eventTypeString==e.eventTypeString&&tt._removeHandler(n--)},queueEventHandlerOnThread_iiii:function queueEventHandlerOnThread_iiii(e,t,n,r,o){var s=Qt(),i=Yt(12);a()[i>>2]=n,a()[i+4>>2]=r,a()[i+8>>2]=o,Xt(0,e,637534208,t,r,i),Kt(s)},getTargetThreadForEventCallback:function getTargetThreadForEventCallback(e){switch(e){case 1:return 0;case 2:return Te.currentProxiedOperationCallerThread;default:return e}},getNodeNameForTarget:function getNodeNameForTarget(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function fullscreenEnabled(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function rt(e,t,n,r){var o=Qt(),s=Yt(12),i=0;t&&(i=function nt(e){var t=function X(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}(e)+1,n=Dt(t);return j(e,n,t),n}(t)),a()[s>>2]=i,a()[s+4>>2]=n,a()[s+8>>2]=r,Xt(0,e,657457152,0,i,s),Kt(o)}var st=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0];function it(e){return e=function ot(e){return e>2?z(e):e}(e),st[e]||("undefined"!=typeof document?document.querySelector(e):void 0)}function ut(e){return it(e)}function lt(e,t,n){var r=ut(e);if(!r)return-4;if(r.canvasSharedPtr&&(a()[r.canvasSharedPtr>>2]=t,a()[r.canvasSharedPtr+4>>2]=n),!r.offscreenCanvas&&r.controlTransferredOffscreen)return r.canvasSharedPtr?(function at(e,t,n,r){rt(e,t=t?z(t):"",n,r)}(a()[r.canvasSharedPtr+8>>2],e,t,n),1):-4;r.offscreenCanvas&&(r=r.offscreenCanvas);var o=!1;if(r.GLctxObject&&r.GLctxObject.GLctx){var s=r.GLctxObject.GLctx.getParameter(2978);o=0===s[0]&&0===s[1]&&s[2]===r.width&&s[3]===r.height}return r.width=t,r.height=n,o&&r.GLctxObject.GLctx.viewport(0,0,t,n),0}function ct(e,t,n){return b?Xe(2,1,e,t,n):lt(e,t,n)}var xt={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:{},offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,recordError:function recordError(e){xt.lastError||(xt.lastError=e)},getNewId:function getNewId(e){for(var t=xt.counter++,n=e.length;n<t;n++)e[n]=null;return t},getSource:function getSource(e,t,n,r){for(var o="",s=0;s<t;++s){var i=r?a()[r+4*s>>2]:-1;o+=z(a()[n+4*s>>2],i<0?void 0:i)}return o},createContext:function createContext(e,t){var n=e.getContext("webgl",t);return n?xt.registerContext(n,t):0},registerContext:function registerContext(e,t){var n=Dt(8);a()[n+4>>2]=Wt();var r={handle:n,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=r),xt.contexts[n]=r,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&xt.initExtensions(r),n},makeContextCurrent:function makeContextCurrent(e){return xt.currentContext=xt.contexts[e],l.ctx=kt=xt.currentContext&&xt.currentContext.GLctx,!(e&&!kt)},getContext:function getContext(e){return xt.contexts[e]},deleteContext:function deleteContext(e){xt.currentContext===xt.contexts[e]&&(xt.currentContext=null),"object"==_typeof(tt)&&tt.removeAllHandlersOnTarget(xt.contexts[e].GLctx.canvas),xt.contexts[e]&&xt.contexts[e].GLctx.canvas&&(xt.contexts[e].GLctx.canvas.GLctxObject=void 0),Bt(xt.contexts[e].handle),xt.contexts[e]=null},initExtensions:function initExtensions(e){if(e||(e=xt.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t=e.GLctx;(function ft(e){var t=e.getExtension("ANGLE_instanced_arrays");if(t)return e.vertexAttribDivisor=function(e,n){t.vertexAttribDivisorANGLE(e,n)},e.drawArraysInstanced=function(e,n,r,a){t.drawArraysInstancedANGLE(e,n,r,a)},e.drawElementsInstanced=function(e,n,r,a,o){t.drawElementsInstancedANGLE(e,n,r,a,o)},1})(t),function mt(e){var t=e.getExtension("OES_vertex_array_object");if(t)return e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)},1}(t),function gt(e){var t=e.getExtension("WEBGL_draw_buffers");if(t)return e.drawBuffers=function(e,n){t.drawBuffersWEBGL(e,n)},1}(t),t.disjointTimerQueryExt=t.getExtension("EXT_disjoint_timer_query"),function bt(e){return!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw"))}(t),(t.getSupportedExtensions()||[]).forEach((function(e){e.indexOf("lose_context")<0&&e.indexOf("debug")<0&&t.getExtension(e)}))}},populateUniformTable:function populateUniformTable(e){for(var t=xt.programs[e],n=xt.programInfos[e]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1},r=n.uniforms,a=kt.getProgramParameter(t,35718),o=0;o<a;++o){var s=kt.getActiveUniform(t,o),i=s.name;n.maxUniformLength=Math.max(n.maxUniformLength,i.length+1),"]"==i.slice(-1)&&(i=i.slice(0,i.lastIndexOf("[")));var u=kt.getUniformLocation(t,i);if(u){var l=xt.getNewId(xt.uniforms);r[i]=[s.size,l],xt.uniforms[l]=u;for(var c=1;c<s.size;++c){var d=i+"["+c+"]";u=kt.getUniformLocation(t,d),l=xt.getNewId(xt.uniforms),xt.uniforms[l]=u}}}}},vt=["default","low-power","high-performance"];var kt,It={mappings:{},buffers:[null,[],[]],printChar:function printChar(e,t){var n=It.buffers[e];0===t||10===t?((1===e?_:$)(G(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function get(){return It.varargs+=4,a()[It.varargs-4>>2]},getStr:function getStr(e){return z(e)},get64:function get64(e,t){return e}};function Ct(e){return b?Xe(3,1,e):0}function At(e,t,n,r,a){if(b)return Xe(4,1,e,t,n,r,a)}function Et(e,t,n,o){if(b)return Xe(5,1,e,t,n,o);for(var s=0,i=0;i<n;i++){for(var u=a()[t+8*i>>2],l=a()[t+(8*i+4)>>2],c=0;c<l;c++)It.printChar(e,r()[u+c]);s+=l}return a()[o>>2]=s,0}function Nt(e){if(b)throw"Internal Error! spawnThread() can only ever be called from main application thread!";var t=Te.getNewWorker();if(void 0!==t.pthread)throw"Internal error!";if(!e.pthread_ptr)throw"Internal error, no pthread ptr!";Te.runningWorkers.push(t);for(var n=Dt(512),r=0;r<128;++r)a()[n+4*r>>2]=0;var s=e.stackBase+e.stackSize,i=Te.pthreads[e.pthread_ptr]={worker:t,stackBase:e.stackBase,stackSize:e.stackSize,allocatedOwnStack:e.allocatedOwnStack,threadInfoStruct:e.pthread_ptr},u=i.threadInfoStruct>>2;Atomics.store(o(),u+16,e.detached),Atomics.store(o(),u+25,n),Atomics.store(o(),u+10,i.threadInfoStruct),Atomics.store(o(),u+20,e.stackSize),Atomics.store(o(),u+19,s),Atomics.store(o(),u+26,e.stackSize),Atomics.store(o(),u+28,s),Atomics.store(o(),u+29,e.detached);var l=Pt()+40;Atomics.store(o(),u+43,l),t.pthread=i;var c={cmd:"run",start_routine:e.startRoutine,arg:e.arg,threadInfoStruct:e.pthread_ptr,stackBase:e.stackBase,stackSize:e.stackSize};t.runPthread=function(){c.time=performance.now(),t.postMessage(c,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread)}function Rt(e){if(b)return Xe(6,1,e);switch(e){case 30:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==("undefined"==typeof navigator?"undefined":_typeof(navigator))&&navigator.hardwareConcurrency||1}return function Le(e){return a()[Lt()>>2]=e,e}(28),-1}b||Te.initMainThreadBlock();var Tt,Ft=[null,function Pe(e,t){if(b)return Xe(1,1,e,t)},ct,Ct,At,Et,Rt],Mt={e:function De(e,t,n,r){he("Assertion failed: "+z(e)+", at: "+[t?z(t):"unknown filename",n,r?z(r):"unknown function"])},r:function Be(e,t){_main(e,t)},x:function We(e,t){if(e==t)postMessage({cmd:"processQueuedMainThreadWork"});else if(b)postMessage({targetThread:e,cmd:"processThreadQueue"});else{var n=Te.pthreads[e],r=n&&n.worker;if(!r)return;r.postMessage({cmd:"processThreadQueue"})}return 1},b:function Ue(){he()},y:function Ve(e,t,n){var r=Ke(t,n);return Ie[e].apply(null,r)},j:function Ge(e,t){},c:function ze(e,n,r){if(e<=0||e>t().length||!0&e)return-28;if(h){if(Atomics.load(a(),e>>2)!=n)return-6;var o=performance.now(),s=o+r;for(Atomics.exchange(a(),tn>>2,e);;){if((o=performance.now())>s)return Atomics.exchange(a(),tn>>2,0),-73;if(0==Atomics.exchange(a(),tn>>2,0))break;if(Vt(),Atomics.load(a(),e>>2)!=n)return-6;Atomics.exchange(a(),tn>>2,e)}return 0}var i=Atomics.wait(a(),e>>2,n,r);if("timed-out"===i)return-73;if("not-equal"===i)return-6;if("ok"===i)return 0;throw"Atomics.wait returned an unexpected value "+i},d:Ee,f:Re,p:function He(e,t,n){r().copyWithin(e,t,t+n)},z:function je(){return m?Fy.cpus().length:navigator.hardwareConcurrency},u:function Ye(e,t,n){qe.length=t;for(var r=n>>3,a=0;a<t;a++)qe[a]=s()[r+a];return(e<0?Ie[-e-1]:Ft[e]).apply(null,qe)},q:function et(e){var t=Ze();if(e<=t)return!1;var n=2147483648;if(e>n)return!1;for(var r=1;r<=4;r*=2){var a=t*(1+.2/r);if(a=Math.min(a,e+100663296),Je(Math.min(n,Q(Math.max(e,a),65536))))return!0}return!1},v:function dt(e,t,n){return ut(e)?lt(e,t,n):ct(e,t,n)},i:function pt(e){},t:function ht(e,t){},w:function wt(e,t){return function yt(e,t){var n=t>>2,r=a()[n+6],o={alpha:!!a()[n+0],depth:!!a()[n+1],stencil:!!a()[n+2],antialias:!!a()[n+3],premultipliedAlpha:!!a()[n+4],preserveDrawingBuffer:!!a()[n+5],powerPreference:vt[r],failIfMajorPerformanceCaveat:!!a()[n+7],majorVersion:a()[n+8],minorVersion:a()[n+9],enableExtensionsByDefault:a()[n+10],explicitSwapControl:a()[n+11],proxyContextToMainThread:a()[n+12],renderViaOffscreenBackBuffer:a()[n+13]},s=ut(e);return s?o.explicitSwapControl?0:xt.createContext(s,o):0}(e,t)},m:Ct,n:At,g:Et,o:function Ce(){Te.initRuntime()},a:N||l.wasmMemory,k:function _t(e){var t=Te.threadExitHandlers.pop();e&&t()},l:function $t(e,t){Te.threadExitHandlers.push((function(){Y.get(e)(t)}))},h:function St(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return $("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;if(!e)return $("pthread_create called with a null thread pointer!"),28;var s=[];if(b&&0===s.length)return Ht(687865856,e,t,n,r);var i=0,u=0,l=0;t&&-1!=t?(i=a()[t>>2],i+=81920,u=a()[t+8>>2],l=0!==a()[t+12>>2]):i=2097152;var c=0==u;c?u=Jt(16,i):P((u-=i)>0);for(var d=Dt(228),p=0;p<57;++p)o()[(d>>2)+p]=0;a()[e>>2]=d,a()[d+12>>2]=d;var h=d+152;a()[h>>2]=h;var f={stackBase:u,stackSize:i,allocatedOwnStack:c,detached:l,startRoutine:n,pthread_ptr:d,arg:r,transferList:s};return b?(f.cmd="spawnThread",postMessage(f,s)):Nt(f),0},s:Rt},Ot=(function ke(){var e={a:Mt};function t(e,t){var n=e.exports;if(l.asm=n,Y=l.asm.F,S=t,!b){var r=Te.unusedWorkers.length;Te.unusedWorkers.forEach((function(e){Te.loadWasmModuleToWorker(e,(function(){--r||function pe(e){if(le--,l.monitorRunDependencies&&l.monitorRunDependencies(le),0==le&&ce){var t=ce;ce=null,t()}}()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return function we(){if(!E&&(h||f)){if("function"==typeof fetch&&!xe(ve))return fetch(ve,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ve+"'";return e.arrayBuffer()})).catch((function(){return ye(ve)}));if(v)return new Promise((function(e,t){v(ve,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return ye(ve)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){$("failed to asynchronously prepare wasm: "+e),he(e)}))}if(b||function de(e){P(!b,"addRunDependency cannot be used in a pthread worker"),le++,l.monitorRunDependencies&&l.monitorRunDependencies(le)}(),l.instantiateWasm)try{return l.instantiateWasm(e,t)}catch(e){return $("Module.instantiateWasm callback failed with error: "+e),!1}return(E||"function"!=typeof WebAssembly.instantiateStreaming||ge(ve)||xe(ve)||"function"!=typeof fetch?r(n):fetch(ve,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return $("wasm streaming compile failed: "+e),$("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(u),{}}(),l.___wasm_call_ctors=function(){return(Ot=l.___wasm_call_ctors=l.asm.A).apply(null,arguments)}),Dt=(l._init=function(){return(l._init=l.asm.B).apply(null,arguments)},l._register_tensor=function(){return(l._register_tensor=l.asm.C).apply(null,arguments)},l._dispose_data=function(){return(l._dispose_data=l.asm.D).apply(null,arguments)},l._dispose=function(){return(l._dispose=l.asm.E).apply(null,arguments)},l._Abs=function(){return(l._Abs=l.asm.G).apply(null,arguments)},l._Add=function(){return(l._Add=l.asm.H).apply(null,arguments)},l._AddN=function(){return(l._AddN=l.asm.I).apply(null,arguments)},l._ArgMax=function(){return(l._ArgMax=l.asm.J).apply(null,arguments)},l._AvgPool=function(){return(l._AvgPool=l.asm.K).apply(null,arguments)},l._BatchMatMul=function(){return(l._BatchMatMul=l.asm.L).apply(null,arguments)},l._Ceil=function(){return(l._Ceil=l.asm.M).apply(null,arguments)},l._ClipByValue=function(){return(l._ClipByValue=l.asm.N).apply(null,arguments)},l._Conv2D=function(){return(l._Conv2D=l.asm.O).apply(null,arguments)},l._Conv2DBackpropInput=function(){return(l._Conv2DBackpropInput=l.asm.P).apply(null,arguments)},l._Cos=function(){return(l._Cos=l.asm.Q).apply(null,arguments)},l._CropAndResize=function(){return(l._CropAndResize=l.asm.R).apply(null,arguments)},l._Cumsum=function(){return(l._Cumsum=l.asm.S).apply(null,arguments)},l._DepthToSpace=function(){return(l._DepthToSpace=l.asm.T).apply(null,arguments)},l._DepthwiseConv2dNative=function(){return(l._DepthwiseConv2dNative=l.asm.U).apply(null,arguments)},l._Equal=function(){return(l._Equal=l.asm.V).apply(null,arguments)},l._Exp=function(){return(l._Exp=l.asm.W).apply(null,arguments)},l._FlipLeftRight=function(){return(l._FlipLeftRight=l.asm.X).apply(null,arguments)},l._Floor=function(){return(l._Floor=l.asm.Y).apply(null,arguments)},l._FloorDiv=function(){return(l._FloorDiv=l.asm.Z).apply(null,arguments)},l._FusedBatchNorm=function(){return(l._FusedBatchNorm=l.asm._).apply(null,arguments)},l._FusedConv2D=function(){return(l._FusedConv2D=l.asm.$).apply(null,arguments)},l._FusedDepthwiseConv2D=function(){return(l._FusedDepthwiseConv2D=l.asm.aa).apply(null,arguments)},l._Gather=function(){return(l._Gather=l.asm.ba).apply(null,arguments)},l._GatherNd=function(){return(l._GatherNd=l.asm.ca).apply(null,arguments)},l._Greater=function(){return(l._Greater=l.asm.da).apply(null,arguments)},l._GreaterEqual=function(){return(l._GreaterEqual=l.asm.ea).apply(null,arguments)},l._LeakyRelu=function(){return(l._LeakyRelu=l.asm.fa).apply(null,arguments)},l._Less=function(){return(l._Less=l.asm.ga).apply(null,arguments)},l._LessEqual=function(){return(l._LessEqual=l.asm.ha).apply(null,arguments)},l._Log=function(){return(l._Log=l.asm.ia).apply(null,arguments)},l._LogicalAnd=function(){return(l._LogicalAnd=l.asm.ja).apply(null,arguments)},l._Max=function(){return(l._Max=l.asm.ka).apply(null,arguments)},l._MaxPool=function(){return(l._MaxPool=l.asm.la).apply(null,arguments)},l._Maximum=function(){return(l._Maximum=l.asm.ma).apply(null,arguments)},l._Mean=function(){return(l._Mean=l.asm.na).apply(null,arguments)},l._Min=function(){return(l._Min=l.asm.oa).apply(null,arguments)},l._Minimum=function(){return(l._Minimum=l.asm.pa).apply(null,arguments)},l._Multiply=function(){return(l._Multiply=l.asm.qa).apply(null,arguments)},l._Neg=function(){return(l._Neg=l.asm.ra).apply(null,arguments)},l._NonMaxSuppressionV3=function(){return(l._NonMaxSuppressionV3=l.asm.sa).apply(null,arguments)},l._NonMaxSuppressionV4=function(){return(l._NonMaxSuppressionV4=l.asm.ta).apply(null,arguments)},l._NonMaxSuppressionV5=function(){return(l._NonMaxSuppressionV5=l.asm.ua).apply(null,arguments)},l._NotEqual=function(){return(l._NotEqual=l.asm.va).apply(null,arguments)},l._OneHot=function(){return(l._OneHot=l.asm.wa).apply(null,arguments)},l._PadV2=function(){return(l._PadV2=l.asm.xa).apply(null,arguments)},l._Pow=function(){return(l._Pow=l.asm.ya).apply(null,arguments)},l._Prelu=function(){return(l._Prelu=l.asm.za).apply(null,arguments)},l._Prod=function(){return(l._Prod=l.asm.Aa).apply(null,arguments)},l._RealDiv=function(){return(l._RealDiv=l.asm.Ba).apply(null,arguments)},l._Relu=function(){return(l._Relu=l.asm.Ca).apply(null,arguments)},l._Relu6=function(){return(l._Relu6=l.asm.Da).apply(null,arguments)},l._ResizeBilinear=function(){return(l._ResizeBilinear=l.asm.Ea).apply(null,arguments)},l._Reverse=function(){return(l._Reverse=l.asm.Fa).apply(null,arguments)},l._RotateWithOffset=function(){return(l._RotateWithOffset=l.asm.Ga).apply(null,arguments)},l._Round=function(){return(l._Round=l.asm.Ha).apply(null,arguments)},l._Rsqrt=function(){return(l._Rsqrt=l.asm.Ia).apply(null,arguments)},l._ScatterNd=function(){return(l._ScatterNd=l.asm.Ja).apply(null,arguments)},l._SelectV2=function(){return(l._SelectV2=l.asm.Ka).apply(null,arguments)},l._Sigmoid=function(){return(l._Sigmoid=l.asm.La).apply(null,arguments)},l._Sin=function(){return(l._Sin=l.asm.Ma).apply(null,arguments)},l._Softmax=function(){return(l._Softmax=l.asm.Na).apply(null,arguments)},l._Sqrt=function(){return(l._Sqrt=l.asm.Oa).apply(null,arguments)},l._Square=function(){return(l._Square=l.asm.Pa).apply(null,arguments)},l._SquaredDifference=function(){return(l._SquaredDifference=l.asm.Qa).apply(null,arguments)},l._Step=function(){return(l._Step=l.asm.Ra).apply(null,arguments)},l._StridedSlice=function(){return(l._StridedSlice=l.asm.Sa).apply(null,arguments)},l._Sub=function(){return(l._Sub=l.asm.Ta).apply(null,arguments)},l._Sum=function(){return(l._Sum=l.asm.Ua).apply(null,arguments)},l._Tanh=function(){return(l._Tanh=l.asm.Va).apply(null,arguments)},l._Tile=function(){return(l._Tile=l.asm.Wa).apply(null,arguments)},l._TopK=function(){return(l._TopK=l.asm.Xa).apply(null,arguments)},l._Transpose=function(){return(l._Transpose=l.asm.Ya).apply(null,arguments)},l.__FusedMatMul=function(){return(l.__FusedMatMul=l.asm.Za).apply(null,arguments)},l._malloc=function(){return(Dt=l._malloc=l.asm._a).apply(null,arguments)}),Bt=l._free=function(){return(Bt=l._free=l.asm.$a).apply(null,arguments)},Lt=l.___errno_location=function(){return(Lt=l.___errno_location=l.asm.ab).apply(null,arguments)},Pt=l._emscripten_get_global_libc=function(){return(Pt=l._emscripten_get_global_libc=l.asm.bb).apply(null,arguments)},Wt=l._pthread_self=function(){return(Wt=l._pthread_self=l.asm.cb).apply(null,arguments)},Ut=l.___pthread_tsd_run_dtors=function(){return(Ut=l.___pthread_tsd_run_dtors=l.asm.db).apply(null,arguments)},Vt=l._emscripten_main_thread_process_queued_calls=function(){return(Vt=l._emscripten_main_thread_process_queued_calls=l.asm.eb).apply(null,arguments)},Gt=(l._emscripten_current_thread_process_queued_calls=function(){return(l._emscripten_current_thread_process_queued_calls=l.asm.fb).apply(null,arguments)},l._emscripten_register_main_browser_thread_id=function(){return(Gt=l._emscripten_register_main_browser_thread_id=l.asm.gb).apply(null,arguments)}),zt=l.__emscripten_do_dispatch_to_thread=function(){return(zt=l.__emscripten_do_dispatch_to_thread=l.asm.hb).apply(null,arguments)},Ht=l._emscripten_sync_run_in_main_thread_4=function(){return(Ht=l._emscripten_sync_run_in_main_thread_4=l.asm.ib).apply(null,arguments)},jt=l._emscripten_run_in_main_runtime_thread_js=function(){return(jt=l._emscripten_run_in_main_runtime_thread_js=l.asm.jb).apply(null,arguments)},Xt=l.__emscripten_call_on_thread=function(){return(Xt=l.__emscripten_call_on_thread=l.asm.kb).apply(null,arguments)},qt=(l._emscripten_tls_init=function(){return(l._emscripten_tls_init=l.asm.lb).apply(null,arguments)},l.__emscripten_thread_init=function(){return(qt=l.__emscripten_thread_init=l.asm.mb).apply(null,arguments)}),Qt=l.stackSave=function(){return(Qt=l.stackSave=l.asm.nb).apply(null,arguments)},Kt=l.stackRestore=function(){return(Kt=l.stackRestore=l.asm.ob).apply(null,arguments)},Yt=l.stackAlloc=function(){return(Yt=l.stackAlloc=l.asm.pb).apply(null,arguments)},Zt=l._emscripten_stack_set_limits=function(){return(Zt=l._emscripten_stack_set_limits=l.asm.qb).apply(null,arguments)},Jt=l._memalign=function(){return(Jt=l._memalign=l.asm.rb).apply(null,arguments)},en=l.__emscripten_allow_main_runtime_queued_calls=9880,tn=l.__emscripten_main_thread_futex=11368;function nn(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function rn(e){if(!(le>0)){if(b)return i(l),void postMessage({cmd:"loaded"});(function re(){if(!b){if(l.preRun)for("function"==typeof l.preRun&&(l.preRun=[l.preRun]);l.preRun.length;)ie(l.preRun.shift());Ae(J)}})(),le>0||(l.setStatus?(l.setStatus("Running..."),setTimeout((function(){setTimeout((function(){l.setStatus("")}),1),t()}),1)):t())}function t(){Tt||(Tt=!0,l.calledRun=!0,L||(function ae(){Ae(ee)}(),function oe(){b||Ae(te)}(),i(l),l.onRuntimeInitialized&&l.onRuntimeInitialized(),function se(){if(!b){if(l.postRun)for("function"==typeof l.postRun&&(l.postRun=[l.postRun]);l.postRun.length;)ue(l.postRun.shift());Ae(ne)}}()))}}if(l.cwrap=function V(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&a&&!r?W(e):function(){return U(e,t,n,arguments)}},l.PThread=Te,l.PThread=Te,l.wasmMemory=N,l.ExitStatus=nn,ce=function e(){Tt||rn(),Tt||(ce=e)},l.run=rn,l.preInit)for("function"==typeof l.preInit&&(l.preInit=[l.preInit]);l.preInit.length>0;)l.preInit.pop()();return b&&(R=!1,Te.initWorker()),rn(),e.ready});e.exports=r})),Oy=Ne((function(e,t){var n,r=(n=(n="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||__filename,function(e){var t,r,a=void 0!==(e=e||{})?e:{};a.ready=new Promise((function(e,n){t=e,r=n}));var o,s={};for(o in a)a.hasOwnProperty(o)&&(s[o]=a[o]);var i,u,l,c;i="object"==("undefined"==typeof window?"undefined":_typeof(window)),u="function"==typeof importScripts,l="object"==(void 0===process?"undefined":_typeof(process))&&"object"==_typeof(process.versions)&&"string"==typeof process.versions.node,c=!i&&!l&&!u;var d,p,h,f,m,g="";l?(g=u?Ry.dirname(g)+"/":__dirname+"/",d=function d(e,t){return f||(f=Za),m||(m=Ry),e=m.normalize(e),f.readFileSync(e,t?null:"utf8")},h=function h(e){var t=d(e,!0);return t.buffer||(t=new Uint8Array(t)),I(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof Ee))throw e})),process.on("unhandledRejection",ee),a.inspect=function(){return"[Emscripten Module object]"}):c?("undefined"!=typeof read&&(d=function d(e){return read(e)}),h=function h(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(I("object"==_typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs&&scriptArgs,"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(i||u)&&(u?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),n&&(g=n),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",d=function d(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},u&&(h=function h(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),p=function p(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var x,v,y=a.print||console.log.bind(console),w=a.printErr||console.warn.bind(console);for(o in s)s.hasOwnProperty(o)&&(a[o]=s[o]);s=null,a.arguments&&a.arguments,a.thisProgram&&a.thisProgram,a.quit&&a.quit,a.wasmBinary&&(x=a.wasmBinary),a.noExitRuntime,"object"!=("undefined"==typeof WebAssembly?"undefined":_typeof(WebAssembly))&&ee("no native wasm support detected");var k=!1;function I(e,t){e||ee("Assertion failed: "+t)}function C(e){var t=a["_"+e];return I(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function A(e,t,n,r,a){var o={string:function string(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);!function O(e,t,n){return function M(e,t,n,r){if(!(r>0))return 0;for(var a=n,o=n+r-1,s=0;s<e.length;++s){var i=e.charCodeAt(s);if(i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++s)),i<=127){if(n>=o)break;t[n++]=i}else if(i<=2047){if(n+1>=o)break;t[n++]=192|i>>6,t[n++]=128|63&i}else if(i<=65535){if(n+2>=o)break;t[n++]=224|i>>12,t[n++]=128|i>>6&63,t[n++]=128|63&i}else{if(n+3>=o)break;t[n++]=240|i>>18,t[n++]=128|i>>12&63,t[n++]=128|i>>6&63,t[n++]=128|63&i}}return t[n]=0,n-a}(e,N,t,n)}(e,t=Ae(n),n)}return t},array:function array(e){var t=Ae(e.length);return function D(e,t){$.set(e,t)}(e,t),t}},s=C(e),i=[],u=0;if(r)for(var l=0;l<r.length;l++){var c=o[n[l]];c?(0===u&&(u=Ie()),i[l]=c(r[l])):i[l]=r[l]}var d=s.apply(null,i);return d=function(e){return"string"===t?F(e):"boolean"===t?Boolean(e):e}(d),0!==u&&Ce(u),d}var _,$,N,S,R="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function T(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.subarray&&R)return R.decode(e.subarray(t,a));for(var o="";t<a;){var s=e[t++];if(128&s){var i=63&e[t++];if(192!=(224&s)){var u=63&e[t++];if((s=224==(240&s)?(15&s)<<12|i<<6|u:(7&s)<<18|i<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var l=s-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&s)<<6|i)}else o+=String.fromCharCode(s)}return o}function F(e,t){return e?T(N,e,t):""}function B(e,t){return e%t>0&&(e+=t-e%t),e}function L(e){_=e,a.HEAP8=$=new Int8Array(e),a.HEAP16=new Int16Array(e),a.HEAP32=S=new Int32Array(e),a.HEAPU8=N=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAPU32=new Uint32Array(e),a.HEAPF32=new Float32Array(e),a.HEAPF64=new Float64Array(e)}a.INITIAL_MEMORY;var P,W=[],U=[],V=[],G=[];function q(e){W.unshift(e)}function Q(e){G.unshift(e)}U.push({func:function func(){ke()}});var K=0,Y=null;function ee(e){a.onAbort&&a.onAbort(e),w(e+=""),k=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw r(t),t}function te(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}a.preloadedImages={},a.preloadedAudios={};function re(e){return te(e,"data:application/octet-stream;base64,")}function oe(e){return te(e,"file://")}var se="tfjs-backend-wasm.wasm";function ie(e){try{if(e==se&&x)return new Uint8Array(x);if(h)return h(e);throw"both async and sync fetching of the wasm failed"}catch(e){ee(e)}}function ce(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?P.get(n)():P.get(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(a)}}function fe(e){try{return v.grow(e-_.byteLength+65535>>>16),L(v.buffer),1}catch(e){}}re(se)||(se=function b(e){return a.locateFile?a.locateFile(e,g):g+e}(se));var ge={mappings:{},buffers:[null,[],[]],printChar:function printChar(e,t){var n=ge.buffers[e];0===t||10===t?((1===e?y:w)(T(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function get(){return ge.varargs+=4,S[ge.varargs-4>>2]},getStr:function getStr(e){return F(e)},get64:function get64(e,t){return e}};var ye,we={a:function de(){ee()},d:function pe(e,t,n){N.copyWithin(e,t,t+n)},e:function me(e){var t=function he(){return N.length}(),n=2147483648;if(e>n)return!1;for(var r=1;r<=4;r*=2){var a=t*(1+.2/r);if(a=Math.min(a,e+100663296),fe(Math.min(n,B(Math.max(e,a),65536))))return!0}return!1},f:function be(e){return 0},c:function xe(e,t,n,r,a){},b:function ve(e,t,n,r){for(var a=0,o=0;o<n;o++){for(var s=S[t+8*o>>2],i=S[t+(8*o+4)>>2],u=0;u<i;u++)ge.printChar(e,N[s+u]);a+=i}return S[r>>2]=a,0}},ke=(function le(){var e={a:we};function t(e,t){var n=e.exports;a.asm=n,L((v=a.asm.g).buffer),P=a.asm.m,function J(e){if(K--,a.monitorRunDependencies&&a.monitorRunDependencies(K),0==K&&Y){var t=Y;Y=null,t()}}()}function n(e){t(e.instance)}function o(t){return function ue(){if(!x&&(i||u)){if("function"==typeof fetch&&!oe(se))return fetch(se,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+se+"'";return e.arrayBuffer()})).catch((function(){return ie(se)}));if(p)return new Promise((function(e,t){p(se,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return ie(se)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){w("failed to asynchronously prepare wasm: "+e),ee(e)}))}if(function Z(e){K++,a.monitorRunDependencies&&a.monitorRunDependencies(K)}(),a.instantiateWasm)try{return a.instantiateWasm(e,t)}catch(e){return w("Module.instantiateWasm callback failed with error: "+e),!1}return(x||"function"!=typeof WebAssembly.instantiateStreaming||re(se)||oe(se)||"function"!=typeof fetch?o(n):fetch(se,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return w("wasm streaming compile failed: "+e),w("falling back to ArrayBuffer instantiation"),o(n)}))}))).catch(r),{}}(),a.___wasm_call_ctors=function(){return(ke=a.___wasm_call_ctors=a.asm.h).apply(null,arguments)}),Ie=(a._init=function(){return(a._init=a.asm.i).apply(null,arguments)},a._register_tensor=function(){return(a._register_tensor=a.asm.j).apply(null,arguments)},a._dispose_data=function(){return(a._dispose_data=a.asm.k).apply(null,arguments)},a._dispose=function(){return(a._dispose=a.asm.l).apply(null,arguments)},a._Abs=function(){return(a._Abs=a.asm.n).apply(null,arguments)},a._Add=function(){return(a._Add=a.asm.o).apply(null,arguments)},a._AddN=function(){return(a._AddN=a.asm.p).apply(null,arguments)},a._ArgMax=function(){return(a._ArgMax=a.asm.q).apply(null,arguments)},a._AvgPool=function(){return(a._AvgPool=a.asm.r).apply(null,arguments)},a._BatchMatMul=function(){return(a._BatchMatMul=a.asm.s).apply(null,arguments)},a._Ceil=function(){return(a._Ceil=a.asm.t).apply(null,arguments)},a._ClipByValue=function(){return(a._ClipByValue=a.asm.u).apply(null,arguments)},a._Conv2D=function(){return(a._Conv2D=a.asm.v).apply(null,arguments)},a._Conv2DBackpropInput=function(){return(a._Conv2DBackpropInput=a.asm.w).apply(null,arguments)},a._Cos=function(){return(a._Cos=a.asm.x).apply(null,arguments)},a._CropAndResize=function(){return(a._CropAndResize=a.asm.y).apply(null,arguments)},a._Cumsum=function(){return(a._Cumsum=a.asm.z).apply(null,arguments)},a._DepthToSpace=function(){return(a._DepthToSpace=a.asm.A).apply(null,arguments)},a._DepthwiseConv2dNative=function(){return(a._DepthwiseConv2dNative=a.asm.B).apply(null,arguments)},a._Equal=function(){return(a._Equal=a.asm.C).apply(null,arguments)},a._Exp=function(){return(a._Exp=a.asm.D).apply(null,arguments)},a._FlipLeftRight=function(){return(a._FlipLeftRight=a.asm.E).apply(null,arguments)},a._Floor=function(){return(a._Floor=a.asm.F).apply(null,arguments)},a._FloorDiv=function(){return(a._FloorDiv=a.asm.G).apply(null,arguments)},a._FusedBatchNorm=function(){return(a._FusedBatchNorm=a.asm.H).apply(null,arguments)},a._FusedConv2D=function(){return(a._FusedConv2D=a.asm.I).apply(null,arguments)},a._FusedDepthwiseConv2D=function(){return(a._FusedDepthwiseConv2D=a.asm.J).apply(null,arguments)},a._Gather=function(){return(a._Gather=a.asm.K).apply(null,arguments)},a._GatherNd=function(){return(a._GatherNd=a.asm.L).apply(null,arguments)},a._Greater=function(){return(a._Greater=a.asm.M).apply(null,arguments)},a._GreaterEqual=function(){return(a._GreaterEqual=a.asm.N).apply(null,arguments)},a._LeakyRelu=function(){return(a._LeakyRelu=a.asm.O).apply(null,arguments)},a._Less=function(){return(a._Less=a.asm.P).apply(null,arguments)},a._LessEqual=function(){return(a._LessEqual=a.asm.Q).apply(null,arguments)},a._Log=function(){return(a._Log=a.asm.R).apply(null,arguments)},a._LogicalAnd=function(){return(a._LogicalAnd=a.asm.S).apply(null,arguments)},a._Max=function(){return(a._Max=a.asm.T).apply(null,arguments)},a._MaxPool=function(){return(a._MaxPool=a.asm.U).apply(null,arguments)},a._Maximum=function(){return(a._Maximum=a.asm.V).apply(null,arguments)},a._Mean=function(){return(a._Mean=a.asm.W).apply(null,arguments)},a._Min=function(){return(a._Min=a.asm.X).apply(null,arguments)},a._Minimum=function(){return(a._Minimum=a.asm.Y).apply(null,arguments)},a._Multiply=function(){return(a._Multiply=a.asm.Z).apply(null,arguments)},a._Neg=function(){return(a._Neg=a.asm._).apply(null,arguments)},a._NonMaxSuppressionV3=function(){return(a._NonMaxSuppressionV3=a.asm.$).apply(null,arguments)},a._NonMaxSuppressionV4=function(){return(a._NonMaxSuppressionV4=a.asm.aa).apply(null,arguments)},a._NonMaxSuppressionV5=function(){return(a._NonMaxSuppressionV5=a.asm.ba).apply(null,arguments)},a._NotEqual=function(){return(a._NotEqual=a.asm.ca).apply(null,arguments)},a._OneHot=function(){return(a._OneHot=a.asm.da).apply(null,arguments)},a._PadV2=function(){return(a._PadV2=a.asm.ea).apply(null,arguments)},a._Pow=function(){return(a._Pow=a.asm.fa).apply(null,arguments)},a._Prelu=function(){return(a._Prelu=a.asm.ga).apply(null,arguments)},a._Prod=function(){return(a._Prod=a.asm.ha).apply(null,arguments)},a._RealDiv=function(){return(a._RealDiv=a.asm.ia).apply(null,arguments)},a._Relu=function(){return(a._Relu=a.asm.ja).apply(null,arguments)},a._Relu6=function(){return(a._Relu6=a.asm.ka).apply(null,arguments)},a._ResizeBilinear=function(){return(a._ResizeBilinear=a.asm.la).apply(null,arguments)},a._Reverse=function(){return(a._Reverse=a.asm.ma).apply(null,arguments)},a._RotateWithOffset=function(){return(a._RotateWithOffset=a.asm.na).apply(null,arguments)},a._Round=function(){return(a._Round=a.asm.oa).apply(null,arguments)},a._Rsqrt=function(){return(a._Rsqrt=a.asm.pa).apply(null,arguments)},a._ScatterNd=function(){return(a._ScatterNd=a.asm.qa).apply(null,arguments)},a._SelectV2=function(){return(a._SelectV2=a.asm.ra).apply(null,arguments)},a._Sigmoid=function(){return(a._Sigmoid=a.asm.sa).apply(null,arguments)},a._Sin=function(){return(a._Sin=a.asm.ta).apply(null,arguments)},a._Softmax=function(){return(a._Softmax=a.asm.ua).apply(null,arguments)},a._Sqrt=function(){return(a._Sqrt=a.asm.va).apply(null,arguments)},a._Square=function(){return(a._Square=a.asm.wa).apply(null,arguments)},a._SquaredDifference=function(){return(a._SquaredDifference=a.asm.xa).apply(null,arguments)},a._Step=function(){return(a._Step=a.asm.ya).apply(null,arguments)},a._StridedSlice=function(){return(a._StridedSlice=a.asm.za).apply(null,arguments)},a._Sub=function(){return(a._Sub=a.asm.Aa).apply(null,arguments)},a._Sum=function(){return(a._Sum=a.asm.Ba).apply(null,arguments)},a._Tanh=function(){return(a._Tanh=a.asm.Ca).apply(null,arguments)},a._Tile=function(){return(a._Tile=a.asm.Da).apply(null,arguments)},a._TopK=function(){return(a._TopK=a.asm.Ea).apply(null,arguments)},a._Transpose=function(){return(a._Transpose=a.asm.Fa).apply(null,arguments)},a.__FusedMatMul=function(){return(a.__FusedMatMul=a.asm.Ga).apply(null,arguments)},a._malloc=function(){return(a._malloc=a.asm.Ha).apply(null,arguments)},a._free=function(){return(a._free=a.asm.Ia).apply(null,arguments)},a.stackSave=function(){return(Ie=a.stackSave=a.asm.Ja).apply(null,arguments)}),Ce=a.stackRestore=function(){return(Ce=a.stackRestore=a.asm.Ka).apply(null,arguments)},Ae=a.stackAlloc=function(){return(Ae=a.stackAlloc=a.asm.La).apply(null,arguments)};function Ee(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function _e(e){function n(){ye||(ye=!0,a.calledRun=!0,k||(function H(){ce(U)}(),function j(){ce(V)}(),t(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),function X(){if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)Q(a.postRun.shift());ce(G)}()))}K>0||(function z(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)q(a.preRun.shift());ce(W)}(),K>0||(a.setStatus?(a.setStatus("Running..."),setTimeout((function(){setTimeout((function(){a.setStatus("")}),1),n()}),1)):n()))}if(a.cwrap=function E(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&a&&!r?C(e):function(){return A(e,t,n,arguments)}},Y=function e(){ye||_e(),ye||(Y=e)},a.run=_e,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return _e(),e.ready});e.exports=r})),Dy=function(_Ft3){_inherits(Dy,_Ft3);var _read3,_time4,_super4=_createSuper(Dy);function Dy(e){var _this56;return _classCallCheck(this,Dy),(_this56=_super4.call(this)).wasm=e,_this56.dataIdNextNumber=1,_this56.wasm.tfjs.init(),_this56.dataIdMap=new Tt(_assertThisInitialized(_this56),da()),_this56}return _createClass(Dy,[{key:"write",value:function write(e,t,n){var r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}},{key:"numDataIds",value:function numDataIds(){return this.dataIdMap.numDataIds()}},{key:"time",value:(_time4=_asyncToGenerator(regeneratorRuntime.mark((function _callee26(e){var t;return regeneratorRuntime.wrap((function _callee26$(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return t=Nn(),e(),_context26.abrupt("return",{kernelMs:Nn()-t});case 3:case"end":return _context26.stop()}}),_callee26)}))),function time(_x28){return _time4.apply(this,arguments)})},{key:"move",value:function move(e,t,n,r,a){var o=this.dataIdNextNumber++;if("string"!==r){var s=Wt(n),i=s*Jt(r),u=this.wasm._malloc(i);this.dataIdMap.set(e,{id:o,memoryOffset:u,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(o,s,u),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,i),u)}else{var _s77=t;this.dataIdMap.set(e,{id:o,stringBytes:_s77,shape:n,dtype:r,memoryOffset:null,refCount:a})}}},{key:"read",value:(_read3=_asyncToGenerator(regeneratorRuntime.mark((function _callee27(e){return regeneratorRuntime.wrap((function _callee27$(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return _context27.abrupt("return",this.readSync(e));case 1:case"end":return _context27.stop()}}),_callee27,this)}))),function read(_x29){return _read3.apply(this,arguments)})},{key:"readSync",value:function readSync(e){var _this$dataIdMap$get=this.dataIdMap.get(e),t=_this$dataIdMap$get.memoryOffset,n=_this$dataIdMap$get.dtype,r=_this$dataIdMap$get.shape,a=_this$dataIdMap$get.stringBytes;return"string"===n?a:function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype ".concat(t))}}(this.wasm.HEAPU8.slice(t,t+Wt(r)*Jt(n)).buffer,n)}},{key:"disposeData",value:function disposeData(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.dataIdMap.has(e)){var _n187=this.dataIdMap.get(e);if(_n187.refCount--,!t&&_n187.refCount>0)return!1;this.wasm._free(_n187.memoryOffset),this.wasm.tfjs.disposeData(_n187.id),this.dataIdMap.delete(e)}return!0}},{key:"refCount",value:function refCount(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}},{key:"incRef",value:function incRef(e){var t=this.dataIdMap.get(e);null!=t&&t.refCount++}},{key:"floatPrecision",value:function floatPrecision(){return 32}},{key:"getMemoryOffset",value:function getMemoryOffset(e){return this.dataIdMap.get(e).memoryOffset}},{key:"dispose",value:function dispose(){this.wasm.tfjs.dispose(),this.wasm=null}},{key:"memory",value:function memory(){return{unreliable:!1}}},{key:"makeOutput",value:function makeOutput(e,t,n){var r;if(null==n)r=this.write(null,e,t);else{var _a129=this.dataIdNextNumber++;r={id:_a129},this.dataIdMap.set(r,{id:_a129,memoryOffset:n,shape:e,dtype:t,refCount:1});var _o94=Wt(e);this.wasm.tfjs.registerTensor(_a129,_o94,n)}return{dataId:r,shape:e,dtype:t}}},{key:"typedArrayFromHeap",value:function typedArrayFromHeap(_ref58){var e=_ref58.shape,t=_ref58.dtype,n=_ref58.dataId,r=this.wasm.HEAPU8.buffer,a=this.dataIdMap.get(n).memoryOffset,o=Wt(e);switch(t){case"float32":return new Float32Array(r,a,o);case"int32":return new Int32Array(r,a,o);case"bool":return new Uint8Array(r,a,o);default:throw new Error("Unknown dtype ".concat(t))}}}]),Dy}(Ft);function By(e){return function(t,n){return function(e,t){return mn().platform.fetch(e,{credentials:"same-origin"})}(e).then((function(r){r.ok||t.env.a("failed to load wasm binary file at '".concat(e,"'")),r.arrayBuffer().then((function(e){WebAssembly.instantiate(e,t).then((function(e){n(e.instance)}))}))})),{}}}function Ly(e,t,n){var r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=Vy&&null!=Vy[r]?Vy[r]:n+r}var Py=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],Wy=null,Uy=null,Vy={},Gy=!1,zy=!1;function Hy(){return(Hy=m(regeneratorRuntime.mark((function e(){var t,n,r,a,o,s,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=t.preferredBackends,r=void 0===n?["webgl","wasm","cpu"]:n,e.next=3,ca();case 3:a=I(r),e.prev=4,a.s();case 6:if((o=a.n()).done){e.next=20;break}return s=o.value,e.prev=8,e.next=11,pa(s);case 11:return e.abrupt("break",20);case 14:if(e.prev=14,e.t0=e.catch(8),s!==r[r.length-1]){e.next=18;break}throw e.t0;case 18:e.next=6;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(4),a.e(e.t1);case 25:return e.prev=25,a.f(),e.finish(25);case 28:return e.next=30,ha();case 30:case"end":return e.stop()}}),e,null,[[4,22,25,28],[8,14]])})))).apply(this,arguments)}fa("wasm",_asyncToGenerator(regeneratorRuntime.mark((function _callee29(){var _yield,e;return regeneratorRuntime.wrap((function _callee29$(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:return _context29.next=2,_asyncToGenerator(regeneratorRuntime.mark((function _callee28(){var _yield$Promise$all,_yield$Promise$all2,e,t;return regeneratorRuntime.wrap((function _callee28$(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:return _context28.next=2,Promise.all([mn().getAsync("WASM_HAS_SIMD_SUPPORT"),mn().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);case 2:return _yield$Promise$all=_context28.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2),e=_yield$Promise$all2[0],t=_yield$Promise$all2[1],_context28.abrupt("return",new Promise((function(n,r){var a={locateFile:function locateFile(n,r){if(n.endsWith(".worker.js")){var _e344=new Blob(['var Module={};function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;this.alert=threadAlert;Module["instantiateWasm"]=function(info,receiveInstance){var instance=new WebAssembly.Instance(Module["wasmModule"],info);Module["wasmModule"]=null;receiveInstance(instance);return instance.exports};function moduleLoaded(){}this.onmessage=function(e){try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob==="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module).then(function(instance){Module=instance;moduleLoaded()})}else if(e.data.cmd==="objectTransfer"){Module["PThread"].receiveObjectTransfer(e.data)}else if(e.data.cmd==="run"){Module["__performance_now_clock_drift"]=performance.now()-e.data.time;Module["__emscripten_thread_init"](e.data.threadInfoStruct,0,0);var max=e.data.stackBase;var top=e.data.stackBase+e.data.stackSize;Module["establishStackSpace"](top,max);Module["_emscripten_tls_init"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].setThreadStatus(Module["_pthread_self"](),1);try{var result=Module["invokeEntryPoint"](e.data.start_routine,e.data.arg);if(!Module["getNoExitRuntime"]())Module["PThread"].threadExit(result)}catch(ex){if(ex==="Canceled!"){Module["PThread"].threadCancel()}else if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["getNoExitRuntime"]()){}else{Module["PThread"].threadExit(ex.status)}}else{Module["PThread"].threadExit(-2);throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["PThread"].threadCancel()}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processThreadQueue"){if(Module["_pthread_self"]()){Module["_emscripten_current_thread_process_queued_calls"]()}}else{err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){err("worker.js onmessage() captured an uncaught exception: "+ex);if(ex&&ex.stack)err(ex.stack);throw ex}};if(typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string"){self={location:{href:__filename}};var onmessage=this.onmessage;var nodeWorkerThreads=require("worker_threads");global.Worker=nodeWorkerThreads.Worker;var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",function(data){onmessage({data:data})});var nodeFS=require("fs");var nodeRead=function(filename){return nodeFS.readFileSync(filename,"utf8")};function globalEval(x){global.require=require;global.Module=Module;eval.call(null,x)}importScripts=function(f){globalEval(nodeRead(f))};postMessage=function(msg){parentPort.postMessage(msg)};if(typeof performance==="undefined"){performance={now:function(){return Date.now()}}}}'],{type:"application/javascript"});return URL.createObjectURL(_e344)}return n.endsWith(".wasm")?Ly(e,t,null!=Uy?Uy:r):r+n}};zy&&(a.instantiateWasm=By(Ly(e,t,null!=Uy?Uy:"")));var o,s=!1;a.onAbort=function(){s||Gy||(Gy=!0,r({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))},t&&e&&null==Wy?(a.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+My.toString()],{type:"text/javascript"}),o=My(a)):o=Oy(a),o.then((function(e){s=!0,Gy=!1,e.tfjs={init:e.cwrap("init",null,[]),registerTensor:e.cwrap("register_tensor",null,["number","number","number"]),disposeData:e.cwrap("dispose_data",null,["number"]),dispose:e.cwrap("dispose",null,[])},n({wasm:e})}))})));case 7:case"end":return _context28.stop()}}),_callee28)})))();case 2:return _yield=_context29.sent,e=_yield.wasm,_context29.abrupt("return",new Dy(e));case 5:case"end":return _context29.stop()}}),_callee29)}))),2),function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Gy)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)Uy=e;else{Vy=e;var _t253=Py.filter((function(e){return null==Vy[e]}));if(_t253.length>0)throw new Error("There were no entries found for the following binaries: ".concat(_t253.join(","),". Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found."))}zy=t}("//cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@".concat("3.3.0","/dist/"));var jy=Object.freeze({__proto__:null,initTensorFlow:function initTensorFlow(){return Hy.apply(this,arguments)}})}).call(this,__webpack_require__(57),__webpack_require__(56),__webpack_require__(75).Buffer,"/index.js","/")},82:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return BASE_Z_INDEX}));__webpack_require__(72),__webpack_require__(63),__webpack_require__(114),__webpack_require__(32),__webpack_require__(21),__webpack_require__(19),__webpack_require__(15),__webpack_require__(37),__webpack_require__(39),__webpack_require__(134),__webpack_require__(64);var jsx_runtime=__webpack_require__(5),react=(__webpack_require__(99),__webpack_require__(1)),react_default=__webpack_require__.n(react),styled_components_browser_esm=__webpack_require__(10),prop_types=__webpack_require__(4),prop_types_default=__webpack_require__.n(prop_types),dist=__webpack_require__(93),tvweb_core_esm=__webpack_require__(8);__webpack_require__(18),__webpack_require__(25),__webpack_require__(42),__webpack_require__(24),__webpack_require__(22),__webpack_require__(95),__webpack_require__(27),__webpack_require__(30);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function enumerateDevices(){return"function"==typeof navigator.enumerateDevices?navigator.enumerateDevices():"object"===_typeof(navigator.mediaDevices)&&"function"==typeof navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices():new Promise((function(resolve,reject){try{if(null==window.MediaStreamTrack||null==window.MediaStreamTrack.getSources)throw new Error;window.MediaStreamTrack.getSources((function(devices){resolve(devices.filter((function(device){return"video"===device.kind.toLowerCase()||"videoinput"===device.kind.toLowerCase()})).map((function(device){return{deviceId:null!=device.deviceId?device.deviceId:"",groupId:device.groupId,kind:"videoinput",label:device.label,toJSON:function toJSON(){return this}}})))}))}catch(e){return reject(e)}}))}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _templateObject12(){var data=_taggedTemplateLiteral(["\n  padding: 0.625rem 0 0.9375rem;\n  margin: 0;\n  text-align: left;\n  width: 100%;\n  cursor: pointer;\n  font-size: 0.82rem;\n  transition: all 550ms ease-in-out;\n\n  &:hover {\n    opacity: 0.8;\n  }\n"]);return _templateObject12=function _templateObject12(){return data},data}function _templateObject11(){var data=_taggedTemplateLiteral(["\n  list-style: none;\n  padding: 0;\n"]);return _templateObject11=function _templateObject11(){return data},data}function _templateObject10(){var data=_taggedTemplateLiteral(["\n  padding: 0 0 0.3125rem;\n  margin: 0.25rem auto;\n  font-size: 0.8rem;\n"]);return _templateObject10=function _templateObject10(){return data},data}function _templateObject9(){var data=_taggedTemplateLiteral(["\n  margin: 0.25rem auto;\n  padding: 0;\n  font-weight: 600;\n  font-size: 1.2rem;\n"]);return _templateObject9=function _templateObject9(){return data},data}function _templateObject8(){var data=_taggedTemplateLiteral(["\n  text-align: center;\n  padding: 0.625rem 0;\n  border-bottom: 1px solid #dddddd;\n"]);return _templateObject8=function _templateObject8(){return data},data}function _templateObject7(){var data=_taggedTemplateLiteral(["\n  width: 260px;\n  margin: 1.25rem;\n  padding: 0.625rem 1.875rem;\n  background: #ffffff;\n  border-radius: 0.3125rem;\n  box-shadow: 2px 2px 14px rgba(0, 0, 0, 0.15);\n"]);return _templateObject7=function _templateObject7(){return data},data}function _templateObject6(){var data=_taggedTemplateLiteral(["\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: ",";\n"]);return _templateObject6=function _templateObject6(){return data},data}function _templateObject5(){var data=_taggedTemplateLiteral(["\n  z-index: ",";\n  position: absolute;\n  top: 40px;\n  color: red;\n"]);return _templateObject5=function _templateObject5(){return data},data}function _templateObject4(){var data=_taggedTemplateLiteral(["\n  z-index: ",";\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  width: 20px;\n"]);return _templateObject4=function _templateObject4(){return data},data}function _templateObject3(){var data=_taggedTemplateLiteral(["\n  cursor: pointer;\n  text-align: center;\n  width: 50px;\n  img {\n    width: 100%;\n  }\n"]);return _templateObject3=function _templateObject3(){return data},data}function _templateObject2(){var data=_taggedTemplateLiteral(["\n  width: 100%;\n  ","\n"]);return _templateObject2=function _templateObject2(){return data},data}function _templateObject(){var data=_taggedTemplateLiteral(["\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  background: #000;\n  display: flex;\n  justify-content: center;\n  z-index: ",";\n  ","\n"]);return _templateObject=function _templateObject(){return data},data}function _taggedTemplateLiteral(strings,raw){return raw||(raw=strings.slice(0)),Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var Errors=tvweb_core_esm.e.Errors,BASE_Z_INDEX=1e3,Wrapper=styled_components_browser_esm.c.div(_templateObject(),BASE_Z_INDEX,(function(props){return props.checkCameraMode&&"opacity: 0;"})),Video=styled_components_browser_esm.c.video(_templateObject2(),(function(props){return props.flipHorizontal&&"\n     transform: scaleX(-1);\n  "})),Button=styled_components_browser_esm.c.div(_templateObject3()),CloseButton=Object(styled_components_browser_esm.c)(Button)(_templateObject4(),BASE_Z_INDEX+100),Camera_Error=styled_components_browser_esm.c.div(_templateObject5(),BASE_Z_INDEX+20),Center=styled_components_browser_esm.c.div(_templateObject6(),BASE_Z_INDEX+30),CameraSelectionBox=styled_components_browser_esm.c.section(_templateObject7()),Header=styled_components_browser_esm.c.header(_templateObject8()),Tilte=styled_components_browser_esm.c.h2(_templateObject9()),Description=styled_components_browser_esm.c.p(_templateObject10()),CameraList=styled_components_browser_esm.c.ul(_templateObject11()),CameraItem=styled_components_browser_esm.c.li(_templateObject12()),defaultRef=react_default.a.createRef(),mediaDevices=function getMediaDevices(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices;var _getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia;return _getUserMedia?{getUserMedia:function getUserMedia(opts){return new Promise((function(resolve,reject){_getUserMedia.call(navigator,opts,resolve,reject)}))}}:null}();function Camera(props){var checkCameraMode=props.checkCameraMode,frontCamera=props.frontCamera,onClose=props.onClose,children=props.children,onVideoPlayed=props.onVideoPlayed,flipHorizontal=props.flipHorizontal,videoSettings=props.videoSettings,refVideo=props.refVideo,onError=props.onError,lang=tvweb_core_esm.m.useSDKSettings().lang,icClose=tvweb_core_esm.a.useAsset("ic_close.png"),_useState2=_slicedToArray(Object(react.useState)(""),2),errorMsg=_useState2[0],setErrorMsg=_useState2[1],_useState4=_slicedToArray(Object(react.useState)([]),2),cameraList=_useState4[0],setCameraList=_useState4[1],_useState6=_slicedToArray(Object(react.useState)(!1),2),showCameraSelection=_useState6[0],setShowCameraSelection=_useState6[1],cameraListQueried=Object(react.useRef)(!1),stopVideo=Object(react.useCallback)((function(){refVideo.current.srcObject instanceof MediaStream&&(refVideo.current.srcObject.getTracks().forEach((function(track){return track.stop()})),refVideo.current.srcObject=null)}),[refVideo]),openCamera=Object(react.useCallback)(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(deviceId){var defaultVideoSettings,stream;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return defaultVideoSettings={},defaultVideoSettings=dist.isMobile?dist.isIOS?{width:{ideal:1460},aspectRatio:{ideal:window.innerHeight/window.innerWidth}}:{width:{ideal:1650},aspectRatio:{ideal:window.innerHeight/window.innerWidth}}:{height:{ideal:9999}},_context.prev=2,_context.next=5,mediaDevices.getUserMedia({audio:!1,video:Object.assign({},deviceId?{deviceId:deviceId}:{facingMode:frontCamera?"user":"environment"},videoSettings||defaultVideoSettings)});case 5:return(stream=_context.sent)||(setErrorMsg(Errors.not_supported.msg[lang]),onError(Errors.not_supported)),_context.abrupt("return",stream);case 10:_context.prev=10,_context.t0=_context.catch(2),"NotAllowedError"===_context.t0.name?(setErrorMsg(Errors.no_permission.msg[lang]),onError(Errors.no_permission)):(setShowCameraSelection(!0),setErrorMsg(_context.t0.message),onError({code:_context.t0.name||_context.t0.code}));case 13:return _context.abrupt("return",null);case 14:case"end":return _context.stop()}}),_callee,null,[[2,10]])})));return function(_x){return _ref.apply(this,arguments)}}(),[frontCamera,videoSettings,lang,onError]),triggerOpenCamera=Object(react.useCallback)(function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(deviceId){var videoEl,stream;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return(videoEl=refVideo.current).oncanplaythrough=function(){videoEl.play();var clientWidth=window.innerWidth,clientHeight=window.innerHeight,_CameraUtils$analyzeV=tvweb_core_esm.d.analyzeVideoAndWindowSizes(videoEl),_CameraUtils$analyzeV2=_CameraUtils$analyzeV.lostX,lostX=void 0===_CameraUtils$analyzeV2?0:_CameraUtils$analyzeV2,_CameraUtils$analyzeV3=_CameraUtils$analyzeV.lostY,lostY=void 0===_CameraUtils$analyzeV3?0:_CameraUtils$analyzeV3,videoAreaWidth=Math.min(clientWidth,Math.floor(clientWidth-2*lostX)),videoAreaHeight=Math.min(clientHeight,Math.floor(clientHeight-2*lostY));onVideoPlayed&&onVideoPlayed({clientWidth:clientWidth,clientHeight:clientHeight,videoAreaWidth:videoAreaWidth,videoAreaHeight:videoAreaHeight,lostX:lostX,lostY:lostY})},_context2.next=4,openCamera(deviceId);case 4:(stream=_context2.sent)&&(videoEl.srcObject=stream);case 6:case"end":return _context2.stop()}}),_callee2)})));return function(_x2){return _ref2.apply(this,arguments)}}(),[refVideo,openCamera,onVideoPlayed]);Object(react.useEffect)((function(){function _getCameraList(){return(_getCameraList=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var devices,cameras;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=3,enumerateDevices();case 3:devices=_context3.sent,cameras=devices.filter((function(device){return device.deviceId&&"videoinput"===device.kind})),setCameraList(cameras),_context3.next=11;break;case 8:_context3.prev=8,_context3.t0=_context3.catch(0),console.error(_context3.t0);case 11:case"end":return _context3.stop()}}),_callee3,null,[[0,8]])})))).apply(this,arguments)}showCameraSelection&&!cameraListQueried.current&&(cameraListQueried.current=!0,function getCameraList(){return _getCameraList.apply(this,arguments)}())}),[showCameraSelection]),Object(react.useEffect)((function(){function _tryToOpenMainBackCamera(){return(_tryToOpenMainBackCamera=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){var devices,mainBackCameras,deviceId;return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,triggerOpenCamera();case 2:return _context4.next=4,enumerateDevices();case 4:devices=_context4.sent,(mainBackCameras=devices.filter((function(device){return"videoinput"===device.kind&&device.label.includes("0")}))).length>0&&(deviceId=mainBackCameras[0].deviceId,stopVideo(),triggerOpenCamera(deviceId));case 7:case"end":return _context4.stop()}}),_callee4)})))).apply(this,arguments)}var videoEl=refVideo.current;return!mediaDevices||dist.browserName&&["facebook"].includes(dist.browserName.toLowerCase())?(setErrorMsg(Errors.not_supported.msg[lang]),onError(Errors.not_supported)):videoEl&&(dist.isAndroid&&!1===frontCamera?function tryToOpenMainBackCamera(){return _tryToOpenMainBackCamera.apply(this,arguments)}():triggerOpenCamera()),function(){stopVideo()}}),[refVideo,lang,frontCamera,triggerOpenCamera,stopVideo,onError]);var handleCloseCamera=Object(react.useCallback)((function(){stopVideo(),onClose&&onClose()}),[onClose,stopVideo]);return Object(jsx_runtime.jsxs)(Wrapper,{checkCameraMode:checkCameraMode,children:[showCameraSelection&&null!=cameraList&&cameraList.length?Object(jsx_runtime.jsx)(Center,{children:Object(jsx_runtime.jsxs)(CameraSelectionBox,{children:[Object(jsx_runtime.jsxs)(Header,{children:[Object(jsx_runtime.jsx)(Tilte,{children:"Không thể mở camera mặc định"}),Object(jsx_runtime.jsx)(Description,{children:"Vui lòng thử chọn camera khác trong danh sách dưới đây"})]}),Object(jsx_runtime.jsx)(CameraList,{children:cameraList.map((function(camera,index){return Object(jsx_runtime.jsx)(CameraItem,{onClick:function onClick(){setErrorMsg(""),stopVideo(),setShowCameraSelection(!1),triggerOpenCamera(camera.deviceId)},children:camera.label?camera.label:"Camera ".concat(index+1)},camera.deviceId)}))})]})}):null,errorMsg?Object(jsx_runtime.jsx)(Camera_Error,{children:errorMsg}):null,Object(jsx_runtime.jsx)(Video,{ref:refVideo,playsInline:!0,muted:!0,flipHorizontal:flipHorizontal}),children,Object(jsx_runtime.jsx)(CloseButton,{onClick:handleCloseCamera,children:Object(jsx_runtime.jsx)("img",{src:icClose,alt:""})})]})}Camera.displayName="Camera",Camera.propTypes={checkCameraMode:prop_types_default.a.bool,frontCamera:prop_types_default.a.bool,onClose:prop_types_default.a.func,onError:prop_types_default.a.func,onVideoPlayed:prop_types_default.a.func,children:prop_types_default.a.node,flipHorizontal:prop_types_default.a.bool,videoSettings:prop_types_default.a.object,refVideo:prop_types_default.a.object},Camera.defaultProps={checkCameraMode:!1,frontCamera:!0,onClose:null,onError:function onError(){},onVideoPlayed:null,children:null,flipHorizontal:!1,videoSettings:null,refVideo:null};__webpack_exports__.b=react_default.a.forwardRef((function(props,ref){return Object(jsx_runtime.jsx)(Camera,Object.assign({},props,{refVideo:ref||defaultRef}))}))}},[[1016,1,2]]]);
//# sourceMappingURL=main.d617b7eb8236db7020a1.bundle.js.map